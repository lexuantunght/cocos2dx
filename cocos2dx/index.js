Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const __CJS__cc__import__0__=require("fs");function _interopNamespaceDefault(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const __CJS__cc__import__0____namespace=_interopNamespaceDefault(__CJS__cc__import__0__);var module$1={exports:{}},exports$1=module$1.exports;exports.cc=exports.cc||{};exports.cc._tmp=exports.cc._tmp||{};exports.cc._LogInfos={};var _p=window;_p.gl;_p.WebGLRenderingContext;_p.DeviceOrientationEvent;_p.DeviceMotionEvent;_p.AudioContext;_p.AudioContext||_p.webkitAudioContext;_p.mozAudioContext;_p=Object.prototype;_p._super;_p.ctor;_p=null;exports.cc.ORIENTATION_PORTRAIT=0;exports.cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;exports.cc.ORIENTATION_LANDSCAPE_LEFT=2;exports.cc.ORIENTATION_LANDSCAPE_RIGHT=3;exports.cc._drawingUtil=null;exports.cc._renderContext=null;exports.cc._supportRender=!1;exports.cc._canvas=null;exports.cc.container=null;exports.cc._gameDiv=null;exports.cc.newElement=function(t){return document.createElement(t)};exports.cc.each=function(t,e,r){if(t){if(t instanceof Array){for(var n=0,s=t.length;n<s;n++)if(e.call(r,t[n],n)===!1)return}else for(var o in t)if(e.call(r,t[o],o)===!1)return}};exports.cc.extend=function(t){var e=arguments.length>=2?Array.prototype.slice.call(arguments,1):[];return exports.cc.each(e,function(r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}),t};exports.cc.isFunction=function(t){return typeof t=="function"};exports.cc.isNumber=function(t){return typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]"};exports.cc.isString=function(t){return typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"};exports.cc.isArray=function(t){return Array.isArray(t)||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Array]"};exports.cc.isUndefined=function(t){return typeof t=="undefined"};exports.cc.isObject=function(t){return typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"};exports.cc.isCrossOrigin=function(t){if(!t)return exports.cc.log("invalid URL"),!1;var e=t.indexOf("://");if(e===-1)return!1;var r=t.indexOf("/",e+3),n=r===-1?t:t.substring(0,r);return n!==location.origin};exports.cc.AsyncPool=function(t,e,r,n,s){var o=this||window;o._srcObj=t,o._limit=e,o._pool=[],o._iterator=r,o._iteratorTarget=s,o._onEnd=n,o._onEndTarget=s,o._results=t instanceof Array?[]:{},o._errors=t instanceof Array?[]:{},exports.cc.each(t,function(a,c){o._pool.push({index:c,value:a})}),o.size=o._pool.length,o.finishedSize=0,o._workingSize=0,o._limit=o._limit||o.size,o.onIterator=function(a,c){o._iterator=a,o._iteratorTarget=c},o.onEnd=function(a,c){o._onEnd=a,o._onEndTarget=c},o._handleItem=function(){var a=this||window;if(!(a._pool.length===0||a._workingSize>=a._limit)){var c=a._pool.shift(),l=c.value,h=c.index;a._workingSize++,a._iterator.call(a._iteratorTarget,l,h,function(u,_){if(a.finishedSize++,a._workingSize--,u?a._errors[this.index]=u:a._results[this.index]=_,a.finishedSize===a.size){if(a._onEnd){var d=a._errors.length===0?null:a._errors;a._onEnd.call(a._onEndTarget,d,a._results)}return}a._handleItem()}.bind(c),a)}},o.flow=function(){var a=this||window;if(a._pool.length===0){a._onEnd&&a._onEnd.call(a._onEndTarget,null,[]);return}for(var c=0;c<a._limit;c++)a._handleItem()}};exports.cc.async={series:function(t,e,r){var n=new exports.cc.AsyncPool(t,1,function(s,o,a){s.call(r,a)},e,r);return n.flow(),n},parallel:function(t,e,r){var n=new exports.cc.AsyncPool(t,0,function(s,o,a){s.call(r,a)},e,r);return n.flow(),n},waterfall:function(t,e,r){var n=[],s=[null],o=new exports.cc.AsyncPool(t,1,function(a,c,l){n.push(function(h){n=Array.prototype.slice.call(arguments,1),t.length-1===c&&(s=s.concat(n)),l.apply(null,arguments)}),a.apply(r,n)},function(a){if(e){if(a)return e.call(r,a);e.apply(r,s)}});return o.flow(),o},map:function(t,e,r,n){var s=e;typeof e=="object"&&(r=e.cb,n=e.iteratorTarget,s=e.iterator);var o=new exports.cc.AsyncPool(t,0,s,r,n);return o.flow(),o},mapLimit:function(t,e,r,n,s){var o=new exports.cc.AsyncPool(t,e,r,n,s);return o.flow(),o}};exports.cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var t=arguments.length,e="",r=0;r<t;r++)e=(e+(e===""?"":"/")+arguments[r]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t);return e?e[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(e!==-1)return t.substring(0,e)}return t},basename:function(t,e){var r=t.indexOf("?");r>0&&(t=t.substring(0,r));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g,s=n.exec(t.replace(/(\/|\\\\)$/,""));if(!s)return null;var o=s[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?o.substring(0,o.length-e.length):o},dirname:function(t){return t.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(t,e){e=e||"";var r=t.indexOf("?"),n="";return r>0&&(n=t.substring(r),t=t.substring(0,r)),r=t.lastIndexOf("."),r<0?t+e+n:t.substring(0,r)+e+n},changeBasename:function(t,e,r){if(e.indexOf(".")===0)return this.changeExtname(t,e);var n=t.indexOf("?"),s="",o=r?this.extname(t):"";return n>0&&(s=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=n<=0?0:n+1,t.substring(0,n)+e+o+s},_normalize:function(t){var e=t=String(t);do e=t,t=t.replace(this.normalizeRE,"");while(e.length!==t.length);return t}};exports.cc.loader=function(){var t={},e={},r={},n={},s={},o=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(a){var c=a[0],l=a[1],h=a[2],u=["",null,null];if(a.length===1)u[1]=c instanceof Array?c:[c];else if(a.length===2)typeof l=="function"?(u[1]=c instanceof Array?c:[c],u[2]=l):(u[0]=c||"",u[1]=l instanceof Array?l:[l]);else if(a.length===3)u[0]=c||"",u[1]=l instanceof Array?l:[l],u[2]=h;else throw new Error("arguments error to load js!");return u},isLoading:function(a){return s[a]!==void 0},loadJs:function(a,c,l){var h=this,u=h._getArgs4Js(arguments),_=u[0],d=u[1],f=u[2];navigator.userAgent.indexOf("Trident/5")>-1?h._loadJs4Dependency(_,d,0,f):exports.cc.async.map(d,function(T,x,m){var v=exports.cc.path.join(_,T);if(t[v])return m(null);h._createScript(v,!1,m)},f)},loadJsWithImg:function(a,c,l){var h=this,u=h._loadJsImg(),_=h._getArgs4Js(arguments);this.loadJs(_[0],_[1],function(d){if(d)throw new Error(d);u.parentNode.removeChild(u),_[2]&&_[2]()})},_createScript:function(a,c,l){var h=document,u=this,_=document.createElement("script");_.async=c,t[a]=!0,exports.cc.game.config.noCache&&typeof a=="string"?u._noCacheRex.test(a)?_.src=a+"&_t="+(new Date-0):_.src=a+"?_t="+(new Date-0):_.src=a,_.addEventListener("load",function(){_.parentNode.removeChild(_),this.removeEventListener("load",arguments.callee,!1),l()},!1),_.addEventListener("error",function(){_.parentNode.removeChild(_),l("Load "+a+" failed!")},!1),h.body.appendChild(_)},_loadJs4Dependency:function(a,c,l,h){if(l>=c.length){h&&h();return}var u=this||window;u._createScript(exports.cc.path.join(a,c[l]),!1,function(_){if(_)return h(_);u._loadJs4Dependency(a,c,l+1,h)})},_loadJsImg:function(){var a=document,c=a.getElementById("cocos2d_loadJsImg");if(!c){c=document.createElement("img"),exports.cc._loadingImage&&(c.src=exports.cc._loadingImage);var l=a.getElementById(exports.cc.game.config.id);l.style.backgroundColor="transparent",l.parentNode.appendChild(c);var h=getComputedStyle?getComputedStyle(l):l.currentStyle;h||(h={width:l.width,height:l.height}),c.style.left=l.offsetLeft+(parseFloat(h.width)-c.width)/2+"px",c.style.top=l.offsetTop+(parseFloat(h.height)-c.height)/2+"px",c.style.position="absolute"}return c},loadTxt:function(a,c){if(exports.cc._isNodeJs){var u=__CJS__cc__import__0____namespace.default||__CJS__cc__import__0____namespace;u.readFile(a,function(_,d){_?c(_):c(null,d.toString())})}else{var l=this.getXMLHttpRequest(),h="load "+a+" failed!";l.open("GET",a,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(l.setRequestHeader("Accept-Charset","utf-8"),l.onreadystatechange=function(){l.readyState===4&&(l.status===200?c(null,l.responseText):c({status:l.status,errorMessage:h},null))}):(l.overrideMimeType&&l.overrideMimeType("text/plain; charset=utf-8"),l.onload=function(){l.readyState===4&&(l.status===200?c(null,l.responseText):c({status:l.status,errorMessage:h},null))},l.onerror=function(){c({status:l.status,errorMessage:h},null)}),l.send(null)}},_loadTxtSync:function(a){if(exports.cc._isNodeJs){var l=__CJS__cc__import__0____namespace.default||__CJS__cc__import__0____namespace;return l.readFileSync(a).toString()}else{var c=this.getXMLHttpRequest();return c.open("GET",a,!1),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?c.setRequestHeader("Accept-Charset","utf-8"):c.overrideMimeType&&c.overrideMimeType("text/plain; charset=utf-8"),c.send(null),!c.readyState===4||c.status!==200?null:c.responseText}},loadCsb:function(a,c){var l=new XMLHttpRequest,h="load "+a+" failed!";l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){var u=l.response;u&&(window.msg=u),l.readyState===4&&(l.status===200?c(null,l.response):c({status:l.status,errorMessage:h},null))},l.onerror=function(){c({status:l.status,errorMessage:h},null)},l.send(null)},loadJson:function(a,c){this.loadTxt(a,function(l,h){if(l)c(l);else{try{var u=JSON.parse(h)}catch(_){throw new Error("parse json ["+a+"] failed : "+_)}c(null,u)}})},_checkIsImageURL:function(a){var c=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(a);return c!=null},loadImg:function(a,c,l){var h={isCrossOrigin:!0};l!==void 0?h.isCrossOrigin=c.isCrossOrigin===void 0?h.isCrossOrigin:c.isCrossOrigin:c!==void 0&&(l=c);var u=this.getRes(a);if(u)return l&&l(null,u),u;var _=s[a];if(_)return _.callbacks.push(l),_.img;u=new Image,h.isCrossOrigin&&location.origin!=="file://"&&(u.crossOrigin="Anonymous");var d=function(){this.removeEventListener("load",d,!1),this.removeEventListener("error",T,!1),o.test(a)||(exports.cc.loader.cache[a]=u);var x=s[a];if(x){for(var m=x.callbacks,v=0;v<m.length;++v){var A=m[v];A&&A(null,u)}x.img=null,delete s[a]}},f=this||window,T=function(){if(this.removeEventListener("error",T,!1),u.crossOrigin&&u.crossOrigin.toLowerCase()==="anonymous")h.isCrossOrigin=!1,f.release(a),exports.cc.loader.loadImg(a,h,l);else{var x=s[a];if(x){for(var m=x.callbacks,v=0;v<m.length;++v){var A=m[v];A&&A("load image failed")}x.img=null,delete s[a]}}};return s[a]={img:u,callbacks:l?[l]:[]},u.addEventListener("load",d),u.addEventListener("error",T),u.src=a,u},_loadResIterator:function(a,c,l){var h=this,u=null,_=a.type;_?(_="."+_.toLowerCase(),u=a.src?a.src:a.name+_):(u=a,_=exports.cc.path.extname(u));var d=h.getRes(u);if(d)return l(null,d);var f=null;if(_&&(f=e[_.toLowerCase()]),!f)return exports.cc.error("loader for ["+_+"] not exists!"),l();var T=u;if(!o.test(u)){var x=f.getBasePath?f.getBasePath():h.resPath;T=h.getUrl(x,u)}exports.cc.game.config.noCache&&typeof T=="string"&&(h._noCacheRex.test(T)?T+="&_t="+(new Date-0):T+="?_t="+(new Date-0)),f.load(T,u,a,function(m,v){m?(exports.cc.log(m),h.cache[u]=null,delete h.cache[u],l({status:520,errorMessage:m},null)):(h.cache[u]=v,l(null,v))})},_noCacheRex:/\?/,getUrl:function(a,c){var l=this,h=exports.cc.path;if(a!==void 0&&c===void 0){c=a;var u=h.extname(c);u=u?u.toLowerCase():"";var _=e[u];_?a=_.getBasePath?_.getBasePath():l.resPath:a=l.resPath}if(c=exports.cc.path.join(a||"",c),c.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(r[c])return r[c];var d=h.extname(c)||"";c=r[c]=c.substring(0,c.length-d.length)+"_"+exports.cc.sys.language+d}return c},load:function(a,c,l){var h=this||window,u=arguments.length;if(u===0)throw new Error("arguments error!");u===3?typeof c=="function"&&(typeof l=="function"?c={trigger:c,cb:l}:c={cb:c,cbTarget:l}):u===2?typeof c=="function"&&(c={cb:c}):u===1&&(c={}),a instanceof Array||(a=[a]);var _=new exports.cc.AsyncPool(a,0,function(d,f,T,x){h._loadResIterator(d,f,function(m){var v=Array.prototype.slice.call(arguments,1);c.trigger&&c.trigger.call(c.triggerTarget,v[0],x.size,x.finishedSize),T(m,v[0])})},c.cb,c.cbTarget);return _.flow(),_},_handleAliases:function(a,c){var l=[];for(var h in a){var u=a[h];n[h]=u,l.push(u)}this.load(l,c)},loadAliases:function(a,c){var l=this,h=l.getRes(a);h?l._handleAliases(h.filenames,c):l.load(a,function(u,_){l._handleAliases(_[0].filenames,c)})},register:function(a,c){if(!(!a||!c)){if(typeof a=="string")return e[a.trim().toLowerCase()]=c;for(var l=0,h=a.length;l<h;l++)e["."+a[l].trim().toLowerCase()]=c}},getRes:function(a){return this.cache[a]||this.cache[n[a]]},_getAliase:function(a){return n[a]},release:function(a){var c=this.cache,l=s[a];l&&(l.img=null,delete s[a]),delete c[a],delete c[n[a]],delete n[a]},releaseAll:function(){var a=this.cache;for(var c in a)delete a[c];for(var c in n)delete n[c]}}}();exports.cc.formatStr=function(){var t=arguments,e=t.length;if(e<1)return"";var r=t[0],n=!0;typeof r=="object"&&(n=!1);for(var s=1;s<e;++s){var o=t[s];if(n)for(;;){var a=null;if(typeof o=="number"&&(a=r.match(/(%d)|(%s)/),a)){r=r.replace(/(%d)|(%s)/,o);break}a=r.match(/%s/),a?r=r.replace(/%s/,o):r+="    "+o;break}else r+="    "+o}return r};(function(){var t=document.createElement("canvas"),e=document.createElement("canvas");exports.cc.create3DContext=function(_,d){for(var f=["webgl","experimental-webgl","webkit-3d","moz-webgl"],T=null,x=0;x<f.length;++x){try{T=_.getContext(f[x],d)}catch(m){}if(T)break}return T};var r=function(){exports.cc.sys={};var _=exports.cc.sys;_.LANGUAGE_ENGLISH="en",_.LANGUAGE_CHINESE="zh",_.LANGUAGE_FRENCH="fr",_.LANGUAGE_ITALIAN="it",_.LANGUAGE_GERMAN="de",_.LANGUAGE_SPANISH="es",_.LANGUAGE_DUTCH="du",_.LANGUAGE_RUSSIAN="ru",_.LANGUAGE_KOREAN="ko",_.LANGUAGE_JAPANESE="ja",_.LANGUAGE_HUNGARIAN="hu",_.LANGUAGE_PORTUGUESE="pt",_.LANGUAGE_ARABIC="ar",_.LANGUAGE_NORWEGIAN="no",_.LANGUAGE_POLISH="pl",_.LANGUAGE_UNKNOWN="unkonwn",_.OS_IOS="iOS",_.OS_ANDROID="Android",_.OS_WINDOWS="Windows",_.OS_MARMALADE="Marmalade",_.OS_LINUX="Linux",_.OS_BADA="Bada",_.OS_BLACKBERRY="Blackberry",_.OS_OSX="OS X",_.OS_WP8="WP8",_.OS_WINRT="WINRT",_.OS_UNKNOWN="Unknown",_.UNKNOWN=-1,_.WIN32=0,_.LINUX=1,_.MACOS=2,_.ANDROID=3,_.IPHONE=4,_.IPAD=5,_.BLACKBERRY=6,_.NACL=7,_.EMSCRIPTEN=8,_.TIZEN=9,_.WINRT=10,_.WP8=11,_.MOBILE_BROWSER=100,_.DESKTOP_BROWSER=101,_.BROWSER_TYPE_WECHAT="wechat",_.BROWSER_TYPE_ANDROID="androidbrowser",_.BROWSER_TYPE_IE="ie",_.BROWSER_TYPE_QQ="qqbrowser",_.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",_.BROWSER_TYPE_UC="ucbrowser",_.BROWSER_TYPE_360="360browser",_.BROWSER_TYPE_BAIDU_APP="baiduboxapp",_.BROWSER_TYPE_BAIDU="baidubrowser",_.BROWSER_TYPE_MAXTHON="maxthon",_.BROWSER_TYPE_OPERA="opera",_.BROWSER_TYPE_OUPENG="oupeng",_.BROWSER_TYPE_MIUI="miuibrowser",_.BROWSER_TYPE_FIREFOX="firefox",_.BROWSER_TYPE_SAFARI="safari",_.BROWSER_TYPE_CHROME="chrome",_.BROWSER_TYPE_LIEBAO="liebao",_.BROWSER_TYPE_QZONE="qzone",_.BROWSER_TYPE_SOUGOU="sogou",_.BROWSER_TYPE_UNKNOWN="unknown",_.isNative=!1;var d=window,f=d.navigator,T=document,x=T.documentElement,m=f.userAgent.toLowerCase();_.isMobile=m.indexOf("mobile")!==-1||m.indexOf("android")!==-1,_.platform=_.isMobile?_.MOBILE_BROWSER:_.DESKTOP_BROWSER;var v=f.language;v=v||f.browserLanguage,v=v?v.split("-")[0]:_.LANGUAGE_ENGLISH,_.language=v;var A=!1,D=!1,N="",z=0,M=/android (\d+(?:\.\d+)+)/i.exec(m)||/android (\d+(?:\.\d+)+)/i.exec(f.platform);M&&(A=!0,N=M[1]||"",z=parseInt(N)||0),M=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(m),M&&(D=!0,N=M[2]||"",z=parseInt(N)||0);var J=_.OS_UNKNOWN;f.appVersion.indexOf("Win")!==-1?J=_.OS_WINDOWS:D?J=_.OS_IOS:f.appVersion.indexOf("Mac")!==-1?J=_.OS_OSX:f.appVersion.indexOf("X11")!==-1&&f.appVersion.indexOf("Linux")===-1?J=_.OS_UNIX:A?J=_.OS_ANDROID:f.appVersion.indexOf("Linux")!==-1&&(J=_.OS_LINUX),_.os=J,_.osVersion=N,_.osMainVersion=z,_.browserType=_.BROWSER_TYPE_UNKNOWN,function(){var b=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i,W=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,S=b.exec(m);S||(S=W.exec(m));var E=S?S[0]:_.BROWSER_TYPE_UNKNOWN;E==="micromessenger"?E=_.BROWSER_TYPE_WECHAT:E==="safari"&&m.match(/android.*applewebkit/)?E=_.BROWSER_TYPE_ANDROID:E==="trident"?E=_.BROWSER_TYPE_IE:E==="360 aphone"?E=_.BROWSER_TYPE_360:E==="mxbrowser"?E=_.BROWSER_TYPE_MAXTHON:E==="opr"&&(E=_.BROWSER_TYPE_OPERA),_.browserType=E}(),_.browserVersion="",function(){var b=/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i,W=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,S=m.match(b);S||(S=m.match(W)),_.browserVersion=S?S[4]:""}();var U=window.innerWidth||document.documentElement.clientWidth,K=window.innerHeight||document.documentElement.clientHeight,tt=window.devicePixelRatio||1;if(_.windowPixelResolution={width:tt*U,height:tt*K},_._checkWebGLRenderMode=function(){if(exports.cc._renderType!==exports.cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")},_._supportCanvasNewBlendModes=function(){var b=t;b.width=1,b.height=1;var W=b.getContext("2d");W.fillStyle="#000",W.fillRect(0,0,1,1),W.globalCompositeOperation="multiply";var S=e;S.width=1,S.height=1;var E=S.getContext("2d");return E.fillStyle="#fff",E.fillRect(0,0,1,1),W.drawImage(S,0,0,1,1),W.getImageData(0,0,1,1).data[0]===0}(),exports.cc.sys.isMobile){var rt=document.createElement("style");rt.type="text/css",document.body.appendChild(rt),rt.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var I=_.localStorage=d.localStorage;I.setItem("storage",""),I.removeItem("storage"),I=null}catch(b){var L=function(){exports.cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")};_.localStorage={getItem:L,setItem:L,removeItem:L,clear:L}}var G=!!t.getContext("2d"),w=!1;if(d.WebGLRenderingContext){var O=document.createElement("CANVAS");try{var j=exports.cc.create3DContext(O,{stencil:!0});if(j&&(w=!0),w&&_.os===_.OS_ANDROID){var Q=parseFloat(_.browserVersion);switch(_.browserType){case _.BROWSER_TYPE_MOBILE_QQ:case _.BROWSER_TYPE_BAIDU:case _.BROWSER_TYPE_BAIDU_APP:Q>=6.2?w=!0:w=!1;break;case _.BROWSER_TYPE_CHROME:Q>=30?w=!0:w=!1;break;case _.BROWSER_TYPE_ANDROID:_.osMainVersion&&_.osMainVersion>=5&&(w=!0);break;case _.BROWSER_TYPE_UNKNOWN:case _.BROWSER_TYPE_360:case _.BROWSER_TYPE_MIUI:case _.BROWSER_TYPE_UC:w=!1}}}catch(b){}O=null}var C=_.capabilities={canvas:G,opengl:w};(x.ontouchstart!==void 0||T.ontouchstart!==void 0||f.msPointerEnabled)&&(C.touches=!0),x.onmouseup!==void 0&&(C.mouse=!0),x.onkeyup!==void 0&&(C.keyboard=!0),(d.DeviceMotionEvent||d.DeviceOrientationEvent)&&(C.accelerometer=!0),_.garbageCollect=function(){},_.dumpRoot=function(){},_.restartVM=function(){},_.cleanScript=function(b){},_.isObjectValid=function(b){return!!b},_.dump=function(){var b=this||window,W="";W+="isMobile : "+b.isMobile+`\r
`,W+="language : "+b.language+`\r
`,W+="browserType : "+b.browserType+`\r
`,W+="browserVersion : "+b.browserVersion+`\r
`,W+="capabilities : "+JSON.stringify(b.capabilities)+`\r
`,W+="os : "+b.os+`\r
`,W+="osVersion : "+b.osVersion+`\r
`,W+="platform : "+b.platform+`\r
`,W+="Using "+(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+` renderer.\r
`,exports.cc.log(W)},_.openURL=function(b){window.open(b)}};r(),t=null,e=null,exports.cc.log=exports.cc.warn=exports.cc.error=exports.cc.assert=function(){};var n={},s=!1,o=null;exports.cc._engineLoaded=!1;function a(_){var d=exports.cc.game.CONFIG_KEY,f=parseInt(_[d.renderMode])||0;(isNaN(f)||f>2||f<0)&&(_[d.renderMode]=0),exports.cc._renderType=exports.cc.game.RENDER_TYPE_CANVAS,exports.cc._supportRender=!1,f===0?exports.cc.sys.capabilities.opengl?(exports.cc._renderType=exports.cc.game.RENDER_TYPE_WEBGL,exports.cc._supportRender=!0):exports.cc.sys.capabilities.canvas&&(exports.cc._renderType=exports.cc.game.RENDER_TYPE_CANVAS,exports.cc._supportRender=!0):f===1&&exports.cc.sys.capabilities.canvas?(exports.cc._renderType=exports.cc.game.RENDER_TYPE_CANVAS,exports.cc._supportRender=!0):f===2&&exports.cc.sys.capabilities.opengl&&(exports.cc._renderType=exports.cc.game.RENDER_TYPE_WEBGL,exports.cc._supportRender=!0)}function c(_,d,f){if(n[d])return null;f=f||"";var T=[],x=_[d];if(!x)throw new Error("can not find module ["+d+"]");for(var m=exports.cc.path,v=0,A=x.length;v<A;v++){var D=x[v];if(!n[D]){var N=m.extname(D);if(N)N.toLowerCase()===".js"&&T.push(m.join(f,D));else{var z=c(_,D,f);z&&(T=T.concat(z))}n[D]=1}}return T}function l(_){exports.cc._initDebugSetting&&exports.cc._initDebugSetting(_[exports.cc.game.CONFIG_KEY.debugMode]),exports.cc._engineLoaded=!0,exports.cc.log(exports.cc.ENGINE_VERSION),o&&o()}function h(_){var d=exports.cc.game.CONFIG_KEY,f=_[d.engineDir],T=exports.cc.loader;if(exports.cc.Class)l(_);else{var x=exports.cc.path.join(f,"moduleConfig.json");T.loadJson(x,function(m,v){if(m)throw new Error(m);var A=_.modules||[],D=v.module,N=[];exports.cc.sys.capabilities.opengl&&A.indexOf("base4webgl")<0?A.splice(0,0,"base4webgl"):A.indexOf("core")<0&&A.splice(0,0,"core");for(var z=0,M=A.length;z<M;z++){var J=c(D,A[z],f);J&&(N=N.concat(J))}exports.cc.loader.loadJsWithImg(N,function(U){if(U)throw U;l(_)})})}}function u(){this.removeEventListener("load",u,!1),h(exports.cc.game.config)}exports.cc.initEngine=function(_,d){if(s){var f=o;o=function(){f&&f(),d&&d()};return}o=d,!exports.cc.game.config&&_?exports.cc.game.config=_:exports.cc.game.config||exports.cc.game._loadConfig(),_=exports.cc.game.config,a(_),document.body?h(_):exports.cc._addEventListener(window,"load",u,!1),s=!0}})();exports.cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:!0,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this,r=e.config,n=e.CONFIG_KEY;r[n.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){exports.cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,exports.cc.audioEngine&&(exports.cc.audioEngine.stopAllEffects(),exports.cc.audioEngine.pauseMusic()),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,exports.cc.audioEngine&&exports.cc.audioEngine.resumeMusic(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){exports.cc.director.popToSceneStackLevel(0),exports.cc.audioEngine&&exports.cc.audioEngine.end(),exports.cc.game.onStart()},end:function(){close()},prepare:function(t){var e=this,r=e.config,n=e.CONFIG_KEY;if(this._loadConfig(),this._prepared){t&&t();return}if(!this._prepareCalled){if(exports.cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(r[n.width],r[n.height]),exports.cc.view=exports.cc.EGLView._getInstance(),exports.cc.director=exports.cc.Director._getInstance(),exports.cc.director.setOpenGLView&&exports.cc.director.setOpenGLView(exports.cc.view),exports.cc.winSize=exports.cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var s=r[n.jsList];s?exports.cc.loader.loadJsWithImg(s,function(o){if(o)throw new Error(o);e._prepared=!0,t&&t()}):t&&t();return}exports.cc.initEngine(this.config,function(){e.prepare(t)})}},run:function(t,e){typeof t=="function"?exports.cc.game.onStart=t:(t&&(typeof t=="string"?(exports.cc.game.config||this._loadConfig(),exports.cc.game.config[exports.cc.game.CONFIG_KEY.id]=t):exports.cc.game.config=t),typeof e=="function"&&(exports.cc.game.onStart=e)),this.prepare(exports.cc.game.onStart&&exports.cc.game.onStart.bind(exports.cc.game))},_setAnimFrame:function(){this._lastTime=new Date,this._frameTime=1e3/exports.cc.game.config[exports.cc.game.CONFIG_KEY.frameRate],exports.cc.sys.os===exports.cc.sys.OS_IOS&&exports.cc.sys.browserType===exports.cc.sys.BROWSER_TYPE_WECHAT||exports.cc.game.config[exports.cc.game.CONFIG_KEY.frameRate]!==60?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=new Date().getTime(),r=Math.max(0,exports.cc.game._frameTime-(e-exports.cc.game._lastTime)),n=window.setTimeout(function(){t()},r);return exports.cc.game._lastTime=e+r,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t=this,e,r=t.config,n=t.CONFIG_KEY,s=exports.cc.director;s.setDisplayStats(r[n.showFPS]),e=function(){t._paused||(s.mainLoop(),t._intervalId&&window.cancelAnimationFrame(t._intervalId),t._intervalId=window.requestAnimFrame(e))},window.requestAnimFrame(e),t._paused=!1},_loadConfig:function(){if(this.config){this._initConfig(this.config);return}if(document.ccConfig)this._initConfig(document.ccConfig);else{var t={};try{for(var e=document.getElementsByTagName("script"),r=0;r<e.length;r++){var n=e[r].getAttribute("cocos");if(n===""||n)break}var s,o,a;r<e.length&&(s=e[r].src,s&&(a=/(.*)\//.exec(s)[0],exports.cc.loader.resPath=a,s=exports.cc.path.join(a,"project.json")),o=exports.cc.loader._loadTxtSync(s)),o||(o=exports.cc.loader._loadTxtSync("project.json")),t=JSON.parse(o)}catch(c){exports.cc.log("Failed to read or parse project.json")}this._initConfig(t)}},_initConfig:function(t){var e=this.CONFIG_KEY,r=t[e.modules];t[e.showFPS]=typeof t[e.showFPS]=="undefined"?!0:t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",t[e.debugMode]==null&&(t[e.debugMode]=0),t[e.frameRate]=t[e.frameRate]||60,t[e.renderMode]==null&&(t[e.renderMode]=0),t[e.registerSystemEvent]==null&&(t[e.registerSystemEvent]=!0),r&&r.indexOf("core")<0&&r.splice(0,0,"core"),r&&(t[e.modules]=r),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!exports.cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var r=this.config[exports.cc.game.CONFIG_KEY.id],n=window,s=exports.cc.$(r)||exports.cc.$("#"+r),o,a;s.tagName==="CANVAS"?(t=t||s.width,e=e||s.height,this.canvas=exports.cc._canvas=o=s,this.container=exports.cc.container=a=document.createElement("DIV"),o.parentNode&&o.parentNode.insertBefore(a,o)):(s.tagName!=="DIV"&&exports.cc.log("Warning: target element is not a DIV or CANVAS"),t=t||s.clientWidth,e=e||s.clientHeight,this.canvas=exports.cc._canvas=o=document.createElement("CANVAS"),this.container=exports.cc.container=a=document.createElement("DIV"),s.appendChild(a)),a.setAttribute("id","Cocos2dGameContainer"),a.appendChild(o),this.frame=a.parentNode===document.body?document.documentElement:a.parentNode,o.addClass("gameCanvas"),o.setAttribute("width",t||480),o.setAttribute("height",e||320),o.setAttribute("tabindex",99),exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=exports.cc._renderContext=exports.cc.webglContext=exports.cc.create3DContext(o,{stencil:!0,antialias:!exports.cc.sys.isMobile,alpha:!1})),this._renderContext?(exports.cc.renderer=exports.cc.rendererWebGL,n.gl=this._renderContext,exports.cc.renderer.init(),exports.cc.shaderCache._init(),exports.cc._drawingUtil=new exports.cc.DrawingPrimitiveWebGL(this._renderContext),exports.cc.textureCache._initializingRenderer(),exports.cc.glExt={},exports.cc.glExt.instanced_arrays=n.gl.getExtension("ANGLE_instanced_arrays"),exports.cc.glExt.element_uint=n.gl.getExtension("OES_element_index_uint")):(exports.cc._renderType=exports.cc.game.RENDER_TYPE_CANVAS,exports.cc.renderer=exports.cc.rendererCanvas,this._renderContext=exports.cc._renderContext=new exports.cc.CanvasContextWrapper(o.getContext("2d")),exports.cc._drawingUtil=exports.cc.DrawingPrimitiveCanvas?new exports.cc.DrawingPrimitiveCanvas(this._renderContext):null),exports.cc._gameDiv=a,exports.cc.game.canvas.oncontextmenu=function(){if(!exports.cc._isContextMenuEnable)return!1},this.dispatchEvent(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){var t=window,e,r;this._eventHide=this._eventHide||new exports.cc.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new exports.cc.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent]&&exports.cc.inputManager.registerSystemEvent(this.canvas),exports.cc.isUndefined(document.hidden)?exports.cc.isUndefined(document.mozHidden)?exports.cc.isUndefined(document.msHidden)?exports.cc.isUndefined(document.webkitHidden)||(e="webkitHidden",r="webkitvisibilitychange"):(e="msHidden",r="msvisibilitychange"):(e="mozHidden",r="mozvisibilitychange"):(e="hidden",r="visibilitychange");var n=function(){exports.cc.eventManager&&exports.cc.game._eventHide&&exports.cc.eventManager.dispatchEvent(exports.cc.game._eventHide)},s=function(){exports.cc.eventManager&&exports.cc.game._eventShow&&exports.cc.eventManager.dispatchEvent(exports.cc.game._eventShow)};e?document.addEventListener(r,function(){document[e]?n():s()},!1):(t.addEventListener("blur",n,!1),t.addEventListener("focus",s,!1)),navigator.userAgent.indexOf("MicroMessenger")>-1&&(t.onfocus=function(){s()}),"onpageshow"in window&&"onpagehide"in window&&(t.addEventListener("pagehide",n,!1),t.addEventListener("pageshow",s,!1)),exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_HIDE,function(){exports.cc.game.pause()}),exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_SHOW,function(){exports.cc.game.resume()})}};Function.prototype.bind=Function.prototype.bind||function(t){if(!exports.cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),r=this,n=function(){},s=function(){return r.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s};exports.cc._urlRegExp=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");exports.cc.SimplePool=function(){this._pool=[]};exports.cc.SimplePool.prototype={constructor:exports.cc.SimplePool,size:function(){return this._pool.length},put:function(t){t&&this._pool.indexOf(t)===-1&&this._pool.unshift(t)},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];return this._pool.length=t,e},find:function(t,e){var r,n,s,o=this._pool,a=o.length-1;for(n=o.length;n>=0;--n)if(s=o[n],r=t(n,s),r)return o[n]=o[a],o.length=a,s;if(e){var c=e();if(c>=0)return o[c]=o[a],o.length=a,s}return null}};exports.cc.EventHelper=function(){};exports.cc.EventHelper.prototype={constructor:exports.cc.EventHelper,apply:function(t){t.addEventListener=exports.cc.EventHelper.prototype.addEventListener,t.hasEventListener=exports.cc.EventHelper.prototype.hasEventListener,t.removeEventListener=exports.cc.EventHelper.prototype.removeEventListener,t.dispatchEvent=exports.cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,r){if(t==="load"&&this._textureLoaded){setTimeout(function(){e.call(r)},0);return}this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[t]===void 0&&(n[t]=[]),this.hasEventListener(t,e,r)||n[t].push({callback:e,eventTarget:r})},hasEventListener:function(t,e,r){if(this._listeners===void 0)return!1;var n=this._listeners;if(n[t]!==void 0)for(var s=0,o=n.length;s<o;s++){var a=n[s];if(a.callback===e&&a.eventTarget===r)return!0}return!1},removeEventListener:function(t,e,r){if(this._listeners!==void 0){var n=this._listeners,s=n[t];if(s!==void 0)for(var o=0;o<s.length;){var a=s[o];a.eventTarget===r&&a.callback===e?s.splice(o,1):o++}}},removeEventTarget:function(t,e,r){if(this._listeners!==void 0){var n=this._listeners,s=n[t];if(s!==void 0)for(var o=0;o<s.length;){var a=s[o];a.eventTarget===r?s.splice(o,1):o++}}},dispatchEvent:function(t,e){if(this._listeners!==void 0){e==null&&(e=!0);var r=this._listeners,n=r[t];if(n!==void 0){for(var s=[],o=n.length,a=0;a<o;a++)s[a]=n[a];for(a=0;a<o;a++)s[a].callback.call(s[a].eventTarget,this);e&&(n.length=0)}}}};exports.cc.EventHelper.prototype.apply(exports.cc.game);exports.cc=exports.cc||{};exports.cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7";exports.cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=";exports.cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=";exports.cc.loader.loadBinary=function(t,e){var r=this||window,n=this.getXMLHttpRequest(),s="load "+t+" failed!";n.open("GET",t,!0),exports.cc.loader.loadBinary._IEFilter?(n.setRequestHeader("Accept-Charset","x-user-defined"),n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var o=exports.cc._convertResponseBodyToText(n.responseBody);e(null,r._str2Uint8Array(o))}else e(s)}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){n.readyState===4&&n.status===200?e(null,r._str2Uint8Array(n.responseText)):e(s)}),n.send(null)};exports.cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last;exports.cc.loader._str2Uint8Array=function(t){if(!t)return null;for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r)&255;return e};exports.cc.loader.loadBinarySync=function(t){var e=this||window,r=this.getXMLHttpRequest(),n="load "+t+" failed!";r.open("GET",t,!1);var s=null;if(exports.cc.loader.loadBinary._IEFilter){if(r.setRequestHeader("Accept-Charset","x-user-defined"),r.send(null),r.status!==200)return exports.cc.log(n),null;var o=exports.cc._convertResponseBodyToText(r.responseBody);o&&(s=e._str2Uint8Array(o))}else{if(r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),r.status!==200)return exports.cc.log(n),null;s=this._str2Uint8Array(r.responseText)}return s};window.Uint8Array=window.Uint8Array||window.Array;if(exports.cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script=`<!-- IEBinaryToArray_ByteStr -->\r
Function IEBinaryToArray_ByteStr(Binary)\r
   IEBinaryToArray_ByteStr = CStr(Binary)\r
End Function\r
Function IEBinaryToArray_ByteStr_Last(Binary)\r
   Dim lastIndex\r
   lastIndex = LenB(Binary)\r
   if lastIndex mod 2 Then\r
       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r
   Else\r
       IEBinaryToArray_ByteStr_Last = ""\r
   End If\r
End Function\r
`,myVBScript=document.createElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),exports.cc._convertResponseBodyToText=function(t){for(var e={},r=0;r<256;r++)for(var n=0;n<256;n++)e[String.fromCharCode(r+n*256)]=String.fromCharCode(r)+String.fromCharCode(n);var s=IEBinaryToArray_ByteStr(t),o=IEBinaryToArray_ByteStr_Last(t);return s.replace(/[\s\S]/g,function(a){return e[a]})+o}}exports.cc=exports.cc||{};var ClassManager={id:0|Math.random()*998,instanceId:0|Math.random()*998,getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};(function(){var t=/\b_super\b/;exports.cc.Class=function(){},exports.cc.Class.extend=function(e){var r=this.prototype,n=Object.create(r),s=ClassManager.getNewID();ClassManager[s]=r;var o={writable:!0,enumerable:!1,configurable:!0};n.__instanceId=null;function a(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}a.id=s,o.value=s,Object.defineProperty(n,"__pid",o),a.prototype=n,o.value=a,Object.defineProperty(a.prototype,"constructor",o),this.__getters__&&(a.__getters__=exports.cc.clone(this.__getters__)),this.__setters__&&(a.__setters__=exports.cc.clone(this.__setters__));for(var c=0,l=arguments.length;c<l;++c){var h=arguments[c];for(var u in h){var _=typeof h[u]=="function",d=typeof r[u]=="function",f=t.test(h[u]);if(_&&d&&f?(o.value=function(A,D){return function(){var N=this._super;this._super=r[A];var z=D.apply(this,arguments);return this._super=N,z}}(u,h[u]),Object.defineProperty(n,u,o)):_?(o.value=h[u],Object.defineProperty(n,u,o)):n[u]=h[u],_){var T,x,m;if(this.__getters__&&this.__getters__[u]){m=this.__getters__[u];for(var v in this.__setters__)if(this.__setters__[v]===m){x=v;break}exports.cc.defineGetterSetter(n,m,h[u],h[x]?h[x]:n[x],u,x)}if(this.__setters__&&this.__setters__[u]){m=this.__setters__[u];for(var v in this.__getters__)if(this.__getters__[v]===m){T=v;break}exports.cc.defineGetterSetter(n,m,h[T]?h[T]:n[T],h[u],T,u)}}}}return a.extend=exports.cc.Class.extend,a.implement=function(A){for(var D in A)n[D]=A[D]},a}})();exports.cc.defineGetterSetter=function(t,e,r,n,s,o){if(t.__defineGetter__)r&&t.__defineGetter__(e,r),n&&t.__defineSetter__(e,n);else if(Object.defineProperty){var a={enumerable:!1,configurable:!0};r&&(a.get=r),n&&(a.set=n),Object.defineProperty(t,e,a)}else throw new Error("browser does not support getters");if(!s&&!o)for(var c=r!=null,l=n!=null,h=Object.getOwnPropertyNames(t),u=0;u<h.length;u++){var _=h[u];if(!((t.__lookupGetter__?t.__lookupGetter__(_):Object.getOwnPropertyDescriptor(t,_))||typeof t[_]!="function")){var d=t[_];if(c&&d===r&&(s=_,!l||o)||l&&d===n&&(o=_,!c||s))break}}var f=t.constructor;s&&(f.__getters__||(f.__getters__={}),f.__getters__[s]=e),o&&(f.__setters__||(f.__setters__={}),f.__setters__[o]=e)};exports.cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var r in t){var n=t[r];typeof n=="object"&&n&&!(n instanceof exports.cc.Node)&&!(n instanceof HTMLElement)?e[r]=exports.cc.clone(n):e[r]=n}return e};exports.cc.inject=function(t,e){for(var r in t)e[r]=t[r]};exports.cc.Point=function(t,e){this.x=t||0,this.y=e||0};exports.cc.p=function(t,e){return t===void 0?{x:0,y:0}:e===void 0?{x:t.x,y:t.y}:{x:t,y:e}};exports.cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y};exports.cc.Size=function(t,e){this.width=t||0,this.height=e||0};exports.cc.size=function(t,e){return t===void 0?{width:0,height:0}:e===void 0?{width:t.width,height:t.height}:{width:t,height:e}};exports.cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height};exports.cc.Rect=function(t,e,r,n){this.x=t||0,this.y=e||0,this.width=r||0,this.height=n||0};exports.cc.rect=function(t,e,r,n){return t===void 0?{x:0,y:0,width:0,height:0}:e===void 0?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:t,y:e,width:r,height:n}};exports.cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height};exports.cc._rectEqualToZero=function(t){return t&&t.x===0&&t.y===0&&t.width===0&&t.height===0};exports.cc.rectContainsRect=function(t,e){return!t||!e?!1:!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)};exports.cc.rectGetMaxX=function(t){return t.x+t.width};exports.cc.rectGetMidX=function(t){return t.x+t.width/2};exports.cc.rectGetMinX=function(t){return t.x};exports.cc.rectGetMaxY=function(t){return t.y+t.height};exports.cc.rectGetMidY=function(t){return t.y+t.height/2};exports.cc.rectGetMinY=function(t){return t.y};exports.cc.rectContainsPoint=function(t,e){return e.x>=exports.cc.rectGetMinX(t)&&e.x<=exports.cc.rectGetMaxX(t)&&e.y>=exports.cc.rectGetMinY(t)&&e.y<=exports.cc.rectGetMaxY(t)};exports.cc.rectIntersectsRect=function(t,e){var r=t.x+t.width,n=t.y+t.height,s=e.x+e.width,o=e.y+e.height;return!(r<e.x||s<t.x||n<e.y||o<t.y)};exports.cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)};exports.cc.rectUnion=function(t,e){var r=exports.cc.rect(0,0,0,0);return r.x=Math.min(t.x,e.x),r.y=Math.min(t.y,e.y),r.width=Math.max(t.x+t.width,e.x+e.width)-r.x,r.height=Math.max(t.y+t.height,e.y+e.height)-r.y,r};exports.cc.rectIntersection=function(t,e){var r=exports.cc.rect(Math.max(exports.cc.rectGetMinX(t),exports.cc.rectGetMinX(e)),Math.max(exports.cc.rectGetMinY(t),exports.cc.rectGetMinY(e)),0,0);return r.width=Math.min(exports.cc.rectGetMaxX(t),exports.cc.rectGetMaxX(e))-exports.cc.rectGetMinX(r),r.height=Math.min(exports.cc.rectGetMaxY(t),exports.cc.rectGetMaxY(e))-exports.cc.rectGetMinY(r),r};exports.cc.SAXParser=exports.cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e}});exports.cc.PlistParser=exports.cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),r=e.documentElement;if(r.tagName!=="plist")return exports.cc.warn("Not a plist file!"),{};for(var n=null,s=0,o=r.childNodes.length;s<o&&(n=r.childNodes[s],n.nodeType!==1);s++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,r=t.tagName;if(r==="dict")e=this._parseDict(t);else if(r==="array")e=this._parseArray(t);else if(r==="string")if(t.childNodes.length===1)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else r==="false"?e=!1:r==="true"?e=!0:r==="real"?e=parseFloat(t.firstChild.nodeValue):r==="integer"&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],r=0,n=t.childNodes.length;r<n;r++){var s=t.childNodes[r];s.nodeType===1&&e.push(this._parseNode(s))}return e},_parseDict:function(t){for(var e={},r=null,n=0,s=t.childNodes.length;n<s;n++){var o=t.childNodes[n];o.nodeType===1&&(o.tagName==="key"?r=o.firstChild.nodeValue:e[r]=this._parseNode(o))}return e}});exports.cc.saxParser=new exports.cc.SAXParser;exports.cc.plistParser=new exports.cc.PlistParser;exports.cc._txtLoader={load:function(t,e,r,n){exports.cc.loader.loadTxt(t,n)}};exports.cc.loader.register(["txt","xml","vsh","fsh","atlas"],exports.cc._txtLoader);exports.cc._jsonLoader={load:function(t,e,r,n){exports.cc.loader.loadJson(t,n)}};exports.cc.loader.register(["json","ExportJson"],exports.cc._jsonLoader);exports.cc._jsLoader={load:function(t,e,r,n){exports.cc.loader.loadJs(t,n)}};exports.cc.loader.register(["js"],exports.cc._jsLoader);exports.cc._imgLoader={load:function(t,e,r,n){var s;exports.cc.loader.isLoading(t)?s=n:s=function(o,a){if(o)return n(o);exports.cc.loader.cache[e]=a,exports.cc.textureCache.handleLoadedTexture(e),n(null,a)},exports.cc.loader.loadImg(t,s)}};exports.cc.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],exports.cc._imgLoader);exports.cc._serverImgLoader={load:function(t,e,r,n){exports.cc._imgLoader.load(r.src,e,r,n)}};exports.cc.loader.register(["serverImg"],exports.cc._serverImgLoader);exports.cc._plistLoader={load:function(t,e,r,n){exports.cc.loader.loadTxt(t,function(s,o){if(s)return n(s);n(null,exports.cc.plistParser.parse(o))})}};exports.cc.loader.register(["plist"],exports.cc._plistLoader);exports.cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(t,e,r){var n=document,s=exports.cc.path,o=this.TYPE,a=document.createElement("style");a.type="text/css",n.body.appendChild(a);var c="";if(isNaN(t-0)?c+="@font-face { font-family:"+t+"; src:":c+="@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var l=0,h=e.length;l<h;l++){var u=e[l];r=s.extname(u).toLowerCase(),c+="url('"+e[l]+"') format('"+o[r]+"')",c+=l===h-1?";":","}else r=r.toLowerCase(),c+="url('"+e+"') format('"+o[r]+"');";a.textContent+=c+"}";var _=document.createElement("div"),d=_.style;d.fontFamily=t,_.innerHTML=".",d.position="absolute",d.left="-100px",d.top="-100px",n.body.appendChild(_)},load:function(t,e,r,n){var s=this||window,o=r.type,a=r.name,c=r.srcs;exports.cc.isString(r)?(o=exports.cc.path.extname(r),a=exports.cc.path.basename(r,o),s._loadFont(a,r,o)):s._loadFont(a,c),document.fonts?document.fonts.load("1em "+a).then(function(){n(null,!0)},function(l){n(l)}):n(null,!0)}};exports.cc.loader.register(["font","eot","ttf","woff","svg","ttc"],exports.cc._fontLoader);exports.cc._binaryLoader={load:function(t,e,r,n){exports.cc.loader.loadBinary(t,n)}};exports.cc._csbLoader={load:function(t,e,r,n){exports.cc.loader.loadCsb(t,n)}};exports.cc.loader.register(["csb"],exports.cc._csbLoader);window.CocosEngine=exports.cc.ENGINE_VERSION="Cocos2d-JS v3.13";exports.cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;exports.cc.DIRECTOR_STATS_POSITION=exports.cc.p(0,0);exports.cc.DIRECTOR_FPS_INTERVAL=.5;exports.cc.COCOSNODE_RENDER_SUBPIXEL=1;exports.cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;exports.cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1;exports.cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;exports.cc.TEXTURE_ATLAS_USE_VAO=0;exports.cc.TEXTURE_NPOT_SUPPORT=0;exports.cc.RETINA_DISPLAY_SUPPORT=1;exports.cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";exports.cc.USE_LA88_LABELS=1;exports.cc.SPRITE_DEBUG_DRAW=0;exports.cc.SPRITEBATCHNODE_DEBUG_DRAW=0;exports.cc.LABELBMFONT_DEBUG_DRAW=0;exports.cc.LABELATLAS_DEBUG_DRAW=0;exports.cc.IS_RETINA_DISPLAY_SUPPORTED=1;exports.cc.DEFAULT_ENGINE=exports.cc.ENGINE_VERSION+"-canvas";exports.cc.ENABLE_STACKABLE_ACTIONS=1;exports.cc.ENABLE_GL_STATE_CACHE=1;exports.cc.$=function(t){var e=this===exports.cc?document:this,r=t instanceof HTMLElement?t:e.querySelector(t);return r&&(r.find=r.find||exports.cc.$,r.hasClass=r.hasClass||function(n){return this.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))},r.addClass=r.addClass||function(n){return this.hasClass(n)||(this.className&&(this.className+=" "),this.className+=n),this},r.removeClass=r.removeClass||function(n){return this.hasClass(n)&&(this.className=this.className.replace(n,"")),this},r.remove=r.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},r.appendTo=r.appendTo||function(n){return n.appendChild(this),this},r.prependTo=r.prependTo||function(n){return n.childNodes[0]?n.insertBefore(this,n.childNodes[0]):n.appendChild(this),this},r.transforms=r.transforms||function(){return this.style[exports.cc.$.trans]=exports.cc.$.translate(this.position)+exports.cc.$.rotate(this.rotation)+exports.cc.$.scale(this.scale)+exports.cc.$.skew(this.skew),this},r.position=r.position||{x:0,y:0},r.rotation=r.rotation||0,r.scale=r.scale||{x:1,y:1},r.skew=r.skew||{x:0,y:0},r.translates=function(n,s){return this.position.x=n,this.position.y=s,this.transforms(),this},r.rotate=function(n){return this.rotation=n,this.transforms(),this},r.resize=function(n,s){return this.scale.x=n,this.scale.y=s,this.transforms(),this},r.setSkew=function(n,s){return this.skew.x=n,this.skew.y=s,this.transforms(),this}),r};switch(exports.cc.sys.browserType){case exports.cc.sys.BROWSER_TYPE_FIREFOX:exports.cc.$.pfx="Moz",exports.cc.$.hd=!0;break;case exports.cc.sys.BROWSER_TYPE_CHROME:case exports.cc.sys.BROWSER_TYPE_SAFARI:exports.cc.$.pfx="webkit",exports.cc.$.hd=!0;break;case exports.cc.sys.BROWSER_TYPE_OPERA:exports.cc.$.pfx="O",exports.cc.$.hd=!1;break;case exports.cc.sys.BROWSER_TYPE_IE:exports.cc.$.pfx="ms",exports.cc.$.hd=!1;break;default:exports.cc.$.pfx="webkit",exports.cc.$.hd=!0}exports.cc.$.trans=exports.cc.$.pfx+"Transform";exports.cc.$.translate=exports.cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "};exports.cc.$.rotate=exports.cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "};exports.cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "};exports.cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"};exports.cc.$new=function(t){return exports.cc.$(document.createElement(t))};exports.cc.$.findpos=function(t){var e=0,r=0;do e+=t.offsetLeft,r+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:r}};exports.cc.INVALID_INDEX=-1;exports.cc.PI=Math.PI;exports.cc.FLT_MAX=parseFloat("3.402823466e+38F");exports.cc.FLT_MIN=parseFloat("1.175494351e-38F");exports.cc.RAD=exports.cc.PI/180;exports.cc.DEG=180/exports.cc.PI;exports.cc.UINT_MAX=4294967295;exports.cc.swap=function(t,e,r){if(exports.cc.isObject(r)&&!exports.cc.isUndefined(r.x)&&!exports.cc.isUndefined(r.y)){var n=r[t];r[t]=r[e],r[e]=n}else exports.cc.log(exports.cc._LogInfos.swap)};exports.cc.lerp=function(t,e,r){return t+(e-t)*r};exports.cc.rand=function(){return Math.random()*16777215};exports.cc.randomMinus1To1=function(){return(Math.random()-.5)*2};exports.cc.random0To1=Math.random;exports.cc.degreesToRadians=function(t){return t*exports.cc.RAD};exports.cc.radiansToDegrees=function(t){return t*exports.cc.DEG};exports.cc.radiansToDegress=function(t){return exports.cc.log(exports.cc._LogInfos.radiansToDegress),t*exports.cc.DEG};exports.cc.REPEAT_FOREVER=Number.MAX_VALUE-1;exports.cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};exports.cc.enableDefaultGLStates=function(){};exports.cc.disableDefaultGLStates=function(){};exports.cc.incrementGLDraws=function(t){exports.cc.g_NumberOfDraws+=t};exports.cc.FLT_EPSILON=1192092896e-16;exports.cc.contentScaleFactor=exports.cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return exports.cc.director.getContentScaleFactor()}:function(){return 1};exports.cc.pointPointsToPixels=function(t){var e=exports.cc.contentScaleFactor();return exports.cc.p(t.x*e,t.y*e)};exports.cc.pointPixelsToPoints=function(t){var e=exports.cc.contentScaleFactor();return exports.cc.p(t.x/e,t.y/e)};exports.cc._pointPixelsToPointsOut=function(t,e){var r=exports.cc.contentScaleFactor();e.x=t.x/r,e.y=t.y/r};exports.cc.sizePointsToPixels=function(t){var e=exports.cc.contentScaleFactor();return exports.cc.size(t.width*e,t.height*e)};exports.cc.sizePixelsToPoints=function(t){var e=exports.cc.contentScaleFactor();return exports.cc.size(t.width/e,t.height/e)};exports.cc._sizePixelsToPointsOut=function(t,e){var r=exports.cc.contentScaleFactor();e.width=t.width/r,e.height=t.height/r};exports.cc.rectPixelsToPoints=exports.cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=exports.cc.contentScaleFactor();return exports.cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return t};exports.cc.rectPointsToPixels=exports.cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=exports.cc.contentScaleFactor();return exports.cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return t};exports.cc.ONE=1;exports.cc.ZERO=0;exports.cc.SRC_ALPHA=770;exports.cc.SRC_ALPHA_SATURATE=776;exports.cc.SRC_COLOR=768;exports.cc.DST_ALPHA=772;exports.cc.DST_COLOR=774;exports.cc.ONE_MINUS_SRC_ALPHA=771;exports.cc.ONE_MINUS_SRC_COLOR=769;exports.cc.ONE_MINUS_DST_ALPHA=773;exports.cc.ONE_MINUS_DST_COLOR=775;exports.cc.ONE_MINUS_CONSTANT_ALPHA=32772;exports.cc.ONE_MINUS_CONSTANT_COLOR=32770;exports.cc.LINEAR=9729;exports.cc.REPEAT=10497;exports.cc.CLAMP_TO_EDGE=33071;exports.cc.MIRRORED_REPEAT=33648;exports.cc.BLEND_SRC=exports.cc.SRC_ALPHA;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&exports.cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(exports.cc.BLEND_SRC=exports.cc.ONE)});exports.cc.BLEND_DST=exports.cc.ONE_MINUS_SRC_ALPHA;exports.cc.checkGLErrorDebug=function(){if(exports.cc.renderMode===exports.cc.game.RENDER_TYPE_WEBGL){var t=exports.cc._renderContext.getError();t&&exports.cc.log(exports.cc._LogInfos.checkGLErrorDebug,t)}};exports.cc.ORIENTATION_PORTRAIT=1;exports.cc.ORIENTATION_LANDSCAPE=2;exports.cc.ORIENTATION_AUTO=3;exports.cc.VERTEX_ATTRIB_FLAG_NONE=0;exports.cc.VERTEX_ATTRIB_FLAG_POSITION=1;exports.cc.VERTEX_ATTRIB_FLAG_COLOR=2;exports.cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;exports.cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=exports.cc.VERTEX_ATTRIB_FLAG_POSITION|exports.cc.VERTEX_ATTRIB_FLAG_COLOR|exports.cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;exports.cc.GL_ALL=0;exports.cc.VERTEX_ATTRIB_POSITION=0;exports.cc.VERTEX_ATTRIB_COLOR=1;exports.cc.VERTEX_ATTRIB_TEX_COORDS=2;exports.cc.VERTEX_ATTRIB_MAX=7;exports.cc.UNIFORM_PMATRIX=0;exports.cc.UNIFORM_MVMATRIX=1;exports.cc.UNIFORM_MVPMATRIX=2;exports.cc.UNIFORM_TIME=3;exports.cc.UNIFORM_SINTIME=4;exports.cc.UNIFORM_COSTIME=5;exports.cc.UNIFORM_RANDOM01=6;exports.cc.UNIFORM_SAMPLER=7;exports.cc.UNIFORM_MAX=8;exports.cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor";exports.cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest";exports.cc.SHADER_POSITION_COLOR="ShaderPositionColor";exports.cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor";exports.cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";exports.cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";exports.cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";exports.cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";exports.cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";exports.cc.UNIFORM_PMATRIX_S="CC_PMatrix";exports.cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";exports.cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";exports.cc.UNIFORM_TIME_S="CC_Time";exports.cc.UNIFORM_SINTIME_S="CC_SinTime";exports.cc.UNIFORM_COSTIME_S="CC_CosTime";exports.cc.UNIFORM_RANDOM01_S="CC_Random01";exports.cc.UNIFORM_SAMPLER_S="CC_Texture0";exports.cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";exports.cc.ATTRIBUTE_NAME_COLOR="a_color";exports.cc.ATTRIBUTE_NAME_POSITION="a_position";exports.cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";exports.cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix";exports.cc.ITEM_SIZE=32;exports.cc.CURRENT_ITEM=3233828865;exports.cc.ZOOM_ACTION_TAG=3233828866;exports.cc.NORMAL_TAG=8801;exports.cc.SELECTED_TAG=8802;exports.cc.DISABLE_TAG=8803;exports.cc.arrayVerifyType=function(t,e){if(t&&t.length>0){for(var r=0;r<t.length;r++)if(!(t[r]instanceof e))return exports.cc.log("element type is wrong!"),!1}return!0};exports.cc.arrayRemoveObject=function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e){t.splice(r,1);break}};exports.cc.arrayRemoveArray=function(t,e){for(var r=0,n=e.length;r<n;r++)exports.cc.arrayRemoveObject(t,e[r])};exports.cc.arrayAppendObjectsToIndex=function(t,e,r){return t.splice.apply(t,[r,0].concat(e)),t};exports.cc.copyArray=function(t){var e,r=t.length,n=new Array(r);for(e=0;e<r;e+=1)n[e]=t[e];return n};exports.cc._tmp.PrototypeColor=function(){var t=exports.cc.color;t._getWhite=function(){return t(255,255,255)},t._getYellow=function(){return t(255,255,0)},t._getBlue=function(){return t(0,0,255)},t._getGreen=function(){return t(0,255,0)},t._getRed=function(){return t(255,0,0)},t._getMagenta=function(){return t(255,0,255)},t._getBlack=function(){return t(0,0,0)},t._getOrange=function(){return t(255,127,0)},t._getGray=function(){return t(166,166,166)},t.WHITE,exports.cc.defineGetterSetter(t,"WHITE",t._getWhite),t.YELLOW,exports.cc.defineGetterSetter(t,"YELLOW",t._getYellow),t.BLUE,exports.cc.defineGetterSetter(t,"BLUE",t._getBlue),t.GREEN,exports.cc.defineGetterSetter(t,"GREEN",t._getGreen),t.RED,exports.cc.defineGetterSetter(t,"RED",t._getRed),t.MAGENTA,exports.cc.defineGetterSetter(t,"MAGENTA",t._getMagenta),t.BLACK,exports.cc.defineGetterSetter(t,"BLACK",t._getBlack),t.ORANGE,exports.cc.defineGetterSetter(t,"ORANGE",t._getOrange),t.GRAY,exports.cc.defineGetterSetter(t,"GRAY",t._getGray),exports.cc.BlendFunc._disable=function(){return new exports.cc.BlendFunc(exports.cc.ONE,exports.cc.ZERO)},exports.cc.BlendFunc._alphaPremultiplied=function(){return new exports.cc.BlendFunc(exports.cc.ONE,exports.cc.ONE_MINUS_SRC_ALPHA)},exports.cc.BlendFunc._alphaNonPremultiplied=function(){return new exports.cc.BlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE_MINUS_SRC_ALPHA)},exports.cc.BlendFunc._additive=function(){return new exports.cc.BlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE)},exports.cc.BlendFunc.DISABLE,exports.cc.defineGetterSetter(exports.cc.BlendFunc,"DISABLE",exports.cc.BlendFunc._disable),exports.cc.BlendFunc.ALPHA_PREMULTIPLIED,exports.cc.defineGetterSetter(exports.cc.BlendFunc,"ALPHA_PREMULTIPLIED",exports.cc.BlendFunc._alphaPremultiplied),exports.cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,exports.cc.defineGetterSetter(exports.cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",exports.cc.BlendFunc._alphaNonPremultiplied),exports.cc.BlendFunc.ADDITIVE,exports.cc.defineGetterSetter(exports.cc.BlendFunc,"ADDITIVE",exports.cc.BlendFunc._additive)};exports.cc=exports.cc||{};exports.cc._tmp=exports.cc._tmp||{};exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL){exports.cc.color=function(e,r,n,s,o,a){if(e===void 0)return new exports.cc.Color(0,0,0,255,o,a);if(exports.cc.isString(e)){var c=exports.cc.hexToColor(e);return new exports.cc.Color(c.r,c.g,c.b,c.a)}return exports.cc.isObject(e)?new exports.cc.Color(e.r,e.g,e.b,e.a,e.arrayBuffer,e.offset):new exports.cc.Color(e,r,n,s,o,a)},exports.cc.Color=function(e,r,n,s,o,a){this._arrayBuffer=o||new ArrayBuffer(exports.cc.Color.BYTES_PER_ELEMENT),this._offset=a||0;var c=this._arrayBuffer,l=this._offset;this._view=new Uint8Array(c,l,4),this._view[0]=e||0,this._view[1]=r||0,this._view[2]=n||0,this._view[3]=s==null?255:s,s===void 0&&(this.a_undefined=!0)},exports.cc.Color.BYTES_PER_ELEMENT=4;var t=exports.cc.Color.prototype;t._getR=function(){return this._view[0]},t._setR=function(e){this._view[0]=e<0?0:e},t._getG=function(){return this._view[1]},t._setG=function(e){this._view[1]=e<0?0:e},t._getB=function(){return this._view[2]},t._setB=function(e){this._view[2]=e<0?0:e},t._getA=function(){return this._view[3]},t._setA=function(e){this._view[3]=e<0?0:e},t.r,exports.cc.defineGetterSetter(t,"r",t._getR,t._setR),t.g,exports.cc.defineGetterSetter(t,"g",t._getG,t._setG),t.b,exports.cc.defineGetterSetter(t,"b",t._getB,t._setB),t.a,exports.cc.defineGetterSetter(t,"a",t._getA,t._setA),exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeColor),exports.cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),exports.cc._tmp.PrototypeColor(),delete exports.cc._tmp.PrototypeColor}});exports.cc.Color=function(t,e,r,n){this.r=t||0,this.g=e||0,this.b=r||0,this.a=n==null?255:n};exports.cc.color=function(t,e,r,n){return t===void 0?{r:0,g:0,b:0,a:255}:exports.cc.isString(t)?exports.cc.hexToColor(t):exports.cc.isObject(t)?{r:t.r,g:t.g,b:t.b,a:t.a==null?255:t.a}:{r:t,g:e,b:r,a:n==null?255:n}};exports.cc.colorEqual=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b};exports.cc.Acceleration=function(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.timestamp=n||0};exports.cc.Vertex2F=function(t,e,r,n){this._arrayBuffer=r||new ArrayBuffer(exports.cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0};exports.cc.Vertex2F.BYTES_PER_ELEMENT=8;_p=exports.cc.Vertex2F.prototype;_p._getX=function(){return this._view[0]};_p._setX=function(t){this._view[0]=t};_p._getY=function(){return this._view[1]};_p._setY=function(t){this._view[1]=t};_p.x;exports.cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);_p.y;exports.cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);exports.cc.Vertex3F=function(t,e,r,n,s){this._arrayBuffer=n||new ArrayBuffer(exports.cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._view=new Float32Array(o,a,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=r||0};exports.cc.Vertex3F.BYTES_PER_ELEMENT=12;_p=exports.cc.Vertex3F.prototype;_p._getX=function(){return this._view[0]};_p._setX=function(t){this._view[0]=t};_p._getY=function(){return this._view[1]};_p._setY=function(t){this._view[1]=t};_p._getZ=function(){return this._view[2]};_p._setZ=function(t){this._view[2]=t};_p.x;exports.cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);_p.y;exports.cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);_p.z;exports.cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ);exports.cc.Tex2F=function(t,e,r,n){this._arrayBuffer=r||new ArrayBuffer(exports.cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0};exports.cc.Tex2F.BYTES_PER_ELEMENT=8;_p=exports.cc.Tex2F.prototype;_p._getU=function(){return this._view[0]};_p._setU=function(t){this._view[0]=t};_p._getV=function(){return this._view[1]};_p._setV=function(t){this._view[1]=t};_p.u;exports.cc.defineGetterSetter(_p,"u",_p._getU,_p._setU);_p.v;exports.cc.defineGetterSetter(_p,"v",_p._getV,_p._setV);exports.cc.Quad2=function(t,e,r,n,s,o){this._arrayBuffer=s||new ArrayBuffer(exports.cc.Quad2.BYTES_PER_ELEMENT),this._offset=o||0;var a=this._arrayBuffer,c=this._offset,l=exports.cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new exports.cc.Vertex2F(t.x,t.y,a,c):new exports.cc.Vertex2F(0,0,a,c),c+=l,this._tr=e?new exports.cc.Vertex2F(e.x,e.y,a,c):new exports.cc.Vertex2F(0,0,a,c),c+=l,this._bl=r?new exports.cc.Vertex2F(r.x,r.y,a,c):new exports.cc.Vertex2F(0,0,a,c),c+=l,this._br=n?new exports.cc.Vertex2F(n.x,n.y,a,c):new exports.cc.Vertex2F(0,0,a,c)};exports.cc.Quad2.BYTES_PER_ELEMENT=32;_p=exports.cc.Quad2.prototype;_p._getTL=function(){return this._tl};_p._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y};_p._getTR=function(){return this._tr};_p._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y};_p._getBL=function(){return this._bl};_p._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y};_p._getBR=function(){return this._br};_p._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y};_p.tl;exports.cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);_p.tr;exports.cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);_p.bl;exports.cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);_p.br;exports.cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);exports.cc.Quad3=function(t,e,r,n,s,o){this._arrayBuffer=s||new ArrayBuffer(exports.cc.Quad3.BYTES_PER_ELEMENT),this._offset=o||0;var a=this._arrayBuffer,c=this._offset,l=exports.cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=t?new exports.cc.Vertex3F(t.x,t.y,t.z,a,c):new exports.cc.Vertex3F(0,0,0,a,c),c+=l,this.br=e?new exports.cc.Vertex3F(e.x,e.y,e.z,a,c):new exports.cc.Vertex3F(0,0,0,a,c),c+=l,this.tl=r?new exports.cc.Vertex3F(r.x,r.y,r.z,a,c):new exports.cc.Vertex3F(0,0,0,a,c),c+=l,this.tr=n?new exports.cc.Vertex3F(n.x,n.y,n.z,a,c):new exports.cc.Vertex3F(0,0,0,a,c)};exports.cc.Quad3.BYTES_PER_ELEMENT=48;exports.cc.V3F_C4B_T2F=function(t,e,r,n,s){this._arrayBuffer=n||new ArrayBuffer(exports.cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._vertices=t?new exports.cc.Vertex3F(t.x,t.y,t.z,o,a):new exports.cc.Vertex3F(0,0,0,o,a),a+=exports.cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new exports.cc.Color(e.r,e.g,e.b,e.a,o,a):new exports.cc.Color(0,0,0,0,o,a),a+=exports.cc.Color.BYTES_PER_ELEMENT,this._texCoords=r?new exports.cc.Tex2F(r.u,r.v,o,a):new exports.cc.Tex2F(0,0,o,a)};exports.cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24;_p=exports.cc.V3F_C4B_T2F.prototype;_p._getVertices=function(){return this._vertices};_p._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z};_p._getColor=function(){return this._colors};_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v};_p.vertices;exports.cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);_p.colors;exports.cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);_p.texCoords;exports.cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);exports.cc.V3F_C4B_T2F_Quad=function(t,e,r,n,s,o){this._arrayBuffer=s||new ArrayBuffer(exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=o||0;var a=this._arrayBuffer,c=this._offset,l=exports.cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new exports.cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,a,c):new exports.cc.V3F_C4B_T2F(null,null,null,a,c),c+=l,this._bl=e?new exports.cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,a,c):new exports.cc.V3F_C4B_T2F(null,null,null,a,c),c+=l,this._tr=r?new exports.cc.V3F_C4B_T2F(r.vertices,r.colors,r.texCoords,a,c):new exports.cc.V3F_C4B_T2F(null,null,null,a,c),c+=l,this._br=n?new exports.cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,a,c):new exports.cc.V3F_C4B_T2F(null,null,null,a,c)};exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96;_p=exports.cc.V3F_C4B_T2F_Quad.prototype;_p._getTL=function(){return this._tl};_p._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getBL=function(){return this._bl};_p._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getTR=function(){return this._tr};_p._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getBR=function(){return this._br};_p._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getArrayBuffer=function(){return this._arrayBuffer};_p.tl;exports.cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);_p.tr;exports.cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);_p.bl;exports.cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);_p.br;exports.cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);_p.arrayBuffer;exports.cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null);exports.cc.V3F_C4B_T2F_QuadZero=function(){return new exports.cc.V3F_C4B_T2F_Quad};exports.cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return exports.cc.V3F_C4B_T2F_QuadZero();var e=t.tl,r=t.bl,n=t.tr,s=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:s.vertices.x,y:s.vertices.y,z:s.vertices.z},colors:{r:s.colors.r,g:s.colors.g,b:s.colors.b,a:s.colors.a},texCoords:{u:s.texCoords.u,v:s.texCoords.v}}}};exports.cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],r=0;r<t.length;r++)e.push(exports.cc.V3F_C4B_T2F_QuadCopy(t[r]));return e};exports.cc.V2F_C4B_T2F=function(t,e,r,n,s){this._arrayBuffer=n||new ArrayBuffer(exports.cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._vertices=t?new exports.cc.Vertex2F(t.x,t.y,o,a):new exports.cc.Vertex2F(0,0,o,a),a+=exports.cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?exports.cc.color(e.r,e.g,e.b,e.a,o,a):exports.cc.color(0,0,0,0,o,a),a+=exports.cc.Color.BYTES_PER_ELEMENT,this._texCoords=r?new exports.cc.Tex2F(r.u,r.v,o,a):new exports.cc.Tex2F(0,0,o,a)};exports.cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20;_p=exports.cc.V2F_C4B_T2F.prototype;_p._getVertices=function(){return this._vertices};_p._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y};_p._getColor=function(){return this._colors};_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v};_p.vertices;exports.cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);_p.colors;exports.cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);_p.texCoords;exports.cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);exports.cc.V2F_C4B_T2F_Triangle=function(t,e,r,n,s){this._arrayBuffer=n||new ArrayBuffer(exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=exports.cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new exports.cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new exports.cc.V2F_C4B_T2F(null,null,null,o,a),a+=c,this._b=e?new exports.cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a):new exports.cc.V2F_C4B_T2F(null,null,null,o,a),a+=c,this._c=r?new exports.cc.V2F_C4B_T2F(r.vertices,r.colors,r.texCoords,o,a):new exports.cc.V2F_C4B_T2F(null,null,null,o,a)};exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60;_p=exports.cc.V2F_C4B_T2F_Triangle.prototype;_p._getA=function(){return this._a};_p._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getB=function(){return this._b};_p._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p._getC=function(){return this._c};_p._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords};_p.a;exports.cc.defineGetterSetter(_p,"a",_p._getA,_p._setA);_p.b;exports.cc.defineGetterSetter(_p,"b",_p._getB,_p._setB);_p.c;exports.cc.defineGetterSetter(_p,"c",_p._getC,_p._setC);exports.cc.vertex2=function(t,e){return new exports.cc.Vertex2F(t,e)};exports.cc.vertex3=function(t,e,r){return new exports.cc.Vertex3F(t,e,r)};exports.cc.tex2=function(t,e){return new exports.cc.Tex2F(t,e)};exports.cc.BlendFunc=function(t,e){this.src=t,this.dst=e};exports.cc.blendFuncDisable=function(){return new exports.cc.BlendFunc(exports.cc.ONE,exports.cc.ZERO)};exports.cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),r=e>>16,n=(e>>8)%256,s=e%256;return exports.cc.color(r,n,s)};exports.cc.colorToHex=function(t){var e=t.r.toString(16),r=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+r:r)+(t.b<16?"0"+n:n)};exports.cc.TEXT_ALIGNMENT_LEFT=0;exports.cc.TEXT_ALIGNMENT_CENTER=1;exports.cc.TEXT_ALIGNMENT_RIGHT=2;exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;exports.cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;exports.cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;exports.cc._Dictionary=exports.cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|Math.random()*10)},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(t,e){if(e!=null){var r=this.__getKey();this._keyMapTb[r]=e,this._valueMapTb[r]=t}},objectForKey:function(t){if(t==null)return null;var e=this._keyMapTb;for(var r in e)if(e[r]===t)return this._valueMapTb[r];return null},valueForKey:function(t){return this.objectForKey(t)},removeObjectForKey:function(t){if(t!=null){var e=this._keyMapTb;for(var r in e)if(e[r]===t){delete this._valueMapTb[r],delete e[r];return}}},removeObjectsForKeys:function(t){if(t!=null)for(var e=0;e<t.length;e++)this.removeObjectForKey(t[e])},allKeys:function(){var t=[],e=this._keyMapTb;for(var r in e)t.push(e[r]);return t},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}});exports.cc.FontDefinition=function(t){var e=this||window;if(e.fontName="Arial",e.fontSize=12,e.textAlign=exports.cc.TEXT_ALIGNMENT_CENTER,e.verticalAlign=exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP,e.fillStyle=exports.cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=exports.cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var r in t)e[r]=t[r]};exports.cc.FontDefinition.prototype._getCanvasFontStr=function(){var t=this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px";return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+t+" '"+this.fontName+"'"};exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS&&(exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeColor),exports.cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),exports.cc._tmp.PrototypeColor(),delete exports.cc._tmp.PrototypeColor)});exports.cc.Touches=[];exports.cc.TouchesIntergerDict={};exports.cc.DENSITYDPI_DEVICE="device-dpi";exports.cc.DENSITYDPI_HIGH="high-dpi";exports.cc.DENSITYDPI_MEDIUM="medium-dpi";exports.cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(t){return!t||t===this.html?window.innerWidth:t.clientWidth},availHeight:function(t){return!t||t===this.html?window.innerHeight:t.clientHeight},meta:{width:"device-width"},adaptationType:exports.cc.sys.browserType};window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(__BrowserGetter.adaptationType=exports.cc.sys.BROWSER_TYPE_MIUI);exports.cc.sys.os===exports.cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=exports.cc.sys.BROWSER_TYPE_SAFARI);switch(__BrowserGetter.adaptationType){case exports.cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true",__BrowserGetter.availWidth=function(t){return t.clientWidth},__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case exports.cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return exports.cc.view._targetDensityDPI});case exports.cc.sys.BROWSER_TYPE_SOUGOU:case exports.cc.sys.BROWSER_TYPE_UC:__BrowserGetter.availWidth=function(t){return t.clientWidth},__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case exports.cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}};break}var _scissorRect=exports.cc.rect();exports.cc.EGLView=exports.cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=document,r=exports.cc.ContainerStrategy,n=exports.cc.ContentStrategy;__BrowserGetter.init(this),t._frame=exports.cc.container.parentNode===e.body?e.documentElement:exports.cc.container.parentNode,t._frameSize=exports.cc.size(0,0),t._initFrameSize();var s=exports.cc._canvas.width,o=exports.cc._canvas.height;t._designResolutionSize=exports.cc.size(s,o),t._originalDesignResolutionSize=exports.cc.size(s,o),t._viewPortRect=exports.cc.rect(0,0,s,o),t._visibleRect=exports.cc.rect(0,0,s,o),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5";var a=exports.cc.sys;t.enableRetina(a.os===a.OS_IOS||a.os===a.OS_OSX),t.enableAutoFullScreen(a.isMobile&&a.browserType!==a.BROWSER_TYPE_BAIDU),exports.cc.visibleRect&&exports.cc.visibleRect.init(t._visibleRect),t._rpExactFit=new exports.cc.ResolutionPolicy(r.EQUAL_TO_FRAME,n.EXACT_FIT),t._rpShowAll=new exports.cc.ResolutionPolicy(r.PROPORTION_TO_FRAME,n.SHOW_ALL),t._rpNoBorder=new exports.cc.ResolutionPolicy(r.EQUAL_TO_FRAME,n.NO_BORDER),t._rpFixedHeight=new exports.cc.ResolutionPolicy(r.EQUAL_TO_FRAME,n.FIXED_HEIGHT),t._rpFixedWidth=new exports.cc.ResolutionPolicy(r.EQUAL_TO_FRAME,n.FIXED_WIDTH),t._targetDensityDPI=exports.cc.DENSITYDPI_HIGH},_resizeEvent:function(){var t;this.setDesignResolutionSize?t=this||window:t=exports.cc.view;var e=t._frameSize.width,r=t._frameSize.height,n=t._isRotated;if(t._initFrameSize(),!(t._isRotated===n&&t._frameSize.width===e&&t._frameSize.height===r)){t._resizeCallback&&t._resizeCallback.call();var s=t._originalDesignResolutionSize.width,o=t._originalDesignResolutionSize.height;s>0&&t.setDesignResolutionSize(s,o,t._resolutionPolicy)}},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){(exports.cc.isFunction(t)||t==null)&&(this._resizeCallback=t)},setOrientation:function(t){t=t&exports.cc.ORIENTATION_AUTO,t&&(this._orientation=t)},_initFrameSize:function(){var t=this._frameSize,e=__BrowserGetter.availWidth(this._frame),r=__BrowserGetter.availHeight(this._frame),n=e>=r;!exports.cc.sys.isMobile||n&&this._orientation&exports.cc.ORIENTATION_LANDSCAPE||!n&&this._orientation&exports.cc.ORIENTATION_PORTRAIT?(t.width=e,t.height=r,exports.cc.container.style["-webkit-transform"]="rotate(0deg)",exports.cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=r,t.height=e,exports.cc.container.style["-webkit-transform"]="rotate(90deg)",exports.cc.container.style.transform="rotate(90deg)",exports.cc.container.style["-webkit-transform-origin"]="0px 0px 0px",exports.cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var r=document.getElementById("cocosMetaElement");r&&e&&document.head.removeChild(r);var n=document.getElementsByName("viewport"),s=n?n[0]:null,o,a,c;o=s?s.content:"",r=r||document.createElement("meta"),r.id="cocosMetaElement",r.name="viewport",r.content="";for(a in t)o.indexOf(a)==-1?o+=","+a+"="+t[a]:e&&(c=new RegExp(a+"s*=s*[^,]+"),o.replace(c,a+"="+t[a]));/^,/.test(o)&&(o=o.substr(1)),r.content=o,s&&(s.content=o),document.head.appendChild(r)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var t=exports.cc.contentScaleFactor();this._scaleX=t,this._scaleY=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&exports.cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=!0,exports.cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return exports.cc.game.canvas&&exports.cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),exports.cc.director.setProjection(exports.cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return exports.cc.size(exports.cc._canvas.width,exports.cc._canvas.height)},getFrameSize:function(){return exports.cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,this._frame.style.width=t+"px",this._frame.style.height=e+"px",this._resizeEvent(),exports.cc.director.setProjection(exports.cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return exports.cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return exports.cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return exports.cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return exports.cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this||window;if(t instanceof exports.cc.ResolutionPolicy)e._resolutionPolicy=t;else{var r=exports.cc.ResolutionPolicy;t===r.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===r.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===r.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===r.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===r.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,r){if(!(t>0||e>0)){exports.cc.log(exports.cc._LogInfos.EGLView_setDesignResolutionSize);return}this.setResolutionPolicy(r);var n=this._resolutionPolicy;if(!n){exports.cc.log(exports.cc._LogInfos.EGLView_setDesignResolutionSize_2);return}n.preApply(this),exports.cc.sys.isMobile&&this._adjustViewportMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var s=n.apply(this,this._designResolutionSize);if(s.scale&&s.scale.length===2&&(this._scaleX=s.scale[0],this._scaleY=s.scale[1]),s.viewport){var o=this._viewPortRect,a=this._visibleRect,c=s.viewport;o.x=c.x,o.y=c.y,o.width=c.width,o.height=c.height,a.x=-o.x/this._scaleX,a.y=-o.y/this._scaleY,a.width=exports.cc._canvas.width/this._scaleX,a.height=exports.cc._canvas.height/this._scaleY,exports.cc._renderContext.setOffset&&exports.cc._renderContext.setOffset(o.x,-o.y)}var l=exports.cc.director;l._winSizeInPoints.width=this._designResolutionSize.width,l._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),exports.cc.winSize.width=l._winSizeInPoints.width,exports.cc.winSize.height=l._winSizeInPoints.height,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&l.setGLDefaultValues(),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,exports.cc.DOM&&exports.cc.DOM._resetEGLViewDiv(),exports.cc.visibleRect&&exports.cc.visibleRect.init(this._visibleRect)},getDesignResolutionSize:function(){return exports.cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,r){this._setViewportMeta({width:t,"target-densitydpi":exports.cc.DENSITYDPI_DEVICE},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,e,r)},setViewPortInPoints:function(t,e,r,n){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;exports.cc._renderContext.viewport(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,r*o*s,n*a*s)},setScissorInPoints:function(t,e,r,n){var s=this._frameZoomFactor,o=this._scaleX,a=this._scaleY;_scissorRect.x=t,_scissorRect.y=e,_scissorRect.width=r,_scissorRect.height=n,exports.cc._renderContext.scissor(t*o*s+this._viewPortRect.x*s,e*a*s+this._viewPortRect.y*s,r*o*s,n*a*s)},isScissorEnabled:function(){return exports.cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return exports.cc.rect(_scissorRect)},setViewName:function(t){t!=null&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,r){var n=this._devicePixelRatio*(t-r.left),s=this._devicePixelRatio*(r.top+r.height-e);return this._isRotated?{x:this._viewPortRect.width-s,y:n}:{x:n,y:s}},_convertMouseToLocationInView:function(t,e){var r=this._viewPortRect,n=this||window;t.x=(n._devicePixelRatio*(t.x-e.left)-r.x)/n._scaleX,t.y=(n._devicePixelRatio*(e.top+e.height-t.y)-r.y)/n._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e=this._viewPortRect,r=this._scaleX,n=this._scaleY,s,o,a,c=0;c<t.length;c++)s=t[c],o=s._point,a=s._prevPoint,o.x=(o.x-e.x)/r,o.y=(o.y-e.y)/n,a.x=(a.x-e.x)/r,a.y=(a.y-e.y)/n}});exports.cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new exports.cc.EGLView,this._instance.initialize()),this._instance};exports.cc.ContainerStrategy=exports.cc.Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,r){var n=exports.cc.game.canvas,s=exports.cc.game.container;s.style.width=n.style.width=e+"px",s.style.height=n.style.height=r+"px";var o=t._devicePixelRatio=1;t.isRetinaEnabled()&&(o=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*o,n.height=r*o,exports.cc._renderContext.resetCache&&exports.cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(exports.cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=exports.cc.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}});exports.cc.ContentStrategy=exports.cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,r,n,s,o){Math.abs(t-r)<2&&(r=t),Math.abs(e-n)<2&&(n=e);var a=exports.cc.rect(Math.round((t-r)/2),Math.round((e-n)/2),r,n);return exports.cc._renderType,exports.cc.game.RENDER_TYPE_CANVAS,this._result.scale=[s,o],this._result.viewport=a,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}});(function(){var t=exports.cc.ContainerStrategy.extend({apply:function(l){var h=l._frameSize.height,u=exports.cc.container.style;this._setupContainer(l,l._frameSize.width,l._frameSize.height),l._isRotated?u.marginLeft=h+"px":u.margin="0px"}}),e=exports.cc.ContainerStrategy.extend({apply:function(l,h){var u=l._frameSize.width,_=l._frameSize.height,d=exports.cc.container.style,f=h.width,T=h.height,x=u/f,m=_/T,v,A;x<m?(v=u,A=T*x):(v=f*m,A=_);var D=Math.round((u-v)/2),N=Math.round((_-A)/2);v=u-2*D,A=_-2*N,this._setupContainer(l,v,A),l._isRotated?d.marginLeft=_+"px":d.margin="0px",d.paddingLeft=D+"px",d.paddingRight=D+"px",d.paddingTop=N+"px",d.paddingBottom=N+"px"}});t.extend({preApply:function(l){this._super(l),l._frame=document.documentElement},apply:function(l){this._super(l),this._fixContainer()}}),e.extend({preApply:function(l){this._super(l),l._frame=document.documentElement},apply:function(l,h){this._super(l,h),this._fixContainer()}});var r=exports.cc.ContainerStrategy.extend({apply:function(l){this._setupContainer(l,exports.cc._canvas.width,exports.cc._canvas.height)}});exports.cc.ContainerStrategy.EQUAL_TO_FRAME=new t,exports.cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,exports.cc.ContainerStrategy.ORIGINAL_CONTAINER=new r;var n=exports.cc.ContentStrategy.extend({apply:function(l,h){var u=exports.cc._canvas.width,_=exports.cc._canvas.height,d=u/h.width,f=_/h.height;return this._buildResult(u,_,u,_,d,f)}}),s=exports.cc.ContentStrategy.extend({apply:function(l,h){var u=exports.cc._canvas.width,_=exports.cc._canvas.height,d=h.width,f=h.height,T=u/d,x=_/f,m=0,v,A;return T<x?(m=T,v=u,A=f*m):(m=x,v=d*m,A=_),this._buildResult(u,_,v,A,m,m)}}),o=exports.cc.ContentStrategy.extend({apply:function(l,h){var u=exports.cc._canvas.width,_=exports.cc._canvas.height,d=h.width,f=h.height,T=u/d,x=_/f,m,v,A;return T<x?(m=x,v=d*m,A=_):(m=T,v=u,A=f*m),this._buildResult(u,_,v,A,m,m)}}),a=exports.cc.ContentStrategy.extend({apply:function(l,h){var u=exports.cc._canvas.width,_=exports.cc._canvas.height,d=h.height,f=_/d,T=u,x=_;return this._buildResult(u,_,T,x,f,f)},postApply:function(l){exports.cc.director._winSizeInPoints=l.getVisibleSize()}}),c=exports.cc.ContentStrategy.extend({apply:function(l,h){var u=exports.cc._canvas.width,_=exports.cc._canvas.height,d=h.width,f=u/d,T=u,x=_;return this._buildResult(u,_,T,x,f,f)},postApply:function(l){exports.cc.director._winSizeInPoints=l.getVisibleSize()}});exports.cc.ContentStrategy.EXACT_FIT=new n,exports.cc.ContentStrategy.SHOW_ALL=new s,exports.cc.ContentStrategy.NO_BORDER=new o,exports.cc.ContentStrategy.FIXED_HEIGHT=new a,exports.cc.ContentStrategy.FIXED_WIDTH=new c})();exports.cc.ResolutionPolicy=exports.cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof exports.cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof exports.cc.ContentStrategy&&(this._contentStrategy=t)}});exports.cc.ResolutionPolicy.EXACT_FIT=0;exports.cc.ResolutionPolicy.NO_BORDER=1;exports.cc.ResolutionPolicy.SHOW_ALL=2;exports.cc.ResolutionPolicy.FIXED_HEIGHT=3;exports.cc.ResolutionPolicy.FIXED_WIDTH=4;exports.cc.ResolutionPolicy.UNKNOWN=5;exports.cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,r=this._fnMap,n,s;for(t=0,s=r.length;t<s;t++)if(e=r[t],e&&e[1]in document){for(t=0,n=e.length;t<n;t++)this._fn[r[0][t]]=e[t];break}this._supportsFullScreen=typeof this._fn.requestFullscreen!="undefined",this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen?!(document[this._fn.fullscreenElement]===void 0||document[this._fn.fullscreenElement]===null):!1},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var r=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(r,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(r,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(t,e){t=t||document.body;var r=exports.cc.game.canvas||t,n=this||window;function s(){r.removeEventListener(n._touchEvent,s),n.requestFullScreen(t,e)}this.requestFullScreen(t,e),r.addEventListener(this._touchEvent,s)}};exports.cc.screen.init();exports.cc.visibleRect={topLeft:exports.cc.p(0,0),topRight:exports.cc.p(0,0),top:exports.cc.p(0,0),bottomLeft:exports.cc.p(0,0),bottomRight:exports.cc.p(0,0),bottom:exports.cc.p(0,0),center:exports.cc.p(0,0),left:exports.cc.p(0,0),right:exports.cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,r=this.height=t.height,n=t.x,s=t.y,o=s+r,a=n+e;this.topLeft.x=n,this.topLeft.y=o,this.topRight.x=a,this.topRight.y=o,this.top.x=n+e/2,this.top.y=o,this.bottomLeft.x=n,this.bottomLeft.y=s,this.bottomRight.x=a,this.bottomRight.y=s,this.bottom.x=n+e/2,this.bottom.y=s,this.center.x=n+e/2,this.center.y=s+r/2,this.left.x=n,this.left.y=s+r/2,this.right.x=a,this.right.y=s+r/2}};exports.cc.UIInterfaceOrientationLandscapeLeft=-90;exports.cc.UIInterfaceOrientationLandscapeRight=90;exports.cc.UIInterfaceOrientationPortraitUpsideDown=180;exports.cc.UIInterfaceOrientationPortrait=0;exports.cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:exports.cc.p(0,0),_prevMousePoint:exports.cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(t&1))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,r,n,s,o=[],a=this._touchesIntegerDict,c=0,l=t.length;c<l;c++)if(e=t[c],s=e.getID(),r=a[s],r==null){var h=this._getUnUsedIndex();if(h===-1){exports.cc.log(exports.cc._LogInfos.inputManager_handleTouchesBegin,h);continue}n=this._touches[h]=new exports.cc.Touch(e._point.x,e._point.y,e.getID()),n._setPrevPoint(e._prevPoint),a[s]=h,o.push(n)}if(o.length>0){this._glView._convertTouchesWithScale(o);var u=new exports.cc.EventTouch(o);u._eventCode=exports.cc.EventTouch.EventCode.BEGAN,exports.cc.eventManager.dispatchEvent(u)}},handleTouchesMove:function(t){for(var e,r,n,s=[],o=this._touches,a=0,c=t.length;a<c;a++)e=t[a],n=e.getID(),r=this._touchesIntegerDict[n],r!=null&&o[r]&&(o[r]._setPoint(e._point),o[r]._setPrevPoint(e._prevPoint),s.push(o[r]));if(s.length>0){this._glView._convertTouchesWithScale(s);var l=new exports.cc.EventTouch(s);l._eventCode=exports.cc.EventTouch.EventCode.MOVED,exports.cc.eventManager.dispatchEvent(l)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var r=new exports.cc.EventTouch(e);r._eventCode=exports.cc.EventTouch.EventCode.ENDED,exports.cc.eventManager.dispatchEvent(r)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var r=new exports.cc.EventTouch(e);r._eventCode=exports.cc.EventTouch.EventCode.CANCELLED,exports.cc.eventManager.dispatchEvent(r)}},getSetOfTouchesEndOrCancel:function(t){for(var e,r,n,s=[],o=this._touches,a=this._touchesIntegerDict,c=0,l=t.length;c<l;c++)e=t[c],n=e.getID(),r=a[n],r!=null&&o[r]&&(o[r]._setPoint(e._point),o[r]._setPrevPoint(e._prevPoint),s.push(o[r]),this._removeUsedIndexBit(r),delete a[n]);return s},getHTMLElementPosition:function(t){var e=document.documentElement,r=window,n=null;return exports.cc.isFunction(t.getBoundingClientRect)?n=t.getBoundingClientRect():n={left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)},{left:n.left+r.pageXOffset-e.clientLeft,top:n.top+r.pageYOffset-e.clientTop,width:n.width,height:n.height}},getPreTouch:function(t){for(var e=null,r=this._preTouchPool,n=t.getID(),s=r.length-1;s>=0;s--)if(r[s].getID()===n){e=r[s];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,r=this._preTouchPool,n=t.getID(),s=r.length-1;s>=0;s--)if(r[s].getID()===n){r[s]=t,e=!0;break}e||(r.length<=50?r.push(t):(r[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,r){var n=this._preTouchPoint,s=this._glView.convertToLocationInView(t,e,r),o=new exports.cc.Touch(s.x,s.y);return o._setPrevPoint(n.x,n.y),n.x=s.x,n.y=s.y,o},getMouseEvent:function(t,e,r){var n=this._prevMousePoint;this._glView._convertMouseToLocationInView(t,e);var s=new exports.cc.EventMouse(r);return s.setLocation(t.x,t.y),s._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,s},getPointByEvent:function(t,e){return t.pageX!=null?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var r=[],n=this._glView,s,o,a,c=this._preTouchPoint,l=t.changedTouches.length,h=0;h<l;h++)if(s=t.changedTouches[h],s){var u;exports.cc.sys.BROWSER_TYPE_FIREFOX===exports.cc.sys.browserType?u=n.convertToLocationInView(s.pageX,s.pageY,e):u=n.convertToLocationInView(s.clientX,s.clientY,e),s.identifier!=null?(o=new exports.cc.Touch(u.x,u.y,s.identifier),a=this.getPreTouch(o).getLocation(),o._setPrevPoint(a.x,a.y),this.setPreTouch(o)):(o=new exports.cc.Touch(u.x,u.y),o._setPrevPoint(c.x,c.y)),c.x=u.x,c.y=u.y,r.push(o)}return r},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=exports.cc.view;var e=this||window,r="mouse"in exports.cc.sys.capabilities,n="touches"in exports.cc.sys.capabilities,s=!1;if(exports.cc.sys.isMobile&&(s=!0),r&&(window.addEventListener("mousedown",function(){e._mousePressed=!0},!1),window.addEventListener("mouseup",function(c){if(!s){var l=e._mousePressed;if(e._mousePressed=!1,!!l){var h=e.getHTMLElementPosition(t),u=e.getPointByEvent(c,h);if(!exports.cc.rectContainsPoint(new exports.cc.Rect(h.left,h.top,h.width,h.height),u)){e.handleTouchesEnd([e.getTouchByXY(u.x,u.y,h)]);var _=e.getMouseEvent(u,h,exports.cc.EventMouse.UP);_.setButton(c.button),exports.cc.eventManager.dispatchEvent(_)}}}},!1),t.addEventListener("mousedown",function(c){if(!s){e._mousePressed=!0;var l=e.getHTMLElementPosition(t),h=e.getPointByEvent(c,l);e.handleTouchesBegin([e.getTouchByXY(h.x,h.y,l)]);var u=e.getMouseEvent(h,l,exports.cc.EventMouse.DOWN);u.setButton(c.button),exports.cc.eventManager.dispatchEvent(u),c.stopPropagation(),c.preventDefault(),t.focus()}},!1),t.addEventListener("mouseup",function(c){if(!s){e._mousePressed=!1;var l=e.getHTMLElementPosition(t),h=e.getPointByEvent(c,l);e.handleTouchesEnd([e.getTouchByXY(h.x,h.y,l)]);var u=e.getMouseEvent(h,l,exports.cc.EventMouse.UP);u.setButton(c.button),exports.cc.eventManager.dispatchEvent(u),c.stopPropagation(),c.preventDefault()}},!1),t.addEventListener("mousemove",function(c){if(!s){var l=e.getHTMLElementPosition(t),h=e.getPointByEvent(c,l);e.handleTouchesMove([e.getTouchByXY(h.x,h.y,l)]);var u=e.getMouseEvent(h,l,exports.cc.EventMouse.MOVE);e._mousePressed?u.setButton(c.button):u.setButton(null),exports.cc.eventManager.dispatchEvent(u),c.stopPropagation(),c.preventDefault()}},!1),t.addEventListener("mousewheel",function(c){var l=e.getHTMLElementPosition(t),h=e.getPointByEvent(c,l),u=e.getMouseEvent(h,l,exports.cc.EventMouse.SCROLL);u.setButton(c.button),u.setScrollData(0,c.wheelDelta),exports.cc.eventManager.dispatchEvent(u),c.stopPropagation(),c.preventDefault()},!1),t.addEventListener("DOMMouseScroll",function(c){var l=e.getHTMLElementPosition(t),h=e.getPointByEvent(c,l),u=e.getMouseEvent(h,l,exports.cc.EventMouse.SCROLL);u.setButton(c.button),u.setScrollData(0,c.detail*-120),exports.cc.eventManager.dispatchEvent(u),c.stopPropagation(),c.preventDefault()},!1)),window.navigator.msPointerEnabled){var o={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel};for(var a in o)(function(c,l){t.addEventListener(c,function(h){var u=e.getHTMLElementPosition(t);u.left-=document.documentElement.scrollLeft,u.top-=document.documentElement.scrollTop,l.call(e,[e.getTouchByXY(h.clientX,h.clientY,u)]),h.stopPropagation()},!1)})(a,o[a])}n&&(t.addEventListener("touchstart",function(c){if(c.changedTouches){var l=e.getHTMLElementPosition(t);l.left-=document.body.scrollLeft,l.top-=document.body.scrollTop,e.handleTouchesBegin(e.getTouchesByEvent(c,l)),c.stopPropagation(),c.preventDefault(),t.focus()}},!1),t.addEventListener("touchmove",function(c){if(c.changedTouches){var l=e.getHTMLElementPosition(t);l.left-=document.body.scrollLeft,l.top-=document.body.scrollTop,e.handleTouchesMove(e.getTouchesByEvent(c,l)),c.stopPropagation(),c.preventDefault()}},!1),t.addEventListener("touchend",function(c){if(c.changedTouches){var l=e.getHTMLElementPosition(t);l.left-=document.body.scrollLeft,l.top-=document.body.scrollTop,e.handleTouchesEnd(e.getTouchesByEvent(c,l)),c.stopPropagation(),c.preventDefault()}},!1),t.addEventListener("touchcancel",function(c){if(c.changedTouches){var l=e.getHTMLElementPosition(t);l.left-=document.body.scrollLeft,l.top-=document.body.scrollTop,e.handleTouchesCancel(e.getTouchesByEvent(c,l)),c.stopPropagation(),c.preventDefault()}},!1)),this._registerKeyboardEvent(),this._registerAccelerometerEvent(),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,exports.cc.eventManager.dispatchEvent(new exports.cc.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};exports.cc.AffineTransform=function(t,e,r,n,s,o){this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o};exports.cc.affineTransformMake=function(t,e,r,n,s,o){return{a:t,b:e,c:r,d:n,tx:s,ty:o}};exports.cc.pointApplyAffineTransform=function(t,e,r){var n,s;return r===void 0?(r=e,n=t.x,s=t.y):(n=t,s=e),{x:r.a*n+r.c*s+r.tx,y:r.b*n+r.d*s+r.ty}};exports.cc._pointApplyAffineTransform=function(t,e,r){return exports.cc.pointApplyAffineTransform(t,e,r)};exports.cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}};exports.cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};exports.cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};exports.cc.rectApplyAffineTransform=function(t,e){var r=exports.cc.rectGetMinY(t),n=exports.cc.rectGetMinX(t),s=exports.cc.rectGetMaxX(t),o=exports.cc.rectGetMaxY(t),a=exports.cc.pointApplyAffineTransform(n,r,e),c=exports.cc.pointApplyAffineTransform(s,r,e),l=exports.cc.pointApplyAffineTransform(n,o,e),h=exports.cc.pointApplyAffineTransform(s,o,e),u=Math.min(a.x,c.x,l.x,h.x),_=Math.max(a.x,c.x,l.x,h.x),d=Math.min(a.y,c.y,l.y,h.y),f=Math.max(a.y,c.y,l.y,h.y);return exports.cc.rect(u,d,_-u,f-d)};exports.cc._rectApplyAffineTransformIn=function(t,e){var r=exports.cc.rectGetMinY(t),n=exports.cc.rectGetMinX(t),s=exports.cc.rectGetMaxX(t),o=exports.cc.rectGetMaxY(t),a=exports.cc.pointApplyAffineTransform(n,r,e),c=exports.cc.pointApplyAffineTransform(s,r,e),l=exports.cc.pointApplyAffineTransform(n,o,e),h=exports.cc.pointApplyAffineTransform(s,o,e),u=Math.min(a.x,c.x,l.x,h.x),_=Math.max(a.x,c.x,l.x,h.x),d=Math.min(a.y,c.y,l.y,h.y),f=Math.max(a.y,c.y,l.y,h.y);return t.x=u,t.y=d,t.width=_-u,t.height=f-d,t};exports.cc.affineTransformTranslate=function(t,e,r){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*r,ty:t.ty+t.b*e+t.d*r}};exports.cc.affineTransformScale=function(t,e,r){return{a:t.a*e,b:t.b*e,c:t.c*r,d:t.d*r,tx:t.tx,ty:t.ty}};exports.cc.affineTransformRotate=function(t,e){var r=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*r,b:t.b*n+t.d*r,c:t.c*n-t.a*r,d:t.d*n-t.b*r,tx:t.tx,ty:t.ty}};exports.cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}};exports.cc.affineTransformConcatIn=function(t,e){var r=t.a,n=t.b,s=t.c,o=t.d,a=t.tx,c=t.ty;return t.a=r*e.a+n*e.c,t.b=r*e.b+n*e.d,t.c=s*e.a+o*e.c,t.d=s*e.b+o*e.d,t.tx=a*e.a+c*e.c+e.tx,t.ty=a*e.b+c*e.d+e.ty,t};exports.cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty};exports.cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}};exports.cc.POINT_EPSILON=parseFloat("1.192092896e-07F");exports.cc.pNeg=function(t){return exports.cc.p(-t.x,-t.y)};exports.cc.pAdd=function(t,e){return exports.cc.p(t.x+e.x,t.y+e.y)};exports.cc.pSub=function(t,e){return exports.cc.p(t.x-e.x,t.y-e.y)};exports.cc.pMult=function(t,e){return exports.cc.p(t.x*e,t.y*e)};exports.cc.pMidpoint=function(t,e){return exports.cc.pMult(exports.cc.pAdd(t,e),.5)};exports.cc.pDot=function(t,e){return t.x*e.x+t.y*e.y};exports.cc.pCross=function(t,e){return t.x*e.y-t.y*e.x};exports.cc.pPerp=function(t){return exports.cc.p(-t.y,t.x)};exports.cc.pRPerp=function(t){return exports.cc.p(t.y,-t.x)};exports.cc.pProject=function(t,e){return exports.cc.pMult(e,exports.cc.pDot(t,e)/exports.cc.pDot(e,e))};exports.cc.pRotate=function(t,e){return exports.cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)};exports.cc.pUnrotate=function(t,e){return exports.cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)};exports.cc.pLengthSQ=function(t){return exports.cc.pDot(t,t)};exports.cc.pDistanceSQ=function(t,e){return exports.cc.pLengthSQ(exports.cc.pSub(t,e))};exports.cc.pLength=function(t){return Math.sqrt(exports.cc.pLengthSQ(t))};exports.cc.pDistance=function(t,e){return exports.cc.pLength(exports.cc.pSub(t,e))};exports.cc.pNormalize=function(t){var e=exports.cc.pLength(t);return e===0?exports.cc.p(t):exports.cc.pMult(t,1/e)};exports.cc.pForAngle=function(t){return exports.cc.p(Math.cos(t),Math.sin(t))};exports.cc.pToAngle=function(t){return Math.atan2(t.y,t.x)};exports.cc.clampf=function(t,e,r){if(e>r){var n=e;e=r,r=n}return t<e?e:t<r?t:r};exports.cc.pClamp=function(t,e,r){return exports.cc.p(exports.cc.clampf(t.x,e.x,r.x),exports.cc.clampf(t.y,e.y,r.y))};exports.cc.pFromSize=function(t){return exports.cc.p(t.width,t.height)};exports.cc.pCompOp=function(t,e){return exports.cc.p(e(t.x),e(t.y))};exports.cc.pLerp=function(t,e,r){return exports.cc.pAdd(exports.cc.pMult(t,1-r),exports.cc.pMult(e,r))};exports.cc.pFuzzyEqual=function(t,e,r){return t.x-r<=e.x&&e.x<=t.x+r&&t.y-r<=e.y&&e.y<=t.y+r};exports.cc.pCompMult=function(t,e){return exports.cc.p(t.x*e.x,t.y*e.y)};exports.cc.pAngleSigned=function(t,e){var r=exports.cc.pNormalize(t),n=exports.cc.pNormalize(e),s=Math.atan2(r.x*n.y-r.y*n.x,exports.cc.pDot(r,n));return Math.abs(s)<exports.cc.POINT_EPSILON?0:s};exports.cc.pAngle=function(t,e){var r=Math.acos(exports.cc.pDot(exports.cc.pNormalize(t),exports.cc.pNormalize(e)));return Math.abs(r)<exports.cc.POINT_EPSILON?0:r};exports.cc.pRotateByAngle=function(t,e,r){var n=exports.cc.pSub(t,e),s=Math.cos(r),o=Math.sin(r),a=n.x;return n.x=a*s-n.y*o+e.x,n.y=a*o+n.y*s+e.y,n};exports.cc.pLineIntersect=function(t,e,r,n,s){if(t.x===e.x&&t.y===e.y||r.x===n.x&&r.y===n.y)return!1;var o=e.x-t.x,a=e.y-t.y,c=n.x-r.x,l=n.y-r.y,h=t.x-r.x,u=t.y-r.y,_=l*o-c*a;return s.x=c*u-l*h,s.y=o*u-a*h,_===0?s.x===0||s.y===0:(s.x=s.x/_,s.y=s.y/_,!0)};exports.cc.pSegmentIntersect=function(t,e,r,n){var s=exports.cc.p(0,0);return!!(exports.cc.pLineIntersect(t,e,r,n,s)&&s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1)};exports.cc.pIntersectPoint=function(t,e,r,n){var s=exports.cc.p(0,0);if(exports.cc.pLineIntersect(t,e,r,n,s)){var o=exports.cc.p(0,0);return o.x=t.x+s.x*(e.x-t.x),o.y=t.y+s.x*(e.y-t.y),o}return exports.cc.p(0,0)};exports.cc.pSameAs=function(t,e){return t!=null&&e!=null?t.x===e.x&&t.y===e.y:!1};exports.cc.pZeroIn=function(t){t.x=0,t.y=0};exports.cc.pIn=function(t,e){t.x=e.x,t.y=e.y};exports.cc.pMultIn=function(t,e){t.x*=e,t.y*=e};exports.cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y};exports.cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y};exports.cc.pNormalizeIn=function(t){exports.cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))};exports.cc.Touch=exports.cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,r){this.setTouchInfo(r,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return exports.cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return exports.cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,r){this._prevPoint=this._point,this._point=exports.cc.p(e||0,r||0),this._id=t,this._startPointCaptured||(this._startPoint=exports.cc.p(this._point),exports.cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){e===void 0?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){e===void 0?this._prevPoint=exports.cc.p(t.x,t.y):this._prevPoint=exports.cc.p(t||0,e||0)}});exports.cc.Event=exports.cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});exports.cc.Event.TOUCH=0;exports.cc.Event.KEYBOARD=1;exports.cc.Event.ACCELERATION=2;exports.cc.Event.MOUSE=3;exports.cc.Event.FOCUS=4;exports.cc.Event.CUSTOM=6;exports.cc.EventCustom=exports.cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.CUSTOM),this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});exports.cc.EventMouse=exports.cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.MOUSE),this._eventType=t},setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:exports.cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});exports.cc.EventMouse.NONE=0;exports.cc.EventMouse.DOWN=1;exports.cc.EventMouse.UP=2;exports.cc.EventMouse.MOVE=3;exports.cc.EventMouse.SCROLL=4;exports.cc.EventMouse.BUTTON_LEFT=0;exports.cc.EventMouse.BUTTON_RIGHT=2;exports.cc.EventMouse.BUTTON_MIDDLE=1;exports.cc.EventMouse.BUTTON_4=3;exports.cc.EventMouse.BUTTON_5=4;exports.cc.EventMouse.BUTTON_6=5;exports.cc.EventMouse.BUTTON_7=6;exports.cc.EventMouse.BUTTON_8=7;exports.cc.EventTouch=exports.cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.TOUCH),this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}});exports.cc.EventTouch.MAX_TOUCHES=5;exports.cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};exports.cc.EventFocus=exports.cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.FOCUS),this._widgetGetFocus=e,this._widgetLoseFocus=t}});exports.cc.EventListener=exports.cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,r){this._onEvent=r,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return this._onEvent!==null},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});exports.cc.EventListener.UNKNOWN=0;exports.cc.EventListener.TOUCH_ONE_BY_ONE=1;exports.cc.EventListener.TOUCH_ALL_AT_ONCE=2;exports.cc.EventListener.KEYBOARD=3;exports.cc.EventListener.MOUSE=4;exports.cc.EventListener.ACCELERATION=6;exports.cc.EventListener.FOCUS=7;exports.cc.EventListener.CUSTOM=8;exports.cc._EventListenerCustom=exports.cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var r=this||window,n=function(s){r._onCustomEvent!==null&&r._onCustomEvent(s)};exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.CUSTOM,t,n)},checkAvailable:function(){return exports.cc.EventListener.prototype.checkAvailable.call(this)&&this._onCustomEvent!==null},clone:function(){return new exports.cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});exports.cc._EventListenerCustom.create=function(t,e){return new exports.cc._EventListenerCustom(t,e)};exports.cc._EventListenerMouse=exports.cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var t=this||window,e=function(r){var n=exports.cc.EventMouse;switch(r._eventType){case n.DOWN:t.onMouseDown&&t.onMouseDown(r);break;case n.UP:t.onMouseUp&&t.onMouseUp(r);break;case n.MOVE:t.onMouseMove&&t.onMouseMove(r);break;case n.SCROLL:t.onMouseScroll&&t.onMouseScroll(r);break}};exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.MOUSE,exports.cc._EventListenerMouse.LISTENER_ID,e)},clone:function(){var t=new exports.cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}});exports.cc._EventListenerMouse.LISTENER_ID="__cc_mouse";exports.cc._EventListenerMouse.create=function(){return new exports.cc._EventListenerMouse};exports.cc._EventListenerTouchOneByOne=exports.cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.TOUCH_ONE_BY_ONE,exports.cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new exports.cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return this.onTouchBegan?!0:(exports.cc.log(exports.cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}});exports.cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";exports.cc._EventListenerTouchOneByOne.create=function(){return new exports.cc._EventListenerTouchOneByOne};exports.cc._EventListenerTouchAllAtOnce=exports.cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.TOUCH_ALL_AT_ONCE,exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new exports.cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return this.onTouchesBegan===null&&this.onTouchesMoved===null&&this.onTouchesEnded===null&&this.onTouchesCancelled===null?(exports.cc.log(exports.cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";exports.cc._EventListenerTouchAllAtOnce.create=function(){return new exports.cc._EventListenerTouchAllAtOnce};exports.cc.EventListener.create=function(t){exports.cc.assert(t&&t.event,exports.cc._LogInfos.EventListener_create);var e=t.event;delete t.event;var r=null;e===exports.cc.EventListener.TOUCH_ONE_BY_ONE?r=new exports.cc._EventListenerTouchOneByOne:e===exports.cc.EventListener.TOUCH_ALL_AT_ONCE?r=new exports.cc._EventListenerTouchAllAtOnce:e===exports.cc.EventListener.MOUSE?r=new exports.cc._EventListenerMouse:e===exports.cc.EventListener.CUSTOM?(r=new exports.cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===exports.cc.EventListener.KEYBOARD?r=new exports.cc._EventListenerKeyboard:e===exports.cc.EventListener.ACCELERATION?(r=new exports.cc._EventListenerAcceleration(t.callback),delete t.callback):e===exports.cc.EventListener.FOCUS&&(r=new exports.cc._EventListenerFocus);for(var n in t)r[n]=t[n];return r};exports.cc._EventListenerFocus=exports.cc.EventListener.extend({clone:function(){var t=new exports.cc._EventListenerFocus;return t.onFocusChanged=this.onFocusChanged,t},checkAvailable:function(){return this.onFocusChanged?!0:(exports.cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){var t=function(e){this.onFocusChanged&&this.onFocusChanged(e._widgetLoseFocus,e._widgetGetFocus)};exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.FOCUS,exports.cc._EventListenerFocus.LISTENER_ID,t)}});exports.cc._EventListenerFocus.LISTENER_ID="__cc_focus_event";exports.cc._EventListenerVector=exports.cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return this._fixedListeners.length===0&&this._sceneGraphListeners.length===0},push:function(t){t._getFixedPriority()===0?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});exports.cc.__getListenerID=function(t){var e=exports.cc.Event,r=t.getType();return r===e.ACCELERATION?exports.cc._EventListenerAcceleration.LISTENER_ID:r===e.CUSTOM?t.getEventName():r===e.KEYBOARD?exports.cc._EventListenerKeyboard.LISTENER_ID:r===e.MOUSE?exports.cc._EventListenerMouse.LISTENER_ID:r===e.FOCUS?exports.cc._EventListenerFocus.LISTENER_ID:(r===e.TOUCH&&exports.cc.log(exports.cc._LogInfos.__getListenerID),"")};exports.cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[exports.cc.game.EVENT_HIDE,exports.cc.game.EVENT_SHOW],_setDirtyForNode:function(t){this._nodeListenersMap[t.__instanceId]!=null&&this._dirtyNodes.push(t);for(var e=t.getChildren(),r=0,n=e.length;r<n;r++)this._setDirtyForNode(e[r])},pauseTarget:function(t,e){var r=this._nodeListenersMap[t.__instanceId],n,s;if(r)for(n=0,s=r.length;n<s;n++)r[n]._setPaused(!0);if(e===!0){var o=t.getChildren();for(n=0,s=o.length;n<s;n++)this.pauseTarget(o[n],!0)}},resumeTarget:function(t,e){var r=this._nodeListenersMap[t.__instanceId],n,s;if(r)for(n=0,s=r.length;n<s;n++)r[n]._setPaused(!1);if(this._setDirtyForNode(t),e===!0){var o=t.getChildren();for(n=0,s=o.length;n<s;n++)this.resumeTarget(o[n],!0)}},_addListener:function(t){this._inDispatch===0?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),r=this._listenersMap[e];if(r||(r=new exports.cc._EventListenerVector,this._listenersMap[e]=r),r.push(t),t._getFixedPriority()===0){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();n===null&&exports.cc.log(exports.cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(n,t),n.isRunning()&&this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(this._dirtyNodes.length!==0){for(var t=this._dirtyNodes,e,r,n=this._nodeListenersMap,s=0,o=t.length;s<o;s++)if(e=n[t[s].__instanceId],e)for(var a=0,c=e.length;a<c;a++)r=e[a],r&&this._setDirty(r._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,r=0;r<t.length;)e=t[r],e._setRegistered(!1),e._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),this._inDispatch===0?exports.cc.arrayRemoveObject(t,e):++r},_removeListenersForListenerID:function(t){var e=this._listenersMap[t],r;if(e){var n=e.getFixedPriorityListeners(),s=e.getSceneGraphPriorityListeners();this._removeAllListenersInVector(s),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(e.clear(),delete this._listenersMap[t])}var o=this._toAddedListeners,a;for(r=0;r<o.length;)a=o[r],a&&a._getListenerID()===t?exports.cc.arrayRemoveObject(o,a):++r},_sortEventListeners:function(t){var e=this.DIRTY_NONE,r=this._priorityDirtyFlagMap;if(r[t]&&(e=r[t]),e!==this.DIRTY_NONE&&(r[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=exports.cc.director.getRunningScene();n?this._sortListenersOfSceneGraphPriority(t,n):r[t]=this.DIRTY_SCENE_GRAPH_PRIORITY}},_sortListenersOfSceneGraphPriority:function(t,e){var r=this._getListeners(t);if(r){var n=r.getSceneGraphPriorityListeners();!n||n.length===0||(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),r.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var r=exports.cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),s=e._getSceneGraphPriority();return!e||!s||!r[s.__instanceId]?-1:!t||!n||!r[n.__instanceId]?1:r[e._getSceneGraphPriority().__instanceId]-r[t._getSceneGraphPriority().__instanceId]},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var r=e.getFixedPriorityListeners();if(!(!r||r.length===0)){r.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,s=r.length;n<s&&!(r[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e=this._listenersMap[t];if(e){var r=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),s,o,a,c=this._toRemovedListeners;if(n)for(s=0;s<n.length;)o=n[s],o._isRegistered()?++s:(exports.cc.arrayRemoveObject(n,o),a=c.indexOf(o),a!==-1&&c.splice(a,1));if(r)for(s=0;s<r.length;)o=r[s],o._isRegistered()?++s:(exports.cc.arrayRemoveObject(r,o),a=c.indexOf(o),a!==-1&&c.splice(a,1));n&&n.length===0&&e.clearSceneGraphListeners(),r&&r.length===0&&e.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(exports.cc.assert(e>0,exports.cc._LogInfos.EventManager__updateListeners),!(e>1)){t.getType()===exports.cc.Event.TOUCH?(this._onUpdateListeners(exports.cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(exports.cc.__getListenerID(t)),exports.cc.assert(e===1,exports.cc._LogInfos.EventManager__updateListeners_2);var r=this._listenersMap,n=this._priorityDirtyFlagMap;for(var s in r)r[s].empty()&&(delete n[s],delete r[s]);var o=this._toAddedListeners;if(o.length!==0){for(var a=0,c=o.length;a<c;a++)this._forceAddEventListener(o[a]);this._toAddedListeners.length=0}this._toRemovedListeners.length!==0&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var r=t[e],n=this._listenersMap[r._getListenerID()];if(n){var s,o=n.getFixedPriorityListeners(),a=n.getSceneGraphPriorityListeners();a&&(s=a.indexOf(r),s!==-1&&a.splice(s,1)),o&&(s=o.indexOf(r),s!==-1&&o.splice(s,1))}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var r=e.event,n=e.selTouch;r._setCurrentTarget(t._node);var s=!1,o,a=r.getEventCode(),c=exports.cc.EventTouch.EventCode;return a===c.BEGAN?t.onTouchBegan&&(s=t.onTouchBegan(n,r),s&&t._registered&&t._claimedTouches.push(n)):t._claimedTouches.length>0&&(o=t._claimedTouches.indexOf(n))!==-1&&(s=!0,a===c.MOVED&&t.onTouchMoved?t.onTouchMoved(n,r):a===c.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,r),t._registered&&t._claimedTouches.splice(o,1)):a===c.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,r),t._registered&&t._claimedTouches.splice(o,1))),r.isStopped()?(exports.cc.eventManager._updateListeners(r),!0):s&&t._registered&&t.swallowTouches?(e.needsMutableSet&&e.touches.splice(n,1),!0):!1},_dispatchTouchEvent:function(t){this._sortEventListeners(exports.cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(exports.cc._EventListenerTouchOneByOne.LISTENER_ID),r=this._getListeners(exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(!(e===null&&r===null)){var n=t.getTouches(),s=exports.cc.copyArray(n),o={event:t,needsMutableSet:e&&r,touches:s,selTouch:null};if(e){for(var a=0;a<n.length;a++)if(o.selTouch=n[a],this._dispatchEventToListeners(e,this._onTouchEventCallback,o),t.isStopped())return}r&&s.length>0&&(this._dispatchEventToListeners(r,this._onTouchesEventCallback,{event:t,touches:s}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var r=exports.cc.EventTouch.EventCode,n=e.event,s=e.touches,o=n.getEventCode();return n._setCurrentTarget(t._node),o===r.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(s,n):o===r.MOVED&&t.onTouchesMoved?t.onTouchesMoved(s,n):o===r.ENDED&&t.onTouchesEnded?t.onTouchesEnded(s,n):o===r.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(s,n),n.isStopped()?(exports.cc.eventManager._updateListeners(n),!0):!1},_associateNodeAndEventListener:function(t,e){var r=this._nodeListenersMap[t.__instanceId];r||(r=[],this._nodeListenersMap[t.__instanceId]=r),r.push(e)},_dissociateNodeAndEventListener:function(t,e){var r=this._nodeListenersMap[t.__instanceId];r&&(exports.cc.arrayRemoveObject(r,e),r.length===0&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,r){var n=!1,s=t.getFixedPriorityListeners(),o=t.getSceneGraphPriorityListeners(),a=0,c,l;if(s&&s.length!==0){for(;a<t.gt0Index;++a)if(l=s[a],l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&e(l,r)){n=!0;break}}if(o&&!n){for(c=0;c<o.length;c++)if(l=o[c],l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&e(l,r)){n=!0;break}}if(s&&!n){for(;a<s.length;++a)if(l=s[a],l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&e(l,r)){n=!0;break}}},_setDirty:function(t,e){var r=this._priorityDirtyFlagMap;r[t]==null?r[t]=e:r[t]=e|r[t]},_visitTarget:function(t,e){var r=t.getChildren(),n=0,s=r.length,o=this._globalZOrderNodeMap,a=this._nodeListenersMap;if(s>0){for(var c;n<s&&(c=r[n],c&&c.getLocalZOrder()<0);n++)this._visitTarget(c,!1);for(a[t.__instanceId]!=null&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));n<s;n++)c=r[n],c&&this._visitTarget(c,!1)}else a[t.__instanceId]!=null&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));if(e){var l=[];for(var h in o)l.push(h);l.sort(this._sortNumberAsc);var u=l.length,_,d,f=this._nodePriorityMap;for(n=0;n<u;n++)for(_=o[l[n]],d=0;d<_.length;d++)f[_[d]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(exports.cc.assert(t&&e,exports.cc._LogInfos.eventManager_addListener_2),!(t instanceof exports.cc.EventListener))exports.cc.assert(!exports.cc.isNumber(e),exports.cc._LogInfos.eventManager_addListener_3),t=exports.cc.EventListener.create(t);else if(t._isRegistered()){exports.cc.log(exports.cc._LogInfos.eventManager_addListener_4);return}if(t.checkAvailable()){if(exports.cc.isNumber(e)){if(e===0){exports.cc.log(exports.cc._LogInfos.eventManager_addListener);return}t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}},addCustomListener:function(t,e){var r=new exports.cc._EventListenerCustom(t,e);return this.addListener(r,1),r},removeListener:function(t){if(t!=null){var e,r=this._listenersMap;for(var n in r){var s=r[n],o=s.getFixedPriorityListeners(),a=s.getSceneGraphPriorityListeners();if(e=this._removeListenerInVector(a,t),e?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(o,t),e&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)),s.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete r[n]),e)break}if(!e)for(var c=this._toAddedListeners,l=0,h=c.length;l<h;l++){var u=c[l];if(u===t){exports.cc.arrayRemoveObject(c,u),u._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(t==null)return!1;for(var r=0,n=t.length;r<n;r++){var s=t[r];if(s._onCustomEvent===e||s._onEvent===e)return s._setRegistered(!1),s._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(s._getSceneGraphPriority(),s),s._setSceneGraphPriority(null)),this._inDispatch===0&&exports.cc.arrayRemoveObject(t,s),!0}return!1},_removeListenerInVector:function(t,e){if(t==null)return!1;for(var r=0,n=t.length;r<n;r++){var s=t[r];if(s===e)return s._setRegistered(!1),s._getSceneGraphPriority()!=null&&(this._dissociateNodeAndEventListener(s._getSceneGraphPriority(),s),s._setSceneGraphPriority(null)),this._inDispatch===0?exports.cc.arrayRemoveObject(t,s):this._toRemovedListeners.push(s),!0}return!1},removeListeners:function(t,e){var r=this||window;if(t instanceof exports.cc.Node){delete r._nodePriorityMap[t.__instanceId],exports.cc.arrayRemoveObject(r._dirtyNodes,t);var n=r._nodeListenersMap[t.__instanceId],s;if(n){var o=exports.cc.copyArray(n);for(s=0;s<o.length;s++)r.removeListener(o[s]);o.length=0}var a=r._toAddedListeners;for(s=0;s<a.length;){var c=a[s];c._getSceneGraphPriority()===t?(c._setSceneGraphPriority(null),c._setRegistered(!1),a.splice(s,1)):++s}if(e===!0){var l=t.getChildren(),h;for(s=0,h=l.length;s<h;s++)r.removeListeners(l[s],!0)}}else t===exports.cc.EventListener.TOUCH_ONE_BY_ONE?r._removeListenersForListenerID(exports.cc._EventListenerTouchOneByOne.LISTENER_ID):t===exports.cc.EventListener.TOUCH_ALL_AT_ONCE?r._removeListenersForListenerID(exports.cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===exports.cc.EventListener.MOUSE?r._removeListenersForListenerID(exports.cc._EventListenerMouse.LISTENER_ID):t===exports.cc.EventListener.ACCELERATION?r._removeListenersForListenerID(exports.cc._EventListenerAcceleration.LISTENER_ID):t===exports.cc.EventListener.KEYBOARD?r._removeListenersForListenerID(exports.cc._EventListenerKeyboard.LISTENER_ID):exports.cc.log(exports.cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var r in t)e.indexOf(r)===-1&&this._removeListenersForListenerID(r)},setPriority:function(t,e){if(t!=null){var r=this._listenersMap;for(var n in r){var s=r[n],o=s.getFixedPriorityListeners();if(o){var a=o.indexOf(t);if(a!==-1){t._getSceneGraphPriority()!=null&&exports.cc.log(exports.cc._LogInfos.eventManager_setPriority),t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY));return}}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType()===exports.cc.Event.TOUCH){this._dispatchTouchEvent(t),this._inDispatch--;return}var e=exports.cc.__getListenerID(t);this._sortEventListeners(e);var r=this._listenersMap[e];r!=null&&this._dispatchEventToListeners(r,this._onListenerCallback,t),this._updateListeners(t),this._inDispatch--}},_onListenerCallback:function(t,e){return e._setCurrentTarget(t._getSceneGraphPriority()),t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var r=new exports.cc.EventCustom(t);r.setUserData(e),this.dispatchEvent(r)}};exports.cc._tmp.PrototypeCCNode=function(){var t=exports.cc.Node.prototype;exports.cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),exports.cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),t.width,exports.cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),t.height,exports.cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),t.anchorX,exports.cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),t.anchorY,exports.cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),t.skewX,exports.cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),t.skewY,exports.cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),t.zIndex,exports.cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),t.vertexZ,exports.cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),t.rotation,exports.cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),t.rotationX,exports.cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),t.rotationY,exports.cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),t.scale,exports.cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),t.scaleX,exports.cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),t.scaleY,exports.cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),t.children,exports.cc.defineGetterSetter(t,"children",t.getChildren),t.childrenCount,exports.cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount),t.parent,exports.cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),t.visible,exports.cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),t.running,exports.cc.defineGetterSetter(t,"running",t.isRunning),t.ignoreAnchor,exports.cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),t.tag,t.userData,t.userObject,t.arrivalOrder,t.actionManager,exports.cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),t.scheduler,exports.cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),t.shaderProgram,exports.cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),t.opacity,exports.cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.opacityModifyRGB,exports.cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),t.cascadeOpacity,exports.cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),t.color,exports.cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.cascadeColor,exports.cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)};exports.cc.NODE_TAG_INVALID=-1;exports.cc.s_globalOrderOfArrival=1;exports.cc.Node=exports.cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:exports.cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){this._initNode(),this._initRendererCmd()},_initNode:function(){var t=this||window;t._anchorPoint=exports.cc.p(0,0),t._contentSize=exports.cc.size(0,0),t._position=exports.cc.p(0,0),t._normalizedPosition=exports.cc.p(0,0),t._children=[];var e=exports.cc.director;t._actionManager=e.getActionManager(),t._scheduler=e.getScheduler(),t._additionalTransform=exports.cc.affineTransformMakeIdentity(),exports.cc.ComponentContainer&&(t._componentContainer=new exports.cc.ComponentContainer(t)),this._realOpacity=255,this._realColor=exports.cc.color(255,255,255,255),this._cascadeColorEnabled=!1,this._cascadeOpacityEnabled=!1},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(!(!t||t.length===0)){var r,n=t.length,s,o=exports.cc.Node._stateCallbackType;switch(e){case o.onEnter:for(r=0;r<n;r++)s=t[r],s&&s.onEnter();break;case o.onExit:for(r=0;r<n;r++)s=t[r],s&&s.onExit();break;case o.onEnterTransitionDidFinish:for(r=0;r<n;r++)s=t[r],s&&s.onEnterTransitionDidFinish();break;case o.cleanup:for(r=0;r<n;r++)s=t[r],s&&s.cleanup();break;case o.updateTransform:for(r=0;r<n;r++)s=t[r],s&&s.updateTransform();break;case o.onExitTransitionDidStart:for(r=0;r<n;r++)s=t[r],s&&s.onExitTransitionDidStart();break;case o.sortAllChildren:for(r=0;r<n;r++)s=t[r],s&&s.sortAllChildren();break;default:exports.cc.assert(0,exports.cc._LogInfos.Node__arrayMakeObjectsPerformSelector);break}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),exports.cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return exports.cc.log(exports.cc._LogInfos.Node_getZOrder),this.getLocalZOrder()},setZOrder:function(t){exports.cc.log(exports.cc._LogInfos.Node_setZOrder),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,exports.cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&exports.cc.log(exports.cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&exports.cc.log(exports.cc._LogInfos.Node_getScale),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||e===0?e:t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var r=this._position;if(e===void 0){if(r.x===t.x&&r.y===t.y)return;r.x=t.x,r.y=t.y}else{if(r.x===t&&r.y===e)return;r.x=t,r.y=e}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var r=this._normalizedPosition;e===void 0?(r.x=t.x,r.y=t.y):(r.x=t,r.y=e),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return exports.cc.p(this._position)},getNormalizedPosition:function(){return exports.cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),exports.cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return exports.cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var r=this._anchorPoint;if(e===void 0){if(t.x===r.x&&t.y===r.y)return;r.x=t.x,r.y=t.y}else{if(t===r.x&&e===r.y)return;r.x=t,r.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return exports.cc.size(this._contentSize)},setContentSize:function(t,e){var r=this._contentSize;if(e===void 0){if(t.width===r.width&&t.height===r.height)return;r.width=t.width,r.height=t.height}else{if(t===r.width&&e===r.height)return;r.width=t,r.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){this.userObject!==t&&(this.userObject=t)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||(this._actionManager=exports.cc.director.getActionManager()),this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||(this._scheduler=exports.cc.director.getScheduler()),this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return exports.cc.log(exports.cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=exports.cc.rect(0,0,this._contentSize.width,this._contentSize.height);return exports.cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),exports.cc.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(e!==null)for(var r=0;r<e.length;r++){var n=e[r];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return exports.cc.log("Invalid name"),null;for(var e=this._children,r=0,n=e.length;r<n;r++)if(e[r]._name===t)return e[r];return null},addChild:function(t,e,r){e=e===void 0?t._localZOrder:e;var n,s=!1;exports.cc.isUndefined(r)?(r=void 0,n=t._name):exports.cc.isString(r)?(n=r,r=void 0):exports.cc.isNumber(r)&&(s=!0,n=""),exports.cc.assert(t,exports.cc._LogInfos.Node_addChild_3),exports.cc.assert(t._parent===null,"child already added. It can't be added again"),this._addChildHelper(t,e,r,n,s)},_addChildHelper:function(t,e,r,n,s){this._children||(this._children=[]),this._insertChild(t,e),s?t.setTag(r):t.setName(n),t.setParent(this),t.setOrderOfArrival(exports.cc.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),t._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(t===void 0&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){exports.cc.log(exports.cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){this._children.length!==0&&(e===void 0&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e),exports.cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===exports.cc.NODE_TAG_INVALID&&exports.cc.log(exports.cc._LogInfos.Node_removeChildByTag);var r=this.getChildByTag(t);r?this.removeChild(r,e):exports.cc.log(exports.cc._LogInfos.Node_removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(e!==null){t===void 0&&(t=!0);for(var r=0;r<e.length;r++){var n=e[r];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),t&&n.cleanup(),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,exports.cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),exports.cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){exports.cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.Node_reorderChild),exports.cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=exports.cc.s_globalOrderOfArrival,exports.cc.s_globalOrderOfArrival++,t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children,e=t.length,r,n,s;for(r=1;r<e;r++){for(s=t[r],n=r-1;n>=0;){if(s._localZOrder<t[n]._localZOrder)t[n+1]=t[n];else if(s._localZOrder===t[n]._localZOrder&&s.arrivalOrder<t[n].arrivalOrder)t[n+1]=t[n];else break;n--}t[n+1]=s}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){this._parent!==null&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.onExit),this.removeAllComponents()},runAction:function(t){return exports.cc.assert(t,exports.cc._LogInfos.Node_runAction),this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){if(t===exports.cc.ACTION_TAG_INVALID){exports.cc.log(exports.cc._LogInfos.Node_stopActionByTag);return}this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===exports.cc.ACTION_TAG_INVALID?(exports.cc.log(exports.cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,r,n,s){var o=arguments.length;typeof t=="function"?o===1?(e=0,r=exports.cc.REPEAT_FOREVER,n=0,s=this.__instanceId):o===2?typeof e=="number"?(r=exports.cc.REPEAT_FOREVER,n=0,s=this.__instanceId):(s=e,e=0,r=exports.cc.REPEAT_FOREVER,n=0):o===3?(typeof r=="string"?(s=r,r=exports.cc.REPEAT_FOREVER):s=this.__instanceId,n=0):o===4&&(s=this.__instanceId):o===1?(e=0,r=exports.cc.REPEAT_FOREVER,n=0):o===2&&(r=exports.cc.REPEAT_FOREVER,n=0),exports.cc.assert(t,exports.cc._LogInfos.Node_schedule),exports.cc.assert(e>=0,exports.cc._LogInfos.Node_schedule_2),e=e||0,r=r==null?exports.cc.REPEAT_FOREVER:r,n=n||0,this.scheduler.schedule(t,this,e,r,n,!this._running,s)},scheduleOnce:function(t,e,r){r===void 0&&(r=this.__instanceId),this.schedule(t,0,0,e,r)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){exports.cc.log(exports.cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),exports.cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){exports.cc.log(exports.cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),exports.cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){if(t===void 0)return this._additionalTransformDirty=!1;this._additionalTransform=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;e!==null;e=e.parent)t=exports.cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return exports.cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return exports.cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||exports.cc.p(0,0),exports.cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return exports.cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||exports.cc.p(0,0);var e=exports.cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return exports.cc.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=exports.cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},update:function(t){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(t)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(t){return this._componentContainer?this._componentContainer.getComponent(t):null},addComponent:function(t){this._componentContainer&&this._componentContainer.add(t)},removeComponent:function(t){return this._componentContainer?this._componentContainer.remove(t):!1},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var r={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},n=this._parent;n!=null&&n!=t;n=n.getParent())exports.cc.affineTransformConcatIn(r,n.getNodeToParentTransform());return r}else return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=exports.cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(t=exports.cc.rectApplyAffineTransform(t,e),!this._children)return t;for(var r=this._children,n=0;n<r.length;n++){var s=r[n];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(e);o&&(t=exports.cc.rectUnion(t,o))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=exports.cc.rect(0,0,this._contentSize.width,this._contentSize.height),r=t===void 0?this.getNodeToParentTransform():exports.cc.affineTransformConcat(this.getNodeToParentTransform(),t);if(e=exports.cc.rectApplyAffineTransform(e,r),!this._children)return e;for(var n=this._children,s=0;s<n.length;s++){var o=n[s];if(o&&o._visible){var a=o._getBoundingBoxToCurrentNode(r);a&&(e=exports.cc.rectUnion(e,a))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return exports.cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_initRendererCmd:function(){this._renderCmd=exports.cc.renderer.getRenderCmd(this)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.Node.CanvasRenderCmd(this):new exports.cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(t,e){exports.cc.assert(t&&t.length!=0,"Invalid name"),exports.cc.assert(e!=null,"Invalid callback function");var r=t.length,n=0,s=r,o=!1;r>2&&t[0]==="/"&&t[1]==="/"&&(o=!0,n=2,s-=2);var a=!1;r>3&&t[r-3]==="/"&&t[r-2]==="."&&t[r-1]==="."&&(a=!0,s-=3);var c=t.substr(n,s);a&&(c="[[:alnum:]]+/"+c),o?this.doEnumerateRecursive(this,c,e):this.doEnumerate(c,e)},doEnumerateRecursive:function(t,e,r){if(!t.doEnumerate(e,r))for(var n,s=t.getChildren(),o=s.length,a=0;a<o&&(n=s[a],!this.doEnumerateRecursive(n,e,r));a++);},doEnumerate:function(t,e){var r=t.indexOf("/"),n=t,s=!1;r!==-1&&(n=t.substr(0,r),s=!0);for(var o=!1,a,c=this._children,l=c.length,h=0;h<l;h++)if(a=c[h],a._name.indexOf(n)!==-1){if(s){if(o=a.doEnumerate(t,e),o)break}else if(e(a)){o=!0;break}}return o}});exports.cc.Node.create=function(){return new exports.cc.Node};exports.cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeCCNode),exports.cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");exports.cc._tmp.PrototypeCCNode();delete exports.cc._tmp.PrototypeCCNode;exports.cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(r,n,s){this._callback&&this._callback.call(this._target,r,n,s)},this.needDraw=function(){return this._needDraw}};exports.cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1024-1};exports.cc.Node.RenderCmd=function(t){this._dirtyFlag=1,this._savedDirtyFlag=!0,this._node=t,this._needDraw=!1,this._anchorPointInPoints=new exports.cc.Point(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=exports.cc.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1};exports.cc.Node.RenderCmd.prototype={constructor:exports.cc.Node.RenderCmd,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return exports.cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return exports.cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty&&(this._inverse=exports.cc.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,r=this._node._anchorPoint;t.x=e.width*r.x,t.y=e.height*r.y,this.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){this._dirtyFlag===0&&t!==0&&exports.cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){var r=this._node,n=t?t._worldTransform:null,s=this._transform,o=this._worldTransform;if(r._usingNormalizedPosition&&r._parent){var a=r._parent._contentSize;r._position.x=r._normalizedPosition.x*a.width,r._position.y=r._normalizedPosition.y*a.height,r._normalizedPositionDirty=!1}var c=r._rotationX||r._rotationY,l=r._skewX||r._skewY,h=r._scaleX,u=r._scaleY,_=this._anchorPointInPoints.x,d=this._anchorPointInPoints.y,f=1,T=0,x=0,m=1;if(c||l){if(s.tx=r._position.x,s.ty=r._position.y,c){var v=r._rotationX*.017453292519943295;if(x=Math.sin(v),m=Math.cos(v),r._rotationY===r._rotationX)f=m,T=-x;else{var A=r._rotationY*.017453292519943295;f=Math.cos(A),T=-Math.sin(A)}}if(s.a=f*=h,s.b=T*=h,s.c=x*=u,s.d=m*=u,l){var D=Math.tan(r._skewX*Math.PI/180),N=Math.tan(r._skewY*Math.PI/180);D===1/0&&(D=99999999),N===1/0&&(N=99999999),s.a=f+x*N,s.b=T+m*N,s.c=x+f*D,s.d=m+T*D}(_||d)&&(s.tx-=s.a*_+s.c*d,s.ty-=s.b*_+s.d*d,r._ignoreAnchorPointForPosition&&(s.tx+=_,s.ty+=d)),n?(o.a=s.a*n.a+s.b*n.c,o.b=s.a*n.b+s.b*n.d,o.c=s.c*n.a+s.d*n.c,o.d=s.c*n.b+s.d*n.d,o.tx=n.a*s.tx+n.c*s.ty+n.tx,o.ty=n.d*s.ty+n.ty+n.b*s.tx):(o.a=s.a,o.b=s.b,o.c=s.c,o.d=s.d,o.tx=s.tx,o.ty=s.ty)}else s.a=h,s.b=0,s.c=0,s.d=u,s.tx=r._position.x,s.ty=r._position.y,(_||d)&&(s.tx-=s.a*_,s.ty-=s.d*d,r._ignoreAnchorPointForPosition&&(s.tx+=_,s.ty+=d)),n?(o.a=s.a*n.a+s.b*n.c,o.b=s.a*n.b+s.b*n.d,o.c=s.c*n.a+s.d*n.c,o.d=s.c*n.b+s.d*n.d,o.tx=s.tx*n.a+s.ty*n.c+n.tx,o.ty=s.tx*n.b+s.ty*n.d+n.ty):(o.a=s.a,o.b=s.b,o.c=s.c,o.d=s.d,o.tx=s.tx,o.ty=s.ty);if(r._additionalTransformDirty&&(this._transform=exports.cc.affineTransformConcat(s,r._additionalTransform)),this._updateCurrentRegions&&this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(exports.cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble),e){var z=this._node._children;if(!z||z.length===0)return;var M,J;for(M=0,J=z.length;M<J;M++)z[M]._renderCmd.transform(this,e)}this._cacheDirty=!0},getNodeToParentTransform:function(){return this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty&&this.transform(),this._transform},visit:function(t){var e=this._node,r=exports.cc.renderer;e._visible&&(t=t||this.getParentRenderCmd(),t&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=r.assignedZ,r.assignedZ+=r.assignedZStep),this._syncStatus(t),this.visitChildren())},_updateDisplayColor:function(t){var e=this._node,r=this._displayedColor,n=e._realColor,s,o,a,c;if(this._notifyRegionStatus&&this._notifyRegionStatus(exports.cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!e._cascadeColorEnabled){r.r=n.r,r.g=n.g,r.b=n.b;var l=new exports.cc.Color(255,255,255,255);for(a=e._children,s=0,o=a.length;s<o;s++)c=a[s],c&&c._renderCmd&&c._renderCmd._updateDisplayColor(l);this._cascadeColorEnabledDirty=!1}else{if(t===void 0){var h=e._parent;h&&h._cascadeColorEnabled?t=h.getDisplayedColor():t=exports.cc.color.WHITE}if(r.r=0|n.r*t.r/255,r.g=0|n.g*t.g/255,r.b=0|n.b*t.b/255,e._cascadeColorEnabled)for(a=e._children,s=0,o=a.length;s<o;s++)c=a[s],c&&c._renderCmd&&(c._renderCmd._updateDisplayColor(r),c._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e=this._node,r,n,s,o;if(this._notifyRegionStatus&&this._notifyRegionStatus(exports.cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!e._cascadeOpacityEnabled){for(this._displayedOpacity=e._realOpacity,s=e._children,r=0,n=s.length;r<n;r++)o=s[r],o&&o._renderCmd&&o._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(t===void 0){var a=e._parent;t=255,a&&a._cascadeOpacityEnabled&&(t=a.getDisplayedOpacity())}if(this._displayedOpacity=e._realOpacity*t/255,e._cascadeOpacityEnabled)for(s=e._children,r=0,n=s.length;r<n;r++)o=s[r],o&&o._renderCmd&&(o._renderCmd._updateDisplayOpacity(this._displayedOpacity),o._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var e=this._node,r=this._displayedColor,n=e._realColor;if(t===void 0){var s=e._parent;s&&s._cascadeColorEnabled?t=s.getDisplayedColor():t=exports.cc.color.WHITE}r.r=0|n.r*t.r/255,r.g=0|n.g*t.g/255,r.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(t===void 0){var r=e._parent;t=255,r&&r._cascadeOpacityEnabled&&(t=r.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=exports.cc.Node._dirtyFlags,e=this._dirtyFlag,r=e&t.colorDirty,n=e&t.opacityDirty;this._savedDirtyFlag=this._savedDirtyFlag||e,r&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(r||n)&&this._updateColor(),e&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&t.transformDirty^this._dirtyFlag),e&t.orderDirty&&(this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag)},_syncStatus:function(t){var e=exports.cc.Node._dirtyFlags,r=this._dirtyFlag,n=null;t?(n=t._node,this._savedDirtyFlag=this._savedDirtyFlag||t._savedDirtyFlag||r):this._savedDirtyFlag=this._savedDirtyFlag||r,n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(r|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(r|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(r|=e.transformDirty);var s=r&e.colorDirty,o=r&e.opacityDirty;this._dirtyFlag=r,s&&this._syncDisplayColor(),o&&this._syncDisplayOpacity(),(s||o)&&this._updateColor(),r&e.transformDirty&&this.transform(t),r&e.orderDirty&&(this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag)},visitChildren:function(){var t=exports.cc.renderer,e=this._node,r,n=e._children,s,o=n.length;if(o>0){for(e.sortAllChildren(),r=0;r<o&&(s=n[r],s._localZOrder<0);r++)s._renderCmd.visit(this);for(t.pushRenderCommand(this);r<o;r++)n[r]._renderCmd.visit(this)}else t.pushRenderCommand(this);this._dirtyFlag=0}};exports.cc.Node.RenderCmd.prototype.originVisit=exports.cc.Node.RenderCmd.prototype.visit;exports.cc.Node.RenderCmd.prototype.originTransform=exports.cc.Node.RenderCmd.prototype.transform;(function(){exports.cc.Node.CanvasRenderCmd=function(r){exports.cc.Node.RenderCmd.call(this,r),this._cachedParent=null,this._cacheDirty=!1,this._currentRegion=new exports.cc.Region,this._oldRegion=new exports.cc.Region,this._regionFlag=0,this._canUseDirtyRegion=!1},exports.cc.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var t=exports.cc.Node.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.RenderCmd.prototype);t.constructor=exports.cc.Node.CanvasRenderCmd,t._notifyRegionStatus=function(r){this._needDraw&&this._regionFlag<r&&(this._regionFlag=r)};var e=new exports.cc.Rect;t.getLocalBB=function(){var r=this._node;return e.x=e.y=0,e.width=r._contentSize.width,e.height=r._contentSize.height,e},t._updateCurrentRegions=function(){var r=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=r,exports.cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble===this._regionFlag&&!this._currentRegion.isEmpty()&&this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},t.setDirtyFlag=function(r,n){exports.cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,r,n),this._setCacheDirty(n),this._cachedParent&&this._cachedParent.setDirtyFlag(r,!0)},t._setCacheDirty=function(){if(this._cacheDirty===!1){this._cacheDirty=!0;var r=this._cachedParent;r&&r!==this&&r._setNodeDirtyForCache&&r._setNodeDirtyForCache()}},t._setCachedParent=function(r){if(this._cachedParent!==r){this._cachedParent=r;for(var n=this._node._children,s=0,o=n.length;s<o;s++)n[s]._renderCmd._setCachedParent(r)}},t.detachFromParent=function(){this._cachedParent=null;for(var r=this._node._children,n,s=0,o=r.length;s<o;s++)n=r[s],n&&n._renderCmd&&n._renderCmd.detachFromParent()},t.setShaderProgram=function(r){},t.getShaderProgram=function(){return null},exports.cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(r){return r?r.src===exports.cc.SRC_ALPHA&&r.dst===exports.cc.ONE||r.src===exports.cc.ONE&&r.dst===exports.cc.ONE?"lighter":r.src===exports.cc.ZERO&&r.dst===exports.cc.SRC_ALPHA?"destination-in":r.src===exports.cc.ZERO&&r.dst===exports.cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}})();exports.cc._tmp.PrototypeTexture2D=function(){var t=exports.cc.Texture2D;t.PVRImagesHavePremultipliedAlpha=function(s){exports.cc.PVRHaveAlphaPremultiplied_=s},t.PIXEL_FORMAT_RGBA8888=2,t.PIXEL_FORMAT_RGB888=3,t.PIXEL_FORMAT_RGB565=4,t.PIXEL_FORMAT_A8=5,t.PIXEL_FORMAT_I8=6,t.PIXEL_FORMAT_AI88=7,t.PIXEL_FORMAT_RGBA4444=8,t.PIXEL_FORMAT_RGB5A1=7,t.PIXEL_FORMAT_PVRTC4=9,t.PIXEL_FORMAT_PVRTC2=10,t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888,t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT;var e=exports.cc.Texture2D._M={};e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888",e[t.PIXEL_FORMAT_RGB888]="RGB888",e[t.PIXEL_FORMAT_RGB565]="RGB565",e[t.PIXEL_FORMAT_A8]="A8",e[t.PIXEL_FORMAT_I8]="I8",e[t.PIXEL_FORMAT_AI88]="AI88",e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444",e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1",e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4",e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2";var r=exports.cc.Texture2D._B={};r[t.PIXEL_FORMAT_RGBA8888]=32,r[t.PIXEL_FORMAT_RGB888]=24,r[t.PIXEL_FORMAT_RGB565]=16,r[t.PIXEL_FORMAT_A8]=8,r[t.PIXEL_FORMAT_I8]=8,r[t.PIXEL_FORMAT_AI88]=16,r[t.PIXEL_FORMAT_RGBA4444]=16,r[t.PIXEL_FORMAT_RGB5A1]=16,r[t.PIXEL_FORMAT_PVRTC4]=4,r[t.PIXEL_FORMAT_PVRTC2]=3;var n=exports.cc.Texture2D.prototype;n.name,exports.cc.defineGetterSetter(n,"name",n.getName),n.pixelFormat,exports.cc.defineGetterSetter(n,"pixelFormat",n.getPixelFormat),n.pixelsWidth,exports.cc.defineGetterSetter(n,"pixelsWidth",n.getPixelsWide),n.pixelsHeight,exports.cc.defineGetterSetter(n,"pixelsHeight",n.getPixelsHigh),n.width,exports.cc.defineGetterSetter(n,"width",n._getWidth),n.height,exports.cc.defineGetterSetter(n,"height",n._getHeight)};exports.cc._tmp.PrototypeTextureAtlas=function(){var t=exports.cc.TextureAtlas.prototype;t.totalQuads,exports.cc.defineGetterSetter(t,"totalQuads",t.getTotalQuads),t.capacity,exports.cc.defineGetterSetter(t,"capacity",t.getCapacity),t.quads,exports.cc.defineGetterSetter(t,"quads",t.getQuads,t.setQuads)};exports.cc._tmp.WebGLTexture2D=function(){exports.cc.Texture2D=exports.cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=exports.cc.size(0,0),this._pixelFormat=exports.cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&exports.cc._renderContext.deleteTexture(this._webTextureObj),exports.cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return exports.cc.size(this._contentSize.width/exports.cc.contentScaleFactor(),this._contentSize.height/exports.cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/exports.cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/exports.cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var t=this||window;return"<cc.Texture2D | Name = "+t._name+" | Dimensions = "+t._pixelsWide+" x "+t._pixelsHigh+" | Coordinates = ("+t.maxS+", "+t.maxT+")>"},releaseData:function(t){},keepData:function(t,e){return t},initWithData:function(t,e,r,n,s){var o=this,a=exports.cc.Texture2D,c=exports.cc._renderContext,l=c.RGBA,h=c.UNSIGNED_BYTE,u=exports.cc.Texture2D._B[e],_=r*u/8;switch(_%8===0?c.pixelStorei(c.UNPACK_ALIGNMENT,8):_%4===0?c.pixelStorei(c.UNPACK_ALIGNMENT,4):_%2===0?c.pixelStorei(c.UNPACK_ALIGNMENT,2):c.pixelStorei(c.UNPACK_ALIGNMENT,1),o._webTextureObj=c.createTexture(),exports.cc.glBindTexture2D(o),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),e){case a.PIXEL_FORMAT_RGBA8888:l=c.RGBA;break;case a.PIXEL_FORMAT_RGB888:l=c.RGB;break;case a.PIXEL_FORMAT_RGBA4444:h=c.UNSIGNED_SHORT_4_4_4_4;break;case a.PIXEL_FORMAT_RGB5A1:h=c.UNSIGNED_SHORT_5_5_5_1;break;case a.PIXEL_FORMAT_RGB565:h=c.UNSIGNED_SHORT_5_6_5;break;case a.PIXEL_FORMAT_AI88:l=c.LUMINANCE_ALPHA;break;case a.PIXEL_FORMAT_A8:l=c.ALPHA;break;case a.PIXEL_FORMAT_I8:l=c.LUMINANCE;break;default:exports.cc.assert(0,exports.cc._LogInfos.Texture2D_initWithData)}return c.texImage2D(c.TEXTURE_2D,0,l,r,n,0,l,h,t),o._contentSize.width=s.width,o._contentSize.height=s.height,o._pixelsWide=r,o._pixelsHigh=n,o._pixelFormat=e,o.maxS=s.width/r,o.maxT=s.height/n,o._hasPremultipliedAlpha=!1,o._hasMipmaps=!1,o.shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURE),o._textureLoaded=!0,!0},drawAtPoint:function(t){var e=this||window,r=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0],n=exports.cc._renderContext,s=e._pixelsWide*e.maxS,o=e._pixelsHigh*e.maxT,a=[t.x,t.y,0,s+t.x,t.y,0,t.x,o+t.y,0,s+t.x,o+t.y,0];e._shaderProgram.use(),e._shaderProgram.setUniformsForBuiltins(),exports.cc.glBindTexture2D(e),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,a),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,0,r),n.drawArrays(n.TRIANGLE_STRIP,0,4)},drawInRect:function(t){var e=this||window,r=[0,e.maxT,e.maxS,e.maxT,0,0,e.maxS,0],n=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height];e._shaderProgram.use(),e._shaderProgram.setUniformsForBuiltins(),exports.cc.glBindTexture2D(e);var s=exports.cc._renderContext;s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,n),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,0,r),s.drawArrays(s.TRIANGLE_STRIP,0,4)},initWithImage:function(t){if(t==null)return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithImage),!1;var e=t.getWidth(),r=t.getHeight(),n=exports.cc.configuration.getMaxTextureSize();return e>n||r>n?(exports.cc.log(exports.cc._LogInfos.Texture2D_initWithImage_2,e,r,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,r))},initWithElement:function(t){t&&(this._webTextureObj=exports.cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0,this._hasPremultipliedAlpha=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){var e=this||window;if(t=t!==void 0?t:e._hasPremultipliedAlpha,!!exports.cc.game._rendererInitialized){if(!e._htmlElementObj){var r=exports.cc.loader.getRes(e.url);if(!r)return;e.initWithElement(r)}if(!(!e._htmlElementObj.width||!e._htmlElementObj.height)){var n=exports.cc._renderContext;exports.cc.glBindTexture2D(e),n.pixelStorei(n.UNPACK_ALIGNMENT,4),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e._htmlElementObj),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURE),exports.cc.glBindTexture2D(null),t&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);var s=e._htmlElementObj.width,o=e._htmlElementObj.height;e._pixelsWide=e._contentSize.width=s,e._pixelsHigh=e._contentSize.height=o,e._pixelFormat=exports.cc.Texture2D.PIXEL_FORMAT_RGBA8888,e.maxS=1,e.maxT=1,e._hasPremultipliedAlpha=t,e._hasMipmaps=!1,e.dispatchEvent("load")}}},initWithString:function(t,e,r,n,s,o){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(t){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithETCFile_2),!1},initWithPVRFile:function(t){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithPVRFile_2),!1},initWithPVRTCData:function(t,e,r,n,s,o){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithPVRTCData_2),!1},setTexParameters:function(t,e,r,n){var s=this||window,o=exports.cc._renderContext;e!==void 0&&(t={minFilter:t,magFilter:e,wrapS:r,wrapT:n}),exports.cc.assert(s._pixelsWide===exports.cc.NextPOT(s._pixelsWide)&&s._pixelsHigh===exports.cc.NextPOT(s._pixelsHigh)||t.wrapS===o.CLAMP_TO_EDGE&&t.wrapT===o.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),exports.cc.glBindTexture2D(s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,t.minFilter),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t.magFilter),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,t.wrapS),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=exports.cc._renderContext;exports.cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=exports.cc._renderContext;exports.cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this||window;exports.cc.assert(t._pixelsWide===exports.cc.NextPOT(t._pixelsWide)&&t._pixelsHigh===exports.cc.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures"),exports.cc.glBindTexture2D(t),exports.cc._renderContext.generateMipmap(exports.cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return exports.cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=exports.cc.Texture2D._B[t];return e!=null?e:(exports.cc.log(exports.cc._LogInfos.Texture2D_bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,r){var n=exports.cc.Texture2D,s=t.getData(),o=null,a=null,c=t.hasAlpha(),l=exports.cc.size(t.getWidth(),t.getHeight()),h=n.defaultPixelFormat,u=t.getBitsPerComponent(),_;c||(u>=8?h=n.PIXEL_FORMAT_RGB888:(exports.cc.log(exports.cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),h=n.PIXEL_FORMAT_RGB565));var d=e*r;if(h===n.PIXEL_FORMAT_RGB565)if(c)for(s=new Uint16Array(e*r),o=t.getData(),_=0;_<d;++_)s[_]=(o[_]>>0&255)>>3<<11|(o[_]>>8&255)>>2<<5|(o[_]>>16&255)>>3<<0;else for(s=new Uint16Array(e*r),a=t.getData(),_=0;_<d;++_)s[_]=(a[_]&255)>>3<<11|(a[_]&255)>>2<<5|(a[_]&255)>>3<<0;else if(h===n.PIXEL_FORMAT_RGBA4444)for(s=new Uint16Array(e*r),o=t.getData(),_=0;_<d;++_)s[_]=(o[_]>>0&255)>>4<<12|(o[_]>>8&255)>>4<<8|(o[_]>>16&255)>>4<<4|(o[_]>>24&255)>>4<<0;else if(h===n.PIXEL_FORMAT_RGB5A1)for(s=new Uint16Array(e*r),o=t.getData(),_=0;_<d;++_)s[_]=(o[_]>>0&255)>>3<<11|(o[_]>>8&255)>>3<<6|(o[_]>>16&255)>>3<<1|(o[_]>>24&255)>>7<<0;else if(h===n.PIXEL_FORMAT_A8)for(s=new Uint8Array(e*r),o=t.getData(),_=0;_<d;++_)s[_]=o>>24&255;if(c&&h===n.PIXEL_FORMAT_RGB888)for(o=t.getData(),s=new Uint8Array(e*r*3),_=0;_<d;++_)s[_*3]=o>>0&255,s[_*3+1]=o>>8&255,s[_*3+2]=o>>16&255;return this.initWithData(s,h,e,r,l),s!=t.getData()&&(s=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)}})};exports.cc._tmp.WebGLTextureAtlas=function(){var t=exports.cc.TextureAtlas.prototype;t._setupVBO=function(){var e=this||window,r=exports.cc._renderContext;e._buffersVBO[0]=r.createBuffer(),e._buffersVBO[1]=r.createBuffer(),e._quadsWebBuffer=r.createBuffer(),e._mapBuffers()},t._mapBuffers=function(){var e=this||window,r=exports.cc._renderContext;r.bindBuffer(r.ARRAY_BUFFER,e._quadsWebBuffer),r.bufferData(r.ARRAY_BUFFER,e._quadsArrayBuffer,r.DYNAMIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._buffersVBO[1]),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._indices,r.STATIC_DRAW)},t.drawNumberOfQuads=function(e,r){var n=this||window;if(r=r||0,!(e===0||!n.texture||!n.texture.isLoaded())){var s=exports.cc._renderContext;exports.cc.glBindTexture2D(n.texture),s.bindBuffer(s.ARRAY_BUFFER,n._quadsWebBuffer),n.dirty&&(s.bufferData(s.ARRAY_BUFFER,n._quadsArrayBuffer,s.DYNAMIC_DRAW),n.dirty=!1),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,s.FLOAT,!1,24,0),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,s.UNSIGNED_BYTE,!0,24,12),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,24,16),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n._buffersVBO[1]),exports.cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?s.drawElements(s.TRIANGLE_STRIP,e*6,s.UNSIGNED_SHORT,r*6*n._indices.BYTES_PER_ELEMENT):s.drawElements(s.TRIANGLES,e*6,s.UNSIGNED_SHORT,r*6*n._indices.BYTES_PER_ELEMENT),exports.cc.g_NumberOfDraws++}}};exports.cc._tmp.WebGLTextureCache=function(){var t=exports.cc.textureCache;t.handleLoadedTexture=function(e){var r=this._textures,n,s;exports.cc.game._rendererInitialized||(r=this._loadedTexturesBefore),n=r[e],n||(n=r[e]=new exports.cc.Texture2D,n.url=e),s=exports.cc.path.extname(e),s===".png"?n.handleLoadedTexture(!0):n.handleLoadedTexture()},t.addImage=function(e,r,n){exports.cc.assert(e,exports.cc._LogInfos.Texture2D_addImage_2);var s=this._textures;exports.cc.game._rendererInitialized||(s=this._loadedTexturesBefore);var o=s[e]||s[exports.cc.loader._getAliase(e)];if(o)return o.isLoaded()?(r&&r.call(n,o),o):(o.addEventListener("load",function(){r&&r.call(n,o)},n),o);o=s[e]=new exports.cc.Texture2D,o.url=e;var a=exports.cc.loader.getBasePath?exports.cc.loader.getBasePath():exports.cc.loader.resPath;return exports.cc.loader.loadImg(exports.cc.path.join(a||"",e),function(c,l){if(c)return r&&r.call(n,c);exports.cc.loader.cache[e]||(exports.cc.loader.cache[e]=l),exports.cc.textureCache.handleLoadedTexture(e);var h=s[e];r&&r.call(n,h)}),o},t.addImageAsync=t.addImage,t=null};exports.cc.ALIGN_CENTER=51;exports.cc.ALIGN_TOP=19;exports.cc.ALIGN_TOP_RIGHT=18;exports.cc.ALIGN_RIGHT=50;exports.cc.ALIGN_BOTTOM_RIGHT=34;exports.cc.ALIGN_BOTTOM=35;exports.cc.ALIGN_BOTTOM_LEFT=33;exports.cc.ALIGN_LEFT=49;exports.cc.ALIGN_TOP_LEFT=17;exports.cc.PVRHaveAlphaPremultiplied_=!1;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS){var t={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=exports.cc.size(0,0),this._textureLoaded=!1,this._htmlElementObj=null,this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var r=exports.cc.contentScaleFactor();return exports.cc.size(this._contentSize.width/r,this._contentSize.height/r)},_getWidth:function(){return this._contentSize.width/exports.cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/exports.cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(r){r&&(this._htmlElementObj=r,this._contentSize.width=r.width,this._contentSize.height=r.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){var r=this||window;if(!r._textureLoaded){if(!r._htmlElementObj){var n=exports.cc.loader.getRes(r.url);if(!n)return;r.initWithElement(n)}var s=r._htmlElementObj;r._contentSize.width=s.width,r._contentSize.height=s.height,r.dispatchEvent("load")}},description:function(){return"<cc.Texture2D | width = "+this._contentSize.width+" height "+this._contentSize.height+">"},initWithData:function(r,n,s,o,a){return!1},initWithImage:function(r){return!1},initWithString:function(r,n,s,o,a,c){return!1},releaseTexture:function(){exports.cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(r){},getMaxT:function(){return 1},setMaxT:function(r){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(r){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(r){},keepData:function(r,n){return r},drawAtPoint:function(r){},drawInRect:function(r){},initWithETCFile:function(r){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithETCFile),!1},initWithPVRFile:function(r){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithPVRFile),!1},initWithPVRTCData:function(r,n,s,o,a,c){return exports.cc.log(exports.cc._LogInfos.Texture2D_initWithPVRTCData),!1},setTexParameters:function(r,n,s,o){if(n!==void 0&&(r={minFilter:r,magFilter:n,wrapS:s,wrapT:o}),r.wrapS===exports.cc.REPEAT&&r.wrapT===exports.cc.REPEAT){this._pattern="repeat";return}if(r.wrapS===exports.cc.REPEAT){this._pattern="repeat-x";return}if(r.wrapT===exports.cc.REPEAT){this._pattern="repeat-y";return}this._pattern=""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(r){return-1},addLoadedEventListener:function(r,n){this.addEventListener("load",r,n)},removeLoadedEventListener:function(r){this.removeEventTarget("load",r)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var r=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return e(this._htmlElementObj,r),this.channelCache=r},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(r){!this._textureLoaded||this._isGray===r||(this._isGray=r,this._isGray?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=exports.cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):this._backupElement!==null&&(this._htmlElementObj=this._backupElement))}},e=function(r,n){var s=r.width,o=r.height;n[0].width=s,n[0].height=o,n[1].width=s,n[1].height=o,n[2].width=s,n[2].height=o,n[3].width=s,n[3].height=o;var a=n[3].getContext("2d");a.drawImage(r,0,0);for(var c=a.getImageData(0,0,s,o).data,l,h=0;h<4;h++){l=n[h].getContext("2d");for(var u=l.getImageData(0,0,s,o),_=u.data,d=0;d<c.length;d+=4)_[d]=h===0?c[d]:0,_[d+1]=h===1?c[d+1]:0,_[d+2]=h===2?c[d+2]:0,_[d+3]=c[d+3];l.putImageData(u,0,0)}r.onload=null};exports.cc.sys._supportCanvasNewBlendModes?t._generateColorTexture=function(r,n,s,o,a){var c=!1;a?c=!0:a=document.createElement("canvas");var l=this._htmlElementObj;o||(o=exports.cc.rect(0,0,l.width,l.height)),a.width=o.width,a.height=o.height;var h=a.getContext("2d");if(h.globalCompositeOperation="source-over",h.fillStyle="rgb("+(r|0)+","+(n|0)+","+(s|0)+")",h.fillRect(0,0,o.width,o.height),h.globalCompositeOperation="multiply",h.drawImage(l,o.x,o.y,o.width,o.height,0,0,o.width,o.height),h.globalCompositeOperation="destination-atop",h.drawImage(l,o.x,o.y,o.width,o.height,0,0,o.width,o.height),c)return a;var u=new exports.cc.Texture2D;return u.initWithElement(a),u.handleLoadedTexture(),u}:t._generateColorTexture=function(r,n,s,o,a){var c=!1;a?c=!0:a=document.createElement("canvas");var l=this._htmlElementObj;o||(o=exports.cc.rect(0,0,l.width,l.height));var h,u,_,d;if(h=o.x,u=o.y,_=o.width,d=o.height,!(!_||!d)){a.width=_,a.height=d;var f=a.getContext("2d"),T=exports.cc.textureCache.getTextureColors(this);if(f.globalCompositeOperation="lighter",f.drawImage(T[3],h,u,_,d,0,0,_,d),r>0&&(f.globalAlpha=r/255,f.drawImage(T[0],h,u,_,d,0,0,_,d)),n>0&&(f.globalAlpha=n/255,f.drawImage(T[1],h,u,_,d,0,0,_,d)),s>0&&(f.globalAlpha=s/255,f.drawImage(T[2],h,u,_,d,0,0,_,d)),c)return a;var x=new exports.cc.Texture2D;return x.initWithElement(a),x.handleLoadedTexture(),x}},exports.cc.Texture2D=exports.cc.Class.extend(t),exports.cc.Texture2D._generateGrayTexture=function(r,n,s){if(r===null)return null;s=s||document.createElement("canvas"),n=n||exports.cc.rect(0,0,r.width,r.height),s.width=n.width,s.height=n.height;var o=s.getContext("2d");o.drawImage(r,n.x,n.y,n.width,n.height,0,0,n.width,n.height);for(var a=o.getImageData(0,0,n.width,n.height),c=a.data,l=0,h=c.length;l<h;l+=4)c[l]=c[l+1]=c[l+2]=.34*c[l]+.5*c[l+1]+.16*c[l+2];return o.putImageData(a,0,0),s}}else exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.WebGLTexture2D),exports.cc._LogInfos.MissingFile,"TexturesWebGL.js"),exports.cc._tmp.WebGLTexture2D(),delete exports.cc._tmp.WebGLTexture2D);exports.cc.EventHelper.prototype.apply(exports.cc.Texture2D.prototype),exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeTexture2D),exports.cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),exports.cc._tmp.PrototypeTexture2D(),delete exports.cc._tmp.PrototypeTexture2D});exports.cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|Math.random()*1e3,_loadedTexturesBefore:{},_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,r=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),r[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(t){exports.cc.log(exports.cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(t){exports.cc.log(exports.cc._LogInfos.textureCache_addETCImage)},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return exports.cc.log(exports.cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]||this._textures[exports.cc.loader._getAliase(t)]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,r=this.getKeyByTexture(e);return r||(e instanceof HTMLImageElement?r=e.src:r=this._generalTextureKey(t.__instanceId)),this._textureColorsCache[r]||(this._textureColorsCache[r]=t._generateTextureCacheForColor()),this._textureColorsCache[r]},addPVRImage:function(t){exports.cc.log(exports.cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var r in e)e[r]===t&&(e[r].releaseTexture(),delete e[r])}},removeTextureForKey:function(t){t!=null&&this._textures[t]&&delete this._textures[t]},cacheImage:function(t,e){if(e instanceof exports.cc.Texture2D){this._textures[t]=e;return}var r=new exports.cc.Texture2D;r.initWithElement(e),r.handleLoadedTexture(),this._textures[t]=r},addUIImage:function(t,e){if(exports.cc.assert(t,exports.cc._LogInfos.textureCache_addUIImage_2),e&&this._textures[e])return this._textures[e];var r=new exports.cc.Texture2D;return r.initWithImage(t),e!=null?this._textures[e]=r:exports.cc.log(exports.cc._LogInfos.textureCache_addUIImage),r},dumpCachedTextureInfo:function(){var t=0,e=0,r=this._textures;for(var n in r){var s=r[n];t++,s.getHtmlElementObj()instanceof HTMLImageElement?exports.cc.log(exports.cc._LogInfos.textureCache_dumpCachedTextureInfo,n,s.getHtmlElementObj().src,s.pixelsWidth,s.pixelsHeight):exports.cc.log(exports.cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,s.pixelsWidth,s.pixelsHeight),e+=s.pixelsWidth*s.pixelsHeight*4}var o=this._textureColorsCache;for(n in o){var a=o[n];for(var c in a){var l=a[c];t++,exports.cc.log(exports.cc._LogInfos.textureCache_dumpCachedTextureInfo_2,n,l.width,l.height),e+=l.width*l.height*4}}exports.cc.log(exports.cc._LogInfos.textureCache_dumpCachedTextureInfo_3,t,e/1024,(e/(1024*1024)).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|Math.random()*1e3,this._loadedTexturesBefore={}}};exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS){var t=exports.cc.textureCache;t.handleLoadedTexture=function(e){var r=this._textures,n=r[e];n||(n=r[e]=new exports.cc.Texture2D,n.url=e),n.handleLoadedTexture()},t.addImage=function(e,r,n){exports.cc.assert(e,exports.cc._LogInfos.Texture2D_addImage);var s=this._textures,o=s[e]||s[exports.cc.loader._getAliase(e)];if(o)return o.isLoaded()?(r&&r.call(n,o),o):(o.addEventListener("load",function(){r&&r.call(n,o)},n),o);o=s[e]=new exports.cc.Texture2D,o.url=e;var a=exports.cc.loader.getBasePath?exports.cc.loader.getBasePath():exports.cc.loader.resPath;return exports.cc.loader.loadImg(exports.cc.path.join(a||"",e),function(c,l){if(c)return r&&r.call(n,c);exports.cc.loader.cache[e]||(exports.cc.loader.cache[e]=l),exports.cc.textureCache.handleLoadedTexture(e);var h=s[e];r&&r.call(n,h)}),o},t.addImageAsync=t.addImage,t=null}else exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.WebGLTextureCache),exports.cc._LogInfos.MissingFile,"TexturesWebGL.js"),exports.cc._tmp.WebGLTextureCache(),delete exports.cc._tmp.WebGLTextureCache)});exports.cc.Scene=exports.cc.Node.extend({_className:"Scene",ctor:function(){exports.cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(exports.cc.director.getWinSize())}});exports.cc.Scene.create=function(){return new exports.cc.Scene};exports.cc.LoaderScene=exports.cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var t=this||window,e=200,r=t._bgLayer=new exports.cc.LayerColor(exports.cc.color(32,32,32,255));t.addChild(r,0);var n=24,s=-e/2+100;exports.cc._loaderImage&&(exports.cc.loader.loadImg(exports.cc._loaderImage,{isCrossOrigin:!1},function(a,c){c.width,e=c.height,t._initStage(c,exports.cc.visibleRect.center)}),n=14,s=-e/2-10);var o=t._label=new exports.cc.LabelTTF("Loading... 0%","Arial",n);return o.setPosition(exports.cc.pAdd(exports.cc.visibleRect.center,exports.cc.p(0,s))),o.setColor(exports.cc.color(180,180,180)),r.addChild(this._label,10),!0},_initStage:function(t,e){var r=this||window,n=r._texture2d=new exports.cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture();var s=r._logo=new exports.cc.Sprite(n);s.setScale(exports.cc.contentScaleFactor()),s.x=e.x,s.y=e.y,r._bgLayer.addChild(s,10)},onEnter:function(){var t=this||window;exports.cc.Node.prototype.onEnter.call(t),t.schedule(t._startLoading,.3)},onExit:function(){exports.cc.Node.prototype.onExit.call(this);var t="Loading... 0%";this._label.setString(t)},initWithResources:function(t,e,r){exports.cc.isString(t)&&(t=[t]),this.resources=t||[],this.cb=e,this.target=r},_startLoading:function(){var t=this||window;t.unschedule(t._startLoading);var e=t.resources;exports.cc.loader.load(e,function(r,n,s){var o=s/n*100|0;o=Math.min(o,100),t._label.setString("Loading... "+o+"%")},function(){t.cb&&t.cb.call(t.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._bgLayer._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._label._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._logo._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)}});exports.cc.LoaderScene.preload=function(t,e,r){var n=exports.cc;return n.loaderScene||(n.loaderScene=new exports.cc.LoaderScene,n.loaderScene.init(),exports.cc.eventManager.addCustomListener(exports.cc.Director.EVENT_PROJECTION_CHANGED,function(){n.loaderScene._updateTransform()})),n.loaderScene.initWithResources(t,e,r),exports.cc.director.runScene(n.loaderScene),n.loaderScene};exports.cc.Layer=exports.cc.Node.extend({_className:"Layer",ctor:function(){exports.cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(exports.cc.winSize)},init:function(){var t=this||window;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(exports.cc.winSize),t._cascadeColorEnabled=!1,t._cascadeOpacityEnabled=!1,!0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,r){exports.cc.Node.prototype.addChild.call(this,t,e,r),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.Layer.CanvasRenderCmd(this):new exports.cc.Layer.WebGLRenderCmd(this)}});exports.cc.Layer.create=function(){return new exports.cc.Layer};exports.cc.LayerColor=exports.cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,r){exports.cc.Layer.prototype.ctor.call(this),this._blendFunc=exports.cc.BlendFunc._alphaNonPremultiplied(),exports.cc.LayerColor.prototype.init.call(this,t,e,r)},init:function(t,e,r){var n=exports.cc.director.getWinSize();t=t||exports.cc.color(0,0,0,255),e=e===void 0?n.width:e,r=r===void 0?n.height:r;var s=this._realColor;return s.r=t.r,s.g=t.g,s.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty|exports.cc.Node._dirtyFlags.opacityDirty),exports.cc.LayerColor.prototype.setContentSize.call(this,e,r),!0},setBlendFunc:function(t,e){var r=this._blendFunc;e===void 0?(r.src=t.src,r.dst=t.dst):(r.src=t,r.dst=e),this._renderCmd.updateBlendFunc(r)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.LayerColor.CanvasRenderCmd(this):new exports.cc.LayerColor.WebGLRenderCmd(this)}});exports.cc.LayerColor.create=function(t,e,r){return new exports.cc.LayerColor(t,e,r)};(function(){var t=exports.cc.LayerColor.prototype;exports.cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),exports.cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)})();exports.cc.LayerGradient=exports.cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,r,n){exports.cc.LayerColor.prototype.ctor.call(this),this._endColor=exports.cc.color(0,0,0,255),this._alongVector=exports.cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,n&&n instanceof Array?(this._colorStops=n,n.splice(0,0,{p:0,color:t||exports.cc.color.BLACK}),n.push({p:1,color:e||exports.cc.color.BLACK})):this._colorStops=[{p:0,color:t||exports.cc.color.BLACK},{p:1,color:e||exports.cc.color.BLACK}],exports.cc.LayerGradient.prototype.init.call(this,t,e,r,n)},init:function(t,e,r,n){t=t||exports.cc.color(0,0,0,255),e=e||exports.cc.color(0,0,0,255),r=r||exports.cc.p(0,-1);var s=this||window,o=s._endColor;return s._startOpacity=t.a,o.r=e.r,o.g=e.g,o.b=e.b,s._endOpacity=e.a,s._alongVector=r,s._compressedInterpolation=!0,exports.cc.LayerColor.prototype.init.call(s,exports.cc.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty|exports.cc.Node._dirtyFlags.opacityDirty|exports.cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){exports.cc.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(t){exports.cc.LayerColor.prototype._setWidth.call(this,t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(t){exports.cc.LayerColor.prototype._setHeight.call(this,t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return exports.cc.color(this._realColor)},setStartColor:function(t){this.color=t;var e=this._colorStops;if(e&&e.length>0){var r=e[0].color;r.r=t.r,r.g=t.g,r.b=t.b}},setEndColor:function(t){var e=this._endColor;e.r=t.r,e.g=t.g,e.b=t.b;var r=this._colorStops;if(r&&r.length>0){var n=r[r.length-1].color;n.r=t.r,n.g=t.g,n.b=t.b}this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return exports.cc.color(this._endColor)},setStartOpacity:function(t){this._startOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[0].color.a=t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(t){this._endOpacity=t;var e=this._colorStops;e&&e.length>0&&(e[e.length-1].color.a=t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return exports.cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(t){this._compressedInterpolation=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(t){this._colorStops=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty|exports.cc.Node._dirtyFlags.opacityDirty|exports.cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.LayerGradient.CanvasRenderCmd(this):new exports.cc.LayerGradient.WebGLRenderCmd(this)}});exports.cc.LayerGradient.create=function(t,e,r,n){return new exports.cc.LayerGradient(t,e,r,n)};(function(){var t=exports.cc.LayerGradient.prototype;t.startColor,exports.cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,exports.cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,exports.cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,exports.cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,exports.cc.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,exports.cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)})();exports.cc.LayerMultiplex=exports.cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(t){exports.cc.Layer.prototype.ctor.call(this),t instanceof Array?exports.cc.LayerMultiplex.prototype.initWithLayers.call(this,t):exports.cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(t){return t.length>0&&t[t.length-1]==null&&exports.cc.log(exports.cc._LogInfos.LayerMultiplex_initWithLayers),this._layers=t,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(t){if(t>=this._layers.length){exports.cc.log(exports.cc._LogInfos.LayerMultiplex_switchTo);return}this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=t,this.addChild(this._layers[t])},switchToAndReleaseMe:function(t){if(t>=this._layers.length){exports.cc.log(exports.cc._LogInfos.LayerMultiplex_switchToAndReleaseMe);return}this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=t,this.addChild(this._layers[t])},addLayer:function(t){if(!t){exports.cc.log(exports.cc._LogInfos.LayerMultiplex_addLayer);return}this._layers.push(t)}});exports.cc.LayerMultiplex.create=function(){return new exports.cc.LayerMultiplex(Array.prototype.slice.call(arguments))};(function(){exports.cc.Layer.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._isBaked=!1,this._bakeSprite=null,this._canUseDirtyRegion=!0,this._updateCache=2};var t=exports.cc.Layer.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.Layer.CanvasRenderCmd,t._setCacheDirty=function(e){if(e&&this._updateCache===0&&(this._updateCache=2),this._cacheDirty===!1){this._cacheDirty=!0;var r=this._cachedParent;r&&r!==this&&r._setNodeDirtyForCache&&r._setNodeDirtyForCache()}},t.updateStatus=function(){var e=exports.cc.Node._dirtyFlags,r=this._dirtyFlag;r&e.orderDirty&&(this._cacheDirty=!0,this._updateCache===0&&(this._updateCache=2),this._dirtyFlag=r&e.orderDirty^r),exports.cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(e){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag;n&r.orderDirty&&(this._cacheDirty=!0,this._updateCache===0&&(this._updateCache=2),this._dirtyFlag=n&r.orderDirty^n),exports.cc.Node.RenderCmd.prototype._syncStatus.call(this,e)},t.transform=function(e,r){var n=this._worldTransform,s=n.a,o=n.b,a=n.c,c=n.d;n.tx,n.ty,exports.cc.Node.CanvasRenderCmd.prototype.transform.call(this,e,r),(n.a!==s||n.b!==o||n.c!==a||n.d!==c)&&this._updateCache===0&&(this._updateCache=2)},t.bake=function(){if(!this._isBaked){this._needDraw=!0,exports.cc.renderer.childrenOrderDirty=!0,this._isBaked=this._cacheDirty=!0,this._updateCache===0&&(this._updateCache=2);for(var e=this._node._children,r=0,n=e.length;r<n;r++)e[r]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=new exports.cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}},t.unbake=function(){if(this._isBaked){exports.cc.renderer.childrenOrderDirty=!0,this._needDraw=!1,this._isBaked=!1,this._cacheDirty=!0,this._updateCache===0&&(this._updateCache=2);for(var e=this._node._children,r=0,n=e.length;r<n;r++)e[r]._renderCmd._setCachedParent(null)}},t.isBaked=function(){return this._isBaked},t.rendering=function(){if(this._cacheDirty){var e=this._node,r=e._children,n=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var s=this._getBoundingBoxForBake();s.width=0|s.width+.5,s.height=0|s.height+.5;var o=n.getCacheContext(),a=o.getContext();if(n.setPosition(s.x,s.y),this._updateCache>0){n.resetCanvasSize(s.width,s.height),o.setOffset(0-s.x,a.canvas.height-s.height+s.y),e.sortAllChildren(),exports.cc.renderer._turnToCacheMode(this.__instanceId);for(var c=0,l=r.length;c<l;c++)r[c].visit(this);exports.cc.renderer._renderingToCacheCanvas(o,this.__instanceId),n.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(e){if(!this._isBaked){this.originVisit(e);return}var r=this._node,n=r._children,s=n.length;!r._visible||s===0||(this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._bakeForAddChild=function(e){e._parent===this._node&&this._isBaked&&e._renderCmd._setCachedParent(this)},t._getBoundingBoxForBake=function(){var e=null,r=this._node;if(!r._children||r._children.length===0)return exports.cc.rect(0,0,10,10);for(var n=r.getNodeToWorldTransform(),s=r._children,o=0,a=s.length;o<a;o++){var c=s[o];if(c&&c._visible)if(e){var l=c._getBoundingBoxToCurrentNode(n);l&&(e=exports.cc.rectUnion(e,l))}else e=c._getBoundingBoxToCurrentNode(n)}return e}})();(function(){exports.cc.LayerColor.CanvasRenderCmd=function(e){exports.cc.Layer.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._blendFuncStr="source-over",this._bakeRenderCmd=new exports.cc.CustomRenderCmd(this,this._bakeRendering)};var t=exports.cc.LayerColor.CanvasRenderCmd.prototype=Object.create(exports.cc.Layer.CanvasRenderCmd.prototype);t.constructor=exports.cc.LayerColor.CanvasRenderCmd,t.unbake=function(){exports.cc.Layer.CanvasRenderCmd.prototype.unbake.call(this),this._needDraw=!0},t.rendering=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext(),a=this._node,c=this._displayedColor,l=this._displayedOpacity/255,h=a._contentSize.width,u=a._contentSize.height;l!==0&&(s.setCompositeOperation(this._blendFuncStr),s.setGlobalAlpha(l),s.setFillStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+", 1)"),s.setTransform(this._worldTransform,r,n),o.fillRect(0,0,h,-u),exports.cc.g_NumberOfDraws++)},t.updateBlendFunc=function(e){this._blendFuncStr=exports.cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e)},t._updateSquareVertices=t._updateSquareVerticesWidth=t._updateSquareVerticesHeight=function(){},t._bakeRendering=function(){if(this._cacheDirty){var e=this._node,r=this._bakeSprite,n=e._children,s=n.length,o;this.transform(this.getParentRenderCmd(),!0);var a=this._getBoundingBoxForBake();a.width=0|a.width+.5,a.height=0|a.height+.5;var c=r.getCacheContext(),l=c.getContext();if(r.setPosition(a.x,a.y),this._updateCache>0){l.fillStyle=c._currentFillStyle,r.resetCanvasSize(a.width,a.height),c.setOffset(0-a.x,l.canvas.height-a.height+a.y);var h;if(exports.cc.renderer._turnToCacheMode(this.__instanceId),s>0){for(e.sortAllChildren(),o=0;o<s&&(h=n[o],h._localZOrder<0);o++)h._renderCmd.visit(this);for(exports.cc.renderer.pushRenderCommand(this);o<s;o++)n[o]._renderCmd.visit(this)}else exports.cc.renderer.pushRenderCommand(this);exports.cc.renderer._renderingToCacheCanvas(c,this.__instanceId),r.transform(),this._updateCache--}this._cacheDirty=!1}},t.visit=function(e){if(!this._isBaked){this.originVisit();return}var r=this._node;r._visible&&(this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0)},t._getBoundingBoxForBake=function(){var e=this._node,r=exports.cc.rect(0,0,e._contentSize.width,e._contentSize.height),n=e.getNodeToWorldTransform();if(r=exports.cc.rectApplyAffineTransform(r,e.getNodeToWorldTransform()),!e._children||e._children.length===0)return r;for(var s=e._children,o=0;o<s.length;o++){var a=s[o];if(a&&a._visible){var c=a._getBoundingBoxToCurrentNode(n);r=exports.cc.rectUnion(r,c)}}return r}})();(function(){exports.cc.LayerGradient.CanvasRenderCmd=function(e){exports.cc.LayerColor.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._startPoint=exports.cc.p(0,0),this._endPoint=exports.cc.p(0,0),this._startStopStr=null,this._endStopStr=null};var t=exports.cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(exports.cc.LayerColor.CanvasRenderCmd.prototype);t.constructor=exports.cc.LayerGradient.CanvasRenderCmd,t.rendering=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext(),a=this._node,c=this._displayedOpacity/255;if(c!==0){var l=a._contentSize.width,h=a._contentSize.height;s.setCompositeOperation(this._blendFuncStr),s.setGlobalAlpha(c);var u=o.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(a._colorStops)for(var _=0;_<a._colorStops.length;_++){var d=a._colorStops[_];u.addColorStop(d.p,this._colorStopsStr[_])}else u.addColorStop(0,this._startStopStr),u.addColorStop(1,this._endStopStr);s.setFillStyle(u),s.setTransform(this._worldTransform,r,n),o.fillRect(0,0,l,-h),exports.cc.g_NumberOfDraws++}},t.updateStatus=function(){var e=exports.cc.Node._dirtyFlags,r=this._dirtyFlag;r&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._dirtyFlag=r&e.gradientDirty^r),exports.cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(e){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag;n&r.gradientDirty&&(this._dirtyFlag|=r.colorDirty,this._dirtyFlag=n&r.gradientDirty^n),exports.cc.Node.RenderCmd.prototype._syncStatus.call(this,e)},t._updateColor=function(){var e=this._node,r=e._contentSize,n=r.width*.5,s=r.height*.5,o=exports.cc.pAngleSigned(exports.cc.p(0,-1),e._alongVector),a=exports.cc.pRotateByAngle(exports.cc.p(0,-1),exports.cc.p(0,0),o),c=Math.min(Math.abs(1/a.x),Math.abs(1/a.y));this._startPoint.x=n*(-a.x*c)+n,this._startPoint.y=s*(a.y*c)-s,this._endPoint.x=n*(a.x*c)+n,this._endPoint.y=s*(-a.y*c)-s;var l=this._displayedColor,h=e._endColor,u=e._startOpacity/255,_=e._endOpacity/255;if(this._startStopStr="rgba("+Math.round(l.r)+","+Math.round(l.g)+","+Math.round(l.b)+","+u.toFixed(4)+")",this._endStopStr="rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+_.toFixed(4)+")",e._colorStops){this._startOpacity=0,this._endOpacity=0,this._colorStopsStr=[];for(var d=0;d<e._colorStops.length;d++){var f=e._colorStops[d].color,T=f.a==null?1:f.a/255;this._colorStopsStr.push("rgba("+Math.round(f.r)+","+Math.round(f.g)+","+Math.round(f.b)+","+T.toFixed(4)+")")}}}})();exports.cc._tmp.PrototypeSprite=function(){var t=exports.cc.Sprite.prototype;exports.cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),exports.cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),exports.cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,exports.cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,exports.cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,exports.cc.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,exports.cc.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,exports.cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,exports.cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,exports.cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,exports.cc.defineGetterSetter(t,"quad",t.getQuad)};exports.cc.Sprite=exports.cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,r){var n=this||window;exports.cc.Node.prototype.ctor.call(n),this.setAnchorPoint(.5,.5),n._loader=new exports.cc.Sprite.LoadManager,n._shouldBeHidden=!1,n._offsetPosition=exports.cc.p(0,0),n._unflippedOffsetPositionFromCenter=exports.cc.p(0,0),n._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},n._rect=exports.cc.rect(0,0,0,0),n._softInit(t,e,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return exports.cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t},getOffsetPosition:function(){return exports.cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){return exports.cc.assert(t,exports.cc._LogInfos.Sprite_initWithSpriteFrame),this.setSpriteFrame(t)},initWithSpriteFrameName:function(t){exports.cc.assert(t,exports.cc._LogInfos.Sprite_initWithSpriteFrameName);var e=exports.cc.spriteFrameCache.getSpriteFrame(t);return exports.cc.assert(e,t+exports.cc._LogInfos.Sprite_initWithSpriteFrameName1),this.initWithSpriteFrame(e)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var t=this._children;exports.cc.Node.prototype.sortAllChildren.call(this),this._batchNode&&this._arrayMakeObjectsPerformSelector(t,exports.cc.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(t,e){if(exports.cc.assert(t,exports.cc._LogInfos.Sprite_reorderChild_2),this._children.indexOf(t)===-1){exports.cc.log(exports.cc._LogInfos.Sprite_reorderChild);return}e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),exports.cc.Node.prototype.reorderChild.call(this,t,e))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),exports.cc.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){exports.cc.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,r=this._batchNode;if(r&&e!=null)for(var n=0,s=e.length;n<s;n++)r.removeSpriteFromAtlas(e[n]);exports.cc.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){if(this._batchNode){exports.cc.log(exports.cc._LogInfos.Sprite_ignoreAnchorPointForPosition);return}exports.cc.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var r=exports.cc.animationCache.getAnimation(t);if(!r){exports.cc.log(exports.cc._LogInfos.Sprite_setDisplayFrameWithAnimationName);return}var n=r.getFrames()[e];if(!n){exports.cc.log(exports.cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2);return}this.setSpriteFrame(n.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,r){if(t===void 0)exports.cc.Sprite.prototype.init.call(this);else if(exports.cc.isString(t))if(t[0]==="#"){var n=t.substr(1,t.length-1),s=exports.cc.spriteFrameCache.getSpriteFrame(n);s?this.initWithSpriteFrame(s):exports.cc.log("%s does not exist",t)}else exports.cc.Sprite.prototype.init.call(this,t,e);else if(typeof t=="object"){if(t instanceof exports.cc.Texture2D)this.initWithTexture(t,e,r);else if(t instanceof exports.cc.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var o=new exports.cc.Texture2D;o.initWithElement(t),o.handleLoadedTexture(),this.initWithTexture(o)}}},getQuad:function(){return null},setBlendFunc:function(t,e){var r=this._blendFunc;e===void 0?(r.src=t.src,r.dst=t.dst):(r.src=t,r.dst=e),this._renderCmd.updateBlendFunc(r)},init:function(){var t=this||window;return arguments.length>0?t.initWithFile(arguments[0],arguments[1]):(exports.cc.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=exports.cc.BLEND_SRC,t._blendFunc.dst=exports.cc.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,t.setTextureRect(exports.cc.rect(0,0,0,0),!1,exports.cc.size(0,0)),!0)},initWithFile:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.Sprite_initWithFile);var r=exports.cc.textureCache.getTextureForKey(t);if(r||(r=exports.cc.textureCache.addImage(t)),!r.isLoaded())return this._loader.clear(),this._loader.once(r,function(){this.initWithFile(t,e),this.dispatchEvent("load")},this),!1;if(!e){var n=r.getContentSize();e=exports.cc.rect(0,0,n.width,n.height)}return this.initWithTexture(r,e)},initWithTexture:function(t,e,r,n){var s=this||window;return exports.cc.assert(arguments.length!==0,exports.cc._LogInfos.CCSpriteBatchNode_initWithTexture),this._loader.clear(),s._textureLoaded=t.isLoaded(),s._textureLoaded?(r=r||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,r,n),exports.cc.Node.prototype.init.call(s)?(s._batchNode=null,s._recursiveDirty=!1,s.dirty=!1,s._opacityModifyRGB=!0,s._blendFunc.src=exports.cc.BLEND_SRC,s._blendFunc.dst=exports.cc.BLEND_DST,s._flippedX=s._flippedY=!1,s._offsetPosition.x=0,s._offsetPosition.y=0,s._hasChildren=!1,s._rectRotated=r,e&&(s._rect.x=e.x,s._rect.y=e.y,s._rect.width=e.width,s._rect.height=e.height),e||(e=exports.cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,r),s.setTexture(t),s.setTextureRect(e,r),s.setBatchNode(null),!0):!1):(this._loader.once(t,function(){this.initWithTexture(t,e,r,n),this.dispatchEvent("load")},this),!1)},setTextureRect:function(t,e,r,n){var s=this||window;s._rectRotated=e||!1,s.setContentSize(r||t),s.setVertexRect(t),s._renderCmd._setTextureCoords(t,n);var o=s._unflippedOffsetPositionFromCenter.x,a=s._unflippedOffsetPositionFromCenter.y;s._flippedX&&(o=-o),s._flippedY&&(a=-a);var c=s._rect;s._offsetPosition.x=o+(s._contentSize.width-c.width)/2,s._offsetPosition.y=a+(s._contentSize.height-c.height)/2},addChild:function(t,e,r){exports.cc.assert(t,exports.cc._LogInfos.CCSpriteBatchNode_addChild_2),e==null&&(e=t._localZOrder),r==null&&(r=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(exports.cc.Node.prototype.addChild.call(this,t,e,r),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this||window;exports.cc.isString(t)&&(t=exports.cc.spriteFrameCache.getSpriteFrame(t),exports.cc.assert(t,exports.cc._LogInfos.Sprite_setSpriteFrame)),this._loader.clear(),this.setNodeDirty(!0);var r=t.getTexture();if(e._textureLoaded=t.textureLoaded(),this._loader.clear(),!e._textureLoaded)return this._loader.once(r,function(){this.setSpriteFrame(t),this.dispatchEvent("load")},this),!1;var n=t.getOffset();e._unflippedOffsetPositionFromCenter.x=n.x,e._unflippedOffsetPositionFromCenter.y=n.y,r!==e._texture&&(this._renderCmd._setTexture(r),e.setColor(e._realColor)),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())},setDisplayFrame:function(t){exports.cc.log(exports.cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new exports.cc.SpriteFrame(this._texture,exports.cc.rectPointsToPixels(this._rect),this._rectRotated,exports.cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),exports.cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){var e=this||window;e._batchNode=t,e._batchNode?(e._transformToBatch=exports.cc.affineTransformIdentity(),e.textureAtlas=e._batchNode.getTextureAtlas()):(e.atlasIndex=exports.cc.Sprite.INDEX_NOT_INITIALIZED,e.textureAtlas=null,e._recursiveDirty=!1,e.dirty=!1)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=exports.cc.isString(t);if(e&&(t=exports.cc.textureCache.addImage(t)),this._loader.clear(),!t._textureLoaded)return this._loader.once(t,function(){this.setTexture(t),this.dispatchEvent("load")},this),!1;this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t),this.setColor(this._realColor),this._textureLoaded=!0},_changeRectWithTexture:function(t){var e=t._contentSize,r=exports.cc.rect(0,0,e.width,e.height);this.setTextureRect(r)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.Sprite.CanvasRenderCmd(this):new exports.cc.Sprite.WebGLRenderCmd(this)}});exports.cc.Sprite.create=function(t,e,r){return new exports.cc.Sprite(t,e,r)};exports.cc.Sprite.createWithTexture=exports.cc.Sprite.create;exports.cc.Sprite.createWithSpriteFrameName=exports.cc.Sprite.create;exports.cc.Sprite.createWithSpriteFrame=exports.cc.Sprite.create;exports.cc.Sprite.INDEX_NOT_INITIALIZED=-1;exports.cc.EventHelper.prototype.apply(exports.cc.Sprite.prototype);exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeSprite),exports.cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");exports.cc._tmp.PrototypeSprite();delete exports.cc._tmp.PrototypeSprite;(function(){var t=exports.cc.Sprite.LoadManager=function(){this.list=[]};t.prototype.add=function(e,r,n){!e||!e.addEventListener||(e.addEventListener("load",r,n),this.list.push({source:e,listener:r,target:n}))},t.prototype.once=function(e,r,n){if(!(!e||!e.addEventListener)){var s=function(o){e.removeEventListener("load",s,n),r.call(n,o)};e.addEventListener("load",s,n),this.list.push({source:e,listener:s,target:n})}},t.prototype.clear=function(){for(;this.list.length>0;){var e=this.list.pop();e.source.removeEventListener("load",e.listener,e.target)}}})();(function(){exports.cc.Sprite.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._canUseDirtyRegion=!0,this._textureToRender=null};var t=exports.cc.Sprite.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.Sprite.CanvasRenderCmd,t.setDirtyRecursively=function(e){},t._setTexture=function(e){var r=this._node;r._texture!==e&&(e?r._textureLoaded=e._textureLoaded:r._textureLoaded=!1,r._texture=e,this._updateColor())},t._setColorDirty=function(){this.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty|exports.cc.Node._dirtyFlags.opacityDirty)},t.isFrameDisplayed=function(e){var r=this._node;return e.getTexture()!==r._texture?!1:exports.cc.rectEqualToRect(e.getRect(),r._rect)},t.updateBlendFunc=function(e){this._blendFuncStr=exports.cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e)},t._setBatchNodeForAddChild=function(e){return!0},t._handleTextureForRotatedTexture=function(e,r,n,s){if(n&&e.isLoaded()){var o=e.getHtmlElementObj();o=exports.cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(o,r,s);var a=new exports.cc.Texture2D;a.initWithElement(o),a.handleLoadedTexture(),e=a,r.x=r.y=0,this._node._rect=exports.cc.rect(0,0,r.width,r.height)}return e},t._checkTextureBoundary=function(e,r,n){if(e&&e.url){var s=r.x+r.width,o=r.y+r.height;s>e.width&&exports.cc.error(exports.cc._LogInfos.RectWidth,e.url),o>e.height&&exports.cc.error(exports.cc._LogInfos.RectHeight,e.url)}},t.rendering=function(e,r,n){var s=this._node,o=this._textureCoord,a=this._displayedOpacity/255,c=this._textureToRender||s._texture;if(!(c&&(o.width===0||o.height===0||!c._textureLoaded)||a===0)){var l=e||exports.cc._renderContext,h=l.getContext(),u=s._offsetPosition.x,_=s._rect.height,d=s._rect.width,f=-s._offsetPosition.y-_,T;l.setTransform(this._worldTransform,r,n),l.setCompositeOperation(this._blendFuncStr),l.setGlobalAlpha(a),(s._flippedX||s._flippedY)&&l.save(),s._flippedX&&(u=-u-d,h.scale(-1,1)),s._flippedY&&(f=s._offsetPosition.y,h.scale(1,-1));var x,m,v,A,D,N,z,M;if(this._colorized?(x=0,m=0):(x=o.renderX,m=o.renderY),v=o.width,A=o.height,D=u,N=f,z=d,M=_,c&&c._htmlElementObj)T=c._htmlElementObj,c._pattern!==""?(l.setFillStyle(h.createPattern(T,c._pattern)),h.fillRect(D,N,z,M)):h.drawImage(T,x,m,v,A,D,N,z,M);else{var J=s._contentSize;if(o.validRect){var U=this._displayedColor;l.setFillStyle("rgba("+U.r+","+U.g+","+U.b+",1)"),h.fillRect(D,N,J.width*r,J.height*n)}}(s._flippedX||s._flippedY)&&l.restore(),exports.cc.g_NumberOfDraws++}},t._updateColor=function(){var e=this._node,r=e._texture,n=this._textureCoord,s=this._displayedColor;r&&(s.r!==255||s.g!==255||s.b!==255?(this._textureToRender=r._generateColorTexture(s.r,s.g,s.b,n),this._colorized=!0):r&&(this._textureToRender=r,this._colorized=!1))},t._textureLoadedCallback=function(e){var r=this||window;if(!r._textureLoaded){r._textureLoaded=!0;var n=r._rect,s=this._renderCmd;n?exports.cc._rectEqualToZero(n)&&(n.width=e.width,n.height=e.height):n=exports.cc.rect(0,0,e.width,e.height),r.texture=e,r.setTextureRect(n,r._rectRotated);var o=s._displayedColor;(o.r!==255||o.g!==255||o.b!==255)&&s._updateColor(),r.setBatchNode(r._batchNode),r.dispatchEvent("load")}},t._setTextureCoords=function(e,r){r===void 0&&(r=!0);var n=this._textureCoord,s=r?exports.cc.contentScaleFactor():1;n.renderX=n.x=0|e.x*s,n.renderY=n.y=0|e.y*s,n.width=0|e.width*s,n.height=0|e.height*s,n.validRect=!(n.width===0||n.height===0||n.x<0||n.y<0)},exports.cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(e,r,n){if(!e)return null;if(!r)return e;n=n==null?!0:n;var s=document.createElement("canvas");s.width=r.width,s.height=r.height;var o=s.getContext("2d");return o.translate(s.width/2,s.height/2),n?o.rotate(-1.5707963267948966):o.rotate(1.5707963267948966),o.drawImage(e,r.x,r.y,r.height,r.width,-r.height/2,-r.width/2,r.height,r.width),s}})();exports.cc.BakeSprite=exports.cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){exports.cc.Sprite.prototype.ctor.call(this);var t=document.createElement("canvas");t.width=t.height=10,this._cacheCanvas=t,this._cacheContext=new exports.cc.CanvasContextWrapper(t.getContext("2d"));var e=new exports.cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(t,e){var r=this._cacheCanvas,n=this._cacheContext,s=n._context.strokeStyle,o=n._context.fillStyle;e===void 0&&(e=t.height,t=t.width),r.width=t,r.height=e,s!==n._context.strokeStyle&&(n._context.strokeStyle=s),o!==n._context.fillStyle&&(n._context.fillStyle=o),this.getTexture().handleLoadedTexture(),this.setTextureRect(exports.cc.rect(0,0,t,e),!1,null,!1)}});exports.cc.AnimationFrame=exports.cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,r){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=r||null},clone:function(){var t=new exports.cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(t){return exports.cc.clone(this)},copy:function(t){var e=new exports.cc.AnimationFrame;return e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),e},initWithSpriteFrame:function(t,e,r){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=r,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}});exports.cc.AnimationFrame.create=function(t,e,r){return new exports.cc.AnimationFrame(t,e,r)};exports.cc.Animation=exports.cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,r){if(this._frames=[],t===void 0)this.initWithSpriteFrames(null,0);else{var n=t[0];n&&(n instanceof exports.cc.SpriteFrame?this.initWithSpriteFrames(t,e,r):n instanceof exports.cc.AnimationFrame&&this.initWithAnimationFrames(t,e,r))}},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new exports.cc.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){var e=exports.cc.textureCache.addImage(t),r=exports.cc.rect(0,0,0,0);r.width=e.width,r.height=e.height;var n=new exports.cc.SpriteFrame(e,r);this.addSpriteFrame(n)},addSpriteFrameWithTexture:function(t,e){var r=new exports.cc.SpriteFrame(t,e);this.addSpriteFrame(r)},initWithAnimationFrames:function(t,e,r){exports.cc.arrayVerifyType(t,exports.cc.AnimationFrame),this._delayPerUnit=e,this._loops=r===void 0?1:r,this._totalDelayUnits=0;var n=this._frames;n.length=0;for(var s=0;s<t.length;s++){var o=t[s];n.push(o),this._totalDelayUnits+=o.getDelayUnits()}return!0},clone:function(){var t=new exports.cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){var e=new exports.cc.Animation;return e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),e.setRestoreOriginalFrame(this._restoreOriginalFrame),e},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,r){exports.cc.arrayVerifyType(t,exports.cc.SpriteFrame),this._loops=r===void 0?1:r,this._delayPerUnit=e||0,this._totalDelayUnits=0;var n=this._frames;if(n.length=0,t){for(var s=0;s<t.length;s++){var o=t[s],a=new exports.cc.AnimationFrame;a.initWithSpriteFrame(o,1,null),n.push(a)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}});exports.cc.Animation.create=function(t,e,r){return new exports.cc.Animation(t,e,r)};exports.cc.Animation.createWithAnimationFrames=exports.cc.Animation.create;exports.cc.animationCache={_animations:{},addAnimation:function(t,e){this._animations[e]=t},removeAnimation:function(t){t&&this._animations[t]&&delete this._animations[t]},getAnimation:function(t){return this._animations[t]?this._animations[t]:null},_addAnimationsWithDictionary:function(t,e){var r=t.animations;if(!r){exports.cc.log(exports.cc._LogInfos.animationCache__addAnimationsWithDictionary);return}var n=1,s=t.properties;if(s){n=s.format!=null?parseInt(s.format):n;for(var o=s.spritesheets,a=exports.cc.spriteFrameCache,c=exports.cc.path,l=0;l<o.length;l++)a.addSpriteFrames(c.changeBasename(e,o[l]))}switch(n){case 1:this._parseVersion1(r);break;case 2:this._parseVersion2(r);break;default:exports.cc.log(exports.cc._LogInfos.animationCache__addAnimationsWithDictionary_2);break}},addAnimations:function(t){exports.cc.assert(t,exports.cc._LogInfos.animationCache_addAnimations_2);var e=exports.cc.loader.getRes(t);if(!e){exports.cc.log(exports.cc._LogInfos.animationCache_addAnimations);return}this._addAnimationsWithDictionary(e,t)},_parseVersion1:function(t){var e=exports.cc.spriteFrameCache;for(var r in t){var n=t[r],s=n.frames,o=parseFloat(n.delay)||0,a=null;if(!s){exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion1,r);continue}for(var c=[],l=0;l<s.length;l++){var h=e.getSpriteFrame(s[l]);if(!h){exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion1_2,r,s[l]);continue}var u=new exports.cc.AnimationFrame;u.initWithSpriteFrame(h,1,null),c.push(u)}if(c.length===0){exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion1_3,r);continue}else c.length!==s.length&&exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion1_4,r);a=new exports.cc.Animation(c,o,1),exports.cc.animationCache.addAnimation(a,r)}},_parseVersion2:function(t){var e=exports.cc.spriteFrameCache;for(var r in t){var n=t[r],s=n.loop,o=parseInt(n.loops),a=s?exports.cc.REPEAT_FOREVER:isNaN(o)?1:o,c=!!(n.restoreOriginalFrame&&n.restoreOriginalFrame==!0),l=n.frames;if(!l){exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion2,r);continue}for(var h=[],u=0;u<l.length;u++){var _=l[u],d=_.spriteframe,f=e.getSpriteFrame(d);if(!f){exports.cc.log(exports.cc._LogInfos.animationCache__parseVersion2_2,r,d);continue}var T=parseFloat(_.delayUnits)||0,x=_.notification,m=new exports.cc.AnimationFrame;m.initWithSpriteFrame(f,T,x),h.push(m)}var v=parseFloat(n.delayPerUnit)||0,A=new exports.cc.Animation;A.initWithAnimationFrames(h,v,a),A.setRestoreOriginalFrame(c),exports.cc.animationCache.addAnimation(A,r)}},_clear:function(){this._animations={}}};exports.cc.SpriteFrame=exports.cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(t,e,r,n,s){this._offset=exports.cc.p(0,0),this._offsetInPixels=exports.cc.p(0,0),this._originalSize=exports.cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=exports.cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,t!==void 0&&e!==void 0&&(r===void 0||n===void 0||s===void 0?this.initWithTexture(t,e):this.initWithTexture(t,e,r,n,s))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return exports.cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){this._rectInPixels||(this._rectInPixels=exports.cc.rect(0,0,0,0)),this._rectInPixels.x=t.x,this._rectInPixels.y=t.y,this._rectInPixels.width=t.width,this._rectInPixels.height=t.height,this._rect=exports.cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return exports.cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=exports.cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=exports.cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return exports.cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,exports.cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return exports.cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return exports.cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){if(this._texture)return this._texture;if(this._textureFilename!==""){var t=exports.cc.textureCache.addImage(this._textureFilename);return t&&(this._textureLoaded=t.isLoaded()),t}return null},setTexture:function(t){if(this._texture!==t){var e=t.isLoaded();this._textureLoaded=e,this._texture=t,e||t.addEventListener("load",function(r){if(this._textureLoaded=!0,this._rotated&&exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS){var n=r.getHtmlElementObj();n=exports.cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(n,this.getRect());var s=new exports.cc.Texture2D;s.initWithElement(n),s.handleLoadedTexture(),this.setTexture(s);var o=this.getRect();this.setRect(exports.cc.rect(0,0,o.width,o.height))}var a=this._rect;if(a.width===0&&a.height===0){var c=r.width,l=r.height;this._rect.width=c,this._rect.height=l,this._rectInPixels=exports.cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=c,this._originalSize.height=l}this.dispatchEvent("load")},this)}},getOffset:function(){return exports.cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new exports.cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copyWithZone:function(){var t=new exports.cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,r,n,s){if(arguments.length===2&&(e=exports.cc.rectPointsToPixels(e)),n=n||exports.cc.p(0,0),s=s||e,r=r||!1,exports.cc.isString(t)?(this._texture=null,this._textureFilename=t):t instanceof exports.cc.Texture2D&&this.setTexture(t),t=this.getTexture(),this._rectInPixels=e,this._rect=exports.cc.rectPixelsToPoints(e),t&&t.url&&t.isLoaded()){var o,a;r?(o=e.x+e.height,a=e.y+e.width):(o=e.x+e.width,a=e.y+e.height),o>t.getPixelsWide()&&exports.cc.error(exports.cc._LogInfos.RectWidth,t.url),a>t.getPixelsHigh()&&exports.cc.error(exports.cc._LogInfos.RectHeight,t.url)}return this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,exports.cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=s.width,this._originalSizeInPixels.height=s.height,exports.cc._sizePixelsToPointsOut(s,this._originalSize),this._rotated=r,!0}});exports.cc.EventHelper.prototype.apply(exports.cc.SpriteFrame.prototype);exports.cc.SpriteFrame.create=function(t,e,r,n,s){return new exports.cc.SpriteFrame(t,e,r,n,s)};exports.cc.SpriteFrame.createWithTexture=exports.cc.SpriteFrame.create;exports.cc.SpriteFrame._frameWithTextureForCanvas=function(t,e,r,n,s){var o=new exports.cc.SpriteFrame;return o._texture=t,o._rectInPixels=e,o._rect=exports.cc.rectPixelsToPoints(e),o._offsetInPixels.x=n.x,o._offsetInPixels.y=n.y,exports.cc._pointPixelsToPointsOut(o._offsetInPixels,o._offset),o._originalSizeInPixels.width=s.width,o._originalSizeInPixels.height=s.height,exports.cc._sizePixelsToPointsOut(o._originalSizeInPixels,o._originalSize),o._rotated=r,o};exports.cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){var e=this._CCNS_REG2.exec(t);return e?exports.cc.rect(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):exports.cc.rect(0,0,0,0)},_pointFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?exports.cc.p(parseFloat(e[1]),parseFloat(e[2])):exports.cc.p(0,0)},_sizeFromString:function(t){var e=this._CCNS_REG1.exec(t);return e?exports.cc.size(parseFloat(e[1]),parseFloat(e[2])):exports.cc.size(0,0)},_getFrameConfig:function(t){var e=exports.cc.loader.getRes(t);return exports.cc.assert(e,exports.cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),exports.cc.loader.release(t),e._inited?(this._frameConfigCache[t]=e,e):(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){return exports.cc.assert(e,exports.cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t]},_parseFrameConfig:function(t){var e=t.frames,r=t.metadata||t.meta,n={},s={},o=0;if(r){var a=r.format;o=a.length<=1?parseInt(a):a,s.image=r.textureFileName||r.textureFileName||r.image}for(var c in e){var l=e[c];if(l){var h={};if(o==0){h.rect=exports.cc.rect(l.x,l.y,l.width,l.height),h.rotated=!1,h.offset=exports.cc.p(l.offsetX,l.offsetY);var u=l.originalWidth,_=l.originalHeight;(!u||!_)&&exports.cc.log(exports.cc._LogInfos.spriteFrameCache__getFrameConfig),u=Math.abs(u),_=Math.abs(_),h.size=exports.cc.size(u,_)}else if(o==1||o==2)h.rect=this._rectFromString(l.frame),h.rotated=l.rotated||!1,h.offset=this._pointFromString(l.offset),h.size=this._sizeFromString(l.sourceSize);else if(o==3){var d=this._sizeFromString(l.spriteSize),f=this._rectFromString(l.textureRect);d&&(f=exports.cc.rect(f.x,f.y,d.width,d.height)),h.rect=f,h.rotated=l.textureRotated||!1,h.offset=this._pointFromString(l.spriteOffset),h.size=this._sizeFromString(l.spriteSourceSize),h.aliases=l.aliases}else{var T=l.frame,x=l.sourceSize;c=l.filename||c,h.rect=exports.cc.rect(T.x,T.y,T.w,T.h),h.rotated=l.rotated||!1,h.offset=exports.cc.p(0,0),h.size=exports.cc.size(x.w,x.h)}n[c]=h}}return{_inited:!0,frames:n,meta:s}},_addSpriteFramesByObject:function(t,e,r){if(exports.cc.assert(t,exports.cc._LogInfos.spriteFrameCache_addSpriteFrames_2),!(!e||!e.frames)){var n=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e);this._createSpriteFrames(t,n,r)}},_createSpriteFrames:function(t,e,r){var n=e.frames,s=e.meta;if(r)r instanceof exports.cc.Texture2D||(exports.cc.isString(r)?r=exports.cc.textureCache.addImage(r):exports.cc.assert(0,exports.cc._LogInfos.spriteFrameCache_addSpriteFrames_3));else{var o=exports.cc.path.changeBasename(t,s.image||".png");r=exports.cc.textureCache.addImage(o)}var a=this._spriteFramesAliases,c=this._spriteFrames;for(var l in n){var h=n[l],u=c[l];if(!u){u=new exports.cc.SpriteFrame(r,h.rect,h.rotated,h.offset,h.size);var _=h.aliases;if(_)for(var d=0,f=_.length;d<f;d++){var T=_[d];a[T]&&exports.cc.log(exports.cc._LogInfos.spriteFrameCache_addSpriteFrames,T),a[T]=l}if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS&&u.isRotated()){var x=u.getTexture();if(x.isLoaded()){var m=u.getTexture().getHtmlElementObj();m=exports.cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(m,u.getRectInPixels());var v=new exports.cc.Texture2D;v.initWithElement(m),v.handleLoadedTexture(),u.setTexture(v);var A=u._rect;u.setRect(exports.cc.rect(0,0,A.width,A.height))}}c[l]=u}}},addSpriteFrames:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var r=this._frameConfigCache[t]||exports.cc.loader.getRes(t);if(!(!r||!r.frames)){var n=this._frameConfigCache[t]||this._getFrameConfig(t);this._createSpriteFrames(t,n,e)}},_checkConflict:function(t){var e=t.frames;for(var r in e)this._spriteFrames[r]&&exports.cc.log(exports.cc._LogInfos.spriteFrameCache__checkConflict,r)},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t]&&delete this._spriteFrames[t])},removeSpriteFramesFromFile:function(t){var e=this,r=e._spriteFrames,n=e._spriteFramesAliases,s=e._frameConfigCache[t];if(s){var o=s.frames;for(var a in o)if(r[a]){delete r[a];for(var c in n)n[c]===a&&delete n[c]}}},removeSpriteFramesFromTexture:function(t){var e=this,r=e._spriteFrames,n=e._spriteFramesAliases;for(var s in r){var o=r[s];if(o&&o.getTexture()===t){delete r[s];for(var a in n)n[a]===s&&delete n[a]}}},getSpriteFrame:function(t){var e=this,r=e._spriteFrames[t];if(!r){var n=e._spriteFramesAliases[t];n&&(r=e._spriteFrames[n.toString()],r||delete e._spriteFramesAliases[t])}return r},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}};exports.cc.g_NumberOfDraws=0;exports.cc.Director=exports.cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var t=this||window;t._lastUpdate=Date.now(),exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/exports.cc.defaultFPS,this._scenesStack=[],this._projection=exports.cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=exports.cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new exports.cc.Scheduler,exports.cc.ActionManager?(this._actionManager=new exports.cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,exports.cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this._eventAfterUpdate=new exports.cc.EventCustom(exports.cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventAfterVisit=new exports.cc.EventCustom(exports.cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterDraw=new exports.cc.EventCustom(exports.cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventProjectionChanged=new exports.cc.EventCustom(exports.cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,exports.cc.game.config[exports.cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:function(t){var e=document.documentElement,r=exports.cc.view,n=element.getBoundingClientRect();n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop;var s=r._devicePixelRatio*(t.x-n.left),o=r._devicePixelRatio*(n.top+n.height-t.y);return r._isRotated?{x:r._viewPortRect.width-o,y:s}:{x:s,y:o}},convertToUI:function(t){var e=document.documentElement,r=exports.cc.view,n=element.getBoundingClientRect();n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop;var s={x:0,y:0};return r._isRotated?(s.x=n.left+t.y/r._devicePixelRatio,s.y=n.top+n.height-(r._viewPortRect.width-t.x)/r._devicePixelRatio):(s.x=n.left+t.x/r._devicePixelRatio,s.y=n.top+n.height-t.y/r._devicePixelRatio),s},drawScene:function(){var t=exports.cc.renderer;this.calculateDeltaTime(),this._paused||(this._scheduler.update(this._deltaTime),exports.cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._nextScene&&this.setNextScene(),this._beforeVisitScene&&this._beforeVisitScene(),this._runningScene&&(t.childrenOrderDirty?(exports.cc.renderer.clearRenderCommands(),exports.cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()),t.clear(),this._notificationNode&&this._notificationNode.visit(),exports.cc.eventManager.dispatchEvent(this._eventAfterVisit),exports.cc.g_NumberOfDraws=0,this._afterVisitScene&&this._afterVisitScene(),t.rendering(exports.cc._renderContext),this._totalFrames++,exports.cc.eventManager.dispatchEvent(this._eventAfterDraw),this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return exports.cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return exports.cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(1/4),this._paused=!0)},popScene:function(){exports.cc.assert(this._runningScene,exports.cc._LogInfos.Director_popScene),this._scenesStack.pop();var t=this._scenesStack.length;t===0?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){exports.cc.animationCache._clear(),exports.cc.spriteFrameCache._clear(),exports.cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),exports.cc.eventManager&&exports.cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),exports.cc.checkGLErrorDebug()},pushScene:function(t){exports.cc.assert(t,exports.cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t){if(exports.cc.assert(t,exports.cc._LogInfos.Director_pushScene),!this._runningScene)this.pushScene(t),this.startAnimation();else{var e=this._scenesStack.length;e===0?(this._sendCleanupToScene=!0,this._scenesStack[e]=t,this._nextScene=t):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=t,this._nextScene=t)}},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||exports.cc.log(exports.cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(exports.cc.TransitionScene&&(t=this._runningScene?this._runningScene instanceof exports.cc.TransitionScene:!1,e=this._nextScene?this._nextScene instanceof exports.cc.TransitionScene:!1),!e){var r=this._runningScene;r&&(r.onExitTransitionDidStart(),r.onExit()),this._sendCleanupToScene&&r&&r.cleanup()}this._runningScene=this._nextScene,exports.cc.renderer.childrenOrderDirty=!0,this._nextScene=null,!t&&this._runningScene!==null&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){exports.cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),this._notificationNode=t,t&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return exports.cc.profiler?exports.cc.profiler.isShowingStats():!1},setDisplayStats:function(t){exports.cc.profiler&&(t?exports.cc.profiler.showStats():exports.cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){exports.cc.assert(this._runningScene,exports.cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack,r=e.length;if(t===0){this.end();return}if(!(t>=r)){for(;r>t;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),r--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}});exports.cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";exports.cc.Director.EVENT_AFTER_UPDATE="director_after_update";exports.cc.Director.EVENT_AFTER_VISIT="director_after_visit";exports.cc.Director.EVENT_AFTER_DRAW="director_after_draw";exports.cc.DisplayLinkDirector=exports.cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}});exports.cc.Director.sharedDirector=null;exports.cc.Director.firstUseDirector=!0;exports.cc.Director._getInstance=function(){return exports.cc.Director.firstUseDirector&&(exports.cc.Director.firstUseDirector=!1,exports.cc.Director.sharedDirector=new exports.cc.DisplayLinkDirector,exports.cc.Director.sharedDirector.init()),exports.cc.Director.sharedDirector};exports.cc.defaultFPS=60;exports.cc.Director.PROJECTION_2D=0;exports.cc.Director.PROJECTION_3D=1;exports.cc.Director.PROJECTION_CUSTOM=3;exports.cc.Director.PROJECTION_DEFAULT=exports.cc.Director.PROJECTION_2D;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS){var t=exports.cc.Director.prototype;t.getProjection=function(e){return this._projection},t.setProjection=function(e){this._projection=e,exports.cc.eventManager.dispatchEvent(this._eventProjectionChanged)},t.setDepthTest=function(){},t.setClearColor=function(e){exports.cc.renderer._clearColor=e,exports.cc.renderer._clearFillStyle="rgb("+e.r+","+e.g+","+e.b+")"},t.setOpenGLView=function(e){this._winSizeInPoints.width=exports.cc._canvas.width,this._winSizeInPoints.height=exports.cc._canvas.height,this._openGLView=e||exports.cc.view,exports.cc.eventManager&&exports.cc.eventManager.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return exports.cc.p(0,0)}}else exports.cc.Director._fpsImage=new Image,exports.cc.Director._fpsImage.addEventListener("load",function(){exports.cc.Director._fpsImageLoaded=!0}),exports.cc._fpsImage&&(exports.cc.Director._fpsImage.src=exports.cc._fpsImage)});exports.cc.PRIORITY_NON_SYSTEM=exports.cc.PRIORITY_SYSTEM+1;exports.cc.ListEntry=function(t,e,r,n,s,o,a){this.prev=t,this.next=e,this.callback=r,this.target=n,this.priority=s,this.paused=o,this.markedForDeletion=a};exports.cc.HashUpdateEntry=function(t,e,r,n,s){this.list=t,this.entry=e,this.target=r,this.callback=n,this.hh=s};exports.cc.HashTimerEntry=exports.cc.hashSelectorEntry=function(t,e,r,n,s,o,a){var c=this||window;c.timers=t,c.target=e,c.timerIndex=r,c.currentTimer=n,c.currentTimerSalvaged=s,c.paused=o,c.hh=a};exports.cc.Timer=exports.cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,r){this._elapsed=-1,this._interval=t,this._delay=r,this._useDelay=this._delay>0,this._repeat=e,this._runForever=this._repeat===exports.cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){this._elapsed===-1?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}});exports.cc.TimerTargetSelector=exports.cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,r,n,s,o){return this._scheduler=t,this._target=r,this._selector=e,this.setupTimerWithInterval(n,s,o),!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}});exports.cc.TimerTargetCallback=exports.cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._target=null,this._callback=null},initWithCallback:function(t,e,r,n,s,o,a){return this._scheduler=t,this._target=r,this._callback=e,this._key=n,this.setupTimerWithInterval(s,o,a),!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}});exports.cc.Scheduler=exports.cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,r,n){var s=this._hashForUpdates[e.__instanceId];if(s&&s.entry)if(s.entry.priority!==r)if(this._updateHashLocked){exports.cc.log("warning: you CANNOT change update priority in scheduled function"),s.entry.markedForDeletion=!1,s.entry.paused=n;return}else this.unscheduleUpdate(e);else{s.entry.markedForDeletion=!1,s.entry.paused=n;return}r===0?this._appendIn(this._updates0List,t,e,n):r<0?this._priorityIn(this._updatesNegList,t,e,r,n):this._priorityIn(this._updatesPosList,t,e,r,n)},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId],exports.cc.arrayRemoveObject(this._arrayForTimers,t),t.Timer=null,t.target=null,t=null},_removeUpdateFromHash:function(t){var e=this,r=e._hashForUpdates[t.target.__instanceId];r&&(exports.cc.arrayRemoveObject(r.list,r.entry),delete e._hashForUpdates[r.target.__instanceId],r.entry=null,r.target=null)},_priorityIn:function(t,e,r,n,s){var o=this,a=new exports.cc.ListEntry(null,null,e,r,n,s,!1);if(!t)t=[],t.push(a);else{for(var c=t.length-1,l=0;l<=c;l++)if(n<t[l].priority){c=l;break}t.splice(l,0,a)}return o._hashForUpdates[r.__instanceId]=new exports.cc.HashUpdateEntry(t,a,r,null),t},_appendIn:function(t,e,r,n){var s=this,o=new exports.cc.ListEntry(null,null,e,r,0,n,!1);t.push(o),s._hashForUpdates[r.__instanceId]=new exports.cc.HashUpdateEntry(t,o,r,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,this._timeScale!==1&&(t*=this._timeScale);var e,r,n,s;for(e=0,r=this._updatesNegList,n=r.length;e<n;e++)s=r[e],!s.paused&&!s.markedForDeletion&&s.callback(t);for(e=0,r=this._updates0List,n=r.length;e<n;e++)s=r[e],!s.paused&&!s.markedForDeletion&&s.callback(t);for(e=0,r=this._updatesPosList,n=r.length;e<n;e++)s=r[e],!s.paused&&!s.markedForDeletion&&s.callback(t);var o,a=this._arrayForTimers;for(e=0;e<a.length;e++){if(o=a[e],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(t),o.currentTimer=null;this._currentTargetSalvaged&&this._currentTarget.timers.length===0&&this._removeHashElement(this._currentTarget)}for(e=0,r=this._updatesNegList;e<r.length;)s=r[e],s.markedForDeletion?this._removeUpdateFromHash(s):e++;for(e=0,r=this._updates0List;e<r.length;)s=r[e],s.markedForDeletion?this._removeUpdateFromHash(s):e++;for(e=0,r=this._updatesPosList;e<r.length;)s=r[e],s.markedForDeletion?this._removeUpdateFromHash(s):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,r,n,s,o){this.schedule(e,t,r,n,s,o,t.__instanceId+"")},schedule:function(t,e,r,n,s,o,a){var c=!1;if(typeof t!="function"){var l=t;c=!0}c===!1?(arguments.length===4||arguments.length===5)&&(a=s,o=n,s=0,n=exports.cc.REPEAT_FOREVER):arguments.length===4&&(o=n,n=exports.cc.REPEAT_FOREVER,s=0),a===void 0&&(a=e.__instanceId+""),exports.cc.assert(e,exports.cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var h=this._hashForTimers[e.__instanceId];h?exports.cc.assert(h.paused===o,""):(h=new exports.cc.HashTimerEntry(null,e,0,null,null,o,null),this._arrayForTimers.push(h),this._hashForTimers[e.__instanceId]=h);var u,_;if(h.timers==null)h.timers=[];else if(c===!1){for(_=0;_<h.timers.length;_++)if(u=h.timers[_],t===u._callback){exports.cc.log(exports.cc._LogInfos.Scheduler_scheduleCallbackForTarget,u.getInterval().toFixed(4),r.toFixed(4)),u._interval=r;return}}else for(_=0;_<h.timers.length;++_)if(u=h.timers[_],u&&l===u.getSelector()){exports.cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",u.getInterval(),r),u.setInterval(r);return}c===!1?(u=new exports.cc.TimerTargetCallback,u.initWithCallback(this,t,e,a,r,n,s),h.timers.push(u)):(u=new exports.cc.TimerTargetSelector,u.initWithSelector(this,l,e,r,n,s),h.timers.push(u))},scheduleUpdate:function(t,e,r){this._schedulePerFrame(function(n){t.update(n)},t,e,r)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(!(!e||!t)){var r=this,n=r._hashForTimers[e.__instanceId];if(n)for(var s=n.timers,o=0,a=s.length;o<a;o++){var c=s[o];if(this._getUnscheduleMark(t,c)){c===n.currentTimer&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0),s.splice(o,1),n.timerIndex>=o&&n.timerIndex--,s.length===0&&(r._currentTarget===n?r._currentTargetSalvaged=!0:r._removeHashElement(n));return}}}},unscheduleUpdate:function(t){if(t!=null){var e=this._hashForUpdates[t.__instanceId];e&&(this._updateHashLocked?e.entry.markedForDeletion=!0:this._removeUpdateFromHash(e.entry))}},unscheduleAllForTarget:function(t){if(t!=null){var e=this._hashForTimers[t.__instanceId];e&&(e.timers.indexOf(e.currentTimer)>-1&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(exports.cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,r,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)r=n[e],this.unscheduleAllForTarget(r.target);var s,o=0;if(t<0)for(e=0;e<this._updatesNegList.length;)o=this._updatesNegList.length,s=this._updatesNegList[e],s&&s.priority>=t&&this.unscheduleUpdate(s.target),o==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)o=this._updates0List.length,s=this._updates0List[e],s&&this.unscheduleUpdate(s.target),o==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)o=this._updatesPosList.length,s=this._updatesPosList[e],s&&s.priority>=t&&this.unscheduleUpdate(s.target),o==this._updatesPosList.length&&e++},isScheduled:function(t,e){exports.cc.assert(t,"Argument key must not be empty"),exports.cc.assert(e,"Argument target must be non-nullptr");var r=this._hashForUpdates[e.__instanceId];if(!r||r.timers==null)return!1;for(var n=r.timers,s=0;s<n.length;++s){var o=n[s];if(t===o.getKey())return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(exports.cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e=[],r=this,n,s=r._arrayForTimers,o,a;for(o=0,a=s.length;o<a;o++)n=s[o],n&&(n.paused=!0,e.push(n.target));var c;if(t<0)for(o=0;o<this._updatesNegList.length;o++)c=this._updatesNegList[o],c&&c.priority>=t&&(c.paused=!0,e.push(c.target));if(t<=0)for(o=0;o<this._updates0List.length;o++)c=this._updates0List[o],c&&(c.paused=!0,e.push(c.target));for(o=0;o<this._updatesPosList.length;o++)c=this._updatesPosList[o],c&&c.priority>=t&&(c.paused=!0,e.push(c.target));return e},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){exports.cc.assert(t,exports.cc._LogInfos.Scheduler_pauseTarget);var e=this,r=e._hashForTimers[t.__instanceId];r&&(r.paused=!0);var n=e._hashForUpdates[t.__instanceId];n&&(n.entry.paused=!0)},resumeTarget:function(t){exports.cc.assert(t,exports.cc._LogInfos.Scheduler_resumeTarget);var e=this,r=e._hashForTimers[t.__instanceId];r&&(r.paused=!1);var n=e._hashForUpdates[t.__instanceId];n&&(n.entry.paused=!1)},isTargetPaused:function(t){exports.cc.assert(t,exports.cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];if(e)return e.paused;var r=this._hashForUpdates[t.__instanceId];return r?r.entry.paused:!1},scheduleUpdateForTarget:function(t,e,r){this.scheduleUpdate(t,e,r)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(exports.cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}});exports.cc.Scheduler.PRIORITY_SYSTEM=-2147483647-1;exports.cc._tmp.PrototypeLabelTTF=function(){var t=exports.cc.LabelTTF.prototype;exports.cc.defineGetterSetter(t,"color",t.getColor,t.setColor),exports.cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.string,exports.cc.defineGetterSetter(t,"string",t.getString,t.setString),t.textAlign,exports.cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),t.verticalAlign,exports.cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),t.fontSize,exports.cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),t.fontName,exports.cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),t.font,exports.cc.defineGetterSetter(t,"font",t._getFont,t._setFont),t.boundingSize,t.boundingWidth,exports.cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),t.boundingHeight,exports.cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),t.fillStyle,exports.cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),t.strokeStyle,exports.cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),t.lineWidth,exports.cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),t.shadowOffset,t.shadowOffsetX,exports.cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),t.shadowOffsetY,exports.cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),t.shadowOpacity,exports.cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),t.shadowBlur,exports.cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)};exports.cc.LabelTTF=exports.cc.Sprite.extend({_dimensions:null,_hAlignment:exports.cc.TEXT_ALIGNMENT_CENTER,_vAlignment:exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,r,n,s,o){var a;return t?a=t+"":a="",r=r||16,n=n||exports.cc.size(0,0),s=s||exports.cc.TEXT_ALIGNMENT_LEFT,o=o||exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=exports.cc.size(n.width,n.height),this._fontName=e||"Arial",this._hAlignment=s,this._vAlignment=o,this._fontSize=r,this._renderCmd._setFontStyle(this._fontName,r,this._fontStyle,this._fontWeight),this.string=a,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),this._scaleX=this._scaleY=1/exports.cc.view.getDevicePixelRatio(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,r,n,s,o){exports.cc.Sprite.prototype.ctor.call(this),this._dimensions=exports.cc.size(0,0),this._hAlignment=exports.cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=exports.cc.p(0,0),this._shadowOpacity=0,this._shadowBlur=0,this._strokeEnabled=!1,this._strokeColor=exports.cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=exports.cc.color(255,255,255,255),this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof exports.cc.FontDefinition?this.initWithStringAndTextDefinition(t,e):exports.cc.LabelTTF.prototype.initWithString.call(this,t,e,r,n,s,o)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return exports.cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(t,e,r,n){t.r!=null&&t.g!=null&&t.b!=null&&t.a!=null?this._enableShadow(t,e,r):this._enableShadowNoneColor(t,e,r,n)},_enableShadowNoneColor:function(t,e,r,n){r=r||.5,this._shadowEnabled===!1&&(this._shadowEnabled=!0);var s=this._shadowOffset;(s&&s.x!==t||s._y!==e)&&(s.x=t,s.y=e),this._shadowOpacity!==r&&(this._shadowOpacity=r),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,r){this._shadowColor||(this._shadowColor=exports.cc.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b;var n,s,o,a;n=e.width||e.x||0,s=e.height||e.y||0,o=t.a!=null?t.a/255:.5,a=r,this._enableShadowNoneColor(n,s,o,a)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){this._shadowEnabled===!1&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){this._shadowEnabled===!1&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return exports.cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){this._shadowEnabled===!1&&(this._shadowEnabled=!0),(this._shadowOffset.x!==t.x||this._shadowOffset.y!==t.y)&&(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){this._shadowEnabled===!1&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){this._shadowEnabled===!1&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var r=this._strokeColor;(r.r!==t.r||r.g!==t.g||r.b!==t.b)&&(r.r=t.r,r.g=t.g,r.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var e=this._strokeColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){this._strokeEnabled===!1&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;(e.r!==t.r||e.g!==t.g||e.b!==t.b)&&(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,t.lineHeight?this._lineHeight=t.lineHeight:this._lineHeight=this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture();var r=exports.cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(r.colorDirty|r.opacityDirty|r.textDirty)},_prepareTextDefinition:function(t){var e=new exports.cc.FontDefinition;if(t?(e.fontSize=this._fontSize,e.boundingWidth=exports.cc.contentScaleFactor()*this._dimensions.width,e.boundingHeight=exports.cc.contentScaleFactor()*this._dimensions.height):(e.fontSize=this._fontSize,e.boundingWidth=this._dimensions.width,e.boundingHeight=this._dimensions.height),e.fontName=this._fontName,e.textAlign=this._hAlignment,e.verticalAlign=this._vAlignment,this._strokeEnabled){e.strokeEnabled=!0;var r=this._strokeColor;e.strokeStyle=exports.cc.color(r.r,r.g,r.b),e.lineWidth=this._strokeSize}else e.strokeEnabled=!1;this._shadowEnabled?(e.shadowEnabled=!0,e.shadowBlur=this._shadowBlur,e.shadowOpacity=this._shadowOpacity,e.shadowOffsetX=(t?exports.cc.contentScaleFactor():1)*this._shadowOffset.x,e.shadowOffsetY=(t?exports.cc.contentScaleFactor():1)*this._shadowOffset.y):e._shadowEnabled=!1;var n=this._textFillColor;return e.fillStyle=exports.cc.color(n.r,n.g,n.b),e},getScale:function(){return this._scaleX!==this._scaleY&&exports.cc.log(exports.cc._LogInfos.Node_getScale),this._scaleX*exports.cc.view.getDevicePixelRatio()},setScale:function(t,e){this._scaleX=t/exports.cc.view.getDevicePixelRatio(),this._scaleY=(e||e===0?e:t)/exports.cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*exports.cc.view.getDevicePixelRatio()},setScaleX:function(t){this._scaleX=t/exports.cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*exports.cc.view.getDevicePixelRatio()},setScaleY:function(t){this._scaleY=t/exports.cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty))},_updateString:function(){(!this._string||this._string==="")&&this._string!==this._originalText&&(exports.cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var r;e===void 0?(r=t.width,e=t.height):r=t,(r!==this._dimensions.width||e!==this._dimensions.height)&&(this._dimensions.width=r,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){var e=exports.cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),exports.cc.size(this._contentSize)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.width},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.height},setTextureRect:function(t,e,r){exports.cc.Sprite.prototype.setTextureRect.call(this,t,e,r,!1)},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new exports.cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new exports.cc.LabelTTF.CacheCanvasRenderCmd(this):new exports.cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}});exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeLabelTTF),exports.cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");exports.cc._tmp.PrototypeLabelTTF();delete exports.cc._tmp.PrototypeLabelTTF;exports.cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;exports.cc.LabelTTF.create=function(t,e,r,n,s,o){return new exports.cc.LabelTTF(t,e,r,n,s,o)};exports.cc.LabelTTF.createWithFontDefinition=exports.cc.LabelTTF.create;exports.cc.LabelTTF.__labelHeightDiv=document.createElement("div");exports.cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";exports.cc.LabelTTF.__labelHeightDiv.style.position="absolute";exports.cc.LabelTTF.__labelHeightDiv.style.left="-100px";exports.cc.LabelTTF.__labelHeightDiv.style.top="-100px";exports.cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";document.body?document.body.appendChild(exports.cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(exports.cc.LabelTTF.__labelHeightDiv)},!1);exports.cc.LabelTTF.__getFontHeightByDiv=function(t,e){var r,n=exports.cc.LabelTTF.__labelHeightDiv;if(t instanceof exports.cc.FontDefinition){var s=t;if(r=exports.cc.LabelTTF.__fontHeightCache[s._getCanvasFontStr()],r>0)return r;n.innerHTML="ajghl~!",n.style.fontFamily=s.fontName,n.style.fontSize=s.fontSize+"px",n.style.fontStyle=s.fontStyle,n.style.fontWeight=s.fontWeight,r=n.clientHeight,exports.cc.LabelTTF.__fontHeightCache[s._getCanvasFontStr()]=r,n.innerHTML=""}else{if(r=exports.cc.LabelTTF.__fontHeightCache[t+"."+e],r>0)return r;n.innerHTML="ajghl~!",n.style.fontFamily=t,n.style.fontSize=e+"px",r=n.clientHeight,exports.cc.LabelTTF.__fontHeightCache[t+"."+e]=r,n.innerHTML=""}return r};exports.cc.LabelTTF.__fontHeightCache={};exports.cc.LabelTTF._textAlign=["left","center","right"];exports.cc.LabelTTF._textBaseline=["top","middle","bottom"];exports.cc.LabelTTF.wrapInspection=!0;exports.cc.LabelTTF._wordRex=/([a-zA-Z0-9]+|\S)/;exports.cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>]/;exports.cc.LabelTTF._lastWordRex=/([a-zA-Z0-9]+|\S)$/;exports.cc.LabelTTF._lastEnglish=/[a-zA-Z0-9]+$/;exports.cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9]/;(function(){exports.cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelCanvas=null,this._labelContext=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0,this._texRect=exports.cc.rect(),this._canUseDirtyRegion=!0};var t=exports.cc.LabelTTF.RenderCmd.prototype;t.constructor=exports.cc.LabelTTF.RenderCmd,t._setFontStyle=function(r,n,s,o){if(r instanceof exports.cc.FontDefinition)this._fontStyleStr=r._getCanvasFontStr(),this._fontClientHeight=exports.cc.LabelTTF.__getFontHeightByDiv(r);else{var a=n*exports.cc.view.getDevicePixelRatio();this._fontStyleStr=s+" "+o+" "+a+"px '"+r+"'",this._fontClientHeight=exports.cc.LabelTTF.__getFontHeightByDiv(r,n)}},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateColor=function(){this._setColorsString(),this._updateTexture()},t._setColorsString=function(){var r=this._displayedColor,n=this._node,s=n._shadowColor||this._displayedColor,o=n._strokeColor,a=n._textFillColor,c=r.r/255,l=r.g/255,h=r.b/255;this._shadowColorStr="rgba("+(0|c*s.r)+","+(0|l*s.g)+","+(0|h*s.b)+","+n._shadowOpacity+")",this._fillColorStr="rgba("+(0|c*a.r)+","+(0|l*a.g)+","+(0|h*a.b)+", 1)",this._strokeColorStr="rgba("+(0|c*o.r)+","+(0|l*o.g)+","+(0|h*o.b)+", 1)"};var e=new exports.cc.Rect;t.getLocalBB=function(){var r=this._node;e.x=e.y=0;var n=exports.cc.view.getDevicePixelRatio();return e.width=r._getWidth()*n,e.height=r._getHeight()*n,e},t._updateTTF=function(){var r=this._node,n=exports.cc.view.getDevicePixelRatio(),s=r._dimensions.width*n,o,a,c=this._lineWidths;if(c.length=0,this._isMultiLine=!1,this._measureConfig(),s!==0)for(this._strings=r._string.split(`
`),o=0;o<this._strings.length;o++)this._checkWarp(this._strings,o,s);else for(this._strings=r._string.split(`
`),o=0,a=this._strings.length;o<a;o++)c.push(this._measure(this._strings[o]));this._strings.length>1&&(this._isMultiLine=!0);var l,h=0,u=0;if(r._strokeEnabled&&(h=u=r._strokeSize*2),r._shadowEnabled){var _=r._shadowOffset;h+=Math.abs(_.x)*2,u+=Math.abs(_.y)*2}s===0?this._isMultiLine?l=exports.cc.size(Math.ceil(Math.max.apply(Math,c)+h),Math.ceil(this._fontClientHeight*n*this._strings.length+u)):l=exports.cc.size(Math.ceil(this._measure(r._string)+h),Math.ceil(this._fontClientHeight*n+u)):r._dimensions.height===0?this._isMultiLine?l=exports.cc.size(Math.ceil(s+h),Math.ceil(r.getLineHeight()*n*this._strings.length+u)):l=exports.cc.size(Math.ceil(s+h),Math.ceil(r.getLineHeight()*n+u)):l=exports.cc.size(Math.ceil(s+h),Math.ceil(r._dimensions.height*n+u)),r._getFontStyle()!=="normal"&&(l.width=Math.ceil(l.width+r._fontSize*.3)),this._strings.length===0?(this._texRect.width=1,this._texRect.height=l.height||1):(this._texRect.width=l.width,this._texRect.height=l.height);var d=l.width/n,f=l.height/n;r.setContentSize(d,f),r._strokeShadowOffsetX=h,r._strokeShadowOffsetY=u;var T=r._anchorPoint;this._anchorPointInPoints.x=h*.5+(l.width-h)*T.x,this._anchorPointInPoints.y=u*.5+(l.height-u)*T.y},t._saveStatus=function(){var r=this._node,n=exports.cc.view.getDevicePixelRatio(),s=r._strokeShadowOffsetX,o=r._strokeShadowOffsetY,a=r._contentSize.height*n-o,c=r._vAlignment,l=r._hAlignment,h=s*.5,u=a+o*.5,_=0,d=0,f=[],T=r._contentSize.width*n-s,x=r.getLineHeight()*n,m=(x-this._fontClientHeight*n)/2;if(l===exports.cc.TEXT_ALIGNMENT_RIGHT?_+=T:l===exports.cc.TEXT_ALIGNMENT_CENTER?_+=T/2:_+=0,this._isMultiLine){var v=this._strings.length;c===exports.cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?d=x-m*2+a-x*v:c===exports.cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(d=(x-m*2)/2+(a-x*v)/2);for(var A=0;A<v;A++){var D=-a+(x*A+m)+d;f.push(D)}}else c===exports.cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM||(c===exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP?d-=a:d-=a*.5),f.push(d);var N={contextTransform:exports.cc.p(h,u),xOffset:_,OffsetYArray:f};this._status.push(N)},t._drawTTFInCanvas=function(r){if(r){var n=this._status.pop();r.setTransform(1,0,0,1,n.contextTransform.x,n.contextTransform.y);var s=n.xOffset,o=n.OffsetYArray;this.drawLabels(r,s,o)}},t._checkWarp=function(r,n,s){var o=r[n],a=this._measure(o);if(a>s&&o.length>1){for(var c=o.length*(s/a)|0,l=o.substr(c),h=a-this._measure(l),u,_=0,d=0;h>s&&d++<100;)c*=s/h,c=c|0,l=o.substr(c),h=a-this._measure(l);for(d=0;h<s&&d++<100;){if(l){var f=exports.cc.LabelTTF._wordRex.exec(l);_=f?f[0].length:1,u=l}c=c+_,l=o.substr(c),h=a-this._measure(l)}c-=_,c===0&&(c=1,u=u.substr(1));var T=o.substr(0,c),x;exports.cc.LabelTTF.wrapInspection&&exports.cc.LabelTTF._symbolRex.test(u||l)&&(x=exports.cc.LabelTTF._lastWordRex.exec(T),c-=x?x[0].length:0,c===0&&(c=1),u=o.substr(c),T=o.substr(0,c)),exports.cc.LabelTTF._firsrEnglish.test(u)&&(x=exports.cc.LabelTTF._lastEnglish.exec(T),x&&T!==x[0]&&(c-=x[0].length,u=o.substr(c),T=o.substr(0,c))),r[n]=u||l,r.splice(n,0,T)}},t.updateStatus=function(){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag;n&r.textDirty&&this._updateTexture(),exports.cc.Node.RenderCmd.prototype.updateStatus.call(this),this._dirtyFlag&r.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty^this._dirtyFlag)},t._syncStatus=function(r){var n=exports.cc.Node._dirtyFlags,s=this._dirtyFlag;s&n.textDirty&&this._updateTexture(),exports.cc.Node.RenderCmd.prototype._syncStatus.call(this,r),(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL||s&n.transformDirty)&&this.transform(r)},t.drawLabels=function(r,n,s){var o=this._node;if(o._shadowEnabled){var a=o._shadowOffset;r.shadowColor=this._shadowColorStr,r.shadowOffsetX=a.x,r.shadowOffsetY=-a.y,r.shadowBlur=o._shadowBlur}var c=o._hAlignment,l=o._vAlignment,h=o._strokeSize;r.font!==this._fontStyleStr&&(r.font=this._fontStyleStr),r.fillStyle=this._fillColorStr;var u=o._strokeEnabled;u&&(r.lineWidth=h*2,r.strokeStyle=this._strokeColorStr),r.textBaseline=exports.cc.LabelTTF._textBaseline[l],r.textAlign=exports.cc.LabelTTF._textAlign[c];for(var _=this._strings.length,d=0;d<_;d++){var f=this._strings[d];u&&r.strokeText(f,n,s[d]),r.fillText(f,n,s[d])}exports.cc.g_NumberOfDraws++}})();(function(){exports.cc.LabelTTF.CacheRenderCmd=function(e){exports.cc.LabelTTF.RenderCmd.call(this,e);var r=this._labelCanvas=document.createElement("canvas");r.width=1,r.height=1,this._labelContext=r.getContext("2d"),this._texRect=exports.cc.rect()},exports.cc.LabelTTF.CacheRenderCmd.prototype=Object.create(exports.cc.LabelTTF.RenderCmd.prototype),exports.cc.inject(exports.cc.LabelTTF.RenderCmd.prototype,exports.cc.LabelTTF.CacheRenderCmd.prototype);var t=exports.cc.LabelTTF.CacheRenderCmd.prototype;t.constructor=exports.cc.LabelTTF.CacheRenderCmd,t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var e=this._node;this._updateTTF();var r=this._texRect.width,n=this._texRect.height,s=this._labelContext,o=this._labelCanvas;if(!e._texture){var a=new exports.cc.Texture2D;a.initWithElement(this._labelCanvas),e.setTexture(a)}if(e._string.length===0)return o.width=r,o.height=n,e._texture&&e._texture.handleLoadedTexture(),e.setTextureRect(this._texRect),!0;s.font=this._fontStyleStr;var c=o.width===r&&o.height===n;return o.width=this._texRect.width,o.height=this._texRect.height,c&&s.clearRect(0,0,r,n),this._saveStatus(),this._drawTTFInCanvas(s),e._texture&&e._texture.handleLoadedTexture(),e.setTextureRect(this._texRect),!0},t._measureConfig=function(){this._labelContext.font=this._fontStyleStr},t._measure=function(e){return this._labelContext.measureText(e).width}})();(function(){exports.cc.LabelTTF.CacheCanvasRenderCmd=function(e){exports.cc.Sprite.CanvasRenderCmd.call(this,e),exports.cc.LabelTTF.CacheRenderCmd.call(this)};var t=exports.cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(exports.cc.Sprite.CanvasRenderCmd.prototype);exports.cc.inject(exports.cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=exports.cc.LabelTTF.CacheCanvasRenderCmd})();(function(){exports.cc.LabelTTF.CanvasRenderCmd=function(e){exports.cc.Sprite.CanvasRenderCmd.call(this,e),exports.cc.LabelTTF.RenderCmd.call(this)},exports.cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(exports.cc.Sprite.CanvasRenderCmd.prototype),exports.cc.inject(exports.cc.LabelTTF.RenderCmd.prototype,exports.cc.LabelTTF.CanvasRenderCmd.prototype);var t=exports.cc.LabelTTF.CanvasRenderCmd.prototype;t.constructor=exports.cc.LabelTTF.CanvasRenderCmd,t._measureConfig=function(){},t._measure=function(e){var r=exports.cc._renderContext.getContext();return r.font=this._fontStyleStr,r.measureText(e).width},t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var e=this._node;return exports.cc.view.getDevicePixelRatio(),this._updateTTF(),e._string.length===0?(e.setTextureRect(this._texRect),!0):(this._saveStatus(),e.setTextureRect(this._texRect),!0)},t.rendering=function(e){var r=exports.cc.view.getScaleX(),n=exports.cc.view.getScaleY(),s=e||exports.cc._renderContext,o=s.getContext();if(o){var a=this._node;if(s.computeRealOffsetY(),!(this._status.length<=0)){var c=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,l=this._status[c];this._renderingIndex=c+1;var h=a._rect.height,u=a._offsetPosition.x,_=-a._offsetPosition.y-h,d=this._displayedOpacity/255;s.setTransform(this._worldTransform,r,n),s.setCompositeOperation(this._blendFuncStr),s.setGlobalAlpha(d),s.save(),a._flippedX&&(u=-u-a._rect.width,o.scale(-1,1)),a._flippedY&&(_=a._offsetPosition.y,o.scale(1,-1));for(var f=l.xOffset+l.contextTransform.x+u*r,T=[],x=this._strings.length,m=0;m<x;m++)T.push(l.OffsetYArray[m]+l.contextTransform.y+_*n);this.drawLabels(o,f,T),s.restore()}}}})();exports.cc=exports.cc||{};exports.cc._tmp=exports.cc._tmp||{};exports.cc.associateWithNative=function(t,e){};exports.cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};exports.cc.FMT_JPG=0;exports.cc.FMT_PNG=1;exports.cc.FMT_TIFF=2;exports.cc.FMT_RAWDATA=3;exports.cc.FMT_WEBP=4;exports.cc.FMT_UNKNOWN=5;exports.cc.getImageFormatByData=function(t){return t.length>8&&t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71&&t[4]===13&&t[5]===10&&t[6]===26&&t[7]===10?exports.cc.FMT_PNG:t.length>2&&(t[0]===73&&t[1]===73||t[0]===77&&t[1]===77||t[0]===255&&t[1]===216)?exports.cc.FMT_TIFF:exports.cc.FMT_UNKNOWN};exports.cc.inherits=function(t,e){function r(){}r.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new r,t.prototype.constructor=t};exports.cc.base=function(t,e,r){var n=arguments.callee.caller;if(n.superClass_)return ret=n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1)),ret;for(var s=Array.prototype.slice.call(arguments,2),o=!1,a=t.constructor;a;a=a.superClass_&&a.superClass_.constructor)if(a.prototype[e]===n)o=!0;else if(o)return a.prototype[e].apply(t,s);if(t[e]===n)return t.constructor.prototype[e].apply(t,s);throw Error("cc.base called from a method of one name to a method of a different name")};(function(){var t=888,e=function(r){this.gl=r,this.vertexBuffer=r.createBuffer(),this.size=t,this.byteLength=t*4*exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this.data=new ArrayBuffer(this.byteLength),this.dataArray=new Float32Array(this.data),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,this.dataArray,r.DYNAMIC_DRAW),this._dirty=!1,this._spaces={0:this.byteLength}};return e.prototype={constructor:e,allocBuffer:function(r,n){var s=this._spaces[r];if(s&&s>=n){if(delete this._spaces[r],s>n){var o=r+n;this._spaces[o]=s-n}return!0}else return!1},requestBuffer:function(r){var n,s,o;for(n in this._spaces)if(s=parseInt(n),o=this._spaces[n],o>=r&&this.allocBuffer(s,r))return{buffer:this,offset:s,size:r};return null},freeBuffer:function(r,n){var s=this._spaces,o,a,c;for(a in s){if(o=parseInt(a),o>r)break;if(o+s[a]>=r){n=n+r-o,r=o;break}}c=r+n,this._spaces[c]&&(n+=this._spaces[c],delete this._spaces[c]),this._spaces[r]=n},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer),this.data=null,this.positions=null,this.colors=null,this.texCoords=null,this.vertexBuffer=null}},e})();exports.cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1/1e4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:exports.cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_canUseDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t=this._renderCmds,e,r,n=this._dirtyRegion,s=0,o=!0,a=exports.cc.Node.CanvasRenderCmd.RegionStatus;for(e=0,r=t.length;e<r;e++){var c=t[e],l=c._regionFlag,h=c._oldRegion,u=c._currentRegion;l>a.NotDirty&&(++s,s>this._dirtyRegionCountThreshold&&(o=!1),o&&(!u.isEmpty()&&n.addRegion(u),c._regionFlag>a.Dirty&&!h.isEmpty()&&n.addRegion(h)),c._regionFlag=a.NotDirty)}return o},_beginDrawDirtyRegion:function(t){var e=t.getContext(),r=this._dirtyRegion.getDirtyRegions();e.save();var n=t._scaleX,s=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,s),e.beginPath();for(var o=0,a=r.length;o<a;++o){var c=r[o];e.rect(c._minX,-c._maxY,c._width,c._height)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),r=this._dirtyRegion.getDirtyRegions(),n=t._scaleX,s=t._scaleY;t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},n,s),e.beginPath();for(var o=0,a=r.length;o<a;++o){var c=r[o];e.rect(c._minX,-c._maxY,c._width,c._height)}var l=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=l}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new exports.cc.DirtyRegion,r=exports.cc._canvas,n=t||exports.cc._renderContext,s=n.getContext(),o=exports.cc.view.getScaleX(),a=exports.cc.view.getScaleY();n.setViewScale(o,a),n.computeRealOffsetY();var c=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,h,u,_=this._allNeedDraw||!this._enableDirtyRegion||!this._canUseDirtyRegion,d=!0;for(_||(d=this._collectDirtyRegion()),_=_||!d,_||this._beginDrawDirtyRegion(n),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,r.width,r.height),(this._clearColor.r!==0||this._clearColor.g!==0||this._clearColor.b!==0)&&(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),s.fillRect(0,0,r.width,r.height)),h=0,u=l.length;h<u;h++){var f=l[h],T=!1,x=f._currentRegion;if(!x||_)T=!0;else for(var m=0,v=c.length;m<v;++m)if(c[m].intersects(x)){T=!0;break}T&&f.rendering(n,o,a)}_||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(s)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,r,n){t||exports.cc.log("The context of RenderTexture is invalid."),r=exports.cc.isUndefined(r)?1:r,n=exports.cc.isUndefined(n)?1:n,e=e||this._currentID;var s=this._cacheToCanvasCmds[e],o,a;for(t.computeRealOffsetY(),o=0,a=s.length;o<a;o++)s[o].rendering(t,r,n);this._removeCache(e);var c=this._cacheInstanceIds;c.length===0?this._isCacheToCanvasOn=!1:this._currentID=c[c.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],this._cacheInstanceIds.indexOf(t)===-1&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var r=this._cacheInstanceIds;exports.cc.arrayRemoveObject(r,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,r=t.length;e<r;e++)t[e]._dirtyFlag!==0&&t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0,this._canUseDirtyRegion=!0},pushRenderCommand:function(t){if(t.needDraw())if(t._canUseDirtyRegion||(this._canUseDirtyRegion=!1),this._isCacheToCanvasOn){var e=this._currentID,r=this._cacheToCanvasCmds,n=r[e];n.indexOf(t)===-1&&n.push(t)}else this._renderCmds.indexOf(t)===-1&&this._renderCmds.push(t)}};(function(){exports.cc.CanvasContextWrapper=function(e){this._context=e,this._saveCount=0,this._currentAlpha=e.globalAlpha,this._currentCompositeOperation=e.globalCompositeOperation,this._currentFillStyle=e.fillStyle,this._currentStrokeStyle=e.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=exports.cc.CanvasContextWrapper.prototype;t.resetCache=function(){var e=this._context;this._currentAlpha=e.globalAlpha,this._currentCompositeOperation=e.globalCompositeOperation,this._currentFillStyle=e.fillStyle,this._currentStrokeStyle=e.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(e,r){this._offsetX=e,this._offsetY=r,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(e,r){this._scaleX=e,this._scaleY=r},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._saveCount--},t.setGlobalAlpha=function(e){this._saveCount>0?this._context.globalAlpha=e:this._currentAlpha!==e&&(this._currentAlpha=e,this._context.globalAlpha=e)},t.setCompositeOperation=function(e){this._saveCount>0?this._context.globalCompositeOperation=e:this._currentCompositeOperation!==e&&(this._currentCompositeOperation=e,this._context.globalCompositeOperation=e)},t.setFillStyle=function(e){this._saveCount>0?this._context.fillStyle=e:this._currentFillStyle!==e&&(this._currentFillStyle=e,this._context.fillStyle=e)},t.setStrokeStyle=function(e){this._saveCount>0?this._context.strokeStyle=e:this._currentStrokeStyle!==e&&(this._currentStrokeStyle=e,this._context.strokeStyle=e)},t.setTransform=function(e,r,n){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(e.a*r,-e.b*n,-e.c*r,e.d*n,e.tx*r,-(e.ty*n))):this._context.setTransform(e.a*r,-e.b*n,-e.c*r,e.d*n,this._offsetX+e.tx*r,this._realOffsetY-e.ty*n)},t._switchToArmatureMode=function(e,r,n,s){e?(this._armatureMode++,this._context.setTransform(r.a,r.c,r.b,r.d,this._offsetX+r.tx*n,this._realOffsetY-r.ty*s),this.save()):(this._armatureMode--,this.restore())}})();var Region=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},regionProto=Region.prototype,regionPool=[];function regionCreate(){var t=regionPool.pop();return t||(t=new Region),t}function regionRelease(t){regionPool.push(t)}regionProto.setTo=function(t,e,r,n){return this._minX=t,this._minY=e,this._maxX=r,this._maxY=n,this.updateArea(),this};regionProto.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()};regionProto.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height};regionProto.union=function(t){if(this._width<=0||this._height<=0){this.setTo(t._minX,t._minY,t._maxX,t._maxY);return}this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),this.updateArea()};regionProto.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0};regionProto.isEmpty=function(){return this._width<=0||this._height<=0};regionProto.intersects=function(t){if(this._width<=0||this._height<=0||t._width<=0||t._height<=0)return!1;var e=this._minX>t._minX?this._minX:t._minX,r=this._maxX<t._maxX?this._maxX:t._maxX;return e>r?!1:(e=this._minY>t._minY?this._minY:t._minY,r=this._maxY<t._maxY?this._maxY:t._maxY,e<=r)};regionProto.updateRegion=function(t,e){if(t.width==0||t.height==0){this.setEmpty();return}var r=e,n=r.a,s=r.b,o=r.c,a=r.d,c=r.tx,l=r.ty,h=t.x,u=t.y,_=h+t.width,d=u+t.height,f,T,x,m;if(n==1&&s==0&&o==0&&a==1)f=h+c-1,T=u+l-1,x=_+c+1,m=d+l+1;else{var v=n*h+o*u+c,A=s*h+a*u+l,D=n*_+o*u+c,N=s*_+a*u+l,z=n*_+o*d+c,M=s*_+a*d+l,J=n*h+o*d+c,U=s*h+a*d+l,K=0;v>D&&(K=v,v=D,D=K),z>J&&(K=z,z=J,J=K),f=(v<z?v:z)-1,x=(D>J?D:J)+1,A>N&&(K=A,A=N,N=K),M>U&&(K=M,M=U,U=K),T=(A<M?A:M)-1,m=(N>U?N:U)+1}this._minX=f,this._minY=T,this._maxX=x,this._maxY=m,this._width=x-f,this._height=m-T,this._area=this._width*this._height};function unionArea(t,e){var r=t._minX<e._minX?t._minX:e._minX,n=t._minY<e._minY?t._minY:e._minY,s=t._maxX>e._maxX?t._maxX:e._maxX,o=t._maxY>e._maxY?t._maxY:e._maxY;return(s-r)*(o-n)}var DirtyRegion=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},dirtyRegionProto=DirtyRegion.prototype;dirtyRegionProto.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight};dirtyRegionProto.addRegion=function(t){var e=t._minX,r=t._minY,n=t._maxX,s=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),r<0&&(r=0),n>this.clipWidth&&(n=this.clipWidth),s>this.clipHeight&&(s=this.clipHeight)),e>=n||r>=s)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,a=regionCreate();return o.push(a.setTo(e,r,n,s)),this.mergeDirtyList(o),!0};dirtyRegionProto.clear=function(){for(var t=this.dirtyList,e=t.length,r=0;r<e;r++)regionRelease(t[r]);t.length=0};dirtyRegionProto.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=regionCreate();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var r=this.dirtyList.length;if(r>0)for(var n=0;n<r;n++)this.dirtyList[n].intValues();return this.dirtyList};dirtyRegionProto.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var r=this.hasClipRect,n=e>3?Number.POSITIVE_INFINITY:0,s=0,o=0,a=0,c=0;c<e-1;c++){var l=t[c];r&&(a+=l.area);for(var h=c+1;h<e;h++){var u=t[h],_=unionArea(l,u)-l.area-u.area;n>_&&(s=c,o=h,n=_)}}if(r&&a/this.clipArea>.95&&(this.clipRectChanged=!0),s!=o){var d=t[o];return t[s].union(d),regionRelease(d),t.splice(o,1),!0}return!1};exports.cc.Region=Region;exports.cc.DirtyRegion=DirtyRegion;exports.cc.profiler=function(){var t=!1,e=!1,r=0,n=0,s=0,o=0,a=null,c=document.createElement("div"),l=document.createElement("div"),h=document.createElement("div"),u=document.createElement("div"),_=.6,d=10,f=[0,10,20,30],T=[0,0,0,0],x=3,m=0,v=0;u.id="fps",u.style.position="absolute",u.style.padding="3px",u.style.textAlign="left",u.style.backgroundColor="rgb(0, 0, 34)",u.style.bottom=exports.cc.DIRECTOR_STATS_POSITION.y+"0px",u.style.left=exports.cc.DIRECTOR_STATS_POSITION.x+"px",u.style.width="45px",u.style.height="60px";for(var A=[h,l,c],D=0;D<3;++D){var N=A[D].style;N.color="rgb(0, 255, 255)",N.font="bold 12px Helvetica, Arial",N.lineHeight="20px",N.width="100%",u.appendChild(A[D])}var z=function(U){var K=f.length-1,tt=K,rt,I=0;for(m++,v+=U;tt>=0;tt--)if(U>=f[tt]){T[tt]++;break}if(m>=d){for(I=v/d,tt=K;tt>0;tt--)if(rt=T[tt]/d,rt>=_&&I>=f[tt]){tt!=x&&(x=tt,J.onFrameRateChange&&J.onFrameRateChange(I.toFixed(2)));break}for(_changeCount=0,m=0,v=0,tt=K;tt>0;tt--)T[tt]=0}},M=function(){s=exports.cc.director.getSecondsPerFrame(),r++,o+=exports.cc.director.getDeltaTime(),o>exports.cc.DIRECTOR_FPS_INTERVAL&&(n=r/o,r=0,o=0,J.onFrameRateChange&&z(n),t&&(l.innerText=s.toFixed(3),c.innerText=n.toFixed(1),h.innerText=(0|exports.cc.g_NumberOfDraws).toString()))},J={onFrameRateChange:null,getSecondsPerFrame:function(){return s},getFrameRate:function(){return n},setProfileDuration:function(U){!isNaN(U)&&U>0&&(d=U/exports.cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){exports.cc.eventManager.addListener(a,1)},stopProfiling:function(){exports.cc.eventManager.removeListener(a)},isShowingStats:function(){return t},showStats:function(){e||this.init(),u.parentElement===null&&exports.cc.container.appendChild(u),t=!0},hideStats:function(){t=!1,u.parentElement===exports.cc.container&&exports.cc.container.removeChild(u)},init:function(){e||(a=exports.cc.eventManager.addCustomListener(exports.cc.Director.EVENT_AFTER_VISIT,M),e=!0)}};return J}();exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL){exports.cc.DirectorDelegate=exports.cc.Class.extend({updateProjection:function(){}});var t=exports.cc.Director.prototype,e=function(r){if(r&&r._renderCmd){r._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty);var n,s=r._children;for(n=0;n<s.length;n++)e(s[n])}};exports.cc.eventManager.addCustomListener(exports.cc.Director.EVENT_PROJECTION_CHANGED,function(){exports.cc.director;for(var r=exports.cc.director._scenesStack,n=0;n<r.length;n++)e(r[n])}),t.setProjection=function(r){var n=this||window,s=n._winSizeInPoints;n.setViewport();var o=n._openGLView,a=o._viewPortRect.x/o._scaleX,c=o._viewPortRect.y/o._scaleY;switch(r){case exports.cc.Director.PROJECTION_2D:exports.cc.kmGLMatrixMode(exports.cc.KM_GL_PROJECTION),exports.cc.kmGLLoadIdentity();var l=exports.cc.math.Matrix4.createOrthographicProjection(0,s.width,0,s.height,-1024,1024);exports.cc.kmGLMultMatrix(l),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.kmGLLoadIdentity();break;case exports.cc.Director.PROJECTION_3D:var h=n.getZEye(),u=new exports.cc.math.Matrix4,_=new exports.cc.math.Matrix4;exports.cc.kmGLMatrixMode(exports.cc.KM_GL_PROJECTION),exports.cc.kmGLLoadIdentity(),u=exports.cc.math.Matrix4.createPerspectiveProjection(60,s.width/s.height,.1,h*2),exports.cc.kmGLMultMatrix(u),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.kmGLLoadIdentity();var d=new exports.cc.math.Vec3(-a+s.width/2,-c+s.height/2,h),f=new exports.cc.math.Vec3(-a+s.width/2,-c+s.height/2,0),T=new exports.cc.math.Vec3(0,1,0);_.lookAt(d,f,T),exports.cc.kmGLMultMatrix(_);break;case exports.cc.Director.PROJECTION_CUSTOM:n._projectionDelegate&&n._projectionDelegate.updateProjection();break;default:exports.cc.log(exports.cc._LogInfos.Director_setProjection);break}n._projection=r,exports.cc.eventManager.dispatchEvent(n._eventProjectionChanged),exports.cc.setProjectionMatrixDirty(),exports.cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(r){exports.cc.renderer.setDepthTest(r)},t.setClearColor=function(r){exports.cc.renderer._clearColor=r},t.setOpenGLView=function(r){var n=this||window;n._winSizeInPoints.width=exports.cc._canvas.width,n._winSizeInPoints.height=exports.cc._canvas.height,n._openGLView=r||exports.cc.view;var s=exports.cc.configuration;s.gatherGPUInfo(),s.dumpInfo(),n.setGLDefaultValues(),exports.cc.eventManager&&exports.cc.eventManager.setEnabled(!0)},t._clear=function(){var r=exports.cc._renderContext;r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var r=this._openGLView;if(r){var n=this._winSizeInPoints;r.setViewPortInPoints(-r._viewPortRect.x/r._scaleX,-r._viewPortRect.y/r._scaleY,n.width,n.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(r){r?exports.cc.glBlendFunc(exports.cc.BLEND_SRC,exports.cc.BLEND_DST):exports.cc.glBlendFunc(exports.cc._renderContext.ONE,exports.cc._renderContext.ZERO)},t.setGLDefaultValues=function(){var r=this||window;r.setAlphaBlending(!0),r.setProjection(r._projection),exports.cc._renderContext.clearColor(0,0,0,0)}}});exports.cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=exports.cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=exports.cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var r=this._valueDict;return r[t]?r[t]:e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){exports.cc.ENABLE_GL_STATE_CACHE===0&&(exports.cc.log(""),exports.cc.log(exports.cc._LogInfos.configuration_dumpInfo),exports.cc.log(""))},gatherGPUInfo:function(){if(exports.cc._renderType!==exports.cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=exports.cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var r=t.getSupportedExtensions(),n=0;n<r.length;n++)this._GlExtensions+=r[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,exports.cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=exports.cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);exports.cc.assert(e,exports.cc._LogInfos.configuration_loadConfigFile_2,t);var r=e.data;if(!r){exports.cc.log(exports.cc._LogInfos.configuration_loadConfigFile,t);return}for(var n in r)this._valueDict[n]=r[n]}};exports.cc.rendererWebGL=function(){var t={texture:null,blendSrc:null,blendDst:null,shader:null},e=null,r=null,n=0,s=0,o=6,a=null,c=0,l=null,h=null;function u(d){var f=exports.cc._renderContext;if(e){f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e);for(var T=new Uint16Array(d*6),x=0,m=0,v=d*6;m<v;m+=6)T[m]=x+0,T[m+1]=x+1,T[m+2]=x+2,T[m+3]=x+1,T[m+4]=x+2,T[m+5]=x+3,x+=4;f.bufferData(f.ELEMENT_ARRAY_BUFFER,T,f.STATIC_DRAW)}if(r){c=d*4*o;var A=c*4;a=new ArrayBuffer(A),l=new Float32Array(a),h=new Uint32Array(a),f.bindBuffer(f.ARRAY_BUFFER,r),f.bufferData(f.ARRAY_BUFFER,l,f.DYNAMIC_DRAW)}n=d*4}function _(d){var f=exports.cc._renderContext;e===null&&(r=f.createBuffer(),e=f.createBuffer()),u(d)}return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:1/100,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:exports.cc.color(),init:function(){var d=exports.cc._renderContext;d.disable(d.CULL_FACE),d.disable(d.DEPTH_TEST),this.mat4Identity=new exports.cc.math.Matrix4,this.mat4Identity.identity(),_(2e3),exports.cc.sys.os,exports.cc.sys.OS_IOS},getVertexSize:function(){return n},getRenderCmd:function(d){return d._createRenderCmd()},_turnToCacheMode:function(d){this._isCacheToBufferOn=!0,d=d||0,this._cacheToBufferCmds[d]?this._cacheToBufferCmds[d].length=0:this._cacheToBufferCmds[d]=[],this._cacheInstanceIds.indexOf(d)===-1&&this._cacheInstanceIds.push(d),this._currentID=d},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(d){d=d||this._currentID;var f=this._cacheToBufferCmds[d];f&&(f.length=0,delete this._cacheToBufferCmds[d]);var T=this._cacheInstanceIds;exports.cc.arrayRemoveObject(T,d)},_renderingToBuffer:function(d){d=d||this._currentID;var f=this._cacheToBufferCmds[d],T=exports.cc._renderContext;this.rendering(T,f),this._removeCache(d);var x=this._cacheInstanceIds;x.length===0?this._isCacheToBufferOn=!1:this._currentID=x[x.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var d=this._transformNodePool;d.sort(this._sortNodeByLevelAsc);var f,T,x;for(f=0,T=d.length;f<T;f++)x=d[f],x.updateStatus();d.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(d,f){return d._curLevel-f._curLevel},pushDirtyNode:function(d){this._transformNodePool.push(d)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var d=exports.cc._renderContext;d.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)},setDepthTest:function(d){var f=exports.cc._renderContext;d?(f.clearDepth(1),f.enable(f.DEPTH_TEST),f.depthFunc(f.LEQUAL)):f.disable(f.DEPTH_TEST)},pushRenderCommand:function(d){if(d.needDraw())if(this._isCacheToBufferOn){var f=this._currentID,T=this._cacheToBufferCmds,x=T[f];x.indexOf(d)===-1&&x.push(d)}else this._renderCmds.indexOf(d)===-1&&this._renderCmds.push(d)},_increaseBatchingSize:function(d){s+=d},_uploadBufferData:function(d){s>=n&&this._batchRendering();var f=d._node._texture,T=d._node._blendFunc.src,x=d._node._blendFunc.dst,m=d._shaderProgram;(t.texture!==f||t.blendSrc!==T||t.blendDst!==x||t.shader!==m)&&(this._batchRendering(),t.texture=f,t.blendSrc=T,t.blendDst=x,t.shader=m);var v=d.uploadData(l,h,s*o);v>0&&(s+=v)},_batchRendering:function(){if(!(s===0||!t.texture)){var d=exports.cc._renderContext,f=t.texture,T=t.shader,x=s/4;T&&(T.use(),T._updateProjectionUniform()),exports.cc.glBlendFunc(t.blendSrc,t.blendDst),exports.cc.glBindTexture2DN(0,f);var m=!d.bindBuffer(d.ARRAY_BUFFER,r);if(s>n*.5)d.bufferData(d.ARRAY_BUFFER,l,d.DYNAMIC_DRAW);else{var v=l.subarray(0,s*o);d.bufferData(d.ARRAY_BUFFER,v,d.DYNAMIC_DRAW)}m&&(d.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),d.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),d.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),d.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,d.FLOAT,!1,24,0),d.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,d.UNSIGNED_BYTE,!0,24,12),d.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,d.FLOAT,!1,24,16)),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e),d.drawElements(d.TRIANGLES,x*6,d.UNSIGNED_SHORT,0),exports.cc.g_NumberOfDraws++,s=0}},rendering:function(d,f){var T=f||this._renderCmds,x,m,v,A=d||exports.cc._renderContext;for(A.bindBuffer(gl.ARRAY_BUFFER,null),x=0,m=T.length;x<m;++x)v=T[x],v.uploadData?this._uploadBufferData(v):(s>0&&this._batchRendering(),v.rendering(A));this._batchRendering(),t.texture=null}}}();(function(){exports.cc.Node.WebGLRenderCmd=function(e){exports.cc.Node.RenderCmd.call(this,e),this._shaderProgram=null};var t=exports.cc.Node.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.RenderCmd.prototype);t.constructor=exports.cc.Node.WebGLRenderCmd,t._updateColor=function(){},t.setShaderProgram=function(e){this._shaderProgram=e},t.getShaderProgram=function(){return this._shaderProgram}})();(function(){exports.cc.Layer.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e)};var t=exports.cc.Layer.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}})();(function(){exports.cc.LayerColor.WebGLRenderCmd=function(e){exports.cc.Layer.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity();var r=this||window;r._squareVerticesAB=new ArrayBuffer(48),r._squareColorsAB=new ArrayBuffer(16);var n=r._squareVerticesAB,s=r._squareColorsAB,o=exports.cc.Vertex3F.BYTES_PER_ELEMENT,a=exports.cc.Color.BYTES_PER_ELEMENT;r._squareVertices=[new exports.cc.Vertex3F(0,0,0,n,0),new exports.cc.Vertex3F(0,0,0,n,o),new exports.cc.Vertex3F(0,0,0,n,o*2),new exports.cc.Vertex3F(0,0,0,n,o*3)],r._squareColors=[exports.cc.color(0,0,0,255,s,0),exports.cc.color(0,0,0,255,s,a),exports.cc.color(0,0,0,255,s,a*2),exports.cc.color(0,0,0,255,s,a*3)],r._verticesFloat32Buffer=exports.cc._renderContext.createBuffer(),r._colorsUint8Buffer=exports.cc._renderContext.createBuffer(),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_COLOR)};var t=exports.cc.LayerColor.WebGLRenderCmd.prototype=Object.create(exports.cc.Layer.WebGLRenderCmd.prototype);t.constructor=exports.cc.LayerColor.WebGLRenderCmd,t.rendering=function(e){var r=e||exports.cc._renderContext,n=this._node,s=this._worldTransform;this._matrix.mat[0]=s.a,this._matrix.mat[4]=s.c,this._matrix.mat[12]=s.tx,this._matrix.mat[1]=s.b,this._matrix.mat[5]=s.d,this._matrix.mat[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),exports.cc.glBlendFunc(n._blendFunc.src,n._blendFunc.dst),r.bindBuffer(r.ARRAY_BUFFER,this._verticesFloat32Buffer),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._colorsUint8Buffer),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,r.UNSIGNED_BYTE,!0,0,0),r.drawArrays(r.TRIANGLE_STRIP,0,this._squareVertices.length)},t.transform=function(e,r){this.originTransform(e,r);var n=this._node,s=n._contentSize.width,o=n._contentSize.height,a=this._squareVertices;a[1].x=s,a[2].y=o,a[3].x=s,a[3].y=o,a[0].z=a[1].z=a[2].z=a[3].z=n._vertexZ,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var e=this._displayedColor,r=this._displayedOpacity,n=this._squareColors,s=0;s<4;s++)n[s].r=e.r,n[s].g=e.g,n[s].b=e.b,n[s].a=r;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var e=exports.cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.bufferData(e.ARRAY_BUFFER,this._squareVerticesAB,e.DYNAMIC_DRAW)},t._bindLayerColorsBufferData=function(){var e=exports.cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.bufferData(e.ARRAY_BUFFER,this._squareColorsAB,e.STATIC_DRAW)},t.updateBlendFunc=function(e){}})();(function(){exports.cc.LayerGradient.WebGLRenderCmd=function(e){exports.cc.LayerColor.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._clipRect=new exports.cc.Rect,this._clippingRectDirty=!1};var t=exports.cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(exports.cc.LayerColor.WebGLRenderCmd.prototype);t.constructor=exports.cc.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var e=exports.cc.Node._dirtyFlags,r=this._dirtyFlag;r&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag=r&e.gradientDirty^r),exports.cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(e){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag;n&r.gradientDirty&&(this._dirtyFlag|=r.colorDirty,this._updateVertex(),this._dirtyFlag=n&r.gradientDirty^n),exports.cc.Node.RenderCmd.prototype._syncStatus.call(this,e)},t.transform=function(e,r){this.originTransform(e,r),this._updateVertex()},t._updateVertex=function(){var e=this._node,r=e._colorStops;if(!(!r||r.length<2)){this._clippingRectDirty=!0;var n=r.length,s=n*2,o,a=e._contentSize,c=this._squareVertices;if(c.length<s){this._squareVerticesAB=new ArrayBuffer(s*12),c.length=0;var l=this._squareVerticesAB,h=exports.cc.Vertex3F.BYTES_PER_ELEMENT;for(o=0;o<s;o++)c.push(new exports.cc.Vertex3F(0,0,0,l,h*o))}var u=Math.PI+exports.cc.pAngleSigned(exports.cc.p(0,-1),e._alongVector),_=exports.cc.p(a.width/2,a.height/2),d=Math.round(exports.cc.radiansToDegrees(u)),f=exports.cc.affineTransformMake(1,0,0,1,_.x,_.y);f=exports.cc.affineTransformRotate(f,u);var T,x;d<90?(T=exports.cc.p(-_.x,_.y),x=exports.cc.p(_.x,_.y)):d<180?(T=exports.cc.p(_.x,_.y),x=exports.cc.p(_.x,-_.y)):d<270?(T=exports.cc.p(_.x,-_.y),x=exports.cc.p(-_.x,-_.y)):(T=exports.cc.p(-_.x,-_.y),x=exports.cc.p(-_.x,_.y));var m=Math.sin(u),v=Math.cos(u),A=Math.abs((T.x*v-T.y*m)/_.x),D=Math.abs((x.x*m+x.y*v)/_.y);for(f=exports.cc.affineTransformScale(f,A,D),o=0;o<n;o++){var N=r[o],z=N.p*a.height,M=exports.cc.pointApplyAffineTransform(-_.x,z-_.y,f);c[o*2].x=M.x,c[o*2].y=M.y,c[o*2].z=e._vertexZ;var J=exports.cc.pointApplyAffineTransform(a.width-_.x,z-_.y,f);c[o*2+1].x=J.x,c[o*2+1].y=J.y,c[o*2+1].z=e._vertexZ}this._bindLayerVerticesBufferData()}},t._updateColor=function(){var e=this._node,r=e._colorStops;if(!(!r||r.length<2)){var n=r.length,s=this._squareColors,o=n*2;if(s.length<o){this._squareColorsAB=new ArrayBuffer(o*4),s.length=0;var a=this._squareColorsAB,c=exports.cc.Color.BYTES_PER_ELEMENT;for(i=0;i<o;i++)s.push(exports.cc.color(0,0,0,255,a,c*i))}var l=this._displayedOpacity/255;for(i=0;i<n;i++){var h=r[i].color,u=s[i*2],_=s[i*2+1];u.r=h.r,u.g=h.g,u.b=h.b,u.a=h.a*l,_.r=h.r,_.g=h.g,_.b=h.b,_.a=h.a*l}this._bindLayerColorsBufferData()}},t.rendering=function(e){var r=e||exports.cc._renderContext,n=this._node,s=this._getClippingRect();r.enable(r.SCISSOR_TEST),exports.cc.view.setScissorInPoints(s.x,s.y,s.width,s.height);var o=this._worldTransform;this._matrix.mat[0]=o.a,this._matrix.mat[4]=o.c,this._matrix.mat[12]=o.tx,this._matrix.mat[1]=o.b,this._matrix.mat[5]=o.d,this._matrix.mat[13]=o.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),exports.cc.glBlendFunc(n._blendFunc.src,n._blendFunc.dst),r.bindBuffer(r.ARRAY_BUFFER,this._verticesFloat32Buffer),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._colorsUint8Buffer),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,r.UNSIGNED_BYTE,!0,0,0),r.drawArrays(r.TRIANGLE_STRIP,0,this._squareVertices.length),r.disable(r.SCISSOR_TEST)},t._getClippingRect=function(){if(this._clippingRectDirty){var e=this._node,r=exports.cc.rect(0,0,e._contentSize.width,e._contentSize.height),n=e.getNodeToWorldTransform();this._clipRect=exports.cc._rectApplyAffineTransformIn(r,n)}return this._clipRect}})();(function(){exports.cc.Sprite.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var t=exports.cc.Sprite.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(e){},t.setDirtyFlag=function(e){exports.cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,e),this._dirty=!0},t.setDirtyRecursively=function(e){this._recursiveDirty=e,this._dirty=e;for(var r=this._node._children,n,s=r?r.length:0,o=0;o<s;o++)n=r[o],n instanceof exports.cc.Sprite&&n._renderCmd.setDirtyRecursively(e)},t._setBatchNodeForAddChild=function(e){var r=this._node;if(r._batchNode){if(!(e instanceof exports.cc.Sprite))return exports.cc.log(exports.cc._LogInfos.Sprite_addChild),!1;e.texture._webTextureObj!==r.textureAtlas.texture._webTextureObj&&exports.cc.log(exports.cc._LogInfos.Sprite_addChild_2),r._batchNode.appendChild(e),r._reorderChildDirty||r._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(e){return e},t.isFrameDisplayed=function(e){var r=this._node;return exports.cc.rectEqualToRect(e.getRect(),r._rect)&&e.getTexture().getName()===r._texture.getName()&&exports.cc.pointEqualToPoint(e.getOffset(),r._unflippedOffsetPositionFromCenter)},t._textureLoadedCallback=function(e){if(!this._textureLoaded){this._textureLoaded=!0;var r=this._rect;r?exports.cc._rectEqualToZero(r)&&(r.width=e.width,r.height=e.height):r=exports.cc.rect(0,0,e.width,e.height),this.texture=e,this.setTextureRect(r,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),exports.cc.renderer.childrenOrderDirty=!0}},t._setTextureCoords=function(e,r){r===void 0&&(r=!0),r&&(e=exports.cc.rectPointsToPixels(e));var n=this._node,s=n._batchNode?n.textureAtlas.texture:n._texture,o=this._vertices;if(s){var a=s.pixelsWidth,c=s.pixelsHeight,l,h,u,_,d;n._rectRotated?(exports.cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(l=(2*e.x+1)/(2*a),h=l+(e.height*2-2)/(2*a),u=(2*e.y+1)/(2*c),_=u+(e.width*2-2)/(2*c)):(l=e.x/a,h=(e.x+e.height)/a,u=e.y/c,_=(e.y+e.width)/c),n._flippedX&&(d=u,u=_,_=d),n._flippedY&&(d=l,l=h,h=d),o[0].u=h,o[0].v=u,o[1].u=l,o[1].v=u,o[2].u=h,o[2].v=_,o[3].u=l,o[3].v=_):(exports.cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(l=(2*e.x+1)/(2*a),h=l+(e.width*2-2)/(2*a),u=(2*e.y+1)/(2*c),_=u+(e.height*2-2)/(2*c)):(l=e.x/a,h=(e.x+e.width)/a,u=e.y/c,_=(e.y+e.height)/c),n._flippedX&&(d=l,l=h,h=d),n._flippedY&&(d=u,u=_,_=d),o[0].u=l,o[0].v=u,o[1].u=l,o[1].v=_,o[2].u=h,o[2].v=u,o[3].u=h,o[3].v=_)}},t._setColorDirty=function(){},t._updateBlendFunc=function(){if(this._batchNode){exports.cc.log(exports.cc._LogInfos.Sprite__updateBlendFunc);return}var e=this._node,r=e._blendFunc;!e._texture||!e._texture.hasPremultipliedAlpha()?(r.src===exports.cc.ONE&&r.dst===exports.cc.BLEND_DST&&(r.src=exports.cc.SRC_ALPHA),e.opacityModifyRGB=!1):(r.src===exports.cc.SRC_ALPHA&&r.dst===exports.cc.BLEND_DST&&(r.src=exports.cc.ONE),e.opacityModifyRGB=!0)},t._setTexture=function(e){var r=this._node;if(r._batchNode){if(r._batchNode.texture!==e){exports.cc.log(exports.cc._LogInfos.Sprite_setTexture);return}}else r._texture!==e&&(r._textureLoaded=e?e._textureLoaded:!1,r._texture=e,this._updateBlendFunc(),r._textureLoaded&&(exports.cc.renderer.childrenOrderDirty=!0))},t._checkTextureBoundary=function(e,r,n){if(e&&e.url){var s,o;n?(s=r.x+r.height,o=r.y+r.width):(s=r.x+r.width,o=r.y+r.height),s>e.width&&exports.cc.error(exports.cc._LogInfos.RectWidth,e.url),o>e.height&&exports.cc.error(exports.cc._LogInfos.RectHeight,e.url)}},t.transform=function(e,r){this.originTransform(e,r);var n=this._node,s=n._offsetPosition.x,o=s+n._rect.width,a=n._offsetPosition.y,c=a+n._rect.height,l=this._worldTransform,h=this._vertices;h[0].x=s*l.a+c*l.c+l.tx,h[0].y=s*l.b+c*l.d+l.ty,h[1].x=s*l.a+a*l.c+l.tx,h[1].y=s*l.b+a*l.d+l.ty,h[2].x=o*l.a+c*l.c+l.tx,h[2].y=o*l.b+c*l.d+l.ty,h[3].x=o*l.a+a*l.c+l.tx,h[3].y=o*l.b+a*l.d+l.ty},t.needDraw=function(){var e=this._node,r=e._texture;return this._needDraw&&r},t.uploadData=function(e,r,n){var s=this._node,o=s._texture;if(!(o&&o._textureLoaded&&s._rect.width&&s._rect.height)||!this._displayedOpacity)return!1;var a=this._displayedOpacity,c=this._displayedColor.r,l=this._displayedColor.g,h=this._displayedColor.b;if(s._opacityModifyRGB){var u=a/255;c*=u,l*=u,h*=u}this._color[0]=a<<24|h<<16|l<<8|c;var _=s._vertexZ,d=this._vertices,f,T=d.length,x,m=n;for(f=0;f<T;++f)x=d[f],e[m]=x.x,e[m+1]=x.y,e[m+2]=_,r[m+3]=this._color[0],e[m+4]=x.u,e[m+5]=x.v,m+=6;return T}})();(function(){exports.cc.LabelTTF.WebGLRenderCmd=function(e){exports.cc.Sprite.WebGLRenderCmd.call(this,e),exports.cc.LabelTTF.CacheRenderCmd.call(this)};var t=exports.cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(exports.cc.Sprite.WebGLRenderCmd.prototype);exports.cc.inject(exports.cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=exports.cc.LabelTTF.WebGLRenderCmd,t._updateColor=function(){}})();exports.cc.DrawingPrimitiveWebGL=exports.cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(t==null&&(t=exports.cc._renderContext),!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this||window;t._initialized||(t._shader=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_UCOLOR),t._shader._addUniformLocation(this._colorLocation),t._shader._addUniformLocation(this._pointSizeLocation),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(r),exports.cc.incrementGLDraws(1)},drawPoints:function(t,e){if(!(!t||t.length===0)){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.POINTS,0,t.length),r.deleteBuffer(n),exports.cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(t.length*2),r=0;r<t.length;r++)e[r*2]=t[r].x,e[r*2+1]=t[r].y;return e},drawLine:function(t,e){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),r.STATIC_DRAW),r.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.LINES,0,2),r.deleteBuffer(n),exports.cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(exports.cc.p(t.x,t.y),exports.cc.p(e.x,t.y)),this.drawLine(exports.cc.p(e.x,t.y),exports.cc.p(e.x,e.y)),this.drawLine(exports.cc.p(e.x,e.y),exports.cc.p(t.x,e.y)),this.drawLine(exports.cc.p(t.x,e.y),exports.cc.p(t.x,t.y))},drawSolidRect:function(t,e,r){var n=[t,exports.cc.p(e.x,t.y),e,exports.cc.p(t.x,e.y)];this.drawSolidPoly(n,4,r)},drawPoly:function(t,e,r){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),r?n.drawArrays(n.LINE_LOOP,0,t.length):n.drawArrays(n.LINE_STRIP,0,t.length),n.deleteBuffer(s),exports.cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,r){this.lazy_init(),r&&this.setDrawColor(r.r,r.g,r.b,r.a);var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_FAN,0,t.length),n.deleteBuffer(s),exports.cc.incrementGLDraws(1)},drawCircle:function(t,e,r,n,s){this.lazy_init();var o=1;s&&o++;var a=2*Math.PI/n,c=new Float32Array((n+2)*2);if(c){for(var l=0;l<=n;l++){var h=l*a,u=e*Math.cos(h+r)+t.x,_=e*Math.sin(h+r)+t.y;c[l*2]=u,c[l*2+1]=_}c[(n+1)*2]=t.x,c[(n+1)*2+1]=t.y;var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var f=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,f),d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW),d.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.LINE_STRIP,0,n+o),d.deleteBuffer(f),exports.cc.incrementGLDraws(1)}},drawQuadBezier:function(t,e,r,n){this.lazy_init();for(var s=new Float32Array((n+1)*2),o=0,a=0;a<n;a++)s[a*2]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*r.x,s[a*2+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*r.y,o+=1/n;s[n*2]=r.x,s[n*2+1]=r.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,l),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,n+1),c.deleteBuffer(l),exports.cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,r,n,s){this.lazy_init();for(var o=new Float32Array((s+1)*2),a=0,c=0;c<s;c++)o[c*2]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*r.x+a*a*a*n.x,o[c*2+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*r.y+a*a*a*n.y,a+=1/s;o[s*2]=n.x,o[s*2+1]=n.y;var l=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),l.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,h),l.bufferData(l.ARRAY_BUFFER,o,l.STATIC_DRAW),l.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,l.FLOAT,!1,0,0),l.drawArrays(l.LINE_STRIP,0,s+1),l.deleteBuffer(h),exports.cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,r){this.lazy_init();for(var n=new Float32Array((r+1)*2),s,o,a=1/t.length,c=0;c<r+1;c++){var l=c/r;l===1?(s=t.length-1,o=1):(s=0|l/a,o=(l-a*s)/a);var h=exports.cc.cardinalSplineAt(exports.cc.getControlPointAt(t,s-1),exports.cc.getControlPointAt(t,s),exports.cc.getControlPointAt(t,s+1),exports.cc.getControlPointAt(t,s+2),e,o);n[c*2]=h.x,n[c*2+1]=h.y}var u=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),u.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var _=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,_),u.bufferData(u.ARRAY_BUFFER,n,u.STATIC_DRAW),u.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,r+1),u.deleteBuffer(_),exports.cc.incrementGLDraws(1)},setDrawColor:function(t,e,r,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=r/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t*exports.cc.contentScaleFactor()},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}});var _p=exports.cc.inputManager;_p.setAccelerometerEnabled=function(t){var e=this||window;if(e._accelEnabled!==t){e._accelEnabled=t;var r=exports.cc.director.getScheduler();e._accelEnabled,e._accelCurTime=0,r.scheduleUpdate(e)}};_p.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)};_p._registerKeyboardEvent=function(){exports.cc._canvas.addEventListener("keydown",function(t){exports.cc.eventManager.dispatchEvent(new exports.cc.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),exports.cc._canvas.addEventListener("keyup",function(t){exports.cc.eventManager.dispatchEvent(new exports.cc.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)};_p._registerAccelerometerEvent=function(){var t=window,e=this||window;e._acceleration=new exports.cc.Acceleration,e._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,exports.cc.sys.browserType===exports.cc.sys.BROWSER_TYPE_MOBILE_QQ&&(e._accelDeviceEvent=window.DeviceOrientationEvent);var r=e._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",n=navigator.userAgent;(/Android/.test(n)||/Adr/.test(n)&&exports.cc.sys.browserType===exports.cc.BROWSER_TYPE_UC)&&(e._minus=-1),t.addEventListener(r,e.didAccelerate.bind(e),!1)};_p.didAccelerate=function(t){var e=this,r=window;if(e._accelEnabled){var n=e._acceleration,s,o,a;if(e._accelDeviceEvent===window.DeviceMotionEvent){var c=t.accelerationIncludingGravity;s=e._accelMinus*c.x*.1,o=e._accelMinus*c.y*.1,a=c.z*.1}else s=t.gamma/90*.981,o=-(t.beta/90)*.981,a=t.alpha/90*.981;n.x=s,n.y=o,n.z=a,n.timestamp=t.timeStamp||Date.now();var l=n.x;r.orientation===exports.cc.UIInterfaceOrientationLandscapeRight?(n.x=-n.y,n.y=l):r.orientation===exports.cc.UIInterfaceOrientationLandscapeLeft?(n.x=n.y,n.y=-l):r.orientation===exports.cc.UIInterfaceOrientationPortraitUpsideDown&&(n.x=-n.x,n.y=-n.y)}};_p=null;exports.cc.vertexLineToPolygon=function(t,e,r,n,s){if(s+=n,!(s<=1)){e*=.5;for(var o,a=s-1,c=n;c<s;c++){o=c*2;var l=exports.cc.p(t[c*2],t[c*2+1]),h;if(c===0)h=exports.cc.pPerp(exports.cc.pNormalize(exports.cc.pSub(l,exports.cc.p(t[(c+1)*2],t[(c+1)*2+1]))));else if(c===a)h=exports.cc.pPerp(exports.cc.pNormalize(exports.cc.pSub(exports.cc.p(t[(c-1)*2],t[(c-1)*2+1]),l)));else{var u=exports.cc.p(t[(c-1)*2],t[(c-1)*2+1]),_=exports.cc.p(t[(c+1)*2],t[(c+1)*2+1]),d=exports.cc.pNormalize(exports.cc.pSub(_,l)),f=exports.cc.pNormalize(exports.cc.pSub(u,l)),T=Math.acos(exports.cc.pDot(d,f));T<exports.cc.degreesToRadians(70)?h=exports.cc.pPerp(exports.cc.pNormalize(exports.cc.pMidpoint(d,f))):T<exports.cc.degreesToRadians(170)?h=exports.cc.pNormalize(exports.cc.pMidpoint(d,f)):h=exports.cc.pPerp(exports.cc.pNormalize(exports.cc.pSub(_,u)))}h=exports.cc.pMult(h,e),r[o*2]=l.x+h.x,r[o*2+1]=l.y+h.y,r[(o+1)*2]=l.x-h.x,r[(o+1)*2+1]=l.y-h.y}for(n=n===0?0:n-1,c=n;c<a;c++){o=c*2;var x=o+2,m=exports.cc.vertex2(r[o*2],r[o*2+1]),v=exports.cc.vertex2(r[(o+1)*2],r[(o+1)*2+1]),A=exports.cc.vertex2(r[x*2],r[x*2]),D=exports.cc.vertex2(r[(x+1)*2],r[(x+1)*2+1]),N=!exports.cc.vertexLineIntersect(m.x,m.y,D.x,D.y,v.x,v.y,A.x,A.y);N.isSuccess||(N.value<0||N.value>1)&&(N.isSuccess=!0),N.isSuccess&&(r[x*2]=D.x,r[x*2+1]=D.y,r[(x+1)*2]=A.x,r[(x+1)*2+1]=A.y)}}};exports.cc.vertexLineIntersect=function(t,e,r,n,s,o,a,c){var l,h,u,_;if(t===r&&e===n||s===a&&o===c)return{isSuccess:!1,value:0};if(r-=t,n-=e,s-=t,o-=e,a-=t,c-=e,l=Math.sqrt(r*r+n*n),h=r/l,u=n/l,_=s*h+o*u,o=o*h-s*u,s=_,_=a*h+c*u,c=c*h-a*u,a=_,o===c)return{isSuccess:!1,value:0};var d=(a+(s-a)*c/(c-o))/l;return{isSuccess:!0,value:d}};exports.cc.vertexListIsClockwise=function(t){for(var e=0,r=t.length;e<r;e++){var n=t[e],s=t[(e+1)%r],o=t[(e+2)%r];if(exports.cc.pCross(exports.cc.pSub(s,n),exports.cc.pSub(o,s))>0)return!1}return!0};exports.cc.CGAffineToGL=function(t,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0,e[10]=e[15]=1,e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty};exports.cc.GLToCGAffine=function(t,e){e.a=t[0],e.c=t[4],e.tx=t[12],e.b=t[1],e.d=t[5],e.ty=t[13]};exports.cc.EventAcceleration=exports.cc.Event.extend({_acc:null,ctor:function(t){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.ACCELERATION),this._acc=t}});exports.cc.EventKeyboard=exports.cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(t,e){exports.cc.Event.prototype.ctor.call(this,exports.cc.Event.KEYBOARD),this._keyCode=t,this._isPressed=e}});exports.cc._EventListenerAcceleration=exports.cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t;var e=this||window,r=function(n){e._onAccelerationEvent(n._acc,n)};exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.ACCELERATION,exports.cc._EventListenerAcceleration.LISTENER_ID,r)},checkAvailable:function(){return exports.cc.assert(this._onAccelerationEvent,exports.cc._LogInfos._EventListenerAcceleration_checkAvailable),!0},clone:function(){return new exports.cc._EventListenerAcceleration(this._onAccelerationEvent)}});exports.cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";exports.cc._EventListenerAcceleration.create=function(t){return new exports.cc._EventListenerAcceleration(t)};exports.cc._EventListenerKeyboard=exports.cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var t=this||window,e=function(r){r._isPressed?t.onKeyPressed&&t.onKeyPressed(r._keyCode,r):t.onKeyReleased&&t.onKeyReleased(r._keyCode,r)};exports.cc.EventListener.prototype.ctor.call(this,exports.cc.EventListener.KEYBOARD,exports.cc._EventListenerKeyboard.LISTENER_ID,e)},clone:function(){var t=new exports.cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return this.onKeyPressed===null&&this.onKeyReleased===null?(exports.cc.log(exports.cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}});exports.cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";exports.cc._EventListenerKeyboard.create=function(){return new exports.cc._EventListenerKeyboard};exports.cc.AtlasNode=exports.cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(t,e,r,n){exports.cc.Node.prototype.ctor.call(this),this._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},this._ignoreContentScaleFactor=!1,n!==void 0&&this.initWithTileFile(t,e,r,n)},_createRenderCmd:function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?this._renderCmd=new exports.cc.AtlasNode.CanvasRenderCmd(this):this._renderCmd=new exports.cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){exports.cc.log(exports.cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:exports.cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(t){var e=this.color;this._opacityModifyRGB=t,this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){e===void 0?this._blendFunc=t:this._blendFunc={src:t,dst:e}},setTextureAtlas:function(t){this.textureAtlas=t},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(t){this.quadsToDraw=t},initWithTileFile:function(t,e,r,n){if(!t)throw new Error("cc.AtlasNode.initWithTileFile(): title should not be null");var s=exports.cc.textureCache.addImage(t);return this.initWithTexture(s,e,r,n)},initWithTexture:function(t,e,r,n){return this._renderCmd.initWithTexture(t,e,r,n)},setColor:function(t){this._renderCmd.setColor(t)},setOpacity:function(t){this._renderCmd.setOpacity(t)},getTexture:function(){return this._texture},setTexture:function(t){this._texture=t},_setIgnoreContentScaleFactor:function(t){this._ignoreContentScaleFactor=t}});var _p=exports.cc.AtlasNode.prototype;exports.cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);exports.cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);_p.texture;exports.cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);_p.textureAtlas;_p.quadsToDraw;exports.cc.EventHelper.prototype.apply(_p);exports.cc.AtlasNode.create=function(t,e,r,n){return new exports.cc.AtlasNode(t,e,r,n)};(function(){exports.cc.AtlasNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!1,this._colorUnmodified=exports.cc.color.WHITE,this._textureToRender=null};var t=exports.cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.AtlasNode.CanvasRenderCmd,t.initWithTexture=function(e,r,n,s){var o=this._node;return o._itemWidth=r,o._itemHeight=n,o._opacityModifyRGB=!0,o._texture=e,o._texture?(this._textureToRender=e,this._calculateMaxItems(),o.quadsToDraw=s,!0):(exports.cc.log(exports.cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(e){var r=this._node,n=r._realColor;n.r===e.r&&n.g===e.g&&n.b===e.b||(this._colorUnmodified=e,this._changeTextureColor())},t._changeTextureColor=function(){var e=this._node,r=e._texture,n=this._colorUnmodified,s=r.getHtmlElementObj(),o=exports.cc.rect(0,0,s.width,s.height);r===this._textureToRender?this._textureToRender=r._generateColorTexture(n.r,n.g,n.b,o):r._generateColorTexture(n.r,n.g,n.b,o,this._textureToRender.getHtmlElementObj())},t.setOpacity=function(e){var r=this._node;exports.cc.Node.prototype.setOpacity.call(r,e)},t._calculateMaxItems=function(){var e=this._node,r=e._texture,n=r.getContentSize();e._itemsPerColumn=0|n.height/e._itemHeight,e._itemsPerRow=0|n.width/e._itemWidth}})();exports.cc.TextureAtlas=exports.cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(t,e){this._buffersVBO=[],exports.cc.isString(t)?this.initWithFile(t,e):t instanceof exports.cc.Texture2D&&this.initWithTexture(t,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(t){this.texture=t},setDirty:function(t){this.dirty=t},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(t){this._quads=t},_copyQuadsToTextureAtlas:function(t,e){if(t)for(var r=0;r<t.length;r++)this._setQuadToArray(t[r],e+r)},_setQuadToArray:function(t,e){var r=this._quads;if(!r[e]){r[e]=new exports.cc.V3F_C4B_T2F_Quad(t.tl,t.bl,t.tr,t.br,this._quadsArrayBuffer,e*exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);return}r[e].bl=t.bl,r[e].br=t.br,r[e].tl=t.tl,r[e].tr=t.tr},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(this._capacity!==0)for(var t=this._indices,e=this._capacity,r=0;r<e;r++)exports.cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(t[r*6+0]=r*4+0,t[r*6+1]=r*4+0,t[r*6+2]=r*4+2,t[r*6+3]=r*4+1,t[r*6+4]=r*4+3,t[r*6+5]=r*4+3):(t[r*6+0]=r*4+0,t[r*6+1]=r*4+1,t[r*6+2]=r*4+2,t[r*6+3]=r*4+3,t[r*6+4]=r*4+2,t[r*6+5]=r*4+1)},_setupVBO:function(){var t=exports.cc._renderContext;this._buffersVBO[0]=t.createBuffer(),this._buffersVBO[1]=t.createBuffer(),this._quadsWebBuffer=t.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var t=exports.cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._quadsWebBuffer),t.bufferData(t.ARRAY_BUFFER,this._quadsArrayBuffer,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW)},initWithFile:function(t,e){var r=exports.cc.textureCache.addImage(t);return r?this.initWithTexture(r,e):(exports.cc.log(exports.cc._LogInfos.TextureAtlas_initWithFile,t),!1)},initWithTexture:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.TextureAtlas_initWithTexture),e=0|e,this._capacity=e,this._totalQuads=0,this.texture=t,this._quads=[],this._indices=new Uint16Array(e*6);var r=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._quadsArrayBuffer=new ArrayBuffer(r*e),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),!(this._quads&&this._indices)&&e>0)return!1;for(var n=this._quads,s=0;s<e;s++)n[s]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,s*r);return this._setupIndices(),this._setupVBO(),this.dirty=!0,!0},updateQuad:function(t,e){exports.cc.assert(t,exports.cc._LogInfos.TextureAtlas_updateQuad),exports.cc.assert(e>=0&&e<this._capacity,exports.cc._LogInfos.TextureAtlas_updateQuad_2),this._totalQuads=Math.max(e+1,this._totalQuads),this._setQuadToArray(t,e),this.dirty=!0},insertQuad:function(t,e){if(exports.cc.assert(e<this._capacity,exports.cc._LogInfos.TextureAtlas_insertQuad_2),this._totalQuads++,this._totalQuads>this._capacity){exports.cc.log(exports.cc._LogInfos.TextureAtlas_insertQuad);return}var r=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._totalQuads-1-e,s=e*r,o=n*r;this._quads[this._totalQuads-1]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*r),this._quadsReader.set(this._quadsReader.subarray(s,s+o),s+r),this._setQuadToArray(t,e),this.dirty=!0},insertQuads:function(t,e,r){r=r||t.length,exports.cc.assert(e+r<=this._capacity,exports.cc._LogInfos.TextureAtlas_insertQuads);var n=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads+=r,this._totalQuads>this._capacity){exports.cc.log(exports.cc._LogInfos.TextureAtlas_insertQuad);return}var s=this._totalQuads-1-e-r,o=e*n,a=s*n,c=this._totalQuads-1-r,l;for(l=0;l<r;l++)this._quads[c+l]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n);for(this._quadsReader.set(this._quadsReader.subarray(o,o+a),o+n*r),l=0;l<r;l++)this._setQuadToArray(t[l],e+l);this.dirty=!0},insertQuadFromIndex:function(t,e){if(t!==e){exports.cc.assert(e>=0||e<this._totalQuads,exports.cc._LogInfos.TextureAtlas_insertQuadFromIndex),exports.cc.assert(t>=0||t<this._totalQuads,exports.cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var r=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._quadsReader,s=n.subarray(t*r,r),o,a;t>e?(o=e*r,a=(t-e)*r,n.set(n.subarray(o,o+a),o+r),n.set(s,o)):(o=(t+1)*r,a=(e-t)*r,n.set(n.subarray(o,o+a),o-r),n.set(s,e*r)),this.dirty=!0}},removeQuadAtIndex:function(t){exports.cc.assert(t<this._totalQuads,exports.cc._LogInfos.TextureAtlas_removeQuadAtIndex);var e=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;if(this._totalQuads--,this._quads.length=this._totalQuads,t!==this._totalQuads){var r=(t+1)*e,n=(this._totalQuads-t)*e;this._quadsReader.set(this._quadsReader.subarray(r,r+n),r-e)}this.dirty=!0},removeQuadsAtIndex:function(t,e){if(exports.cc.assert(t+e<=this._totalQuads,exports.cc._LogInfos.TextureAtlas_removeQuadsAtIndex),this._totalQuads-=e,t!==this._totalQuads){var r=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=(t+e)*r,s=(this._totalQuads-t)*r,o=t*r;this._quadsReader.set(this._quadsReader.subarray(n,n+s),o)}this.dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(t){this.dirty=t},resizeCapacity:function(t){if(t===this._capacity)return!0;var e=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._capacity;this._totalQuads=Math.min(this._totalQuads,t),this._capacity=0|t;var n,s=this._capacity,o=this._totalQuads;if(this._quads===null)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(e*s),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),n=0;n<s;n++)this._quads=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,n*e);else{var a,c,l=this._quads;if(s>r){for(a=[],c=new ArrayBuffer(e*s),n=0;n<o;n++)a[n]=new exports.cc.V3F_C4B_T2F_Quad(l[n].tl,l[n].bl,l[n].tr,l[n].br,c,n*e);for(;n<s;n++)a[n]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,c,n*e);this._quadsReader=new Uint8Array(c),this._quads=a,this._quadsArrayBuffer=c}else{var h=Math.max(o,s);for(a=[],c=new ArrayBuffer(e*s),n=0;n<h;n++)a[n]=new exports.cc.V3F_C4B_T2F_Quad(l[n].tl,l[n].bl,l[n].tr,l[n].br,c,n*e);this._quadsReader=new Uint8Array(c),this._quads=a,this._quadsArrayBuffer=c}}if(this._indices===null)this._indices=new Uint16Array(s*6);else if(s>r){var u=new Uint16Array(s*6);u.set(this._indices,0),this._indices=u}else this._indices=this._indices.subarray(0,s*6);return this._setupIndices(),this._mapBuffers(),this.dirty=!0,!0},increaseTotalQuadsWith:function(t){this._totalQuads+=t},moveQuadsFromIndex:function(t,e,r){if(r===void 0){if(r=e,e=this._totalQuads-t,exports.cc.assert(r+(this._totalQuads-t)<=this._capacity,exports.cc._LogInfos.TextureAtlas_moveQuadsFromIndex),e===0)return}else if(exports.cc.assert(r+e<=this._totalQuads,exports.cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),exports.cc.assert(t<this._totalQuads,exports.cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),t===r)return;var n=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=t*n,o=e*n,a=this._quadsReader,c=a.subarray(s,s+o),l=r*n,h,u;r<t?(h=(t-r)*n,u=r*n,a.set(a.subarray(u,u+h),u+o)):(h=(r-t)*n,u=(t+e)*n,a.set(a.subarray(u,u+h),s)),a.set(c,l),this.dirty=!0},fillWithEmptyQuadsFromIndex:function(t,e){for(var r=e*exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=new Uint8Array(this._quadsArrayBuffer,t*exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r),s=0;s<r;s++)n[s]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var t=exports.cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&t.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&t.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&t.deleteBuffer(this._quadsWebBuffer)}});var _p=exports.cc.TextureAtlas.prototype;_p.totalQuads;exports.cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);_p.capacity;exports.cc.defineGetterSetter(_p,"capacity",_p.getCapacity);_p.quads;exports.cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);exports.cc.TextureAtlas.create=function(t,e){return new exports.cc.TextureAtlas(t,e)};exports.cc.TextureAtlas.createWithTexture=exports.cc.TextureAtlas.create;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.WebGLTextureAtlas),exports.cc._LogInfos.MissingFile,"TexturesWebGL.js"),exports.cc._tmp.WebGLTextureAtlas(),delete exports.cc._tmp.WebGLTextureAtlas)});exports.cc.assert(exports.cc.isFunction(exports.cc._tmp.PrototypeTextureAtlas),exports.cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");exports.cc._tmp.PrototypeTextureAtlas();delete exports.cc._tmp.PrototypeTextureAtlas;exports.cc.PI2=Math.PI*2;exports.cc.DrawingPrimitiveCanvas=exports.cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var r=exports.cc.view.getScaleX(),n=exports.cc.view.getScaleY(),s=exports.cc.p(t.x*r,t.y*n),o=this._renderContext.getContext();o.beginPath(),o.arc(s.x,-s.y,e*r,0,Math.PI*2,!1),o.closePath(),o.fill()},drawPoints:function(t,e,r){if(t!=null){r||(r=1);var n=this._renderContext.getContext(),s=exports.cc.view.getScaleX(),o=exports.cc.view.getScaleY();n.beginPath();for(var a=0,c=t.length;a<c;a++)n.arc(t[a].x*s,-t[a].y*o,r*s,0,Math.PI*2,!1);n.closePath(),n.fill()}},drawLine:function(t,e){var r=this._renderContext.getContext();exports.cc.view.getScaleX(),exports.cc.view.getScaleY(),r.beginPath(),r.moveTo(t.x,-t.y),r.lineTo(e.x,-e.y),r.closePath(),r.stroke()},drawRect:function(t,e){this.drawLine(exports.cc.p(t.x,t.y),exports.cc.p(e.x,t.y)),this.drawLine(exports.cc.p(e.x,t.y),exports.cc.p(e.x,e.y)),this.drawLine(exports.cc.p(e.x,e.y),exports.cc.p(t.x,e.y)),this.drawLine(exports.cc.p(t.x,e.y),exports.cc.p(t.x,t.y))},drawSolidRect:function(t,e,r){var n=[t,exports.cc.p(e.x,t.y),e,exports.cc.p(t.x,e.y)];this.drawSolidPoly(n,4,r)},drawPoly:function(t,e,r,n){if(n=n||!1,t!=null){if(t.length<3)throw new Error("Polygon's point must greater than 2");var s=t[0],o=this._renderContext.getContext();exports.cc.view.getScaleX(),exports.cc.view.getScaleY(),o.beginPath(),o.moveTo(s.x,-s.y);for(var a=1,c=t.length;a<c;a++)o.lineTo(t[a].x,-t[a].y);r&&o.closePath(),n?o.fill():o.stroke()}},drawSolidPoly:function(t,e,r){this.setDrawColor(r.r,r.g,r.b,r.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,r,n,s){s=s||!1;var o=this._renderContext.getContext();exports.cc.view.getScaleX(),exports.cc.view.getScaleY(),o.beginPath();var a=r-Math.PI*2;o.arc(0|t.x,0|-t.y,e,-r,-a,!1),s&&o.lineTo(0|t.x,0|-t.y),o.stroke()},drawQuadBezier:function(t,e,r,n){var s=this._cacheArray;s.length=0;for(var o=0,a=0;a<n;a++){var c=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*r.x,l=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*r.y;s.push(exports.cc.p(c,l)),o+=1/n}s.push(exports.cc.p(r.x,r.y)),this.drawPoly(s,n+1,!1,!1)},drawCubicBezier:function(t,e,r,n,s){var o=this._cacheArray;o.length=0;for(var a=0,c=0;c<s;c++){var l=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*r.x+a*a*a*n.x,h=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*r.y+a*a*a*n.y;o.push(exports.cc.p(l,h)),a+=1/s}o.push(exports.cc.p(n.x,n.y)),this.drawPoly(o,s+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,r){exports.cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var s,o,a=1/t.length,c=0;c<r+1;c++){var l=c/r;l===1?(s=t.length-1,o=1):(s=0|l/a,o=(l-a*s)/a);var h=exports.cc.CardinalSplineAt(exports.cc.getControlPointAt(t,s-1),exports.cc.getControlPointAt(t,s-0),exports.cc.getControlPointAt(t,s+1),exports.cc.getControlPointAt(t,s+2),e,o);n.push(h)}this.drawPoly(n,r+1,!1,!1)},drawImage:function(t,e,r,n,s){var o=arguments.length,a=this._renderContext.getContext();switch(o){case 2:var c=t.height;a.drawImage(t,e.x,-(e.y+c));break;case 3:a.drawImage(t,e.x,-(e.y+r.height),r.width,r.height);break;case 5:a.drawImage(t,e.x,e.y,r.width,r.height,n.x,-(n.y+s.height),s.width,s.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,r){var n=t||this._renderContext,s=n.getContext(),o="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b);n.setFillStyle(o+",1)");var a=e/10;s.beginPath(),s.moveTo(-e,e),s.lineTo(0,a),s.lineTo(e,e),s.lineTo(a,0),s.lineTo(e,-e),s.lineTo(0,-a),s.lineTo(-e,-e),s.lineTo(-a,0),s.lineTo(-e,e),s.closePath(),s.fill();var c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(1,o+", 0.0)"),n.setFillStyle(c),s.beginPath();var l=0,h=exports.cc.PI2;s.arc(0,0,e-a,l,h,!1),s.closePath(),s.fill()},drawColorBall:function(t,e,r){var n=t||this._renderContext,s=n.getContext();e*=exports.cc.view.getScaleX();var o="rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b),a=e/10,c=s.createRadialGradient(0,0,a,0,0,e);c.addColorStop(0,o+", 1)"),c.addColorStop(.3,o+", 0.8)"),c.addColorStop(.6,o+", 0.4)"),c.addColorStop(1,o+", 0.0)"),n.setFillStyle(c),s.beginPath();var l=0,h=exports.cc.PI2;s.arc(0,0,e,l,h,!1),s.closePath(),s.fill()},fillText:function(t,e,r){this._renderContext.getContext().fillText(t,e,-r)},setDrawColor:function(t,e,r,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+r+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+r+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*exports.cc.view.getScaleX()}});(function(){exports.cc.AtlasNode.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._textureAtlas=null,this._colorUnmodified=exports.cc.color.WHITE,this._colorF32Array=null,this._uniformColor=null,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURE_UCOLOR),this._uniformColor=exports.cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var t=exports.cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.AtlasNode.WebGLRenderCmd,t._updateBlendFunc=function(){var e=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(e._blendFunc.src=exports.cc.SRC_ALPHA,e._blendFunc.dst=exports.cc.ONE_MINUS_SRC_ALPHA)},t._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()},t.rendering=function(e){var r=e||exports.cc._renderContext,n=this._node,s=this._worldTransform;this._matrix.mat[0]=s.a,this._matrix.mat[4]=s.c,this._matrix.mat[12]=s.tx,this._matrix.mat[1]=s.b,this._matrix.mat[5]=s.d,this._matrix.mat[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),exports.cc.glBlendFunc(n._blendFunc.src,n._blendFunc.dst),this._uniformColor&&this._colorF32Array&&(r.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(n.quadsToDraw,0))},t.initWithTexture=function(e,r,n,s){var o=this._node;o._itemWidth=r,o._itemHeight=n,this._colorUnmodified=exports.cc.color.WHITE,o._opacityModifyRGB=!0,o._blendFunc.src=exports.cc.BLEND_SRC,o._blendFunc.dst=exports.cc.BLEND_DST;var a=o._realColor;return this._colorF32Array=new Float32Array([a.r/255,a.g/255,a.b/255,o._realOpacity/255]),this._textureAtlas=new exports.cc.TextureAtlas,this._textureAtlas.initWithTexture(e,s),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),o.quadsToDraw=s,!0):(exports.cc.log(exports.cc._LogInfos.AtlasNode__initWithTexture),!1)},t.setColor=function(e){var r=exports.cc.color(e.r,e.g,e.b),n=this._node;this._colorUnmodified=e;var s=this._displayedOpacity;n._opacityModifyRGB&&(r.r=r.r*s/255,r.g=r.g*s/255,r.b=r.b*s/255),exports.cc.Node.prototype.setColor.call(n,r)},t.setOpacity=function(e){var r=this._node;exports.cc.Node.prototype.setOpacity.call(r,e),r._opacityModifyRGB&&(r.color=this._colorUnmodified)},t._updateColor=function(){if(this._colorF32Array){var e=this._displayedColor;this._colorF32Array[0]=e.r/255,this._colorF32Array[1]=e.g/255,this._colorF32Array[2]=e.b/255,this._colorF32Array[3]=this._displayedOpacity/255}},t.getTexture=function(){return this._textureAtlas.texture},t.setTexture=function(e){this._textureAtlas.texture=e,this._updateBlendFunc(),this._updateOpacityModifyRGB()},t._calculateMaxItems=function(){var e=this._node,r=this._textureAtlas.texture,n=r.getContentSize();e._ignoreContentScaleFactor&&(n=r.getContentSizeInPixels()),e._itemsPerColumn=0|n.height/e._itemHeight,e._itemsPerRow=0|n.width/e._itemWidth}})();exports.cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag = %s): Action not found",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX != RotationY. Don't know which one to return",Node_getScale:"ScaleX != ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id=%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id= HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."};exports.cc._logToWebPage=function(t){if(exports.cc._canvas){var e=exports.cc._logList,r=document;if(!e){var n=r.createElement("Div"),s=n.style;n.setAttribute("id","logInfoDiv"),exports.cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",exports.cc._canvas.height),s.zIndex="99999",s.position="absolute",s.top="0",s.left="0",e=exports.cc._logList=r.createElement("textarea");var o=e.style;e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),o.backgroundColor="transparent",o.borderBottom="1px solid #cccccc",o.borderRightWidth="0px",o.borderLeftWidth="0px",o.borderTopWidth="0px",o.borderTopStyle="none",o.borderRightStyle="none",o.borderLeftStyle="none",o.padding="0px",o.margin=0}e.value=e.value+t+`\r
`,e.scrollTop=e.scrollHeight}};exports.cc._formatString=function(t){if(exports.cc.isObject(t))try{return JSON.stringify(t)}catch(e){return""}else return t};exports.cc._initDebugSetting=function(t){var e=exports.cc.game;if(t!==e.DEBUG_MODE_NONE){var r;t>e.DEBUG_MODE_ERROR?(r=exports.cc._logToWebPage.bind(exports.cc),exports.cc.error=function(){r("ERROR :  "+exports.cc.formatStr.apply(exports.cc,arguments))},exports.cc.assert=function(n,s){if(!n&&s){for(var o=2;o<arguments.length;o++)s=s.replace(/(%s)|(%d)/,exports.cc._formatString(arguments[o]));r("Assert: "+s)}},t!==e.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(exports.cc.warn=function(){r("WARN :  "+exports.cc.formatStr.apply(exports.cc,arguments))}),t===e.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(exports.cc.log=function(){r(exports.cc.formatStr.apply(exports.cc,arguments))})):console&&console.log.apply&&(exports.cc.error=Function.prototype.bind.call(console.error,console),console.assert?exports.cc.assert=Function.prototype.bind.call(console.assert,console):exports.cc.assert=function(n,s){if(!n&&s){for(var o=2;o<arguments.length;o++)s=s.replace(/(%s)|(%d)/,exports.cc._formatString(arguments[o]));throw new Error(s)}},t!==e.DEBUG_MODE_ERROR&&(exports.cc.warn=Function.prototype.bind.call(console.warn,console)),t===e.DEBUG_MODE_INFO&&(exports.cc.log=Function.prototype.bind.call(console.log,console)))}};exports.cc.HashElement=exports.cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}});exports.cc.ActionManager=exports.cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(t,e){for(var r=0;r<t.length;r++)if(e===t[r].target)return t[r];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(t,e,r){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[e.__instanceId];n||(n=new exports.cc.HashElement,n.paused=r,n.target=e,this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),this._actionAllocWithHashElement(n),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var r=t[e];r&&this.removeAllActionsFromTarget(r.target,!0)}},removeAllActionsFromTarget:function(t,e){if(t!=null){var r=this._hashTargets[t.__instanceId];r&&(r.actions.indexOf(r.currentAction)!==-1&&!r.currentActionSalvaged&&(r.currentActionSalvaged=!0),r.actions.length=0,this._currentTarget===r&&!e?this._currentTargetSalvaged=!0:this._deleteHashElement(r))}},removeAction:function(t){if(t!=null){var e=t.getOriginalTarget(),r=this._hashTargets[e.__instanceId];if(r){for(var n=0;n<r.actions.length;n++)if(r.actions[n]===t){r.actions.splice(n,1);break}}else exports.cc.log(exports.cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){t===exports.cc.ACTION_TAG_INVALID&&exports.cc.log(exports.cc._LogInfos.ActionManager_addAction),exports.cc.assert(e,exports.cc._LogInfos.ActionManager_addAction);var r=this._hashTargets[e.__instanceId];if(r)for(var n=r.actions.length,s=0;s<n;++s){var o=r.actions[s];if(o&&o.getTag()===t&&o.getOriginalTarget()===e){this._removeActionAtIndex(s,r);break}}},getActionByTag:function(t,e){t===exports.cc.ACTION_TAG_INVALID&&exports.cc.log(exports.cc._LogInfos.ActionManager_getActionByTag);var r=this._hashTargets[e.__instanceId];if(r){if(r.actions!=null)for(var n=0;n<r.actions.length;++n){var s=r.actions[n];if(s&&s.getTag()===t)return s}exports.cc.log(exports.cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,r=0;r<e.length;r++){var n=e[r];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){exports.cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){var r=e.actions[t];r===e.currentAction&&!e.currentActionSalvaged&&(e.currentActionSalvaged=!0),e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,e.actions.length===0&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(t){var e=!1;return t&&(this._hashTargets[t.target.__instanceId]&&(delete this._hashTargets[t.target.__instanceId],exports.cc.arrayRemoveObject(this._arrayTargets,t),e=!0),t.actions=null,t.target=null),e},_actionAllocWithHashElement:function(t){t.actions==null&&(t.actions=[])},update:function(t){for(var e=this._arrayTargets,r,n=0;n<e.length;n++){if(this._currentTarget=e[n],r=this._currentTarget,!r.paused){for(r.actionIndex=0;r.actionIndex<(r.actions?r.actions.length:0);r.actionIndex++)if(r.currentAction=r.actions[r.actionIndex],!!r.currentAction){if(r.currentActionSalvaged=!1,r.currentAction.step(t*(r.currentAction._speedMethod?r.currentAction._speed:1)),r.currentActionSalvaged)r.currentAction=null;else if(r.currentAction.isDone()){r.currentAction.stop();var s=r.currentAction;r.currentAction=null,this.removeAction(s)}r.currentAction=null}}this._currentTargetSalvaged&&r.actions.length===0&&this._deleteHashElement(r)&&n--}}});exports.cc.ACTION_TAG_INVALID=-1;exports.cc.Action=exports.cc.Class.extend({originalTarget:null,target:null,tag:exports.cc.ACTION_TAG_INVALID,ctor:function(){this.originalTarget=null,this.target=null,this.tag=exports.cc.ACTION_TAG_INVALID},copy:function(){return exports.cc.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new exports.cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){exports.cc.log("[Action step]. override me")},update:function(t){exports.cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}});exports.cc.action=function(){return new exports.cc.Action};exports.cc.Action.create=exports.cc.action;exports.cc.FiniteTimeAction=exports.cc.Action.extend({_duration:0,ctor:function(){exports.cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return exports.cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new exports.cc.FiniteTimeAction}});exports.cc.Speed=exports.cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){exports.cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new exports.cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){exports.cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),exports.cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new exports.cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}});exports.cc.speed=function(t,e){return new exports.cc.Speed(t,e)};exports.cc.Speed.create=exports.cc.speed;exports.cc.Follow=exports.cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){exports.cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=exports.cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new exports.cc.Follow,e=this._worldRect,r=new exports.cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,r),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");var r=this||window;e=e||exports.cc.rect(0,0,0,0),r._followedNode=t,r._worldRect=e,r._boundarySet=!exports.cc._rectEqualToZero(e),r._boundaryFullyCovered=!1;var n=exports.cc.director.getWinSize();return r._fullScreenSize=exports.cc.p(n.width,n.height),r._halfScreenSize=exports.cc.pMult(r._fullScreenSize,.5),r._boundarySet&&(r.leftBoundary=-(e.x+e.width-r._fullScreenSize.x),r.rightBoundary=-e.x,r.topBoundary=-e.y,r.bottomBoundary=-(e.y+e.height-r._fullScreenSize.y),r.rightBoundary<r.leftBoundary&&(r.rightBoundary=r.leftBoundary=(r.leftBoundary+r.rightBoundary)/2),r.topBoundary<r.bottomBoundary&&(r.topBoundary=r.bottomBoundary=(r.topBoundary+r.bottomBoundary)/2),r.topBoundary===r.bottomBoundary&&r.leftBoundary===r.rightBoundary&&(r._boundaryFullyCovered=!0)),!0},step:function(t){var e=this._followedNode.x,r=this._followedNode.y;if(e=this._halfScreenSize.x-e,r=this._halfScreenSize.y-r,this.target._renderCmd._dirtyFlag=0,this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(exports.cc.clampf(e,this.leftBoundary,this.rightBoundary),exports.cc.clampf(r,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(e,r)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,exports.cc.Action.prototype.stop.call(this)}});exports.cc.follow=function(t,e){return new exports.cc.Follow(t,e)};exports.cc.Follow.create=exports.cc.follow;exports.cc.ActionInterval=exports.cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,exports.cc.FiniteTimeAction.prototype.ctor.call(this),t!==void 0&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=t===0?exports.cc.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new exports.cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||e.length===0)return t;for(var r=0,n=e.length;r<n;r++)t=e[r].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1192092896e-16?this._duration:1192092896e-16);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){exports.cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return exports.cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){exports.cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return exports.cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return t<=0?(exports.cc.log("The speed parameter error"),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(exports.cc.log("The repeat parameter error"),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}});exports.cc.actionInterval=function(t){return new exports.cc.ActionInterval(t)};exports.cc.ActionInterval.create=exports.cc.actionInterval;exports.cc.Sequence=exports.cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,r=e.length-1;if(r>=0&&e[r]==null&&exports.cc.log("parameters should not be ending with null in Javascript"),r>=0){for(var n=e[0],s,o=1;o<r;o++)e[o]&&(s=n,n=exports.cc.Sequence._actionOneTwo(s,e[o]));this.initWithTwoActions(n,e[r])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var r=t._duration+e._duration;return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new exports.cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){this._last!==-1&&this._actions[this._last].stop(),exports.cc.Action.prototype.stop.call(this)},update:function(t){var e,r=0,n=this._split,s=this._actions,o=this._last,a;t=this._computeEaseTime(t),t<n?(e=n!==0?t/n:1,r===0&&o===1&&(s[1].update(0),s[1].stop())):(r=1,e=n===1?1:(t-n)/(1-n),o===-1&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),o||(s[0].update(1),s[0].stop())),a=s[r],!(o===r&&a.isDone())&&(o!==r&&a.startWithTarget(this.target),e=e*a._timesForRepeat,a.update(e>1?e%1:e),this._last=r)},reverse:function(){var t=exports.cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.sequence=function(t){var e=t instanceof Array?t:arguments;e.length>0&&e[e.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");for(var r,n,s,o;e&&e.length>0;)for(n=Array.prototype.shift.call(e),o=n._timesForRepeat||1,n._repeatMethod=!1,n._timesForRepeat=1,s=0,r||(r=n,s=1),s;s<o;s++)r=exports.cc.Sequence._actionOneTwo(r,n);return r};exports.cc.Sequence.create=exports.cc.sequence;exports.cc.Sequence._actionOneTwo=function(t,e){var r=new exports.cc.Sequence;return r.initWithTwoActions(t,e),r};exports.cc.Repeat=exports.cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithAction(t,e)},initWithAction:function(t,e){var r=t._duration*e;return this.initWithDuration(r)?(this._times=e,this._innerAction=t,t instanceof exports.cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var t=new exports.cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),exports.cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,r=this._duration,n=this._times,s=this._nextDt;if(t>=s){for(;t>s&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),s+=e._duration/r,this._nextDt=s;t>=1&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(s-e._duration/r)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new exports.cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}});exports.cc.repeat=function(t,e){return new exports.cc.Repeat(t,e)};exports.cc.Repeat.create=exports.cc.repeat;exports.cc.RepeatForever=exports.cc.ActionInterval.extend({_innerAction:null,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new exports.cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new exports.cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}});exports.cc.repeatForever=function(t){return new exports.cc.RepeatForever(t)};exports.cc.RepeatForever.create=exports.cc.repeatForever;exports.cc.Spawn=exports.cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,r=e.length-1;if(r>=0&&e[r]==null&&exports.cc.log("parameters should not be ending with null in Javascript"),r>=0){for(var n=e[0],s,o=1;o<r;o++)e[o]&&(s=n,n=exports.cc.Spawn._actionOneTwo(s,e[o]));this.initWithTwoActions(n,e[r])}},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var r=!1,n=t._duration,s=e._duration;return this.initWithDuration(Math.max(n,s))&&(this._one=t,this._two=e,n>s?this._two=exports.cc.Sequence._actionOneTwo(e,exports.cc.delayTime(n-s)):n<s&&(this._one=exports.cc.Sequence._actionOneTwo(t,exports.cc.delayTime(s-n))),r=!0),r},clone:function(){var t=new exports.cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),exports.cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=exports.cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.spawn=function(t){var e=t instanceof Array?t:arguments;e.length>0&&e[e.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");for(var r=e[0],n=1;n<e.length;n++)e[n]!=null&&(r=exports.cc.Spawn._actionOneTwo(r,e[n]));return r};exports.cc.Spawn.create=exports.cc.spawn;exports.cc.Spawn._actionOneTwo=function(t,e){var r=new exports.cc.Spawn;return r.initWithTwoActions(t,e),r};exports.cc.RotateTo=exports.cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._dstAngleX=e||0,this._dstAngleY=r||this._dstAngleX,!0):!1},clone:function(){var t=new exports.cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,r=this._dstAngleX-e;r>180&&(r-=360),r<-180&&(r+=360),this._startAngleX=e,this._diffAngleX=r,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;n>180&&(n-=360),n<-180&&(n+=360),this._diffAngleY=n},reverse:function(){exports.cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}});exports.cc.rotateTo=function(t,e,r){return new exports.cc.RotateTo(t,e,r)};exports.cc.RotateTo.create=exports.cc.rotateTo;exports.cc.RotateBy=exports.cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._angleX=e||0,this._angleY=r||this._angleX,!0):!1},clone:function(){var t=new exports.cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new exports.cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.rotateBy=function(t,e,r){return new exports.cc.RotateBy(t,e,r)};exports.cc.RotateBy.create=exports.cc.rotateBy;exports.cc.MoveBy=exports.cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=exports.cc.p(0,0),this._startPosition=exports.cc.p(0,0),this._previousPosition=exports.cc.p(0,0),e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(e.x!==void 0&&(r=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=r,!0):!1},clone:function(){var t=new exports.cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),r=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=r,this._startPosition.x=e,this._startPosition.y=r},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,r=this._positionDelta.y*t,n=this._startPosition;if(exports.cc.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX(),o=this.target.getPositionY(),a=this._previousPosition;n.x=n.x+s-a.x,n.y=n.y+o-a.y,e=e+n.x,r=r+n.y,a.x=e,a.y=r,this.target.setPosition(e,r)}else this.target.setPosition(n.x+e,n.y+r)}},reverse:function(){var t=new exports.cc.MoveBy(this._duration,exports.cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.moveBy=function(t,e,r){return new exports.cc.MoveBy(t,e,r)};exports.cc.MoveBy.create=exports.cc.moveBy;exports.cc.MoveTo=exports.cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,r){exports.cc.MoveBy.prototype.ctor.call(this),this._endPosition=exports.cc.p(0,0),e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.MoveBy.prototype.initWithDuration.call(this,t,e,r)?(e.x!==void 0&&(r=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=r,!0):!1},clone:function(){var t=new exports.cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){exports.cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}});exports.cc.moveTo=function(t,e,r){return new exports.cc.MoveTo(t,e,r)};exports.cc.MoveTo.create=exports.cc.moveTo;exports.cc.SkewTo=exports.cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),r!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){var n=!1;return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=r,n=!0),n},clone:function(){var t=new exports.cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}});exports.cc.skewTo=function(t,e,r){return new exports.cc.SkewTo(t,e,r)};exports.cc.SkewTo.create=exports.cc.skewTo;exports.cc.SkewBy=exports.cc.SkewTo.extend({ctor:function(t,e,r){exports.cc.SkewTo.prototype.ctor.call(this),r!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){var n=!1;return exports.cc.SkewTo.prototype.initWithDuration.call(this,t,e,r)&&(this._skewX=e,this._skewY=r,n=!0),n},clone:function(){var t=new exports.cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){exports.cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new exports.cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.skewBy=function(t,e,r){return new exports.cc.SkewBy(t,e,r)};exports.cc.SkewBy.create=exports.cc.skewBy;exports.cc.JumpBy=exports.cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,r,n,s){exports.cc.ActionInterval.prototype.ctor.call(this),this._startPosition=exports.cc.p(0,0),this._previousPosition=exports.cc.p(0,0),this._delta=exports.cc.p(0,0),n!==void 0&&this.initWithDuration(t,e,r,n,s)},initWithDuration:function(t,e,r,n,s){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(s===void 0&&(s=n,n=r,r=e.y,e=e.x),this._delta.x=e,this._delta.y=r,this._height=n,this._jumps=s,!0):!1},clone:function(){var t=new exports.cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),r=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=r,this._startPosition.x=e,this._startPosition.y=r},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,r=this._height*4*e*(1-e);r+=this._delta.y*t;var n=this._delta.x*t,s=this._startPosition;if(exports.cc.ENABLE_STACKABLE_ACTIONS){var o=this.target.getPositionX(),a=this.target.getPositionY(),c=this._previousPosition;s.x=s.x+o-c.x,s.y=s.y+a-c.y,n=n+s.x,r=r+s.y,c.x=n,c.y=r,this.target.setPosition(n,r)}else this.target.setPosition(s.x+n,s.y+r)}},reverse:function(){var t=new exports.cc.JumpBy(this._duration,exports.cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.jumpBy=function(t,e,r,n,s){return new exports.cc.JumpBy(t,e,r,n,s)};exports.cc.JumpBy.create=exports.cc.jumpBy;exports.cc.JumpTo=exports.cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,r,n,s){exports.cc.JumpBy.prototype.ctor.call(this),this._endPosition=exports.cc.p(0,0),n!==void 0&&this.initWithDuration(t,e,r,n,s)},initWithDuration:function(t,e,r,n,s){return exports.cc.JumpBy.prototype.initWithDuration.call(this,t,e,r,n,s)?(s===void 0&&(r=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=r,!0):!1},startWithTarget:function(t){exports.cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new exports.cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}});exports.cc.jumpTo=function(t,e,r,n,s){return new exports.cc.JumpTo(t,e,r,n,s)};exports.cc.JumpTo.create=exports.cc.jumpTo;exports.cc.bezierAt=function(t,e,r,n,s){return Math.pow(1-s,3)*t+3*s*Math.pow(1-s,2)*e+3*Math.pow(s,2)*(1-s)*r+Math.pow(s,3)*n};exports.cc.BezierBy=exports.cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=exports.cc.p(0,0),this._previousPosition=exports.cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._config=e,!0):!1},clone:function(){var t=new exports.cc.BezierBy;this._cloneDecoration(t);for(var e=[],r=0;r<this._config.length;r++){var n=this._config[r];e.push(exports.cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),r=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=r,this._startPosition.x=e,this._startPosition.y=r},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,r=0,n=e[0].x,s=e[1].x,o=e[2].x,a=0,c=e[0].y,l=e[1].y,h=e[2].y,u=exports.cc.bezierAt(r,n,s,o,t),_=exports.cc.bezierAt(a,c,l,h,t),d=this._startPosition;if(exports.cc.ENABLE_STACKABLE_ACTIONS){var f=this.target.getPositionX(),T=this.target.getPositionY(),x=this._previousPosition;d.x=d.x+f-x.x,d.y=d.y+T-x.y,u=u+d.x,_=_+d.y,x.x=u,x.y=_,this.target.setPosition(u,_)}else this.target.setPosition(d.x+u,d.y+_)}},reverse:function(){var t=this._config,e=[exports.cc.pAdd(t[1],exports.cc.pNeg(t[2])),exports.cc.pAdd(t[0],exports.cc.pNeg(t[2])),exports.cc.pNeg(t[2])],r=new exports.cc.BezierBy(this._duration,e);return this._cloneDecoration(r),this._reverseEaseList(r),r}});exports.cc.bezierBy=function(t,e){return new exports.cc.BezierBy(t,e)};exports.cc.BezierBy.create=exports.cc.bezierBy;exports.cc.BezierTo=exports.cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){exports.cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toConfig=e,!0):!1},clone:function(){var t=new exports.cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){exports.cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,r=this._toConfig,n=this._config;n[0]=exports.cc.pSub(r[0],e),n[1]=exports.cc.pSub(r[1],e),n[2]=exports.cc.pSub(r[2],e)}});exports.cc.bezierTo=function(t,e){return new exports.cc.BezierTo(t,e)};exports.cc.BezierTo.create=exports.cc.bezierTo;exports.cc.ScaleTo=exports.cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._endScaleX=e,this._endScaleY=r!=null?r:e,!0):!1},clone:function(){var t=new exports.cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}});exports.cc.scaleTo=function(t,e,r){return new exports.cc.ScaleTo(t,e,r)};exports.cc.ScaleTo.create=exports.cc.scaleTo;exports.cc.ScaleBy=exports.cc.ScaleTo.extend({startWithTarget:function(t){exports.cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new exports.cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new exports.cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}});exports.cc.scaleBy=function(t,e,r){return new exports.cc.ScaleBy(t,e,r)};exports.cc.ScaleBy.create=exports.cc.scaleBy;exports.cc.Blink=exports.cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._times=e,!0):!1},clone:function(){var t=new exports.cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,r=t%e;this.target.visible=r>e/2}},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.visible},stop:function(){this.target.visible=this._originalState,exports.cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new exports.cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.blink=function(t,e){return new exports.cc.Blink(t,e)};exports.cc.Blink.create=exports.cc.blink;exports.cc.FadeTo=exports.cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._toOpacity=e,!0):!1},clone:function(){var t=new exports.cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=this._fromOpacity!==void 0?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}});exports.cc.fadeTo=function(t,e){return new exports.cc.FadeTo(t,e)};exports.cc.FadeTo.create=exports.cc.fadeTo;exports.cc.FadeIn=exports.cc.FadeTo.extend({_reverseAction:null,ctor:function(t){exports.cc.FadeTo.prototype.ctor.call(this),t==null&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new exports.cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new exports.cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),exports.cc.FadeTo.prototype.startWithTarget.call(this,t)}});exports.cc.fadeIn=function(t){return new exports.cc.FadeIn(t)};exports.cc.FadeIn.create=exports.cc.fadeIn;exports.cc.FadeOut=exports.cc.FadeTo.extend({ctor:function(t){exports.cc.FadeTo.prototype.ctor.call(this),t==null&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new exports.cc.FadeIn;return t._reverseAction=this||window,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new exports.cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}});exports.cc.fadeOut=function(t){return new exports.cc.FadeOut(t)};exports.cc.FadeOut.create=exports.cc.fadeOut;exports.cc.TintTo=exports.cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,r,n){exports.cc.ActionInterval.prototype.ctor.call(this),this._to=exports.cc.color(0,0,0),this._from=exports.cc.color(0,0,0),n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=exports.cc.color(e,r,n),!0):!1},clone:function(){var t=new exports.cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,r=this._to;e&&this.target.setColor(exports.cc.color(e.r+(r.r-e.r)*t,e.g+(r.g-e.g)*t,e.b+(r.b-e.b)*t))}});exports.cc.tintTo=function(t,e,r,n){return new exports.cc.TintTo(t,e,r,n)};exports.cc.TintTo.create=exports.cc.tintTo;exports.cc.TintBy=exports.cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,r,n){exports.cc.ActionInterval.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._deltaR=e,this._deltaG=r,this._deltaB=n,!0):!1},clone:function(){var t=new exports.cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=exports.cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new exports.cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}});exports.cc.tintBy=function(t,e,r,n){return new exports.cc.TintBy(t,e,r,n)};exports.cc.TintBy.create=exports.cc.tintBy;exports.cc.DelayTime=exports.cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new exports.cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new exports.cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}});exports.cc.delayTime=function(t){return new exports.cc.DelayTime(t)};exports.cc.DelayTime.create=exports.cc.delayTime;exports.cc.ReverseTime=exports.cc.ActionInterval.extend({_other:null,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)?(this._other=t,!0):!1},clone:function(){var t=new exports.cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),exports.cc.Action.prototype.stop.call(this)}});exports.cc.reverseTime=function(t){return new exports.cc.ReverseTime(t)};exports.cc.ReverseTime.create=exports.cc.reverseTime;exports.cc.Animate=exports.cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var r=this._splitTimes;r.length=0;var n=0,s=e/t.getTotalDelayUnits(),o=t.getFrames();exports.cc.arrayVerifyType(o,exports.cc.AnimationFrame);for(var a=0;a<o.length;a++){var c=o[a],l=n*s/e;n+=c.getDelayUnits(),r.push(l)}return!0}return!1},clone:function(){var t=new exports.cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){if(t=this._computeEaseTime(t),t<1){t*=this._animation.getLoops();var e=0|t;e>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t=t%1}for(var r=this._animation.getFrames(),n=r.length,s=this._splitTimes,o=this._nextFrame;o<n&&s[o]<=t;o++)_currFrameIndex=o,this.target.setSpriteFrame(r[_currFrameIndex].getSpriteFrame()),this._nextFrame=o+1},reverse:function(){var t=this._animation,e=t.getFrames(),r=[];if(exports.cc.arrayVerifyType(e,exports.cc.AnimationFrame),e.length>0)for(var n=e.length-1;n>=0;n--){var s=e[n];if(!s)break;r.push(s.clone())}var o=new exports.cc.Animation(r,t.getDelayPerUnit(),t.getLoops());o.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var a=new exports.cc.Animate(o);return this._cloneDecoration(a),this._reverseEaseList(a),a},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),exports.cc.Action.prototype.stop.call(this)}});exports.cc.animate=function(t){return new exports.cc.Animate(t)};exports.cc.Animate.create=exports.cc.animate;exports.cc.TargetedAction=exports.cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return this.initWithDuration(e._duration)?(this._forcedTarget=t,this._action=e,!0):!1},clone:function(){var t=new exports.cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}});exports.cc.targetedAction=function(t,e){return new exports.cc.TargetedAction(t,e)};exports.cc.TargetedAction.create=exports.cc.targetedAction;exports.cc.ActionInstant=exports.cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new exports.cc.ActionInstant}});exports.cc.Show=exports.cc.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new exports.cc.Hide},clone:function(){return new exports.cc.Show}});exports.cc.show=function(){return new exports.cc.Show};exports.cc.Show.create=exports.cc.show;exports.cc.Hide=exports.cc.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new exports.cc.Show},clone:function(){return new exports.cc.Hide}});exports.cc.hide=function(){return new exports.cc.Hide};exports.cc.Hide.create=exports.cc.hide;exports.cc.ToggleVisibility=exports.cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new exports.cc.ToggleVisibility},clone:function(){return new exports.cc.ToggleVisibility}});exports.cc.toggleVisibility=function(){return new exports.cc.ToggleVisibility};exports.cc.ToggleVisibility.create=exports.cc.toggleVisibility;exports.cc.RemoveSelf=exports.cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){exports.cc.FiniteTimeAction.prototype.ctor.call(this),t!==void 0&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new exports.cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new exports.cc.RemoveSelf(this._isNeedCleanUp)}});exports.cc.removeSelf=function(t){return new exports.cc.RemoveSelf(t)};exports.cc.RemoveSelf.create=exports.cc.removeSelf;exports.cc.FlipX=exports.cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){exports.cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,t!==void 0&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new exports.cc.FlipX(!this._flippedX)},clone:function(){var t=new exports.cc.FlipX;return t.initWithFlipX(this._flippedX),t}});exports.cc.flipX=function(t){return new exports.cc.FlipX(t)};exports.cc.FlipX.create=exports.cc.flipX;exports.cc.FlipY=exports.cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){exports.cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,t!==void 0&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new exports.cc.FlipY(!this._flippedY)},clone:function(){var t=new exports.cc.FlipY;return t.initWithFlipY(this._flippedY),t}});exports.cc.flipY=function(t){return new exports.cc.FlipY(t)};exports.cc.FlipY.create=exports.cc.flipY;exports.cc.Place=exports.cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){exports.cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,t!==void 0&&(t.x!==void 0&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new exports.cc.Place;return t.initWithPosition(this._x,this._y),t}});exports.cc.place=function(t,e){return new exports.cc.Place(t,e)};exports.cc.Place.create=exports.cc.place;exports.cc.CallFunc=exports.cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,r){exports.cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,r)},initWithFunction:function(t,e,r){return t&&(this._function=t),e&&(this._selectorTarget=e),r!==void 0&&(this._data=r),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new exports.cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}});exports.cc.callFunc=function(t,e,r){return new exports.cc.CallFunc(t,e,r)};exports.cc.CallFunc.create=exports.cc.callFunc;exports.cc.ActionEase=exports.cc.ActionInterval.extend({_inner:null,ctor:function(t){exports.cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return this.initWithDuration(t.getDuration())?(this._inner=t,!0):!1},clone:function(){var t=new exports.cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),exports.cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new exports.cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}});exports.cc.actionEase=function(t){return new exports.cc.ActionEase(t)};exports.cc.ActionEase.create=exports.cc.actionEase;exports.cc.EaseRateAction=exports.cc.ActionEase.extend({_rate:0,ctor:function(t,e){exports.cc.ActionEase.prototype.ctor.call(this),e!==void 0&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return exports.cc.ActionEase.prototype.initWithAction.call(this,t)?(this._rate=e,!0):!1},clone:function(){var t=new exports.cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new exports.cc.EaseRateAction(this._inner.reverse(),1/this._rate)}});exports.cc.easeRateAction=function(t,e){return new exports.cc.EaseRateAction(t,e)};exports.cc.EaseRateAction.create=exports.cc.easeRateAction;exports.cc.EaseIn=exports.cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new exports.cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new exports.cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}});exports.cc.EaseIn.create=function(t,e){return new exports.cc.EaseIn(t,e)};exports.cc.easeIn=function(t){return{_rate:t,easing:function(e){return Math.pow(e,this._rate)},reverse:function(){return exports.cc.easeIn(1/this._rate)}}};exports.cc.EaseOut=exports.cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new exports.cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new exports.cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}});exports.cc.EaseOut.create=function(t,e){return new exports.cc.EaseOut(t,e)};exports.cc.easeOut=function(t){return{_rate:t,easing:function(e){return Math.pow(e,1/this._rate)},reverse:function(){return exports.cc.easeOut(1/this._rate)}}};exports.cc.EaseInOut=exports.cc.EaseRateAction.extend({update:function(t){t*=2,t<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new exports.cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new exports.cc.EaseInOut(this._inner.reverse(),this._rate)}});exports.cc.EaseInOut.create=function(t,e){return new exports.cc.EaseInOut(t,e)};exports.cc.easeInOut=function(t){return{_rate:t,easing:function(e){return e*=2,e<1?.5*Math.pow(e,this._rate):1-.5*Math.pow(2-e,this._rate)},reverse:function(){return exports.cc.easeInOut(this._rate)}}};exports.cc.EaseExponentialIn=exports.cc.ActionEase.extend({update:function(t){this._inner.update(t===0?0:Math.pow(2,10*(t-1)))},reverse:function(){return new exports.cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseExponentialIn.create=function(t){return new exports.cc.EaseExponentialIn(t)};exports.cc._easeExponentialInObj={easing:function(t){return t===0?0:Math.pow(2,10*(t-1))},reverse:function(){return exports.cc._easeExponentialOutObj}};exports.cc.easeExponentialIn=function(){return exports.cc._easeExponentialInObj};exports.cc.EaseExponentialOut=exports.cc.ActionEase.extend({update:function(t){this._inner.update(t===1?1:-Math.pow(2,-10*t)+1)},reverse:function(){return new exports.cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseExponentialOut.create=function(t){return new exports.cc.EaseExponentialOut(t)};exports.cc._easeExponentialOutObj={easing:function(t){return t===1?1:-Math.pow(2,-10*t)+1},reverse:function(){return exports.cc._easeExponentialInObj}};exports.cc.easeExponentialOut=function(){return exports.cc._easeExponentialOutObj};exports.cc.EaseExponentialInOut=exports.cc.ActionEase.extend({update:function(t){t!==1&&t!==0&&(t*=2,t<1?t=.5*Math.pow(2,10*(t-1)):t=.5*(-Math.pow(2,-10*(t-1))+2)),this._inner.update(t)},reverse:function(){return new exports.cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseExponentialInOut.create=function(t){return new exports.cc.EaseExponentialInOut(t)};exports.cc._easeExponentialInOutObj={easing:function(t){return t!==1&&t!==0?(t*=2,t<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)):t},reverse:function(){return exports.cc._easeExponentialInOutObj}};exports.cc.easeExponentialInOut=function(){return exports.cc._easeExponentialInOutObj};exports.cc.EaseSineIn=exports.cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new exports.cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseSineIn.create=function(t){return new exports.cc.EaseSineIn(t)};exports.cc._easeSineInObj={easing:function(t){return t===0||t===1?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return exports.cc._easeSineOutObj}};exports.cc.easeSineIn=function(){return exports.cc._easeSineInObj};exports.cc.EaseSineOut=exports.cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new exports.cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseSineOut.create=function(t){return new exports.cc.EaseSineOut(t)};exports.cc._easeSineOutObj={easing:function(t){return t===0||t===1?t:Math.sin(t*Math.PI/2)},reverse:function(){return exports.cc._easeSineInObj}};exports.cc.easeSineOut=function(){return exports.cc._easeSineOutObj};exports.cc.EaseSineInOut=exports.cc.ActionEase.extend({update:function(t){t=t===0||t===1?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new exports.cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseSineInOut(this._inner.reverse())}});exports.cc.EaseSineInOut.create=function(t){return new exports.cc.EaseSineInOut(t)};exports.cc._easeSineInOutObj={easing:function(t){return t===0||t===1?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return exports.cc._easeSineInOutObj}};exports.cc.easeSineInOut=function(){return exports.cc._easeSineInOutObj};exports.cc.EaseElastic=exports.cc.ActionEase.extend({_period:.3,ctor:function(t,e){exports.cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return exports.cc.ActionEase.prototype.initWithAction.call(this,t),this._period=e==null?.3:e,!0},reverse:function(){return exports.cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new exports.cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}});exports.cc.EaseElastic.create=function(t,e){return new exports.cc.EaseElastic(t,e)};exports.cc.EaseElasticIn=exports.cc.EaseElastic.extend({update:function(t){var e=0;if(t===0||t===1)e=t;else{var r=this._period/4;t=t-1,e=-Math.pow(2,10*t)*Math.sin((t-r)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new exports.cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new exports.cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}});exports.cc.EaseElasticIn.create=function(t,e){return new exports.cc.EaseElasticIn(t,e)};exports.cc._easeElasticInObj={easing:function(t){return t===0||t===1?t:(t=t-1,-Math.pow(2,10*t)*Math.sin((t-.3/4)*Math.PI*2/.3))},reverse:function(){return exports.cc._easeElasticOutObj}};exports.cc.easeElasticIn=function(t){return t&&t!==.3?{_period:t,easing:function(e){return e===0||e===1?e:(e=e-1,-Math.pow(2,10*e)*Math.sin((e-this._period/4)*Math.PI*2/this._period))},reverse:function(){return exports.cc.easeElasticOut(this._period)}}:exports.cc._easeElasticInObj};exports.cc.EaseElasticOut=exports.cc.EaseElastic.extend({update:function(t){var e=0;if(t===0||t===1)e=t;else{var r=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-r)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new exports.cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new exports.cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}});exports.cc.EaseElasticOut.create=function(t,e){return new exports.cc.EaseElasticOut(t,e)};exports.cc._easeElasticOutObj={easing:function(t){return t===0||t===1?t:Math.pow(2,-10*t)*Math.sin((t-.3/4)*Math.PI*2/.3)+1},reverse:function(){return exports.cc._easeElasticInObj}};exports.cc.easeElasticOut=function(t){return t&&t!==.3?{_period:t,easing:function(e){return e===0||e===1?e:Math.pow(2,-10*e)*Math.sin((e-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return exports.cc.easeElasticIn(this._period)}}:exports.cc._easeElasticOutObj};exports.cc.EaseElasticInOut=exports.cc.EaseElastic.extend({update:function(t){var e=0,r=this._period;if(t===0||t===1)e=t;else{t=t*2,r||(r=this._period=.3*1.5);var n=r/4;t=t-1,t<0?e=-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/r):e=Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/r)*.5+1}this._inner.update(e)},reverse:function(){return new exports.cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new exports.cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}});exports.cc.EaseElasticInOut.create=function(t,e){return new exports.cc.EaseElasticInOut(t,e)};exports.cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(e){var r=0,n=this._period;if(e===0||e===1)r=e;else{e=e*2,n||(n=this._period=.3*1.5);var s=n/4;e=e-1,e<0?r=-.5*Math.pow(2,10*e)*Math.sin((e-s)*Math.PI*2/n):r=Math.pow(2,-10*e)*Math.sin((e-s)*Math.PI*2/n)*.5+1}return r},reverse:function(){return exports.cc.easeElasticInOut(this._period)}}};exports.cc.EaseBounce=exports.cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)},clone:function(){var t=new exports.cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseBounce(this._inner.reverse())}});exports.cc.EaseBounce.create=function(t){return new exports.cc.EaseBounce(t)};exports.cc.EaseBounceIn=exports.cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new exports.cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseBounceIn.create=function(t){return new exports.cc.EaseBounceIn(t)};exports.cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)};exports.cc._easeBounceInObj={easing:function(t){return 1-exports.cc._bounceTime(1-t)},reverse:function(){return exports.cc._easeBounceOutObj}};exports.cc.easeBounceIn=function(){return exports.cc._easeBounceInObj};exports.cc.EaseBounceOut=exports.cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new exports.cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseBounceOut.create=function(t){return new exports.cc.EaseBounceOut(t)};exports.cc._easeBounceOutObj={easing:function(t){return exports.cc._bounceTime(t)},reverse:function(){return exports.cc._easeBounceInObj}};exports.cc.easeBounceOut=function(){return exports.cc._easeBounceOutObj};exports.cc.EaseBounceInOut=exports.cc.EaseBounce.extend({update:function(t){var e=0;t<.5?(t=t*2,e=(1-this.bounceTime(1-t))*.5):e=this.bounceTime(t*2-1)*.5+.5,this._inner.update(e)},clone:function(){var t=new exports.cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseBounceInOut(this._inner.reverse())}});exports.cc.EaseBounceInOut.create=function(t){return new exports.cc.EaseBounceInOut(t)};exports.cc._easeBounceInOutObj={easing:function(t){var e;return t<.5?(t=t*2,e=(1-exports.cc._bounceTime(1-t))*.5):e=exports.cc._bounceTime(t*2-1)*.5+.5,e},reverse:function(){return exports.cc._easeBounceInOutObj}};exports.cc.easeBounceInOut=function(){return exports.cc._easeBounceInOutObj};exports.cc.EaseBackIn=exports.cc.ActionEase.extend({update:function(t){var e=1.70158;t=t===0||t===1?t:t*t*((e+1)*t-e),this._inner.update(t)},reverse:function(){return new exports.cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseBackIn.create=function(t){return new exports.cc.EaseBackIn(t)};exports.cc._easeBackInObj={easing:function(t){var e=1.70158;return t===0||t===1?t:t*t*((e+1)*t-e)},reverse:function(){return exports.cc._easeBackOutObj}};exports.cc.easeBackIn=function(){return exports.cc._easeBackInObj};exports.cc.EaseBackOut=exports.cc.ActionEase.extend({update:function(t){var e=1.70158;t=t-1,this._inner.update(t*t*((e+1)*t+e)+1)},reverse:function(){return new exports.cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new exports.cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}});exports.cc.EaseBackOut.create=function(t){return new exports.cc.EaseBackOut(t)};exports.cc._easeBackOutObj={easing:function(t){var e=1.70158;return t=t-1,t*t*((e+1)*t+e)+1},reverse:function(){return exports.cc._easeBackInObj}};exports.cc.easeBackOut=function(){return exports.cc._easeBackOutObj};exports.cc.EaseBackInOut=exports.cc.ActionEase.extend({update:function(t){var e=2.5949095;t=t*2,t<1?this._inner.update(t*t*((e+1)*t-e)/2):(t=t-2,this._inner.update(t*t*((e+1)*t+e)/2+1))},clone:function(){var t=new exports.cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseBackInOut(this._inner.reverse())}});exports.cc.EaseBackInOut.create=function(t){return new exports.cc.EaseBackInOut(t)};exports.cc._easeBackInOutObj={easing:function(t){var e=2.5949095;return t=t*2,t<1?t*t*((e+1)*t-e)/2:(t=t-2,t*t*((e+1)*t+e)/2+1)},reverse:function(){return exports.cc._easeBackInOutObj}};exports.cc.easeBackInOut=function(){return exports.cc._easeBackInOutObj};exports.cc.EaseBezierAction=exports.cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){exports.cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,r,n,s){return Math.pow(1-s,3)*t+3*s*Math.pow(1-s,2)*e+3*Math.pow(s,2)*(1-s)*r+Math.pow(s,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new exports.cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new exports.cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,r,n){this._p0=t||0,this._p1=e||0,this._p2=r||0,this._p3=n||0}});exports.cc.EaseBezierAction.create=function(t){return new exports.cc.EaseBezierAction(t)};exports.cc.easeBezierAction=function(t,e,r,n){return{easing:function(s){return exports.cc.EaseBezierAction.prototype._updateTime(t,e,r,n,s)},reverse:function(){return exports.cc.easeBezierAction(n,r,e,t)}}};exports.cc.EaseQuadraticActionIn=exports.cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuadraticActionIn(this._inner.reverse())}});exports.cc.EaseQuadraticActionIn.create=function(t){return new exports.cc.EaseQuadraticActionIn(t)};exports.cc._easeQuadraticActionIn={easing:exports.cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return exports.cc._easeQuadraticActionIn}};exports.cc.easeQuadraticActionIn=function(){return exports.cc._easeQuadraticActionIn};exports.cc.EaseQuadraticActionOut=exports.cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new exports.cc.EaseQuadraticActionOut(this._inner.reverse())}});exports.cc.EaseQuadraticActionOut.create=function(t){return new exports.cc.EaseQuadraticActionOut(t)};exports.cc._easeQuadraticActionOut={easing:exports.cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuadraticActionOut}};exports.cc.easeQuadraticActionOut=function(){return exports.cc._easeQuadraticActionOut};exports.cc.EaseQuadraticActionInOut=exports.cc.ActionEase.extend({_updateTime:function(t){var e=t;return t*=2,t<1?e=t*t*.5:(--t,e=-.5*(t*(t-2)-1)),e},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuadraticActionInOut(this._inner.reverse())}});exports.cc.EaseQuadraticActionInOut.create=function(t){return new exports.cc.EaseQuadraticActionInOut(t)};exports.cc._easeQuadraticActionInOut={easing:exports.cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuadraticActionInOut}};exports.cc.easeQuadraticActionInOut=function(){return exports.cc._easeQuadraticActionInOut};exports.cc.EaseQuarticActionIn=exports.cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuarticActionIn(this._inner.reverse())}});exports.cc.EaseQuarticActionIn.create=function(t){return new exports.cc.EaseQuarticActionIn(t)};exports.cc._easeQuarticActionIn={easing:exports.cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return exports.cc._easeQuarticActionIn}};exports.cc.easeQuarticActionIn=function(){return exports.cc._easeQuarticActionIn};exports.cc.EaseQuarticActionOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t-=1,-(t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuarticActionOut(this._inner.reverse())}});exports.cc.EaseQuarticActionOut.create=function(t){return new exports.cc.EaseQuarticActionOut(t)};exports.cc._easeQuarticActionOut={easing:exports.cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuarticActionOut}};exports.cc.easeQuarticActionOut=function(){return exports.cc._easeQuarticActionOut};exports.cc.EaseQuarticActionInOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t=t*2,t<1?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuarticActionInOut(this._inner.reverse())}});exports.cc.EaseQuarticActionInOut.create=function(t){return new exports.cc.EaseQuarticActionInOut(t)};exports.cc._easeQuarticActionInOut={easing:exports.cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuarticActionInOut}};exports.cc.easeQuarticActionInOut=function(){return exports.cc._easeQuarticActionInOut};exports.cc.EaseQuinticActionIn=exports.cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuinticActionIn(this._inner.reverse())}});exports.cc.EaseQuinticActionIn.create=function(t){return new exports.cc.EaseQuinticActionIn(t)};exports.cc._easeQuinticActionIn={easing:exports.cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return exports.cc._easeQuinticActionIn}};exports.cc.easeQuinticActionIn=function(){return exports.cc._easeQuinticActionIn};exports.cc.EaseQuinticActionOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuinticActionOut(this._inner.reverse())}});exports.cc.EaseQuinticActionOut.create=function(t){return new exports.cc.EaseQuinticActionOut(t)};exports.cc._easeQuinticActionOut={easing:exports.cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuinticActionOut}};exports.cc.easeQuinticActionOut=function(){return exports.cc._easeQuinticActionOut};exports.cc.EaseQuinticActionInOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t=t*2,t<1?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseQuinticActionInOut(this._inner.reverse())}});exports.cc.EaseQuinticActionInOut.create=function(t){return new exports.cc.EaseQuinticActionInOut(t)};exports.cc._easeQuinticActionInOut={easing:exports.cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return exports.cc._easeQuinticActionInOut}};exports.cc.easeQuinticActionInOut=function(){return exports.cc._easeQuinticActionInOut};exports.cc.EaseCircleActionIn=exports.cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCircleActionIn(this._inner.reverse())}});exports.cc.EaseCircleActionIn.create=function(t){return new exports.cc.EaseCircleActionIn(t)};exports.cc._easeCircleActionIn={easing:exports.cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return exports.cc._easeCircleActionIn}};exports.cc.easeCircleActionIn=function(){return exports.cc._easeCircleActionIn};exports.cc.EaseCircleActionOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t=t-1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCircleActionOut(this._inner.reverse())}});exports.cc.EaseCircleActionOut.create=function(t){return new exports.cc.EaseCircleActionOut(t)};exports.cc._easeCircleActionOut={easing:exports.cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return exports.cc._easeCircleActionOut}};exports.cc.easeCircleActionOut=function(){return exports.cc._easeCircleActionOut};exports.cc.EaseCircleActionInOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t=t*2,t<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCircleActionInOut(this._inner.reverse())}});exports.cc.EaseCircleActionInOut.create=function(t){return new exports.cc.EaseCircleActionInOut(t)};exports.cc._easeCircleActionInOut={easing:exports.cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return exports.cc._easeCircleActionInOut}};exports.cc.easeCircleActionInOut=function(){return exports.cc._easeCircleActionInOut};exports.cc.EaseCubicActionIn=exports.cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCubicActionIn(this._inner.reverse())}});exports.cc.EaseCubicActionIn.create=function(t){return new exports.cc.EaseCubicActionIn(t)};exports.cc._easeCubicActionIn={easing:exports.cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return exports.cc._easeCubicActionIn}};exports.cc.easeCubicActionIn=function(){return exports.cc._easeCubicActionIn};exports.cc.EaseCubicActionOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t-=1,t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCubicActionOut(this._inner.reverse())}});exports.cc.EaseCubicActionOut.create=function(t){return new exports.cc.EaseCubicActionOut(t)};exports.cc._easeCubicActionOut={easing:exports.cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return exports.cc._easeCubicActionOut}};exports.cc.easeCubicActionOut=function(){return exports.cc._easeCubicActionOut};exports.cc.EaseCubicActionInOut=exports.cc.ActionEase.extend({_updateTime:function(t){return t=t*2,t<1?.5*t*t*t:(t-=2,.5*(t*t*t+2))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new exports.cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new exports.cc.EaseCubicActionInOut(this._inner.reverse())}});exports.cc.EaseCubicActionInOut.create=function(t){return new exports.cc.EaseCubicActionInOut(t)};exports.cc._easeCubicActionInOut={easing:exports.cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return exports.cc._easeCubicActionInOut}};exports.cc.easeCubicActionInOut=function(){return exports.cc._easeCubicActionInOut};exports.cc.cardinalSplineAt=function(t,e,r,n,s,o){var a=o*o,c=a*o,l=(1-s)/2,h=l*(-c+2*a-o),u=l*(-c+a)+(2*c-3*a+1),_=l*(c-2*a+o)+(-2*c+3*a),d=l*(c-a),f=t.x*h+e.x*u+r.x*_+n.x*d,T=t.y*h+e.y*u+r.y*_+n.y*d;return exports.cc.p(f,T)};exports.cc.reverseControlPoints=function(t){for(var e=[],r=t.length-1;r>=0;r--)e.push(exports.cc.p(t[r].x,t[r].y));return e};exports.cc.cloneControlPoints=function(t){for(var e=[],r=0;r<t.length;r++)e.push(exports.cc.p(t[r].x,t[r].y));return e};exports.cc.copyControlPoints=exports.cc.cloneControlPoints;exports.cc.getControlPointAt=function(t,e){var r=Math.min(t.length-1,Math.max(e,0));return t[r]};exports.cc.reverseControlPointsInline=function(t){for(var e=t.length,r=0|e/2,n=0;n<r;++n){var s=t[n];t[n]=t[e-n-1],t[e-n-1]=s}};exports.cc.CardinalSplineTo=exports.cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),this._points=[],r!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){if(!e||e.length===0)throw new Error("Invalid configuration. It must at least have one control point");return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this.setPoints(e),this._tension=r,!0):!1},clone:function(){var t=new exports.cc.CardinalSplineTo;return t.initWithDuration(this._duration,exports.cc.copyControlPoints(this._points),this._tension),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=exports.cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=exports.cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,r,n=this._points;if(t===1)e=n.length-1,r=1;else{var s=this._deltaT;e=0|t/s,r=(t-s*e)/s}var o=exports.cc.cardinalSplineAt(exports.cc.getControlPointAt(n,e-1),exports.cc.getControlPointAt(n,e-0),exports.cc.getControlPointAt(n,e+1),exports.cc.getControlPointAt(n,e+2),this._tension,r);if(exports.cc.ENABLE_STACKABLE_ACTIONS){var a,c;if(a=this.target.getPositionX()-this._previousPosition.x,c=this.target.getPositionY()-this._previousPosition.y,a!==0||c!==0){var l=this._accumulatedDiff;a=l.x+a,c=l.y+c,l.x=a,l.y=c,o.x+=a,o.y+=c}}this.updatePosition(o)},reverse:function(){var t=exports.cc.reverseControlPoints(this._points);return exports.cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}});exports.cc.cardinalSplineTo=function(t,e,r){return new exports.cc.CardinalSplineTo(t,e,r)};exports.cc.CardinalSplineTo.create=exports.cc.cardinalSplineTo;exports.cc.CardinalSplineBy=exports.cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,r){exports.cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=exports.cc.p(0,0),r!==void 0&&this.initWithDuration(t,e,r)},startWithTarget:function(t){exports.cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t=this._points.slice(),e,r=t[0],n=1;n<t.length;++n)e=t[n],t[n]=exports.cc.pSub(e,r),r=e;var s=exports.cc.reverseControlPoints(t);r=s[s.length-1],s.pop(),r.x=-r.x,r.y=-r.y,s.unshift(r);for(var n=1;n<s.length;++n)e=s[n],e.x=-e.x,e.y=-e.y,e.x+=r.x,e.y+=r.y,s[n]=e,r=e;return exports.cc.cardinalSplineBy(this._duration,s,this._tension)},updatePosition:function(t){var e=this._startPosition,r=t.x+e.x,n=t.y+e.y;this._previousPosition.x=r,this._previousPosition.y=n,this.target.setPosition(r,n)},clone:function(){var t=new exports.cc.CardinalSplineBy;return t.initWithDuration(this._duration,exports.cc.copyControlPoints(this._points),this._tension),t}});exports.cc.cardinalSplineBy=function(t,e,r){return new exports.cc.CardinalSplineBy(t,e,r)};exports.cc.CardinalSplineBy.create=exports.cc.cardinalSplineBy;exports.cc.CatmullRomTo=exports.cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new exports.cc.CatmullRomTo;return t.initWithDuration(this._duration,exports.cc.copyControlPoints(this._points)),t}});exports.cc.catmullRomTo=function(t,e){return new exports.cc.CatmullRomTo(t,e)};exports.cc.CatmullRomTo.create=exports.cc.catmullRomTo;exports.cc.CatmullRomBy=exports.cc.CardinalSplineBy.extend({ctor:function(t,e){exports.cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new exports.cc.CatmullRomBy;return t.initWithDuration(this._duration,exports.cc.copyControlPoints(this._points)),t}});exports.cc.catmullRomBy=function(t,e){return new exports.cc.CatmullRomBy(t,e)};exports.cc.CatmullRomBy.create=exports.cc.catmullRomBy;exports.cc.ActionTweenDelegate=exports.cc.Class.extend({updateTweenAction:function(t,e){}});exports.cc.ActionTween=exports.cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,r,n){exports.cc.ActionInterval.prototype.ctor.call(this),this.key="",n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this.key=e,this.to=n,this.from=r,!0):!1},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw new Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new exports.cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new exports.cc.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}});exports.cc.actionTween=function(t,e,r,n){return new exports.cc.ActionTween(t,e,r,n)};exports.cc.ActionTween.create=exports.cc.actionTween;(function(){var t=exports.cc.sys;t.browserVersion;var e=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),r={ONLY_ONE:!1,WEB_AUDIO:e,DELAY_CREATE_CTX:!1,ONE_SOURCE:!1};t.browserType===t.BROWSER_TYPE_FIREFOX&&(r.DELAY_CREATE_CTX=!0,r.USE_LOADER_EVENT="canplay"),t.os===t.OS_IOS&&(r.USE_LOADER_EVENT="loadedmetadata"),t.os===t.OS_ANDROID&&t.browserType===t.BROWSER_TYPE_UC&&(r.ONE_SOURCE=!0),window.__audioSupport=r})();exports.cc.Audio=exports.cc.Class.extend({src:null,_element:null,_AUDIO_TYPE:"AUDIO",ctor:function(t){this.src=t},setBuffer:function(t){this._AUDIO_TYPE="WEBAUDIO",this._element=new exports.cc.Audio.WebAudio(t)},setElement:function(t){this._AUDIO_TYPE="AUDIO",this._element=t,t.addEventListener("ended",function(){t.loop||(t.paused=!0)})},play:function(t,e){this._element&&(this._element.loop=e,this._element.play(),this._AUDIO_TYPE==="AUDIO"&&this._element.paused&&(this.stop(),exports.cc.Audio.touchPlayList.push({loop:e,offset:t,audio:this._element})),exports.cc.Audio.bindTouch===!1&&(exports.cc.Audio.bindTouch=!0,exports.cc.game.canvas.addEventListener("touchstart",exports.cc.Audio.touchStart)))},getPlaying:function(){return this._element?!this._element.paused:!0},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}}},pause:function(){this._element&&this._element.pause()},resume:function(){this._element&&this._element.play()},setVolume:function(t){this._element&&(this._element.volume=t)},getVolume:function(){if(this._element)return this._element.volume},cloneNode:function(){var t=new exports.cc.Audio(this.src);if(this._AUDIO_TYPE==="AUDIO"){for(var e=document.createElement("audio"),r=e.getElementsByTagName("source"),n=0;n<r.length;n++)e.appendChild(r[n]);e.src=this.src,t.setElement(e)}else t.setBuffer(this._element.buffer);return t}});exports.cc.Audio.touchPlayList=[];exports.cc.Audio.bindTouch=!1;exports.cc.Audio.touchStart=function(){for(var t=exports.cc.Audio.touchPlayList,e=null;e=t.pop();)e.audio.loop=!!e.loop,e.audio.play(e.offset)};exports.cc.Audio.WebAudio=function(t){this.buffer=t,this.context=exports.cc.Audio._context;var e=this.context.createGain();e.gain.value=1,e.connect(this.context.destination),this._volume=e,this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null};exports.cc.Audio.WebAudio.prototype={constructor:exports.cc.Audio.WebAudio,get paused(){return this._currentSource&&this._currentSource.loop?!1:this._startTime===-1?!0:this.context.currentTime-this._startTime>this.buffer.duration},set paused(t){},get loop(){return this._loop},set loop(t){return this._loop=t},get volume(){return this._volume.gain.value},set volume(t){return this._volume.gain.value=t},get currentTime(){return this.playedLength},set currentTime(t){return this.playedLength=t},play:function(t){this._currentSource&&!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var e=this.context.createBufferSource();e.buffer=this.buffer,e.connect(this._volume),e.loop=this._loop,this._startTime=this.context.currentTime,t=t||this.playedLength;var r=this.buffer.duration;if(this._loop?e.start?e.start(0):e.notoGrainOn?e.noteGrainOn(0):e.noteOn(0):e.start?e.start(0,t,r-t):e.notoGrainOn?e.noteGrainOn(0,t,r-t):e.noteOn(0,t,r-t),this._currentSource=e,this.context.currentTime===0){var n=this||window;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){n.context.currentTime===0&&exports.cc.Audio.touchPlayList.push({offset:t,audio:n})},10)}},pause:function(){this.playedLength=this.context.currentTime-this._startTime,this.playedLength%=this.buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}};(function(t){var e=t.WEB_AUDIO,r=t.ONLY_ONE,n=[];(function(){var a=document.createElement("audio");if(a.canPlayType){var c=a.canPlayType('audio/ogg; codecs="vorbis"');c&&c!==""&&n.push(".ogg");var l=a.canPlayType("audio/mpeg");l&&l!==""&&n.push(".mp3");var h=a.canPlayType('audio/wav; codecs="1"');h&&h!==""&&n.push(".wav");var u=a.canPlayType("audio/mp4");u&&u!==""&&n.push(".mp4");var _=a.canPlayType("audio/x-m4a");_&&_!==""&&n.push(".m4a")}})();try{if(e){var s=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);exports.cc.Audio._context=s,t.DELAY_CREATE_CTX&&setTimeout(function(){s=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),exports.cc.Audio._context=s},0)}}catch(a){e=!1,exports.cc.log("browser don't support web audio")}var o={cache:{},useWebAudio:!1,loadBuffer:function(a,c){if(e){var l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){s.decodeAudioData(l.response,function(h){c(null,h)},function(){c("decode error - "+a)})},l.onerror=function(){c("request error - "+a)},l.send()}},load:function(a,c,l,h){if(n.length===0)return h("can not support audio!");var u=exports.cc.loader.getRes(c);if(u)return h(null,u);var _;exports.cc.loader.audioPath&&(a=exports.cc.path.join(exports.cc.loader.audioPath,a));var d=exports.cc.path.extname(a),f=[d];for(_=0;_<n.length;_++)d!==n[_]&&f.push(n[_]);return u=new exports.cc.Audio(a),exports.cc.loader.cache[c]=u,this.loadAudioFromExtList(a,f,u,h),u},loadAudioFromExtList:function(a,c,l,h){if(c.length===0){var u="can not found the resource of audio! Last match url is : ";return u+=a.replace(/\.(.*)?$/,"("),n.forEach(function(A){u+=A+"|"}),u=u.replace(/\|$/,")"),h({status:520,errorMessage:u},null)}if(e&&this.useWebAudio){this.loadBuffer(a,function(A,D){A&&exports.cc.log(A),D&&l.setBuffer(D),h(null,l)});return}for(var _=t.ONE_SOURCE?1:c.length,d=document.createElement("audio"),f=0;f<_;f++){var T=document.createElement("source");T.src=exports.cc.path.changeExtname(a,c[f]),d.appendChild(T)}l.setElement(d);var x=setTimeout(function(){d.readyState===0?v():m()},8e3),m=function(){d.removeEventListener("canplaythrough",m,!1),d.removeEventListener("error",v,!1),d.removeEventListener("emptied",m,!1),t.USE_LOADER_EVENT&&d.removeEventListener(t.USE_LOADER_EVENT,m,!1),clearTimeout(x),h(null,l)},v=function(){exports.cc.log("load audio failure - "+a),m()};d.addEventListener("canplaythrough",m,!1),d.addEventListener("error",v,!1),t.USE_LOADER_EVENT&&d.addEventListener(t.USE_LOADER_EVENT,m,!1)}};exports.cc.loader.register(["mp3","ogg","wav","mp4","m4a"],o),exports.cc.audioEngine={_currMusic:null,_musicVolume:1,features:t,willPlayMusic:function(){return!1},playMusic:function(a,c){var l=this._currMusic;l&&l.getPlaying()&&l.stop();var h=exports.cc.loader.getRes(a);h||(exports.cc.loader.load(a),h=exports.cc.loader.getRes(a)),h.setVolume(this._musicVolume),h.play(0,c||!1),this._currMusic=h},stopMusic:function(a){var c=this._currMusic;c&&(c.stop(),this._currMusic=null,a&&exports.cc.loader.release(c.src))},pauseMusic:function(){var a=this._currMusic;a&&a.pause()},resumeMusic:function(){var a=this._currMusic;a&&a.resume()},rewindMusic:function(){var a=this._currMusic;a&&(a.stop(),a.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(a){a=a-0,isNaN(a)&&(a=1),a>1&&(a=1),a<0&&(a=0),this._musicVolume=a;var c=this._currMusic;c&&c.setVolume(a)},isMusicPlaying:function(){var a=this._currMusic;return a?a.getPlaying():!1},_audioPool:{},_maxAudioInstance:10,_effectVolume:1,playEffect:function(a,c){if(r&&this._currMusic&&this._currMusic.getPlaying())return exports.cc.log("Browser is only allowed to play one audio"),null;var l=this._audioPool[a];l||(l=this._audioPool[a]=[]);var h;for(h=0;h<l.length&&l[h].getPlaying();h++);if(!e&&h>this._maxAudioInstance){var u=l.shift();u.stop(),l.push(u),h=l.length-1}var _;if(l[h])return _=l[h],_.setVolume(this._effectVolume),_.play(0,c||!1),_;if(_=exports.cc.loader.getRes(a),_&&e&&_._AUDIO_TYPE==="AUDIO"&&(exports.cc.loader.release(a),_=null),_)if(e&&_._AUDIO_TYPE==="AUDIO")o.loadBuffer(a,function(d,f){_.setBuffer(f),_.setVolume(exports.cc.audioEngine._effectVolume),_.getPlaying()||_.play(0,c||!1)});else return _=_.cloneNode(),_.setVolume(this._effectVolume),_.play(0,c||!1),l.push(_),_;return o.useWebAudio=!0,exports.cc.loader.load(a,function(d){d=exports.cc.loader.getRes(a),d=d.cloneNode(),d.setVolume(exports.cc.audioEngine._effectVolume),d.play(0,c||!1),l.push(d)}),o.useWebAudio=!1,_},setEffectsVolume:function(a){a=a-0,isNaN(a)&&(a=1),a>1&&(a=1),a<0&&(a=0),this._effectVolume=a;var c=this._audioPool;for(var l in c){var h=c[l];if(Array.isArray(h))for(var u=0;u<h.length;u++)h[u].setVolume(a)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(a){a&&a.pause()},pauseAllEffects:function(){var a=this._audioPool;for(var c in a)for(var l=a[c],h=0;h<a[c].length;h++)l[h].getPlaying()&&l[h].pause()},resumeEffect:function(a){a&&a.resume()},resumeAllEffects:function(){var a=this._audioPool;for(var c in a)for(var l=a[c],h=0;h<a[c].length;h++)l[h].resume()},stopEffect:function(a){a&&a.stop()},stopAllEffects:function(){var a=this._audioPool;for(var c in a){for(var l=a[c],h=0;h<l.length;h++)l[h].stop();l.length=0}},unloadEffect:function(a){if(a){exports.cc.loader.release(a);var c=this._audioPool[a];c&&(c.length=0),delete this._audioPool[a]}},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var a=this._currMusic;a&&a.getPlaying()&&(a.pause(),this._pauseCache.push(a));var c=this._audioPool;for(var l in c)for(var h=c[l],u=0;u<c[l].length;u++)h[u].getPlaying()&&(h[u].pause(),this._pauseCache.push(h[u]))},_resumePlaying:function(){for(var a=this._pauseCache,c=0;c<a.length;c++)a[c].resume();a.length=0}}})(window.__audioSupport);exports.cc._globalFontSize=exports.cc.ITEM_SIZE;exports.cc._globalFontName="Arial";exports.cc._globalFontNameRelease=!1;exports.cc.MenuItem=exports.cc.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(t,e){var r=exports.cc.Node.prototype;r.ctor.call(this),this._target=null,this._callback=null,this._isSelected=!1,this._enabled=!1,r.setAnchorPoint.call(this,.5,.5),this._target=e||null,this._callback=t||null,this._callback&&(this._enabled=!0)},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},setTarget:function(t,e){this._target=e,this._callback=t},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},initWithCallback:function(t,e){return this.anchorX=.5,this.anchorY=.5,this._target=e,this._callback=t,this._enabled=!0,this._isSelected=!1,!0},rect:function(){var t=this._position,e=this._contentSize,r=this._anchorPoint;return exports.cc.rect(t.x-e.width*r.x,t.y-e.height*r.y,e.width,e.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(t,e){this._target=e,this._callback=t},activate:function(){if(this._enabled){var t=this._target,e=this._callback;if(!e)return;t&&exports.cc.isString(e)?t[e](this):t&&exports.cc.isFunction(e)?e.call(t,this):e(this)}}});var _p=exports.cc.MenuItem.prototype;_p.enabled;exports.cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);exports.cc.MenuItem.create=function(t,e){return new exports.cc.MenuItem(t,e)};exports.cc.MenuItemLabel=exports.cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(t,e,r){exports.cc.MenuItem.prototype.ctor.call(this,e,r),this._disabledColor=null,this._label=null,this._colorBackup=null,t&&(this._originalScale=1,this._colorBackup=exports.cc.color.WHITE,this._disabledColor=exports.cc.color(126,126,126),this.setLabel(t),t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(n){this.width=n.width,this.height=n.height,this.parent instanceof exports.cc.Menu&&this.parent.updateAlign()},this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(t){this._disabledColor=t},getLabel:function(){return this._label},setLabel:function(t){t&&(this.addChild(t),t.anchorX=0,t.anchorY=0,this.width=t.width,this.height=t.height,t.setCascadeColorEnabled(!0)),this._label&&this.removeChild(this._label,!0),this._label=t},setEnabled:function(t){this._enabled!==t&&(t?this.setColor(this._colorBackup):(this._colorBackup=this.color,this.setColor(this._disabledColor))),exports.cc.MenuItem.prototype.setEnabled.call(this,t)},initWithLabel:function(t,e,r){return this.initWithCallback(e,r),this._originalScale=1,this._colorBackup=exports.cc.color.WHITE,this._disabledColor=exports.cc.color(126,126,126),this.setLabel(t),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setString:function(t){this._label.string=t,this.width=this._label.width,this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&(this.stopAllActions(),this.scale=this._originalScale,exports.cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){exports.cc.MenuItem.prototype.selected.call(this);var t=this.getActionByTag(exports.cc.ZOOM_ACTION_TAG);t?this.stopAction(t):this._originalScale=this.scale;var e=exports.cc.scaleTo(.1,this._originalScale*1.2);e.setTag(exports.cc.ZOOM_ACTION_TAG),this.runAction(e)}},unselected:function(){if(this._enabled){exports.cc.MenuItem.prototype.unselected.call(this),this.stopActionByTag(exports.cc.ZOOM_ACTION_TAG);var t=exports.cc.scaleTo(.1,this._originalScale);t.setTag(exports.cc.ZOOM_ACTION_TAG),this.runAction(t)}}});var _p=exports.cc.MenuItemLabel.prototype;_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.disabledColor;exports.cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor);_p.label;exports.cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel);exports.cc.MenuItemLabel.create=function(t,e,r){return new exports.cc.MenuItemLabel(t,e,r)};exports.cc.MenuItemAtlasFont=exports.cc.MenuItemLabel.extend({ctor:function(t,e,r,n,s,o,a){var c;t&&t.length>0&&(c=new exports.cc.LabelAtlas(t,e,r,n,s)),exports.cc.MenuItemLabel.prototype.ctor.call(this,c,o,a)},initWithString:function(t,e,r,n,s,o,a){if(!t||t.length===0)throw new Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0");var c=new exports.cc.LabelAtlas;return c.initWithString(t,e,r,n,s),this.initWithLabel(c,o,a),!0}});exports.cc.MenuItemAtlasFont.create=function(t,e,r,n,s,o,a){return new exports.cc.MenuItemAtlasFont(t,e,r,n,s,o,a)};exports.cc.MenuItemFont=exports.cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(t,e,r){var n;t&&t.length>0?(this._fontName=exports.cc._globalFontName,this._fontSize=exports.cc._globalFontSize,n=new exports.cc.LabelTTF(t,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName=""),exports.cc.MenuItemLabel.prototype.ctor.call(this,n,e,r)},initWithString:function(t,e,r){if(!t||t.length===0)throw new Error("Value should be non-null and its length should be greater than 0");this._fontName=exports.cc._globalFontName,this._fontSize=exports.cc._globalFontSize;var n=new exports.cc.LabelTTF(t,this._fontName,this._fontSize);return this.initWithLabel(n,e,r),!0},setFontSize:function(t){this._fontSize=t,this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var t=new exports.cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(t)}});exports.cc.MenuItemFont.setFontSize=function(t){exports.cc._globalFontSize=t};exports.cc.MenuItemFont.fontSize=function(){return exports.cc._globalFontSize};exports.cc.MenuItemFont.setFontName=function(t){exports.cc._globalFontNameRelease&&(exports.cc._globalFontName=""),exports.cc._globalFontName=t,exports.cc._globalFontNameRelease=!0};var _p=exports.cc.MenuItemFont.prototype;_p.fontSize;exports.cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;exports.cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);exports.cc.MenuItemFont.fontName=function(){return exports.cc._globalFontName};exports.cc.MenuItemFont.create=function(t,e,r){return new exports.cc.MenuItemFont(t,e,r)};exports.cc.MenuItemSprite=exports.cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(t,e,r,n,s){if(exports.cc.MenuItem.prototype.ctor.call(this),this._normalImage=null,this._selectedImage=null,this._disabledImage=null,this._loader=new exports.cc.Sprite.LoadManager,t!==void 0){e=e||null;var o,a,c;return s!==void 0?(o=r,c=n,a=s):n!==void 0&&exports.cc.isFunction(n)?(o=r,c=n):n!==void 0&&exports.cc.isFunction(r)?(a=n,c=r,o=null):r===void 0&&(o=null),this._loader.clear(),t.textureLoaded&&!t.textureLoaded()?(this._loader.once(t,function(){this.initWithNormalSprite(t,e,o,c,a)},this),!1):(this.initWithNormalSprite(t,e,o,c,a),!0)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(t){this._normalImage!==t&&(t&&(this.addChild(t,0,exports.cc.NORMAL_TAG),t.anchorX=0,t.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=t,this._normalImage&&(this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),t.textureLoaded&&!t.textureLoaded()&&t.addEventListener("load",function(e){this.width=e.width,this.height=e.height,this.parent instanceof exports.cc.Menu&&this.parent.updateAlign()},this)))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(t){this._selectedImage!==t&&(t&&(this.addChild(t,0,exports.cc.SELECTED_TAG),t.anchorX=0,t.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=t,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(t){this._disabledImage!==t&&(t&&(this.addChild(t,0,exports.cc.DISABLE_TAG),t.anchorX=0,t.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=t,this._updateImagesVisibility())},initWithNormalSprite:function(t,e,r,n,s){if(this._loader.clear(),t.textureLoaded&&!t.textureLoaded())return this._loader.once(t,function(){this.initWithNormalSprite(t,e,r,n,s)},this),!1;this.initWithCallback(n,s),this.setNormalImage(t),this.setSelectedImage(e),this.setDisabledImage(r);var o=this._normalImage;return o&&(this.width=o.width,this.height=o.height),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},selected:function(){exports.cc.MenuItem.prototype.selected.call(this),this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){exports.cc.MenuItem.prototype.unselected.call(this),this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(t){this._enabled!==t&&(exports.cc.MenuItem.prototype.setEnabled.call(this,t),this._updateImagesVisibility())},_updateImagesVisibility:function(){var t=this._normalImage,e=this._selectedImage,r=this._disabledImage;this._enabled?(t&&(t.visible=!0),e&&(e.visible=!1),r&&(r.visible=!1)):r?(t&&(t.visible=!1),e&&(e.visible=!1),r&&(r.visible=!0)):(t&&(t.visible=!0),e&&(e.visible=!1))}});var _p=exports.cc.MenuItemSprite.prototype;_p.normalImage;exports.cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage);_p.selectedImage;exports.cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage);_p.disabledImage;exports.cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage);exports.cc.MenuItemSprite.create=function(t,e,r,n,s){return new exports.cc.MenuItemSprite(t,e,r,n,s||void 0)};exports.cc.MenuItemImage=exports.cc.MenuItemSprite.extend({ctor:function(t,e,r,n,s){var o=null,a=null,c=null,l=null,h=null;t==null?exports.cc.MenuItemSprite.prototype.ctor.call(this):(o=new exports.cc.Sprite(t),e&&(a=new exports.cc.Sprite(e)),n===void 0?l=r:s===void 0?(l=r,h=n):s&&(c=new exports.cc.Sprite(r),l=n,h=s),exports.cc.MenuItemSprite.prototype.ctor.call(this,o,a,c,l,h))},setNormalSpriteFrame:function(t){this.setNormalImage(new exports.cc.Sprite(t))},setSelectedSpriteFrame:function(t){this.setSelectedImage(new exports.cc.Sprite(t))},setDisabledSpriteFrame:function(t){this.setDisabledImage(new exports.cc.Sprite(t))},initWithNormalImage:function(t,e,r,n,s){var o=null,a=null,c=null;return t&&(o=new exports.cc.Sprite(t)),e&&(a=new exports.cc.Sprite(e)),r&&(c=new exports.cc.Sprite(r)),this.initWithNormalSprite(o,a,c,n,s)}});exports.cc.MenuItemImage.create=function(t,e,r,n,s){return new exports.cc.MenuItemImage(t,e,r,n,s)};exports.cc.MenuItemToggle=exports.cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){exports.cc.MenuItem.prototype.ctor.call(this),this._selectedIndex=0,this.subItems=[],this._opacity=0,this._color=exports.cc.color.WHITE,arguments.length>0&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this.subItems&&this.subItems.length>0)for(var e=0;e<this.subItems.length;e++)this.subItems[e].opacity=t;this._color.a=t},getColor:function(){var t=this._color;return exports.cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this.subItems&&this.subItems.length>0)for(var r=0;r<this.subItems.length;r++)this.subItems[r].setColor(t);t.a!==void 0&&!t.a_undefined&&this.setOpacity(t.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(t){if(t!==this._selectedIndex){this._selectedIndex=t;var e=this.getChildByTag(exports.cc.CURRENT_ITEM);e&&e.removeFromParent(!1);var r=this.subItems[this._selectedIndex];this.addChild(r,0,exports.cc.CURRENT_ITEM);var n=r.width,s=r.height;this.width=n,this.height=s,r.setPosition(n/2,s/2)}},getSubItems:function(){return this.subItems},setSubItems:function(t){this.subItems=t},initWithItems:function(t){var e=t.length;exports.cc.isFunction(t[t.length-2])?(this.initWithCallback(t[t.length-2],t[t.length-1]),e=e-2):exports.cc.isFunction(t[t.length-1])?(this.initWithCallback(t[t.length-1],null),e=e-1):this.initWithCallback(null,null);var r=this.subItems;r.length=0;for(var n=0;n<e;n++)t[n]&&r.push(t[n]);return this._selectedIndex=exports.cc.UINT_MAX,this.setSelectedIndex(0),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},addSubItem:function(t){this.subItems.push(t)},activate:function(){if(this._enabled){var t=(this._selectedIndex+1)%this.subItems.length;this.setSelectedIndex(t)}exports.cc.MenuItem.prototype.activate.call(this)},selected:function(){exports.cc.MenuItem.prototype.selected.call(this),this.subItems[this._selectedIndex].selected()},unselected:function(){exports.cc.MenuItem.prototype.unselected.call(this),this.subItems[this._selectedIndex].unselected()},setEnabled:function(t){if(this._enabled!==t){exports.cc.MenuItem.prototype.setEnabled.call(this,t);var e=this.subItems;if(e&&e.length>0)for(var r=0;r<e.length;r++)e[r].enabled=t}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){exports.cc.Node.prototype.onEnter.call(this),this.setSelectedIndex(this._selectedIndex)}});var _p=exports.cc.MenuItemToggle.prototype;_p.selectedIndex;exports.cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex);exports.cc.MenuItemToggle.create=function(){arguments.length>0&&arguments[arguments.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");var t=new exports.cc.MenuItemToggle;return t.initWithItems(Array.prototype.slice.apply(arguments)),t};exports.cc.MENU_STATE_WAITING=0;exports.cc.MENU_STATE_TRACKING_TOUCH=1;exports.cc.MENU_HANDLER_PRIORITY=-128;exports.cc.DEFAULT_PADDING=5;exports.cc.Menu=exports.cc.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(t){exports.cc.Layer.prototype.ctor.call(this),this._color=exports.cc.color.WHITE,this.enabled=!1,this._opacity=255,this._selectedItem=null,this._state=-1,this._touchListener=exports.cc.EventListener.create({event:exports.cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled}),arguments.length>0&&arguments[arguments.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");var e=arguments.length,r;if(e===0)r=[];else if(e===1)t instanceof Array?r=t:r=[t];else if(e>1){r=[];for(var n=0;n<e;n++)arguments[n]&&r.push(arguments[n])}this.initWithArray(r)},onEnter:function(){var t=this._touchListener;t._isRegistered()||exports.cc.eventManager.addListener(t,this),exports.cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(t){this.enabled=t},initWithItems:function(t){var e=[];if(t)for(var r=0;r<t.length;r++)t[r]&&e.push(t[r]);return this.initWithArray(e)},initWithArray:function(t){if(exports.cc.Layer.prototype.init.call(this)){this.enabled=!0;var e=exports.cc.winSize;if(this.setPosition(e.width/2,e.height/2),this.setContentSize(e),this.setAnchorPoint(.5,.5),this.ignoreAnchorPointForPosition(!0),t)for(var r=0;r<t.length;r++)this.addChild(t[r],r);return this._selectedItem=null,this._state=exports.cc.MENU_STATE_WAITING,this.cascadeColor=!0,this.cascadeOpacity=!0,!0}return!1},addChild:function(t,e,r){if(!(t instanceof exports.cc.MenuItem))throw new Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children");exports.cc.Layer.prototype.addChild.call(this,t,e,r)},updateAlign:function(){switch(this._align){case"vertically":this.alignItemsVertically();break;case"horizontally":this.alignItemsHorizontally();break}},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(exports.cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){this._align="vertically";var e=-t,r=this._children,n,s,o,a,c;if(r&&r.length>0){for(s=0,n=r.length;s<n;s++)e+=r[s].height*r[s].scaleY+t;var l=e/2;for(s=0,n=r.length;s<n;s++)c=r[s],a=c.height,o=c.scaleY,c.setPosition(0,l-a*o/2),l-=a*o+t}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(exports.cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){this._align="horizontally";var e=-t,r=this._children,n,s,o,a,c;if(r&&r.length>0){for(n=0,s=r.length;n<s;n++)e+=r[n].width*r[n].scaleX+t;var l=-e/2;for(n=0,s=r.length;n<s;n++)c=r[n],o=c.scaleX,a=r[n].width,c.setPosition(l+a*o/2,0),l+=a*o+t}},alignItemsInColumns:function(){arguments.length>0&&arguments[arguments.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var r=-5,n=0,s=0,o=0,a,c,l,h=this._children;if(h&&h.length>0)for(e=0,l=h.length;e<l;e++)n>=t.length||(a=t[n],a&&(c=h[e].height,s=s>=c||isNaN(c)?s:c,++o,o>=a&&(r+=s+5,o=0,s=0,++n)));var u=exports.cc.director.getWinSize();n=0,s=0,a=0;var _=0,d=0,f=r/2;if(h&&h.length>0)for(e=0,l=h.length;e<l;e++){var T=h[e];a===0&&(a=t[n],_=u.width/(1+a),d=_),c=T._getHeight(),s=s>=c||isNaN(c)?s:c,T.setPosition(d-u.width/2,f-c/2),d+=_,++o,o>=a&&(f-=s+5,o=0,a=0,s=0,++n)}},alignItemsInRows:function(){arguments.length>0&&arguments[arguments.length-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");var t=[],e;for(e=0;e<arguments.length;e++)t.push(arguments[e]);var r=[],n=[],s=-10,o=-5,a=0,c=0,l=0,h,u,_,d,f=this._children;if(f&&f.length>0)for(e=0,_=f.length;e<_;e++)u=f[e],!(a>=t.length)&&(h=t[a],h&&(d=u.width,c=c>=d||isNaN(d)?c:d,o+=u.height+5,++l,l>=h&&(r.push(c),n.push(o),s+=c+10,l=0,c=0,o=-5,++a)));var T=exports.cc.director.getWinSize();a=0,c=0,h=0;var x=-s/2,m=0;if(f&&f.length>0)for(e=0,_=f.length;e<_;e++)u=f[e],h===0&&(h=t[a],m=n[a]),d=u._getWidth(),c=c>=d||isNaN(d)?c:d,u.setPosition(x+r[a]/2,m-T.height/2),m-=u.height+10,++l,l>=h&&(x+=c+5,l=0,h=0,c=0,++a)},removeChild:function(t,e){if(t!=null){if(!(t instanceof exports.cc.MenuItem)){exports.cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children");return}this._selectedItem===t&&(this._selectedItem=null),exports.cc.Node.prototype.removeChild.call(this,t,e)}},_onTouchBegan:function(t,e){var r=e.getCurrentTarget();if(r._state!==exports.cc.MENU_STATE_WAITING||!r._visible||!r.enabled)return!1;for(var n=r.parent;n!=null;n=n.parent)if(!n.isVisible())return!1;return r._selectedItem=r._itemForTouch(t),r._selectedItem?(r._state=exports.cc.MENU_STATE_TRACKING_TOUCH,r._selectedItem.selected(),r._selectedItem.setNodeDirty(),!0):!1},_onTouchEnded:function(t,e){var r=e.getCurrentTarget();if(r._state!==exports.cc.MENU_STATE_TRACKING_TOUCH){exports.cc.log("cc.Menu.onTouchEnded(): invalid state");return}r._selectedItem&&(r._selectedItem.unselected(),r._selectedItem.setNodeDirty(),r._selectedItem.activate()),r._state=exports.cc.MENU_STATE_WAITING},_onTouchCancelled:function(t,e){var r=e.getCurrentTarget();if(r._state!==exports.cc.MENU_STATE_TRACKING_TOUCH){exports.cc.log("cc.Menu.onTouchCancelled(): invalid state");return}r._selectedItem&&(r._selectedItem.unselected(),r._selectedItem.setNodeDirty()),r._state=exports.cc.MENU_STATE_WAITING},_onTouchMoved:function(t,e){var r=e.getCurrentTarget();if(r._state!==exports.cc.MENU_STATE_TRACKING_TOUCH){exports.cc.log("cc.Menu.onTouchMoved(): invalid state");return}var n=r._itemForTouch(t);n!==r._selectedItem&&(r._selectedItem&&(r._selectedItem.unselected(),r._selectedItem.setNodeDirty()),r._selectedItem=n,r._selectedItem&&(r._selectedItem.selected(),r._selectedItem.setNodeDirty()))},onExit:function(){this._state===exports.cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=exports.cc.MENU_STATE_WAITING),exports.cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(t){var e=t.getLocation(),r=this._children,n;if(r&&r.length>0){for(var s=r.length-1;s>=0;s--)if(n=r[s],n.isVisible()&&n.isEnabled()){var o=n.convertToNodeSpace(e),a=n.rect();if(a.x=0,a.y=0,exports.cc.rectContainsPoint(a,o))return n}}return null}});var _p=exports.cc.Menu.prototype;_p.enabled;exports.cc.Menu.create=function(t){var e=arguments.length;e>0&&arguments[e-1]==null&&exports.cc.log("parameters should not be ending with null in Javascript");var r;return e===0?r=new exports.cc.Menu:e===1?r=new exports.cc.Menu(t):r=new exports.cc.Menu(Array.prototype.slice.call(arguments,0)),r};exports.cc.math=exports.cc.math||{};exports.cc.math.EPSILON=1/64;exports.cc.math.square=function(t){return t*t};exports.cc.math.almostEqual=function(t,e){return t+exports.cc.math.EPSILON>e&&t-exports.cc.math.EPSILON<e};(function(t){t.math.Vec2=function(r,n){n===void 0?(this.x=r.x,this.y=r.y):(this.x=r||0,this.y=n||0)};var e=t.math.Vec2.prototype;e.fill=function(r,n){this.x=r,this.y=n},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)},e.normalize=function(){var r=1/this.length();return this.x*=r,this.y*=r,this},t.math.Vec2.add=function(r,n,s){return r.x=n.x+s.x,r.y=n.y+s.y,r},e.add=function(r){return this.x+=r.x,this.y+=r.y,this},e.dot=function(r){return this.x*r.x+this.y*r.y},t.math.Vec2.subtract=function(r,n,s){return r.x=n.x-s.x,r.y=n.y-s.y,r},e.subtract=function(r){return this.x-=r.x,this.y-=r.y,this},e.transform=function(r){var n=this.x,s=this.y;return this.x=n*r.mat[0]+s*r.mat[3]+r.mat[6],this.y=n*r.mat[1]+s*r.mat[4]+r.mat[7],this},t.math.Vec2.scale=function(r,n,s){return r.x=n.x*s,r.y=n.y*s,r},e.scale=function(r){return this.x*=r,this.y*=r,this},e.equals=function(r){return this.x<r.x+t.math.EPSILON&&this.x>r.x-t.math.EPSILON&&this.y<r.y+t.math.EPSILON&&this.y>r.y-t.math.EPSILON}})(exports.cc);(function(t){t.math.Vec3=t.kmVec3=function(r,n,s){r&&n===void 0?(this.x=r.x,this.y=r.y,this.z=r.z):(this.x=r||0,this.y=n||0,this.z=s||0)},t.math.vec3=function(r,n,s){return new t.math.Vec3(r,n,s)};var e=t.math.Vec3.prototype;e.fill=function(r,n,s){return r&&n===void 0?(this.x=r.x,this.y=r.y,this.z=r.z):(this.x=r,this.y=n,this.z=s),this},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)},e.normalize=function(){var r=1/this.length();return this.x*=r,this.y*=r,this.z*=r,this},e.cross=function(r){var n=this.x,s=this.y,o=this.z;return this.x=s*r.z-o*r.y,this.y=o*r.x-n*r.z,this.z=n*r.y-s*r.x,this},e.dot=function(r){return this.x*r.x+this.y*r.y+this.z*r.z},e.add=function(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this},e.subtract=function(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this},e.transform=function(r){var n=this.x,s=this.y,o=this.z,a=r.mat;return this.x=n*a[0]+s*a[4]+o*a[8]+a[12],this.y=n*a[1]+s*a[5]+o*a[9]+a[13],this.z=n*a[2]+s*a[6]+o*a[10]+a[14],this},e.transformNormal=function(r){var n=this.x,s=this.y,o=this.z,a=r.mat;return this.x=n*a[0]+s*a[4]+o*a[8],this.y=n*a[1]+s*a[5]+o*a[9],this.z=n*a[2]+s*a[6]+o*a[10],this},e.transformCoord=function(r){var n=new t.math.Vec4(this.x,this.y,this.z,1);return n.transform(r),this.x=n.x/n.w,this.y=n.y/n.w,this.z=n.z/n.w,this},e.scale=function(r){return this.x*=r,this.y*=r,this.z*=r,this},e.equals=function(r){var n=t.math.EPSILON;return this.x<r.x+n&&this.x>r.x-n&&this.y<r.y+n&&this.y>r.y-n&&this.z<r.z+n&&this.z>r.z-n},e.inverseTransform=function(r){var n=r.mat,s=new t.math.Vec3(this.x-n[12],this.y-n[13],this.z-n[14]);return this.x=s.x*n[0]+s.y*n[1]+s.z*n[2],this.y=s.x*n[4]+s.y*n[5]+s.z*n[6],this.z=s.x*n[8]+s.y*n[9]+s.z*n[10],this},e.inverseTransformNormal=function(r){var n=this.x,s=this.y,o=this.z,a=r.mat;return this.x=n*a[0]+s*a[1]+o*a[2],this.y=n*a[4]+s*a[5]+o*a[6],this.z=n*a[8]+s*a[9]+o*a[10],this},e.assignFrom=function(r){return r?(this.x=r.x,this.y=r.y,this.z=r.z,this):this},t.math.Vec3.zero=function(r){return r.x=r.y=r.z=0,r},e.toTypeArray=function(){var r=new Float32Array(3);return r[0]=this.x,r[1]=this.y,r[2]=this.z,r}})(exports.cc);(function(t){t.math.Vec4=function(r,n,s,o){r&&n===void 0?(this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w):(this.x=r||0,this.y=n||0,this.z=s||0,this.w=o||0)},t.kmVec4=t.math.Vec4;var e=t.math.Vec4.prototype;e.fill=function(r,n,s,o){r&&n===void 0?(this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w):(this.x=r,this.y=n,this.z=s,this.w=o)},e.add=function(r){return r?(this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this):this},e.dot=function(r){return this.x*r.x+this.y*r.y+this.z*r.z+this.w*r.w},e.length=function(){return Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w))},e.lengthSq=function(){return t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)+t.math.square(this.w)},e.lerp=function(r,n){return this},e.normalize=function(){var r=1/this.length();return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},e.scale=function(r){return this.normalize(),this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},e.subtract=function(r){this.x-=r.x,this.y-=r.y,this.z-=r.z,this.w-=r.w},e.transform=function(r){var n=this.x,s=this.y,o=this.z,a=this.w,c=r.mat;return this.x=n*c[0]+s*c[4]+o*c[8]+a*c[12],this.y=n*c[1]+s*c[5]+o*c[9]+a*c[13],this.z=n*c[2]+s*c[6]+o*c[10]+a*c[14],this.w=n*c[3]+s*c[7]+o*c[11]+a*c[15],this},t.math.Vec4.transformArray=function(r,n){for(var s=[],o=0;o<r.length;o++){var a=new t.math.Vec4(r[o]);a.transform(n),s.push(a)}return s},e.equals=function(r){var n=t.math.EPSILON;return this.x<r.x+n&&this.x>r.x-n&&this.y<r.y+n&&this.y>r.y-n&&this.z<r.z+n&&this.z>r.z-n&&this.w<r.w+n&&this.w>r.w-n},e.assignFrom=function(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w,this},e.toTypeArray=function(){var r=new Float32Array(4);return r[0]=this.x,r[1]=this.y,r[2]=this.z,r[3]=this.w,r}})(exports.cc);(function(t){t.math.Ray2=function(r,n){this.start=r||new t.math.Vec2,this.dir=n||new t.math.Vec2},t.math.Ray2.prototype.fill=function(r,n,s,o){this.start.x=r,this.start.y=n,this.dir.x=s,this.dir.y=o},t.math.Ray2.prototype.intersectLineSegment=function(r,n,s){var o=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,l=this.start.y+this.dir.y,h=r.x,u=r.y,_=n.x,d=n.y,f=(d-u)*(c-o)-(_-h)*(l-a),T,x,m;return f>-t.math.EPSILON&&f<t.math.EPSILON||(T=((_-h)*(a-u)-(d-u)*(o-h))/f,x=o+T*(c-o),m=a+T*(l-a),x<Math.min(r.x,n.x)-t.math.EPSILON||x>Math.max(r.x,n.x)+t.math.EPSILON||m<Math.min(r.y,n.y)-t.math.EPSILON||m>Math.max(r.y,n.y)+t.math.EPSILON)||x<Math.min(o,c)-t.math.EPSILON||x>Math.max(o,c)+t.math.EPSILON||m<Math.min(a,l)-t.math.EPSILON||m>Math.max(a,l)+t.math.EPSILON?!1:(s.x=x,s.y=m,!0)};function e(r,n,s){var o=new t.math.Vec2(n);o.subtract(r),s.x=-o.y,s.y=o.x,s.normalize()}t.math.Ray2.prototype.intersectTriangle=function(r,n,s,o,a){var c=new t.math.Vec2,l=new t.math.Vec2,h=new t.math.Vec2,u=1e4,_=!1,d;return this.intersectLineSegment(r,n,c)&&(_=!0,d=c.subtract(this.start).length(),d<u&&(l.x=c.x,l.y=c.y,u=d,e(r,n,h))),this.intersectLineSegment(n,s,c)&&(_=!0,d=c.subtract(this.start).length(),d<u&&(l.x=c.x,l.y=c.y,u=d,e(n,s,h))),this.intersectLineSegment(s,r,c)&&(_=!0,d=c.subtract(this.start).length(),d<u&&(l.x=c.x,l.y=c.y,u=d,e(s,r,h))),_&&(o.x=l.x,o.y=l.y,a&&(a.x=h.x,a.y=h.y)),_}})(exports.cc);window.Uint16Array=window.Uint16Array||window.Array;window.Float32Array=window.Float32Array||window.Array;(function(t){t.math.Matrix3=function(n){n&&n.mat?this.mat=new Float32Array(n.mat):this.mat=new Float32Array(9)},t.kmMat3=t.math.Matrix3;var e=t.math.Matrix3.prototype;e.fill=function(n){var s=this.mat,o=n.mat;return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=o[7],s[8]=o[8],this},e.adjugate=function(){var n=this.mat,s=n[0],o=n[1],a=n[2],c=n[3],l=n[4],h=n[5],u=n[6],_=n[7],d=n[8];return n[0]=l*d-h*_,n[1]=a*_-o*d,n[2]=o*h-a*l,n[3]=h*u-c*d,n[4]=s*d-a*u,n[5]=a*c-s*h,n[6]=c*_-l*u,n[8]=s*l-o*c,this},e.identity=function(){var n=this.mat;return n[1]=n[2]=n[3]=n[5]=n[6]=n[7]=0,n[0]=n[4]=n[8]=1,this};var r=new t.math.Matrix3;e.inverse=function(n){if(n===0)return this;r.assignFrom(this);var s=1/n;return this.adjugate(),this.multiplyScalar(s),this},e.isIdentity=function(){var n=this.mat;return n[0]===1&&n[1]===0&&n[2]===0&&n[3]===0&&n[4]===1&&n[5]===0&&n[6]===0&&n[7]===0&&n[8]===1},e.transpose=function(){var n=this.mat,s=n[1],o=n[2],a=n[3],c=n[5],l=n[6],h=n[7];return n[1]=a,n[2]=l,n[3]=s,n[5]=h,n[6]=o,n[7]=c,this},e.determinant=function(){var n=this.mat,s=n[0]*n[4]*n[8]+n[1]*n[5]*n[6]+n[2]*n[3]*n[7];return s-=n[2]*n[4]*n[6]+n[0]*n[5]*n[7]+n[1]*n[3]*n[8],s},e.multiply=function(n){var s=this.mat,o=n.mat,a=s[0],c=s[1],l=s[2],h=s[3],u=s[4],_=s[5],d=s[6],f=s[7],T=s[8],x=o[0],m=o[1],v=o[2],A=o[3],D=o[4],N=o[5],z=o[6],M=o[7],J=o[8];return s[0]=a*x+h*m+d*v,s[1]=c*x+u*m+f*v,s[2]=l*x+_*m+T*v,s[3]=l*x+_*m+T*v,s[4]=c*A+u*D+f*N,s[5]=l*A+_*D+T*N,s[6]=a*z+h*M+d*J,s[7]=c*z+u*M+f*J,s[8]=l*z+_*M+T*J,this},e.multiplyScalar=function(n){var s=this.mat;return s[0]*=n,s[1]*=n,s[2]*=n,s[3]*=n,s[4]*=n,s[5]*=n,s[6]*=n,s[7]*=n,s[8]*=n,this},t.math.Matrix3.rotationAxisAngle=function(n,s){var o=Math.cos(s),a=Math.sin(s),c=new t.math.Matrix3,l=c.mat;return l[0]=o+n.x*n.x*(1-o),l[1]=n.z*a+n.y*n.x*(1-o),l[2]=-n.y*a+n.z*n.x*(1-o),l[3]=-n.z*a+n.x*n.y*(1-o),l[4]=o+n.y*n.y*(1-o),l[5]=n.x*a+n.z*n.y*(1-o),l[6]=n.y*a+n.x*n.z*(1-o),l[7]=-n.x*a+n.y*n.z*(1-o),l[8]=o+n.z*n.z*(1-o),c},e.assignFrom=function(n){if(this===n)return t.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var s=this.mat,o=n.mat;return s[0]=o[0],s[1]=o[1],s[2]=o[2],s[3]=o[3],s[4]=o[4],s[5]=o[5],s[6]=o[6],s[7]=o[7],s[8]=o[8],this},e.equals=function(n){if(this===n)return!0;for(var s=t.math.EPSILON,o=this.mat,a=n.mat,c=0;c<9;++c)if(!(o[c]+s>a[c]&&o[c]-s<a[c]))return!1;return!0},t.math.Matrix3.createByRotationX=function(n){var s=new t.math.Matrix3,o=s.mat;return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=Math.cos(n),o[5]=Math.sin(n),o[6]=0,o[7]=-Math.sin(n),o[8]=Math.cos(n),s},t.math.Matrix3.createByRotationY=function(n){var s=new t.math.Matrix3,o=s.mat;return o[0]=Math.cos(n),o[1]=0,o[2]=-Math.sin(n),o[3]=0,o[4]=1,o[5]=0,o[6]=Math.sin(n),o[7]=0,o[8]=Math.cos(n),s},t.math.Matrix3.createByRotationZ=function(n){var s=new t.math.Matrix3,o=s.mat;return o[0]=Math.cos(n),o[1]=-Math.sin(n),o[2]=0,o[3]=Math.sin(n),o[4]=Math.cos(n),o[5]=0,o[6]=0,o[7]=0,o[8]=1,s},t.math.Matrix3.createByRotation=function(n){var s=new t.math.Matrix3,o=s.mat;return o[0]=Math.cos(n),o[1]=Math.sin(n),o[2]=0,o[3]=-Math.sin(n),o[4]=Math.cos(n),o[5]=0,o[6]=0,o[7]=0,o[8]=1,s},t.math.Matrix3.createByScale=function(n,s){var o=new t.math.Matrix3;return o.identity(),o.mat[0]=n,o.mat[4]=s,o},t.math.Matrix3.createByTranslation=function(n,s){var o=new t.math.Matrix3;return o.identity(),o.mat[6]=n,o.mat[7]=s,o},t.math.Matrix3.createByQuaternion=function(n){if(!n)return null;var s=new t.math.Matrix3,o=s.mat;return o[0]=1-2*(n.y*n.y+n.z*n.z),o[1]=2*(n.x*n.y-n.w*n.z),o[2]=2*(n.x*n.z+n.w*n.y),o[3]=2*(n.x*n.y+n.w*n.z),o[4]=1-2*(n.x*n.x+n.z*n.z),o[5]=2*(n.y*n.z-n.w*n.x),o[6]=2*(n.x*n.z-n.w*n.y),o[7]=2*(n.y*n.z+n.w*n.x),o[8]=1-2*(n.x*n.x+n.y*n.y),s},e.rotationToAxisAngle=function(){return t.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}})(exports.cc);(function(t){t.math.Matrix4=function(s){s&&s.mat?this.mat=new Float32Array(s.mat):this.mat=new Float32Array(16)},t.kmMat4=t.math.Matrix4;var e=t.math.Matrix4.prototype;e.fill=function(s){for(var o=this.mat,a=0;a<16;a++)o[a]=s[a];return this},t.kmMat4Identity=function(s){var o=s.mat;return o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[8]=o[9]=o[11]=o[12]=o[13]=o[14]=0,o[0]=o[5]=o[10]=o[15]=1,s},e.identity=function(){var s=this.mat;return s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0,s[0]=s[5]=s[10]=s[15]=1,this},e.get=function(s,o){return this.mat[s+4*o]},e.set=function(s,o,a){this.mat[s+4*o]=a},e.swap=function(s,o,a,c){var l=this.mat,h=l[s+4*o];l[s+4*o]=l[a+4*c],l[a+4*c]=h},t.math.Matrix4._gaussj=function(s,o){var a,c=0,l=0,h,u,_,d,f=4,T=4,x,m,v,A,D=[0,0,0,0],N=[0,0,0,0],z=[0,0,0,0];for(a=0;a<f;a++){for(m=0,h=0;h<f;h++)if(z[h]!==1)for(u=0;u<f;u++)z[u]===0&&(x=Math.abs(s.get(h,u)),x>=m&&(m=x,l=h,c=u));if(++z[c],l!==c){for(_=0;_<f;_++)s.swap(l,_,c,_);for(_=0;_<T;_++)o.swap(l,_,c,_)}if(N[a]=l,D[a]=c,s.get(c,c)===0)return!1;for(A=1/s.get(c,c),s.set(c,c,1),_=0;_<f;_++)s.set(c,_,s.get(c,_)*A);for(_=0;_<T;_++)o.set(c,_,o.get(c,_)*A);for(d=0;d<f;d++)if(d!==c){for(v=s.get(d,c),s.set(d,c,0),_=0;_<f;_++)s.set(d,_,s.get(d,_)-s.get(c,_)*v);for(_=0;_<T;_++)o.set(d,_,s.get(d,_)-o.get(c,_)*v)}}for(_=f-1;_>=0;_--)if(N[_]!==D[_])for(u=0;u<f;u++)s.swap(u,N[_],u,D[_]);return!0};var r=new t.math.Matrix4().identity();t.kmMat4Inverse=function(s,o){var a=new t.math.Matrix4(o),c=new t.math.Matrix4(r);return t.math.Matrix4._gaussj(a,c)===!1?null:(s.assignFrom(a),s)},e.inverse=function(){var s=new t.math.Matrix4(this),o=new t.math.Matrix4(r);return t.math.Matrix4._gaussj(s,o)===!1?null:s},e.isIdentity=function(){var s=this.mat;return s[0]===1&&s[1]===0&&s[2]===0&&s[3]===0&&s[4]===0&&s[5]===1&&s[6]===0&&s[7]===0&&s[8]===0&&s[9]===0&&s[10]===1&&s[11]===0&&s[12]===0&&s[13]===0&&s[14]===0&&s[15]===1},e.transpose=function(){var s=this.mat,o=s[1],a=s[2],c=s[3],l=s[4],h=s[6],u=s[7],_=s[8],d=s[9],f=s[11],T=s[12],x=s[13],m=s[14];return s[1]=l,s[2]=_,s[3]=T,s[4]=o,s[6]=d,s[7]=x,s[8]=a,s[9]=h,s[11]=m,s[12]=c,s[13]=u,s[14]=f,this},t.kmMat4Multiply=function(s,o,a){var c=s.mat,l=o.mat,h=a.mat,u=l[0],_=l[1],d=l[2],f=l[3],T=l[4],x=l[5],m=l[6],v=l[7],A=l[8],D=l[9],N=l[10],z=l[11],M=l[12],J=l[13],U=l[14],K=l[15],tt=h[0],rt=h[1],I=h[2],L=h[3],G=h[4],w=h[5],O=h[6],j=h[7],Q=h[8],C=h[9],b=h[10],W=h[11],S=h[12],E=h[13],R=h[14],F=h[15];return c[0]=tt*u+rt*T+I*A+L*M,c[1]=tt*_+rt*x+I*D+L*J,c[2]=tt*d+rt*m+I*N+L*U,c[3]=tt*f+rt*v+I*z+L*K,c[4]=G*u+w*T+O*A+j*M,c[5]=G*_+w*x+O*D+j*J,c[6]=G*d+w*m+O*N+j*U,c[7]=G*f+w*v+O*z+j*K,c[8]=Q*u+C*T+b*A+W*M,c[9]=Q*_+C*x+b*D+W*J,c[10]=Q*d+C*m+b*N+W*U,c[11]=Q*f+C*v+b*z+W*K,c[12]=S*u+E*T+R*A+F*M,c[13]=S*_+E*x+R*D+F*J,c[14]=S*d+E*m+R*N+F*U,c[15]=S*f+E*v+R*z+F*K,s},e.multiply=function(s){var o=this.mat,a=s.mat,c=o[0],l=o[1],h=o[2],u=o[3],_=o[4],d=o[5],f=o[6],T=o[7],x=o[8],m=o[9],v=o[10],A=o[11],D=o[12],N=o[13],z=o[14],M=o[15],J=a[0],U=a[1],K=a[2],tt=a[3],rt=a[4],I=a[5],L=a[6],G=a[7],w=a[8],O=a[9],j=a[10],Q=a[11],C=a[12],b=a[13],W=a[14],S=a[15];return o[0]=J*c+U*_+K*x+tt*D,o[1]=J*l+U*d+K*m+tt*N,o[2]=J*h+U*f+K*v+tt*z,o[3]=J*u+U*T+K*A+tt*M,o[4]=rt*c+I*_+L*x+G*D,o[5]=rt*l+I*d+L*m+G*N,o[6]=rt*h+I*f+L*v+G*z,o[7]=rt*u+I*T+L*A+G*M,o[8]=w*c+O*_+j*x+Q*D,o[9]=w*l+O*d+j*m+Q*N,o[10]=w*h+O*f+j*v+Q*z,o[11]=w*u+O*T+j*A+Q*M,o[12]=C*c+b*_+W*x+S*D,o[13]=C*l+b*d+W*m+S*N,o[14]=C*h+b*f+W*v+S*z,o[15]=C*u+b*T+W*A+S*M,this},t.getMat4MultiplyValue=function(s,o){var a=s.mat,c=o.mat,l=new Float32Array(16);return l[0]=a[0]*c[0]+a[4]*c[1]+a[8]*c[2]+a[12]*c[3],l[1]=a[1]*c[0]+a[5]*c[1]+a[9]*c[2]+a[13]*c[3],l[2]=a[2]*c[0]+a[6]*c[1]+a[10]*c[2]+a[14]*c[3],l[3]=a[3]*c[0]+a[7]*c[1]+a[11]*c[2]+a[15]*c[3],l[4]=a[0]*c[4]+a[4]*c[5]+a[8]*c[6]+a[12]*c[7],l[5]=a[1]*c[4]+a[5]*c[5]+a[9]*c[6]+a[13]*c[7],l[6]=a[2]*c[4]+a[6]*c[5]+a[10]*c[6]+a[14]*c[7],l[7]=a[3]*c[4]+a[7]*c[5]+a[11]*c[6]+a[15]*c[7],l[8]=a[0]*c[8]+a[4]*c[9]+a[8]*c[10]+a[12]*c[11],l[9]=a[1]*c[8]+a[5]*c[9]+a[9]*c[10]+a[13]*c[11],l[10]=a[2]*c[8]+a[6]*c[9]+a[10]*c[10]+a[14]*c[11],l[11]=a[3]*c[8]+a[7]*c[9]+a[11]*c[10]+a[15]*c[11],l[12]=a[0]*c[12]+a[4]*c[13]+a[8]*c[14]+a[12]*c[15],l[13]=a[1]*c[12]+a[5]*c[13]+a[9]*c[14]+a[13]*c[15],l[14]=a[2]*c[12]+a[6]*c[13]+a[10]*c[14]+a[14]*c[15],l[15]=a[3]*c[12]+a[7]*c[13]+a[11]*c[14]+a[15]*c[15],l},t.kmMat4Assign=function(s,o){if(s===o)return t.log("cc.kmMat4Assign(): pOut equals pIn"),s;var a=s.mat,c=o.mat;return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],s},e.assignFrom=function(s){if(this===s)return t.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var o=this.mat,a=s.mat;return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],this},e.equals=function(s){if(this===s)return t.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;for(var o=this.mat,a=s.mat,c=t.math.EPSILON,l=0;l<16;l++)if(!(o[l]+c>a[l]&&o[l]-c<a[l]))return!1;return!0},t.math.Matrix4.createByRotationX=function(s,o){o=o||new t.math.Matrix4;var a=o.mat;return a[0]=1,a[3]=a[2]=a[1]=0,a[4]=0,a[5]=Math.cos(s),a[6]=Math.sin(s),a[7]=0,a[8]=0,a[9]=-Math.sin(s),a[10]=Math.cos(s),a[11]=0,a[14]=a[13]=a[12]=0,a[15]=1,o},t.math.Matrix4.createByRotationY=function(s,o){o=o||new t.math.Matrix4;var a=o.mat;return a[0]=Math.cos(s),a[1]=0,a[2]=-Math.sin(s),a[3]=0,a[7]=a[6]=a[4]=0,a[5]=1,a[8]=Math.sin(s),a[9]=0,a[10]=Math.cos(s),a[11]=0,a[14]=a[13]=a[12]=0,a[15]=1,o},t.math.Matrix4.createByRotationZ=function(s,o){o=o||new t.math.Matrix4;var a=o.mat;return a[0]=Math.cos(s),a[1]=Math.sin(s),a[3]=a[2]=0,a[4]=-Math.sin(s),a[5]=Math.cos(s),a[7]=a[6]=0,a[11]=a[9]=a[8]=0,a[10]=1,a[14]=a[13]=a[12]=0,a[15]=1,o},t.math.Matrix4.createByPitchYawRoll=function(s,o,a,c){c=c||new t.math.Matrix4;var l=Math.cos(s),h=Math.sin(s),u=Math.cos(o),_=Math.sin(o),d=Math.cos(a),f=Math.sin(a),T=h*_,x=l*_,m=c.mat;return m[0]=u*d,m[4]=u*f,m[8]=-_,m[1]=T*d-l*f,m[5]=T*f+l*d,m[9]=h*u,m[2]=x*d+h*f,m[6]=x*f-h*d,m[10]=l*u,m[3]=m[7]=m[11]=0,m[15]=1,c},t.math.Matrix4.createByQuaternion=function(s,o){o=o||new t.math.Matrix4;var a=o.mat;return a[0]=1-2*(s.y*s.y+s.z*s.z),a[1]=2*(s.x*s.y+s.z*s.w),a[2]=2*(s.x*s.z-s.y*s.w),a[3]=0,a[4]=2*(s.x*s.y-s.z*s.w),a[5]=1-2*(s.x*s.x+s.z*s.z),a[6]=2*(s.z*s.y+s.x*s.w),a[7]=0,a[8]=2*(s.x*s.z+s.y*s.w),a[9]=2*(s.y*s.z-s.x*s.w),a[10]=1-2*(s.x*s.x+s.y*s.y),a[11]=0,a[14]=a[13]=a[12]=0,a[15]=1,o},t.math.Matrix4.createByRotationTranslation=function(s,o,a){a=a||new t.math.Matrix4;var c=a.mat,l=s.mat;return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=0,c[4]=l[3],c[5]=l[4],c[6]=l[5],c[7]=0,c[8]=l[6],c[9]=l[7],c[10]=l[8],c[11]=0,c[12]=o.x,c[13]=o.y,c[14]=o.z,c[15]=1,a},t.math.Matrix4.createByScale=function(s,o,a,c){c=c||new t.math.Matrix4;var l=c.mat;return l[0]=s,l[5]=o,l[10]=a,l[15]=1,l[1]=l[2]=l[3]=l[4]=l[6]=l[7]=l[8]=l[9]=l[11]=l[12]=l[13]=l[14]=0,c},t.kmMat4Translation=function(s,o,a,c){return s.mat[0]=s.mat[5]=s.mat[10]=s.mat[15]=1,s.mat[1]=s.mat[2]=s.mat[3]=s.mat[4]=s.mat[6]=s.mat[7]=s.mat[8]=s.mat[9]=s.mat[11]=0,s.mat[12]=o,s.mat[13]=a,s.mat[14]=c,s},t.math.Matrix4.createByTranslation=function(s,o,a,c){return c=c||new t.math.Matrix4,c.identity(),c.mat[12]=s,c.mat[13]=o,c.mat[14]=a,c},e.getUpVec3=function(){var s=this.mat,o=new t.math.Vec3(s[4],s[5],s[6]);return o.normalize()},e.getRightVec3=function(){var s=this.mat,o=new t.math.Vec3(s[0],s[1],s[2]);return o.normalize()},e.getForwardVec3=function(){var s=this.mat,o=new t.math.Vec3(s[8],s[9],s[10]);return o.normalize()},t.kmMat4PerspectiveProjection=function(s,o,a,c,l){var h=t.degreesToRadians(o/2),u=l-c,_=Math.sin(h);if(u===0||_===0||a===0)return null;var d=Math.cos(h)/_;return s.identity(),s.mat[0]=d/a,s.mat[5]=d,s.mat[10]=-(l+c)/u,s.mat[11]=-1,s.mat[14]=-2*c*l/u,s.mat[15]=0,s},t.math.Matrix4.createPerspectiveProjection=function(s,o,a,c){var l=t.degreesToRadians(s/2),h=c-a,u=Math.sin(l);if(h===0||u===0||o===0)return null;var _=Math.cos(l)/u,d=new t.math.Matrix4,f=d.mat;return d.identity(),f[0]=_/o,f[5]=_,f[10]=-(c+a)/h,f[11]=-1,f[14]=-2*a*c/h,f[15]=0,d},t.kmMat4OrthographicProjection=function(s,o,a,c,l,h,u){return s.identity(),s.mat[0]=2/(a-o),s.mat[5]=2/(l-c),s.mat[10]=-2/(u-h),s.mat[12]=-((a+o)/(a-o)),s.mat[13]=-((l+c)/(l-c)),s.mat[14]=-((u+h)/(u-h)),s},t.math.Matrix4.createOrthographicProjection=function(s,o,a,c,l,h){var u=new t.math.Matrix4,_=u.mat;return u.identity(),_[0]=2/(o-s),_[5]=2/(c-a),_[10]=-2/(h-l),_[12]=-((o+s)/(o-s)),_[13]=-((c+a)/(c-a)),_[14]=-((h+l)/(h-l)),u},t.kmMat4LookAt=function(s,o,a,c){var l=new t.math.Vec3(a),h=new t.math.Vec3(c);l.subtract(o),l.normalize(),h.normalize();var u=new t.math.Vec3(l);u.cross(h),u.normalize();var _=new t.math.Vec3(u);_.cross(l),u.normalize(),s.identity(),s.mat[0]=u.x,s.mat[4]=u.y,s.mat[8]=u.z,s.mat[1]=_.x,s.mat[5]=_.y,s.mat[9]=_.z,s.mat[2]=-l.x,s.mat[6]=-l.y,s.mat[10]=-l.z;var d=t.math.Matrix4.createByTranslation(-o.x,-o.y,-o.z);return s.multiply(d),s};var n=new t.math.Matrix4;e.lookAt=function(s,o,a){var c=new t.math.Vec3(o),l=new t.math.Vec3(a),h=this.mat;c.subtract(s),c.normalize(),l.normalize();var u=new t.math.Vec3(c);u.cross(l),u.normalize();var _=new t.math.Vec3(u);return _.cross(c),u.normalize(),this.identity(),h[0]=u.x,h[4]=u.y,h[8]=u.z,h[1]=_.x,h[5]=_.y,h[9]=_.z,h[2]=-c.x,h[6]=-c.y,h[10]=-c.z,n=t.math.Matrix4.createByTranslation(-s.x,-s.y,-s.z,n),this.multiply(n),this},t.kmMat4RotationAxisAngle=function(s,o,a){var c=Math.cos(a),l=Math.sin(a),h=new t.math.Vec3(o);return h.normalize(),s.mat[0]=c+h.x*h.x*(1-c),s.mat[1]=h.z*l+h.y*h.x*(1-c),s.mat[2]=-h.y*l+h.z*h.x*(1-c),s.mat[3]=0,s.mat[4]=-h.z*l+h.x*h.y*(1-c),s.mat[5]=c+h.y*h.y*(1-c),s.mat[6]=h.x*l+h.z*h.y*(1-c),s.mat[7]=0,s.mat[8]=h.y*l+h.x*h.z*(1-c),s.mat[9]=-h.x*l+h.y*h.z*(1-c),s.mat[10]=c+h.z*h.z*(1-c),s.mat[11]=0,s.mat[12]=0,s.mat[13]=0,s.mat[14]=0,s.mat[15]=1,s},t.math.Matrix4.createByAxisAndAngle=function(s,o,a){a=a||new t.math.Matrix4;var c=this.mat,l=Math.cos(o),h=Math.sin(o),u=new t.math.Vec3(s);return u.normalize(),c[0]=l+u.x*u.x*(1-l),c[1]=u.z*h+u.y*u.x*(1-l),c[2]=-u.y*h+u.z*u.x*(1-l),c[3]=0,c[4]=-u.z*h+u.x*u.y*(1-l),c[5]=l+u.y*u.y*(1-l),c[6]=u.x*h+u.z*u.y*(1-l),c[7]=0,c[8]=u.y*h+u.x*u.z*(1-l),c[9]=-u.x*h+u.y*u.z*(1-l),c[10]=l+u.z*u.z*(1-l),c[11]=0,c[12]=c[13]=c[14]=0,c[15]=1,a},e.extractRotation=function(){var s=new t.math.Matrix3,o=this.mat,a=s.mat;return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],s},e.extractPlane=function(s){var o=new t.math.Plane,a=this.mat;switch(s){case t.math.Plane.RIGHT:o.a=a[3]-a[0],o.b=a[7]-a[4],o.c=a[11]-a[8],o.d=a[15]-a[12];break;case t.math.Plane.LEFT:o.a=a[3]+a[0],o.b=a[7]+a[4],o.c=a[11]+a[8],o.d=a[15]+a[12];break;case t.math.Plane.BOTTOM:o.a=a[3]+a[1],o.b=a[7]+a[5],o.c=a[11]+a[9],o.d=a[15]+a[13];break;case t.math.Plane.TOP:o.a=a[3]-a[1],o.b=a[7]-a[5],o.c=a[11]-a[9],o.d=a[15]-a[13];break;case t.math.Plane.FAR:o.a=a[3]-a[2],o.b=a[7]-a[6],o.c=a[11]-a[10],o.d=a[15]-a[14];break;case t.math.Plane.NEAR:o.a=a[3]+a[2],o.b=a[7]+a[6],o.c=a[11]+a[10],o.d=a[15]+a[14];break;default:t.log("cc.math.Matrix4.extractPlane: Invalid plane index");break}var c=Math.sqrt(o.a*o.a+o.b*o.b+o.c*o.c);return o.a/=c,o.b/=c,o.c/=c,o.d/=c,o},e.toAxisAndAngle=function(){var s=this.extractRotation(),o=t.math.Quaternion.rotationMatrix(s);return o.toAxisAndAngle()}})(exports.cc);(function(t){t.math.Plane=function(r,n,s,o){r&&n===void 0?(this.a=r.a,this.b=r.b,this.c=r.c,this.d=r.d):(this.a=r||0,this.b=n||0,this.c=s||0,this.d=o||0)},t.kmPlane=t.math.Plane;var e=t.math.Plane.prototype;t.math.Plane.LEFT=0,t.math.Plane.RIGHT=1,t.math.Plane.BOTTOM=2,t.math.Plane.TOP=3,t.math.Plane.NEAR=4,t.math.Plane.FAR=5,t.math.Plane.POINT_INFRONT_OF_PLANE=0,t.math.Plane.POINT_BEHIND_PLANE=1,t.math.Plane.POINT_ON_PLANE=2,e.dot=function(r){return this.a*r.x+this.b*r.y+this.c*r.z+this.d*r.w},e.dotCoord=function(r){return this.a*r.x+this.b*r.y+this.c*r.z+this.d},e.dotNormal=function(r){return this.a*r.x+this.b*r.y+this.c*r.z},t.math.Plane.fromPointNormal=function(r,n){return new t.math.Plane(n.x,n.y,n.z,-n.dot(r))},t.math.Plane.fromPoints=function(r,n,s){var o=new t.math.Vec3(n),a=new t.math.Vec3(s),c=new t.math.Plane;return o.subtract(r),a.subtract(r),o.cross(a),o.normalize(),c.a=o.x,c.b=o.y,c.c=o.z,c.d=o.scale(-1).dot(r),c},e.normalize=function(){var r=new t.math.Vec3(this.a,this.b,this.c),n=1/r.length();return r.normalize(),this.a=r.x,this.b=r.y,this.c=r.z,this.d=this.d*n,this},e.classifyPoint=function(r){var n=this.a*r.x+this.b*r.y+this.c*r.z+this.d;return n>.001?t.math.Plane.POINT_INFRONT_OF_PLANE:n<-.001?t.math.Plane.POINT_BEHIND_PLANE:t.math.Plane.POINT_ON_PLANE}})(exports.cc);(function(t){t.math.Quaternion=function(r,n,s,o){r&&n===void 0?(this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w):(this.x=r||0,this.y=n||0,this.z=s||0,this.w=o||0)},t.kmQuaternion=t.math.Quaternion;var e=t.math.Quaternion.prototype;e.conjugate=function(r){return this.x=-r.x,this.y=-r.y,this.z=-r.z,this.w=r.w,this},e.dot=function(r){return this.w*r.w+this.x*r.x+this.y*r.y+this.z*r.z},e.exponential=function(){return this},e.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},e.inverse=function(){var r=this.length();return Math.abs(r)>t.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/r),this)},e.isIdentity=function(){return this.x===0&&this.y===0&&this.z===0&&this.w===1},e.length=function(){return Math.sqrt(this.lengthSq())},e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.multiply=function(r){var n=this.x,s=this.y,o=this.z,a=this.w;return this.w=a*r.w-n*r.x-s*r.y-o*r.z,this.x=a*r.x+n*r.w+s*r.z-o*r.y,this.y=a*r.y+s*r.w+o*r.x-n*r.z,this.z=a*r.z+o*r.w+n*r.y-s*r.x,this},e.normalize=function(){var r=this.length();if(Math.abs(r)<=t.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/r),this},e.rotationAxis=function(r,n){var s=n*.5,o=Math.sin(s);return this.w=Math.cos(s),this.x=r.x*o,this.y=r.y*o,this.z=r.z*o,this},t.math.Quaternion.rotationMatrix=function(r){if(!r)return null;var n,s,o,a,c=[],l=r.mat,h=0;c[0]=l[0],c[1]=l[3],c[2]=l[6],c[4]=l[1],c[5]=l[4],c[6]=l[7],c[8]=l[2],c[9]=l[5],c[10]=l[8],c[15]=1;var u=c[0],_=u[0]+u[5]+u[10]+1;return _>t.math.EPSILON?(h=Math.sqrt(_)*2,n=(u[9]-u[6])/h,s=(u[2]-u[8])/h,o=(u[4]-u[1])/h,a=.25*h):u[0]>u[5]&&u[0]>u[10]?(h=Math.sqrt(1+u[0]-u[5]-u[10])*2,n=.25*h,s=(u[4]+u[1])/h,o=(u[2]+u[8])/h,a=(u[9]-u[6])/h):u[5]>u[10]?(h=Math.sqrt(1+u[5]-u[0]-u[10])*2,n=(u[4]+u[1])/h,s=.25*h,o=(u[9]+u[6])/h,a=(u[2]-u[8])/h):(h=Math.sqrt(1+u[10]-u[0]-u[5])*2,n=(u[2]+u[8])/h,s=(u[9]+u[6])/h,o=.25*h,a=(u[4]-u[1])/h),new t.math.Quaternion(n,s,o,a)},t.math.Quaternion.rotationYawPitchRoll=function(r,n,s){var o,a,c,l,h,u,_,d,f,T,x;o=t.degreesToRadians(n)/2,a=t.degreesToRadians(r)/2,c=t.degreesToRadians(s)/2,l=Math.cos(o),h=Math.cos(a),u=Math.cos(c),_=Math.sin(o),d=Math.sin(a),f=Math.sin(c),T=h*u,x=d*f;var m=new t.math.Quaternion;return m.w=l*T+_*x,m.x=_*T-l*x,m.y=l*d*u+_*h*f,m.z=l*h*f-_*d*u,m.normalize(),m},e.slerp=function(r,n){if(this.x===r.x&&this.y===r.y&&this.z===r.z&&this.w===r.w)return this;var s=this.dot(r),o=Math.acos(s),a=Math.sqrt(1-t.math.square(s)),c=Math.sin(n*o)/a,l=Math.sin((1-n)*o)/a,h=new t.math.Quaternion(r);return this.scale(l),h.scale(c),this.add(h),this},e.toAxisAndAngle=function(){var r,n,s,o=new t.math.Vec3;return r=Math.acos(this.w),n=Math.sqrt(t.math.square(this.x)+t.math.square(this.y)+t.math.square(this.z)),n>-t.math.EPSILON&&n<t.math.EPSILON||n<2*Math.PI+t.math.EPSILON&&n>2*Math.PI-t.math.EPSILON?(s=0,o.x=0,o.y=0,o.z=1):(s=r*2,o.x=this.x/n,o.y=this.y/n,o.z=this.z/n,o.normalize()),{axis:o,angle:s}},e.scale=function(r){return this.x*=r,this.y*=r,this.z*=r,this.w*=r,this},e.assignFrom=function(r){return this.x=r.x,this.y=r.y,this.z=r.z,this.w=r.w,this},e.add=function(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this.w+=r.w,this},t.math.Quaternion.rotationBetweenVec3=function(r,n,s){var o=new t.math.Vec3(r),a=new t.math.Vec3(n);o.normalize(),a.normalize();var c=o.dot(a),l=new t.math.Quaternion;if(c>=1)return l.identity(),l;if(c<1e-6-1)if(Math.abs(s.lengthSq())<t.math.EPSILON)l.rotationAxis(s,Math.PI);else{var h=new t.math.Vec3(1,0,0);h.cross(r),Math.abs(h.lengthSq())<t.math.EPSILON&&(h.fill(0,1,0),h.cross(r)),h.normalize(),l.rotationAxis(h,Math.PI)}else{var u=Math.sqrt((1+c)*2),_=1/u;o.cross(a),l.x=o.x*_,l.y=o.y*_,l.z=o.z*_,l.w=u*.5,l.normalize()}return l},e.multiplyVec3=function(r){var n=this.x,s=this.y,o=this.z,a=new t.math.Vec3(r),c=new t.math.Vec3(n,s,o),l=new t.math.Vec3(n,s,o);return c.cross(r),l.cross(c),c.scale(2*q.w),l.scale(2),a.add(c),a.add(l),a}})(exports.cc);exports.cc.math.AABB=function(t,e){this.min=t||new exports.cc.math.Vec3,this.max=e||new exports.cc.math.Vec3};exports.cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z};exports.cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z};exports.cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)};exports.cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t};(function(t){t.math.Matrix4Stack=function(r,n){this.top=r,this.stack=n||[]},t.km_mat4_stack=t.math.Matrix4Stack;var e=t.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0,this.top=null},t.km_mat4_stack_push=function(r,n){r.stack.push(r.top),r.top=new t.math.Matrix4(n)},t.km_mat4_stack_pop=function(r,n){r.top=r.stack.pop()},t.km_mat4_stack_release=function(r){r.stack=null,r.top=null},e.push=function(r){r=r||this.top,this.stack.push(this.top),this.top=new t.math.Matrix4(r)},e.pop=function(){this.top=this.stack.pop()},e.release=function(){this.stack=null,this.top=null,this._matrixPool=null},e._getFromPool=function(r){var n=this._matrixPool;if(n.length===0)return new t.math.Matrix4(r);var s=n.pop();return s.assignFrom(r),s},e._putInPool=function(r){this._matrixPool.push(r)}})(exports.cc);(function(t){t.KM_GL_MODELVIEW=5888,t.KM_GL_PROJECTION=5889,t.KM_GL_TEXTURE=5890,t.modelview_matrix_stack=new t.math.Matrix4Stack,t.projection_matrix_stack=new t.math.Matrix4Stack,t.texture_matrix_stack=new t.math.Matrix4Stack,t.current_stack=null,t.lazyInitialize=function(){{var n=new t.math.Matrix4;t.modelview_matrix_stack.initialize(),t.projection_matrix_stack.initialize(),t.texture_matrix_stack.initialize(),t.current_stack=t.modelview_matrix_stack,t.initialized=!0,n.identity(),t.modelview_matrix_stack.push(n),t.projection_matrix_stack.push(n),t.texture_matrix_stack.push(n)}},t.lazyInitialize(),t.kmGLFreeAll=function(){t.modelview_matrix_stack.release(),t.modelview_matrix_stack=null,t.projection_matrix_stack.release(),t.projection_matrix_stack=null,t.texture_matrix_stack.release(),t.texture_matrix_stack=null,t.initialized=!1,t.current_stack=null},t.kmGLPushMatrix=function(){t.current_stack.push(t.current_stack.top)},t.kmGLPushMatrixWitMat4=function(n){t.current_stack.stack.push(t.current_stack.top),n.assignFrom(t.current_stack.top),t.current_stack.top=n},t.kmGLPopMatrix=function(){t.current_stack.top=t.current_stack.stack.pop()},t.kmGLMatrixMode=function(n){switch(n){case t.KM_GL_MODELVIEW:t.current_stack=t.modelview_matrix_stack;break;case t.KM_GL_PROJECTION:t.current_stack=t.projection_matrix_stack;break;case t.KM_GL_TEXTURE:t.current_stack=t.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},t.kmGLLoadIdentity=function(){t.current_stack.top.identity()},t.kmGLLoadMatrix=function(n){t.current_stack.top.assignFrom(n)},t.kmGLMultMatrix=function(n){t.current_stack.top.multiply(n)};var e=new t.math.Matrix4;t.kmGLTranslatef=function(n,s,o){var a=t.math.Matrix4.createByTranslation(n,s,o,e);t.current_stack.top.multiply(a)};var r=new t.math.Vec3;t.kmGLRotatef=function(n,s,o,a){r.fill(s,o,a);var c=t.math.Matrix4.createByAxisAndAngle(r,t.degreesToRadians(n),e);t.current_stack.top.multiply(c)},t.kmGLScalef=function(n,s,o){var a=t.math.Matrix4.createByScale(n,s,o,e);t.current_stack.top.multiply(a)},t.kmGLGetMatrix=function(n,s){switch(n){case t.KM_GL_MODELVIEW:s.assignFrom(t.modelview_matrix_stack.top);break;case t.KM_GL_PROJECTION:s.assignFrom(t.projection_matrix_stack.top);break;case t.KM_GL_TEXTURE:s.assignFrom(t.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}})(exports.cc);exports.cc.SHADER_POSITION_UCOLOR_FRAG=`precision lowp float;
varying vec4 v_fragmentColor;
void main()                              
{ 
    gl_FragColor = v_fragmentColor;      
}
`;exports.cc.SHADER_POSITION_UCOLOR_VERT=`attribute vec4 a_position;
uniform    vec4 u_color;
uniform float u_pointSize;
varying lowp vec4 v_fragmentColor; 
void main(void)   
{
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    gl_PointSize = u_pointSize;          
    v_fragmentColor = u_color;           
}`;exports.cc.SHADER_POSITION_COLOR_FRAG=`precision lowp float; 
varying vec4 v_fragmentColor; 
void main() 
{ 
     gl_FragColor = v_fragmentColor; 
} `;exports.cc.SHADER_POSITION_COLOR_VERT=`attribute vec4 a_position;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
void main()
{
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    v_fragmentColor = a_color;             
}`;exports.cc.SHADER_SPRITE_POSITION_COLOR_VERT=`attribute vec4 a_position;
attribute vec4 a_color;
varying lowp vec4 v_fragmentColor;
void main()
{
    gl_Position = CC_PMatrix * a_position;  
    v_fragmentColor = a_color;             
}`;exports.cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG=`// #extension GL_OES_standard_derivatives : enable
varying mediump vec4 v_color;
varying mediump vec2 v_texcoord;
void main()	
{ 
// #if defined GL_OES_standard_derivatives	
// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); 
// #else	
gl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); 
// #endif 
}`;exports.cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT=`attribute mediump vec4 a_position; 
attribute mediump vec2 a_texcoord; 
attribute mediump vec4 a_color;	
varying mediump vec4 v_color; 
varying mediump vec2 v_texcoord;	
void main() 
{ 
     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); 
     v_texcoord = a_texcoord; 
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
}`;exports.cc.SHADER_POSITION_TEXTURE_FRAG=`precision lowp float;   
varying vec2 v_texCoord;  
void main() 
{  
    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   
}`;exports.cc.SHADER_POSITION_TEXTURE_VERT=`attribute vec4 a_position; 
attribute vec2 a_texCoord; 
varying mediump vec2 v_texCoord; 
void main() 
{ 
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    v_texCoord = a_texCoord;               
}`;exports.cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG=`precision lowp float;  
uniform vec4 u_color; 
varying vec2 v_texCoord; 
void main() 
{  
    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    
}`;exports.cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT=`attribute vec4 a_position;
attribute vec2 a_texCoord; 
varying mediump vec2 v_texCoord; 
void main() 
{ 
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    v_texCoord = a_texCoord;                 
}`;exports.cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG=`precision lowp float;  
varying vec4 v_fragmentColor; 
varying vec2 v_texCoord; 
void main() 
{ 
    gl_FragColor = vec4( v_fragmentColor.rgb,         
        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   
    ); 
}`;exports.cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT=`attribute vec4 a_position; 
attribute vec2 a_texCoord; 
attribute vec4 a_color;  
varying lowp vec4 v_fragmentColor; 
varying mediump vec2 v_texCoord; 
void main() 
{ 
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    v_fragmentColor = a_color; 
    v_texCoord = a_texCoord; 
}`;exports.cc.SHADER_POSITION_TEXTURE_COLOR_FRAG=`precision lowp float;
varying vec4 v_fragmentColor; 
varying vec2 v_texCoord; 
void main() 
{ 
    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); 
}`;exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT=`attribute vec4 a_position; 
attribute vec2 a_texCoord; 
attribute vec4 a_color;  
varying lowp vec4 v_fragmentColor; 
varying mediump vec2 v_texCoord; 
void main() 
{ 
    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  
    v_fragmentColor = a_color; 
    v_texCoord = a_texCoord; 
}`;exports.cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT=`attribute vec4 a_position; 
attribute vec2 a_texCoord; 
attribute vec4 a_color;  
varying lowp vec4 v_fragmentColor; 
varying mediump vec2 v_texCoord; 
void main() 
{ 
    gl_Position = CC_PMatrix * a_position;  
    v_fragmentColor = a_color; 
    v_texCoord = a_texCoord; 
}`;exports.cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG=`precision lowp float;   
varying vec4 v_fragmentColor; 
varying vec2 v_texCoord;   
uniform float CC_alpha_value; 
void main() 
{  
    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  
    if ( texColor.a <= CC_alpha_value )          
        discard; 
    gl_FragColor = texColor * v_fragmentColor;  
}`;exports.cc.SHADEREX_SWITCHMASK_FRAG=`precision lowp float; 
varying vec4 v_fragmentColor; 
varying vec2 v_texCoord; 
uniform sampler2D u_texture;  
uniform sampler2D   u_mask;   
void main()  
{  
    vec4 texColor   = texture2D(u_texture, v_texCoord);  
    vec4 maskColor  = texture2D(u_mask, v_texCoord); 
    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        
    gl_FragColor    = v_fragmentColor * finalColor; 
}`;exports.cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:t.initWithVertexShaderByteArray(exports.cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_COLOR_VERT,exports.cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_SPRITE_POSITION_COLOR_VERT,exports.cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_TEXTURE_VERT,exports.cc.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,exports.cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_UCOLOR_VERT,exports.cc.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",exports.cc.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:t.initWithVertexShaderByteArray(exports.cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,exports.cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),t.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR);break;default:exports.cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type");return}t.link(),t.updateUniforms()},loadDefaultShaders:function(){var t=new exports.cc.GLProgram;this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),this._programs[exports.cc.SHADER_POSITION_TEXTURECOLOR]=t,this._programs.ShaderPositionTextureColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),this._programs[exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR]=t,this._programs.ShaderSpritePositionTextureColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[exports.cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderPositionTextureColorAlphaTest=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST]=t,this._programs.ShaderSpritePositionTextureColorAlphaTest=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),this._programs[exports.cc.SHADER_POSITION_COLOR]=t,this._programs.ShaderPositionColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_COLOR),this._programs[exports.cc.SHADER_SPRITE_POSITION_COLOR]=t,this._programs.ShaderSpritePositionColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),this._programs[exports.cc.SHADER_POSITION_TEXTURE]=t,this._programs.ShaderPositionTexture=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),this._programs[exports.cc.SHADER_POSITION_TEXTURE_UCOLOR]=t,this._programs.ShaderPositionTextureUColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),this._programs[exports.cc.SHADER_POSITION_TEXTUREA8COLOR]=t,this._programs.ShaderPositionTextureA8Color=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR),this._programs[exports.cc.SHADER_POSITION_UCOLOR]=t,this._programs.ShaderPositionUColor=t,t=new exports.cc.GLProgram,this._loadDefaultShader(t,this.TYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[exports.cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=t,this._programs.ShaderPositionLengthTextureColor=t},reloadDefaultShaders:function(){var t=this.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),t=this.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),t=this.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),t.reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),t=this.programForKey(exports.cc.SHADER_POSITION_COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),t=this.programForKey(exports.cc.SHADER_POSITION_TEXTURE),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),t=this.programForKey(exports.cc.SHADER_POSITION_TEXTURE_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),t=this.programForKey(exports.cc.SHADER_POSITION_TEXTUREA8COLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),t=this.programForKey(exports.cc.SHADER_POSITION_UCOLOR),t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){return this._programs[t]},getProgram:function(t){return this._programs[t]},addProgram:function(t,e){this._programs[e]=t}};exports.cc.GLProgram=exports.cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t){if(!t)return!1;var e,r=this._hashForUniforms[t];if(!r)r=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=r,e=!0;else{e=!1;for(var n=arguments.length-1,s=0;s<n;++s)arguments[s+1]!==r[s]&&(r[s]=arguments[s+1],e=!0)}return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,r){if(!r||!t)return!1;var n=exports.cc.GLProgram._isHighpSupported()?`precision highp float;
`:`precision mediump float;
`;r=n+`uniform mat4 CC_PMatrix;         
uniform mat4 CC_MVMatrix;        
uniform mat4 CC_MVPMatrix;       
uniform vec4 CC_Time;            
uniform vec4 CC_SinTime;         
uniform vec4 CC_CosTime;         
uniform vec4 CC_Random01;        
uniform sampler2D CC_Texture0;   
//CC INCLUDES END                
`+r,this._glContext.shaderSource(t,r),this._glContext.compileShader(t);var s=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return s||(exports.cc.log(`cocos2d: ERROR: Failed to compile shader:
`+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?exports.cc.log(`cocos2d: 
`+this.vertexShaderLog()):exports.cc.log(`cocos2d: 
`+this.fragmentShaderLog())),s===!0},ctor:function(t,e,r){this._uniforms={},this._hashForUniforms={},this._glContext=r||exports.cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var r=this._glContext;this._programObj=r.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=r.createShader(r.VERTEX_SHADER),this._compileShader(this._vertShader,r.VERTEX_SHADER,t)||exports.cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=r.createShader(r.FRAGMENT_SHADER),this._compileShader(this._fragShader,r.FRAGMENT_SHADER,e)||exports.cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&r.attachShader(this._programObj,this._vertShader),exports.cc.checkGLErrorDebug(),this._fragShader&&r.attachShader(this._programObj,this._fragShader);for(var n in this._hashForUniforms)delete this._hashForUniforms[n];return exports.cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var r=exports.cc.loader.getRes(t);if(!r)throw new Error("Please load the resource firset : "+t);var n=exports.cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(r,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return exports.cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,exports.cc.game.config[exports.cc.game.CONFIG_KEY.debugMode]){var t=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!t)return exports.cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),exports.cc.glDeleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){exports.cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[exports.cc.UNIFORM_PMATRIX_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_PMATRIX_S),this._uniforms[exports.cc.UNIFORM_MVMATRIX_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_MVMATRIX_S),this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_MVPMATRIX_S),this._uniforms[exports.cc.UNIFORM_TIME_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_TIME_S),this._uniforms[exports.cc.UNIFORM_SINTIME_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_SINTIME_S),this._uniforms[exports.cc.UNIFORM_COSTIME_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_COSTIME_S),this._usesTime=this._uniforms[exports.cc.UNIFORM_TIME_S]!=null||this._uniforms[exports.cc.UNIFORM_SINTIME_S]!=null||this._uniforms[exports.cc.UNIFORM_COSTIME_S]!=null,this._uniforms[exports.cc.UNIFORM_RANDOM01_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_RANDOM01_S),this._uniforms[exports.cc.UNIFORM_SAMPLER_S]=this._glContext.getUniformLocation(this._programObj,exports.cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[exports.cc.UNIFORM_SAMPLER_S],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");var e=this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t);return e},getUniformMVPMatrix:function(){return this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S]},getUniformSampler:function(){return this._uniforms[exports.cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(t,e){var r=this._glContext;if(typeof t=="string"){var n=this._updateUniformLocation(t,e);if(n){var s=this.getUniformLocationForName(t);r.uniform1i(s,e)}}else r.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,r){var n=this._glContext;if(typeof t=="string"){var s=this._updateUniformLocation(t,e,r);if(s){var o=this.getUniformLocationForName(t);n.uniform2i(o,e,r)}}else n.uniform2i(t,e,r)},setUniformLocationWith3i:function(t,e,r,n){var s=this._glContext;if(typeof t=="string"){var o=this._updateUniformLocation(t,e,r,n);if(o){var a=this.getUniformLocationForName(t);s.uniform3i(a,e,r,n)}}else s.uniform3i(t,e,r,n)},setUniformLocationWith4i:function(t,e,r,n,s){var o=this._glContext;if(typeof t=="string"){var a=this._updateUniformLocation(t,e,r,n,s);if(a){var c=this.getUniformLocationForName(t);o.uniform4i(c,e,r,n,s)}}else o.uniform4i(t,e,r,n,s)},setUniformLocationWith2iv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(r,e)},setUniformLocationWith3iv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(r,e)},setUniformLocationWith4iv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(r,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var r=this._glContext;if(typeof t=="string"){var n=this._updateUniformLocation(t,e);if(n){var s=this.getUniformLocationForName(t);r.uniform1f(s,e)}}else r.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,r){var n=this._glContext;if(typeof t=="string"){var s=this._updateUniformLocation(t,e,r);if(s){var o=this.getUniformLocationForName(t);n.uniform2f(o,e,r)}}else n.uniform2f(t,e,r)},setUniformLocationWith3f:function(t,e,r,n){var s=this._glContext;if(typeof t=="string"){var o=this._updateUniformLocation(t,e,r,n);if(o){var a=this.getUniformLocationForName(t);s.uniform3f(a,e,r,n)}}else s.uniform3f(t,e,r,n)},setUniformLocationWith4f:function(t,e,r,n,s){var o=this._glContext;if(typeof t=="string"){var a=this._updateUniformLocation(t,e,r,n,s);if(a){var c=this.getUniformLocationForName(t);o.uniform4f(c,e,r,n,s)}}else o.uniform4f(t,e,r,n,s)},setUniformLocationWith2fv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(r,e)},setUniformLocationWith3fv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(r,e)},setUniformLocationWith4fv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(r,e)},setUniformLocationWithMatrix4fv:function(t,e){var r=typeof t=="string"?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(r,!1,e)},setUniformLocationF32:function(){if(!(arguments.length<2))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break}},setUniformsForBuiltins:function(){var t=new exports.cc.math.Matrix4,e=new exports.cc.math.Matrix4,r=new exports.cc.math.Matrix4;if(exports.cc.kmGLGetMatrix(exports.cc.KM_GL_PROJECTION,t),exports.cc.kmGLGetMatrix(exports.cc.KM_GL_MODELVIEW,e),exports.cc.kmMat4Multiply(r,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_PMATRIX_S],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S],r.mat,1),this._usesTime){var n=exports.cc.director,s=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_TIME_S],s/10,s,s*2,s*4),this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_SINTIME_S],s/8,s/4,s/2,Math.sin(s)),this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_COSTIME_S],s/8,s/4,s/2,Math.cos(s))}this._uniforms[exports.cc.UNIFORM_RANDOM01_S]!==-1&&this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(!(!t||!t._renderCmd)){var e=new exports.cc.math.Matrix4,r=new exports.cc.math.Matrix4;if(exports.cc.kmGLGetMatrix(exports.cc.KM_GL_PROJECTION,e),exports.cc.kmMat4Multiply(r,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_PMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVMATRIX_S],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S],r.mat,1),this._usesTime){var n=exports.cc.director,s=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_TIME_S],s/10,s,s*2,s*4),this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_SINTIME_S],s/8,s/4,s/2,Math.sin(s)),this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_COSTIME_S],s/8,s/4,s/2,Math.cos(s))}this._uniforms[exports.cc.UNIFORM_RANDOM01_S]!==-1&&this.setUniformLocationWith4f(this._uniforms[exports.cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S],!1,exports.cc.getMat4MultiplyValue(exports.cc.projection_matrix_stack.top,exports.cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){exports.cc.kmMat4Multiply(t,exports.cc.projection_matrix_stack.top,exports.cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVPMATRIX_S],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVMATRIX_S],!1,exports.cc.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_PMATRIX_S],!1,exports.cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_MVMATRIX_S],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_PMATRIX_S],!1,exports.cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[exports.cc.UNIFORM_PMATRIX_S],!1,exports.cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}});exports.cc.GLProgram.create=function(t,e){return new exports.cc.GLProgram(t,e)};exports.cc.GLProgram._highpSupported=null;exports.cc.GLProgram._isHighpSupported=function(){if(exports.cc.GLProgram._highpSupported==null){var t=exports.cc._renderContext,e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);exports.cc.GLProgram._highpSupported=e.precision!==0}return exports.cc.GLProgram._highpSupported};exports.cc.setProgram=function(t,e){t.shaderProgram=e;var r=t.children;if(r)for(var n=0;n<r.length;n++)exports.cc.setProgram(r[n],e)};exports.cc._currentProjectionMatrix=-1;if(exports.cc.ENABLE_GL_STATE_CACHE){exports.cc.MAX_ACTIVETEXTURE=16,exports.cc._currentShaderProgram=-1,exports.cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],exports.cc._blendingSource=-1,exports.cc._blendingDest=-1,exports.cc._GLServerState=0,exports.cc.TEXTURE_ATLAS_USE_VAO&&(exports.cc._uVAO=0);var _currBuffers={};WebGLRenderingContext.prototype.glBindBuffer=WebGLRenderingContext.prototype.bindBuffer,WebGLRenderingContext.prototype.bindBuffer=function(t,e){return _currBuffers[t]!==e?(this.glBindBuffer(t,e),_currBuffers[t]=e,!1):!0},WebGLRenderingContext.prototype.glEnableVertexAttribArray=WebGLRenderingContext.prototype.enableVertexAttribArray,WebGLRenderingContext.prototype.enableVertexAttribArray=function(t){t===exports.cc.VERTEX_ATTRIB_FLAG_POSITION?this._vertexAttribPosition||(this.glEnableVertexAttribArray(t),this._vertexAttribPosition=!0):t===exports.cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor||(this.glEnableVertexAttribArray(t),this._vertexAttribColor=!0):t===exports.cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords||(this.glEnableVertexAttribArray(t),this._vertexAttribTexCoords=!0):this.glEnableVertexAttribArray(t)},WebGLRenderingContext.prototype.glDisableVertexAttribArray=WebGLRenderingContext.prototype.disableVertexAttribArray,WebGLRenderingContext.prototype.disableVertexAttribArray=function(t){t===exports.cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor&&(this.glDisableVertexAttribArray(t),this._vertexAttribColor=!1):t===exports.cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords&&(this.glDisableVertexAttribArray(t),this._vertexAttribTexCoords=!1):t!==0&&this.glDisableVertexAttribArray(t)}}exports.cc.glInvalidateStateCache=function(){if(exports.cc.kmGLFreeAll(),exports.cc._currentProjectionMatrix=-1,exports.cc.ENABLE_GL_STATE_CACHE){exports.cc._currentShaderProgram=-1;for(var t=0;t<exports.cc.MAX_ACTIVETEXTURE;t++)exports.cc._currentBoundTexture[t]=-1;exports.cc._blendingSource=-1,exports.cc._blendingDest=-1,exports.cc._GLServerState=0}};exports.cc.glUseProgram=exports.cc.ENABLE_GL_STATE_CACHE?function(t){t!==exports.cc._currentShaderProgram&&(exports.cc._currentShaderProgram=t,exports.cc._renderContext.useProgram(t))}:function(t){exports.cc._renderContext.useProgram(t)};exports.cc.glDeleteProgram=function(t){exports.cc.ENABLE_GL_STATE_CACHE&&t===exports.cc._currentShaderProgram&&(exports.cc._currentShaderProgram=-1),gl.deleteProgram(t)};exports.cc.setBlending=function(t,e){var r=exports.cc._renderContext;t===r.ONE&&e===r.ZERO?r.disable(r.BLEND):(r.enable(r.BLEND),exports.cc._renderContext.blendFunc(t,e))};exports.cc.glBlendFunc=exports.cc.ENABLE_GL_STATE_CACHE?function(t,e){(t!==exports.cc._blendingSource||e!==exports.cc._blendingDest)&&(exports.cc._blendingSource=t,exports.cc._blendingDest=e,exports.cc.setBlending(t,e))}:exports.cc.setBlending;exports.cc.glBlendFuncForParticle=function(t,e){if(t!==exports.cc._blendingSource||e!==exports.cc._blendingDest){exports.cc._blendingSource=t,exports.cc._blendingDest=e;var r=exports.cc._renderContext;t===r.ONE&&e===r.ZERO?r.disable(r.BLEND):(r.enable(r.BLEND),r.blendFuncSeparate(r.SRC_ALPHA,e,t,e))}};exports.cc.glBlendResetToCache=function(){var t=exports.cc._renderContext;t.blendEquation(t.FUNC_ADD),exports.cc.ENABLE_GL_STATE_CACHE?exports.cc.setBlending(exports.cc._blendingSource,exports.cc._blendingDest):exports.cc.setBlending(t.BLEND_SRC,t.BLEND_DST)};exports.cc.setProjectionMatrixDirty=function(){exports.cc._currentProjectionMatrix=-1};exports.cc.glBindTexture2D=function(t){exports.cc.glBindTexture2DN(0,t)};exports.cc.glBindTexture2DN=exports.cc.ENABLE_GL_STATE_CACHE?function(t,e){if(exports.cc._currentBoundTexture[t]!==e){exports.cc._currentBoundTexture[t]=e;var r=exports.cc._renderContext;r.activeTexture(r.TEXTURE0+t),e?r.bindTexture(r.TEXTURE_2D,e._webTextureObj):r.bindTexture(r.TEXTURE_2D,null)}}:function(t,e){var r=exports.cc._renderContext;r.activeTexture(r.TEXTURE0+t),e?r.bindTexture(r.TEXTURE_2D,e._webTextureObj):r.bindTexture(r.TEXTURE_2D,null)};exports.cc.glDeleteTexture=function(t){exports.cc.glDeleteTextureN(0,t)};exports.cc.glDeleteTextureN=function(t,e){exports.cc.ENABLE_GL_STATE_CACHE&&e===exports.cc._currentBoundTexture[t]&&(exports.cc._currentBoundTexture[t]=-1),exports.cc._renderContext.deleteTexture(e._webTextureObj)};exports.cc.glBindVAO=function(t){exports.cc.TEXTURE_ATLAS_USE_VAO&&exports.cc.ENABLE_GL_STATE_CACHE&&exports.cc._uVAO!==t&&(exports.cc._uVAO=t)};exports.cc.glEnable=function(t){exports.cc.ENABLE_GL_STATE_CACHE};exports.cc.IMAGE_FORMAT_JPEG=0;exports.cc.IMAGE_FORMAT_PNG=1;exports.cc.IMAGE_FORMAT_RAWDATA=9;exports.cc.NextPOT=function(t){return t=t-1,t=t|t>>1,t=t|t>>2,t=t|t>>4,t=t|t>>8,t=t|t>>16,t+1};exports.cc.RenderTexture=exports.cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,r,n){exports.cc.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=exports.cc.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new exports.cc.Color(0,0,0,255),t!==void 0&&e!==void 0&&(r=r||exports.cc.Texture2D.PIXEL_FORMAT_RGBA8888,n=n||0,this.initWithWidthAndHeight(t,e,r,n)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.RenderTexture.CanvasRenderCmd(this):new exports.cc.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){exports.cc.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,r){this._renderCmd.setVirtualViewport(t,e,r)},initWithWidthAndHeight:function(t,e,r,n){return this._renderCmd.initWithWidthAndHeight(t,e,r,n)},begin:function(){exports.cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,r,n,s,o){var a=exports.cc._renderContext;s=s||a.COLOR_BUFFER_BIT,o=o||a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,r,n,s,o,a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,r,n,s,o,a){this.begin(),this._renderCmd._beginWithClear(t,e,r,n,s,o,a)},end:function(){this._renderCmd.end()},clear:function(t,e,r,n){this.beginWithClear(t,e,r,n),this.end()},clearRect:function(t,e,r,n){this._renderCmd.clearRect(t,e,r,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){exports.cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return exports.cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var _p=exports.cc.RenderTexture.prototype;_p.clearColorVal;exports.cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor);exports.cc.RenderTexture.create=function(t,e,r,n){return new exports.cc.RenderTexture(t,e,r,n)};(function(){exports.cc.RenderTexture.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new exports.cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var t=exports.cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.RenderTexture.CanvasRenderCmd,t.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},t.clearStencil=function(e){},t.setVirtualViewport=function(e,r,n){},t.updateClearColor=function(e){this._clearColorStr="rgba("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+","+e.a/255+")"},t.initWithWidthAndHeight=function(e,r,n,s){var o=this._node,a=this._cacheCanvas,c=exports.cc.contentScaleFactor();a.width=0|e*c,a.height=0|r*c;var l=new exports.cc.Texture2D;l.initWithElement(a),l.handleLoadedTexture();var h=o.sprite=new exports.cc.Sprite(l);return h.setBlendFunc(exports.cc.ONE,exports.cc.ONE_MINUS_SRC_ALPHA),o.autoDraw=!1,o.addChild(h),!0},t.begin=function(){},t._beginWithClear=function(e,r,n,s,o,a,c){e=e||0,r=r||0,n=n||0,s=isNaN(s)?255:s;var l=this._cacheContext.getContext(),h=this._cacheCanvas;l.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|e)+","+(0|r)+","+(0|n)+","+s/255+")"),l.clearRect(0,0,h.width,h.height),l.fillRect(0,0,h.width,h.height)},t.end=function(){var e=this._node,r=exports.cc.contentScaleFactor();exports.cc.renderer._renderingToCacheCanvas(this._cacheContext,e.__instanceId,r,r);var n=e.sprite._renderCmd;n._notifyRegionStatus&&n._notifyRegionStatus(exports.cc.Node.CanvasRenderCmd.RegionStatus.Dirty)},t.clearRect=function(e,r,n,s){this._cacheContext.clearRect(e,r,n,-s)},t.clearDepth=function(e){exports.cc.log("clearDepth isn't supported on Cocos2d-Html5")},t.visit=function(e){var r=this._node;this._syncStatus(e),r.sprite.visit(this),this._dirtyFlag=0}})();(function(){exports.cc.RenderTexture.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new exports.cc.Rect,this._fullRect=new exports.cc.Rect,this._fullViewport=new exports.cc.Rect};var t=exports.cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(e,r,n){this._rtTextureRect.x=e.x,this._rtTextureRect.y=e.y,this._fullRect=r,this._fullViewport=n},t.needDraw=function(){return this._needDraw&&this._node.autoDraw},t.rendering=function(e){var r=e||exports.cc._renderContext,n=this._node;if(n.autoDraw){n.begin();var s=n.clearFlags;if(s){var o=[0,0,0,0],a=0,c=0;s&r.COLOR_BUFFER_BIT&&(o=r.getParameter(r.COLOR_CLEAR_VALUE),r.clearColor(n._clearColor.r/255,n._clearColor.g/255,n._clearColor.b/255,n._clearColor.a/255)),s&r.DEPTH_BUFFER_BIT&&(a=r.getParameter(r.DEPTH_CLEAR_VALUE),r.clearDepth(n.clearDepthVal)),s&r.STENCIL_BUFFER_BIT&&(c=r.getParameter(r.STENCIL_CLEAR_VALUE),r.clearStencil(n.clearStencilVal)),r.clear(s),s&r.COLOR_BUFFER_BIT&&r.clearColor(o[0],o[1],o[2],o[3]),s&r.DEPTH_BUFFER_BIT&&r.clearDepth(a),s&r.STENCIL_BUFFER_BIT&&r.clearStencil(c)}n.sortAllChildren();for(var l=n._children,h=0;h<l.length;h++){var u=l[h];u!==n.sprite&&u._renderCmd.visit(n.sprite._renderCmd)}n.end()}},t.clearStencil=function(e){var r=exports.cc._renderContext,n=r.getParameter(r.STENCIL_CLEAR_VALUE);r.clearStencil(e),r.clear(r.STENCIL_BUFFER_BIT),r.clearStencil(n)},t.cleanup=function(){this._node,this._textureCopy=null;var e=exports.cc._renderContext;e.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&e.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(e){},t.initWithWidthAndHeight=function(e,r,n,s){var o=this._node;n===exports.cc.Texture2D.PIXEL_FORMAT_A8&&exports.cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var a=exports.cc._renderContext,c=exports.cc.contentScaleFactor();this._fullRect=new exports.cc.Rect(0,0,e,r),this._fullViewport=new exports.cc.Rect(0,0,e,r),e=0|e*c,r=0|r*c,this._oldFBO=a.getParameter(a.FRAMEBUFFER_BINDING);var l,h;exports.cc.configuration.supportsNPOT()?(l=e,h=r):(l=exports.cc.NextPOT(e),h=exports.cc.NextPOT(r));for(var u=l*h*4,_=new Uint8Array(u),d=0;d<l*h*4;d++)_[d]=0;this._pixelFormat=n;var f=o._texture=new exports.cc.Texture2D;if(!o._texture)return!1;f.initWithData(_,o._pixelFormat,l,h,exports.cc.size(e,r));var T=a.getParameter(a.RENDERBUFFER_BINDING);if(exports.cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new exports.cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(_,o._pixelFormat,l,h,exports.cc.size(e,r))}this._fBO=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this._fBO),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,f._webTextureObj,0),s!==0&&(this._depthRenderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this._depthRenderBuffer),a.renderbufferStorage(a.RENDERBUFFER,s,l,h),s===a.DEPTH_STENCIL?a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer):s===a.STENCIL_INDEX||s===a.STENCIL_INDEX8?a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer):s===a.DEPTH_COMPONENT16&&a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer)),a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&exports.cc.log("Could not attach texture to the framebuffer"),f.setAliasTexParameters();var x=o.sprite=new exports.cc.Sprite(f);return x.scaleY=-1,x.setBlendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindRenderbuffer(a.RENDERBUFFER,T),a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO),o.autoDraw=!1,o.addChild(x),!0},t.begin=function(){var e=this._node;exports.cc.kmGLMatrixMode(exports.cc.KM_GL_PROJECTION),exports.cc.kmGLPushMatrix(),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.kmGLPushMatrix();var r=exports.cc._renderContext,n=exports.cc.director;n.setProjection(n.getProjection());var s=e._texture.getContentSizeInPixels(),o=exports.cc.director.getWinSizeInPixels(),a=o.width/s.width,c=o.height/s.height,l=exports.cc.math.Matrix4.createOrthographicProjection(-1/a,1/a,-1/c,1/c,-1,1);exports.cc.kmGLMultMatrix(l);var h=new exports.cc.Rect(0,0,0,0);h.width=this._fullViewport.width,h.height=this._fullViewport.height;var u=h.width/this._fullRect.width,_=h.height/this._fullRect.height;h.x=(this._fullRect.x-this._rtTextureRect.x)*u,h.y=(this._fullRect.y-this._rtTextureRect.y)*_,r.viewport(h.x,h.y,h.width,h.height),this._oldFBO=r.getParameter(r.FRAMEBUFFER_BINDING),r.bindFramebuffer(r.FRAMEBUFFER,this._fBO),exports.cc.configuration.checkForGLExtension("GL_QCOM")&&(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this._textureCopy._webTextureObj,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e._texture._webTextureObj,0))},t._beginWithClear=function(e,r,n,s,o,a,c){e=e/255,r=r/255,n=n/255,s=s/255;var l=exports.cc._renderContext,h=[0,0,0,0],u=0,_=0;c&l.COLOR_BUFFER_BIT&&(h=l.getParameter(l.COLOR_CLEAR_VALUE),l.clearColor(e,r,n,s)),c&l.DEPTH_BUFFER_BIT&&(u=l.getParameter(l.DEPTH_CLEAR_VALUE),l.clearDepth(o)),c&l.STENCIL_BUFFER_BIT&&(_=l.getParameter(l.STENCIL_CLEAR_VALUE),l.clearStencil(a)),l.clear(c),c&l.COLOR_BUFFER_BIT&&l.clearColor(h[0],h[1],h[2],h[3]),c&l.DEPTH_BUFFER_BIT&&l.clearDepth(u),c&l.STENCIL_BUFFER_BIT&&l.clearStencil(_)},t.end=function(){var e=this._node;exports.cc.renderer._renderingToBuffer(e.__instanceId);var r=exports.cc._renderContext,n=exports.cc.director;r.bindFramebuffer(r.FRAMEBUFFER,this._oldFBO),n.setViewport(),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_PROJECTION),exports.cc.kmGLPopMatrix(),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.kmGLPopMatrix()},t.clearRect=function(e,r,n,s){},t.clearDepth=function(e){var r=this._node;r.begin();var n=exports.cc._renderContext,s=n.getParameter(n.DEPTH_CLEAR_VALUE);n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT),n.clearDepth(s),r.end()},t.visit=function(e){var r=this._node;r._visible&&(exports.cc.kmGLPushMatrix(),this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this),r.sprite.visit(this),this._dirtyFlag=0,exports.cc.kmGLPopMatrix())}})();exports.cc.SpriteBatchNode=exports.cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){exports.cc.Node.prototype.ctor.call(this),this._blendFunc=new exports.cc.BlendFunc(exports.cc.BLEND_SRC,exports.cc.BLEND_DST);var e;exports.cc.isString(t)?(e=exports.cc.textureCache.getTextureForKey(t),e||(e=exports.cc.textureCache.addImage(t))):t instanceof exports.cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(t,e,r){return this.addChild(t,e,r),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,e){var r=exports.cc.textureCache.getTextureForKey(t);return r||(r=exports.cc.textureCache.addImage(t)),this.initWithTexture(r,e)},init:function(t,e){var r=exports.cc.textureCache.getTextureForKey(t);return r||(r=exports.cc.textureCache.addImage(t)),this.initWithTexture(r,e)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return!e||e.length===0?t.zIndex:this.highestAtlasIndexInChild(e[e.length-1])},lowestAtlasIndexInChild:function(t){var e=t.children;return!e||e.length===0?t.zIndex:this.lowestAtlasIndexInChild(e[e.length-1])},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){e===void 0?this._blendFunc=t:this._blendFunc={src:t,dst:e}},getBlendFunc:function(){return new exports.cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){if(exports.cc.assert(t,exports.cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),!(t instanceof exports.cc.Sprite)){exports.cc.log(exports.cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite);return}t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren(),this._children[this._children.length-1]._localZOrder,this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t._textureLoaded){var e=this._children,r,n=e.length;for(r=0;r<n;++r)e[r].setTexture(t)}else t.addEventListener("load",function(){var s=this._children,o,a=s.length;for(o=0;o<a;++o)s[o].setTexture(t)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e=this._children,r,n=e.length;for(r=0;r<n;++r)e[r].setShaderProgram(t)},addChild:function(t,e,r){exports.cc.assert(t!==void 0,exports.cc._LogInfos.CCSpriteBatchNode_addChild_3),this._isValidChild(t)&&(e=e===void 0?t.zIndex:e,r=r===void 0?t.tag:r,exports.cc.Node.prototype.addChild.call(this,t,e,r),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof exports.cc.Sprite?t.texture!==this._texture?(exports.cc.log(exports.cc._LogInfos.Sprite_addChild_5),!1):!0:(exports.cc.log(exports.cc._LogInfos.Sprite_addChild_4),!1)}});var _p=exports.cc.SpriteBatchNode.prototype;exports.cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);exports.cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram);exports.cc.SpriteBatchNode.create=function(t){return new exports.cc.SpriteBatchNode(t)};exports.cc.SpriteBatchNode.createWithTexture=exports.cc.SpriteBatchNode.create;exports.cc.LabelAtlas=exports.cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_className:"LabelAtlas",ctor:function(t,e,r,n,s){exports.cc.AtlasNode.prototype.ctor.call(this),this._renderCmd.setCascade(),e&&exports.cc.LabelAtlas.prototype.initWithString.call(this,t,e,r,n,s)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new exports.cc.LabelAtlas.WebGLRenderCmd(this):new exports.cc.LabelAtlas.CanvasRenderCmd(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},initWithString:function(t,e,r,n,s){var o=t+"",a,c,l,h;if(r===void 0){var u=exports.cc.loader.getRes(e);if(parseInt(u.version,10)!==1)return exports.cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;a=exports.cc.path.changeBasename(e,u.textureFilename);var _=exports.cc.contentScaleFactor();c=parseInt(u.itemWidth,10)/_,l=parseInt(u.itemHeight,10)/_,h=String.fromCharCode(parseInt(u.firstChar,10))}else a=e,c=r||0,l=n||0,h=s||" ";var d=null;a instanceof exports.cc.Texture2D?d=a:d=exports.cc.textureCache.addImage(a);var f=d.isLoaded();return this._textureLoaded=f,f||(this._string=o,d.addEventListener("load",function(T){this.initWithTexture(d,c,l,o.length),this.string=this._string,this.setColor(this._renderCmd._displayedColor),this.dispatchEvent("load")},this)),this.initWithTexture(d,c,l,o.length)?(this._mapStartChar=h,this.string=o,!0):!1},setColor:function(t){exports.cc.AtlasNode.prototype.setColor.call(this,t),this._renderCmd.updateAtlasValues()},getString:function(){return this._string},addChild:function(t,e,r){this._renderCmd._addChild(t),exports.cc.Node.prototype.addChild.call(this,t,e,r)},updateAtlasValues:function(){this._renderCmd.updateAtlasValues()},setString:function(t){t=String(t);var e=t.length;this._string=t,this.setContentSize(e*this._itemWidth,this._itemHeight),this._renderCmd.setString(t),this._renderCmd.updateAtlasValues(),this.quadsToDraw=e}});(function(){var t=exports.cc.LabelAtlas.prototype;exports.cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),exports.cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.string,exports.cc.defineGetterSetter(t,"string",t.getString,t.setString)})();exports.cc.LabelAtlas.create=function(t,e,r,n,s){return new exports.cc.LabelAtlas(t,e,r,n,s)};(function(){exports.cc.LabelAtlas.CanvasRenderCmd=function(e){exports.cc.AtlasNode.CanvasRenderCmd.call(this,e),this._needDraw=!1};var t=exports.cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(exports.cc.AtlasNode.CanvasRenderCmd.prototype);t.constructor=exports.cc.LabelAtlas.CanvasRenderCmd,t.setCascade=function(){var e=this._node;e._cascadeOpacityEnabled=!0,e._cascadeColorEnabled=!1},t.updateAtlasValues=function(){for(var e=this._node,r=e._string||"",n=r.length,s=this._textureToRender,o=e._itemWidth,a=e._itemHeight,c=0,l=-1;c<n;c++){var h=r.charCodeAt(c)-e._mapStartChar.charCodeAt(0),u=parseInt(h%e._itemsPerRow,10),_=parseInt(h/e._itemsPerRow,10);if(!(u<0||_<0)){var d=exports.cc.rect(u*o,_*a,o,a),f=s._contentSize;if(!(d.x<0||d.y<0||d.x+d.width>f.width||d.y+d.height>f.height)){l++;var T=r.charCodeAt(c),x=e.getChildByTag(c);x?T===32?(x.init(),x.setTextureRect(exports.cc.rect(0,0,10,10),!1,exports.cc.size(0,0))):(x.initWithTexture(s,d),x.visible=!0):(x=new exports.cc.Sprite,T===32?(x.init(),x.setTextureRect(exports.cc.rect(0,0,10,10),!1,exports.cc.size(0,0))):x.initWithTexture(s,d),exports.cc.Node.prototype.addChild.call(e,x,0,c)),x.setPosition(l*o+o/2,a/2)}}}this.updateContentSize(c,l+1)},t.updateContentSize=function(e,r){var n=this._node,s=n._contentSize;e!==r&&e*n._itemWidth===s.width&&n._itemHeight===s.height&&n.setContentSize(r*n._itemWidth,n._itemHeight)},t.setString=function(e){var r=this._node;if(r._children)for(var n=r._children,s=n.length,o=0;o<s;o++){var a=n[o];a&&!a._lateChild&&(a.visible=!1)}},t._addChild=function(){child._lateChild=!0}})();exports.cc.LabelBMFont=exports.cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:exports.cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new exports.cc.LabelBMFont.WebGLRenderCmd(this):new exports.cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(t,e){e?this._initialString=t:this._string=t;var r=this._children;if(r)for(var n=0;n<r.length;n++){var s=r[n];s&&s.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),e&&this.updateLabel())},ctor:function(t,e,r,n,s){exports.cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=exports.cc.p(0,0),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this.initWithString(t,e,r,n,s)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t;var e=this._children;if(e)for(var r=0;r<e.length;r++){var n=e[r];n&&(n.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,r,n,s){var o=this,a=t||"";o._config&&exports.cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");var c;if(e){var l=exports.cc.loader.getRes(e);if(!l)return exports.cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;o._config=l,o._fntFile=e,c=exports.cc.textureCache.addImage(l.atlasName);var h=c.isLoaded();o._textureLoaded=h,h||c.addEventListener("load",function(_){var d=this||window;d._textureLoaded=!0,d.initWithTexture(_,d._initialString.length),d.setString(d._initialString,!0),d.dispatchEvent("load")},o)}else{c=new exports.cc.Texture2D;var u=new Image;c.initWithElement(u),o._textureLoaded=!1}return o.initWithTexture(c,a.length)?(o._alignment=n||exports.cc.TEXT_ALIGNMENT_LEFT,o._imageOffset=s||exports.cc.p(0,0),o._width=r===void 0?-1:r,o._realOpacity=255,o._realColor=exports.cc.color(255,255,255,255),o._contentSize.width=0,o._contentSize.height=0,o.setAnchorPoint(.5,.5),o.setString(a,!0),!0):!1},createFontChars:function(){var t=this||window,e=this._renderCmd,r=e._texture||this._texture,n=0,s=exports.cc.size(0,0),o=0,a=1,c=t._string,l=c?c.length:0;if(l!==0){var h,u=t._config,_=u.kerningDict,d=u.commonHeight,f=u.fontDefDictionary;for(h=0;h<l-1;h++)c.charCodeAt(h)===10&&a++;var T=d*a,x=-(d-d*a),m=-1,v;for(h=0;h<l;h++){var A=c.charCodeAt(h);if(A!==0){if(A===10){n=0,x-=u.commonHeight;continue}var D=_[m<<16|A&65535]||0;v=f[A],v||(exports.cc.log("cocos2d: LabelBMFont: character not found "+c[h]),v={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var N=exports.cc.rect(v.rect.x,v.rect.y,v.rect.width,v.rect.height);N=exports.cc.rectPixelsToPoints(N),N.x+=t._imageOffset.x,N.y+=t._imageOffset.y;var z=t.getChildByTag(h);z?e._updateCharTexture(z,N,A):(z=new exports.cc.Sprite,z.initWithTexture(r,N,!1),z._newTextureWhenChangeColor=!0,this.addChild(z,0,h)),z.opacityModifyRGB=this._opacityModifyRGB,e._updateCharColorAndOpacity(z);var M=u.commonHeight-v.yOffset,J=exports.cc.p(n+v.xOffset+v.rect.width*.5+D,x+M-N.height*.5*exports.cc.contentScaleFactor());z.setPosition(exports.cc.pointPixelsToPoints(J)),n+=v.xAdvance+D,m=A,o<n&&(o=n)}}v&&v.xAdvance<v.rect.width?s.width=o-v.xAdvance+v.rect.width:s.width=o,s.height=T,t.setContentSize(exports.cc.sizePixelsToPoints(s))}},updateString:function(t){var e=this||window,r=e._children;if(r)for(var n=0,s=r.length;n<s;n++){var o=r[n];o&&(o.visible=!1)}e._config&&e.createFontChars(),t||e.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){t=String(t),e==null&&(e=!0),(t==null||!exports.cc.isString(t))&&(t=t+""),this._initialString=t,this._setString(t,e)},_setStringForSetter:function(t){this.setString(t,!1)},setCString:function(t){this.setString(t,!0)},_getCharsWidth:function(t,e){if(e<=0)return 0;var r=this.getChildByTag(t),n=this.getChildByTag(t+e);return this._getLetterPosXLeft(n)-this._getLetterPosXLeft(r)},_checkWarp:function(t,e,r,n){for(var s=this||window,o=t[e],a=0,c=0;c<e;c++)a+=t[c].length;a=a+e-n;var l=s._getCharsWidth(a,t[e].length-1);if(l>r&&o.length>1){for(var h=o.length*(r/l)|0,u=o.substr(h),_=l-this._getCharsWidth(a+h,u.length-1),d,f=0,T=0;_>r&&T++<100;)h*=r/_,h=h|0,u=o.substr(h),_=l-this._getCharsWidth(a+h,u.length-1);for(T=0;_<r&&T++<100;){if(u){var x=exports.cc.LabelTTF._wordRex.exec(u);f=x?x[0].length:1,d=u}s._lineBreakWithoutSpaces&&(f=0),h=h+f,u=o.substr(h),_=l-this._getCharsWidth(a+h,u.length-1)}h-=f,h===0&&(h=1,d=d.substr(1));var m=o.substr(0,h),v;exports.cc.LabelTTF.wrapInspection&&exports.cc.LabelTTF._symbolRex.test(d||u)&&(v=exports.cc.LabelTTF._lastWordRex.exec(m),f=v?v[0].length:0,s._lineBreakWithoutSpaces&&(f=0),h-=f,d=o.substr(h),m=o.substr(0,h)),exports.cc.LabelTTF._firsrEnglish.test(d)&&(v=exports.cc.LabelTTF._lastEnglish.exec(m),v&&m!==v[0]&&(f=v[0].length,s._lineBreakWithoutSpaces&&(f=0),h-=f,d=o.substr(h),m=o.substr(0,h))),t[e]=d||u,t.splice(e,0,m)}},updateLabel:function(){var t=this||window;t.string=t._initialString;var e,r,n;if(t._width>0){var s=t.string.split(`
`),o="",a=0,c=0;for(e=0;e<s.length;e++)c=s.length,this._checkWarp(s,e,t._width*this._scaleX,a),c<s.length&&a++,e>0&&(o+=`
`),o+=s[e];o=o+String.fromCharCode(0),t._setString(o,!1)}if(t._alignment!==exports.cc.TEXT_ALIGNMENT_LEFT){e=0;for(var l=0,h=t._string.length,u=[],_=0;_<h;_++){if(t._string[_].charCodeAt(0)===10||t._string[_].charCodeAt(0)===0){var d=0,f=u.length;if(f===0){l++;continue}var T=e+f-1+l;if(T<0)continue;var x=t.getChildByTag(T);if(x==null)continue;d=x.getPositionX()+x._getWidth()/2;var m=0;switch(t._alignment){case exports.cc.TEXT_ALIGNMENT_CENTER:m=t.width/2-d/2;break;case exports.cc.TEXT_ALIGNMENT_RIGHT:m=t.width-d;break}if(m!==0)for(r=0;r<f;r++)T=e+r+l,!(T<0)&&(n=t.getChildByTag(T),n&&(n.x+=m));e+=f,l++,u.length=0;continue}u.push(t._string[e])}}},setAlignment:function(t){this._alignment=t,this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t,this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t,this.updateLabel()},setScale:function(t,e){exports.cc.Node.prototype.setScale.call(this,t,e),this.updateLabel()},setScaleX:function(t){exports.cc.Node.prototype.setScaleX.call(this,t),this.updateLabel()},setScaleY:function(t){exports.cc.Node.prototype.setScaleY.call(this,t),this.updateLabel()},setFntFile:function(t){var e=this||window;if(t!=null&&t!==e._fntFile){var r=exports.cc.loader.getRes(t);if(!r){exports.cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file");return}e._fntFile=t,e._config=r;var n=exports.cc.textureCache.addImage(r.atlasName),s=n.isLoaded();e._textureLoaded=s,s?(e.setTexture(n),e.createFontChars()):n.addEventListener("load",function(o){var a=this||window;a._textureLoaded=!0,a.setTexture(o),a.createFontChars(),a._changeTextureColor(),a.updateLabel(),a.dispatchEvent("load")},e)}},getFntFile:function(){return this._fntFile},setTexture:function(t){this._texture=t,this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){exports.cc.Node.prototype.setAnchorPoint.call(this,t,e),this.updateLabel()},_setAnchorX:function(t){exports.cc.Node.prototype._setAnchorX.call(this,t),this.updateLabel()},_setAnchorY:function(t){exports.cc.Node.prototype._setAnchorY.call(this,t),this.updateLabel()},_atlasNameFromFntFile:function(t){},_kerningAmountForFirst:function(t,e){var r=0,n=t<<16|e&65535;if(this._configuration.kerningDictionary){var s=this._configuration.kerningDictionary[n.toString()];s&&(r=s.amount)}return r},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){return t=t.charCodeAt(0),t>=9&&t<=13||t===32||t===133||t===160||t===5760||t>=8192&&t<=8202||t===8232||t===8233||t===8239||t===8287||t===12288},_utf8_trim_ws:function(t){var e=t.length;if(!(e<=0)){var r=e-1;if(this._isspace_unicode(t[r])){for(var n=r-1;n>=0&&this._isspace_unicode(t[n]);--n)r=n;this._utf8_trim_from(t,r)}}},_utf8_trim_from:function(t,e){var r=t.length;e>=r||e<0||t.splice(e,r)}});(function(){var t=exports.cc.LabelBMFont.prototype;exports.cc.EventHelper.prototype.apply(t),t.string,exports.cc.defineGetterSetter(t,"string",t.getString,t._setStringForSetter),t.boundingWidth,exports.cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth),t.textAlign,exports.cc.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment),exports.cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture)})();exports.cc.LabelBMFont.create=function(t,e,r,n,s){return new exports.cc.LabelBMFont(t,e,r,n,s)};var _fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){var e=t.match(this.ITEM_EXP),r={};if(e)for(var n=0,s=e.length;n<s;n++){var o=e[n],a=o.indexOf("="),c=o.substring(0,a),l=o.substring(a+1);l.match(this.INT_EXP)?l=parseInt(l):l[0]==='"'&&(l=l.substring(1,l.length-1)),r[c]=l}return r},parseFnt:function(t,e){var r=this,n={},s=r._parseStrToObj(t.match(r.INFO_EXP)[0]),o=s.padding.split(",");parseInt(o[0]),parseInt(o[1]),parseInt(o[2]),parseInt(o[3]);var a=r._parseStrToObj(t.match(r.COMMON_EXP)[0]);if(n.commonHeight=a.lineHeight,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL){var c=exports.cc.configuration.getMaxTextureSize();(a.scaleW>c.width||a.scaleH>c.height)&&exports.cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}a.pages!==1&&exports.cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");var l=r._parseStrToObj(t.match(r.PAGE_EXP)[0]);l.id!==0&&exports.cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),n.atlasName=exports.cc.path.changeBasename(e,l.file);for(var h=t.match(r.CHAR_EXP),u=n.fontDefDictionary={},_=0,d=h.length;_<d;_++){var f=r._parseStrToObj(h[_]),T=f.id;u[T]={rect:{x:f.x,y:f.y,width:f.width,height:f.height},xOffset:f.xoffset,yOffset:f.yoffset,xAdvance:f.xadvance}}var x=n.kerningDict={},m=t.match(r.KERNING_EXP);if(m)for(var _=0,d=m.length;_<d;_++){var v=r._parseStrToObj(m[_]);x[v.first<<16|v.second&65535]=v.amount}return n},load:function(t,e,r,n){var s=this||window;exports.cc.loader.loadTxt(t,function(o,a){if(o)return n(o);n(null,s.parseFnt(a,e))})}};exports.cc.loader.register(["fnt"],_fntLoader);(function(){exports.cc.LabelBMFont.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e)};var t=exports.cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.LabelBMFont.CanvasRenderCmd,t._updateCharTexture=function(e,r,n){n===32?e.setTextureRect(r,!1,exports.cc.size(0,0)):(e.setTextureRect(r,!1),e.visible=!0)},t._updateCharColorAndOpacity=function(e){e._displayedColor=this._displayedColor,e._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty),e._displayedOpacity=this._displayedOpacity,e._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},t.setTexture=function(e){for(var r=this._node,n=r._children,s=this._displayedColor,o=0;o<n.length;o++){var a=n[o],c=a._renderCmd,l=c._displayedColor;r._texture!==c._texture&&(l.r!==s.r||l.g!==s.g||l.b!==s.b)||(a.texture=e)}r._texture=e},t._changeTextureColor=function(){var e=this._node,r=e._texture,n=r.getContentSize(),s=e._texture,o=s.getHtmlElementObj(),a=this._displayedColor,c=exports.cc.rect(0,0,o.width,o.height);if(r&&n.width>0){if(!o)return;var l=s._generateColorTexture(a.r,a.g,a.b,c);e.setTexture(l)}},t._updateChildrenDisplayedOpacity=function(e){exports.cc.Node.prototype.updateDisplayedOpacity.call(e,this._displayedOpacity)},t._updateChildrenDisplayedColor=function(e){exports.cc.Node.prototype.updateDisplayedColor.call(e,this._displayedColor)}})();(function(){exports.cc.LabelAtlas.WebGLRenderCmd=function(e){exports.cc.AtlasNode.WebGLRenderCmd.call(this,e),this._needDraw=!0};var t=exports.cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(exports.cc.AtlasNode.WebGLRenderCmd.prototype);t.constructor=exports.cc.LabelAtlas.WebGLRenderCmd,t._updateColor=function(){if(this._colorF32Array){var e=this._displayedColor,r=this._displayedOpacity/255;this._node._opacityModifyRGB?(this._colorF32Array[0]=e.r*r/255,this._colorF32Array[1]=e.g*r/255,this._colorF32Array[2]=e.b*r/255,this._colorF32Array[3]=r):(this._colorF32Array[0]=e.r/255,this._colorF32Array[1]=e.g/255,this._colorF32Array[2]=e.b/255,this._colorF32Array[3]=r)}},t.setCascade=function(){var e=this._node;e._cascadeOpacityEnabled=!0,e._cascadeColorEnabled=!0},t.rendering=function(e){if(exports.cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,e),exports.cc.LABELATLAS_DEBUG_DRAW){var r=this._node,n=r.getContentSize(),s=r.getBoundingBoxToWorld(),o=s.x,a=s.y;n.width=s.width,n.height=s.height;var c=[exports.cc.p(o,a),exports.cc.p(o+n.width,a),exports.cc.p(n.width+o,n.height+a),exports.cc.p(o,a+n.height)];exports.cc._drawingUtil.drawPoly(c,4,!0)}},t.updateAtlasValues=function(){var e=this._node,r=e._string,n=r.length,s=this._textureAtlas,o=s.texture,a=o.pixelsWidth,c=o.pixelsHeight,l=e._itemWidth,h=e._itemHeight;e._ignoreContentScaleFactor||(l=e._itemWidth*exports.cc.contentScaleFactor(),h=e._itemHeight*exports.cc.contentScaleFactor()),n>s.getCapacity()&&exports.cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var u=s.quads,_=e._itemWidth,d=e._itemHeight,f=0,T=-1;f<n;f++){var x=r.charCodeAt(f)-e._mapStartChar.charCodeAt(0),m=x%e._itemsPerRow,v=0|x/e._itemsPerRow;if(!(m<0||v<0)&&!(m*_+_>a||v*d+d>c)){T++;var A,D,N,z;exports.cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(A=(2*m*l+1)/(2*a),D=A+(l*2-2)/(2*a),N=(2*v*h+1)/(2*c),z=N+(h*2-2)/(2*c)):(A=m*l/a,D=A+l/a,N=v*h/c,z=N+h/c);var M=u[f],J=M.tl,U=M.tr,K=M.bl,tt=M.br;J.texCoords.u=A,J.texCoords.v=N,U.texCoords.u=D,U.texCoords.v=N,K.texCoords.u=A,K.texCoords.v=z,tt.texCoords.u=D,tt.texCoords.v=z,K.vertices.x=T*_,K.vertices.y=0,K.vertices.z=0,tt.vertices.x=T*_+_,tt.vertices.y=0,tt.vertices.z=0,J.vertices.x=T*_,J.vertices.y=e._itemHeight,J.vertices.z=0,U.vertices.x=T*_+_,U.vertices.y=e._itemHeight,U.vertices.z=0}}if(this._updateColor(),this.updateContentSize(f,T+1),n>0){s.dirty=!0;var rt=s.totalQuads;n>rt&&s.increaseTotalQuadsWith(n-rt)}},t.updateContentSize=function(e,r){var n=this._node,s=n._contentSize;e!==r&&e*n._itemWidth===s.width&&n._itemHeight===s.height&&n.setContentSize(r*n._itemWidth,n._itemHeight)},t.setString=function(e){var r=e.length;r>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(r)},t._addChild=function(){}})();(function(){exports.cc.LabelBMFont.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e)};var t=exports.cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.LabelBMFont.WebGLRenderCmd,t.setTexture=function(e){this._node.setOpacityModifyRGB(this._node._texture.hasPremultipliedAlpha())},t._updateCharTexture=function(e,r,n){e.setTextureRect(r,!1),e.visible=!0},t._changeTextureColor=function(){},t._updateCharColorAndOpacity=function(){}})();exports.cc.MotionStreak=exports.cc.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,e,r,n,s){exports.cc.Node.prototype.ctor.call(this),this._positionR=exports.cc.p(0,0),this._blendFunc=new exports.cc.BlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE_MINUS_SRC_ALPHA),this.fastMode=!1,this.startingPositionInitialized=!1,this.texture=null,this._stroke=0,this._fadeDelta=0,this._minSeg=0,this._maxPoints=0,this._nuPoints=0,this._previousNuPoints=0,this._pointVertexes=null,this._pointState=null,this._vertices=null,this._colorPointer=null,this._texCoords=null,this._verticesBuffer=null,this._colorPointerBuffer=null,this._texCoordsBuffer=null,s!==void 0&&this.initWithFade(t,e,r,n,s)},getTexture:function(){return this.texture},setTexture:function(t){this.texture!==t&&(this.texture=t)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){e===void 0?this._blendFunc=t:(this._blendFunc.src=t,this._blendFunc.dst=e)},getOpacity:function(){return exports.cc.log("cc.MotionStreak.getOpacity has not been supported."),0},setOpacity:function(t){exports.cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},initWithFade:function(t,e,r,n,s){if(!s)throw new Error("cc.MotionStreak.initWithFade(): Invalid filename or texture");exports.cc.isString(s)&&(s=exports.cc.textureCache.addImage(s)),exports.cc.Node.prototype.setPosition.call(this,exports.cc.p(0,0)),this.anchorX=0,this.anchorY=0,this.ignoreAnchor=!0,this.startingPositionInitialized=!1,this.fastMode=!0,this._minSeg=e===-1?r/5:e,this._minSeg*=this._minSeg,this._stroke=r,this._fadeDelta=1/t;var o=(0|t*60)+2;return this._maxPoints=o,this._nuPoints=0,this._pointState=new Float32Array(o),this._pointVertexes=new Float32Array(o*2),this._vertices=new Float32Array(o*4),this._texCoords=new Float32Array(o*4),this._colorPointer=new Uint8Array(o*8),this._verticesBuffer=gl.createBuffer(),this._texCoordsBuffer=gl.createBuffer(),this._colorPointerBuffer=gl.createBuffer(),this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.texture=s,this.color=n,this.scheduleUpdate(),gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW),!0},tintWithColor:function(t){this.color=t;for(var e=this._colorPointer,r=0,n=this._nuPoints*2;r<n;r++)e[r*4]=t.r,e[r*4+1]=t.g,e[r*4+2]=t.b},reset:function(){this._nuPoints=0},setPosition:function(t,e){this.startingPositionInitialized=!0,e===void 0?(this._positionR.x=t.x,this._positionR.y=t.y):(this._positionR.x=t,this._positionR.y=e)},getPositionX:function(){return this._positionR.x},setPositionX:function(t){this._positionR.x=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},update:function(t){if(this.startingPositionInitialized){this._renderCmd._updateDisplayColor(),t*=this._fadeDelta;var e,r,n,s,o=0,a=this._nuPoints,c=this._pointState,l=this._pointVertexes,h=this._vertices,u=this._colorPointer;for(n=0;n<a;n++)if(c[n]-=t,c[n]<=0)o++;else{e=n-o,o>0?(c[e]=c[n],l[e*2]=l[n*2],l[e*2+1]=l[n*2+1],s=n*2,r=e*2,h[r*2]=h[s*2],h[r*2+1]=h[s*2+1],h[(r+1)*2]=h[(s+1)*2],h[(r+1)*2+1]=h[(s+1)*2+1],s*=4,r*=4,u[r+0]=u[s+0],u[r+1]=u[s+1],u[r+2]=u[s+2],u[r+4]=u[s+4],u[r+5]=u[s+5],u[r+6]=u[s+6]):r=e*8;var _=c[e]*255;u[r+3]=_,u[r+7]=_}a-=o;var d=!0;if(a>=this._maxPoints)d=!1;else if(a>0){var f=exports.cc.pDistanceSQ(exports.cc.p(l[(a-1)*2],l[(a-1)*2+1]),this._positionR)<this._minSeg,T=a===1?!1:exports.cc.pDistanceSQ(exports.cc.p(l[(a-2)*2],l[(a-2)*2+1]),this._positionR)<this._minSeg*2;(f||T)&&(d=!1)}if(d){l[a*2]=this._positionR.x,l[a*2+1]=this._positionR.y,c[a]=1;var x=a*8,m=this.getDisplayedColor();u[x]=m.r,u[x+1]=m.g,u[x+2]=m.b,u[x+4]=m.r,u[x+5]=m.g,u[x+6]=m.b,u[x+3]=255,u[x+7]=255,a>0&&this.fastMode&&(a>1?exports.cc.vertexLineToPolygon(l,this._stroke,this._vertices,a,1):exports.cc.vertexLineToPolygon(l,this._stroke,this._vertices,0,2)),a++}if(this.fastMode||exports.cc.vertexLineToPolygon(l,this._stroke,this._vertices,0,a),a&&this._previousNuPoints!==a){var v=1/a,A=this._texCoords;for(n=0;n<a;n++)A[n*4]=0,A[n*4+1]=v*n,A[(n*2+1)*2]=1,A[(n*2+1)*2+1]=v*n;this._previousNuPoints=a}this._nuPoints=a}},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new exports.cc.MotionStreak.WebGLRenderCmd(this):null}});exports.cc.MotionStreak.create=function(t,e,r,n,s){return new exports.cc.MotionStreak(t,e,r,n,s)};exports.cc.MotionStreak.WebGLRenderCmd=function(t){exports.cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR)};exports.cc.MotionStreak.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);exports.cc.MotionStreak.WebGLRenderCmd.prototype.constructor=exports.cc.Sprite.WebGLRenderCmd;exports.cc.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(!(e._nuPoints<=1)&&e.texture&&e.texture.isLoaded()){t=t||exports.cc._renderContext;var r=this._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),exports.cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),exports.cc.glBindTexture2D(e.texture),t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,e._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,e._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._texCoordsBuffer),t.bufferData(t.ARRAY_BUFFER,e._texCoords,t.DYNAMIC_DRAW),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e._colorPointerBuffer),t.bufferData(t.ARRAY_BUFFER,e._colorPointer,t.DYNAMIC_DRAW),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,e._nuPoints*2),exports.cc.g_NumberOfDraws++}};exports.cc.NodeGrid=exports.cc.Node.extend({grid:null,_target:null,_gridRect:null,ctor:function(t){exports.cc.Node.prototype.ctor.call(this),t===void 0&&(t=exports.cc.rect()),this._gridRect=t},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},setGridRect:function(t){this._gridRect=t},getGridRect:function(){return this._gridRect},setTarget:function(t){this._target=t},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new exports.cc.NodeGrid.WebGLRenderCmd(this):new exports.cc.Node.CanvasRenderCmd(this)}});var _p=exports.cc.NodeGrid.prototype;_p.grid;_p.target;exports.cc.defineGetterSetter(_p,"target",null,_p.setTarget);exports.cc.NodeGrid.create=function(){return new exports.cc.NodeGrid};(function(){exports.cc.NodeGrid.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!1,this._gridBeginCommand=new exports.cc.CustomRenderCmd(this,this.onGridBeginDraw),this._gridEndCommand=new exports.cc.CustomRenderCmd(this,this.onGridEndDraw)};var t=exports.cc.NodeGrid.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.NodeGrid.WebGLRenderCmd,t.visit=function(e){var r=this._node;if(r._visible){e=e||this.getParentRenderCmd(),r._parent&&r._parent._renderCmd&&(this._curLevel=r._parent._renderCmd._curLevel+1);var n=exports.cc.current_stack;n.stack.push(n.top),this._syncStatus(e),n.top=this._stackMatrix,exports.cc.renderer.pushRenderCommand(this._gridBeginCommand),r._target&&r._target.visit();var s=r._children;if(s&&s.length>0){var o=s.length;r.sortAllChildren();for(var a=0;a<o;a++){var c=s[a];c&&c.visit()}}exports.cc.renderer.pushRenderCommand(this._gridEndCommand),this._dirtyFlag=0,n.top=n.stack.pop()}},t.onGridBeginDraw=function(){var e=this._node.grid;e&&e._active&&e.beforeDraw()},t.onGridEndDraw=function(){var e=this._node.grid;e&&e._active&&e.afterDraw(this._node)}})();exports.cc.v2fzero=function(){return{x:0,y:0}};exports.cc.v2f=function(t,e){return{x:t,y:e}};exports.cc.v2fadd=function(t,e){return exports.cc.v2f(t.x+e.x,t.y+e.y)};exports.cc.v2fsub=function(t,e){return exports.cc.v2f(t.x-e.x,t.y-e.y)};exports.cc.v2fmult=function(t,e){return exports.cc.v2f(t.x*e,t.y*e)};exports.cc.v2fperp=function(t){return exports.cc.v2f(-t.y,t.x)};exports.cc.v2fneg=function(t){return exports.cc.v2f(-t.x,-t.y)};exports.cc.v2fdot=function(t,e){return t.x*e.x+t.y*e.y};exports.cc.v2fforangle=function(t){return exports.cc.v2f(Math.cos(t),Math.sin(t))};exports.cc.v2fnormalize=function(t){var e=exports.cc.pNormalize(exports.cc.p(t.x,t.y));return exports.cc.v2f(e.x,e.y)};exports.cc.__v2f=function(t){return exports.cc.v2f(t.x,t.y)};exports.cc.__t=function(t){return{u:t.x,v:t.y}};exports.cc.DrawNode=exports.cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){e===void 0?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a==null?255:t.a},getDrawColor:function(){return exports.cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}});exports.cc.DrawNode.create=function(){return new exports.cc.DrawNode};exports.cc.DrawNode.TYPE_DOT=0;exports.cc.DrawNode.TYPE_SEGMENT=1;exports.cc.DrawNode.TYPE_POLY=2;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?(exports.cc._DrawNodeElement=function(t,e,r,n,s,o,a,c,l){var h=this||window;h.type=t,h.verts=e||null,h.fillColor=r||null,h.lineWidth=n||0,h.lineColor=s||null,h.lineCap=o||"butt",h.isClosePolygon=a||!1,h.isFill=c||!1,h.isStroke=l||!1},exports.cc.extend(exports.cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){exports.cc.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=exports.cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new exports.cc.BlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE_MINUS_SRC_ALPHA),this.init(),this._localBB=new exports.cc.Rect},setLocalBB:function(t,e,r,n){var s=this._localBB;e===void 0?(s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height):(s.x=t,s.y=e,s.width=r,s.height=n)},drawRect:function(t,e,r,n,s){n=n==null?this._lineWidth:n,s=s||this.getDrawColor(),s.a==null&&(s.a=255);var o=[t,exports.cc.p(e.x,t.y),e,exports.cc.p(t.x,e.y)],a=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);a.verts=o,a.lineWidth=n,a.lineColor=s,a.isClosePolygon=!0,a.isStroke=!0,a.lineCap="butt",a.fillColor=r,r&&(r.a==null&&(r.a=255),a.isFill=!0),this._buffer.push(a)},drawCircle:function(t,e,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),a.a==null&&(a.a=255);for(var c=2*Math.PI/n,l=[],h=0;h<=n;h++){var u=h*c,_=e*Math.cos(u+r)+t.x,d=e*Math.sin(u+r)+t.y;l.push(exports.cc.p(_,d))}s&&l.push(exports.cc.p(t.x,t.y));var f=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);f.verts=l,f.lineWidth=o,f.lineColor=a,f.isClosePolygon=!0,f.isStroke=!0,this._buffer.push(f)},drawQuadBezier:function(t,e,r,n,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),o.a==null&&(o.a=255);for(var a=[],c=0,l=0;l<n;l++){var h=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*r.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*r.y;a.push(exports.cc.p(h,u)),c+=1/n}a.push(exports.cc.p(r.x,r.y));var _=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);_.verts=a,_.lineWidth=s,_.lineColor=o,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},drawCubicBezier:function(t,e,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),a.a==null&&(a.a=255);for(var c=[],l=0,h=0;h<s;h++){var u=Math.pow(1-l,3)*t.x+3*Math.pow(1-l,2)*l*e.x+3*(1-l)*l*l*r.x+l*l*l*n.x,_=Math.pow(1-l,3)*t.y+3*Math.pow(1-l,2)*l*e.y+3*(1-l)*l*l*r.y+l*l*l*n.y;c.push(exports.cc.p(u,_)),l+=1/s}c.push(exports.cc.p(n.x,n.y));var d=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);d.verts=c,d.lineWidth=o,d.lineColor=a,d.isStroke=!0,d.lineCap="round",this._buffer.push(d)},drawCatmullRom:function(t,e,r,n){this.drawCardinalSpline(t,.5,e,r,n)},drawCardinalSpline:function(t,e,r,n,s){n=n||this._lineWidth,s=s||this.getDrawColor(),s.a==null&&(s.a=255);for(var o=[],a,c,l=1/t.length,h=0;h<r+1;h++){var u=h/r;u===1?(a=t.length-1,c=1):(a=0|u/l,c=(u-l*a)/l);var _=exports.cc.cardinalSplineAt(exports.cc.getControlPointAt(t,a-1),exports.cc.getControlPointAt(t,a-0),exports.cc.getControlPointAt(t,a+1),exports.cc.getControlPointAt(t,a+2),e,c);o.push(_)}var d=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);d.verts=o,d.lineWidth=n,d.lineColor=s,d.isStroke=!0,d.lineCap="round",this._buffer.push(d)},drawDot:function(t,e,r){r=r||this.getDrawColor(),r.a==null&&(r.a=255);var n=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=r,this._buffer.push(n)},drawDots:function(t,e,r){if(!(!t||t.length==0)){r=r||this.getDrawColor(),r.a==null&&(r.a=255);for(var n=0,s=t.length;n<s;n++)this.drawDot(t[n],e,r)}},drawSegment:function(t,e,r,n){r=r||this._lineWidth,n=n||this.getDrawColor(),n.a==null&&(n.a=255);var s=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);s.verts=[t,e],s.lineWidth=r*2,s.lineColor=n,s.isStroke=!0,s.lineCap="round",this._buffer.push(s)},drawPoly_:function(t,e,r,n){r=r==null?this._lineWidth:r,n=n||this.getDrawColor(),n.a==null&&(n.a=255);var s=new exports.cc._DrawNodeElement(exports.cc.DrawNode.TYPE_POLY);s.verts=t,s.fillColor=e,s.lineWidth=r,s.lineColor=n,s.isClosePolygon=!0,s.isStroke=!0,s.lineCap="round",e&&(s.isFill=!0),this._buffer.push(s)},drawPoly:function(t,e,r,n){for(var s=[],o=0;o<t.length;o++)s.push(exports.cc.p(t[o].x,t[o].y));return this.drawPoly_(s,e,r,n)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new exports.cc.DrawNode.CanvasRenderCmd(this)}})):exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&exports.cc.extend(exports.cc.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){exports.cc.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new exports.cc.BlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE_MINUS_SRC_ALPHA),this._drawColor=exports.cc.color(255,255,255,255),this.init()},init:function(){return exports.cc.Node.prototype.init.call(this)?(this.shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=exports.cc._renderContext.createBuffer(),this._dirty=!0,!0):!1},drawRect:function(t,e,r,n,s){n=n==null?this._lineWidth:n,s=s||this.getDrawColor(),s.a==null&&(s.a=255);var o=[t,exports.cc.p(e.x,t.y),e,exports.cc.p(t.x,e.y)];r==null?this._drawSegments(o,n,s,!0):this.drawPoly(o,r,n,s)},drawCircle:function(t,e,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),a.a==null&&(a.a=255);var c=2*Math.PI/n,l=[],h,u;for(h=0;h<=n;h++){var _=h*c,d=e*Math.cos(_+r)+t.x,f=e*Math.sin(_+r)+t.y;l.push(exports.cc.p(d,f))}for(s&&l.push(exports.cc.p(t.x,t.y)),o*=.5,h=0,u=l.length;h<u-1;h++)this.drawSegment(l[h],l[h+1],o,a)},drawQuadBezier:function(t,e,r,n,s,o){s=s||this._lineWidth,o=o||this.getDrawColor(),o.a==null&&(o.a=255);for(var a=[],c=0,l=0;l<n;l++){var h=Math.pow(1-c,2)*t.x+2*(1-c)*c*e.x+c*c*r.x,u=Math.pow(1-c,2)*t.y+2*(1-c)*c*e.y+c*c*r.y;a.push(exports.cc.p(h,u)),c+=1/n}a.push(exports.cc.p(r.x,r.y)),this._drawSegments(a,s,o,!1)},drawCubicBezier:function(t,e,r,n,s,o,a){o=o||this._lineWidth,a=a||this.getDrawColor(),a.a==null&&(a.a=255);for(var c=[],l=0,h=0;h<s;h++){var u=Math.pow(1-l,3)*t.x+3*Math.pow(1-l,2)*l*e.x+3*(1-l)*l*l*r.x+l*l*l*n.x,_=Math.pow(1-l,3)*t.y+3*Math.pow(1-l,2)*l*e.y+3*(1-l)*l*l*r.y+l*l*l*n.y;c.push(exports.cc.p(u,_)),l+=1/s}c.push(exports.cc.p(n.x,n.y)),this._drawSegments(c,o,a,!1)},drawCatmullRom:function(t,e,r,n){this.drawCardinalSpline(t,.5,e,r,n)},drawCardinalSpline:function(t,e,r,n,s){n=n||this._lineWidth,s=s||this.getDrawColor(),s.a==null&&(s.a=255);for(var o=[],a,c,l=1/t.length,h=0;h<r+1;h++){var u=h/r;u===1?(a=t.length-1,c=1):(a=0|u/l,c=(u-l*a)/l);var _=exports.cc.cardinalSplineAt(exports.cc.getControlPointAt(t,a-1),exports.cc.getControlPointAt(t,a-0),exports.cc.getControlPointAt(t,a+1),exports.cc.getControlPointAt(t,a+2),e,c);o.push(_)}n*=.5;for(var d=0,f=o.length;d<f-1;d++)this.drawSegment(o[d],o[d+1],n,s)},_render:function(){var t=exports.cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=exports.cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,this._buffer.length*3),exports.cc.incrementGLDraws(1)},_ensureCapacity:function(t){var e=this||window,r=e._buffer;if(r.length+t>e._bufferCapacity){var n=exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(e._bufferCapacity+=Math.max(e._bufferCapacity,t),r==null||r.length===0)e._buffer=[],e._trianglesArrayBuffer=new ArrayBuffer(n*e._bufferCapacity),e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer);else{for(var s=[],o=new ArrayBuffer(n*e._bufferCapacity),a=0;a<r.length;a++)s[a]=new exports.cc.V2F_C4B_T2F_Triangle(r[a].a,r[a].b,r[a].c,o,a*n);e._trianglesReader=new Uint8Array(o),e._trianglesArrayBuffer=o,e._buffer=s}}},drawDot:function(t,e,r){r=r||this.getDrawColor(),r.a==null&&(r.a=255);var n={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},s={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}},a={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}},c={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(2*3),this._buffer.push(new exports.cc.V2F_C4B_T2F_Triangle(s,o,a,this._trianglesArrayBuffer,this._buffer.length*exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new exports.cc.V2F_C4B_T2F_Triangle(s,a,c,this._trianglesArrayBuffer,this._buffer.length*exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawDots:function(t,e,r){if(!(!t||t.length===0)){r=r||this.getDrawColor(),r.a==null&&(r.a=255);for(var n=0,s=t.length;n<s;n++)this.drawDot(t[n],e,r)}},drawSegment:function(t,e,r,n){n=n||this.getDrawColor(),n.a==null&&(n.a=255),r=r||this._lineWidth*.5;var s=6*3;this._ensureCapacity(s);var o={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},a=exports.cc.__v2f(t),c=exports.cc.__v2f(e),l=exports.cc.v2fnormalize(exports.cc.v2fperp(exports.cc.v2fsub(c,a))),h=exports.cc.v2fperp(l),u=exports.cc.v2fmult(l,r),_=exports.cc.v2fmult(h,r),d=exports.cc.v2fsub(c,exports.cc.v2fadd(u,_)),f=exports.cc.v2fadd(c,exports.cc.v2fsub(u,_)),T=exports.cc.v2fsub(c,u),x=exports.cc.v2fadd(c,u),m=exports.cc.v2fsub(a,u),v=exports.cc.v2fadd(a,u),A=exports.cc.v2fsub(a,exports.cc.v2fsub(u,_)),D=exports.cc.v2fadd(a,exports.cc.v2fadd(u,_)),N=exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,z=this._trianglesArrayBuffer,M=this._buffer;M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:d,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(exports.cc.v2fadd(l,h)))},{vertices:f,colors:o,texCoords:exports.cc.__t(exports.cc.v2fsub(l,h))},{vertices:T,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},z,M.length*N)),M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:x,colors:o,texCoords:exports.cc.__t(l)},{vertices:f,colors:o,texCoords:exports.cc.__t(exports.cc.v2fsub(l,h))},{vertices:T,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},z,M.length*N)),M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:x,colors:o,texCoords:exports.cc.__t(l)},{vertices:m,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},{vertices:T,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},z,M.length*N)),M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:x,colors:o,texCoords:exports.cc.__t(l)},{vertices:m,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},{vertices:v,colors:o,texCoords:exports.cc.__t(l)},z,M.length*N)),M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:A,colors:o,texCoords:exports.cc.__t(exports.cc.v2fsub(h,l))},{vertices:m,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(l))},{vertices:v,colors:o,texCoords:exports.cc.__t(l)},z,M.length*N)),M.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:A,colors:o,texCoords:exports.cc.__t(exports.cc.v2fsub(h,l))},{vertices:D,colors:o,texCoords:exports.cc.__t(exports.cc.v2fadd(l,h))},{vertices:v,colors:o,texCoords:exports.cc.__t(l)},z,M.length*N)),this._dirty=!0},drawPoly:function(t,e,r,n){if(e==null){this._drawSegments(t,r,n,!0);return}e.a==null&&(e.a=255),n.a==null&&(n.a=255),r=r==null?this._lineWidth:r,r*=.5;var s={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},o={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},a=[],c,l,h,u,_=t.length;for(c=0;c<_;c++){l=exports.cc.__v2f(t[(c-1+_)%_]),h=exports.cc.__v2f(t[c]),u=exports.cc.__v2f(t[(c+1)%_]);var d=exports.cc.v2fnormalize(exports.cc.v2fperp(exports.cc.v2fsub(h,l))),f=exports.cc.v2fnormalize(exports.cc.v2fperp(exports.cc.v2fsub(u,h))),T=exports.cc.v2fmult(exports.cc.v2fadd(d,f),1/(exports.cc.v2fdot(d,f)+1));a[c]={offset:T,n:f}}var x=r>0,m=3*_-2,v=3*m;this._ensureCapacity(v);var A=exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,D=this._trianglesArrayBuffer,N=this._buffer,z=x==!1?.5:0;for(c=0;c<_-2;c++)l=exports.cc.v2fsub(exports.cc.__v2f(t[0]),exports.cc.v2fmult(a[0].offset,z)),h=exports.cc.v2fsub(exports.cc.__v2f(t[c+1]),exports.cc.v2fmult(a[c+1].offset,z)),u=exports.cc.v2fsub(exports.cc.__v2f(t[c+2]),exports.cc.v2fmult(a[c+2].offset,z)),N.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:l,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},{vertices:h,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},{vertices:u,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},D,N.length*A));for(c=0;c<_;c++){var M=(c+1)%_;l=exports.cc.__v2f(t[c]),h=exports.cc.__v2f(t[M]);var J=a[c].n,U=a[c].offset,K=a[M].offset,tt=x?exports.cc.v2fsub(l,exports.cc.v2fmult(U,r)):exports.cc.v2fsub(l,exports.cc.v2fmult(U,.5)),rt=x?exports.cc.v2fsub(h,exports.cc.v2fmult(K,r)):exports.cc.v2fsub(h,exports.cc.v2fmult(K,.5)),I=x?exports.cc.v2fadd(l,exports.cc.v2fmult(U,r)):exports.cc.v2fadd(l,exports.cc.v2fmult(U,.5)),L=x?exports.cc.v2fadd(h,exports.cc.v2fmult(K,r)):exports.cc.v2fadd(h,exports.cc.v2fmult(K,.5));x?(N.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:tt,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(J))},{vertices:rt,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(J))},{vertices:L,colors:o,texCoords:exports.cc.__t(J)},D,N.length*A)),N.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:tt,colors:o,texCoords:exports.cc.__t(exports.cc.v2fneg(J))},{vertices:I,colors:o,texCoords:exports.cc.__t(J)},{vertices:L,colors:o,texCoords:exports.cc.__t(J)},D,N.length*A))):(N.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:tt,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},{vertices:rt,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},{vertices:L,colors:s,texCoords:exports.cc.__t(J)},D,N.length*A)),N.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:tt,colors:s,texCoords:exports.cc.__t(exports.cc.v2fzero())},{vertices:I,colors:s,texCoords:exports.cc.__t(J)},{vertices:L,colors:s,texCoords:exports.cc.__t(J)},D,N.length*A)))}a=null,this._dirty=!0},_drawSegments:function(t,e,r,n){if(e=e==null?this._lineWidth:e,r=r||this._drawColor,r.a==null&&(r.a=255),e*=.5,!(e<=0)){var s={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},o=[],a,c,l,h,u=t.length;for(a=0;a<u;a++){c=exports.cc.__v2f(t[(a-1+u)%u]),l=exports.cc.__v2f(t[a]),h=exports.cc.__v2f(t[(a+1)%u]);var _=exports.cc.v2fnormalize(exports.cc.v2fperp(exports.cc.v2fsub(l,c))),d=exports.cc.v2fnormalize(exports.cc.v2fperp(exports.cc.v2fsub(h,l))),f=exports.cc.v2fmult(exports.cc.v2fadd(_,d),1/(exports.cc.v2fdot(_,d)+1));o[a]={offset:f,n:d}}var T=3*u-2,x=3*T;this._ensureCapacity(x);var m=exports.cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,v=this._trianglesArrayBuffer,A=this._buffer,D=n?u:u-1;for(a=0;a<D;a++){var N=(a+1)%u;c=exports.cc.__v2f(t[a]),l=exports.cc.__v2f(t[N]);var z=o[a].n,M=o[a].offset,J=o[N].offset,U=exports.cc.v2fsub(c,exports.cc.v2fmult(M,e)),K=exports.cc.v2fsub(l,exports.cc.v2fmult(J,e)),tt=exports.cc.v2fadd(c,exports.cc.v2fmult(M,e)),rt=exports.cc.v2fadd(l,exports.cc.v2fmult(J,e));A.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:U,colors:s,texCoords:exports.cc.__t(exports.cc.v2fneg(z))},{vertices:K,colors:s,texCoords:exports.cc.__t(exports.cc.v2fneg(z))},{vertices:rt,colors:s,texCoords:exports.cc.__t(z)},v,A.length*m)),A.push(new exports.cc.V2F_C4B_T2F_Triangle({vertices:U,colors:s,texCoords:exports.cc.__t(exports.cc.v2fneg(z))},{vertices:tt,colors:s,texCoords:exports.cc.__t(z)},{vertices:rt,colors:s,texCoords:exports.cc.__t(z)},v,A.length*m))}o=null,this._dirty=!0}},clear:function(){this._buffer.length=0,this._dirty=!0},_createRenderCmd:function(){return new exports.cc.DrawNode.WebGLRenderCmd(this)}})});(function(){exports.cc.DrawNode.CanvasRenderCmd=function(t){exports.cc.Node.CanvasRenderCmd.call(this,t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null},exports.cc.DrawNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype),exports.cc.DrawNode.CanvasRenderCmd.prototype.constructor=exports.cc.DrawNode.CanvasRenderCmd,exports.cc.DrawNode.CanvasRenderCmd.prototype.getLocalBB=function(){var t=this._node;return t._localBB},exports.cc.extend(exports.cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(t,e,r){var n=t||exports.cc._renderContext;n.getContext();var s=this._node,o=s._displayedOpacity/255;if(o!==0){n.setTransform(this._worldTransform,e,r),n.setGlobalAlpha(o),this._blendFunc&&this._blendFunc.src===exports.cc.SRC_ALPHA&&this._blendFunc.dst===exports.cc.ONE&&n.setCompositeOperation("lighter");for(var a=this._buffer,c=0,l=a.length;c<l;c++){var h=a[c];switch(h.type){case exports.cc.DrawNode.TYPE_DOT:this._drawDot(n,h,e,r);break;case exports.cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,h,e,r);break;case exports.cc.DrawNode.TYPE_POLY:this._drawPoly(n,h,e,r);break}}}},_drawDot:function(t,e){var r=e.fillColor,n=e.verts[0],s=e.lineWidth,o=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),o.beginPath(),o.arc(n.x,-n.y,s,0,Math.PI*2,!1),o.closePath(),o.fill()},_drawSegment:function(t,e,r){var n=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,l=t.getContext();t.setStrokeStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")"),l.lineWidth=a*r,l.beginPath(),l.lineCap=c,l.moveTo(s.x,-s.y),l.lineTo(o.x,-o.y),l.stroke()},_drawPoly:function(t,e,r){var n=e.verts,s=e.lineCap;if(n!=null){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,l=e.isClosePolygon,h=e.isFill,u=e.isStroke,_=t.getContext(),d=n[0];_.lineCap=s,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),a&&(_.lineWidth=a*r),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),_.beginPath(),_.moveTo(d.x,-d.y);for(var f=1,T=n.length;f<T;f++)_.lineTo(n[f].x,-n[f].y);l&&_.closePath(),h&&_.fill(),u&&_.stroke()}}})})();(function(){exports.cc.DrawNode.WebGLRenderCmd=function(t){exports.cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity()},exports.cc.DrawNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype),exports.cc.DrawNode.WebGLRenderCmd.prototype.constructor=exports.cc.DrawNode.WebGLRenderCmd,exports.cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._buffer.length>0){var r=this._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,exports.cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render()}}})();exports.cc.stencilBits=-1;exports.cc.ClippingNode=exports.cc.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,exports.cc.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){exports.cc.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){exports.cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),exports.cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),exports.cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ClippingNode.CanvasRenderCmd(this):new exports.cc.ClippingNode.WebGLRenderCmd(this)}});var _p=exports.cc.ClippingNode.prototype;exports.cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil);_p.stencil;exports.cc.ClippingNode.create=function(t){return new exports.cc.ClippingNode(t)};(function(){exports.cc.ClippingNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!1,this._godhelpme=!1,this._clipElemType=!1,this._rendererSaveCmd=new exports.cc.CustomRenderCmd(this,this._saveCmdCallback),this._rendererClipCmd=new exports.cc.CustomRenderCmd(this,this._clipCmdCallback),this._rendererRestoreCmd=new exports.cc.CustomRenderCmd(this,this._restoreCmdCallback)};var t=exports.cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.ClippingNode.CanvasRenderCmd,t.initStencilBits=function(){},t.setStencil=function(e){if(e!=null)if(this._node._stencil=e,e instanceof exports.cc.DrawNode){if(e._buffer)for(var r=0;r<e._buffer.length;r++)e._buffer[r].isFill=!1,e._buffer[r].isStroke=!1;e._renderCmd.rendering=function(n,s,o){},e._renderCmd._canUseDirtyRegion=!0,this._rendererSaveCmd._canUseDirtyRegion=!0,this._rendererClipCmd._canUseDirtyRegion=!0,this._rendererRestoreCmd._canUseDirtyRegion=!0}else e._parent=this._node},t._saveCmdCallback=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext();if(this._clipElemType){var a=exports.cc.ClippingNode.CanvasRenderCmd._getSharedCache(),c=o.canvas;a.width=c.width,a.height=c.height;var l=a.getContext("2d");l.drawImage(c,0,0)}else s.save(),s.setTransform(this._worldTransform,r,n),this._node.inverted&&(o.beginPath(),o.rect(0,0,o.canvas.width,-o.canvas.height),o.clip())},t._setStencilCompositionOperation=function(e){if(e){var r=this._node;if(e._renderCmd&&e._renderCmd._blendFuncStr&&(e._renderCmd._blendFuncStr=r.inverted?"destination-out":"destination-in"),!!e._children)for(var n=e._children,s=0,o=n.length;s<o;s++)this._setStencilCompositionOperation(n[s])}},t._clipCmdCallback=function(e){var r=this._node,n=e||exports.cc._renderContext,s=n.getContext();if(this._clipElemType)this._setStencilCompositionOperation(r._stencil);else{var o=this._node._stencil;if(o instanceof exports.cc.DrawNode){s.beginPath();var a=o._renderCmd._transform;s.transform(a.a,a.b,a.c,a.d,a.tx,-a.ty);for(var c=0;c<o._buffer.length;c++){var l=o._buffer[c].verts,h=l[0];s.moveTo(h.x,-h.y);for(var u=l.length-1;u>0;u--)s.lineTo(l[u].x,-l[u].y)}}s.clip()}},t._restoreCmdCallback=function(e){var r=exports.cc.ClippingNode.CanvasRenderCmd._getSharedCache(),n=e||exports.cc._renderContext,s=n.getContext();this._clipElemType?(s.save(),s.setTransform(1,0,0,1,0,0),s.globalCompositeOperation="destination-over",s.drawImage(r,0,0),s.restore(),this._dirtyFlag=0):n.restore()},t.transform=function(e,r){exports.cc.Node.CanvasRenderCmd.prototype.transform.call(this,e,r);var n=this._node;n._stencil&&n._stencil._renderCmd&&n._stencil._renderCmd.transform(this,r)},t._cangodhelpme=function(e){return(e===!0||e===!1)&&(exports.cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=e),exports.cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme},t.visit=function(e){var r=this._node;if(r._visible){e=e||this.getParentRenderCmd(),e&&(this._curLevel=e._curLevel+1);var n=this||window;if(this._clipElemType=!(!this._cangodhelpme()&&r._stencil instanceof exports.cc.DrawNode),!r._stencil||!r._stencil.visible){this.inverted&&this.originVisit(e);return}if(this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this._rendererSaveCmd),this._clipElemType?this.originVisit(e):r._stencil.visit(this),exports.cc.renderer.pushRenderCommand(this._rendererClipCmd),this._clipElemType)r._stencil.visit(n);else{var s,o=r._children;this._cangodhelpme(!0);var a=o.length;if(a>0)for(r.sortAllChildren(),s=0;s<a;s++)o[s]._renderCmd.visit(this);this._cangodhelpme(!1)}exports.cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}},exports.cc.ClippingNode.CanvasRenderCmd._sharedCache=null,exports.cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return exports.cc.ClippingNode.CanvasRenderCmd._sharedCache||(exports.cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}})();(function(){exports.cc.ClippingNode.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!1,this._beforeVisitCmd=new exports.cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new exports.cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new exports.cc.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilEnabled=null,this._mask_layer_le=null};var t=exports.cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.ClippingNode.WebGLRenderCmd,exports.cc.ClippingNode.WebGLRenderCmd._init_once=null,exports.cc.ClippingNode.WebGLRenderCmd._visit_once=null,exports.cc.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){exports.cc.ClippingNode.WebGLRenderCmd._init_once=!0,exports.cc.ClippingNode.WebGLRenderCmd._init_once&&(exports.cc.stencilBits=exports.cc._renderContext.getParameter(exports.cc._renderContext.STENCIL_BITS),exports.cc.stencilBits<=0&&exports.cc.log("Stencil buffer is not enabled."),exports.cc.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(e,r){var n=this._node;this.originTransform(e,r),n._stencil&&n._stencil._renderCmd.transform(this,r)},t.visit=function(e){var r=this._node;if(r._visible){if(r._parent&&r._parent._renderCmd&&(this._curLevel=r._parent._renderCmd._curLevel+1),exports.cc.stencilBits<1){this.originVisit(e);return}if(!r._stencil||!r._stencil.visible){r.inverted&&this.originVisit(e);return}if(exports.cc.ClippingNode.WebGLRenderCmd._layer+1===exports.cc.stencilBits){exports.cc.ClippingNode.WebGLRenderCmd._visit_once=!0,exports.cc.ClippingNode.WebGLRenderCmd._visit_once&&(exports.cc.log("Nesting more than "+exports.cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),exports.cc.ClippingNode.WebGLRenderCmd._visit_once=!1),this.originVisit(e);return}exports.cc.renderer.pushRenderCommand(this._beforeVisitCmd);var n=exports.cc.current_stack;n.stack.push(n.top),this._syncStatus(e),n.top=this._stackMatrix,r._stencil._renderCmd.visit(this),exports.cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var s=r._children;if(s&&s.length>0){var o=s.length;r.sortAllChildren();for(var a=0;a<o;a++)s[a]._renderCmd.visit(this)}exports.cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,n.top=n.stack.pop()}},t.setStencil=function(e){var r=this._node;r._stencil&&(r._stencil._parent=null),r._stencil=e,r._stencil&&(r._stencil._parent=r)},t._onBeforeVisit=function(e){var r=e||exports.cc._renderContext,n=this._node;exports.cc.ClippingNode.WebGLRenderCmd._layer++;var s=1<<exports.cc.ClippingNode.WebGLRenderCmd._layer,o=s-1;if(this._mask_layer_le=s|o,this._currentStencilEnabled=r.isEnabled(r.STENCIL_TEST),r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.depthMask(!1),r.stencilFunc(r.NEVER,s,s),r.stencilOp(r.REPLACE,r.KEEP,r.KEEP),r.stencilMask(s),r.clear(r.STENCIL_BUFFER_BIT),n.alphaThreshold<1){var a=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLORALPHATEST);exports.cc.glUseProgram(a.getProgram()),a.setUniformLocationWith1f(exports.cc.UNIFORM_ALPHA_TEST_VALUE_S,n.alphaThreshold),a.setUniformLocationWithMatrix4fv(exports.cc.UNIFORM_MVMATRIX_S,exports.cc.renderer.mat4Identity.mat),exports.cc.setProgram(n._stencil,a)}},t._onAfterDrawStencil=function(e){var r=e||exports.cc._renderContext;r.depthMask(!0),r.stencilFunc(this._node.inverted?r.NOTEQUAL:r.EQUAL,this._mask_layer_le,this._mask_layer_le),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)},t._onAfterVisit=function(e){var r=e||exports.cc._renderContext;if(exports.cc.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled){var n=1<<exports.cc.ClippingNode.WebGLRenderCmd._layer,s=n-1,o=n|s;r.stencilMask(n),r.stencilFunc(r.EQUAL,o,o)}else r.disable(r.STENCIL_TEST)}})();exports.cc.GridBase=exports.cc.Class.extend({_active:!1,_reuseGrid:0,_gridSize:null,_gridRect:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:!1,_shaderProgram:null,_directorProjection:0,_dirty:!1,ctor:function(t,e,r,n){exports.cc.sys._checkWebGLRenderMode(),this._active=!1,this._reuseGrid=0,this._gridSize=null,this._gridRect=new exports.cc.rect,this._texture=null,this._step=exports.cc.p(0,0),this._grabber=null,this._isTextureFlipped=!1,this._shaderProgram=null,this._directorProjection=0,this._dirty=!1,t!==void 0&&this.initWithSize(t,e,r,n)},isActive:function(){return this._active},setActive:function(t){if(this._active=t,!t){var e=exports.cc.director,r=e.getProjection();e.setProjection(r)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(t){this._reuseGrid=t},getGridSize:function(){return exports.cc.size(this._gridSize.width,this._gridSize.height)},setGridSize:function(t){this._gridSize.width=parseInt(t.width),this._gridSize.height=parseInt(t.height)},setGridRect:function(t){this._gridRect=t},getGridRect:function(){return this._gridRect},getStep:function(){return exports.cc.p(this._step.x,this._step.y)},setStep:function(t){this._step.x=t.x,this._step.y=t.y},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(t){this._isTextureFlipped!==t&&(this._isTextureFlipped=t,this.calculateVertexPoints())},initWithSize:function(t,e,r,n){if(!e){var s=exports.cc.director,o=s.getWinSizeInPixels(),a=exports.cc.NextPOT(o.width),c=exports.cc.NextPOT(o.height),l=new Uint8Array(a*c*4);if(!l)return exports.cc.log("cocos2d: CCGrid: not enough memory."),!1;if(e=new exports.cc.Texture2D,e.initWithData(l,exports.cc.Texture2D.PIXEL_FORMAT_RGBA8888,a,c,o),!e)return exports.cc.log("cocos2d: CCGrid: error creating texture"),!1}if(r=r||!1,this._active=!1,this._reuseGrid=0,this._gridSize=t,this._texture=e,this._isTextureFlipped=r,n===void 0||exports.cc._rectEqualToZero(n)){var h=this._texture.getContentSize();n=new exports.cc.rect(0,0,h.width,h.height)}return this._gridRect=n,this._step.x=this._gridRect.width/t.width,this._step.y=this._gridRect.height/t.height,this._grabber=new exports.cc.Grabber,this._grabber?(this._grabber.grab(this._texture),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURE),this.calculateVertexPoints(),!0):!1},beforeDraw:function(){this._directorProjection=exports.cc.director.getProjection();var t=exports.cc.director.getWinSizeInPixels();gl.viewport(0,0,t.width,t.height),this._grabber.beforeRender(this._texture)},afterDraw:function(t){this._grabber.afterRender(this._texture),exports.cc.director.setViewport(),exports.cc.glBindTexture2D(this._texture),this.beforeBlit(),this.blit(t),this.afterBlit()},beforeBlit:function(){},afterBlit:function(){},blit:function(){exports.cc.log("cc.GridBase.blit(): Shall be overridden in subclass.")},reuse:function(){exports.cc.log("cc.GridBase.reuse(): Shall be overridden in subclass.")},calculateVertexPoints:function(){exports.cc.log("cc.GridBase.calculateVertexPoints(): Shall be overridden in subclass.")},set2DProjection:function(){var t=exports.cc.director.getWinSizeInPixels(),e=exports.cc._renderContext;e.viewport(0,0,t.width,t.height),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_PROJECTION),exports.cc.kmGLLoadIdentity();var r=exports.cc.math.Matrix4.createOrthographicProjection(0,t.width,0,t.height,-1,1);exports.cc.kmGLMultMatrix(r),exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.kmGLLoadIdentity(),exports.cc.setProjectionMatrixDirty()}});exports.cc.GridBase.create=function(t,e,r,n){return new exports.cc.GridBase(t,e,r,n)};exports.cc.Grid3D=exports.cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,_needDepthTestForBlit:!1,_oldDepthTestValue:!1,_oldDepthWriteValue:!1,ctor:function(t,e,r,n){exports.cc.GridBase.prototype.ctor.call(this),this._texCoordinates=null,this._vertices=null,this._originalVertices=null,this._indices=null,this._texCoordinateBuffer=null,this._verticesBuffer=null,this._indicesBuffer=null,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),t!==void 0&&this.initWithSize(t,e,r,n)},vertex:function(t){return this.getVertex(t)},getVertex:function(t){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.Grid3D.vertex() : Numbers must be integers");var e=0|(t.x*(this._gridSize.height+1)+t.y)*3,r=this._vertices;return new exports.cc.Vertex3F(r[e],r[e+1],r[e+2])},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.Grid3D.originalVertex() : Numbers must be integers");var e=0|(t.x*(this._gridSize.height+1)+t.y)*3,r=this._originalVertices;return new exports.cc.Vertex3F(r[e],r[e+1],r[e+2])},setVertex:function(t,e){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.Grid3D.setVertex() : Numbers must be integers");var r=0|(t.x*(this._gridSize.height+1)+t.y)*3,n=this._vertices;n[r]=e.x,n[r+1]=e.y,n[r+2]=e.z,this._dirty=!0},beforeBlit:function(){if(this._needDepthTestForBlit){var t=exports.cc._renderContext;this._oldDepthTestValue=t.isEnabled(t.DEPTH_TEST),this._oldDepthWriteValue=t.getParameter(t.DEPTH_WRITEMASK),t.enable(t.DEPTH_TEST),t.depthMask(!0)}},afterBlit:function(){if(this._needDepthTestForBlit){var t=exports.cc._renderContext;this._oldDepthTestValue?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._oldDepthWriteValue)}},blit:function(t){var e=this._gridSize.width*this._gridSize.height,r=t._renderCmd._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);var n=exports.cc._renderContext,s=this._dirty;n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),n.bindBuffer(n.ARRAY_BUFFER,this._verticesBuffer),s&&n.bufferData(n.ARRAY_BUFFER,this._vertices,n.DYNAMIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this._texCoordinateBuffer),s&&n.bufferData(n.ARRAY_BUFFER,this._texCoordinates,n.DYNAMIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),s&&n.bufferData(n.ELEMENT_ARRAY_BUFFER,this._indices,n.STATIC_DRAW),n.drawElements(n.TRIANGLES,e*6,n.UNSIGNED_SHORT,0),s&&(this._dirty=!1),exports.cc.incrementGLDraws(1)},reuse:function(){if(this._reuseGrid>0){for(var t=this._originalVertices,e=this._vertices,r=0,n=this._vertices.length;r<n;r++)t[r]=e[r];--this._reuseGrid}},calculateVertexPoints:function(){var t=exports.cc._renderContext,e=this._texture.pixelsWidth,r=this._texture.pixelsHeight,n=this._texture.getContentSizeInPixels().height,s=this._gridSize,o=(s.width+1)*(s.height+1);this._vertices=new Float32Array(o*3),this._texCoordinates=new Float32Array(o*2),this._indices=new Uint16Array(s.width*s.height*6),this._verticesBuffer&&t.deleteBuffer(this._verticesBuffer),this._verticesBuffer=t.createBuffer(),this._texCoordinateBuffer&&t.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=t.createBuffer(),this._indicesBuffer&&t.deleteBuffer(this._indicesBuffer),this._indicesBuffer=t.createBuffer();var a,c,l,h=this._indices,u=this._texCoordinates,_=this._isTextureFlipped,d=this._vertices;for(a=0;a<s.width;++a)for(c=0;c<s.height;++c){var f=c*s.width+a,T=a*this._step.x+this._gridRect.x,x=T+this._step.x,m=c*this._step.y+this._gridRect.y,v=m+this._step.y,A=a*(s.height+1)+c,D=(a+1)*(s.height+1)+c,N=(a+1)*(s.height+1)+(c+1),z=a*(s.height+1)+(c+1);h[f*6]=A,h[f*6+1]=D,h[f*6+2]=z,h[f*6+3]=D,h[f*6+4]=N,h[f*6+5]=z;var M=[A*3,D*3,N*3,z*3],J={x:T,y:m,z:0},U={x,y:m,z:0},K={x,y:v,z:0},tt={x:T,y:v,z:0},rt=[J,U,K,tt],I=[A*2,D*2,N*2,z*2],L=[exports.cc.p(T,m),exports.cc.p(x,m),exports.cc.p(x,v),exports.cc.p(T,v)];for(l=0;l<4;++l)d[M[l]]=rt[l].x,d[M[l]+1]=rt[l].y,d[M[l]+2]=rt[l].z,u[I[l]]=L[l].x/e,_?u[I[l]+1]=(n-L[l].y)/r:u[I[l]+1]=L[l].y/r}this._originalVertices=new Float32Array(this._vertices),t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),this._dirty=!0},setNeedDepthTestForBlit:function(t){this._needDepthTestForBlit=t},getNeedDepthTestForBlit:function(){return this._needDepthTestForBlit}});exports.cc.Grid3D.create=function(t,e,r){return new exports.cc.Grid3D(t,e,r)};exports.cc.TiledGrid3D=exports.cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(t,e,r,n){exports.cc.GridBase.prototype.ctor.call(this),this._texCoordinates=null,this._vertices=null,this._originalVertices=null,this._indices=null,this._texCoordinateBuffer=null,this._verticesBuffer=null,this._indicesBuffer=null,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),t!==void 0&&this.initWithSize(t,e,r,n)},tile:function(t){return this.getTile(t)},getTile:function(t){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.TiledGrid3D.tile() : Numbers must be integers");var e=(this._gridSize.height*t.x+t.y)*4*3,r=this._vertices;return new exports.cc.Quad3(new exports.cc.Vertex3F(r[e],r[e+1],r[e+2]),new exports.cc.Vertex3F(r[e+3],r[e+4],r[e+5]),new exports.cc.Vertex3F(r[e+6],r[e+7],r[e+8]),new exports.cc.Vertex3F(r[e+9],r[e+10],r[e+11]))},getOriginalTile:function(t){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.TiledGrid3D.originalTile() : Numbers must be integers");var e=(this._gridSize.height*t.x+t.y)*4*3,r=this._originalVertices;return new exports.cc.Quad3(new exports.cc.Vertex3F(r[e],r[e+1],r[e+2]),new exports.cc.Vertex3F(r[e+3],r[e+4],r[e+5]),new exports.cc.Vertex3F(r[e+6],r[e+7],r[e+8]),new exports.cc.Vertex3F(r[e+9],r[e+10],r[e+11]))},originalTile:function(t){return this.getOriginalTile(t)},setTile:function(t,e){(t.x!==(0|t.x)||t.y!==(0|t.y))&&exports.cc.log("cc.TiledGrid3D.setTile() : Numbers must be integers");var r=(this._gridSize.height*t.x+t.y)*12,n=this._vertices;n[r]=e.bl.x,n[r+1]=e.bl.y,n[r+2]=e.bl.z,n[r+3]=e.br.x,n[r+4]=e.br.y,n[r+5]=e.br.z,n[r+6]=e.tl.x,n[r+7]=e.tl.y,n[r+8]=e.tl.z,n[r+9]=e.tr.x,n[r+10]=e.tr.y,n[r+11]=e.tr.z,this._dirty=!0},blit:function(t){var e=this._gridSize.width*this._gridSize.height,r=t._renderCmd._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);var n=exports.cc._renderContext,s=this._dirty;n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),n.bindBuffer(n.ARRAY_BUFFER,this._verticesBuffer),s&&n.bufferData(n.ARRAY_BUFFER,this._vertices,n.DYNAMIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,0,this._vertices),n.bindBuffer(n.ARRAY_BUFFER,this._texCoordinateBuffer),s&&n.bufferData(n.ARRAY_BUFFER,this._texCoordinates,n.DYNAMIC_DRAW),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,0,this._texCoordinates),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),s&&n.bufferData(n.ELEMENT_ARRAY_BUFFER,this._indices,n.STATIC_DRAW),n.drawElements(n.TRIANGLES,e*6,n.UNSIGNED_SHORT,0),s&&(this._dirty=!1),exports.cc.incrementGLDraws(1)},reuse:function(){if(this._reuseGrid>0){for(var t=this._vertices,e=this._originalVertices,r=0;r<t.length;r++)e[r]=t[r];--this._reuseGrid}},calculateVertexPoints:function(){var t=this._texture.pixelsWidth,e=this._texture.pixelsHeight,r=this._texture.getContentSizeInPixels().height,n=this._gridSize,s=n.width*n.height;this._vertices=new Float32Array(s*12),this._texCoordinates=new Float32Array(s*8),this._indices=new Uint16Array(s*6);var o=exports.cc._renderContext;this._verticesBuffer&&o.deleteBuffer(this._verticesBuffer),this._verticesBuffer=o.createBuffer(),this._texCoordinateBuffer&&o.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=o.createBuffer(),this._indicesBuffer&&o.deleteBuffer(this._indicesBuffer),this._indicesBuffer=o.createBuffer();var a,c,l=0,h=this._step,u=this._vertices,_=this._texCoordinates,d=this._isTextureFlipped;for(a=0;a<n.width;a++)for(c=0;c<n.height;c++){var f=a*h.x,T=f+h.x,x=c*h.y,m=x+h.y;u[l*12]=f,u[l*12+1]=x,u[l*12+2]=0,u[l*12+3]=T,u[l*12+4]=x,u[l*12+5]=0,u[l*12+6]=f,u[l*12+7]=m,u[l*12+8]=0,u[l*12+9]=T,u[l*12+10]=m,u[l*12+11]=0;var v=x,A=m;d&&(v=r-x,A=r-m),_[l*8]=f/t,_[l*8+1]=v/e,_[l*8+2]=T/t,_[l*8+3]=v/e,_[l*8+4]=f/t,_[l*8+5]=A/e,_[l*8+6]=T/t,_[l*8+7]=A/e,l++}var D=this._indices;for(a=0;a<s;a++)D[a*6+0]=a*4+0,D[a*6+1]=a*4+1,D[a*6+2]=a*4+2,D[a*6+3]=a*4+1,D[a*6+4]=a*4+2,D[a*6+5]=a*4+3;this._originalVertices=new Float32Array(this._vertices),o.bindBuffer(o.ARRAY_BUFFER,this._verticesBuffer),o.bufferData(o.ARRAY_BUFFER,this._vertices,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordinateBuffer),o.bufferData(o.ARRAY_BUFFER,this._texCoordinates,o.DYNAMIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,this._indices,o.DYNAMIC_DRAW),this._dirty=!0}});exports.cc.TiledGrid3D.create=function(t,e,r){return new exports.cc.TiledGrid3D(t,e,r)};exports.cc.Grabber=exports.cc.Class.extend({_FBO:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){exports.cc.sys._checkWebGLRenderMode(),this._gl=exports.cc._renderContext,this._oldClearColor=[0,0,0,0],this._oldFBO=null,this._FBO=this._gl.createFramebuffer()},grab:function(t){var e=this._gl;this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._FBO),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._webTextureObj,0);var r=e.checkFramebufferStatus(e.FRAMEBUFFER);r!==e.FRAMEBUFFER_COMPLETE&&exports.cc.log("Frame Grabber: could not attach texture to frmaebuffer"),e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO)},beforeRender:function(t){var e=this._gl;this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._FBO),this._oldClearColor=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},afterRender:function(t){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),e.colorMask(!0,!0,!0,!0)},destroy:function(){this._gl.deleteFramebuffer(this._FBO)}});exports.cc.GridAction=exports.cc.ActionInterval.extend({_gridSize:null,_gridNodeTarget:null,ctor:function(t,e){exports.cc.sys._checkWebGLRenderMode(),exports.cc.ActionInterval.prototype.ctor.call(this),this._gridSize=exports.cc.size(0,0),e&&this.initWithDuration(t,e)},_cacheTargetAsGridNode:function(t){this._gridNodeTarget=t},clone:function(){var t=new exports.cc.GridAction,e=this._gridSize;return t.initWithDuration(this._duration,exports.cc.size(e.width,e.height)),t},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),exports.cc.renderer.childrenOrderDirty=!0,this._cacheTargetAsGridNode(t);var e=this.getGrid(),r=this._gridNodeTarget.getGrid();if(r&&r.getReuseGrid()>0){var n=r.getGridSize();r.isActive()&&n.width===this._gridSize.width&&n.height===this._gridSize.height&&r.reuse()}else r&&r.isActive()&&r.setActive(!1),this._gridNodeTarget.setGrid(e),this._gridNodeTarget.getGrid().setActive(!0)},reverse:function(){return new exports.cc.ReverseTime(this)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._gridSize.width=e.width,this._gridSize.height=e.height,!0):!1},getGrid:function(){exports.cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}});exports.cc.gridAction=function(t,e){return new exports.cc.GridAction(t,e)};exports.cc.GridAction.create=exports.cc.gridAction;exports.cc.Grid3DAction=exports.cc.GridAction.extend({getGrid:function(){return new exports.cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())},getGridRect:function(){return this._gridNodeTarget.getGridRect()},vertex:function(t){return this.getVertex(t)},getVertex:function(t){return this.target.grid.getVertex(t)},originalVertex:function(t){return this.getOriginalVertex(t)},getOriginalVertex:function(t){return this.target.grid.originalVertex(t)},setVertex:function(t,e){this.target.grid.setVertex(t,e)}});exports.cc.grid3DAction=function(t,e){return new exports.cc.Grid3DAction(t,e)};exports.cc.Grid3DAction.create=exports.cc.grid3DAction;exports.cc.TiledGrid3DAction=exports.cc.GridAction.extend({tile:function(t){return this.getTile(t)},getTile:function(t){return this.target.grid.tile(t)},originalTile:function(t){return this.getOriginalTile(t)},getOriginalTile:function(t){return this.target.grid.originalTile(t)},setTile:function(t,e){this.target.grid.setTile(t,e)},getGrid:function(){return new exports.cc.TiledGrid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())}});exports.cc.tiledGrid3DAction=function(t,e){return new exports.cc.TiledGrid3DAction(t,e)};exports.cc.TiledGrid3DAction.create=exports.cc.tiledGrid3DAction;exports.cc.StopGrid=exports.cc.ActionInstant.extend({startWithTarget:function(t){exports.cc.ActionInstant.prototype.startWithTarget.call(this,t),exports.cc.renderer.childrenOrderDirty=!0;var e=this.target.grid;e&&e.isActive()&&e.setActive(!1)}});exports.cc.stopGrid=function(){return new exports.cc.StopGrid};exports.cc.StopGrid.create=exports.cc.stopGrid;exports.cc.ReuseGrid=exports.cc.ActionInstant.extend({_times:null,ctor:function(t){exports.cc.ActionInstant.prototype.ctor.call(this),t!==void 0&&this.initWithTimes(t)},initWithTimes:function(t){return this._times=t,!0},startWithTarget:function(t){exports.cc.ActionInstant.prototype.startWithTarget.call(this,t),exports.cc.renderer.childrenOrderDirty=!0,this.target.grid&&this.target.grid.isActive()&&this.target.grid.setReuseGrid(this.target.grid.getReuseGrid()+this._times)}});exports.cc.reuseGrid=function(t){return new exports.cc.ReuseGrid(t)};exports.cc.ReuseGrid.create=exports.cc.reuseGrid;exports.cc.Waves3D=exports.cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=r,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._gridSize,r=this._amplitude,n=exports.cc.p(0,0),s=this._amplitudeRate,o=this._waves,a=0;a<e.width+1;++a)for(var c=0;c<e.height+1;++c){n.x=a,n.y=c;var l=this.originalVertex(n);l.z+=Math.sin(Math.PI*t*o*2+(l.y+l.x)*.01)*r*s,this.setVertex(n,l)}}});exports.cc.waves3D=function(t,e,r,n){return new exports.cc.Waves3D(t,e,r,n)};exports.cc.Waves3D.create=exports.cc.waves3D;exports.cc.FlipX3D=exports.cc.Grid3DAction.extend({ctor:function(t){t!==void 0?exports.cc.GridAction.prototype.ctor.call(this,t,exports.cc.size(1,1)):exports.cc.GridAction.prototype.ctor.call(this)},initWithDuration:function(t){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,exports.cc.size(1,1))},initWithSize:function(t,e){return t.width!==1||t.height!==1?(exports.cc.log("Grid size must be (1,1)"),!1):exports.cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)},update:function(t){var e=Math.PI*t,r=Math.sin(e);e=e/2;var n=Math.cos(e),s=new exports.cc.Vertex3F,o=exports.cc.p(0,0);o.x=o.y=1;var a=this.originalVertex(o);o.x=o.y=0;var c=this.originalVertex(o),l=a.x,h=c.x,u,_,d,f,T;l>h?(_=exports.cc.p(0,0),d=exports.cc.p(0,1),f=exports.cc.p(1,0),T=exports.cc.p(1,1),u=l):(f=exports.cc.p(0,0),T=exports.cc.p(0,1),_=exports.cc.p(1,0),d=exports.cc.p(1,1),u=h),s.x=u-u*n,s.z=Math.abs(parseFloat(u*r/4));var x=this.originalVertex(_);x.x=s.x,x.z+=s.z,this.setVertex(_,x),x=this.originalVertex(d),x.x=s.x,x.z+=s.z,this.setVertex(d,x),x=this.originalVertex(f),x.x-=s.x,x.z-=s.z,this.setVertex(f,x),x=this.originalVertex(T),x.x-=s.x,x.z-=s.z,this.setVertex(T,x)}});exports.cc.flipX3D=function(t){return new exports.cc.FlipX3D(t)};exports.cc.FlipX3D.create=exports.cc.flipX3D;exports.cc.FlipY3D=exports.cc.FlipX3D.extend({ctor:function(t){t!==void 0?exports.cc.GridAction.prototype.ctor.call(this,t,exports.cc.size(1,1)):exports.cc.GridAction.prototype.ctor.call(this)},update:function(t){var e=Math.PI*t,r=Math.sin(e);e=e/2;var n=Math.cos(e),s=new exports.cc.Vertex3F,o=exports.cc.p(0,0);o.x=o.y=1;var a=this.originalVertex(o);o.x=o.y=0;var c=this.originalVertex(o),l=a.y,h=c.y,u,_,d,f,T;l>h?(_=exports.cc.p(0,0),d=exports.cc.p(0,1),f=exports.cc.p(1,0),T=exports.cc.p(1,1),u=l):(d=exports.cc.p(0,0),_=exports.cc.p(0,1),T=exports.cc.p(1,0),f=exports.cc.p(1,1),u=h),s.y=u-u*n,s.z=Math.abs(parseFloat(u*r)/4);var x=this.originalVertex(_);x.y=s.y,x.z+=s.z,this.setVertex(_,x),x=this.originalVertex(d),x.y-=s.y,x.z-=s.z,this.setVertex(d,x),x=this.originalVertex(f),x.y=s.y,x.z+=s.z,this.setVertex(f,x),x=this.originalVertex(T),x.y-=s.y,x.z-=s.z,this.setVertex(T,x)}});exports.cc.flipY3D=function(t){return new exports.cc.FlipY3D(t)};exports.cc.FlipY3D.create=exports.cc.flipY3D;exports.cc.Lens3D=exports.cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:!1,_dirty:!1,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),this._position=exports.cc.p(0,0),n!==void 0&&this.initWithDuration(t,e,r,n)},getLensEffect:function(){return this._lensEffect},setLensEffect:function(t){this._lensEffect=t},setConcave:function(t){this._concave=t},getPosition:function(){return this._position},setPosition:function(t){exports.cc.pointEqualToPoint(t,this._position)||(this._position.x=t.x,this._position.y=t.y,this._dirty=!0)},initWithDuration:function(t,e,r,n){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(r),this._radius=n,this._lensEffect=.7,this._dirty=!0,!0):!1},update:function(t){if(this._dirty){for(var e=this._gridSize.width,r=this._gridSize.height,n=this._radius,s=this._lensEffect,o=exports.cc.p(0,0),a=exports.cc.p(0,0),c,l,h,u,_,d=0;d<e+1;++d)for(var f=0;f<r+1;++f)o.x=d,o.y=f,c=this.originalVertex(o),a.x=this._position.x-c.x,a.y=this._position.y-c.y,l=exports.cc.pLength(a),l<n&&(l=n-l,_=l/n,_===0&&(_=.001),h=Math.log(_)*s,u=Math.exp(h)*n,l=exports.cc.pLength(a),l>0&&(a.x=a.x/l,a.y=a.y/l,a.x=a.x*u,a.y=a.y*u,c.z+=exports.cc.pLength(a)*s)),this.setVertex(o,c);this._dirty=!1}}});exports.cc.lens3D=function(t,e,r,n){return new exports.cc.Lens3D(t,e,r,n)};exports.cc.Lens3D.create=exports.cc.lens3D;exports.cc.Ripple3D=exports.cc.Grid3DAction.extend({_position:null,_radius:0,_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n,s,o){exports.cc.GridAction.prototype.ctor.call(this),this._position=exports.cc.p(0,0),o!==void 0&&this.initWithDuration(t,e,r,n,s,o)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x,this._position.y=t.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n,s,o){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(r),this._radius=n,this._waves=s,this._amplitude=o,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._gridSize.width,r=this._gridSize.height,n=exports.cc.p(0,0),s=this._radius,o=this._waves,a=this._amplitude,c=this._amplitudeRate,l,h,u=exports.cc.p(0,0),_=0;_<e+1;++_)for(var d=0;d<r+1;++d){if(n.x=_,n.y=d,l=this.originalVertex(n),u.x=this._position.x-l.x,u.y=this._position.y-l.y,h=exports.cc.pLength(u),h<s){h=s-h;var f=Math.pow(h/s,2);l.z+=Math.sin(t*Math.PI*o*2+h*.1)*a*c*f}this.setVertex(n,l)}}});exports.cc.ripple3D=function(t,e,r,n,s,o){return new exports.cc.Ripple3D(t,e,r,n,s,o)};exports.cc.Ripple3D.create=exports.cc.ripple3D;exports.cc.Shaky3D=exports.cc.Grid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._randRange=r,this._shakeZ=n,!0):!1},update:function(t){for(var e=this._gridSize.width,r=this._gridSize.height,n=this._randRange,s=this._shakeZ,o=exports.cc.p(0,0),a,c=0;c<e+1;++c)for(var l=0;l<r+1;++l)o.x=c,o.y=l,a=this.originalVertex(o),a.x+=exports.cc.rand()%(n*2)-n,a.y+=exports.cc.rand()%(n*2)-n,s&&(a.z+=exports.cc.rand()%(n*2)-n),this.setVertex(o,a)}});exports.cc.shaky3D=function(t,e,r,n){return new exports.cc.Shaky3D(t,e,r,n)};exports.cc.Shaky3D.create=exports.cc.shaky3D;exports.cc.Liquid=exports.cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=r,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._gridSize.width,r=this._gridSize.height,n=exports.cc.p(0,0),s=this._waves,o=this._amplitude,a=this._amplitudeRate,c,l=1;l<e;++l)for(var h=1;h<r;++h)n.x=l,n.y=h,c=this.originalVertex(n),c.x=c.x+Math.sin(t*Math.PI*s*2+c.x*.01)*o*a,c.y=c.y+Math.sin(t*Math.PI*s*2+c.y*.01)*o*a,this.setVertex(n,c)}});exports.cc.liquid=function(t,e,r,n){return new exports.cc.Liquid(t,e,r,n)};exports.cc.Liquid.create=exports.cc.liquid;exports.cc.Waves=exports.cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,_vertical:!1,_horizontal:!1,ctor:function(t,e,r,n,s,o){exports.cc.GridAction.prototype.ctor.call(this),o!==void 0&&this.initWithDuration(t,e,r,n,s,o)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n,s,o){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=r,this._amplitude=n,this._amplitudeRate=1,this._horizontal=s,this._vertical=o,!0):!1},update:function(t){for(var e=this._gridSize.width,r=this._gridSize.height,n=exports.cc.p(0,0),s=this._vertical,o=this._horizontal,a=this._waves,c=this._amplitude,l=this._amplitudeRate,h,u=0;u<e+1;++u)for(var _=0;_<r+1;++_)n.x=u,n.y=_,h=this.originalVertex(n),s&&(h.x=h.x+Math.sin(t*Math.PI*a*2+h.y*.01)*c*l),o&&(h.y=h.y+Math.sin(t*Math.PI*a*2+h.x*.01)*c*l),this.setVertex(n,h)}});exports.cc.waves=function(t,e,r,n,s,o){return new exports.cc.Waves(t,e,r,n,s,o)};exports.cc.Waves.create=exports.cc.waves;exports.cc.Twirl=exports.cc.Grid3DAction.extend({_position:null,_twirls:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n,s){exports.cc.GridAction.prototype.ctor.call(this),this._position=exports.cc.p(0,0),s!==void 0&&this.initWithDuration(t,e,r,n,s)},getPosition:function(){return this._position},setPosition:function(t){this._position.x=t.x,this._position.y=t.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n,s){return exports.cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)?(this.setPosition(r),this._twirls=n,this._amplitude=s,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._position,r=this._gridSize.width,n=this._gridSize.height,s=exports.cc.p(0,0),o=.1*this._amplitude*this._amplitudeRate,a=this._twirls,c,l,h,u,_=exports.cc.p(0,0),d=0;d<r+1;++d)for(var f=0;f<n+1;++f)s.x=d,s.y=f,c=this.originalVertex(s),_.x=d-r/2,_.y=f-n/2,l=exports.cc.pLength(_)*Math.cos(Math.PI/2+t*Math.PI*a*2)*o,h=Math.sin(l)*(c.y-e.y)+Math.cos(l)*(c.x-e.x),u=Math.cos(l)*(c.y-e.y)-Math.sin(l)*(c.x-e.x),c.x=e.x+h,c.y=e.y+u,this.setVertex(s,c)}});exports.cc.twirl=function(t,e,r,n,s){return new exports.cc.Twirl(t,e,r,n,s)};exports.cc.Twirl.create=exports.cc.twirl;exports.cc.ShakyTiles3D=exports.cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._randRange=r,this._shakeZ=n,!0):!1},update:function(t){for(var e=this._gridSize,r=this._randRange,n=exports.cc.p(0,0),s=0;s<e.width;++s)for(var o=0;o<e.height;++o){n.x=s,n.y=o;var a=this.originalTile(n);a.bl.x+=exports.cc.rand()%(r*2)-r,a.br.x+=exports.cc.rand()%(r*2)-r,a.tl.x+=exports.cc.rand()%(r*2)-r,a.tr.x+=exports.cc.rand()%(r*2)-r,a.bl.y+=exports.cc.rand()%(r*2)-r,a.br.y+=exports.cc.rand()%(r*2)-r,a.tl.y+=exports.cc.rand()%(r*2)-r,a.tr.y+=exports.cc.rand()%(r*2)-r,this._shakeZ&&(a.bl.z+=exports.cc.rand()%(r*2)-r,a.br.z+=exports.cc.rand()%(r*2)-r,a.tl.z+=exports.cc.rand()%(r*2)-r,a.tr.z+=exports.cc.rand()%(r*2)-r),this.setTile(n,a)}}});exports.cc.shakyTiles3D=function(t,e,r,n){return new exports.cc.ShakyTiles3D(t,e,r,n)};exports.cc.ShakyTiles3D.create=exports.cc.shakyTiles3D;exports.cc.ShatteredTiles3D=exports.cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},initWithDuration:function(t,e,r,n){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._once=!1,this._randRange=r,this._shatterZ=n,!0):!1},update:function(t){if(this._once===!1){for(var e=this._gridSize,r=this._randRange,n,s=exports.cc.p(0,0),o=0;o<e.width;++o)for(var a=0;a<e.height;++a)s.x=o,s.y=a,n=this.originalTile(s),n.bl.x+=exports.cc.rand()%(r*2)-r,n.br.x+=exports.cc.rand()%(r*2)-r,n.tl.x+=exports.cc.rand()%(r*2)-r,n.tr.x+=exports.cc.rand()%(r*2)-r,n.bl.y+=exports.cc.rand()%(r*2)-r,n.br.y+=exports.cc.rand()%(r*2)-r,n.tl.y+=exports.cc.rand()%(r*2)-r,n.tr.y+=exports.cc.rand()%(r*2)-r,this._shatterZ&&(n.bl.z+=exports.cc.rand()%(r*2)-r,n.br.z+=exports.cc.rand()%(r*2)-r,n.tl.z+=exports.cc.rand()%(r*2)-r,n.tr.z+=exports.cc.rand()%(r*2)-r),this.setTile(s,n);this._once=!0}}});exports.cc.shatteredTiles3D=function(t,e,r,n){return new exports.cc.ShatteredTiles3D(t,e,r,n)};exports.cc.ShatteredTiles3D.create=exports.cc.shatteredTiles3D;exports.cc.Tile=function(t,e,r){this.position=t||exports.cc.p(0,0),this.startPosition=e||exports.cc.p(0,0),this.delta=r||exports.cc.p(0,0)};exports.cc.ShuffleTiles=exports.cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(t,e,r){exports.cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],this._tiles=[],r!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._seed=r,this._tilesOrder.length=0,this._tiles.length=0,!0):!1},shuffle:function(t,e){for(var r=e-1;r>=0;r--){var n=0|exports.cc.rand()%(r+1),s=t[r];t[r]=t[n],t[n]=s}},getDelta:function(t){var e=this._gridSize,r=t.width*e.height+t.height;return exports.cc.size(this._tilesOrder[r]/e.height-t.width,this._tilesOrder[r]%e.height-t.height)},placeTile:function(t,e){var r=this.originalTile(t),n=this.target.grid.getStep(),s=e.position;r.bl.x+=s.x*n.x,r.bl.y+=s.y*n.y,r.br.x+=s.x*n.x,r.br.y+=s.y*n.y,r.tl.x+=s.x*n.x,r.tl.y+=s.y*n.y,r.tr.x+=s.x*n.x,r.tr.y+=s.y*n.y,this.setTile(t,r)},startWithTarget:function(t){exports.cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t);var e=this._gridSize;this._tilesCount=e.width*e.height;var r=this._tilesOrder;r.length=0;for(var n=0;n<this._tilesCount;++n)r[n]=n;this.shuffle(r,this._tilesCount);var s=this._tiles;s.length=0;for(var o=0,a=exports.cc.size(0,0),c=0;c<e.width;++c)for(var l=0;l<e.height;++l)s[o]=new exports.cc.Tile,s[o].position=exports.cc.p(c,l),s[o].startPosition=exports.cc.p(c,l),a.width=c,a.height=l,s[o].delta=this.getDelta(a),++o},update:function(t){for(var e=0,r=this._gridSize,n=this._tiles,s,o=exports.cc.p(0,0),a=0;a<r.width;++a)for(var c=0;c<r.height;++c)o.x=a,o.y=c,s=n[e],s.position.x=s.delta.width*t,s.position.y=s.delta.height*t,this.placeTile(o,s),++e}});exports.cc.shuffleTiles=function(t,e,r){return new exports.cc.ShuffleTiles(t,e,r)};exports.cc.ShuffleTiles.create=exports.cc.shuffleTiles;exports.cc.FadeOutTRTiles=exports.cc.TiledGrid3DAction.extend({testFunc:function(t,e){var r=this._gridSize.width*e,n=this._gridSize.height*e;return r===this._gridSize.width&&n===this._gridSize.height?0:r+n===0?1:Math.pow((t.x+t.y)/(r+n),6)},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new exports.cc.Quad3)},transformTile:function(t,e){var r=this.originalTile(t),n=this.target.grid.getStep();r.bl.x+=n.x/2*(1-e),r.bl.y+=n.y/2*(1-e),r.br.x-=n.x/2*(1-e),r.br.y+=n.y/2*(1-e),r.tl.x+=n.x/2*(1-e),r.tl.y-=n.y/2*(1-e),r.tr.x-=n.x/2*(1-e),r.tr.y-=n.y/2*(1-e),this.setTile(t,r)},update:function(t){for(var e=this._gridSize,r=exports.cc.p(0,0),n,s=0;s<e.width;++s)for(var o=0;o<e.height;++o)r.x=s,r.y=o,n=this.testFunc(r,t),n===0?this.turnOffTile(r):n<1?this.transformTile(r,n):this.turnOnTile(r)}});exports.cc.fadeOutTRTiles=function(t,e){return new exports.cc.FadeOutTRTiles(t,e)};exports.cc.FadeOutTRTiles.create=exports.cc.fadeOutTRTiles;exports.cc.FadeOutBLTiles=exports.cc.FadeOutTRTiles.extend({testFunc:function(t,e){var r=this._gridSize.width*(1-e),n=this._gridSize.height*(1-e);return r+n===0?0:t.x+t.y===0?1:Math.pow((r+n)/(t.x+t.y),6)}});exports.cc.fadeOutBLTiles=function(t,e){return new exports.cc.FadeOutBLTiles(t,e)};exports.cc.FadeOutBLTiles.create=exports.cc.fadeOutBLTiles;exports.cc.FadeOutUpTiles=exports.cc.FadeOutTRTiles.extend({testFunc:function(t,e){var r=this._gridSize.height*e;return r===this._gridSize.height?0:r===0?1:Math.pow(t.y/r,6)},transformTile:function(t,e){var r=this.originalTile(t),n=this.target.grid.getStep();r.bl.y+=n.y/2*(1-e),r.br.y+=n.y/2*(1-e),r.tl.y-=n.y/2*(1-e),r.tr.y-=n.y/2*(1-e),this.setTile(t,r)}});exports.cc.fadeOutUpTiles=function(t,e){return new exports.cc.FadeOutUpTiles(t,e)};exports.cc.FadeOutUpTiles.create=exports.cc.fadeOutUpTiles;exports.cc.FadeOutDownTiles=exports.cc.FadeOutUpTiles.extend({testFunc:function(t,e){var r=this._gridSize.height*(1-e);return r===0?0:t.y===0?1:Math.pow(r/t.y,6)}});exports.cc.fadeOutDownTiles=function(t,e){return new exports.cc.FadeOutDownTiles(t,e)};exports.cc.FadeOutDownTiles.create=exports.cc.fadeOutDownTiles;exports.cc.TurnOffTiles=exports.cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(t,e,r){exports.cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],e!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._seed=r||0,this._tilesOrder.length=0,!0):!1},shuffle:function(t,e){for(var r=e-1;r>=0;r--){var n=0|exports.cc.rand()%(r+1),s=t[r];t[r]=t[n],t[n]=s}},turnOnTile:function(t){this.setTile(t,this.originalTile(t))},turnOffTile:function(t){this.setTile(t,new exports.cc.Quad3)},startWithTarget:function(t){exports.cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._tilesCount=this._gridSize.width*this._gridSize.height;var e=this._tilesOrder;e.length=0;for(var r=0;r<this._tilesCount;++r)e[r]=r;this.shuffle(e,this._tilesCount)},update:function(t){for(var e=0|t*this._tilesCount,r=this._gridSize,n,s=exports.cc.p(0,0),o=this._tilesOrder,a=0;a<this._tilesCount;a++)n=o[a],s.x=0|n/r.height,s.y=n%(0|r.height),a<e?this.turnOffTile(s):this.turnOnTile(s)}});exports.cc.turnOffTiles=function(t,e,r){return new exports.cc.TurnOffTiles(t,e,r)};exports.cc.TurnOffTiles.create=exports.cc.turnOffTiles;exports.cc.WavesTiles3D=exports.cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._waves=r,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=this._gridSize,r=this._waves,n=this._amplitude,s=this._amplitudeRate,o=exports.cc.p(0,0),a,c=0;c<e.width;c++)for(var l=0;l<e.height;l++)o.x=c,o.y=l,a=this.originalTile(o),a.bl.z=Math.sin(t*Math.PI*r*2+(a.bl.y+a.bl.x)*.01)*n*s,a.br.z=a.bl.z,a.tl.z=a.bl.z,a.tr.z=a.bl.z,this.setTile(o,a)}});exports.cc.wavesTiles3D=function(t,e,r,n){return new exports.cc.WavesTiles3D(t,e,r,n)};exports.cc.WavesTiles3D.create=exports.cc.wavesTiles3D;exports.cc.JumpTiles3D=exports.cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(t,e,r,n){exports.cc.GridAction.prototype.ctor.call(this),n!==void 0&&this.initWithDuration(t,e,r,n)},getAmplitude:function(){return this._amplitude},setAmplitude:function(t){this._amplitude=t},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(t){this._amplitudeRate=t},initWithDuration:function(t,e,r,n){return exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,e)?(this._jumps=r,this._amplitude=n,this._amplitudeRate=1,!0):!1},update:function(t){for(var e=Math.sin(Math.PI*t*this._jumps*2)*this._amplitude*this._amplitudeRate,r=Math.sin(Math.PI*(t*this._jumps*2+1))*this._amplitude*this._amplitudeRate,n=this._gridSize,s=this.target.grid,o,a=exports.cc.p(0,0),c=0;c<n.width;c++)for(var l=0;l<n.height;l++)a.x=c,a.y=l,o=s.originalTile(a),(c+l)%2===0?(o.bl.z+=e,o.br.z+=e,o.tl.z+=e,o.tr.z+=e):(o.bl.z+=r,o.br.z+=r,o.tl.z+=r,o.tr.z+=r),s.setTile(a,o)}});exports.cc.jumpTiles3D=function(t,e,r,n){return new exports.cc.JumpTiles3D(t,e,r,n)};exports.cc.JumpTiles3D.create=exports.cc.jumpTiles3D;exports.cc.SplitRows=exports.cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(t,e){exports.cc.GridAction.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return this._rows=e,exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,exports.cc.size(1,e))},update:function(t){for(var e=this._gridSize,r=this._winSize.width,n,s,o=exports.cc.p(0,0),a=0;a<e.height;++a)o.y=a,n=this.originalTile(o),s=1,a%2===0&&(s=-1),n.bl.x+=s*r*t,n.br.x+=s*r*t,n.tl.x+=s*r*t,n.tr.x+=s*r*t,this.setTile(o,n)},startWithTarget:function(t){exports.cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._winSize=exports.cc.director.getWinSizeInPixels()}});exports.cc.splitRows=function(t,e){return new exports.cc.SplitRows(t,e)};exports.cc.SplitRows.create=exports.cc.splitRows;exports.cc.SplitCols=exports.cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(t,e){exports.cc.GridAction.prototype.ctor.call(this),e!==void 0&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return this._cols=e,exports.cc.TiledGrid3DAction.prototype.initWithDuration.call(this,t,exports.cc.size(e,1))},update:function(t){for(var e=this._gridSize.width,r=this._winSize.height,n,s,o=exports.cc.p(0,0),a=0;a<e;++a)o.x=a,n=this.originalTile(o),s=1,a%2===0&&(s=-1),n.bl.y+=s*r*t,n.br.y+=s*r*t,n.tl.y+=s*r*t,n.tr.y+=s*r*t,this.setTile(o,n);exports.cc.renderer.childrenOrderDirty=!0},startWithTarget:function(t){exports.cc.TiledGrid3DAction.prototype.startWithTarget.call(this,t),this._winSize=exports.cc.director.getWinSizeInPixels()}});exports.cc.splitCols=function(t,e){return new exports.cc.SplitCols(t,e)};exports.cc.SplitCols.create=exports.cc.splitCols;exports.cc.PageTurn3D=exports.cc.Grid3DAction.extend({getGrid:function(){var t=new exports.cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect());return t.setNeedDepthTestForBlit(!0),t},clone:function(){var t=new exports.cc.PageTurn3D;return t.initWithDuration(this._duration,this._gridSize),t},update:function(t){for(var e=Math.max(0,t-.25),r=e*e*500,n=-100-r,s=Math.sqrt(t),o=s>.5?Math.PI/2*s:Math.PI/2*(1-s),a=(2-t)*Math.PI,c=Math.sin(o),l=Math.cos(o),h=this._gridSize,u=exports.cc.p(0,0),_=0;_<=h.width;++_)for(var d=0;d<=h.height;++d){u.x=_,u.y=d;var f=this.getOriginalVertex(u);f.x-=this.getGridRect().x;var T=Math.sqrt(f.x*f.x+(f.y-n)*(f.y-n)),x=T*c,m=Math.asin(f.x/T),v=m/c,A=Math.cos(v);v<=Math.PI?f.x=x*Math.sin(v):f.x=0,f.y=T+n-x*(1-A)*c,f.z=x*(1-A)*l,f.x=f.z*Math.sin(a)+f.x*Math.cos(a),f.z=f.z*Math.cos(a)-f.x*Math.cos(a),f.z/=7,f.z<.5&&(f.z=.5),f.x+=this.getGridRect().x,this.setVertex(u,f)}}});exports.cc.pageTurn3D=function(t,e){return new exports.cc.PageTurn3D(t,e)};exports.cc.PageTurn3D.create=exports.cc.pageTurn3D;exports.cc.ProgressTimer=exports.cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){exports.cc.Node.prototype.ctor.call(this),this._type=exports.cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=exports.cc.p(0,0),this._barChangeRate=exports.cc.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},onEnter:function(){this._super(),exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},cleanup:function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData(),this._super()},getMidpoint:function(){return exports.cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=exports.cc.pClamp(t,exports.cc.p(0,0),exports.cc.p(1,1))},getBarChangeRate:function(){return exports.cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=exports.cc.pClamp(t,exports.cc.p(0,0),exports.cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=exports.cc.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},setSprite:function(t){this._sprite!==t&&(this._sprite=t,t?(this.setContentSize(t.width,t.height),t.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.resetVertexData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=exports.cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=exports.cc.p(.5,.5),this.barChangeRate=exports.cc.p(1,1),this.setSprite(t),this._renderCmd.resetVertexData(),!0},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ProgressTimer.CanvasRenderCmd(this):new exports.cc.ProgressTimer.WebGLRenderCmd(this)}});var _p=exports.cc.ProgressTimer.prototype;_p.midPoint;exports.cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint);_p.barChangeRate;exports.cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate);_p.type;exports.cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);_p.percentage;exports.cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);_p.sprite;exports.cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite);_p.reverseDir;exports.cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection);exports.cc.ProgressTimer.create=function(t){return new exports.cc.ProgressTimer(t)};exports.cc.ProgressTimer.TEXTURE_COORDS_COUNT=4;exports.cc.ProgressTimer.TEXTURE_COORDS=75;exports.cc.ProgressTimer.TYPE_RADIAL=0;exports.cc.ProgressTimer.TYPE_BAR=1;(function(){exports.cc.ProgressTimer.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._PI180=Math.PI/180,this._barRect=exports.cc.rect(0,0,0,0),this._origin=exports.cc.p(0,0),this._radius=0,this._startAngle=270,this._endAngle=270,this._counterClockWise=!1,this._canUseDirtyRegion=!0};var t=exports.cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.ProgressTimer.CanvasRenderCmd,t.rendering=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext(),a=this._node,c=a._sprite,l=c._renderCmd._textureCoord,h=c._renderCmd._displayedOpacity/255;if(!(l.width===0||l.height===0)&&!(!c._texture||!l.validRect||h===0)){s.setTransform(this._worldTransform,r,n),s.setCompositeOperation(c._blendFuncStr),s.setGlobalAlpha(h);var u=c._rect,_=c._offsetPosition,d=_.x,f=-_.y-u.height,T=u.width,x=u.height;if(s.save(),c._flippedX&&(d=-d-T,o.scale(-1,1)),c._flippedY&&(f=_.y,o.scale(1,-1)),a._type===exports.cc.ProgressTimer.TYPE_BAR){var m=this._barRect;o.beginPath(),o.rect(m.x,m.y,m.width,m.height),o.clip(),o.closePath()}else if(a._type===exports.cc.ProgressTimer.TYPE_RADIAL){var v=this._origin.x,A=this._origin.y;o.beginPath(),o.arc(v,A,this._radius,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),o.lineTo(v,A),o.clip(),o.closePath()}var D=c._renderCmd._textureToRender||c._texture,N=D.getHtmlElementObj();c._renderCmd._colorized?o.drawImage(N,0,0,l.width,l.height,d,f,T,x):o.drawImage(N,l.renderX,l.renderY,l.width,l.height,d,f,T,x),s.restore(),exports.cc.g_NumberOfDraws++}},t.releaseData=function(){},t.resetVertexData=function(){},t._updateProgress=function(){this.setDirtyFlag(exports.cc.Node._dirtyFlags.contentDirty);var e=this._node,r=e._sprite,n=r.width,s=r.height,o=e._midPoint;if(e._type===exports.cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(n*n+s*s));var a,c,l=!1,h=this._origin;h.x=n*o.x,h.y=-s*o.y,e._reverseDirection?(c=270,a=270-3.6*e._percentage):(a=-90,c=-90+3.6*e._percentage),r._flippedX&&(h.x-=n*(e._midPoint.x*2),a=-a,c=-c,a-=180,c-=180,l=!l),r._flippedY&&(h.y+=s*(e._midPoint.y*2),l=!l,a=-a,c=-c),this._startAngle=a,this._endAngle=c,this._counterClockWise=l}else{var u=e._barChangeRate,_=e._percentage/100,d=this._barRect,f=exports.cc.size(n*(1-u.x),s*(1-u.y)),T=exports.cc.size((n-f.width)*_,(s-f.height)*_),x=exports.cc.size(f.width+T.width,f.height+T.height),m=exports.cc.p(n*o.x,s*o.y),v=m.x-x.width/2;o.x>.5&&x.width/2>=n-m.x&&(v=n-x.width);var A=m.y-x.height/2;o.y>.5&&x.height/2>=s-m.y&&(A=s-x.height),d.x=0;var D=1;r._flippedX&&(d.x-=x.width,D=-1),v>0&&(d.x+=v*D),d.y=0;var N=1;r._flippedY&&(d.y+=x.height,N=-1),A>0&&(d.y-=A*N),d.width=x.width,d.height=-x.height}},t._syncStatus=function(e){var r=this._node;if(r._sprite){var n=exports.cc.Node._dirtyFlags,s=this._dirtyFlag,o=e?e._node:null;o&&o._cascadeColorEnabled&&e._dirtyFlag&n.colorDirty&&(s|=n.colorDirty),o&&o._cascadeOpacityEnabled&&e._dirtyFlag&n.opacityDirty&&(s|=n.opacityDirty),e&&e._dirtyFlag&n.transformDirty&&(s|=n.transformDirty),this._dirtyFlag=s;var a=r._sprite._renderCmd,c=a._dirtyFlag,l=c&n.colorDirty,h=c&n.opacityDirty;l&&(a._syncDisplayColor(),a._dirtyFlag=a._dirtyFlag&n.colorDirty^a._dirtyFlag,this._dirtyFlag=this._dirtyFlag&n.colorDirty^this._dirtyFlag),h&&(a._syncDisplayOpacity(),a._dirtyFlag=a._dirtyFlag&n.opacityDirty^a._dirtyFlag,this._dirtyFlag=this._dirtyFlag&n.opacityDirty^this._dirtyFlag),(l||h)&&a._updateColor(),s&n.transformDirty&&this.transform(e),s&n.orderDirty&&(this._dirtyFlag=this._dirtyFlag&n.orderDirty^this._dirtyFlag)}},t.updateStatus=function(){var e=this._node;if(e._sprite){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag,s=e._sprite._renderCmd,o=s._dirtyFlag,a=o&r.colorDirty,c=o&r.opacityDirty;a&&(s._updateDisplayColor(),s._dirtyFlag=s._dirtyFlag&r.colorDirty^s._dirtyFlag,this._dirtyFlag=this._dirtyFlag&r.colorDirty^this._dirtyFlag),c&&(s._updateDisplayOpacity(),s._dirtyFlag=s._dirtyFlag&r.opacityDirty^s._dirtyFlag,this._dirtyFlag=this._dirtyFlag&r.opacityDirty^this._dirtyFlag),(a||c)&&s._updateColor(),n&r.transformDirty&&this.transform(this.getParentRenderCmd(),!0),n&r.contentDirty&&this._notifyRegionStatus&&this._notifyRegionStatus(exports.cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag=0}}})();exports.cc.ProgressTo=exports.cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){exports.cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,e!==void 0&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=e,!0):!1},clone:function(){var t=new exports.cc.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return exports.cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof exports.cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}});exports.cc.progressTo=function(t,e){return new exports.cc.ProgressTo(t,e)};exports.cc.ProgressTo.create=exports.cc.progressTo;exports.cc.ProgressFromTo=exports.cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,r){exports.cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0,r!==void 0&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._to=r,this._from=e,!0):!1},clone:function(){var t=new exports.cc.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return exports.cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof exports.cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}});exports.cc.progressFromTo=function(t,e,r){return new exports.cc.ProgressFromTo(t,e,r)};exports.cc.ProgressFromTo.create=exports.cc.progressFromTo;(function(){var t=8;exports.cc.ProgressTimer.WebGLRenderCmd=function(r){exports.cc.Node.WebGLRenderCmd.call(this,r),this._needDraw=!0,this._progressDirty=!0,this._bl=exports.cc.p(),this._tr=exports.cc.p(),this.initCmd()};var e=exports.cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);e.constructor=exports.cc.ProgressTimer.WebGLRenderCmd,e.transform=function(r,n){this.originTransform(r,n);var s=this._node._sprite;s._renderCmd.transform(this,n);var o=s._offsetPosition.x,a=o+s._rect.width,c=s._offsetPosition.y,l=c+s._rect.height,h=this._worldTransform;this._bl.x=o*h.a+c*h.c+h.tx,this._bl.y=o*h.b+c*h.d+h.ty,this._tr.x=a*h.a+l*h.c+h.tx,this._tr.y=a*h.b+l*h.d+h.ty,this._updateProgressData()},e.rendering=function(r){var n=this._node,s=r||exports.cc._renderContext;if(!(this._vertexDataCount===0||!n._sprite)){this._shaderProgram.use(),this._shaderProgram._updateProjectionUniform();var o=n._sprite._blendFunc;exports.cc.glBlendFunc(o.src,o.dst),exports.cc.glBindTexture2D(n._sprite.texture),s.bindBuffer(s.ARRAY_BUFFER,this._vertexWebGLBuffer),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),s.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),this._vertexDataDirty&&(s.bufferSubData(s.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1);var a=exports.cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,s.FLOAT,!1,a,0),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,s.UNSIGNED_BYTE,!0,a,12),s.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,a,16),n._type===exports.cc.ProgressTimer.TYPE_RADIAL?s.drawArrays(s.TRIANGLE_FAN,0,this._vertexDataCount):n._type===exports.cc.ProgressTimer.TYPE_BAR&&(n._reverseDirection?(s.drawArrays(s.TRIANGLE_STRIP,0,this._vertexDataCount/2),s.drawArrays(s.TRIANGLE_STRIP,4,this._vertexDataCount/2),exports.cc.g_NumberOfDraws++):s.drawArrays(s.TRIANGLE_STRIP,0,this._vertexDataCount)),exports.cc.g_NumberOfDraws++}},e._syncStatus=function(r){var n=this._node;if(n._sprite){var s=exports.cc.Node._dirtyFlags,o=this._dirtyFlag,a=r?r._node:null;a&&a._cascadeColorEnabled&&r._dirtyFlag&s.colorDirty&&(o|=s.colorDirty),a&&a._cascadeOpacityEnabled&&r._dirtyFlag&s.opacityDirty&&(o|=s.opacityDirty),r&&r._dirtyFlag&s.transformDirty&&(o|=s.transformDirty),this._dirtyFlag=o;var c=n._sprite._renderCmd,l=c._dirtyFlag,h=(o|l)&s.colorDirty,u=(o|l)&s.opacityDirty;h&&(c._syncDisplayColor(),c._dirtyFlag=c._dirtyFlag&s.colorDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&s.colorDirty^this._dirtyFlag),u&&(c._syncDisplayOpacity(),c._dirtyFlag=c._dirtyFlag&s.opacityDirty^c._dirtyFlag,this._dirtyFlag=this._dirtyFlag&s.opacityDirty^this._dirtyFlag),(h||u)&&this._updateColor(),o&s.transformDirty&&this.transform(r),o&s.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&s.textureDirty^this._dirtyFlag),c._dirtyFlag=0}},e.updateStatus=function(){var r=this._node;if(r._sprite){var n=exports.cc.Node._dirtyFlags,s=this._dirtyFlag,o=r._sprite._renderCmd,a=o._dirtyFlag,c=(s|a)&n.colorDirty,l=(s|a)&n.opacityDirty;c&&(o._updateDisplayColor(),o._dirtyFlag=o._dirtyFlag&n.colorDirty^o._dirtyFlag,this._dirtyFlag=this._dirtyFlag&n.colorDirty^this._dirtyFlag),l&&(o._updateDisplayOpacity(),o._dirtyFlag=o._dirtyFlag&n.opacityDirty^o._dirtyFlag,this._dirtyFlag=this._dirtyFlag&n.opacityDirty^this._dirtyFlag),(c||l)&&this._updateColor(),s&n.transformDirty&&this.transform(this.getParentRenderCmd(),!0),s&n.orderDirty&&(this._dirtyFlag=this._dirtyFlag&n.orderDirty^this._dirtyFlag),s&n.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&n.textureDirty^this._dirtyFlag)}},e.releaseData=function(){if(this._vertexData){var r=this._vertexWebGLBuffer;setTimeout(function(){exports.cc._renderContext.deleteBuffer(r)},.1),this._vertexWebGLBuffer=null,this._vertexData=null,this._float32View=null,this._vertexArrayBuffer=null,this._vertexDataCount=0}},e.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=exports.cc._renderContext.createBuffer();var r=exports.cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(t*r),this._float32View=new Float32Array(this._vertexArrayBuffer),this._vertexData=[];for(var n=0;n<t;n++)this._vertexData[n]=new exports.cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,n*r);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW),this._vertexDataCount=0,this._vertexDataDirty=!0,this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}},e.resetVertexData=function(){this._vertexDataCount=0},e._updateProgressData=function(){var r=this._node,n=r._type;n===exports.cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():n===exports.cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},e._updateProgress=function(){this.setDirtyFlag(exports.cc.Node._dirtyFlags.textureDirty)},e._updateBar=function(){var r=this._node;if(r._sprite){var n=r._percentage/100,s=r._barChangeRate,o=exports.cc.pMult(exports.cc.p(1-s.x+n*s.x,1-s.y+n*s.y),.5),a=exports.cc.pSub(r._midPoint,o),c=exports.cc.pAdd(r._midPoint,o);a.x<0&&(c.x+=-a.x,a.x=0),c.x>1&&(a.x-=c.x-1,c.x=1),a.y<0&&(c.y+=-a.y,a.y=0),c.y>1&&(a.y-=c.y-1,c.y=1);var l;this._reverseDirection?(l=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(l[0].texCoords,0,1),this._vertexFromAlphaPoint(l[0].vertices,0,1),this._textureCoordFromAlphaPoint(l[1].texCoords,0,0),this._vertexFromAlphaPoint(l[1].vertices,0,0),this._textureCoordFromAlphaPoint(l[6].texCoords,1,1),this._vertexFromAlphaPoint(l[6].vertices,1,1),this._textureCoordFromAlphaPoint(l[7].texCoords,1,0),this._vertexFromAlphaPoint(l[7].vertices,1,0)),this._textureCoordFromAlphaPoint(l[2].texCoords,a.x,c.y),this._vertexFromAlphaPoint(l[2].vertices,a.x,c.y),this._textureCoordFromAlphaPoint(l[3].texCoords,a.x,a.y),this._vertexFromAlphaPoint(l[3].vertices,a.x,a.y),this._textureCoordFromAlphaPoint(l[4].texCoords,c.x,c.y),this._vertexFromAlphaPoint(l[4].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(l[5].texCoords,c.x,a.y),this._vertexFromAlphaPoint(l[5].vertices,c.x,a.y)):(this._vertexDataCount||(this._vertexDataCount=4),l=this._vertexData,this._textureCoordFromAlphaPoint(l[0].texCoords,a.x,c.y),this._vertexFromAlphaPoint(l[0].vertices,a.x,c.y),this._textureCoordFromAlphaPoint(l[1].texCoords,a.x,a.y),this._vertexFromAlphaPoint(l[1].vertices,a.x,a.y),this._textureCoordFromAlphaPoint(l[2].texCoords,c.x,c.y),this._vertexFromAlphaPoint(l[2].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(l[3].texCoords,c.x,a.y),this._vertexFromAlphaPoint(l[3].vertices,c.x,a.y)),this._updateColor()}},e._updateRadial=function(){var r=this._node;if(r._sprite){var n,s=r._midPoint,o=r._percentage/100,a=2*exports.cc.PI*(r._reverseDirection?o:1-o),c=exports.cc.p(s.x,1),l=exports.cc.pRotateByAngle(c,s,a),h=0,u;if(o===0)u=c,h=0;else if(o===1)u=c,h=4;else{var _=exports.cc.FLT_MAX,d=exports.cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(n=0;n<=d;++n){var f=(n+(d-1))%d,T=this._boundaryTexCoord(n%d),x=this._boundaryTexCoord(f);n===0?x=exports.cc.pLerp(T,x,1-s.x):n===4&&(T=exports.cc.pLerp(T,x,1-s.x));var m=exports.cc.p(0,0);if(exports.cc.pLineIntersect(T,x,s,l,m)){if((n===0||n===4)&&!(0<=m.x&&m.x<=1))continue;m.y>=0&&m.y<_&&(_=m.y,h=n)}}u=exports.cc.pAdd(s,exports.cc.pMult(exports.cc.pSub(l,s),_))}var v=!0;this._vertexDataCount!==h+3&&(v=!1,this._vertexDataCount=h+3),this._updateColor();var A=this._vertexData;if(!v)for(this._textureCoordFromAlphaPoint(A[0].texCoords,s.x,s.y),this._vertexFromAlphaPoint(A[0].vertices,s.x,s.y),this._textureCoordFromAlphaPoint(A[1].texCoords,c.x,c.y),this._vertexFromAlphaPoint(A[1].vertices,c.x,c.y),n=0;n<h;n++){var D=this._boundaryTexCoord(n);this._textureCoordFromAlphaPoint(A[n+2].texCoords,D.x,D.y),this._vertexFromAlphaPoint(A[n+2].vertices,D.x,D.y)}this._textureCoordFromAlphaPoint(A[this._vertexDataCount-1].texCoords,u.x,u.y),this._vertexFromAlphaPoint(A[this._vertexDataCount-1].vertices,u.x,u.y)}},e._boundaryTexCoord=function(r){if(r<exports.cc.ProgressTimer.TEXTURE_COORDS_COUNT){var n=exports.cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?exports.cc.p(n>>7-(r<<1)&1,n>>7-((r<<1)+1)&1):exports.cc.p(n>>(r<<1)+1&1,n>>(r<<1)&1)}return exports.cc.p(0,0)},e._textureCoordFromAlphaPoint=function(r,n,s){var o=this._node._sprite;if(!o){r.u=0,r.v=0;return}var a=o._renderCmd._vertices,c=a[1],l=a[2],h=exports.cc.p(c.u,c.v),u=exports.cc.p(l.u,l.v);if(o.textureRectRotated){var _=n;n=s,s=_}r.u=h.x*(1-n)+u.x*n,r.v=h.y*(1-s)+u.y*s},e._vertexFromAlphaPoint=function(r,n,s){r.x=this._bl.x*(1-n)+this._tr.x*n,r.y=this._bl.y*(1-s)+this._tr.y*s,r.z=this._node._vertexZ},e._updateColor=function(){var r=this._node._sprite;if(!(!this._vertexDataCount||!r)){var n=this._displayedColor,s=r._renderCmd._displayedColor,o=s.r,a=s.g,c=s.b,l=r._renderCmd._displayedOpacity/255;r._opacityModifyRGB&&(o*=l,a*=l,c*=l),n.r=o,n.g=a,n.b=c,n.a=r._renderCmd._displayedOpacity;for(var h=this._vertexData,u=0,_=this._vertexDataCount;u<_;++u)h[u].colors=n;this._vertexDataDirty=!0}}})();exports.cc.SCENE_FADE=4208917214;exports.cc.TRANSITION_ORIENTATION_LEFT_OVER=0;exports.cc.TRANSITION_ORIENTATION_RIGHT_OVER=1;exports.cc.TRANSITION_ORIENTATION_UP_OVER=0;exports.cc.TRANSITION_ORIENTATION_DOWN_OVER=1;exports.cc.TransitionScene=exports.cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_className:"TransitionScene",ctor:function(t,e){exports.cc.Scene.prototype.ctor.call(this),t!==void 0&&e!==void 0&&this.initWithDuration(t,e)},_setNewScene:function(t){this.unschedule(this._setNewScene);var e=exports.cc.director;this._isSendCleanupToScene=e.isSendCleanupToScene(),e.runScene(this._inScene),exports.cc.eventManager.setEnabled(!0),this._outScene.visible=!0},_sceneOrder:function(){this._isInSceneOnTop=!0},visit:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit()),exports.cc.Node.prototype.visit.call(this)},onEnter:function(){exports.cc.Node.prototype.onEnter.call(this),exports.cc.eventManager.setEnabled(!1),this._outScene.onExitTransitionDidStart(),this._inScene.onEnter()},onExit:function(){exports.cc.Node.prototype.onExit.call(this),exports.cc.eventManager.setEnabled(!0),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){exports.cc.Node.prototype.cleanup.call(this),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(t,e){if(!e)throw new Error("cc.TransitionScene.initWithDuration(): Argument scene must be non-nil");if(this.init()){if(this._duration=t,this.attr({x:0,y:0,anchorX:0,anchorY:0}),this._inScene=e,this._outScene=exports.cc.director.getRunningScene(),this._outScene||(this._outScene=new exports.cc.Scene,this._outScene.init()),this._inScene===this._outScene)throw new Error("cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene");return this._sceneOrder(),!0}else return!1},finish:function(){this._inScene.attr({visible:!0,x:0,y:0,scale:1,rotation:0}),this._outScene.attr({visible:!1,x:0,y:0,scale:1,rotation:0}),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=!0,this._outScene.visible=!1}});exports.cc.TransitionScene.create=function(t,e){return new exports.cc.TransitionScene(t,e)};exports.cc.TransitionSceneOriented=exports.cc.TransitionScene.extend({_orientation:0,ctor:function(t,e,r){exports.cc.TransitionScene.prototype.ctor.call(this),r!=null&&this.initWithDuration(t,e,r)},initWithDuration:function(t,e,r){return exports.cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._orientation=r),!0}});exports.cc.TransitionSceneOriented.create=function(t,e,r){return new exports.cc.TransitionSceneOriented(t,e,r)};exports.cc.TransitionRotoZoom=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:.5,anchorY:.5}),this._outScene.attr({scale:1,anchorX:.5,anchorY:.5});var t=exports.cc.sequence(exports.cc.spawn(exports.cc.scaleBy(this._duration/2,.001),exports.cc.rotateBy(this._duration/2,360*2)),exports.cc.delayTime(this._duration/2));this._outScene.runAction(t),this._inScene.runAction(exports.cc.sequence(t.reverse(),exports.cc.callFunc(this.finish,this)))}});exports.cc.TransitionRotoZoom.create=function(t,e){return new exports.cc.TransitionRotoZoom(t,e)};exports.cc.TransitionJumpZoom=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this);var t=exports.cc.director.getWinSize();this._inScene.attr({scale:.5,x:t.width,y:0,anchorX:.5,anchorY:.5}),this._outScene.anchorX=.5,this._outScene.anchorY=.5;var e=exports.cc.jumpBy(this._duration/4,exports.cc.p(-t.width,0),t.width/4,2),r=exports.cc.scaleTo(this._duration/4,1),n=exports.cc.scaleTo(this._duration/4,.5),s=exports.cc.sequence(n,e),o=exports.cc.sequence(e,r),a=exports.cc.delayTime(this._duration/2);this._outScene.runAction(s),this._inScene.runAction(exports.cc.sequence(a,o,exports.cc.callFunc(this.finish,this)))}});exports.cc.TransitionJumpZoom.create=function(t,e){return new exports.cc.TransitionJumpZoom(t,e)};exports.cc.TransitionMoveInL=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action();this._inScene.runAction(exports.cc.sequence(this.easeActionWithAction(t),exports.cc.callFunc(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-exports.cc.director.getWinSize().width,0)},action:function(){return exports.cc.moveTo(this._duration,exports.cc.p(0,0))},easeActionWithAction:function(t){return new exports.cc.EaseOut(t,2)}});exports.cc.TransitionMoveInL.create=function(t,e){return new exports.cc.TransitionMoveInL(t,e)};exports.cc.TransitionMoveInR=exports.cc.TransitionMoveInL.extend({ctor:function(t,e){exports.cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(exports.cc.director.getWinSize().width,0)}});exports.cc.TransitionMoveInR.create=function(t,e){return new exports.cc.TransitionMoveInR(t,e)};exports.cc.TransitionMoveInT=exports.cc.TransitionMoveInL.extend({ctor:function(t,e){exports.cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,exports.cc.director.getWinSize().height)}});exports.cc.TransitionMoveInT.create=function(t,e){return new exports.cc.TransitionMoveInT(t,e)};exports.cc.TransitionMoveInB=exports.cc.TransitionMoveInL.extend({ctor:function(t,e){exports.cc.TransitionMoveInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initScenes:function(){this._inScene.setPosition(0,-exports.cc.director.getWinSize().height)}});exports.cc.TransitionMoveInB.create=function(t,e){return new exports.cc.TransitionMoveInB(t,e)};exports.cc.ADJUST_FACTOR=.5;exports.cc.TransitionSlideInL=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var t=this.action(),e=this.action(),r=exports.cc.sequence(this.easeActionWithAction(t),exports.cc.callFunc(this.finish,this)),n=this.easeActionWithAction(e);this._inScene.runAction(r),this._outScene.runAction(n)},initScenes:function(){this._inScene.setPosition(-exports.cc.director.getWinSize().width+exports.cc.ADJUST_FACTOR,0)},action:function(){return exports.cc.moveBy(this._duration,exports.cc.p(exports.cc.director.getWinSize().width-exports.cc.ADJUST_FACTOR,0))},easeActionWithAction:function(t){return new exports.cc.EaseInOut(t,2)}});exports.cc.TransitionSlideInL.create=function(t,e){return new exports.cc.TransitionSlideInL(t,e)};exports.cc.TransitionSlideInR=exports.cc.TransitionSlideInL.extend({ctor:function(t,e){exports.cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(exports.cc.director.getWinSize().width-exports.cc.ADJUST_FACTOR,0)},action:function(){return exports.cc.moveBy(this._duration,exports.cc.p(-(exports.cc.director.getWinSize().width-exports.cc.ADJUST_FACTOR),0))}});exports.cc.TransitionSlideInR.create=function(t,e){return new exports.cc.TransitionSlideInR(t,e)};exports.cc.TransitionSlideInB=exports.cc.TransitionSlideInL.extend({ctor:function(t,e){exports.cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,-(exports.cc.director.getWinSize().height-exports.cc.ADJUST_FACTOR))},action:function(){return exports.cc.moveBy(this._duration,exports.cc.p(0,exports.cc.director.getWinSize().height-exports.cc.ADJUST_FACTOR))}});exports.cc.TransitionSlideInB.create=function(t,e){return new exports.cc.TransitionSlideInB(t,e)};exports.cc.TransitionSlideInT=exports.cc.TransitionSlideInL.extend({ctor:function(t,e){exports.cc.TransitionSlideInL.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,exports.cc.director.getWinSize().height-exports.cc.ADJUST_FACTOR)},action:function(){return exports.cc.moveBy(this._duration,exports.cc.p(0,-(exports.cc.director.getWinSize().height-exports.cc.ADJUST_FACTOR)))}});exports.cc.TransitionSlideInT.create=function(t,e){return new exports.cc.TransitionSlideInT(t,e)};exports.cc.TransitionShrinkGrow=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._inScene.attr({scale:.001,anchorX:2/3,anchorY:.5}),this._outScene.attr({scale:1,anchorX:1/3,anchorY:.5});var t=exports.cc.scaleTo(this._duration,.01),e=exports.cc.scaleTo(this._duration,1);this._inScene.runAction(exports.cc.sequence(this.easeActionWithAction(e),exports.cc.callFunc(this.finish,this))),this._outScene.runAction(this.easeActionWithAction(t))},easeActionWithAction:function(t){return new exports.cc.EaseOut(t,2)}});exports.cc.TransitionShrinkGrow.create=function(t,e){return new exports.cc.TransitionShrinkGrow(t,e)};exports.cc.TransitionFade=exports.cc.TransitionScene.extend({_color:null,ctor:function(t,e,r){exports.cc.TransitionScene.prototype.ctor.call(this),this._color=exports.cc.color(),e&&this.initWithDuration(t,e,r)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this);var t=new exports.cc.LayerColor(this._color);this._inScene.visible=!1,this.addChild(t,2,exports.cc.SCENE_FADE);var e=this.getChildByTag(exports.cc.SCENE_FADE),r=exports.cc.sequence(exports.cc.fadeIn(this._duration/2),exports.cc.callFunc(this.hideOutShowIn,this),exports.cc.fadeOut(this._duration/2),exports.cc.callFunc(this.finish,this));e.runAction(r)},onExit:function(){exports.cc.TransitionScene.prototype.onExit.call(this),this.removeChildByTag(exports.cc.SCENE_FADE,!1)},initWithDuration:function(t,e,r){return r=r||exports.cc.color.BLACK,exports.cc.TransitionScene.prototype.initWithDuration.call(this,t,e)&&(this._color.r=r.r,this._color.g=r.g,this._color.b=r.b,this._color.a=0),!0}});exports.cc.TransitionFade.create=function(t,e,r){return new exports.cc.TransitionFade(t,e,r)};exports.cc.TransitionCrossFade=exports.cc.TransitionScene.extend({ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this);var t=exports.cc.color(0,0,0,0),e=exports.cc.director.getWinSize(),r=new exports.cc.LayerColor(t),n=new exports.cc.RenderTexture(e.width,e.height);n.sprite.anchorX=.5,n.sprite.anchorY=.5,n.attr({x:e.width/2,y:e.height/2,anchorX:.5,anchorY:.5}),n.begin(),this._inScene.visit(),n.end();var s=new exports.cc.RenderTexture(e.width,e.height);s.setPosition(e.width/2,e.height/2),s.sprite.anchorX=s.anchorX=.5,s.sprite.anchorY=s.anchorY=.5,s.begin(),this._outScene.visit(),s.end(),n.sprite.setBlendFunc(exports.cc.ONE,exports.cc.ONE),s.sprite.setBlendFunc(exports.cc.SRC_ALPHA,exports.cc.ONE_MINUS_SRC_ALPHA),r.addChild(n),r.addChild(s),n.sprite.opacity=255,s.sprite.opacity=255;var o=exports.cc.sequence(exports.cc.fadeTo(this._duration,0),exports.cc.callFunc(this.hideOutShowIn,this),exports.cc.callFunc(this.finish,this));s.sprite.runAction(o),this.addChild(r,2,exports.cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(exports.cc.SCENE_FADE,!1),exports.cc.TransitionScene.prototype.onExit.call(this)},visit:function(){exports.cc.Node.prototype.visit.call(this)},draw:function(){}});exports.cc.TransitionCrossFade.create=function(t,e){return new exports.cc.TransitionCrossFade(t,e)};exports.cc.TransitionTurnOffTiles=exports.cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new exports.cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=exports.cc.director.getWinSize(),e=t.width/t.height,r=0|12*e,n=12,s=exports.cc.turnOffTiles(this._duration,exports.cc.size(r,n)),o=this.easeActionWithAction(s);this._gridProxy.runAction(exports.cc.sequence(o,exports.cc.callFunc(this.finish,this),exports.cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t}});exports.cc.TransitionTurnOffTiles.create=function(t,e){return new exports.cc.TransitionTurnOffTiles(t,e)};exports.cc.TransitionSplitCols=exports.cc.TransitionScene.extend({_gridProxy:null,_switchTargetToInscene:function(){this._gridProxy.setTarget(this._inScene)},ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new exports.cc.NodeGrid,e&&this.initWithDuration(t,e)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=this.action(),e=exports.cc.sequence(t,exports.cc.callFunc(this._switchTargetToInscene,this),t.reverse());this._gridProxy.runAction(exports.cc.sequence(this.easeActionWithAction(e),exports.cc.callFunc(this.finish,this),exports.cc.stopGrid()))},onExit:function(){this._gridProxy.setTarget(null),this._gridProxy.onExit(),exports.cc.TransitionScene.prototype.onExit.call(this)},visit:function(){this._gridProxy.visit()},easeActionWithAction:function(t){return new exports.cc.EaseInOut(t,3)},action:function(){return exports.cc.splitCols(this._duration/2,3)}});exports.cc.TransitionSplitCols.create=function(t,e){return new exports.cc.TransitionSplitCols(t,e)};exports.cc.TransitionSplitRows=exports.cc.TransitionSplitCols.extend({ctor:function(t,e){exports.cc.TransitionSplitCols.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},action:function(){return exports.cc.splitRows(this._duration/2,3)}});exports.cc.TransitionSplitRows.create=function(t,e){return new exports.cc.TransitionSplitRows(t,e)};exports.cc.TransitionFadeTR=exports.cc.TransitionScene.extend({_gridProxy:null,ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new exports.cc.NodeGrid,e&&this.initWithDuration(t,e)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._gridProxy.setTarget(this._outScene),this._gridProxy.onEnter();var t=exports.cc.director.getWinSize(),e=t.width/t.height,r=0|12*e,n=12,s=this.actionWithSize(exports.cc.size(r,n));this._gridProxy.runAction(exports.cc.sequence(this.easeActionWithAction(s),exports.cc.callFunc(this.finish,this),exports.cc.stopGrid()))},visit:function(){this._inScene.visit(),this._gridProxy.visit()},easeActionWithAction:function(t){return t},actionWithSize:function(t){return exports.cc.fadeOutTRTiles(this._duration,t)}});exports.cc.TransitionFadeTR.create=function(t,e){return new exports.cc.TransitionFadeTR(t,e)};exports.cc.TransitionFadeBL=exports.cc.TransitionFadeTR.extend({ctor:function(t,e){exports.cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return exports.cc.fadeOutBLTiles(this._duration,t)}});exports.cc.TransitionFadeBL.create=function(t,e){return new exports.cc.TransitionFadeBL(t,e)};exports.cc.TransitionFadeUp=exports.cc.TransitionFadeTR.extend({ctor:function(t,e){exports.cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return new exports.cc.FadeOutUpTiles(this._duration,t)}});exports.cc.TransitionFadeUp.create=function(t,e){return new exports.cc.TransitionFadeUp(t,e)};exports.cc.TransitionFadeDown=exports.cc.TransitionFadeTR.extend({ctor:function(t,e){exports.cc.TransitionFadeTR.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},actionWithSize:function(t){return exports.cc.fadeOutDownTiles(this._duration,t)}});exports.cc.TransitionFadeDown.create=function(t,e){return new exports.cc.TransitionFadeDown(t,e)};exports.cc.SCENE_RADIAL=49153;exports.cc.TransitionProgress=exports.cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",ctor:function(t,e){exports.cc.TransitionScene.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_setAttrs:function(t,e,r){t.attr({x:e,y:r,anchorX:.5,anchorY:.5})},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this),this._setupTransition();var t=exports.cc.director.getWinSize(),e=new exports.cc.RenderTexture(t.width,t.height);e.sprite.anchorX=.5,e.sprite.anchorY=.5,this._setAttrs(e,t.width/2,t.height/2),e.clear(0,0,0,1),e.begin(),this._sceneToBeModified.visit(),e.end(),this._sceneToBeModified===this._outScene&&this.hideOutShowIn();var r=this._progressTimerNodeWithRenderTexture(e),n=exports.cc.sequence(exports.cc.progressFromTo(this._duration,this._from,this._to),exports.cc.callFunc(this.finish,this));r.runAction(n),this.addChild(r,2,exports.cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(exports.cc.SCENE_RADIAL,!0),exports.cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene,this._from=100,this._to=0},_progressTimerNodeWithRenderTexture:function(t){return exports.cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass"),null},_sceneOrder:function(){this._isInSceneOnTop=!1}});exports.cc.TransitionProgress.create=function(t,e){return new exports.cc.TransitionProgress(t,e)};exports.cc.TransitionProgressRadialCCW=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_RADIAL,r.reverseDir=!1,r.percentage=100,this._setAttrs(r,e.width/2,e.height/2),r}});exports.cc.TransitionProgressRadialCCW.create=function(t,e){return new exports.cc.TransitionProgressRadialCCW(t,e)};exports.cc.TransitionProgressRadialCW=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_RADIAL,r.reverseDir=!0,r.percentage=100,this._setAttrs(r,e.width/2,e.height/2),r}});exports.cc.TransitionProgressRadialCW.create=function(t,e){var r=new exports.cc.TransitionProgressRadialCW;return r!==null&&r.initWithDuration(t,e)?r:new exports.cc.TransitionProgressRadialCW(t,e)};exports.cc.TransitionProgressHorizontal=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_BAR,r.midPoint=exports.cc.p(1,0),r.barChangeRate=exports.cc.p(1,0),r.percentage=100,this._setAttrs(r,e.width/2,e.height/2),r}});exports.cc.TransitionProgressHorizontal.create=function(t,e){return new exports.cc.TransitionProgressHorizontal(t,e)};exports.cc.TransitionProgressVertical=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_BAR,r.midPoint=exports.cc.p(0,0),r.barChangeRate=exports.cc.p(0,1),r.percentage=100,this._setAttrs(r,e.width/2,e.height/2),r}});exports.cc.TransitionProgressVertical.create=function(t,e){return new exports.cc.TransitionProgressVertical(t,e)};exports.cc.TransitionProgressInOut=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_BAR,r.midPoint=exports.cc.p(.5,.5),r.barChangeRate=exports.cc.p(1,1),r.percentage=0,this._setAttrs(r,e.width/2,e.height/2),r},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene,this._from=0,this._to=100}});exports.cc.TransitionProgressInOut.create=function(t,e){return new exports.cc.TransitionProgressInOut(t,e)};exports.cc.TransitionProgressOutIn=exports.cc.TransitionProgress.extend({ctor:function(t,e){exports.cc.TransitionProgress.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},_progressTimerNodeWithRenderTexture:function(t){var e=exports.cc.director.getWinSize(),r=new exports.cc.ProgressTimer(t.sprite);return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(r.sprite.flippedY=!0),r.type=exports.cc.ProgressTimer.TYPE_BAR,r.midPoint=exports.cc.p(.5,.5),r.barChangeRate=exports.cc.p(1,1),r.percentage=100,this._setAttrs(r,e.width/2,e.height/2),r}});exports.cc.TransitionProgressOutIn.create=function(t,e){return new exports.cc.TransitionProgressOutIn(t,e)};exports.cc.TransitionPageTurn=exports.cc.TransitionScene.extend({ctor:function(t,e,r){exports.cc.TransitionScene.prototype.ctor.call(this),this._gridProxy=new exports.cc.NodeGrid,this.initWithDuration(t,e,r)},_back:!0,_gridProxy:null,_className:"TransitionPageTurn",initWithDuration:function(t,e,r){return this._back=r,exports.cc.TransitionScene.prototype.initWithDuration.call(this,t,e),!0},actionWithSize:function(t){return this._back?exports.cc.reverseTime(exports.cc.pageTurn3D(this._duration,t)):exports.cc.pageTurn3D(this._duration,t)},onEnter:function(){exports.cc.TransitionScene.prototype.onEnter.call(this);var t=exports.cc.director.getWinSize(),e,r;t.width>t.height?(e=16,r=12):(e=12,r=16);var n=this.actionWithSize(exports.cc.size(e,r)),s=this._gridProxy;this._back?(s.setTarget(this._inScene),s.onEnter(),this._inScene.visible=!1,s.runAction(exports.cc.sequence(n,exports.cc.callFunc(this.finish,this),exports.cc.stopGrid())),this._inScene.runAction(exports.cc.show())):(s.setTarget(this._outScene),s.onEnter(),s.runAction(exports.cc.sequence(n,exports.cc.callFunc(this.finish,this),exports.cc.stopGrid())))},visit:function(){this._back?this._outScene.visit():this._inScene.visit(),this._gridProxy.visit()},_sceneOrder:function(){this._isInSceneOnTop=this._back}});exports.cc.TransitionPageTurn.create=function(t,e,r){return new exports.cc.TransitionPageTurn(t,e,r)};exports.cc.Codec={name:"Jacob__Codec"};exports.cc.unzip=function(){return exports.cc.Codec.GZip.gunzip.apply(exports.cc.Codec.GZip,arguments)};exports.cc.unzipBase64=function(){var t=exports.cc.Codec.Base64.decode.apply(exports.cc.Codec.Base64,arguments);return exports.cc.Codec.GZip.gunzip.apply(exports.cc.Codec.GZip,[t])};exports.cc.unzipBase64AsArray=function(t,e){e=e||1;var r=this.unzipBase64(t),n=[],s,o,a;for(s=0,a=r.length/e;s<a;s++)for(n[s]=0,o=e-1;o>=0;--o)n[s]+=r.charCodeAt(s*e+o)<<o*8;return n};exports.cc.unzipAsArray=function(t,e){e=e||1;var r=this.unzip(t),n=[],s,o,a;for(s=0,a=r.length/e;s<a;s++)for(n[s]=0,o=e-1;o>=0;--o)n[s]+=r.charCodeAt(s*e+o)<<o*8;return n};exports.cc.StringToArray=function(t){var e=t.split(","),r=[],n;for(n=0;n<e.length;n++)r.push(parseInt(e[n]));return r};exports.cc.Codec.Base64={name:"Jacob__Codec__Base64"};exports.cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.cc.Codec.Base64.decode=function(e){var r=[],n,s,o,a,c,l,h,u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)a=this._keyStr.indexOf(e.charAt(u++)),c=this._keyStr.indexOf(e.charAt(u++)),l=this._keyStr.indexOf(e.charAt(u++)),h=this._keyStr.indexOf(e.charAt(u++)),n=a<<2|c>>4,s=(c&15)<<4|l>>2,o=(l&3)<<6|h,r.push(String.fromCharCode(n)),l!==64&&r.push(String.fromCharCode(s)),h!==64&&r.push(String.fromCharCode(o));return r=r.join(""),r};exports.cc.Codec.Base64.decodeAsArray=function(e,r){var n=this.decode(e),s=[],o,a,c;for(o=0,c=n.length/r;o<c;o++)for(s[o]=0,a=r-1;a>=0;--a)s[o]+=n.charCodeAt(o*r+a)<<a*8;return s};exports.cc.uint8ArrayToUint32Array=function(t){if(t.length%4!==0)return null;for(var e=t.length/4,r=window.Uint32Array?new Uint32Array(e):[],n=0;n<e;n++){var s=n*4;r[n]=t[s]+t[s+1]*256+t[s+2]*65536+t[s+3]*(1<<24)}return r};exports.cc.Codec.GZip=function(e){this.data=e,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(exports.cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};exports.cc.Codec.GZip.gunzip=function(t){t.constructor===Array||t.constructor;var e=new exports.cc.Codec.GZip(t);return e.gunzip()[0][0]};exports.cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1};exports.cc.Codec.GZip.LITERALS=288;exports.cc.Codec.GZip.NAMEMAX=256;exports.cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255];exports.cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];exports.cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99];exports.cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];exports.cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];exports.cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];exports.cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped};exports.cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1};exports.cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1};exports.cc.Codec.GZip.prototype.readBit=function(){var t;return this.bits++,t=this.bb&1,this.bb>>=1,this.bb===0&&(this.bb=this.readByte(),t=this.bb&1,this.bb=this.bb>>1|128),t};exports.cc.Codec.GZip.prototype.readBits=function(t){for(var e=0,r=t;r--;)e=e<<1|this.readBit();return t&&(e=exports.cc.Codec.GZip.bitReverse[e]>>8-t),e};exports.cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0};exports.cc.Codec.GZip.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),this.bIdx===32768&&(this.bIdx=0)};exports.cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}};exports.cc.Codec.GZip.prototype.Rec=function(){var t=this.Places[this.treepos],e;if(this.len===17)return-1;if(this.treepos++,this.len++,e=this.IsPat(),e>=0)t.b0=e;else if(t.b0=32768,this.Rec())return-1;if(e=this.IsPat(),e>=0)t.b1=e,t.jump=null;else if(t.b1=32768,t.jump=this.Places[this.treepos],t.jumppos=this.treepos,this.Rec())return-1;return this.len--,0};exports.cc.Codec.GZip.prototype.CreateTree=function(t,e,r,n){var s;for(this.Places=t,this.treepos=0,this.flens=r,this.fmax=e,s=0;s<17;s++)this.fpos[s]=0;return this.len=0,this.Rec()?-1:0};exports.cc.Codec.GZip.prototype.DecodeValue=function(t){for(var e,r,n=0,s=t[n],o;;)if(o=this.readBit(),o){if(!(s.b1&32768))return s.b1;for(s=s.jump,e=t.length,r=0;r<e;r++)if(t[r]===s){n=r;break}}else{if(!(s.b0&32768))return s.b0;n++,s=t[n]}return-1};exports.cc.Codec.GZip.prototype.DeflateLoop=function(){var t,e,r,n,s;do if(t=this.readBit(),r=this.readBits(2),r===0){var o,a;for(this.byteAlign(),o=this.readByte(),o|=this.readByte()<<8,a=this.readByte(),a|=this.readByte()<<8,(o^~a)&65535&&document.write(`BlockLen checksum mismatch
`);o--;)e=this.readByte(),this.addBuffer(e)}else if(r===1)for(var c;;)if(c=exports.cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,c>23?(c=c<<1|this.readBit(),c>199?(c-=128,c=c<<1|this.readBit()):(c-=48,c>143&&(c=c+136))):c+=256,c<256)this.addBuffer(c);else{if(c===256)break;var s,l;for(c-=256+1,s=this.readBits(exports.cc.Codec.GZip.cplext[c])+exports.cc.Codec.GZip.cplens[c],c=exports.cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,exports.cc.Codec.GZip.cpdext[c]>8?(l=this.readBits(8),l|=this.readBits(exports.cc.Codec.GZip.cpdext[c]-8)<<8):l=this.readBits(exports.cc.Codec.GZip.cpdext[c]),l+=exports.cc.Codec.GZip.cpdist[c],c=0;c<s;c++){var e=this.buf32k[this.bIdx-l&32767];this.addBuffer(e)}}else if(r===2){var c,h,u,_,d,f=new Array(320);for(u=257+this.readBits(5),_=1+this.readBits(5),d=4+this.readBits(4),c=0;c<19;c++)f[c]=0;for(c=0;c<d;c++)f[exports.cc.Codec.GZip.border[c]]=this.readBits(3);for(s=this.distanceTree.length,n=0;n<s;n++)this.distanceTree[n]=new exports.cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,f,0))return this.flushBuffer(),1;for(h=u+_,n=0;n<h;)if(c=this.DecodeValue(this.distanceTree),c<16)f[n++]=c;else if(c===16){var T;if(c=3+this.readBits(2),n+c>h)return this.flushBuffer(),1;for(T=n?f[n-1]:0;c--;)f[n++]=T}else{if(c===17?c=3+this.readBits(3):c=11+this.readBits(7),n+c>h)return this.flushBuffer(),1;for(;c--;)f[n++]=0}for(s=this.literalTree.length,n=0;n<s;n++)this.literalTree[n]=new exports.cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,u,f,0))return this.flushBuffer(),1;for(s=this.literalTree.length,n=0;n<s;n++)this.distanceTree[n]=new exports.cc.Codec.GZip.HufNode;var x=new Array;for(n=u;n<f.length;n++)x[n-u]=f[n];if(this.CreateTree(this.distanceTree,_,x,0))return this.flushBuffer(),1;for(;;)if(c=this.DecodeValue(this.literalTree),c>=256){var s,l;if(c-=256,c===0)break;for(c--,s=this.readBits(exports.cc.Codec.GZip.cplext[c])+exports.cc.Codec.GZip.cplens[c],c=this.DecodeValue(this.distanceTree),exports.cc.Codec.GZip.cpdext[c]>8?(l=this.readBits(8),l|=this.readBits(exports.cc.Codec.GZip.cpdext[c]-8)<<8):l=this.readBits(exports.cc.Codec.GZip.cpdext[c]),l+=exports.cc.Codec.GZip.cpdist[c];s--;){var e=this.buf32k[this.bIdx-l&32767];this.addBuffer(e)}}else this.addBuffer(c)}while(!t);return this.flushBuffer(),this.byteAlign(),0};exports.cc.Codec.GZip.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]};exports.cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),t[0]===120&&t[1]===218&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),t[0]===31&&t[1]===139&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),t[0]===80&&t[1]===75&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),t[2]===3&&t[3]===4)){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var s=this.readByte();s|=this.readByte()<<8;var o=this.readByte();for(o|=this.readByte()<<8,c=0,this.nameBuf=[];s--;){var a=this.readByte();a==="/"|a===":"?c=0:c<exports.cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[c++]=String.fromCharCode(a))}this.fileout||(this.fileout=this.nameBuf);for(var c=0;c<o;)a=this.readByte(),c++;e===8&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}};exports.cc.Codec.GZip.prototype.skipdir=function(){var t=[],e,r,n,s;if(this.gpflags&8&&(t[0]=this.readByte(),t[1]=this.readByte(),t[2]=this.readByte(),t[3]=this.readByte(),e=this.readByte(),e|=this.readByte()<<8,e|=this.readByte()<<16,e|=this.readByte()<<24,r=this.readByte(),r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24),this.modeZIP&&this.nextFile(),t[0]=this.readByte(),t[0]!==8)return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.gpflags&4)for(t[0]=this.readByte(),t[2]=this.readByte(),this.len=t[0]+256*t[1],n=0;n<this.len;n++)this.readByte();if(this.gpflags&8)for(n=0,this.nameBuf=[];s=this.readByte();)(s==="7"||s===":")&&(n=0),n<exports.cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[n++]=s);if(this.gpflags&16)for(;s=this.readByte(););this.gpflags&2&&(this.readByte(),this.readByte()),this.DeflateLoop(),r=this.readByte(),r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24,this.modeZIP&&this.nextFile()};(function(){function t(ot){throw ot}var e=void 0,r=!0,n=this;function s(ot,st){var ut=ot.split("."),ft=n;!(ut[0]in ft)&&ft.execScript&&ft.execScript("var "+ut[0]);for(var yt;ut.length&&(yt=ut.shift());)!ut.length&&st!==e?ft[yt]=st:ft=ft[yt]?ft[yt]:ft[yt]={}}var o=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined";function a(ot){if(typeof ot=="string"){var st=ot.split(""),ut,ft;for(ut=0,ft=st.length;ut<ft;ut++)st[ut]=(st[ut].charCodeAt(0)&255)>>>0;ot=st}for(var yt=1,gt=0,Et=ot.length,Rt,Wt=0;0<Et;){Rt=1024<Et?1024:Et,Et-=Rt;do yt+=ot[Wt++],gt+=yt;while(--Rt);yt%=65521,gt%=65521}return(gt<<16|yt)>>>0}function c(ot,st){this.index=typeof st=="number"?st:0,this.i=0,this.buffer=ot instanceof(o?Uint8Array:Array)?ot:new(o?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}c.prototype.f=function(){var ot=this.buffer,st,ut=ot.length,ft=new(o?Uint8Array:Array)(ut<<1);if(o)ft.set(ot);else for(st=0;st<ut;++st)ft[st]=ot[st];return this.buffer=ft},c.prototype.d=function(ot,st,ut){var ft=this.buffer,yt=this.index,gt=this.i,Et=ft[yt],Rt;if(ut&&1<st&&(ot=8<st?(f[ot&255]<<24|f[ot>>>8&255]<<16|f[ot>>>16&255]<<8|f[ot>>>24&255])>>32-st:f[ot]>>8-st),8>st+gt)Et=Et<<st|ot,gt+=st;else for(Rt=0;Rt<st;++Rt)Et=Et<<1|ot>>st-Rt-1&1,++gt===8&&(gt=0,ft[yt++]=f[Et],Et=0,yt===ft.length&&(ft=this.f()));ft[yt]=Et,this.buffer=ft,this.i=gt,this.index=yt},c.prototype.finish=function(){var ot=this.buffer,st=this.index,ut;return 0<this.i&&(ot[st]<<=8-this.i,ot[st]=f[ot[st]],st++),o?ut=ot.subarray(0,st):(ot.length=st,ut=ot),ut};var l=new(o?Uint8Array:Array)(256),h;for(h=0;256>h;++h){for(var d=h,u=d,_=7,d=d>>>1;d;d>>>=1)u<<=1,u|=d&1,--_;l[h]=(u<<_&255)>>>0}var f=l;function T(ot){this.buffer=new(o?Uint16Array:Array)(2*ot),this.length=0}T.prototype.getParent=function(ot){return 2*((ot-2)/4|0)},T.prototype.push=function(ot,st){var ut,ft,yt=this.buffer,gt;for(ut=this.length,yt[this.length++]=st,yt[this.length++]=ot;0<ut&&(ft=this.getParent(ut),yt[ut]>yt[ft]);)gt=yt[ut],yt[ut]=yt[ft],yt[ft]=gt,gt=yt[ut+1],yt[ut+1]=yt[ft+1],yt[ft+1]=gt,ut=ft;return this.length},T.prototype.pop=function(){var ot,st,ut=this.buffer,ft,yt,gt;for(st=ut[0],ot=ut[1],this.length-=2,ut[0]=ut[this.length],ut[1]=ut[this.length+1],gt=0;yt=2*gt+2,!(yt>=this.length);){if(yt+2<this.length&&ut[yt+2]>ut[yt]&&(yt+=2),ut[yt]>ut[gt])ft=ut[gt],ut[gt]=ut[yt],ut[yt]=ft,ft=ut[gt+1],ut[gt+1]=ut[yt+1],ut[yt+1]=ft;else break;gt=yt}return{index:ot,value:st,length:this.length}};function x(ot){var st=ot.length,ut=0,ft=Number.POSITIVE_INFINITY,yt,gt,Et,Rt,Wt,Lt,Yt,Mt,Dt;for(Mt=0;Mt<st;++Mt)ot[Mt]>ut&&(ut=ot[Mt]),ot[Mt]<ft&&(ft=ot[Mt]);for(yt=1<<ut,gt=new(o?Uint32Array:Array)(yt),Et=1,Rt=0,Wt=2;Et<=ut;){for(Mt=0;Mt<st;++Mt)if(ot[Mt]===Et){for(Lt=0,Yt=Rt,Dt=0;Dt<Et;++Dt)Lt=Lt<<1|Yt&1,Yt>>=1;for(Dt=Lt;Dt<yt;Dt+=Wt)gt[Dt]=Et<<16|Mt;++Rt}++Et,Rt<<=1,Wt<<=1}return[gt,ut,ft]}function m(ot,st){this.h=v,this.w=0,this.input=ot,this.b=0,st&&(st.lazy&&(this.w=st.lazy),typeof st.compressionType=="number"&&(this.h=st.compressionType),st.outputBuffer&&(this.a=o&&st.outputBuffer instanceof Array?new Uint8Array(st.outputBuffer):st.outputBuffer),typeof st.outputIndex=="number"&&(this.b=st.outputIndex)),this.a||(this.a=new(o?Uint8Array:Array)(32768))}var v=2,A={NONE:0,r:1,j:v,N:3},D=[],N;for(N=0;288>N;N++)switch(r){case 143>=N:D.push([N+48,8]);break;case 255>=N:D.push([N-144+400,9]);break;case 279>=N:D.push([N-256+0,7]);break;case 287>=N:D.push([N-280+192,8]);break;default:t("invalid literal: "+N)}m.prototype.n=function(){var ot,st,ut,ft,yt=this.input;switch(this.h){case 0:for(ut=0,ft=yt.length;ut<ft;){st=o?yt.subarray(ut,ut+65535):yt.slice(ut,ut+65535),ut+=st.length;var gt=st,Et=ut===ft,Rt=e,Wt=e,Lt=e,Yt=e,Mt=e,Dt=this.a,Ft=this.b;if(o){for(Dt=new Uint8Array(this.a.buffer);Dt.length<=Ft+gt.length+5;)Dt=new Uint8Array(Dt.length<<1);Dt.set(this.a)}if(Rt=Et?1:0,Dt[Ft++]=Rt|0,Wt=gt.length,Lt=~Wt+65536&65535,Dt[Ft++]=Wt&255,Dt[Ft++]=Wt>>>8&255,Dt[Ft++]=Lt&255,Dt[Ft++]=Lt>>>8&255,o)Dt.set(gt,Ft),Ft+=gt.length,Dt=Dt.subarray(0,Ft);else{for(Yt=0,Mt=gt.length;Yt<Mt;++Yt)Dt[Ft++]=gt[Yt];Dt.length=Ft}this.b=Ft,this.a=Dt}break;case 1:var Ht=new c(new Uint8Array(this.a.buffer),this.b);Ht.d(1,1,r),Ht.d(1,2,r);var Xt=rt(this,yt),jt,te,Jt;for(jt=0,te=Xt.length;jt<te;jt++)if(Jt=Xt[jt],c.prototype.d.apply(Ht,D[Jt]),256<Jt)Ht.d(Xt[++jt],Xt[++jt],r),Ht.d(Xt[++jt],5),Ht.d(Xt[++jt],Xt[++jt],r);else if(Jt===256)break;this.a=Ht.finish(),this.b=this.a.length;break;case v:var qt=new c(new Uint8Array(this.a),this.b),ee,Bt,kt,Kt,ce,ue=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],le,Te,Ce,Ot,ae,de=Array(19),_e,Zt,me,re,Le;for(ee=v,qt.d(1,1,r),qt.d(ee,2,r),Bt=rt(this,yt),le=I(this.L,15),Te=L(le),Ce=I(this.K,7),Ot=L(Ce),kt=286;257<kt&&le[kt-1]===0;kt--);for(Kt=30;1<Kt&&Ce[Kt-1]===0;Kt--);var Ut=kt,ye=Kt,fe=new(o?Uint32Array:Array)(Ut+ye),ne,Re,se,Ve,Se=new(o?Uint32Array:Array)(316),xe,pe,Ee=new(o?Uint8Array:Array)(19);for(ne=Re=0;ne<Ut;ne++)fe[Re++]=le[ne];for(ne=0;ne<ye;ne++)fe[Re++]=Ce[ne];if(!o)for(ne=0,Ve=Ee.length;ne<Ve;++ne)Ee[ne]=0;for(ne=xe=0,Ve=fe.length;ne<Ve;ne+=Re){for(Re=1;ne+Re<Ve&&fe[ne+Re]===fe[ne];++Re);if(se=Re,fe[ne]===0)if(3>se)for(;0<se--;)Se[xe++]=0,Ee[0]++;else for(;0<se;)pe=138>se?se:138,pe>se-3&&pe<se&&(pe=se-3),10>=pe?(Se[xe++]=17,Se[xe++]=pe-3,Ee[17]++):(Se[xe++]=18,Se[xe++]=pe-11,Ee[18]++),se-=pe;else if(Se[xe++]=fe[ne],Ee[fe[ne]]++,se--,3>se)for(;0<se--;)Se[xe++]=fe[ne],Ee[fe[ne]]++;else for(;0<se;)pe=6>se?se:6,pe>se-3&&pe<se&&(pe=se-3),Se[xe++]=16,Se[xe++]=pe-3,Ee[16]++,se-=pe}for(ot=o?Se.subarray(0,xe):Se.slice(0,xe),ae=I(Ee,7),re=0;19>re;re++)de[re]=ae[ue[re]];for(ce=19;4<ce&&de[ce-1]===0;ce--);for(_e=L(ae),qt.d(kt-257,5,r),qt.d(Kt-1,5,r),qt.d(ce-4,4,r),re=0;re<ce;re++)qt.d(de[re],3,r);for(re=0,Le=ot.length;re<Le;re++)if(Zt=ot[re],qt.d(_e[Zt],ae[Zt],r),16<=Zt){switch(re++,Zt){case 16:me=2;break;case 17:me=3;break;case 18:me=7;break;default:t("invalid code: "+Zt)}qt.d(ot[re],me,r)}var ge=[Te,le],ze=[Ot,Ce],Ae,Oe,Be,We,De,$t,Fe,Ne;for(De=ge[0],$t=ge[1],Fe=ze[0],Ne=ze[1],Ae=0,Oe=Bt.length;Ae<Oe;++Ae)if(Be=Bt[Ae],qt.d(De[Be],$t[Be],r),256<Be)qt.d(Bt[++Ae],Bt[++Ae],r),We=Bt[++Ae],qt.d(Fe[We],Ne[We],r),qt.d(Bt[++Ae],Bt[++Ae],r);else if(Be===256)break;this.a=qt.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};function z(ot,st){this.length=ot,this.G=st}function M(){var ot=U;switch(r){case ot===3:return[257,ot-3,0];case ot===4:return[258,ot-4,0];case ot===5:return[259,ot-5,0];case ot===6:return[260,ot-6,0];case ot===7:return[261,ot-7,0];case ot===8:return[262,ot-8,0];case ot===9:return[263,ot-9,0];case ot===10:return[264,ot-10,0];case 12>=ot:return[265,ot-11,1];case 14>=ot:return[266,ot-13,1];case 16>=ot:return[267,ot-15,1];case 18>=ot:return[268,ot-17,1];case 22>=ot:return[269,ot-19,2];case 26>=ot:return[270,ot-23,2];case 30>=ot:return[271,ot-27,2];case 34>=ot:return[272,ot-31,2];case 42>=ot:return[273,ot-35,3];case 50>=ot:return[274,ot-43,3];case 58>=ot:return[275,ot-51,3];case 66>=ot:return[276,ot-59,3];case 82>=ot:return[277,ot-67,4];case 98>=ot:return[278,ot-83,4];case 114>=ot:return[279,ot-99,4];case 130>=ot:return[280,ot-115,4];case 162>=ot:return[281,ot-131,5];case 194>=ot:return[282,ot-163,5];case 226>=ot:return[283,ot-195,5];case 257>=ot:return[284,ot-227,5];case ot===258:return[285,ot-258,0];default:t("invalid length: "+ot)}}var J=[],U,K;for(U=3;258>=U;U++)K=M(),J[U]=K[2]<<24|K[1]<<16|K[0];var tt=o?new Uint32Array(J):J;function rt(ot,st){function ut(Te,Ce){var Ot=Te.G,ae=[],de=0,_e;_e=tt[Te.length],ae[de++]=_e&65535,ae[de++]=_e>>16&255,ae[de++]=_e>>24;var Zt;switch(r){case Ot===1:Zt=[0,Ot-1,0];break;case Ot===2:Zt=[1,Ot-2,0];break;case Ot===3:Zt=[2,Ot-3,0];break;case Ot===4:Zt=[3,Ot-4,0];break;case 6>=Ot:Zt=[4,Ot-5,1];break;case 8>=Ot:Zt=[5,Ot-7,1];break;case 12>=Ot:Zt=[6,Ot-9,2];break;case 16>=Ot:Zt=[7,Ot-13,2];break;case 24>=Ot:Zt=[8,Ot-17,3];break;case 32>=Ot:Zt=[9,Ot-25,3];break;case 48>=Ot:Zt=[10,Ot-33,4];break;case 64>=Ot:Zt=[11,Ot-49,4];break;case 96>=Ot:Zt=[12,Ot-65,5];break;case 128>=Ot:Zt=[13,Ot-97,5];break;case 192>=Ot:Zt=[14,Ot-129,6];break;case 256>=Ot:Zt=[15,Ot-193,6];break;case 384>=Ot:Zt=[16,Ot-257,7];break;case 512>=Ot:Zt=[17,Ot-385,7];break;case 768>=Ot:Zt=[18,Ot-513,8];break;case 1024>=Ot:Zt=[19,Ot-769,8];break;case 1536>=Ot:Zt=[20,Ot-1025,9];break;case 2048>=Ot:Zt=[21,Ot-1537,9];break;case 3072>=Ot:Zt=[22,Ot-2049,10];break;case 4096>=Ot:Zt=[23,Ot-3073,10];break;case 6144>=Ot:Zt=[24,Ot-4097,11];break;case 8192>=Ot:Zt=[25,Ot-6145,11];break;case 12288>=Ot:Zt=[26,Ot-8193,12];break;case 16384>=Ot:Zt=[27,Ot-12289,12];break;case 24576>=Ot:Zt=[28,Ot-16385,13];break;case 32768>=Ot:Zt=[29,Ot-24577,13];break;default:t("invalid distance")}_e=Zt,ae[de++]=_e[0],ae[de++]=_e[1],ae[de++]=_e[2];var me,re;for(me=0,re=ae.length;me<re;++me)Dt[Ft++]=ae[me];Xt[ae[0]]++,jt[ae[3]]++,Ht=Te.length+Ce-1,Mt=null}var ft,yt,gt,Et,Rt,Wt={},Lt,Yt,Mt,Dt=o?new Uint16Array(2*st.length):[],Ft=0,Ht=0,Xt=new(o?Uint32Array:Array)(286),jt=new(o?Uint32Array:Array)(30),te=ot.w,Jt;if(!o){for(gt=0;285>=gt;)Xt[gt++]=0;for(gt=0;29>=gt;)jt[gt++]=0}for(Xt[256]=1,ft=0,yt=st.length;ft<yt;++ft){for(gt=Rt=0,Et=3;gt<Et&&ft+gt!==yt;++gt)Rt=Rt<<8|st[ft+gt];if(Wt[Rt]===e&&(Wt[Rt]=[]),Lt=Wt[Rt],!(0<Ht--)){for(;0<Lt.length&&32768<ft-Lt[0];)Lt.shift();if(ft+3>=yt){for(Mt&&ut(Mt,-1),gt=0,Et=yt-ft;gt<Et;++gt)Jt=st[ft+gt],Dt[Ft++]=Jt,++Xt[Jt];break}if(0<Lt.length){var qt=e,ee=e,Bt=0,kt=e,ue=e,Kt=e,le=e,ce=st.length,ue=0,le=Lt.length;t:for(;ue<le;ue++){if(qt=Lt[le-ue-1],kt=3,3<Bt){for(Kt=Bt;3<Kt;Kt--)if(st[qt+Kt-1]!==st[ft+Kt-1])continue t;kt=Bt}for(;258>kt&&ft+kt<ce&&st[qt+kt]===st[ft+kt];)++kt;if(kt>Bt&&(ee=qt,Bt=kt),kt===258)break}Yt=new z(Bt,ft-ee),Mt?Mt.length<Yt.length?(Jt=st[ft-1],Dt[Ft++]=Jt,++Xt[Jt],ut(Yt,0)):ut(Mt,-1):Yt.length<te?Mt=Yt:ut(Yt,0)}else Mt?ut(Mt,-1):(Jt=st[ft],Dt[Ft++]=Jt,++Xt[Jt])}Lt.push(ft)}return Dt[Ft++]=256,Xt[256]++,ot.L=Xt,ot.K=jt,o?Dt.subarray(0,Ft):Dt}function I(ot,st){function ut(ue){var le=jt[ue][te[ue]];le===Mt?(ut(ue+1),ut(ue+1)):--Ht[le],++te[ue]}var ft=ot.length,yt=new T(572),gt=new(o?Uint8Array:Array)(ft),Et,Rt,Wt,Lt,Yt;if(!o)for(Lt=0;Lt<ft;Lt++)gt[Lt]=0;for(Lt=0;Lt<ft;++Lt)0<ot[Lt]&&yt.push(Lt,ot[Lt]);if(Et=Array(yt.length/2),Rt=new(o?Uint32Array:Array)(yt.length/2),Et.length===1)return gt[yt.pop().index]=1,gt;for(Lt=0,Yt=yt.length/2;Lt<Yt;++Lt)Et[Lt]=yt.pop(),Rt[Lt]=Et[Lt].value;var Mt=Rt.length,Dt=new(o?Uint16Array:Array)(st),Ft=new(o?Uint8Array:Array)(st),Ht=new(o?Uint8Array:Array)(Mt),Xt=Array(st),jt=Array(st),te=Array(st),Jt=(1<<st)-Mt,qt=1<<st-1,ee,Bt,kt,Kt,ce;for(Dt[st-1]=Mt,Bt=0;Bt<st;++Bt)Jt<qt?Ft[Bt]=0:(Ft[Bt]=1,Jt-=qt),Jt<<=1,Dt[st-2-Bt]=(Dt[st-1-Bt]/2|0)+Mt;for(Dt[0]=Ft[0],Xt[0]=Array(Dt[0]),jt[0]=Array(Dt[0]),Bt=1;Bt<st;++Bt)Dt[Bt]>2*Dt[Bt-1]+Ft[Bt]&&(Dt[Bt]=2*Dt[Bt-1]+Ft[Bt]),Xt[Bt]=Array(Dt[Bt]),jt[Bt]=Array(Dt[Bt]);for(ee=0;ee<Mt;++ee)Ht[ee]=st;for(kt=0;kt<Dt[st-1];++kt)Xt[st-1][kt]=Rt[kt],jt[st-1][kt]=kt;for(ee=0;ee<st;++ee)te[ee]=0;for(Ft[st-1]===1&&(--Ht[0],++te[st-1]),Bt=st-2;0<=Bt;--Bt){for(Kt=ee=0,ce=te[Bt+1],kt=0;kt<Dt[Bt];kt++)Kt=Xt[Bt+1][ce]+Xt[Bt+1][ce+1],Kt>Rt[ee]?(Xt[Bt][kt]=Kt,jt[Bt][kt]=Mt,ce+=2):(Xt[Bt][kt]=Rt[ee],jt[Bt][kt]=ee,++ee);te[Bt]=0,Ft[Bt]===1&&ut(Bt)}for(Wt=Ht,Lt=0,Yt=Et.length;Lt<Yt;++Lt)gt[Et[Lt].index]=Wt[Lt];return gt}function L(ot){var st=new(o?Uint16Array:Array)(ot.length),ut=[],ft=[],yt=0,gt,Et,Rt,Wt;for(gt=0,Et=ot.length;gt<Et;gt++)ut[ot[gt]]=(ut[ot[gt]]|0)+1;for(gt=1,Et=16;gt<=Et;gt++)ft[gt]=yt,yt+=ut[gt]|0,yt>1<<gt&&t("overcommitted"),yt<<=1;for(65536>yt&&t("undercommitted"),gt=0,Et=ot.length;gt<Et;gt++)for(yt=ft[ot[gt]],ft[ot[gt]]+=1,Rt=st[gt]=0,Wt=ot[gt];Rt<Wt;Rt++)st[gt]=st[gt]<<1|yt&1,yt>>>=1;return st}function G(ot,st){this.input=ot,this.a=new(o?Uint8Array:Array)(32768),this.h=w.j;var ut={},ft;(st||!(st={}))&&typeof st.compressionType=="number"&&(this.h=st.compressionType);for(ft in st)ut[ft]=st[ft];ut.outputBuffer=this.a,this.z=new m(this.input,ut)}var w=A;G.prototype.n=function(){var ot,st,ut,ft,yt,gt,Et,Rt=0;switch(Et=this.a,ot=Vt,ot){case Vt:st=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(ut=st<<4|ot,Et[Rt++]=ut,ot){case Vt:switch(this.h){case w.NONE:yt=0;break;case w.r:yt=1;break;case w.j:yt=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return ft=yt<<6|0,Et[Rt++]=ft|31-(256*ut+ft)%31,gt=a(this.input),this.z.b=Rt,Et=this.z.n(),Rt=Et.length,o&&(Et=new Uint8Array(Et.buffer),Et.length<=Rt+4&&(this.a=new Uint8Array(Et.length+4),this.a.set(Et),Et=this.a),Et=Et.subarray(0,Rt+4)),Et[Rt++]=gt>>24&255,Et[Rt++]=gt>>16&255,Et[Rt++]=gt>>8&255,Et[Rt++]=gt&255,Et},s("Zlib.Deflate",G),s("Zlib.Deflate.compress",function(ot,st){return new G(ot,st).n()}),s("Zlib.Deflate.CompressionType",w),s("Zlib.Deflate.CompressionType.NONE",w.NONE),s("Zlib.Deflate.CompressionType.FIXED",w.r),s("Zlib.Deflate.CompressionType.DYNAMIC",w.j);function O(ot,st){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=o?new Uint8Array(ot):ot,this.s=!1,this.m=Q,this.B=!1,(st||!(st={}))&&(st.index&&(this.c=st.index),st.bufferSize&&(this.l=st.bufferSize),st.bufferType&&(this.m=st.bufferType),st.resize&&(this.B=st.resize)),this.m){case j:this.b=32768,this.a=new(o?Uint8Array:Array)(32768+this.l+258);break;case Q:this.b=0,this.a=new(o?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var j=0,Q=1,C={D:j,C:Q};O.prototype.p=function(){for(;!this.s;){var ot=xt(this,3);switch(ot&1&&(this.s=r),ot>>>=1,ot){case 0:var st=this.input,ut=this.c,ft=this.a,yt=this.b,gt=e,Et=e,Rt=e,Wt=ft.length,Lt=e;switch(this.e=this.g=0,gt=st[ut++],gt===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),Et=gt,gt=st[ut++],gt===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),Et|=gt<<8,gt=st[ut++],gt===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),Rt=gt,gt=st[ut++],gt===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),Rt|=gt<<8,Et===~Rt&&t(Error("invalid uncompressed block header: length verify")),ut+Et>st.length&&t(Error("input buffer is broken")),this.m){case j:for(;yt+Et>ft.length;){if(Lt=Wt-yt,Et-=Lt,o)ft.set(st.subarray(ut,ut+Lt),yt),yt+=Lt,ut+=Lt;else for(;Lt--;)ft[yt++]=st[ut++];this.b=yt,ft=this.f(),yt=this.b}break;case Q:for(;yt+Et>ft.length;)ft=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(o)ft.set(st.subarray(ut,ut+Et),yt),yt+=Et,ut+=Et;else for(;Et--;)ft[yt++]=st[ut++];this.c=ut,this.b=yt,this.a=ft;break;case 1:this.o(ct,dt);break;case 2:lt(this);break;default:t(Error("unknown BTYPE: "+ot))}}return this.t()};var b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=o?new Uint16Array(b):b,S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],E=o?new Uint16Array(S):S,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],F=o?new Uint8Array(R):R,k=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],X=o?new Uint16Array(k):k,Z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=o?new Uint8Array(Z):Z,Y=new(o?Uint8Array:Array)(288),$,et;for($=0,et=Y.length;$<et;++$)Y[$]=143>=$?8:255>=$?9:279>=$?7:8;var ct=x(Y),ht=new(o?Uint8Array:Array)(30),pt,mt;for(pt=0,mt=ht.length;pt<mt;++pt)ht[pt]=5;var dt=x(ht);function xt(ot,st){for(var ut=ot.g,ft=ot.e,yt=ot.input,gt=ot.c,Et;ft<st;)Et=yt[gt++],Et===e&&t(Error("input buffer is broken")),ut|=Et<<ft,ft+=8;return Et=ut&(1<<st)-1,ot.g=ut>>>st,ot.e=ft-st,ot.c=gt,Et}function Tt(ot,st){for(var ut=ot.g,ft=ot.e,yt=ot.input,gt=ot.c,Et=st[0],Rt=st[1],Wt,Lt,Yt;ft<Rt;)Wt=yt[gt++],Wt===e&&t(Error("input buffer is broken")),ut|=Wt<<ft,ft+=8;return Lt=Et[ut&(1<<Rt)-1],Yt=Lt>>>16,ot.g=ut>>Yt,ot.e=ft-Yt,ot.c=gt,Lt&65535}function lt(ot){function st(Yt,Mt,Dt){var Ft,Ht,Xt,jt;for(jt=0;jt<Yt;)switch(Ft=Tt(this,Mt),Ft){case 16:for(Xt=3+xt(this,2);Xt--;)Dt[jt++]=Ht;break;case 17:for(Xt=3+xt(this,3);Xt--;)Dt[jt++]=0;Ht=0;break;case 18:for(Xt=11+xt(this,7);Xt--;)Dt[jt++]=0;Ht=0;break;default:Ht=Dt[jt++]=Ft}return Dt}var ut=xt(ot,5)+257,ft=xt(ot,5)+1,yt=xt(ot,4)+4,gt=new(o?Uint8Array:Array)(W.length),Et,Rt,Wt,Lt;for(Lt=0;Lt<yt;++Lt)gt[W[Lt]]=xt(ot,3);Et=x(gt),Rt=new(o?Uint8Array:Array)(ut),Wt=new(o?Uint8Array:Array)(ft),ot.o(x(st.call(ot,ut,Et,Rt)),x(st.call(ot,ft,Et,Wt)))}O.prototype.o=function(ot,st){var ut=this.a,ft=this.b;this.u=ot;for(var yt=ut.length-258,gt,Et,Rt,Wt;(gt=Tt(this,ot))!==256;)if(256>gt)ft>=yt&&(this.b=ft,ut=this.f(),ft=this.b),ut[ft++]=gt;else for(Et=gt-257,Wt=E[Et],0<F[Et]&&(Wt+=xt(this,F[Et])),gt=Tt(this,st),Rt=X[gt],0<V[gt]&&(Rt+=xt(this,V[gt])),ft>=yt&&(this.b=ft,ut=this.f(),ft=this.b);Wt--;)ut[ft]=ut[ft++-Rt];for(;8<=this.e;)this.e-=8,this.c--;this.b=ft},O.prototype.I=function(ot,st){var ut=this.a,ft=this.b;this.u=ot;for(var yt=ut.length,gt,Et,Rt,Wt;(gt=Tt(this,ot))!==256;)if(256>gt)ft>=yt&&(ut=this.f(),yt=ut.length),ut[ft++]=gt;else for(Et=gt-257,Wt=E[Et],0<F[Et]&&(Wt+=xt(this,F[Et])),gt=Tt(this,st),Rt=X[gt],0<V[gt]&&(Rt+=xt(this,V[gt])),ft+Wt>yt&&(ut=this.f(),yt=ut.length);Wt--;)ut[ft]=ut[ft++-Rt];for(;8<=this.e;)this.e-=8,this.c--;this.b=ft},O.prototype.f=function(){var ot=new(o?Uint8Array:Array)(this.b-32768),st=this.b-32768,ut,ft,yt=this.a;if(o)ot.set(yt.subarray(32768,ot.length));else for(ut=0,ft=ot.length;ut<ft;++ut)ot[ut]=yt[ut+32768];if(this.k.push(ot),this.q+=ot.length,o)yt.set(yt.subarray(st,st+32768));else for(ut=0;32768>ut;++ut)yt[ut]=yt[st+ut];return this.b=32768,yt},O.prototype.J=function(ot){var st,ut=this.input.length/this.c+1|0,ft,yt,gt,Et=this.input,Rt=this.a;return ot&&(typeof ot.v=="number"&&(ut=ot.v),typeof ot.F=="number"&&(ut+=ot.F)),2>ut?(ft=(Et.length-this.c)/this.u[2],gt=258*(ft/2)|0,yt=gt<Rt.length?Rt.length+gt:Rt.length<<1):yt=Rt.length*ut,o?(st=new Uint8Array(yt),st.set(Rt)):st=Rt,this.a=st},O.prototype.t=function(){var ot=0,st=this.a,ut=this.k,ft,yt=new(o?Uint8Array:Array)(this.q+(this.b-32768)),gt,Et,Rt,Wt;if(ut.length===0)return o?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(gt=0,Et=ut.length;gt<Et;++gt)for(ft=ut[gt],Rt=0,Wt=ft.length;Rt<Wt;++Rt)yt[ot++]=ft[Rt];for(gt=32768,Et=this.b;gt<Et;++gt)yt[ot++]=st[gt];return this.k=[],this.buffer=yt},O.prototype.H=function(){var ot,st=this.b;return o?this.B?(ot=new Uint8Array(st),ot.set(this.a.subarray(0,st))):ot=this.a.subarray(0,st):(this.a.length>st&&(this.a.length=st),ot=this.a),this.buffer=ot};function at(ot,st){var ut,ft;switch(this.input=ot,this.c=0,(st||!(st={}))&&(st.index&&(this.c=st.index),st.verify&&(this.M=st.verify)),ut=ot[this.c++],ft=ot[this.c++],ut&15){case Vt:this.method=Vt;break;default:t(Error("unsupported compression method"))}((ut<<8)+ft)%31!==0&&t(Error("invalid fcheck flag:"+((ut<<8)+ft)%31)),ft&32&&t(Error("fdict flag is not supported")),this.A=new O(ot,{index:this.c,bufferSize:st.bufferSize,bufferType:st.bufferType,resize:st.resize})}at.prototype.p=function(){var ot=this.input,st,ut;return st=this.A.p(),this.c=this.A.c,this.M&&(ut=(ot[this.c++]<<24|ot[this.c++]<<16|ot[this.c++]<<8|ot[this.c++])>>>0,ut!==a(st)&&t(Error("invalid adler-32 checksum"))),st},s("Zlib.Inflate",at),s("Zlib.Inflate.BufferType",C),C.ADAPTIVE=C.C,C.BLOCK=C.D,s("Zlib.Inflate.prototype.decompress",at.prototype.p);var At=new(o?Uint8Array:Array)(288),St,wt;for(St=0,wt=At.length;St<wt;++St)At[St]=143>=St?8:255>=St?9:279>=St?7:8;x(At);var Pt=new(o?Uint8Array:Array)(30),It,zt;for(It=0,zt=Pt.length;It<zt;++It)Pt[It]=5;x(Pt);var Vt=8}).call(globalThis);var _p=window;_p=_p.Zlib=_p.Zlib;_p.Deflate=_p.Deflate;_p.Deflate.compress=_p.Deflate.compress;_p.Inflate=_p.Inflate;_p.Inflate.BufferType=_p.Inflate.BufferType;_p.Inflate.prototype.decompress=_p.Inflate.prototype.decompress;exports.cc.PNGReader=exports.cc.Class.extend({ctor:function(t){var e,r,n,s,o,a,c,l,h,u,_,d,f;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(e=this.readUInt32(),l=function(){var T,x;for(x=[],T=0;T<4;++T)x.push(String.fromCharCode(this.data[this.pos++]));return x}.call(this).join(""),l){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},s=this.readUInt16(),n=this.readUInt16()||100,o.delay=1e3*s/n,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for(l==="fdAT"&&(this.pos+=4,e-=4),t=(o!=null?o.data:void 0)||this.imgData,_=0;0<=e?_<e:_>e;0<=e?++_:--_)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),h=255-this.transparency.indexed.length,h>0)for(d=0;0<=h?d<h:d>h;0<=h?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":u=this.read(e),a=u.indexOf(0),c=String.fromCharCode.apply(String,u.slice(0,a)),this.text[c]=String.fromCharCode.apply(String,u.slice(a+1));break;case"IEND":o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(f=this.colorType)===4||f===6,r=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*r,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData));return;default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;0<=t?++e:--e)r.push(this.data[this.pos++]);return r},readUInt32:function(){var t,e,r,n;return t=this.data[this.pos++]<<24,e=this.data[this.pos++]<<16,r=this.data[this.pos++]<<8,n=this.data[this.pos++],t|e|r|n},readUInt16:function(){var t,e;return t=this.data[this.pos++]<<8,e=this.data[this.pos++],t|e},decodePixels:function(t){var e,r,n,s,o,a,c,l,h,u,_,d,f,T,x,m,v,A,D,N,z,M,J;if(t==null&&(t=this.imgData),t.length===0)return new Uint8Array(0);var U=new Zlib.Inflate(t,{index:0,verify:!1});for(t=U.decompress(),d=this.pixelBitlength/8,m=d*this.width,f=new Uint8Array(m*this.height),a=t.length,x=0,T=0,r=0;T<a;){switch(t[T++]){case 0:for(s=D=0;D<m;s=D+=1)f[r++]=t[T++];break;case 1:for(s=N=0;N<m;s=N+=1)e=t[T++],o=s<d?0:f[r-d],f[r++]=(e+o)%256;break;case 2:for(s=z=0;z<m;s=z+=1)e=t[T++],n=(s-s%d)/d,v=x&&f[(x-1)*m+n*d+s%d],f[r++]=(v+e)%256;break;case 3:for(s=M=0;M<m;s=M+=1)e=t[T++],n=(s-s%d)/d,o=s<d?0:f[r-d],v=x&&f[(x-1)*m+n*d+s%d],f[r++]=(e+Math.floor((o+v)/2))%256;break;case 4:for(s=J=0;J<m;s=J+=1)e=t[T++],n=(s-s%d)/d,o=s<d?0:f[r-d],x===0?v=A=0:(v=f[(x-1)*m+n*d+s%d],A=n&&f[(x-1)*m+(n-1)*d+s%d]),c=o+v-A,l=Math.abs(c-o),u=Math.abs(c-v),_=Math.abs(c-A),l<=u&&l<=_?h=o:u<=_?h=v:h=A,f[r++]=(e+h)%256;break;default:throw new Error("Invalid filter algorithm: "+t[T-1])}x++}return f},copyToImageData:function(t,e){var r,n,s,o,a,c,l,h,u,_,d;if(n=this.colors,u=null,r=this.hasAlphaChannel,this.palette.length&&(u=(d=this._decodedPalette)!=null?d:this._decodedPalette=this.decodePalette(),n=4,r=!0),s=t.data||t,h=s.length,a=u||e,o=c=0,n===1)for(;o<h;)l=u?e[o/4]*4:c,_=a[l++],s[o++]=_,s[o++]=_,s[o++]=_,s[o++]=r?a[l++]:255,c=l;else for(;o<h;)l=u?e[o/4]*4:c,s[o++]=a[l++],s[o++]=a[l++],s[o++]=a[l++],s[o++]=r?a[l++]:255,c=l},decodePalette:function(){var t,e,r,n,s,o,a,c,l;for(r=this.palette,o=this.transparency.indexed||[],s=new Uint8Array((o.length||0)+r.length),n=0,t=0,e=a=0,c=r.length;a<c;e=a+=3)s[n++]=r[e],s[n++]=r[e+1],s[n++]=r[e+2],s[n++]=(l=o[t++])!=null?l:255;return s},render:function(t){var e,r;return t.width=this.width,t.height=this.height,e=t.getContext("2d"),r=e.createImageData(this.width,this.height),this.copyToImageData(r,this.decodePixels()),e.putImageData(r,0,0)}});exports.cc.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(t){return this._tiffData[t]},getUint16:function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},getUint32:function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},checkLittleEndian:function(){var t=this.getUint16(0);if(t===18761)this.littleEndian=!0;else if(t===19789)this.littleEndian=!1;else throw console.log(t),TypeError("Invalid byte order value.");return this.littleEndian},hasTowel:function(){if(this.getUint16(2)!==42)throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(t){var e=this.fieldTypeNames;return t in e?e[t]:null},getFieldTagName:function(t){var e=this.fieldTagNames;return t in e?e[t]:(console.log("Unknown Field Tag:",t),"Tag"+t)},getFieldTypeLength:function(t){return["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)!==-1?1:["SHORT","SSHORT"].indexOf(t)!==-1?2:["LONG","SLONG","FLOAT"].indexOf(t)!==-1?4:["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)!==-1?8:null},getFieldValues:function(t,e,r,n){var s=[],o=this.getFieldTypeLength(e),a=o*r;if(a<=4)this.littleEndian===!1?s.push(n>>>(4-o)*8):s.push(n);else for(var c=0;c<r;c++){var l=o*c;o>=8?["RATIONAL","SRATIONAL"].indexOf(e)!==-1?(s.push(this.getUint32(n+l)),s.push(this.getUint32(n+l+4))):exports.cc.log("Can't handle this field type or size"):s.push(this.getBytes(o,n+l))}return e==="ASCII"&&s.forEach(function(h,u,_){_[u]=String.fromCharCode(h)}),s},getBytes:function(t,e){if(t<=0)exports.cc.log("No bytes requested");else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);exports.cc.log("Too many bytes requested")}},getBits:function(t,e,r){r=r||0;var n=Math.floor(r/8),s=e+n,o=r+t,a=32-t,c,l;return o<=0?console.log("No bits requested"):o<=8?(c=24+r,l=this.getUint8(s)):o<=16?(c=16+r,l=this.getUint16(s)):o<=32?(c=r,l=this.getUint32(s)):console.log("Too many bits requested"),{bits:l<<c>>>a,byteOffset:s+Math.floor(o/8),bitOffset:o%8}},parseFileDirectory:function(t){for(var e=this.getUint16(t),r=[],n=t+2,s=0;s<e;n+=12,s++){var o=this.getUint16(n),a=this.getUint16(n+2),c=this.getUint32(n+4),l=this.getUint32(n+8),h=this.getFieldTagName(o),u=this.getFieldTypeName(a),_=this.getFieldValues(h,u,c,l);r[h]={type:u,values:_}}this._fileDirectories.push(r);var d=this.getUint32(n);d!==0&&this.parseFileDirectory(d)},clampColorSample:function(t,e){var r=Math.pow(2,8-e);return Math.floor(t*r+(r-1))},parseTIFF:function(t,e){if(e=e||document.createElement("canvas"),this._tiffData=t,this.canvas=e,this.checkLittleEndian(),!!this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],s=n.ImageWidth.values[0],o=n.ImageLength.values[0];this.canvas.width=s,this.canvas.height=o;var a=[],c=n.Compression?n.Compression.values[0]:1,l=n.SamplesPerPixel.values[0],h=[],u=0,_=!1;if(n.BitsPerSample.values.forEach(function(St,wt,Pt){h[wt]={bitsPerSample:St,hasBytesPerSample:!1,bytesPerSample:void 0},St%8===0&&(h[wt].hasBytesPerSample=!0,h[wt].bytesPerSample=St/8),u+=St},this),u%8===0){_=!0;var d=u/8}var f=n.StripOffsets.values,T=f.length;if(n.StripByteCounts)var x=n.StripByteCounts.values;else if(exports.cc.log("Missing StripByteCounts!"),T===1)var x=[Math.ceil(s*o*u/8)];else throw Error("Cannot recover from missing StripByteCounts");for(var m=0;m<T;m++){var v=f[m];a[m]=[];for(var A=x[m],D=0,N=0,z=1,M=!0,J=[],U=0,K=0,tt=0;D<A;D+=z)switch(c){case 1:for(var rt=0,J=[];rt<l;rt++)if(h[rt].hasBytesPerSample){var I=h[rt].bytesPerSample*rt;J.push(this.getBytes(h[rt].bytesPerSample,v+D+I))}else{var L=this.getBits(h[rt].bitsPerSample,v+D,N);throw J.push(L.bits),D=L.byteOffset-v,N=L.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}if(a[m].push(J),_)z=d;else throw z=0,RangeError("Cannot handle sub-byte bits per pixel");break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(M){M=!1;var G=1,w=1,O=this.getInt8(v+D);O>=0&&O<=127?G=O+1:O>=-127&&O<=-1?w=-O+1:M=!0}else{for(var j=this.getUint8(v+D),rt=0;rt<w;rt++){if(h[K].hasBytesPerSample)tt=tt<<8*U|j,U++,U===h[K].bytesPerSample&&(J.push(tt),tt=U=0,K++);else throw RangeError("Cannot handle sub-byte bits per sample");K===l&&(a[m].push(J),J=[],K=0)}G--,G===0&&(M=!0)}z=1;break}}if(e.getContext){var Q=this.canvas.getContext("2d");Q.fillStyle="rgba(255, 255, 255, 0)";var C=n.RowsPerStrip?n.RowsPerStrip.values[0]:o,b=a.length,W=o%C,S=W===0?C:W,E=C,R=0,F=n.PhotometricInterpretation.values[0],k=[],X=0;if(n.ExtraSamples&&(k=n.ExtraSamples.values,X=k.length),n.ColorMap)var Z=n.ColorMap.values,V=Math.pow(2,h[0].bitsPerSample);for(var m=0;m<b;m++){m+1===b&&(E=S);for(var Y=a[m].length,$=R*m,et=0,ct=0;ct<Y;et++)for(var ht=0;ht<s;ht++,ct++){var pt=a[m][ct],mt=0,dt=0,xt=0,Tt=1;if(X>0){for(var lt=0;lt<X;lt++)if(k[lt]===1||k[lt]===2){Tt=pt[3+lt]/256;break}}switch(F){case 0:if(h[0].hasBytesPerSample)var at=Math.pow(16,h[0].bytesPerSample*2);pt.forEach(function(wt,Pt,It){It[Pt]=at-wt});case 1:mt=dt=xt=this.clampColorSample(pt[0],h[0].bitsPerSample);break;case 2:mt=this.clampColorSample(pt[0],h[0].bitsPerSample),dt=this.clampColorSample(pt[1],h[1].bitsPerSample),xt=this.clampColorSample(pt[2],h[2].bitsPerSample);break;case 3:if(Z===void 0)throw Error("Palette image missing color map");var At=pt[0];mt=this.clampColorSample(Z[At],16),dt=this.clampColorSample(Z[V+At],16),xt=this.clampColorSample(Z[2*V+At],16);break;default:throw RangeError("Unknown Photometric Interpretation:",F)}Q.fillStyle="rgba("+mt+", "+dt+", "+xt+", "+Tt+")",Q.fillRect(ht,$+et,1,1)}R=E}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};exports.cc.Particle=function(t,e,r,n,s,o,a,c,l,h,u,_){this.pos=t||exports.cc.p(0,0),this.startPos=e||exports.cc.p(0,0),this.color=r||{r:0,g:0,b:0,a:255},this.deltaColor=n||{r:0,g:0,b:0,a:255},this.size=s||0,this.deltaSize=o||0,this.rotation=a||0,this.deltaRotation=c||0,this.timeToLive=l||0,this.atlasIndex=h||0,this.modeA=u||new exports.cc.Particle.ModeA,this.modeB=_||new exports.cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=exports.cc.p(0,0)};exports.cc.Particle.ModeA=function(t,e,r){this.dir=t||exports.cc.p(0,0),this.radialAccel=e||0,this.tangentialAccel=r||0};exports.cc.Particle.ModeB=function(t,e,r,n){this.angle=t||0,this.degreesPerSecond=e||0,this.radius=r||0,this.deltaRadius=n||0};exports.cc.Particle.TemporaryPoints=[exports.cc.p(),exports.cc.p(),exports.cc.p(),exports.cc.p()];exports.cc.ParticleSystem=exports.cc.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:exports.cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(t){if(exports.cc.Node.prototype.ctor.call(this),this.emitterMode=exports.cc.ParticleSystem.MODE_GRAVITY,this.modeA=new exports.cc.ParticleSystem.ModeA,this.modeB=new exports.cc.ParticleSystem.ModeB,this._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},this._particles=[],this._sourcePosition=exports.cc.p(0,0),this._posVar=exports.cc.p(0,0),this._startColor=exports.cc.color(255,255,255,255),this._startColorVar=exports.cc.color(255,255,255,255),this._endColor=exports.cc.color(255,255,255,255),this._endColorVar=exports.cc.color(255,255,255,255),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=exports.cc.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this.atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0,this._isActive=!1,this.particleCount=0,this.duration=0,this.life=0,this.lifeVar=0,this.angle=0,this.angleVar=0,this.startSize=0,this.startSizeVar=0,this.endSize=0,this.endSizeVar=0,this.startSpin=0,this.startSpinVar=0,this.endSpin=0,this.endSpinVar=0,this.emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this.positionType=exports.cc.ParticleSystem.TYPE_FREE,this.autoRemoveOnFinish=!1,this._textureLoaded=!0,!t||exports.cc.isNumber(t)){var e=t||100;this.setDrawMode(exports.cc.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(e)}else exports.cc.isString(t)?this.initWithFile(t):exports.cc.isObject(t)&&this.initWithDictionary(t,"")},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ParticleSystem.CanvasRenderCmd(this):new exports.cc.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(t){this._dontTint=t},initTexCoordsWithRect:function(t){this._renderCmd.initTexCoordsWithRect(t)},getBatchNode:function(){return this._batchNode},setBatchNode:function(t){this._renderCmd.setBatchNode(t)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(t){this._renderCmd.setDrawMode(t)},getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(t){this._renderCmd.setShapeType(t)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(t){this.particleCount=t},getDuration:function(){return this.duration},setDuration:function(t){this.duration=t},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(t){this._sourcePosition=t},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(t){this._posVar=t},getLife:function(){return this.life},setLife:function(t){this.life=t},getLifeVar:function(){return this.lifeVar},setLifeVar:function(t){this.lifeVar=t},getAngle:function(){return this.angle},setAngle:function(t){this.angle=t},getAngleVar:function(){return this.angleVar},setAngleVar:function(t){this.angleVar=t},getGravity:function(){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var t=this.modeA.gravity;return exports.cc.p(t.x,t.y)},setGravity:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity"),this.modeA.gravity=t},getSpeed:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity"),this.modeA.speed=t},getSpeedVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar=t},getTangentialAccel:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel=t},getTangentialAccelVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=t},getRadialAccel:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel=t},getRadialAccelVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar=t},getRotationIsDir:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir},setRotationIsDir:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_GRAVITY&&exports.cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir=t},getStartRadius:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius},setStartRadius:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius=t},getStartRadiusVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar},setStartRadiusVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar=t},getEndRadius:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius},setEndRadius:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius=t},getEndRadiusVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar},setEndRadiusVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar=t},getRotatePerSecond:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond},setRotatePerSecond:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond=t},getRotatePerSecondVar:function(){return this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(t){this.emitterMode!==exports.cc.ParticleSystem.MODE_RADIUS&&exports.cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar=t},setScale:function(t,e){this._transformSystemDirty=!0,exports.cc.Node.prototype.setScale.call(this,t,e)},setRotation:function(t){this._transformSystemDirty=!0,exports.cc.Node.prototype.setRotation.call(this,t)},setScaleX:function(t){this._transformSystemDirty=!0,exports.cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._transformSystemDirty=!0,exports.cc.Node.prototype.setScaleY.call(this,t)},getStartSize:function(){return this.startSize},setStartSize:function(t){this.startSize=t},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(t){this.startSizeVar=t},getEndSize:function(){return this.endSize},setEndSize:function(t){this.endSize=t},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(t){this.endSizeVar=t},getStartColor:function(){return exports.cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(t){this._startColor=exports.cc.color(t)},getStartColorVar:function(){return exports.cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},setStartColorVar:function(t){this._startColorVar=exports.cc.color(t)},getEndColor:function(){return exports.cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(t){this._endColor=exports.cc.color(t)},getEndColorVar:function(){return exports.cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(t){this._endColorVar=exports.cc.color(t)},getStartSpin:function(){return this.startSpin},setStartSpin:function(t){this.startSpin=t},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(t){this.startSpinVar=t},getEndSpin:function(){return this.endSpin},setEndSpin:function(t){this.endSpin=t},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(t){this.endSpinVar=t},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(t){this.emissionRate=t},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(t){this._renderCmd.setTotalParticles(t)},getTexture:function(){return this._texture},setTexture:function(t){t&&(t.isLoaded()?this.setTextureWithRect(t,exports.cc.rect(0,0,t.width,t.height)):(this._textureLoaded=!1,t.addEventListener("load",function(e){this._textureLoaded=!0,this.setTextureWithRect(e,exports.cc.rect(0,0,e.width,e.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){e===void 0?this._blendFunc!==t&&(this._blendFunc=t,this._updateBlendFunc()):(this._blendFunc.src!==t||this._blendFunc.dst!==e)&&(this._blendFunc={src:t,dst:e},this._updateBlendFunc())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t},isBlendAdditive:function(){return this._blendFunc.src===exports.cc.SRC_ALPHA&&this._blendFunc.dst===exports.cc.ONE||this._blendFunc.src===exports.cc.ONE&&this._blendFunc.dst===exports.cc.ONE},setBlendAdditive:function(t){var e=this._blendFunc;t?(e.src=exports.cc.SRC_ALPHA,e.dst=exports.cc.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(t){this.positionType=t},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(t){this.autoRemoveOnFinish=t},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(t){this.emitterMode=t},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(t){this._plistFile=t;var e=exports.cc.loader.getRes(t);return e?this.initWithDictionary(e,""):(exports.cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return exports.cc.rect(0,0,exports.cc._canvas.width,exports.cc._canvas.height)},initWithDictionary:function(t,e){var r=!1,n=null,s=this._valueForKey,o=parseInt(s("maxParticles",t));if(this.initWithTotalParticles(o)){this.angle=parseFloat(s("angle",t)),this.angleVar=parseFloat(s("angleVariance",t)),this.duration=parseFloat(s("duration",t)),this._blendFunc.src=parseInt(s("blendFuncSource",t)),this._blendFunc.dst=parseInt(s("blendFuncDestination",t));var a=this._startColor;a.r=parseFloat(s("startColorRed",t))*255,a.g=parseFloat(s("startColorGreen",t))*255,a.b=parseFloat(s("startColorBlue",t))*255,a.a=parseFloat(s("startColorAlpha",t))*255;var c=this._startColorVar;c.r=parseFloat(s("startColorVarianceRed",t))*255,c.g=parseFloat(s("startColorVarianceGreen",t))*255,c.b=parseFloat(s("startColorVarianceBlue",t))*255,c.a=parseFloat(s("startColorVarianceAlpha",t))*255;var l=this._endColor;l.r=parseFloat(s("finishColorRed",t))*255,l.g=parseFloat(s("finishColorGreen",t))*255,l.b=parseFloat(s("finishColorBlue",t))*255,l.a=parseFloat(s("finishColorAlpha",t))*255;var h=this._endColorVar;if(h.r=parseFloat(s("finishColorVarianceRed",t))*255,h.g=parseFloat(s("finishColorVarianceGreen",t))*255,h.b=parseFloat(s("finishColorVarianceBlue",t))*255,h.a=parseFloat(s("finishColorVarianceAlpha",t))*255,this.startSize=parseFloat(s("startParticleSize",t)),this.startSizeVar=parseFloat(s("startParticleSizeVariance",t)),this.endSize=parseFloat(s("finishParticleSize",t)),this.endSizeVar=parseFloat(s("finishParticleSizeVariance",t)),this.setPosition(parseFloat(s("sourcePositionx",t)),parseFloat(s("sourcePositiony",t))),this._posVar.x=parseFloat(s("sourcePositionVariancex",t)),this._posVar.y=parseFloat(s("sourcePositionVariancey",t)),this.startSpin=parseFloat(s("rotationStart",t)),this.startSpinVar=parseFloat(s("rotationStartVariance",t)),this.endSpin=parseFloat(s("rotationEnd",t)),this.endSpinVar=parseFloat(s("rotationEndVariance",t)),this.emitterMode=parseInt(s("emitterType",t)),this.emitterMode===exports.cc.ParticleSystem.MODE_GRAVITY){var u=this.modeA;u.gravity.x=parseFloat(s("gravityx",t)),u.gravity.y=parseFloat(s("gravityy",t)),u.speed=parseFloat(s("speed",t)),u.speedVar=parseFloat(s("speedVariance",t));var _=s("radialAcceleration",t);u.radialAccel=_?parseFloat(_):0,_=s("radialAccelVariance",t),u.radialAccelVar=_?parseFloat(_):0,_=s("tangentialAcceleration",t),u.tangentialAccel=_?parseFloat(_):0,_=s("tangentialAccelVariance",t),u.tangentialAccelVar=_?parseFloat(_):0;var d=s("rotationIsDir",t).toLowerCase();u.rotationIsDir=d!=null&&(d==="true"||d==="1")}else if(this.emitterMode===exports.cc.ParticleSystem.MODE_RADIUS){var f=this.modeB;f.startRadius=parseFloat(s("maxRadius",t)),f.startRadiusVar=parseFloat(s("maxRadiusVariance",t)),f.endRadius=parseFloat(s("minRadius",t)),f.endRadiusVar=0,f.rotatePerSecond=parseFloat(s("rotatePerSecond",t)),f.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",t))}else return exports.cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;if(this.life=parseFloat(s("particleLifespan",t)),this.lifeVar=parseFloat(s("particleLifespanVariance",t)),this.emissionRate=this._totalParticles/this.life,!this._batchNode){this._opacityModifyRGB=!1;var T=s("textureFileName",t),x=exports.cc.path.changeBasename(this._plistFile,T),m=exports.cc.textureCache.getTextureForKey(x);if(m)this.setTexture(m);else{var v=s("textureImageData",t);if(!v||v.length===0){if(m=exports.cc.textureCache.addImage(x),!m)return!1;this.setTexture(m)}else{if(n=exports.cc.unzipBase64AsArray(v,1),!n)return exports.cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var A=exports.cc.getImageFormatByData(n);if(A!==exports.cc.FMT_TIFF&&A!==exports.cc.FMT_PNG)return exports.cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var D=document.createElement("canvas");if(A===exports.cc.FMT_PNG){var N=new exports.cc.PNGReader(n);N.render(D)}else{var z=exports.cc.tiffReader;z.parseTIFF(n,D)}exports.cc.textureCache.cacheImage(x,D);var M=exports.cc.textureCache.getTextureForKey(x);M||exports.cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(M)}}}r=!0}return r},initWithTotalParticles:function(t){this._totalParticles=t;var e,r=this._particles;for(r.length=0,e=0;e<t;e++)r[e]=new exports.cc.Particle;if(!r)return exports.cc.log("Particle system: not enough memory"),!1;if(this._allocatedParticles=t,this._batchNode)for(e=0;e<this._totalParticles;e++)r[e].atlasIndex=e;return this._isActive=!0,this._blendFunc.src=exports.cc.BLEND_SRC,this._blendFunc.dst=exports.cc.BLEND_DST,this.positionType=exports.cc.ParticleSystem.TYPE_FREE,this.emitterMode=exports.cc.ParticleSystem.MODE_GRAVITY,this.autoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1),this._renderCmd._initWithTotalParticles(t),!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var t=this._renderCmd.addParticle();return this.initParticle(t),++this.particleCount,!0},initParticle:function(t){var e=exports.cc.randomMinus1To1;t.timeToLive=this.life+this.lifeVar*e(),t.timeToLive=Math.max(0,t.timeToLive),t.pos.x=this._sourcePosition.x+this._posVar.x*e(),t.pos.y=this._sourcePosition.y+this._posVar.y*e();var r,n,s=this._startColor,o=this._startColorVar,a=this._endColor,c=this._endColorVar;r={r:exports.cc.clampf(s.r+o.r*e(),0,255),g:exports.cc.clampf(s.g+o.g*e(),0,255),b:exports.cc.clampf(s.b+o.b*e(),0,255),a:exports.cc.clampf(s.a+o.a*e(),0,255)},n={r:exports.cc.clampf(a.r+c.r*e(),0,255),g:exports.cc.clampf(a.g+c.g*e(),0,255),b:exports.cc.clampf(a.b+c.b*e(),0,255),a:exports.cc.clampf(a.a+c.a*e(),0,255)},t.color=r;var l=t.deltaColor,h=t.timeToLive;l.r=(n.r-r.r)/h,l.g=(n.g-r.g)/h,l.b=(n.b-r.b)/h,l.a=(n.a-r.a)/h;var u=this.startSize+this.startSizeVar*e();if(u=Math.max(0,u),t.size=u,this.endSize===exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE)t.deltaSize=0;else{var _=this.endSize+this.endSizeVar*e();_=Math.max(0,_),t.deltaSize=(_-u)/h}var d=this.startSpin+this.startSpinVar*e(),f=this.endSpin+this.endSpinVar*e();t.rotation=d,t.deltaRotation=(f-d)/h,this.positionType===exports.cc.ParticleSystem.TYPE_FREE?t.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===exports.cc.ParticleSystem.TYPE_RELATIVE&&(t.startPos.x=this._position.x,t.startPos.y=this._position.y);var T=exports.cc.degreesToRadians(this.angle+this.angleVar*e());if(this.emitterMode===exports.cc.ParticleSystem.MODE_GRAVITY){var x=this.modeA,m=t.modeA,v=x.speed+x.speedVar*e();m.dir.x=Math.cos(T),m.dir.y=Math.sin(T),exports.cc.pMultIn(m.dir,v),m.radialAccel=x.radialAccel+x.radialAccelVar*e(),m.tangentialAccel=x.tangentialAccel+x.tangentialAccelVar*e(),x.rotationIsDir&&(t.rotation=-exports.cc.radiansToDegrees(exports.cc.pToAngle(m.dir)))}else{var A=this.modeB,D=t.modeB,N=A.startRadius+A.startRadiusVar*e(),z=A.endRadius+A.endRadiusVar*e();D.radius=N,D.deltaRadius=A.endRadius===exports.cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(z-N)/h,D.angle=T,D.degreesPerSecond=exports.cc.degreesToRadians(A.rotatePerSecond+A.rotatePerSecondVar*e())}},stopSystem:function(){this._isActive=!1,this._elapsed=this.duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var t=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)t[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=this._totalParticles},updateQuadWithParticle:function(t,e){this._renderCmd.updateQuadWithParticle(t,e)},postStep:function(){this._renderCmd.postStep()},update:function(t){if(this._isActive&&this.emissionRate){var e=1/this.emissionRate;for(this.particleCount<this._totalParticles&&(this._emitCounter+=t);this.particleCount<this._totalParticles&&this._emitCounter>e;)this.addParticle(),this._emitCounter-=e;this._elapsed+=t,this.duration!==-1&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var r=exports.cc.Particle.TemporaryPoints[0];if(this.positionType===exports.cc.ParticleSystem.TYPE_FREE?exports.cc.pIn(r,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===exports.cc.ParticleSystem.TYPE_RELATIVE&&(r.x=this._position.x,r.y=this._position.y),this._visible){for(var n=exports.cc.Particle.TemporaryPoints[1],s=exports.cc.Particle.TemporaryPoints[2],o=exports.cc.Particle.TemporaryPoints[3],a=this._particles;this._particleIdx<this.particleCount;){exports.cc.pZeroIn(n),exports.cc.pZeroIn(s),exports.cc.pZeroIn(o);var c=a[this._particleIdx];if(c.timeToLive-=t,c.timeToLive>0){if(this.emitterMode===exports.cc.ParticleSystem.MODE_GRAVITY){var l=o,h=n,u=s;c.pos.x||c.pos.y?(exports.cc.pIn(h,c.pos),exports.cc.pNormalizeIn(h)):exports.cc.pZeroIn(h),exports.cc.pIn(u,h),exports.cc.pMultIn(h,c.modeA.radialAccel);var _=u.x;u.x=-u.y,u.y=_,exports.cc.pMultIn(u,c.modeA.tangentialAccel),exports.cc.pIn(l,h),exports.cc.pAddIn(l,u),exports.cc.pAddIn(l,this.modeA.gravity),exports.cc.pMultIn(l,t),exports.cc.pAddIn(c.modeA.dir,l),exports.cc.pIn(l,c.modeA.dir),exports.cc.pMultIn(l,t),exports.cc.pAddIn(c.pos,l)}else{var d=c.modeB;d.angle+=d.degreesPerSecond*t,d.radius+=d.deltaRadius*t,c.pos.x=-Math.cos(d.angle)*d.radius,c.pos.y=-Math.sin(d.angle)*d.radius}this._renderCmd._updateDeltaColor(c,t),c.size+=c.deltaSize*t,c.size=Math.max(0,c.size),c.rotation+=c.deltaRotation*t;var f=n;if(this.positionType===exports.cc.ParticleSystem.TYPE_FREE||this.positionType===exports.cc.ParticleSystem.TYPE_RELATIVE){var T=s;exports.cc.pIn(T,r),exports.cc.pSubIn(T,c.startPos),exports.cc.pIn(f,c.pos),exports.cc.pSubIn(f,T)}else exports.cc.pIn(f,c.pos);this._batchNode&&(f.x+=this._position.x,f.y+=this._position.y),this._renderCmd.updateParticlePosition(c,f),++this._particleIdx}else{var x=c.atlasIndex;if(this._particleIdx!==this.particleCount-1){var m=a[this._particleIdx];a[this._particleIdx]=a[this.particleCount-1],a[this.particleCount-1]=m}if(this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+x),a[this.particleCount-1].atlasIndex=x),--this.particleCount,this.particleCount===0&&this.autoRemoveOnFinish){this.unscheduleUpdate(),this._parent.removeChild(this,!0);return}}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(t,e){if(e){var r=e[t];return r!=null?r:""}return""},_updateBlendFunc:function(){if(this._batchNode){exports.cc.log("Can't change blending functions when the particle is being batched");return}var t=this._texture;if(t&&t instanceof exports.cc.Texture2D){this._opacityModifyRGB=!1;var e=this._blendFunc;e.src===exports.cc.BLEND_SRC&&e.dst===exports.cc.BLEND_DST&&(t.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(e.src=exports.cc.SRC_ALPHA,e.dst=exports.cc.ONE_MINUS_SRC_ALPHA))}},clone:function(){var t=new exports.cc.ParticleSystem;if(t.initWithTotalParticles(this.getTotalParticles())){t.setAngle(this.getAngle()),t.setAngleVar(this.getAngleVar()),t.setDuration(this.getDuration());var e=this.getBlendFunc();if(t.setBlendFunc(e.src,e.dst),t.setStartColor(this.getStartColor()),t.setStartColorVar(this.getStartColorVar()),t.setEndColor(this.getEndColor()),t.setEndColorVar(this.getEndColorVar()),t.setStartSize(this.getStartSize()),t.setStartSizeVar(this.getStartSizeVar()),t.setEndSize(this.getEndSize()),t.setEndSizeVar(this.getEndSizeVar()),t.setPosition(exports.cc.p(this.x,this.y)),t.setPosVar(exports.cc.p(this.getPosVar().x,this.getPosVar().y)),t.setPositionType(this.getPositionType()),t.setStartSpin(this.getStartSpin()||0),t.setStartSpinVar(this.getStartSpinVar()||0),t.setEndSpin(this.getEndSpin()||0),t.setEndSpinVar(this.getEndSpinVar()||0),t.setEmitterMode(this.getEmitterMode()),this.getEmitterMode()===exports.cc.ParticleSystem.MODE_GRAVITY){var r=this.getGravity();t.setGravity(exports.cc.p(r.x,r.y)),t.setSpeed(this.getSpeed()),t.setSpeedVar(this.getSpeedVar()),t.setRadialAccel(this.getRadialAccel()),t.setRadialAccelVar(this.getRadialAccelVar()),t.setTangentialAccel(this.getTangentialAccel()),t.setTangentialAccelVar(this.getTangentialAccelVar())}else this.getEmitterMode()===exports.cc.ParticleSystem.MODE_RADIUS&&(t.setStartRadius(this.getStartRadius()),t.setStartRadiusVar(this.getStartRadiusVar()),t.setEndRadius(this.getEndRadius()),t.setEndRadiusVar(this.getEndRadiusVar()),t.setRotatePerSecond(this.getRotatePerSecond()),t.setRotatePerSecondVar(this.getRotatePerSecondVar()));if(t.setLife(this.getLife()),t.setLifeVar(this.getLifeVar()),t.setEmissionRate(this.getEmissionRate()),!this.getBatchNode()){t.setOpacityModifyRGB(this.isOpacityModifyRGB());var n=this.getTexture();if(n){var s=n.getContentSize();t.setTextureWithRect(n,exports.cc.rect(0,0,s.width,s.height))}}}return t},setDisplayFrame:function(t){if(t){var e=t.getOffsetInPixels();(e.x!==0||e.y!==0)&&exports.cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");var r=t.getTexture(),n=this._texture;n!==r&&this.setTexture(r)}},setTextureWithRect:function(t,e){var r=this._texture;r!==t&&(this._texture=t,this._updateBlendFunc()),this.initTexCoordsWithRect(e)},listenBackToForeground:function(t){}});var _p=exports.cc.ParticleSystem.prototype;_p.opacityModifyRGB;exports.cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB);_p.batchNode;exports.cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode);_p.drawMode;exports.cc.defineGetterSetter(_p,"drawMode",_p.getDrawMode,_p.setDrawMode);_p.shapeType;exports.cc.defineGetterSetter(_p,"shapeType",_p.getShapeType,_p.setShapeType);_p.active;exports.cc.defineGetterSetter(_p,"active",_p.isActive);_p.sourcePos;exports.cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition);_p.posVar;exports.cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar);_p.gravity;exports.cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity);_p.speed;exports.cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed);_p.speedVar;exports.cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar);_p.tangentialAccel;exports.cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel);_p.tangentialAccelVar;exports.cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar);_p.radialAccel;exports.cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel);_p.radialAccelVar;exports.cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar);_p.rotationIsDir;exports.cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir);_p.startRadius;exports.cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius);_p.startRadiusVar;exports.cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar);_p.endRadius;exports.cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius);_p.endRadiusVar;exports.cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar);_p.rotatePerS;exports.cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond);_p.rotatePerSVar;exports.cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar);_p.startColor;exports.cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor);_p.startColorVar;exports.cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar);_p.endColor;exports.cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor);_p.endColorVar;exports.cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar);_p.totalParticles;exports.cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles);_p.texture;exports.cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);exports.cc.ParticleSystem.create=function(t){return new exports.cc.ParticleSystem(t)};exports.cc.ParticleSystem.createWithTotalParticles=exports.cc.ParticleSystem.create;exports.cc.ParticleSystem.ModeA=function(t,e,r,n,s,o,a,c){this.gravity=t||exports.cc.p(0,0),this.speed=e||0,this.speedVar=r||0,this.tangentialAccel=n||0,this.tangentialAccelVar=s||0,this.radialAccel=o||0,this.radialAccelVar=a||0,this.rotationIsDir=c||!1};exports.cc.ParticleSystem.ModeB=function(t,e,r,n,s,o){this.startRadius=t||0,this.startRadiusVar=e||0,this.endRadius=r||0,this.endRadiusVar=n||0,this.rotatePerSecond=s||0,this.rotatePerSecondVar=o||0};exports.cc.ParticleSystem.SHAPE_MODE=0;exports.cc.ParticleSystem.TEXTURE_MODE=1;exports.cc.ParticleSystem.STAR_SHAPE=0;exports.cc.ParticleSystem.BALL_SHAPE=1;exports.cc.ParticleSystem.DURATION_INFINITY=-1;exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1;exports.cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1;exports.cc.ParticleSystem.MODE_GRAVITY=0;exports.cc.ParticleSystem.MODE_RADIUS=1;exports.cc.ParticleSystem.TYPE_FREE=0;exports.cc.ParticleSystem.TYPE_RELATIVE=1;exports.cc.ParticleSystem.TYPE_GROUPED=2;(function(){exports.cc.ParticleSystem.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._drawMode=exports.cc.ParticleSystem.TEXTURE_MODE,this._shapeType=exports.cc.ParticleSystem.BALL_SHAPE,this._pointRect=exports.cc.rect(0,0,0,0),this._tintCache=document.createElement("canvas")};var t=exports.cc.ParticleSystem.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.ParticleSystem.CanvasRenderCmd,t.getDrawMode=function(){return this._drawMode},t.setDrawMode=function(e){this._drawMode=e},t.getShapeType=function(){return this._shapeType},t.setShapeType=function(e){this._shapeType=e},t.setBatchNode=function(e){this._batchNode!==e&&(this._node._batchNode=e)},t.updateQuadWithParticle=function(e,r){},t.updateParticlePosition=function(e,r){exports.cc.pIn(e.drawPos,r)},t.rendering=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext(),a=this._node,c=this._pointRect;s.setTransform(this._worldTransform,r,n),s.save(),a.isBlendAdditive()?o.globalCompositeOperation="lighter":o.globalCompositeOperation="source-over";var l,h,u,_,d=this._node.particleCount,f=this._node._particles;if(a.drawMode!==exports.cc.ParticleSystem.SHAPE_MODE&&a._texture){if(!a._texture._textureLoaded){s.restore();return}var T=a._texture.getHtmlElementObj();if(!T.width||!T.height){s.restore();return}var x=T;for(l=0;l<d;l++)if(h=f[l],u=0|h.size*.5,_=h.color.a/255,_!==0){o.globalAlpha=_,o.save(),o.translate(0|h.drawPos.x,-(0|h.drawPos.y));var m=Math.floor(h.size/4)*4,v=c.width,A=c.height;o.scale(Math.max(1/v*m,1e-6),Math.max(1/A*m,1e-6)),h.rotation&&o.rotate(exports.cc.degreesToRadians(h.rotation)),x=h.isChangeColor?this._changeTextureColor(a._texture,h.color,this._pointRect):T,o.drawImage(x,-(0|v/2),-(0|A/2)),o.restore()}}else{var D=exports.cc._drawingUtil;for(l=0;l<d;l++)h=f[l],u=0|h.size*.5,_=h.color.a/255,_!==0&&(o.globalAlpha=_,o.save(),o.translate(0|h.drawPos.x,-(0|h.drawPos.y)),a.shapeType===exports.cc.ParticleSystem.STAR_SHAPE?(h.rotation&&o.rotate(exports.cc.degreesToRadians(h.rotation)),D.drawStar(s,u,h.color)):D.drawColorBall(s,u,h.color),o.restore())}s.restore(),exports.cc.g_NumberOfDraws++},t._changeTextureColor=function(e,r,n){var s=this._tintCache,o=e.getContentSize();return s.width=o.width,s.height=o.height,e._generateColorTexture(r.r,r.g,r.b,n,s)},t.initTexCoordsWithRect=function(e){this._pointRect=e},t.setTotalParticles=function(e){this._node._totalParticles=e<200?e:200},t.addParticle=function(){var e=this._node,r=e._particles,n;return e.particleCount<r.length?n=r[e.particleCount]:(n=new exports.cc.Particle,r.push(n)),n},t._setupVBO=function(){},t._allocMemory=function(){return!0},t.postStep=function(){},t._setBlendAdditive=function(){var e=this._node._blendFunc;e.src=exports.cc.BLEND_SRC,e.dst=exports.cc.BLEND_DST},t._initWithTotalParticles=function(e){},t._updateDeltaColor=function(e,r){this._node._dontTint||(e.color.r+=e.deltaColor.r*r,e.color.g+=e.deltaColor.g*r,e.color.b+=e.deltaColor.b*r,e.color.a+=e.deltaColor.a*r,e.isChangeColor=!0)}})();exports.cc.ParticleFire=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,60),this.setPosVar(exports.cc.p(40,20)),this.setLife(3),this.setLifeVar(.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(194,64,31,255)),this.setStartColorVar(exports.cc.color(0,0,0,0)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}});exports.cc.ParticleFire.create=function(){return new exports.cc.ParticleFire};exports.cc.ParticleFireworks=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(128,128,128,255)),this.setStartColorVar(exports.cc.color(128,128,128,255)),this.setEndColor(exports.cc.color(26,26,26,51)),this.setEndColorVar(exports.cc.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleFireworks.create=function(){return new exports.cc.ParticleFireworks};exports.cc.ParticleSun=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setBlendAdditive(!0),this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),this.setAngle(90),this.setAngleVar(360);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(1),this.setLifeVar(.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(194,64,31,255)),this.setStartColorVar(exports.cc.color(0,0,0,0)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),!0}return!1}});exports.cc.ParticleSun.create=function(){return new exports.cc.ParticleSun};exports.cc.ParticleGalaxy=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(31,64,194,255)),this.setStartColorVar(exports.cc.color(0,0,0,0)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}});exports.cc.ParticleGalaxy.create=function(){return new exports.cc.ParticleGalaxy};exports.cc.ParticleFlower=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(128,128,128,255)),this.setStartColorVar(exports.cc.color(128,128,128,128)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}});exports.cc.ParticleFlower.create=function(){return new exports.cc.ParticleFlower};exports.cc.ParticleMeteor=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(51,102,179)),this.setStartColorVar(exports.cc.color(0,0,51,26)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}});exports.cc.ParticleMeteor.create=function(){return new exports.cc.ParticleMeteor};exports.cc.ParticleSpiral=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(128,128,128,255)),this.setStartColorVar(exports.cc.color(128,128,128,0)),this.setEndColor(exports.cc.color(128,128,128,255)),this.setEndColorVar(exports.cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleSpiral.create=function(){return new exports.cc.ParticleSpiral};exports.cc.ParticleExplosion=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(.1),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height/2),this.setPosVar(exports.cc.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(exports.cc.color(179,26,51,255)),this.setStartColorVar(exports.cc.color(128,128,128,0)),this.setEndColor(exports.cc.color(128,128,128,0)),this.setEndColorVar(exports.cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleExplosion.create=function(){return new exports.cc.ParticleExplosion};exports.cc.ParticleSmoke=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,0),this.setPosVar(exports.cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(exports.cc.color(204,204,204,255)),this.setStartColorVar(exports.cc.color(5,5,5,0)),this.setEndColor(exports.cc.color(0,0,0,255)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleSmoke.create=function(){return new exports.cc.ParticleSmoke};exports.cc.ParticleSnow=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height+10),this.setPosVar(exports.cc.p(e.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(exports.cc.color(255,255,255,255)),this.setStartColorVar(exports.cc.color(0,0,0,0)),this.setEndColor(exports.cc.color(255,255,255,0)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleSnow.create=function(){return new exports.cc.ParticleSnow};exports.cc.ParticleRain=exports.cc.ParticleSystem.extend({ctor:function(){exports.cc.ParticleSystem.prototype.ctor.call(this,exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?1e3:300)},initWithTotalParticles:function(t){if(exports.cc.ParticleSystem.prototype.initWithTotalParticles.call(this,t)){this.setDuration(exports.cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(exports.cc.ParticleSystem.MODE_GRAVITY),this.setGravity(exports.cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5);var e=exports.cc.director.getWinSize();return this.setPosition(e.width/2,e.height),this.setPosVar(exports.cc.p(e.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(exports.cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(exports.cc.color(179,204,255,255)),this.setStartColorVar(exports.cc.color(0,0,0,0)),this.setEndColor(exports.cc.color(179,204,255,128)),this.setEndColorVar(exports.cc.color(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}});exports.cc.ParticleRain.create=function(){return new exports.cc.ParticleRain};exports.cc.PARTICLE_DEFAULT_CAPACITY=500;exports.cc.ParticleBatchNode=exports.cc.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(t,e){exports.cc.Node.prototype.ctor.call(this),this._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},exports.cc.isString(t)?this.init(t,e):t instanceof exports.cc.Texture2D&&this.initWithTexture(t,e)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ParticleBatchNode.CanvasRenderCmd(this):new exports.cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(t,e){return this.textureAtlas=new exports.cc.TextureAtlas,this.textureAtlas.initWithTexture(t,e),this._children.length=0,this._renderCmd._initWithTexture(),!0},initWithFile:function(t,e){var r=exports.cc.textureCache.addImage(t);return this.initWithTexture(r,e)},init:function(t,e){var r=exports.cc.textureCache.addImage(t);return this.initWithTexture(r,e)},addChild:function(t,e,r){if(!t)throw new Error("cc.ParticleBatchNode.addChild() : child should be non-null");if(!(t instanceof exports.cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children");if(e=e==null?t.zIndex:e,r=r==null?t.tag:r,t.getTexture()!==this.textureAtlas.texture)throw new Error("cc.ParticleSystem.addChild() : the child is not using the same texture id");var n=t.getBlendFunc();if(this._children.length===0)this.setBlendFunc(n);else if(n.src!==this._blendFunc.src||n.dst!==this._blendFunc.dst){exports.cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");return}var s=this._addChildHelper(t,e,r),o=0;if(s!==0){var a=this._children[s-1];o=a.getAtlasIndex()+a.getTotalParticles()}else o=0;this.insertChild(t,o),t.setBatchNode(this)},insertChild:function(t,e){var r=t.getTotalParticles(),n=this.textureAtlas,s=n.totalQuads;t.setAtlasIndex(e),s+r>n.getCapacity()&&(this._increaseAtlasCapacityTo(s+r),n.fillWithEmptyQuadsFromIndex(n.getCapacity()-r,r)),t.getAtlasIndex()+r!==s&&n.moveQuadsFromIndex(e,e+r),n.increaseTotalQuadsWith(r),this._updateAllAtlasIndexes()},removeChild:function(t,e){if(t!=null){if(!(t instanceof exports.cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children");if(this._children.indexOf(t)===-1){exports.cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");return}exports.cc.Node.prototype.removeChild.call(this,t,e);var r=this.textureAtlas;r.removeQuadsAtIndex(t.getAtlasIndex(),t.getTotalParticles()),r.fillWithEmptyQuadsFromIndex(r.totalQuads,t.getTotalParticles()),t.setBatchNode(null),this._updateAllAtlasIndexes()}},reorderChild:function(t,e){if(!t)throw new Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(t instanceof exports.cc.ParticleSystem))throw new Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(this._children.indexOf(t)===-1){exports.cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");return}if(e!==t.zIndex){if(this._children.length>1){var r=this._getCurrentIndex(t,e);if(r.oldIndex!==r.newIndex){this._children.splice(r.oldIndex,1),this._children.splice(r.newIndex,0,t);var n=t.getAtlasIndex();this._updateAllAtlasIndexes();for(var s=0,o=this._children,a=0;a<o.length;a++){var c=o[a];if(c===t){s=t.getAtlasIndex();break}}this.textureAtlas.moveQuadsFromIndex(n,t.getTotalParticles(),s),t.updateWithNoTime()}}t._setLocalZOrder(e)}},removeChildAtIndex:function(t,e){this.removeChild(this._children[i],e)},removeAllChildren:function(t){for(var e=this._children,r=0;r<e.length;r++)e[r].setBatchNode(null);exports.cc.Node.prototype.removeAllChildren.call(this,t),this.textureAtlas.removeAllQuads()},disableParticle:function(t){var e=this.textureAtlas.quads[t];e.br.vertices.x=e.br.vertices.y=e.tr.vertices.x=e.tr.vertices.y=e.tl.vertices.x=e.tl.vertices.y=e.bl.vertices.x=e.bl.vertices.y=0,this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(t){this.textureAtlas.texture=t;var e=this._blendFunc;t&&!t.hasPremultipliedAlpha()&&e.src===exports.cc.BLEND_SRC&&e.dst===exports.cc.BLEND_DST&&(e.src=exports.cc.SRC_ALPHA,e.dst=exports.cc.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(t,e){e===void 0?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.src=e)},getBlendFunc:function(){return new exports.cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var t=0,e=this._children,r=0;r<e.length;r++){var n=e[r];n.setAtlasIndex(t),t+=n.getTotalParticles()}},_increaseAtlasCapacityTo:function(t){exports.cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+"] to ["+t+"]."),this.textureAtlas.resizeCapacity(t)||exports.cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(t){for(var e=this._children,r=e.length,n=0;n<r;n++)if(e[n].zIndex>t)return n;return r},_getCurrentIndex:function(t,e){for(var r=!1,n=!1,s=0,o=0,a=0,c=this._children,l=c.length,h=0;h<l;h++){var u=c[h];if(u.zIndex>e&&!n&&(s=h,n=!0,r&&n)||t===u&&(o=h,r=!0,n||(a=-1),r&&n))break}return n||(s=l),s+=a,{newIndex:s,oldIndex:o}},_addChildHelper:function(t,e,r){if(!t)throw new Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(t.parent)return exports.cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var n=this._searchNewPositionInChildrenForZ(e);return this._children.splice(n,0,t),t.tag=r,t._setLocalZOrder(e),t.parent=this||window,this._running&&(t.onEnter(),t.onEnterTransitionDidFinish()),n},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=exports.cc.SRC_ALPHA,this._blendFunc.dst=exports.cc.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(t){this.textureAtlas=t}});var _p=exports.cc.ParticleBatchNode.prototype;_p.texture;exports.cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);exports.cc.ParticleBatchNode.create=function(t,e){return new exports.cc.ParticleBatchNode(t,e)};(function(){exports.cc.ParticleBatchNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!1};var t=exports.cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.ParticleBatchNode.CanvasRenderCmd,t._initWithTexture=function(){}})();(function(){exports.cc.ParticleBatchNode.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity()};var t=exports.cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.ParticleBatchNode.WebGLRenderCmd,t.rendering=function(e){var r=this._node;if(r.textureAtlas.totalQuads!==0){var n=this._worldTransform;this._matrix.mat[0]=n.a,this._matrix.mat[4]=n.c,this._matrix.mat[12]=n.tx,this._matrix.mat[1]=n.b,this._matrix.mat[5]=n.d,this._matrix.mat[13]=n.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),exports.cc.glBlendFuncForParticle(r._blendFunc.src,r._blendFunc.dst),r.textureAtlas.drawQuads()}},t._initWithTexture=function(){this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR)},t.visit=function(e){var r=this._node;r._visible&&(e=e||this.getParentRenderCmd(),e&&(this._curLevel=e._curLevel+1),this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this),this._dirtyFlag=0)}})();(function(){exports.cc.ParticleSystem.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._quadsArrayBuffer=null};var t=exports.cc.ParticleSystem.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.ParticleSystem.WebGLRenderCmd,t.getDrawMode=function(){},t.setDrawMode=function(e){},t.getShapeType=function(){},t.setShapeType=function(e){},t.setBatchNode=function(e){var r=this._node;if(r._batchNode!==e){var n=r._batchNode;if(r._batchNode=e,e)for(var s=r._particles,o=0;o<r._totalParticles;o++)s[o].atlasIndex=o;e?n||(r._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,r.atlasIndex),exports.cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(r._totalParticles),r.setTexture(n.getTexture()),this._setupVBO())}},t.initIndices=function(e){for(var r=this._indices,n=0,s=e;n<s;++n){var o=n*6,a=n*4;r[o+0]=a+0,r[o+1]=a+1,r[o+2]=a+2,r[o+5]=a+1,r[o+4]=a+2,r[o+3]=a+3}},t.isDifferentTexture=function(e,r){return e===r},t.updateParticlePosition=function(e,r){this.updateQuadWithParticle(e,r)},t.updateQuadWithParticle=function(e,r){var n=null,s=this._node;if(s._batchNode){var o=s._batchNode.textureAtlas.quads;n=o[s.atlasIndex+e.atlasIndex],s._batchNode.textureAtlas.dirty=!0}else n=this._quads[s._particleIdx];var a,c,l,h;s._opacityModifyRGB?(a=0|e.color.r*e.color.a/255,c=0|e.color.g*e.color.a/255,l=0|e.color.b*e.color.a/255):(a=0|e.color.r,c=0|e.color.g,l=0|e.color.b),h=0|e.color.a;var u=n.bl.colors,_=n.br.colors,d=n.tl.colors,f=n.tr.colors;u.r=_.r=d.r=f.r=a,u.g=_.g=d.g=f.g=c,u.b=_.b=d.b=f.b=l,u.a=_.a=d.a=f.a=h;var T=e.size/2;if(e.rotation){var x=-T,m=-T,v=T,A=T,D=r.x,N=r.y,z=-exports.cc.degreesToRadians(e.rotation),M=Math.cos(z),J=Math.sin(z),U=x*M-m*J+D,K=x*J+m*M+N,tt=v*M-m*J+D,rt=v*J+m*M+N,I=v*M-A*J+D,L=v*J+A*M+N,G=x*M-A*J+D,w=x*J+A*M+N;n.bl.vertices.x=U,n.bl.vertices.y=K,n.br.vertices.x=tt,n.br.vertices.y=rt,n.tl.vertices.x=G,n.tl.vertices.y=w,n.tr.vertices.x=I,n.tr.vertices.y=L}else n.bl.vertices.x=r.x-T,n.bl.vertices.y=r.y-T,n.br.vertices.x=r.x+T,n.br.vertices.y=r.y-T,n.tl.vertices.x=r.x-T,n.tl.vertices.y=r.y+T,n.tr.vertices.x=r.x+T,n.tr.vertices.y=r.y+T},t.rendering=function(e){var r=this._node;if(r._texture){var n=e||exports.cc._renderContext,s=this._worldTransform;this._matrix.mat[0]=s.a,this._matrix.mat[4]=s.c,this._matrix.mat[12]=s.tx,this._matrix.mat[1]=s.b,this._matrix.mat[5]=s.d,this._matrix.mat[13]=s.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),exports.cc.glBindTexture2D(r._texture),exports.cc.glBlendFuncForParticle(r._blendFunc.src,r._blendFunc.dst),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_POSITION),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_COLOR),n.enableVertexAttribArray(exports.cc.VERTEX_ATTRIB_TEX_COORDS),n.bindBuffer(n.ARRAY_BUFFER,this._buffersVBO[0]),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(exports.cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),n.drawElements(n.TRIANGLES,r._particleIdx*6,n.UNSIGNED_SHORT,0)}},t.initTexCoordsWithRect=function(e){var r=this._node,n=r.texture,s=exports.cc.contentScaleFactor(),o=exports.cc.rect(e.x*s,e.y*s,e.width*s,e.height*s),a=e.width,c=e.height;n&&(a=n.pixelsWidth,c=n.pixelsHeight);var l,h,u,_;exports.cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(l=(o.x*2+1)/(a*2),h=(o.y*2+1)/(c*2),u=l+(o.width*2-2)/(a*2),_=h+(o.height*2-2)/(c*2)):(l=o.x/a,h=o.y/c,u=l+o.width/a,_=h+o.height/c);var d=_;_=h,h=d;var f,T=0,x=0;r._batchNode?(f=r._batchNode.textureAtlas.quads,T=r.atlasIndex,x=r.atlasIndex+r._totalParticles):(f=this._quads,T=0,x=r._totalParticles);for(var m=T;m<x;m++){f[m]||(f[m]=exports.cc.V3F_C4B_T2F_QuadZero());var v=f[m];v.bl.texCoords.u=l,v.bl.texCoords.v=h,v.br.texCoords.u=u,v.br.texCoords.v=h,v.tl.texCoords.u=l,v.tl.texCoords.v=_,v.tr.texCoords.u=u,v.tr.texCoords.v=_}},t.setTotalParticles=function(e){var r=this._node;if(e>r._allocatedParticles){var n=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(e*6);var s=new ArrayBuffer(e*n),o=r._particles;o.length=0;var a=this._quads;a.length=0;for(var c=0;c<e;c++)o[c]=new exports.cc.Particle,a[c]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,s,c*n);if(r._allocatedParticles=e,r._totalParticles=e,r._batchNode)for(var l=0;l<e;l++)o[l].atlasIndex=l;this._quadsArrayBuffer=s,this.initIndices(e),this._setupVBO(),r._texture&&this.initTexCoordsWithRect(exports.cc.rect(0,0,r._texture.width,r._texture.height))}else r._totalParticles=e;r.resetSystem()},t.addParticle=function(){var e=this._node,r=e._particles;return r[e.particleCount]},t._setupVBO=function(){var e=exports.cc._renderContext;this._buffersVBO[0]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._buffersVBO[0]),e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW),this._buffersVBO[1]=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)},t._allocMemory=function(){var e=this._node;if(e._batchNode)return exports.cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var r=exports.cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=e._totalParticles,s=this._quads;s.length=0,this._indices=new Uint16Array(n*6);for(var o=new ArrayBuffer(r*n),a=0;a<n;a++)s[a]=new exports.cc.V3F_C4B_T2F_Quad(null,null,null,null,o,a*r);return!s||!this._indices?(exports.cc.log("cocos2d: Particle system: not enough memory"),!1):(this._quadsArrayBuffer=o,!0)},t.postStep=function(){var e=exports.cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._buffersVBO[0]),e.bufferSubData(e.ARRAY_BUFFER,0,this._quadsArrayBuffer)},t._setBlendAdditive=function(){var e=this._node._blendFunc;this._texture&&!this._texture.hasPremultipliedAlpha()?(e.src=exports.cc.SRC_ALPHA,e.dst=exports.cc.ONE_MINUS_SRC_ALPHA):(e.src=exports.cc.BLEND_SRC,e.dst=exports.cc.BLEND_DST)},t._initWithTotalParticles=function(e){if(!this._allocMemory())return!1;this.initIndices(e),this._setupVBO(),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR)},t._updateDeltaColor=function(e,r){e.color.r+=e.deltaColor.r*r,e.color.g+=e.deltaColor.g*r,e.color.b+=e.deltaColor.b*r,e.color.a+=e.deltaColor.a*r,e.isChangeColor=!0}})();exports.cc.IMEKeyboardNotificationInfo=function(t,e,r){this.begin=t||exports.cc.rect(0,0,0,0),this.end=e||exports.cc.rect(0,0,0,0),this.duration=r||0};exports.cc.IMEDelegate=exports.cc.Class.extend({ctor:function(){exports.cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){exports.cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return exports.cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return exports.cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(t,e){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}});exports.cc.IMEDispatcher=exports.cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new exports.cc.IMEDispatcher.Impl,this._lastClickPosition=exports.cc.p(0,0)},init:function(){if(!exports.cc.sys.isMobile){this._domInputControl=exports.cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=exports.cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var t=this||window;this._domInputControl.addEventListener("input",function(){t._processDomInputString(t._domInputControl.value)},!1),this._domInputControl.addEventListener("keydown",function(e){e.keyCode===exports.cc.KEY.tab?(e.stopPropagation(),e.preventDefault()):e.keyCode===exports.cc.KEY.enter&&(t.dispatchInsertText(`
`,1),e.stopPropagation(),e.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(e){e.keyCode===exports.cc.KEY.backspace&&t._processDomInputString(t._domInputControl.value)},!1),window.addEventListener("mousedown",function(e){var r=e.pageX||0,n=e.pageY||0;t._lastClickPosition.x=r,t._lastClickPosition.y=n},!1)}},_processDomInputString:function(t){var e,r,n=this._currentInputString.length<t.length?this._currentInputString.length:t.length;for(r=0;r<n&&t[r]===this._currentInputString[r];r++);var s=this._currentInputString.length-r,o=t.length-r;for(e=0;e<s;e++)this.dispatchDeleteBackward();for(e=0;e<o;e++)this.dispatchInsertText(t[r+e],1);this._currentInputString=t},dispatchInsertText:function(t,e){!this.impl||!t||e<=0||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var t=this.impl._delegateWithIme.getContentText();return t||""}return""},dispatchKeyboardWillShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var r=this.impl._delegateList[e];r&&r.keyboardWillShow(t)}},dispatchKeyboardDidShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var r=this.impl._delegateList[e];r&&r.keyboardDidShow(t)}},dispatchKeyboardWillHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var r=this.impl._delegateList[e];r&&r.keyboardWillHide(t)}},dispatchKeyboardDidHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var r=this.impl._delegateList[e];r&&r.keyboardDidHide(t)}},addDelegate:function(t){!t||!this.impl||this.impl._delegateList.indexOf(t)>-1||this.impl._delegateList.splice(0,0,t)},attachDelegateWithIME:function(t){if(!this.impl||!t||this.impl._delegateList.indexOf(t)===-1)return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME())return!1;var e=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,e.didDetachWithIME(),this._focusDomInput(t),!0}return t.canAttachWithIME()?(this._focusDomInput(t),!0):!1},_focusDomInput:function(t){if(exports.cc.sys.isMobile){this.impl._delegateWithIme=t,t.didAttachWithIME(),this._currentInputString=t.string||"";var e=t.getTipMessage?t.getTipMessage():"please enter your word:",r,n=window.Window;n&&n.prototype.prompt&&n.prototype.prompt!=prompt?r=n.prototype.prompt.call(window,e,this._currentInputString):r=prompt(e,this._currentInputString),r!=null&&this._processDomInputString(r),this.dispatchInsertText(`
`,1)}else this.impl._delegateWithIme=t,this._currentInputString=t.string||"",t.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(t){return!this.impl||!t||this.impl._delegateWithIme!==t||!t.canDetachWithIME()?!1:(this.impl._delegateWithIme=null,t.didDetachWithIME(),exports.cc._canvas.focus(),!0)},removeDelegate:function(t){!this.impl||!t||this.impl._delegateList.indexOf(t)!==-1&&(this.impl._delegateWithIme&&t===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),exports.cc.arrayRemoveObject(this.impl._delegateList,t))},processKeycode:function(t){t<32?t===exports.cc.KEY.backspace?this.dispatchDeleteBackward():t===exports.cc.KEY.enter?this.dispatchInsertText(`
`,1):t===exports.cc.KEY.tab||exports.cc.KEY.escape:t<255&&this.dispatchInsertText(String.fromCharCode(t),1)}});exports.cc.IMEDispatcher.Impl=exports.cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++)if(this._delegateList[e]===t)return e;return null}});exports.cc.imeDispatcher=new exports.cc.IMEDispatcher;document.body?exports.cc.imeDispatcher.init():window.addEventListener("load",function(){exports.cc.imeDispatcher.init()},!1);exports.cc.TextFieldDelegate=exports.cc.Class.extend({onTextFieldAttachWithIME:function(t){return!1},onTextFieldDetachWithIME:function(t){return!1},onTextFieldInsertText:function(t,e,r){return!1},onTextFieldDeleteBackward:function(t,e,r){return!1},onDraw:function(t){return!1}});exports.cc.TextFieldTTF=exports.cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,r,n,s){this.colorSpaceHolder=exports.cc.color(127,127,127),this._colorText=exports.cc.color(255,255,255,255),exports.cc.LabelTTF.prototype.ctor.call(this),s!==void 0?(this.initWithPlaceHolder("",e,r,n,s),t&&this.setPlaceHolder(t)):n===void 0&&r!==void 0&&(this.initWithString("",arguments[1],arguments[2]),t&&this.setPlaceHolder(t))},onEnter:function(){exports.cc.LabelTTF.prototype.onEnter.call(this),exports.cc.imeDispatcher.addDelegate(this)},onExit:function(){exports.cc.LabelTTF.prototype.onExit.call(this),exports.cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return exports.cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r,this.colorSpaceHolder.g=t.g,this.colorSpaceHolder.b=t.b,this.colorSpaceHolder.a=exports.cc.isUndefined(t.a)?255:t.a,this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r,this._colorText.g=t.g,this._colorText.b=t.b,this._colorText.a=exports.cc.isUndefined(t.a)?255:t.a,this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,r,n,s){switch(arguments.length){case 5:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,n,s,e,r);case 3:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,arguments[1],arguments[2]);default:throw new Error("Argument must be non-nil ")}},setString:function(t){t=String(t),this._inputText=t||"",this._inputText.length?(exports.cc.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(exports.cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)),exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS&&this._renderCmd._updateTexture(),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"",this._inputText.length||(exports.cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(t){var e=t||exports.cc._renderContext;this.delegate&&this.delegate.onDraw(this)||exports.cc.LabelTTF.prototype.draw.call(this,e)},visit:function(t){this._super(t)},attachWithIME:function(){return exports.cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return exports.cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return this.delegate?!this.delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this.delegate?!this.delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;if(t!==0){var e=1;if(!(this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-e],e))){if(t<=e){this._inputText="",this._charCount=0,exports.cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder);return}this.string=this._inputText.substring(0,t-e)}}},removeDelegate:function(){exports.cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){t!=null&&(this._tipMessage=t)},getTipMessage:function(){return this._tipMessage},insertText:function(t,e){var r=t,n=r.indexOf(`
`);if(n>-1&&(r=r.substring(0,n)),r.length>0){if(this.delegate&&this.delegate.onTextFieldInsertText(this,r,r.length))return;var s=this._inputText+r;this._charCount=s.length,this.string=s}n!==-1&&(this.delegate&&this.delegate.onTextFieldInsertText(this,`
`,1)||this.detachWithIME())},getContentText:function(){return this._inputText},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}});var _p=exports.cc.TextFieldTTF.prototype;_p.charCount;exports.cc.defineGetterSetter(_p,"charCount",_p.getCharCount);_p.placeHolder;exports.cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);exports.cc.TextFieldTTF.create=function(t,e,r,n,s){return new exports.cc.TextFieldTTF(t,e,r,n,s)};exports.cc.TGA_OK=0;exports.cc.TGA_ERROR_FILE_OPEN=1;exports.cc.TGA_ERROR_READING_FILE=2;exports.cc.TGA_ERROR_INDEXED_COLOR=3;exports.cc.TGA_ERROR_MEMORY=4;exports.cc.TGA_ERROR_COMPRESSED_FILE=5;exports.cc.ImageTGA=function(t,e,r,n,s,o,a){this.status=t||0,this.type=e||0,this.pixelDepth=r||0,this.width=n||0,this.height=s||0,this.imageData=o||[],this.flipped=a||0};exports.cc.tgaLoadHeader=function(t,e,r){var n=2;if(n+1>e)return!1;var s=new exports.cc.BinaryStreamReader(t);if(s.setOffset(n),r.type=s.readByte(),n+=10,n+4+1>e||(s.setOffset(n),r.width=s.readUnsignedShort(),r.height=s.readUnsignedInteger(),r.pixelDepth=s.readByte(),n+=5,n+1>e))return!1;var o=s.readByte();return r.flipped=0,o&32&&(r.flipped=1),!0};exports.cc.tgaLoadImageData=function(t,e,r){var n,s,o,a,c=18;if(n=0|r.pixelDepth/2,s=r.height*r.width*n,c+s>e)return!1;if(r.imageData=exports.cc.__getSubArray(t,c,c+s),n>=3)for(o=0;o<s;o+=n)a=r.imageData[o],r.imageData[o]=r.imageData[o+2],r.imageData[o+2]=a;return!0};exports.cc.tgaRGBtogreyscale=function(t){var e,r;if(t.pixelDepth!==8){var n=t.pixelDepth/8,s=new Uint8Array(t.height*t.width);if(s!==null){for(e=0,r=0;r<t.width*t.height;e+=n,r++)s[r]=.3*t.imageData[e]+.59*t.imageData[e+1]+.11*t.imageData[e+2];t.pixelDepth=8,t.type=3,t.imageData=s}}};exports.cc.tgaDestroy=function(t){t&&(t.imageData=null,t=null)};exports.cc.tgaLoadRLEImageData=function(t,e,r){var n,s,o,a=0,c=0,l=0,h=[],u=0,_=18;for(n=r.pixelDepth/8,s=r.height*r.width,o=0;o<s;o++){if(u!==0)u--,c=l!==0;else{if(_+1>e)break;u=t[_],_+=1,l=u&128,l&&(u-=128),c=0}if(!c){if(_+n>e)break;if(h=exports.cc.__getSubArray(t,_,_+n),_+=n,n>=3){var d=h[0];h[0]=h[2],h[2]=d}}for(var f=0;f<n;f++)r.imageData[a+f]=h[f];a+=n}return!0};exports.cc.tgaFlipImage=function(t){for(var e=t.pixelDepth/8,r=t.width*e,n=0;n<t.height/2;n++){var s=exports.cc.__getSubArray(t.imageData,n*r,n*r+r);exports.cc.__setDataToArray(exports.cc.__getSubArray(t.imageData,(t.height-(n+1))*r,r),t.imageData,n*r),exports.cc.__setDataToArray(s,t.imageData,(t.height-(n+1))*r)}t.flipped=0};exports.cc.__getSubArray=function(t,e,r){return t instanceof Array?t.slice(e,r):t.subarray(e,r)};exports.cc.__setDataToArray=function(t,e,r){for(var n=0;n<t.length;n++)e[r+n]=t[n]};exports.cc.BinaryStreamReader=exports.cc.Class.extend({_binaryData:null,_offset:0,ctor:function(t){this._binaryData=t},setBinaryData:function(t){this._binaryData=t,this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(t){if(!(this._offset+Math.ceil(t/8)<this._data.length))throw new Error("Index out of bound")},_decodeFloat:function(t,e){var r=t+e+1,n=r>>3;this._checkSize(r);var s=Math.pow(2,e-1)-1,o=this._readBits(t+e,1,n),a=this._readBits(t,e,n),c=0,l=2,h=0;do for(var u=this._readByte(++h,n),_=t%8||8,d=1<<_;d>>=1;)u&d&&(c+=1/l),l*=2;while(t-=_);return this._offset+=n,a===(s<<1)+1?c?NaN:o?-1/0:1/0:(1+o*-2)*(a||c?a?Math.pow(2,a-s)*(1+c):Math.pow(2,-s+1)*c:0)},_readByte:function(t,e){return this._data[this._offset+e-t-1]},_decodeInt:function(t,e){var r=this._readBits(0,t,t/8),n=Math.pow(2,t),s=e&&r>=n/2?r-n:r;return this._offset+=t/8,s},_shl:function(t,e){for(++e;--e;t=((t%=2147483647+1)&1073741824)===1073741824?t*2:(t-1073741824)*2+2147483647+1);return t},_readBits:function(t,e,r){var n=(t+e)%8,s=t%8,o=r-(t>>3)-1,a=r+(-(t+e)>>3),c=o-a,l=this._readByte(o,r)>>s&(1<<(c?8-s:e))-1;for(c&&n&&(l+=(this._readByte(a++,r)&(1<<n)-1)<<(c--<<3)-s);c;)l+=this._shl(this._readByte(a++,r),(c--<<3)-s);return l},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var t=this._data[this._offset];return this._offset+=1,t},readData:function(t,e){return this._binaryData instanceof Array?this._binaryData.slice(t,e):this._binaryData.subarray(t,e)},setOffset:function(t){this._offset=t},getOffset:function(){return this._offset}});exports.cc.TMX_ORIENTATION_ORTHO=0;exports.cc.TMX_ORIENTATION_HEX=1;exports.cc.TMX_ORIENTATION_ISO=2;exports.cc.TMXTiledMap=exports.cc.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(t,e){exports.cc.Node.prototype.ctor.call(this),this._mapSize=exports.cc.size(0,0),this._tileSize=exports.cc.size(0,0),e!==void 0?this.initWithXML(t,e):t!==void 0&&this.initWithTMXFile(t)},getMapSize:function(){return exports.cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return exports.cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(t){this.mapOrientation=t},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(t){this.objectGroups=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.");this.width=0,this.height=0;var e=new exports.cc.TMXMapInfo(t);if(!e)return!1;var r=e.getTilesets();return(!r||r.length===0)&&exports.cc.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename."),this._buildWithMapInfo(e),!0},initWithXML:function(t,e){this.width=0,this.height=0;var r=new exports.cc.TMXMapInfo(t,e),n=r.getTilesets();return(!n||n.length===0)&&exports.cc.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename."),this._buildWithMapInfo(r),!0},_buildWithMapInfo:function(t){this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this.mapOrientation=t.orientation,this.objectGroups=t.getObjectGroups(),this.properties=t.properties,this._tileProperties=t.getTileProperties();var e=0,r=t.getLayers();if(r){for(var n=null,s=0,o=r.length;s<o;s++)if(n=r[s],n&&n.visible){var a=this._parseLayer(n,t);this.addChild(a,e,e),this.width=Math.max(this.width,a.width),this.height=Math.max(this.height,a.height),e++}}},allLayers:function(){for(var t=[],e=this._children,r=0,n=e.length;r<n;r++){var s=e[r];s&&s instanceof exports.cc.TMXLayer&&t.push(s)}return t},getLayer:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var e=this._children,r=0;r<e.length;r++){var n=e[r];if(n&&n.layerName===t)return n}return null},getObjectGroup:function(t){if(!t||t.length===0)throw new Error("cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");if(this.objectGroups)for(var e=0;e<this.objectGroups.length;e++){var r=this.objectGroups[e];if(r&&r.groupName===t)return r}return null},getProperty:function(t){return this.properties[t.toString()]},propertiesForGID:function(t){return exports.cc.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead."),this.getPropertiesForGID[t]},getPropertiesForGID:function(t){return this._tileProperties[t]},_parseLayer:function(t,e){var r=this._tilesetForLayer(t,e),n=new exports.cc.TMXLayer(r,t,e);return t.ownTiles=!1,n},_tilesetForLayer:function(t,e){var r=t._layerSize,n=e.getTilesets();if(n)for(var s=n.length-1;s>=0;s--){var o=n[s];if(o)for(var a=0;a<r.height;a++)for(var c=0;c<r.width;c++){var l=c+r.width*a,h=t._tiles[l];if(h!==0&&(h&exports.cc.TMX_TILE_FLIPPED_MASK)>>>0>=o.firstGid)return o}}return exports.cc.log("cocos2d: Warning: TMX Layer "+t.name+" has no tiles"),null}});var _p=exports.cc.TMXTiledMap.prototype;_p.mapWidth;exports.cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);_p.mapHeight;exports.cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);_p.tileWidth;exports.cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;exports.cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);exports.cc.TMXTiledMap.create=function(t,e){return new exports.cc.TMXTiledMap(t,e)};exports.cc.TMX_PROPERTY_NONE=0;exports.cc.TMX_PROPERTY_MAP=1;exports.cc.TMX_PROPERTY_LAYER=2;exports.cc.TMX_PROPERTY_OBJECTGROUP=3;exports.cc.TMX_PROPERTY_OBJECT=4;exports.cc.TMX_PROPERTY_TILE=5;exports.cc.TMX_TILE_HORIZONTAL_FLAG=2147483648;exports.cc.TMX_TILE_VERTICAL_FLAG=1073741824;exports.cc.TMX_TILE_DIAGONAL_FLAG=536870912;exports.cc.TMX_TILE_FLIPPED_ALL=(exports.cc.TMX_TILE_HORIZONTAL_FLAG|exports.cc.TMX_TILE_VERTICAL_FLAG|exports.cc.TMX_TILE_DIAGONAL_FLAG)>>>0;exports.cc.TMX_TILE_FLIPPED_MASK=~exports.cc.TMX_TILE_FLIPPED_ALL>>>0;exports.cc.TMXLayerInfo=exports.cc.Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this.properties=[],this.name="",this._layerSize=null,this._tiles=null,this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=exports.cc.p(0,0)},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t}});exports.cc.TMXTilesetInfo=exports.cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=exports.cc.size(0,0),this.imageSize=exports.cc.size(0,0)},rectForGID:function(t,e){var r=e||exports.cc.rect(0,0,0,0);r.width=this._tileSize.width,r.height=this._tileSize.height,t&=exports.cc.TMX_TILE_FLIPPED_MASK,t=t-parseInt(this.firstGid,10);var n=parseInt((this.imageSize.width-this.margin*2+this.spacing)/(this._tileSize.width+this.spacing),10);return r.x=parseInt(t%n*(this._tileSize.width+this.spacing)+this.margin,10),r.y=parseInt(parseInt(t/n,10)*(this._tileSize.height+this.spacing)+this.margin,10),r}});exports.cc.TMXMapInfo=exports.cc.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(t,e){exports.cc.SAXParser.prototype.ctor.apply(this),this._mapSize=exports.cc.size(0,0),this._tileSize=exports.cc.size(0,0),this._layers=[],this._tilesets=[],this._objectGroups=[],this.properties=[],this._tileProperties={},this._currentFirstGID=0,e!==void 0?this.initWithXML(t,e):t!==void 0&&this.initWithTMXFile(t)},getOrientation:function(){return this.orientation},setOrientation:function(t){this.orientation=t},getMapSize:function(){return exports.cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(t){this._mapSize.width=t},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(t){this._mapSize.height=t},getTileSize:function(){return exports.cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(t){this._tileSize.width=t},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(t){this._tileSize.height=t},getLayers:function(){return this._layers},setLayers:function(t){this._layers.push(t)},getTilesets:function(){return this._tilesets},setTilesets:function(t){this._tilesets.push(t)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(t){this._objectGroups.push(t)},getParentElement:function(){return this.parentElement},setParentElement:function(t){this.parentElement=t},getParentGID:function(){return this.parentGID},setParentGID:function(t){this.parentGID=t},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(t){this.layerAttrs=t},getStoringCharacters:function(){return this.storingCharacters},setStoringCharacters:function(t){this.storingCharacters=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},initWithTMXFile:function(t){return this._internalInit(t,null),this.parseXMLFile(t)},initWithXML:function(t,e){return this._internalInit(null,e),this.parseXMLString(t)},parseXMLFile:function(t,e){e=e||!1;var r=e?t:exports.cc.loader.getRes(t);if(!r)throw new Error("Please load the resource first : "+t);var n=this._parseXML(r),s,o,a=n.documentElement,c=a.getAttribute("version"),l=a.getAttribute("orientation");if(a.nodeName==="map"){c!=="1.0"&&c!==null&&exports.cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+c),l==="orthogonal"?this.orientation=exports.cc.TMX_ORIENTATION_ORTHO:l==="isometric"?this.orientation=exports.cc.TMX_ORIENTATION_ISO:l==="hexagonal"?this.orientation=exports.cc.TMX_ORIENTATION_HEX:l!==null&&exports.cc.log("cocos2d: TMXFomat: Unsupported orientation:"+l);var h=exports.cc.size(0,0);h.width=parseFloat(a.getAttribute("width")),h.height=parseFloat(a.getAttribute("height")),this.setMapSize(h),h=exports.cc.size(0,0),h.width=parseFloat(a.getAttribute("tilewidth")),h.height=parseFloat(a.getAttribute("tileheight")),this.setTileSize(h);var u=a.querySelectorAll("map > properties >  property");if(u){var _={};for(s=0;s<u.length;s++)_[u[s].getAttribute("name")]=u[s].getAttribute("value");this.properties=_}}var d=a.getElementsByTagName("tileset");for(a.nodeName!=="map"&&(d=[],d.push(a)),s=0;s<d.length;s++){var f=d[s],T=f.getAttribute("source");if(T){var x=e?exports.cc.path.join(this._resources,T):exports.cc.path.changeBasename(t,T);this.parseXMLFile(x)}else{var m=new exports.cc.TMXTilesetInfo;m.name=f.getAttribute("name")||"",m.firstGid=parseInt(f.getAttribute("firstgid"))||0,m.spacing=parseInt(f.getAttribute("spacing"))||0,m.margin=parseInt(f.getAttribute("margin"))||0;var v=exports.cc.size(0,0);v.width=parseFloat(f.getAttribute("tilewidth")),v.height=parseFloat(f.getAttribute("tileheight")),m._tileSize=v;var A=f.getElementsByTagName("image")[0],D=A.getAttribute("source"),N=-1;if(this.tmxFileName&&(N=this.tmxFileName.lastIndexOf("/")),N!==-1){var z=this.tmxFileName.substr(0,N+1);m.sourceImage=z+D}else m.sourceImage=this._resources+(this._resources?"/":"")+D;this.setTilesets(m);var M=f.getElementsByTagName("tile");if(M)for(var J=0;J<M.length;J++){var U=M[J];this.parentGID=parseInt(m.firstGid)+parseInt(U.getAttribute("id")||0);var K=U.querySelectorAll("properties > property");if(K){var tt={};for(o=0;o<K.length;o++){var rt=K[o].getAttribute("name");tt[rt]=K[o].getAttribute("value")}this._tileProperties[this.parentGID]=tt}}}}var I=a.getElementsByTagName("layer");if(I)for(s=0;s<I.length;s++){var L=I[s],G=L.getElementsByTagName("data")[0],w=new exports.cc.TMXLayerInfo;w.name=L.getAttribute("name");var O=exports.cc.size(0,0);O.width=parseFloat(L.getAttribute("width")),O.height=parseFloat(L.getAttribute("height")),w._layerSize=O;var j=L.getAttribute("visible");w.visible=j!="0";var Q=L.getAttribute("opacity")||1;Q?w._opacity=parseInt(255*parseFloat(Q)):w._opacity=255,w.offset=exports.cc.p(parseFloat(L.getAttribute("x"))||0,parseFloat(L.getAttribute("y"))||0);var C="";for(o=0;o<G.childNodes.length;o++)C+=G.childNodes[o].nodeValue;C=C.trim();var b=G.getAttribute("compression"),W=G.getAttribute("encoding");if(b&&b!=="gzip"&&b!=="zlib")return exports.cc.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;var M;switch(b){case"gzip":M=exports.cc.unzipBase64AsArray(C,4);break;case"zlib":var S=new Zlib.Inflate(exports.cc.Codec.Base64.decodeAsArray(C,1));M=exports.cc.uint8ArrayToUint32Array(S.decompress());break;case null:case"":if(W==="base64")M=exports.cc.Codec.Base64.decodeAsArray(C,4);else if(W==="csv"){M=[];for(var E=C.split(","),R=0;R<E.length;R++)M.push(parseInt(E[R]))}else{var F=G.getElementsByTagName("tile");M=[];for(var k=0;k<F.length;k++)M.push(parseInt(F[k].getAttribute("gid")))}break;default:this.layerAttrs===exports.cc.TMXLayerInfo.ATTRIB_NONE&&exports.cc.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported");break}M&&(w._tiles=new Uint32Array(M));var X=L.querySelectorAll("properties > property");if(X){var Z={};for(o=0;o<X.length;o++)Z[X[o].getAttribute("name")]=X[o].getAttribute("value");w.properties=Z}this.setLayers(w)}var V=a.getElementsByTagName("objectgroup");if(V)for(s=0;s<V.length;s++){var Y=V[s],$=new exports.cc.TMXObjectGroup;$.groupName=Y.getAttribute("name"),$.setPositionOffset(exports.cc.p(parseFloat(Y.getAttribute("x"))*this.getTileSize().width||0,parseFloat(Y.getAttribute("y"))*this.getTileSize().height||0));var et=Y.querySelectorAll("objectgroup > properties > property");if(et)for(o=0;o<et.length;o++){var ct={};ct[et[o].getAttribute("name")]=et[o].getAttribute("value"),$.properties=ct}var ht=Y.querySelectorAll("object"),pt=exports.cc.director.getContentScaleFactor();if(ht)for(o=0;o<ht.length;o++){var mt=ht[o],dt={};dt.name=mt.getAttribute("name")||"",dt.type=mt.getAttribute("type")||"",dt.width=parseInt(mt.getAttribute("width"))||0,dt.height=parseInt(mt.getAttribute("height"))||0,dt.x=(((mt.getAttribute("x")||0)|0)+$.getPositionOffset().x)/pt;var xt=((mt.getAttribute("y")||0)|0)+$.getPositionOffset().y/pt;dt.y=(parseInt(this.getMapSize().height*this.getTileSize().height)-xt-dt.height)/exports.cc.director.getContentScaleFactor(),dt.rotation=parseInt(mt.getAttribute("rotation"))||0;var Tt=mt.querySelectorAll("properties > property");if(Tt)for(var lt=0;lt<Tt.length;lt++)dt[Tt[lt].getAttribute("name")]=Tt[lt].getAttribute("value");var at=mt.querySelectorAll("polygon");if(at&&at.length>0){var At=at[0].getAttribute("points");At&&(dt.points=this._parsePointsString(At))}var St=mt.querySelectorAll("polyline");if(St&&St.length>0){var wt=St[0].getAttribute("points");wt&&(dt.polylinePoints=this._parsePointsString(wt))}$.setObjects(dt)}this.setObjectGroups($)}return a},_parsePointsString:function(t){if(!t)return null;for(var e=[],r=t.split(" "),n=0;n<r.length;n++){var s=r[n].split(",");e.push({x:s[0],y:s[1]})}return e},parseXMLString:function(t){return this.parseXMLFile(t,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(t){this._tileProperties.push(t)},getCurrentString:function(){return this.currentString},setCurrentString:function(t){this.currentString=t},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(t){this.tmxFileName=t},_internalInit:function(t,e){this._tilesets.length=0,this._layers.length=0,this.tmxFileName=t,e&&(this._resources=e),this._objectGroups.length=0,this.properties.length=0,this._tileProperties.length=0,this.currentString="",this.storingCharacters=!1,this.layerAttrs=exports.cc.TMXLayerInfo.ATTRIB_NONE,this.parentElement=exports.cc.TMX_PROPERTY_NONE,this._currentFirstGID=0}});var _p=exports.cc.TMXMapInfo.prototype;_p.mapWidth;exports.cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);_p.mapHeight;exports.cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);_p.tileWidth;exports.cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;exports.cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);exports.cc.TMXMapInfo.create=function(t,e){return new exports.cc.TMXMapInfo(t,e)};exports.cc.loader.register(["tmx","tsx"],exports.cc._txtLoader);exports.cc.TMXLayerInfo.ATTRIB_NONE=1;exports.cc.TMXLayerInfo.ATTRIB_BASE64=2;exports.cc.TMXLayerInfo.ATTRIB_GZIP=4;exports.cc.TMXLayerInfo.ATTRIB_ZLIB=8;exports.cc.TMXObjectGroup=exports.cc.Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="",this._positionOffset=exports.cc.p(0,0),this.properties=[],this._objects=[]},getPositionOffset:function(){return exports.cc.p(this._positionOffset)},setPositionOffset:function(t){this._positionOffset.x=t.x,this._positionOffset.y=t.y},getProperties:function(){return this.properties},setProperties:function(t){this.properties.push(t)},getGroupName:function(){return this.groupName.toString()},setGroupName:function(t){this.groupName=t},propertyNamed:function(t){return this.properties[t]},objectNamed:function(t){return this.getObject(t)},getObject:function(t){if(this._objects&&this._objects.length>0)for(var e=this._objects,r=0,n=e.length;r<n;r++){var s=e[r].name;if(s&&s===t)return e[r]}return null},getObjects:function(){return this._objects},setObjects:function(t){this._objects.push(t)}});exports.cc.TMXLayer=exports.cc.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_textures:null,_texGrids:null,_spriteTiles:null,_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(t,e,r){exports.cc.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=exports.cc.size(0,0),this._mapTileSize=exports.cc.size(0,0),this._spriteTiles={},r!==void 0&&this.initWithTilesetInfo(t,e,r)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.TMXLayer.CanvasRenderCmd(this):new exports.cc.TMXLayer.WebGLRenderCmd(this)},_fillTextureGrids:function(t,e){var r=this._textures[e];if(!r.isLoaded()){r.addEventListener("load",function(){this._fillTextureGrids(t,e)},this);return}(!t.imageSize.width||!t.imageSize.height)&&(t.imageSize.width=r.width,t.imageSize.height=r.height);for(var n=t._tileSize.width,s=t._tileSize.height,o=r._contentSize.width,a=r._contentSize.height,c=t.spacing,l=t.margin,h=Math.floor((o-l*2+c)/(n+c)),u=Math.floor((a-l*2+c)/(s+c)),_=u*h,d=t.firstGid,f=t.firstGid+_,T=this._texGrids,x=null,m=!!T[d];d<f&&(m&&!T[d]&&(m=!1),!(!m&&T[d]));++d)x={texId:e,x:0,y:0,width:n,height:s,t:0,l:0,r:0,b:0},t.rectForGID(d,x),x.t=x.y/a,x.l=x.x/o,x.r=(x.x+x.width)/o,x.b=(x.y+x.height)/a,T[d]=x},initWithTilesetInfo:function(t,e,r){var n=e._layerSize;parseInt(n.width*n.height),this.layerName=e.name,this.tiles=e._tiles,this.properties=e.properties,this._layerSize=n,this._minGID=e._minGID,this._maxGID=e._maxGID,this._opacity=e._opacity,this.tileset=t,this.layerOrientation=r.orientation,this._mapTileSize=r.getTileSize();var s=r._tilesets;if(s){this._textures=[],this._texGrids=[];var o,a=s.length,c,l;for(o=0;o<a;++o)c=s[o],l=exports.cc.textureCache.addImage(c.sourceImage),this._textures.push(l),this._fillTextureGrids(c,o),c===t&&(this._texture=l)}var h=this._calculateLayerOffset(e.offset);return this.setPosition(exports.cc.pointPixelsToPoints(h)),this._parseInternalProperties(),this.setContentSize(exports.cc.sizePixelsToPoints(exports.cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height))),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0},getLayerSize:function(){return exports.cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(t){this._layerSize.width=t.width,this._layerSize.height=t.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(t){this._layerSize.width=t},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(t){this._layerSize.height=t},getMapTileSize:function(){return exports.cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(t){this._mapTileSize.width=t.width,this._mapTileSize.height=t.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(t){this._mapTileSize.width=t},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(t){this._mapTileSize.height=t},getTiles:function(){return this.tiles},setTiles:function(t){this.tiles=t},getTileset:function(){return this.tileset},setTileset:function(t){this.tileset=t},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(t){this.layerOrientation=t},getProperties:function(){return this.properties},setProperties:function(t){this.properties=t},getProperty:function(t){return this.properties[t]},getLayerName:function(){return this.layerName},setLayerName:function(t){this.layerName=t},releaseMap:function(){this._spriteTiles={}},getTileAt:function(t,e){if(t===void 0)throw new Error("cc.TMXLayer.getTileAt(): pos should be non-null");var r=t;if(e===void 0&&(r=t.x,e=t.y),r>=this._layerSize.width||e>=this._layerSize.height||r<0||e<0)throw new Error("cc.TMXLayer.getTileAt(): invalid position");if(!this.tiles)return exports.cc.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var n=null,s=this.getTileGIDAt(r,e);if(s===0)return n;var o=0|r+e*this._layerSize.width;if(n=this._spriteTiles[o],!n){var a=this._texGrids[s],c=this._textures[a.texId];a=exports.cc.rectPixelsToPoints(a),n=new exports.cc.Sprite(c,a),n.setPosition(this.getPositionAt(r,e));var l=this._vertexZForPos(r,e);n.setVertexZ(l),n.setAnchorPoint(0,0),n.setOpacity(this._opacity),this.addChild(n,l,o)}return n},getTileGIDAt:function(t,e){if(t===void 0)throw new Error("cc.TMXLayer.getTileGIDAt(): pos should be non-null");var r=t;if(e===void 0&&(r=t.x,e=t.y),r>=this._layerSize.width||e>=this._layerSize.height||r<0||e<0)throw new Error("cc.TMXLayer.getTileGIDAt(): invalid position");if(!this.tiles)return exports.cc.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null;var n=0|r+e*this._layerSize.width,s=this.tiles[n];return(s&exports.cc.TMX_TILE_FLIPPED_MASK)>>>0},setTileGID:function(t,e,r,n){if(e===void 0)throw new Error("cc.TMXLayer.setTileGID(): pos should be non-null");var s;if(n!==void 0?s=exports.cc.p(e,r):(s=e,n=r),s.x>=this._layerSize.width||s.y>=this._layerSize.height||s.x<0||s.y<0)throw new Error("cc.TMXLayer.setTileGID(): invalid position");if(!this.tiles){exports.cc.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released");return}if(t!==0&&t<this.tileset.firstGid){exports.cc.log("cc.TMXLayer.setTileGID(): invalid gid:"+t);return}n=n||0;var o=this.getTileFlagsAt(s),a=this.getTileGIDAt(s);if(a!==t||o!==n){var c=(t|n)>>>0;if(t===0)this.removeTileAt(s);else if(a===0)this._updateTileForGID(c,s);else{var l=s.x+s.y*this._layerSize.width,h=this.getChildByTag(l);if(h){var u=this._texGrids[t],_=this._textures[u.texId];u=exports.cc.rectPixelsToPoints(u),h.setTexture(_),h.setTextureRect(u,!1),n!=null&&this._setupTileSprite(h,s,c),this.tiles[l]=c}else this._updateTileForGID(c,s)}}},addChild:function(t,e,r){exports.cc.Node.prototype.addChild.call(this,t,e,r),r!==void 0&&(this._spriteTiles[r]=t,t._vertexZ=this._vertexZ+exports.cc.renderer.assignedZStep*r/this.tiles.length)},removeChild:function(t,e){this._spriteTiles[t.tag]&&(this._spriteTiles[t.tag]=null),exports.cc.Node.prototype.removeChild.call(this,t,e)},getTileFlagsAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.getTileFlagsAt(): pos should be non-null");if(e!==void 0&&(t=exports.cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.getTileFlagsAt(): invalid position");if(!this.tiles)return exports.cc.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null;var r=0|t.x+t.y*this._layerSize.width,n=this.tiles[r];return(n&exports.cc.TMX_TILE_FLIPPED_ALL)>>>0},removeTileAt:function(t,e){if(!t)throw new Error("cc.TMXLayer.removeTileAt(): pos should be non-null");if(e!==void 0&&(t=exports.cc.p(t,e)),t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw new Error("cc.TMXLayer.removeTileAt(): invalid position");if(!this.tiles){exports.cc.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");return}var r=this.getTileGIDAt(t);if(r!==0){var n=0|t.x+t.y*this._layerSize.width;this.tiles[n]=0;var s=this._spriteTiles[n];s&&this.removeChild(s,!0)}},getPositionAt:function(t,e){e!==void 0&&(t=exports.cc.p(t,e));var r=exports.cc.p(0,0);switch(this.layerOrientation){case exports.cc.TMX_ORIENTATION_ORTHO:r=this._positionForOrthoAt(t);break;case exports.cc.TMX_ORIENTATION_ISO:r=this._positionForIsoAt(t);break;case exports.cc.TMX_ORIENTATION_HEX:r=this._positionForHexAt(t);break}return exports.cc.pointPixelsToPoints(r)},_positionForIsoAt:function(t){return exports.cc.p(this._mapTileSize.width/2*(this._layerSize.width+t.x-t.y-1),this._mapTileSize.height/2*(this._layerSize.height*2-t.x-t.y-2))},_positionForOrthoAt:function(t){return exports.cc.p(t.x*this._mapTileSize.width,(this._layerSize.height-t.y-1)*this._mapTileSize.height)},_positionForHexAt:function(t){var e=t.x%2===1?-this._mapTileSize.height/2:0;return exports.cc.p(t.x*this._mapTileSize.width*3/4,(this._layerSize.height-t.y-1)*this._mapTileSize.height+e)},_calculateLayerOffset:function(t){var e=exports.cc.p(0,0);switch(this.layerOrientation){case exports.cc.TMX_ORIENTATION_ORTHO:e=exports.cc.p(t.x*this._mapTileSize.width,-t.y*this._mapTileSize.height);break;case exports.cc.TMX_ORIENTATION_ISO:e=exports.cc.p(this._mapTileSize.width/2*(t.x-t.y),this._mapTileSize.height/2*(-t.x-t.y));break;case exports.cc.TMX_ORIENTATION_HEX:(t.x!==0||t.y!==0)&&exports.cc.log("offset for hexagonal map not implemented yet");break}return e},_updateTileForGID:function(t,e){if(this._texGrids[t]){var r=0|e.x+e.y*this._layerSize.width;r<this.tiles.length&&(this.tiles[r]=t)}},_parseInternalProperties:function(){var t=this.getProperty("cc_vertexz");if(t)if(t==="automatic"){this._useAutomaticVertexZ=!0;var e=this.getProperty("cc_alpha_func"),r=0;e&&(r=parseFloat(e)),exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&(this.shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(exports.cc.UNIFORM_ALPHA_TEST_VALUE_S,r))}else this._vertexZvalue=parseInt(t,10)},_setupTileSprite:function(t,e,r){e.x+e.y*this._layerSize.width;var n=this.getPositionAt(e);if(t.setPosition(n),t.setVertexZ(this._vertexZForPos(e)),t.setAnchorPoint(0,0),t.setOpacity(this._opacity),t.setFlippedX(!1),t.setFlippedY(!1),t.setRotation(0),(r&exports.cc.TMX_TILE_DIAGONAL_FLAG)>>>0){t.setAnchorPoint(.5,.5),t.setPosition(n.x+t.width/2,n.y+t.height/2);var s=(r&(exports.cc.TMX_TILE_HORIZONTAL_FLAG|exports.cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0;s===exports.cc.TMX_TILE_HORIZONTAL_FLAG?t.setRotation(90):s===exports.cc.TMX_TILE_VERTICAL_FLAG?t.setRotation(270):s===(exports.cc.TMX_TILE_VERTICAL_FLAG|exports.cc.TMX_TILE_HORIZONTAL_FLAG)>>>0?(t.setRotation(90),t.setFlippedX(!0)):(t.setRotation(270),t.setFlippedX(!0))}else(r&exports.cc.TMX_TILE_HORIZONTAL_FLAG)>>>0&&t.setFlippedX(!0),(r&exports.cc.TMX_TILE_VERTICAL_FLAG)>>>0&&t.setFlippedY(!0)},_vertexZForPos:function(t,e){e===void 0&&(e=t.y,t=t.x);var r=0,n=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case exports.cc.TMX_ORIENTATION_ISO:n=this._layerSize.width+this._layerSize.height,r=-(n-(t+e));break;case exports.cc.TMX_ORIENTATION_ORTHO:r=-(this._layerSize.height-e);break;case exports.cc.TMX_ORIENTATION_HEX:exports.cc.log("TMX Hexa zOrder not supported");break;default:exports.cc.log("TMX invalid value");break}else r=this._vertexZvalue;return r}});var _p=exports.cc.TMXLayer.prototype;_p.layerWidth;exports.cc.defineGetterSetter(_p,"layerWidth",_p._getLayerWidth,_p._setLayerWidth);_p.layerHeight;exports.cc.defineGetterSetter(_p,"layerHeight",_p._getLayerHeight,_p._setLayerHeight);_p.tileWidth;exports.cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);_p.tileHeight;exports.cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);exports.cc.TMXLayer.create=function(t,e,r){return new exports.cc.TMXLayer(t,e,r)};(function(){exports.cc.TMXLayer.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0};var t=exports.cc.TMXLayer.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.TMXLayer.CanvasRenderCmd,t.visit=function(e){var r=this._node,n=exports.cc.renderer;if(e=e||this.getParentRenderCmd(),e&&(this._curLevel=e._curLevel+1),!!r._visible){isNaN(r._customZ)&&(r._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep),this._syncStatus(e);var s=r._children,o,a=r._spriteTiles,c,l=s.length;if(l>0){for(r.sortAllChildren(),c=0;c<l&&(o=s[c],o._localZOrder<0);c++)o._renderCmd.visit(this);for(n.pushRenderCommand(this);c<l;c++){if(o=s[c],o._localZOrder===0&&a[o.tag]){isNaN(o._customZ)&&(o._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep),o._renderCmd.updateStatus();continue}o._renderCmd.visit(this)}}else n.pushRenderCommand(this);this._dirtyFlag=0}},t.rendering=function(e,r,n){var s=this._node,o=s._rotationX||s._rotationY,a=s.layerOrientation,c=s.tiles,l=s._opacity/255;if(!(!c||l<=0)){var h=s._mapTileSize.width,u=s._mapTileSize.height,_=s.tileset._tileSize.width/exports.cc.director._contentScaleFactor,d=s.tileset._tileSize.height/exports.cc.director._contentScaleFactor,f=_-h,T=d-u,x=exports.cc.winSize.width,m=exports.cc.winSize.height,v=s._layerSize.height,A=s._layerSize.width,D=s._texGrids,N=s._spriteTiles,z=this._worldTransform,M=-s._contentSize.width*s._anchorPoint.x,J=-s._contentSize.height*s._anchorPoint.y,U=z.a,K=z.b,tt=z.c,rt=z.d,I=M*U+J*tt+z.tx,L=M*K+J*rt+z.ty,G=e||exports.cc._renderContext,w=G.getContext(),O=0,j=0,Q=A,C=v;!o&&a===exports.cc.TMX_ORIENTATION_ORTHO&&(O=Math.floor(-(I-f*U)/(h*U)),j=Math.floor((L-T*rt+u*v*rt-m)/(u*rt)),Q=Math.ceil((x-I+f*U)/(h*U)),C=v-Math.floor(-(L+T*rt)/(u*rt)),O<0&&(O=0),j<0&&(j=0),Q>A&&(Q=A),C>v&&(C=v));var b,W,S,E=j*A,R,F,k,X,Z,V=exports.cc.TMX_TILE_FLIPPED_MASK,Y,$,et,ct,ht=_,pt=d,mt=_*U,dt=d*rt,xt,Tt,lt,at,At=!1,St=!1;R=E+O;for(b in N)if(b<R&&N[b])Z=N[b]._renderCmd,N[b]._localZOrder===0&&Z.rendering&&Z.rendering(e,r,n);else if(b>=R)break;for(G.setTransform(z,r,n),G.setGlobalAlpha(l),W=j;W<C;++W){for(S=O;S<Q;++S){if(R=E+S,N[R]){Z=N[R]._renderCmd,N[R]._localZOrder===0&&Z.rendering&&(Z.rendering(e,r,n),G.setTransform(z,r,n),G.setGlobalAlpha(l));continue}if(F=s.tiles[R],k=D[(F&V)>>>0],!!k&&(X=s._textures[k.texId],!(!X||!X._htmlElementObj))){switch(a){case exports.cc.TMX_ORIENTATION_ORTHO:$=S*h,et=-(v-W-1)*u;break;case exports.cc.TMX_ORIENTATION_ISO:$=h/2*(A+S-W-1),et=-u/2*(v*2-S-W-2);break;case exports.cc.TMX_ORIENTATION_HEX:$=S*h*3/4,et=-(v-W-1)*u+(S%2===1?-u/2:0);break}if(ct=$+_,Y=et-d,!o&&a===exports.cc.TMX_ORIENTATION_ISO){if(lt=-L+et*rt,lt<-m-dt){S+=Math.floor((-m-lt)*2/dt)-1;continue}if(at=I+ct*U,at<-mt){S+=Math.floor(-at*2/mt)-1;continue}if(Tt=I+$*U,xt=-L+Y*rt,Tt>x||xt>0){S=Q;continue}}F>exports.cc.TMX_TILE_DIAGONAL_FLAG&&(At=(F&exports.cc.TMX_TILE_HORIZONTAL_FLAG)>>>0,St=(F&exports.cc.TMX_TILE_VERTICAL_FLAG)>>>0),At&&($=-ct,w.scale(-1,1)),St&&(Y=-et,w.scale(1,-1)),w.drawImage(X._htmlElementObj,k.x,k.y,k.width,k.height,$,Y,ht,pt),At&&w.scale(-1,1),St&&w.scale(1,-1),exports.cc.g_NumberOfDraws++}}E+=A}for(b in N)b>R&&N[b]&&(Z=N[b]._renderCmd,N[b]._localZOrder===0&&Z.rendering&&Z.rendering(e,r,n))}}})();(function(){exports.cc.TMXLayer.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._vertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._color=new Uint32Array(1),this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);var r=Math.PI*90/180;this._sin90=Math.sin(r),this._cos90=Math.cos(r),r=r*3,this._sin270=Math.sin(r),this._cos270=Math.cos(r)};var t=exports.cc.TMXLayer.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.TMXLayer.WebGLRenderCmd,t.uploadData=function(e,r,n){var s=this._node,o=s._rotationX||s._rotationY,a=s.layerOrientation,c=s.tiles;if(!c)return 0;exports.cc.view._scaleX,exports.cc.view._scaleY;var l=s._mapTileSize.width,h=s._mapTileSize.height,u=s.tileset._tileSize.width/exports.cc.director._contentScaleFactor,_=s.tileset._tileSize.height/exports.cc.director._contentScaleFactor,d=u-l,f=_-h,T=exports.cc.winSize.width,x=exports.cc.winSize.height,m=s._layerSize.height,v=s._layerSize.width,A=s._texGrids,D=s._spriteTiles,N=this._worldTransform,z=N.a,M=N.b,J=N.c,U=N.d,K=N.tx,tt=N.ty,rt=-s._contentSize.width*s._anchorPoint.x,I=-s._contentSize.height*s._anchorPoint.y,L=rt*z+I*J+K,G=rt*M+I*U+tt,w=s._opacity,O=this._displayedColor.r,j=this._displayedColor.g,Q=this._displayedColor.b;if(s._opacityModifyRGB){var C=w/255;O*=C,j*=C,Q*=C}this._color[0]=w<<24|Q<<16|j<<8|O;var b=0,W=0,S=v,E=m;!o&&a===exports.cc.TMX_ORIENTATION_ORTHO&&(b=Math.floor(-(L-d*z)/(l*z)),W=Math.floor((G-f*U+h*m*U-x)/(h*U)),S=Math.ceil((T-L+d*z)/(l*z)),E=m-Math.floor(-(G+f*U)/(h*U)),b<0&&(b=0),W<0&&(W=0),S>v&&(S=v),E>m&&(E=m));var R,F,k=n,X=W*v,Z,V,Y,$=exports.cc.TMX_TILE_FLIPPED_MASK,et,ct,ht,pt,mt,dt=u*z,xt=_*U,Tt,lt,at,At,St=z,wt=M,Pt=J,It=U,zt=K,Vt=tt,ot=!1,st=!1,ut=!1,ft=this._vertices;for(R=W;R<E;++R){for(F=b;F<S;++F)if(k+24>e.length&&(exports.cc.renderer._increaseBatchingSize((k-n)/6),exports.cc.renderer._batchRendering(),n=0,k=0),Z=X+F,!D[Z]&&(V=s.tiles[Z],Y=A[(V&$)>>>0],!!Y)){switch(a){case exports.cc.TMX_ORIENTATION_ORTHO:ht=F*l,pt=(m-R-1)*h,Z=s._vertexZ+exports.cc.renderer.assignedZStep*Z/c.length;break;case exports.cc.TMX_ORIENTATION_ISO:ht=l/2*(v+F-R-1),pt=h/2*(m*2-F-R-2),Z=s._vertexZ+exports.cc.renderer.assignedZStep*(s.height-pt)/s.height;break;case exports.cc.TMX_ORIENTATION_HEX:ht=F*l*3/4,pt=(m-R-1)*h+(F%2===1?-h/2:0),Z=s._vertexZ+exports.cc.renderer.assignedZStep*(s.height-pt)/s.height;break}if(mt=ht+u,ct=pt+_,!o&&a===exports.cc.TMX_ORIENTATION_ISO){if(at=G+pt*U,at>x+xt){F+=Math.floor((at-x)*2/xt)-1;continue}if(At=L+mt*z,At<-dt){F+=Math.floor(-At*2/dt)-1;continue}if(lt=L+ht*z,Tt=G+ct*U,lt>T||Tt<0){F=S;continue}}for(V>exports.cc.TMX_TILE_DIAGONAL_FLAG&&(ot=!0,st=(V&exports.cc.TMX_TILE_HORIZONTAL_FLAG)>>>0,ut=(V&exports.cc.TMX_TILE_VERTICAL_FLAG)>>>0),ft[0].x=ht*St+ct*Pt+zt,ft[0].y=ht*wt+ct*It+Vt,ft[1].x=ht*St+pt*Pt+zt,ft[1].y=ht*wt+pt*It+Vt,ft[2].x=mt*St+ct*Pt+zt,ft[2].y=mt*wt+ct*It+Vt,ft[3].x=mt*St+pt*Pt+zt,ft[3].y=mt*wt+pt*It+Vt,et=0;et<4;++et){switch(e[k]=ft[et].x,e[k+1]=ft[et].y,e[k+2]=Z,r[k+3]=this._color[0],et){case 0:e[k+4]=st?Y.r:Y.l,e[k+5]=ut?Y.b:Y.t;break;case 1:e[k+4]=st?Y.r:Y.l,e[k+5]=ut?Y.t:Y.b;break;case 2:e[k+4]=st?Y.l:Y.r,e[k+5]=ut?Y.b:Y.t;break;case 3:e[k+4]=st?Y.l:Y.r,e[k+5]=ut?Y.t:Y.b;break}k+=6}ot&&(St=z,wt=M,Pt=J,It=U,zt=K,Vt=tt,st=!1,ut=!1,ot=!1)}X+=v}return(k-n)/6}})();exports.cc.PointObject=exports.cc.Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(t,e){this.initWithCCPoint(t,e)},getRatio:function(){return this._ratio},setRatio:function(t){this._ratio=t},getOffset:function(){return this._offset},setOffset:function(t){this._offset=t},getChild:function(){return this._child},setChild:function(t){this._child=t},initWithCCPoint:function(t,e){return this._ratio=t,this._offset=e,this._child=null,!0}});exports.cc.PointObject.create=function(t,e){return new exports.cc.PointObject(t,e)};exports.cc.ParallaxNode=exports.cc.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(t){this.parallaxArray=t},ctor:function(){exports.cc.Node.prototype.ctor.call(this),this.parallaxArray=[],this._lastPosition=exports.cc.p(-100,-100)},addChild:function(t,e,r,n){if(arguments.length===3){exports.cc.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");return}if(!t)throw new Error("cc.ParallaxNode.addChild(): child should be non-null");var s=new exports.cc.PointObject(r,n);s.setChild(t),this.parallaxArray.push(s),t.setPosition(this._position.x*r.x+n.x,this._position.y*r.y+n.y),exports.cc.Node.prototype.addChild.call(this,t,e,t.tag)},removeChild:function(t,e){for(var r=this.parallaxArray,n=0;n<r.length;n++){var s=r[n];if(s.getChild()===t){r.splice(n,1);break}}exports.cc.Node.prototype.removeChild.call(this,t,e)},removeAllChildren:function(t){this.parallaxArray.length=0,exports.cc.Node.prototype.removeAllChildren.call(this,t)},_updateParallaxPosition:function(){var t=this._absolutePosition();if(!exports.cc.pointEqualToPoint(t,this._lastPosition)){for(var e=this.parallaxArray,r=0,n=e.length;r<n;r++){var s=e[r],o=s.getChild();o.setPosition(-t.x+t.x*s.getRatio().x+s.getOffset().x,-t.y+t.y*s.getRatio().y+s.getOffset().y)}this._lastPosition=t}},_absolutePosition:function(){for(var t=this._position,e=this||window;e.parent!==null;)e=e.parent,t=exports.cc.pAdd(t,e.getPosition());return t},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ParallaxNode.CanvasRenderCmd(this):new exports.cc.ParallaxNode.WebGLRenderCmd(this)}});exports.cc.ParallaxNode.create=function(){return new exports.cc.ParallaxNode};(function(){exports.cc.ParallaxNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!1};var t=exports.cc.ParallaxNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.ParallaxNode.CanvasRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),exports.cc.Node.CanvasRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(e){this._node._updateParallaxPosition(),exports.cc.Node.CanvasRenderCmd.prototype._syncStatus.call(this,e)}})();exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL){exports.cc.ParallaxNode.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!1};var t=exports.cc.ParallaxNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=exports.cc.ParallaxNode.WebGLRenderCmd,t.updateStatus=function(){this._node._updateParallaxPosition(),exports.cc.Node.WebGLRenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(e){this._node._updateParallaxPosition(),exports.cc.Node.WebGLRenderCmd.prototype._syncStatus.call(this,e)}}});exports.cc.CONTROL_EVENT_TOTAL_NUMBER=9;exports.cc.CONTROL_EVENT_TOUCH_DOWN=1;exports.cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=2;exports.cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=4;exports.cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=8;exports.cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=16;exports.cc.CONTROL_EVENT_TOUCH_UP_INSIDE=32;exports.cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=64;exports.cc.CONTROL_EVENT_TOUCH_CANCEL=128;exports.cc.CONTROL_EVENT_VALUECHANGED=256;exports.cc.CONTROL_STATE_NORMAL=1;exports.cc.CONTROL_STATE_HIGHLIGHTED=2;exports.cc.CONTROL_STATE_DISABLED=4;exports.cc.CONTROL_STATE_SELECTED=8;exports.cc.CONTROL_STATE_INITIAL=8;exports.cc.Control=exports.cc.Layer.extend({_isOpacityModifyRGB:!1,_hasVisibleParents:!1,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(t){this._isOpacityModifyRGB=t;for(var e=this.getChildren(),r=0,n=e.length;r<n;r++){var s=e[r];s&&s.setOpacityModifyRGB(t)}},_state:exports.cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:!1,_selected:!1,_highlighted:!1,_dispatchTable:null,setEnabled:function(t){this._enabled=t,this._state=t?exports.cc.CONTROL_STATE_NORMAL:exports.cc.CONTROL_STATE_DISABLED,this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(t){this._selected=t,this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(t){this._highlighted=t,this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){for(var t=this.getParent(),e=t;e!=null;e=e.getParent())if(!e.isVisible())return!1;return!0},ctor:function(){exports.cc.Layer.prototype.ctor.call(this),this._dispatchTable={},this._color=exports.cc.color.WHITE},init:function(){if(exports.cc.Layer.prototype.init.call(this)){this._state=exports.cc.CONTROL_STATE_NORMAL,this._enabled=!0,this._selected=!1,this._highlighted=!1;var t=exports.cc.EventListener.create({event:exports.cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0});return this.onTouchBegan&&(t.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(t.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(t.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(t.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=t,!0}else return!1},onEnter:function(){var t=this._touchListener;t._isRegistered()||exports.cc.eventManager.addListener(t,this),exports.cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(t){for(var e=0,r=exports.cc.CONTROL_EVENT_TOTAL_NUMBER;e<r;e++)if(t&1<<e)for(var n=this._dispatchListforControlEvent(1<<e),s=0,o=n.length;s<o;s++)n[s].invoke(this)},addTargetWithActionForControlEvents:function(t,e,r){for(var n=0,s=exports.cc.CONTROL_EVENT_TOTAL_NUMBER;n<s;n++)r&1<<n&&this._addTargetWithActionForControlEvent(t,e,1<<n)},removeTargetWithActionForControlEvents:function(t,e,r){for(var n=0,s=exports.cc.CONTROL_EVENT_TOTAL_NUMBER;n<s;n++)r&1<<n&&this._removeTargetWithActionForControlEvent(t,e,1<<n)},getTouchLocation:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},isTouchInside:function(t){var e=t.getLocation();return e=this.getParent().convertToNodeSpace(e),exports.cc.rectContainsPoint(this.getBoundingBox(),e)},_invocationWithTargetAndActionForControlEvent:function(t,e,r){return null},_dispatchListforControlEvent:function(t){return t=t.toString(),this._dispatchTable[t]||(this._dispatchTable[t]=[]),this._dispatchTable[t]},_addTargetWithActionForControlEvent:function(t,e,r){var n=new exports.cc.Invocation(t,e,r),s=this._dispatchListforControlEvent(r);s.push(n)},_removeTargetWithActionForControlEvent:function(t,e,r){var n=this._dispatchListforControlEvent(r);if(!t&&!e)n.length=0;else for(var s=0;s<n.length;){var o=n[s],a=!0;t&&(a=t===o.getTarget()),e&&(a=a&&e===o.getAction()),a?exports.cc.arrayRemoveObject(n,o):s++}},needsLayout:function(){}});var _p=exports.cc.Control.prototype;_p.state;exports.cc.defineGetterSetter(_p,"state",_p.getState);_p.enabled;exports.cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);_p.selected;exports.cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);_p.highlighted;exports.cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted);_p=null;exports.cc.Control.create=function(){var t=new exports.cc.Control;return t&&t.init()?t:null};exports.cc.CONTROL_ZOOM_ACTION_TAG=3435855873;exports.cc.ControlButton=exports.cc.Control.extend({_doesAdjustBackgroundImage:!1,zoomOnTouchDown:!1,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:!1,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:!1,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(t,e,r){exports.cc.Control.prototype.ctor.call(this),this._preferredSize=exports.cc.size(0,0),this._labelAnchorPoint=exports.cc.p(0,0),this._currentTitle="",this._currentTitleColor=exports.cc.color.WHITE,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},r!=null?this.initWithTitleAndFontNameAndFontSize(t,e,r):e!=null?this.initWithLabelAndBackgroundSprite(t,e):t!=null?this.initWithBackgroundSprite(t):this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new exports.cc.LabelTTF("","Arial",12),new exports.cc.Scale9Sprite)},needsLayout:function(){if(this._parentInited){this._titleLabel&&this._titleLabel.setVisible(!1),this._backgroundSprite&&this._backgroundSprite.setVisible(!1),this.setLabelAnchorPoint(this._labelAnchorPoint);var t=this._state;this._currentTitle=this.getTitleForState(t),this._currentTitleColor=this.getTitleColorForState(t),this._titleLabel=this.getTitleLabelForState(t);var e=this._titleLabel;e&&e.setString&&e.setString(this._currentTitle),e&&e.setColor(this._currentTitleColor);var r=this.getContentSize();e&&e.setPosition(r.width/2,r.height/2),this._backgroundSprite=this.getBackgroundSpriteForState(t);var n=this._backgroundSprite;n&&n.setPosition(r.width/2,r.height/2);var s=exports.cc.size(0,0);if(e){var o=e.getBoundingBox();s.width=o.width,s.height=o.height}if(this._doesAdjustBackgroundImage)n&&n.setContentSize(s.width+this._marginH*2,s.height+this._marginV*2);else if(n){var a=n.getPreferredSize();a=exports.cc.size(a.width,a.height),a.width<=0&&(a.width=s.width),a.height<=0&&(a.height=s.height),n.setContentSize(a)}var c=e?e.getBoundingBox():exports.cc.rect(0,0,0,0),l=n?n.getBoundingBox():exports.cc.rect(0,0,0,0),h=exports.cc.rectUnion(c,l);this.setContentSize(h.width,h.height),r=this.getContentSize(),e&&(e.setPosition(r.width/2,r.height/2),e.setVisible(!0)),n&&(n.setPosition(r.width/2,r.height/2),n.setVisible(!0))}},initWithLabelAndBackgroundSprite:function(t,e){if(!t)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null");if(!e)throw new Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null");if(exports.cc.Control.prototype.init.call(this,!0)){this._parentInited=!0,this._titleDispatchTable={},this._titleColorDispatchTable={},this._titleLabelDispatchTable={},this._backgroundSpriteDispatchTable={},this._isPushed=!1,this.zoomOnTouchDown=!0,this._currentTitle=null,this.setAdjustBackgroundImage(!0),this.setPreferredSize(exports.cc.size(0,0)),this.zoomOnTouchDown=!0,this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this._titleLabel=t,this._backgroundSprite=e,this.setOpacity(255),this.setOpacityModifyRGB(!0);var r=t.getString();return this.setTitleForState(r,exports.cc.CONTROL_STATE_NORMAL),this.setTitleColorForState(t.getColor(),exports.cc.CONTROL_STATE_NORMAL),this.setTitleLabelForState(t,exports.cc.CONTROL_STATE_NORMAL),this.setBackgroundSpriteForState(e,exports.cc.CONTROL_STATE_NORMAL),this._state=exports.cc.CONTROL_STATE_NORMAL,this._marginH=24,this._marginV=12,this._labelAnchorPoint=exports.cc.p(.5,.5),this.setPreferredSize(exports.cc.size(0,0)),this.needsLayout(),!0}else return!1},initWithTitleAndFontNameAndFontSize:function(t,e,r){var n=new exports.cc.LabelTTF(t,e,r);return this.initWithLabelAndBackgroundSprite(n,new exports.cc.Scale9Sprite)},initWithBackgroundSprite:function(t){var e=new exports.cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(e,t)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(t){this._doesAdjustBackgroundImage=t,this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(t){return this.zoomOnTouchDown=t},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(t){if(t.width===0&&t.height===0)this._doesAdjustBackgroundImage=!0;else{this._doesAdjustBackgroundImage=!1;var e=this._backgroundSpriteDispatchTable;for(var r in e)e[r].setPreferredSize(t)}this._preferredSize=t,this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(t){this._labelAnchorPoint=t,this._titleLabel&&this._titleLabel.setAnchorPoint(t)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},getOpacity:function(){return this._opacity},setOpacity:function(t){exports.cc.Control.prototype.setOpacity.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var r in e)e[r].setOpacity(t)},setColor:function(t){exports.cc.Control.prototype.setColor.call(this,t);var e=this._backgroundSpriteDispatchTable;for(var r in e)e[r].setColor(t)},getColor:function(){var t=this._realColor;return exports.cc.color(t.r,t.g,t.b,t.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},setMargins:function(t,e){this._marginV=e,this._marginH=t,this.needsLayout()},setEnabled:function(t){exports.cc.Control.prototype.setEnabled.call(this,t),this.needsLayout()},setSelected:function(t){exports.cc.Control.prototype.setSelected.call(this,t),this.needsLayout()},setHighlighted:function(t){this._state=t?exports.cc.CONTROL_STATE_HIGHLIGHTED:exports.cc.CONTROL_STATE_NORMAL,exports.cc.Control.prototype.setHighlighted.call(this,t);var e=this.getActionByTag(exports.cc.CONTROL_ZOOM_ACTION_TAG);if(e&&this.stopAction(e),this.zoomOnTouchDown){var r=this.isHighlighted()&&this.isEnabled()&&!this.isSelected()?1.1:1,n=exports.cc.scaleTo(.05,r);n.setTag(exports.cc.CONTROL_ZOOM_ACTION_TAG),this.runAction(n)}},onTouchBegan:function(t,e){return!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()||!this.hasVisibleParents()?!1:(this._isPushed=!0,this.setHighlighted(!0),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_DOWN),!0)},onTouchMoved:function(t,e){if(!this._enabled||!this._isPushed||this._selected){this._highlighted&&this.setHighlighted(!1);return}var r=this.isTouchInside(t);r&&!this._highlighted?(this.setHighlighted(!0),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)):r&&this._highlighted?this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE):!r&&this._highlighted?(this.setHighlighted(!1),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)):!r&&!this._highlighted&&this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE)},onTouchEnded:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.isTouchInside(t)?this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_UP_INSIDE):this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)},onTouchCancelled:function(t,e){this._isPushed=!1,this.setHighlighted(!1),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(t){var e=this._titleDispatchTable;return e?e[t]?e[t]:e[exports.cc.CONTROL_STATE_NORMAL]:""},setTitleForState:function(t,e){this._titleDispatchTable[e]=t||"",this.getState()===e&&this.needsLayout()},getTitleColorForState:function(t){var e=this._titleColorDispatchTable[t];return e||(e=this._titleColorDispatchTable[exports.cc.CONTROL_STATE_NORMAL],e)?e:exports.cc.color.WHITE},setTitleColorForState:function(t,e){this._titleColorDispatchTable[e]=t,this.getState()===e&&this.needsLayout()},getTitleLabelForState:function(t){var e=this._titleLabelDispatchTable;return e[t]?e[t]:e[exports.cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(t,e){var r=this._titleLabelDispatchTable;if(r[e]){var n=r[e];n&&this.removeChild(n,!0)}r[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t,1),this.getState()===e&&this.needsLayout()},setTitleTTFForState:function(t,e){var r=this.getTitleForState(e);r||(r=""),this.setTitleLabelForState(new exports.cc.LabelTTF(r,t,12),e)},getTitleTTFForState:function(t){var e=this.getTitleLabelForState(t);return e!=null&&e instanceof exports.cc.LabelTTF?e.getFontName():""},setTitleTTFSizeForState:function(t,e){var r=this.getTitleLabelForState(e);r!=null&&r instanceof exports.cc.LabelTTF&&r.setFontSize(t)},getTitleTTFSizeForState:function(t){var e=this.getTitleLabelForState(t);return e!=null&&e instanceof exports.cc.LabelTTF?e.getFontSize():0},setTitleBMFontForState:function(t,e){var r=this.getTitleForState(e);r||(r=""),this.setTitleLabelForState(new exports.cc.LabelBMFont(r,t),e)},getTitleBMFontForState:function(t){var e=this.getTitleLabelForState(t);return e!=null&&e instanceof exports.cc.LabelBMFont?e.getFntFile():""},getBackgroundSpriteForState:function(t){var e=this._backgroundSpriteDispatchTable;return e[t]?e[t]:e[exports.cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(t,e){var r=this._backgroundSpriteDispatchTable;if(r[e]){var n=r[e];n&&this.removeChild(n,!0)}r[e]=t,t.setVisible(!1),t.setAnchorPoint(.5,.5),this.addChild(t);var s=this._preferredSize;(s.width!==0||s.height!==0)&&t.setPreferredSize(s),this._state===e&&this.needsLayout()},setBackgroundSpriteFrameForState:function(t,e){var r=exports.cc.Scale9Sprite.createWithSpriteFrame(t);this.setBackgroundSpriteForState(r,e)}});var _p=exports.cc.ControlButton.prototype;_p.adjustBackground;exports.cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage);_p.preferredSize;exports.cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize);_p.labelAnchor;exports.cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint);_p=null;exports.cc.ControlButton.create=function(t,e,r){return new exports.cc.ControlButton(t,e,r)};exports.cc.RGBA=function(t,e,r,n){this.r=t,this.g=e,this.b=r,this.a=n};exports.cc.HSV=function(t,e,r){this.h=t,this.s=e,this.v=r};exports.cc.ControlUtils={};exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(t,e,r,n){var s=new exports.cc.Sprite("#"+t);return s?(s.setPosition(r),s.setAnchorPoint(n),e.addChild(s),s):null};exports.cc.ControlUtils.HSVfromRGB=function(t){var e=new exports.cc.HSV,r,n,s;if(r=t.r<t.g?t.r:t.g,r=r<t.b?r:t.b,n=t.r>t.g?t.r:t.g,n=n>t.b?n:t.b,e.v=n,s=n-r,n>0)e.s=s/n;else return e.s=0,e.h=-1,e;return t.r>=n?e.h=(t.g-t.b)/s:t.g>=n?e.h=2+(t.b-t.r)/s:e.h=4+(t.r-t.g)/s,e.h*=60,e.h<0&&(e.h+=360),e};exports.cc.ControlUtils.RGBfromHSV=function(t){var e,r,n,s,o,a,c=new exports.cc.RGBA;if(c.a=1,t.s<=0)return t.h?(c.r=0,c.g=0,c.b=0,c):(c.r=t.v,c.g=t.v,c.b=t.v,c);switch(e=t.h,e>=360&&(e=0),e/=60,a=0|e,o=e-a,r=t.v*(1-t.s),n=t.v*(1-t.s*o),s=t.v*(1-t.s*(1-o)),a){case 0:c.r=t.v,c.g=s,c.b=r;break;case 1:c.r=n,c.g=t.v,c.b=r;break;case 2:c.r=r,c.g=t.v,c.b=s;break;case 3:c.r=r,c.g=n,c.b=t.v;break;case 4:c.r=s,c.g=r,c.b=t.v;break;default:c.r=t.v,c.g=r,c.b=n;break}return c};exports.cc.ControlUtils.CCRectUnion=function(t,e){return exports.cc.rectUnion(t,e)};exports.cc.Invocation=exports.cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(t,e,r){this._target=t,this._action=e,this._controlEvent=r},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(t){this._target&&this._action&&(exports.cc.isString(this._action)?this._target[this._action](t,this._controlEvent):this._action.call(this._target,t,this._controlEvent))}});exports.cc.Spacer=exports.cc.Layer.extend({});exports.cc.Spacer.verticalSpacer=function(t){var e=new exports.cc.Spacer;return e.init(),e.setContentSize(0,t),e};exports.cc.Spacer.horizontalSpacer=function(t){var e=new exports.cc.Spacer;return e.init(),e.setContentSize(t,0),e};exports.cc.MenuPassive=exports.cc.Layer.extend({_color:null,_opacity:0,_className:"MenuPassive",ctor:function(){},getColor:function(){var t=this._color;return exports.cc.color(t.r,t.g,t.b,t.a)},setColor:function(t){var e=this._color;if(e.r=t.r,e.g=t.g,e.b=t.b,this._children&&this._children.length>0)for(var r=0;r<this._children.length;r++)this._children[r]&&this._children[r].setColor(t);t.a!==void 0&&!t.a_undefined&&this.setOpacity(t.a)},getOpacity:function(){return this._opacity},setOpacity:function(t){if(this._opacity=t,this._children&&this._children.length>0)for(var e=0;e<this._children.length;e++)this._children[e]&&this._children[e].setOpacity(t);this._color.a=t},initWithItems:function(t,e){if(this.init()){var r=exports.cc.director.getWinSize();this.ignoreAnchorPointForPosition(!0),this.setAnchorPoint(.5,.5),this.setContentSize(r),this.setPosition(r.width/2,r.height/2);var n=0;if(t){this.addChild(t,n);for(var s=0;s<e.length;s++)e[s]&&(n++,this.addChild(e[s],n))}return!0}return!1},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(exports.cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(t){var e=-t,r;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(e+=this._children[r].getContentSize().height*this._children[r].getScaleY()+t);var n=0,s=e/2;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(n=Math.max(n,this._children[r].getContentSize().width),this._children[r].setPosition(0,s-this._children[r].getContentSize().height*this._children[r].getScaleY()/2),s-=this._children[r].getContentSize().height*this._children[r].getScaleY()+t);this.setContentSize(n,e)},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(exports.cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(t){var e=-t,r;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(e+=this._children[r].getContentSize().width*this._children[r].getScaleX()+t);var n=0,s=-e/2;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(n=Math.max(n,this._children[r].getContentSize().height),this._children[r].setPosition(s+this._children[r].getContentSize().width*this._children[r].getScaleX()/2,0),s+=this._children[r].getContentSize().width*this._children[r].getScaleX()+t);this.setContentSize(e,n)},alignItemsInColumns:function(t){var e=[],r;for(r=1;r<arguments.length;r++)e.push(arguments[r]);var n=-5,s=0,o=0,a=0,c,l;if(this._children&&this._children.length>0){for(r=0;r<this._children.length;r++)if(this._children[r]){if(s>=e.length){exports.cc.log("cc.MenuPassive.alignItemsInColumns(): invalid row index");continue}if(c=e[s],!c){exports.cc.log("cc.MenuPassive.alignItemsInColumns(): can not have zero columns on a row");continue}l=this._children[r].getContentSize().height,o=0|(o>=l||l==null?o:l),++a,a>=c&&(n+=o+5,a=0,o=0,++s)}}var h=exports.cc.director.getWinSize();s=0,o=0,c=0;var u=0,_=0,d=n/2;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(c===0&&(c=e[s],u=h.width/(1+c),_=u),l=this._children[r].getContentSize().height,o=0|(o>=l||l==null?o:l),this._children[r].setPosition(_-h.width/2,d-this._children[r].getContentSize().height/2),_+=u,++a,a>=c&&(d-=o+5,a=0,c=0,o=0,++s))},alignItemsInRows:function(t){var e=[],r;for(r=1;r<arguments.length;r++)e.push(arguments[r]);var n=[],s=[],o=-10,a=-5,c=0,l=0,h=0,u,_;if(this._children&&this._children.length>0){for(r=0;r<this._children.length;r++)if(this._children[r]){if(c>=e.length){exports.cc.log("cc.MenuPassive.alignItemsInRows(): invalid row index");continue}if(u=e[c],!u){exports.cc.log("cc.MenuPassive.alignItemsInColumns(): can't have zero rows on a column");continue}_=this._children[r].getContentSize().width,l=0|(l>=_||_==null?l:_),a+=0|this._children[r].getContentSize().height+5,++h,h>=u&&(n.push(l),s.push(a),o+=l+10,h=0,l=0,a=-5,++c)}}var d=exports.cc.director.getWinSize();c=0,l=0,u=null;var f=-o/2,T=0;if(this._children&&this._children.length>0)for(r=0;r<this._children.length;r++)this._children[r]&&(u==null&&(u=e[c],T=s[c]),_=this._children[r].getContentSize().width,l=0|(l>=_||_==null?l:_),this._children[r].setPosition(f+n[c]/2,T-d.height/2),T-=this._children[r].getContentSize().height+10,++h,h>=u&&(f+=l+5,h=0,u=0,l=0,++c))},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1}});exports.cc.MenuPassive.create=function(t){t||(t=null);for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n=new exports.cc.MenuPassive;return n&&n.initWithItems(t,e)?n:null};exports.cc.MenuPassive.createWithItem=function(t){return exports.cc.MenuPassive.create(t,null)};exports.cc.ControlSaturationBrightnessPicker=exports.cc.Control.extend({_saturation:0,_brightness:0,_background:null,_overlay:null,_shadow:null,_slider:null,_startPos:null,_boxPos:0,_boxSize:0,_className:"ControlSaturationBrightnessPicker",ctor:function(t,e){exports.cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getSaturation:function(){return this._saturation},getBrightness:function(){return this._brightness},getBackground:function(){return this._background},getOverlay:function(){return this._brightness},getShadow:function(){return this._shadow},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return exports.cc.Control.prototype.init.call(this)?(this._background=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerBackground.png",t,e,exports.cc.p(0,0)),this._overlay=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerOverlay.png",t,e,exports.cc.p(0,0)),this._shadow=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerShadow.png",t,e,exports.cc.p(0,0)),this._slider=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,exports.cc.p(.5,.5)),this._startPos=e,this._boxPos=35,this._boxSize=this._background.getContentSize().width/2,!0):!1},setEnabled:function(t){exports.cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},updateWithHSV:function(t){var e=new exports.cc.HSV;e.s=1,e.h=t.h,e.v=1;var r=exports.cc.ControlUtils.RGBfromHSV(e);this._background.setColor(exports.cc.color(0|r.r*255,0|r.g*255,0|r.b*255))},updateDraggerWithHSV:function(t){var e=exports.cc.p(this._startPos.x+this._boxPos+this._boxSize*(1-t.s),this._startPos.y+this._boxPos+this._boxSize*t.v);this._updateSliderPosition(e)},_updateSliderPosition:function(t){var e=this._startPos.x+this._background.getBoundingBox().width*.5,r=this._startPos.y+this._background.getBoundingBox().height*.5,n=t.x-e,s=t.y-r,o=Math.sqrt(n*n+s*s),a=Math.atan2(s,n),c=this._background.getBoundingBox().width*.5;o>c&&(t.x=e+c*Math.cos(a),t.y=r+c*Math.sin(a)),this._slider.setPosition(t),t.x<this._startPos.x+this._boxPos?t.x=this._startPos.x+this._boxPos:t.x>this._startPos.x+this._boxPos+this._boxSize-1&&(t.x=this._startPos.x+this._boxPos+this._boxSize-1),t.y<this._startPos.y+this._boxPos?t.y=this._startPos.y+this._boxPos:t.y>this._startPos.y+this._boxPos+this._boxSize&&(t.y=this._startPos.y+this._boxPos+this._boxSize),this._saturation=1-Math.abs((this._startPos.x+this._boxPos-t.x)/this._boxSize),this._brightness=Math.abs((this._startPos.y+this._boxPos-t.y)/this._boxSize)},_checkSliderPosition:function(t){var e=this._startPos.x+this._background.getBoundingBox().width*.5,r=this._startPos.y+this._background.getBoundingBox().height*.5,n=t.x-e,s=t.y-r,o=Math.sqrt(n*n+s*s);return o<=this._background.getBoundingBox().width*.5?(this._updateSliderPosition(t),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED),!0):!1},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible())return!1;var r=this.getTouchLocation(t);return this._checkSliderPosition(r)},onTouchMoved:function(t,e){var r=this.getTouchLocation(t);this._checkSliderPosition(r)}});var _p=exports.cc.ControlSaturationBrightnessPicker.prototype;_p.saturation;exports.cc.defineGetterSetter(_p,"saturation",_p.getSaturation);_p.brightness;exports.cc.defineGetterSetter(_p,"brightness",_p.getBrightness);_p.background;exports.cc.defineGetterSetter(_p,"background",_p.getBackground);_p.overlay;exports.cc.defineGetterSetter(_p,"overlay",_p.getOverlay);_p.shadow;exports.cc.defineGetterSetter(_p,"shadow",_p.getShadow);_p.slider;exports.cc.defineGetterSetter(_p,"slider",_p.getSlider);_p.startPos;exports.cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;exports.cc.ControlSaturationBrightnessPicker.create=function(t,e){return new exports.cc.ControlSaturationBrightnessPicker(t,e)};exports.cc.ControlHuePicker=exports.cc.Control.extend({_hue:0,_huePercentage:0,_background:null,_slider:null,_startPos:null,_className:"ControlHuePicker",ctor:function(t,e){exports.cc.Control.prototype.ctor.call(this),e&&this.initWithTargetAndPos(t,e)},getHue:function(){return this._hue},setHue:function(t){this._hue=t,this.setHuePercentage(this._hue/360)},getHuePercentage:function(){return this._huePercentage},setHuePercentage:function(t){this._huePercentage=t,this._hue=this._huePercentage*360;var e=this._background.getBoundingBox(),r=this._startPos.x+e.width*.5,n=this._startPos.y+e.height*.5,s=e.width*.5-15,o=this._huePercentage*360-180,a=exports.cc.degreesToRadians(o),c=r+s*Math.cos(a),l=n+s*Math.sin(a);this._slider.setPosition(c,l)},setEnabled:function(t){exports.cc.Control.prototype.setEnabled.call(this,t),this._slider&&this._slider.setOpacity(t?255:128)},getBackground:function(){return this._background},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(t,e){return exports.cc.Control.prototype.init.call(this)?(this._background=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("huePickerBackground.png",t,e,exports.cc.p(0,0)),this._slider=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",t,e,exports.cc.p(.5,.5)),this._slider.setPosition(e.x,e.y+this._background.getBoundingBox().height*.5),this._startPos=e,this._hue=0,this._huePercentage=0,!0):!1},_updateSliderPosition:function(t){var e=this._background.getBoundingBox(),r=this._startPos.x+e.width*.5,n=this._startPos.y+e.height*.5,s=t.x-r,o=t.y-n,a=Math.atan2(o,s),c=exports.cc.radiansToDegrees(a)+180;this.setHue(c),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},_checkSliderPosition:function(t){var e=Math.sqrt(Math.pow(t.x+10,2)+Math.pow(t.y,2));return 80>e&&e>59?(this._updateSliderPosition(t),!0):!1},onTouchBegan:function(t,e){if(!this.isEnabled()||!this.isVisible())return!1;var r=this.getTouchLocation(t);return this._checkSliderPosition(r)},onTouchMoved:function(t,e){var r=this.getTouchLocation(t);this._checkSliderPosition(r)}});var _p=exports.cc.ControlHuePicker.prototype;_p.hue;exports.cc.defineGetterSetter(_p,"hue",_p.getHue,_p.setHue);_p.huePercent;exports.cc.defineGetterSetter(_p,"huePercent",_p.getHuePercentage,_p.setHuePercentage);_p.background;exports.cc.defineGetterSetter(_p,"background",_p.getBackground);_p.slider;exports.cc.defineGetterSetter(_p,"slider",_p.getSlider);_p.startPos;exports.cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;exports.cc.ControlHuePicker.create=function(t,e){return new exports.cc.ControlHuePicker(t,e)};exports.cc.ControlColourPicker=exports.cc.Control.extend({_hsv:null,_colourPicker:null,_huePicker:null,_background:null,_className:"ControlColourPicker",ctor:function(){exports.cc.Control.prototype.ctor.call(this),this.init()},hueSliderValueChanged:function(t,e){this._hsv.h=t.getHue();var r=exports.cc.ControlUtils.RGBfromHSV(this._hsv);exports.cc.Control.prototype.setColor.call(this,exports.cc.color(0|r.r*255,0|r.g*255,0|r.b*255)),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED),this._updateControlPicker()},colourSliderValueChanged:function(t,e){this._hsv.s=t.getSaturation(),this._hsv.v=t.getBrightness();var r=exports.cc.ControlUtils.RGBfromHSV(this._hsv);exports.cc.Control.prototype.setColor.call(this,exports.cc.color(0|r.r*255,0|r.g*255,0|r.b*255)),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},setColor:function(t){exports.cc.Control.prototype.setColor.call(this,t);var e=new exports.cc.RGBA;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=1,this._hsv=exports.cc.ControlUtils.HSVfromRGB(e),this._updateHueAndControlPicker()},getBackground:function(){return this._background},init:function(){if(exports.cc.Control.prototype.init.call(this)){exports.cc.spriteFrameCache.addSpriteFrames(res.CCControlColourPickerSpriteSheet_plist);var t=new exports.cc.SpriteBatchNode(res.CCControlColourPickerSpriteSheet_png);this.addChild(t),this._hsv=new exports.cc.HSV(0,0,0),this._background=exports.cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("menuColourPanelBackground.png",t,exports.cc.p(0,0),exports.cc.p(.5,.5));var e=exports.cc.pSub(this._background.getPosition(),exports.cc.p(this._background.getContentSize().width/2,this._background.getContentSize().height/2)),r=8,n=28;return this._huePicker=new exports.cc.ControlHuePicker(t,exports.cc.p(e.x+r,e.y+r)),this._colourPicker=new exports.cc.ControlSaturationBrightnessPicker(t,exports.cc.p(e.x+n,e.y+n)),this._huePicker.addTargetWithActionForControlEvents(this,this.hueSliderValueChanged,exports.cc.CONTROL_EVENT_VALUECHANGED),this._colourPicker.addTargetWithActionForControlEvents(this,this.colourSliderValueChanged,exports.cc.CONTROL_EVENT_VALUECHANGED),this._updateHueAndControlPicker(),this.addChild(this._huePicker),this.addChild(this._colourPicker),this.setContentSize(this._background.getContentSize()),!0}else return!1},_updateControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv)},_updateHueAndControlPicker:function(){this._huePicker.setHue(this._hsv.h),this._colourPicker.updateWithHSV(this._hsv),this._colourPicker.updateDraggerWithHSV(this._hsv)},setEnabled:function(t){exports.cc.Control.prototype.setEnabled.call(this,t),this._huePicker!==null&&this._huePicker.setEnabled(t),this._colourPicker&&this._colourPicker.setEnabled(t)},onTouchBegan:function(){return!1}});var _p=exports.cc.ControlColourPicker.prototype;_p.background;exports.cc.defineGetterSetter(_p,"background",_p.getBackground);_p=null;exports.cc.ControlColourPicker.create=function(){return new exports.cc.ControlColourPicker};var res=res||{};res.CCControlColourPickerSpriteSheet_plist=res.CCControlColourPickerSpriteSheet_plist||"res/extensions/CCControlColourPickerSpriteSheet.plist";res.CCControlColourPickerSpriteSheet_png=res.CCControlColourPickerSpriteSheet_png||"res/extensions/CCControlColourPickerSpriteSheet.png";exports.cc.SLIDER_MARGIN_H=24;exports.cc.SLIDER_MARGIN_V=8;exports.cc.ControlSlider=exports.cc.Control.extend({_value:0,_minimumValue:0,_maximumValue:0,_minimumAllowedValue:0,_maximumAllowedValue:0,_thumbSprite:null,_progressSprite:null,_backgroundSprite:null,_className:"ControlSlider",ctor:function(t,e,r){if(exports.cc.Control.prototype.ctor.call(this),r!=null){var n=new exports.cc.Sprite(t),s=new exports.cc.Sprite(e),o=new exports.cc.Sprite(r);this.initWithSprites(n,s,o)}},getValue:function(){return this._value},setValue:function(t){t=Math.max(t,this._minimumValue),t=Math.min(t,this._maximumValue),this._value=t,this.needsLayout(),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},getMinimumValue:function(){return this._minimumValue},setMinimumValue:function(t){this._minimumValue=t,this._minimumAllowedValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setMaximumValue:function(t){this._maximumValue=t,this._maximumAllowedValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._value)},isTouchInside:function(t){var e=t.getLocation();e=this.getParent().convertToNodeSpace(e);var r=this.getBoundingBox();return r.width+=this._thumbSprite.getContentSize().width,r.x-=this._thumbSprite.getContentSize().width/2,exports.cc.rectContainsPoint(r,e)},locationFromTouch:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e),e.x<0?e.x=0:e.x>this._backgroundSprite.getContentSize().width&&(e.x=this._backgroundSprite.getContentSize().width),e},getMinimumAllowedValue:function(){return this._minimumAllowedValue},setMinimumAllowedValue:function(t){this._minimumAllowedValue=t},getMaximumAllowedValue:function(){return this._maximumAllowedValue},setMaximumAllowedValue:function(t){this._maximumAllowedValue=t},getThumbSprite:function(){return this._thumbSprite},getProgressSprite:function(){return this._progressSprite},getBackgroundSprite:function(){return this._backgroundSprite},initWithSprites:function(t,e,r){if(exports.cc.Control.prototype.init.call(this)){this.ignoreAnchorPointForPosition(!1),this._backgroundSprite=t,this._progressSprite=e,this._thumbSprite=r;var n=exports.cc.ControlUtils.CCRectUnion(t.getBoundingBox(),r.getBoundingBox());return this.setContentSize(n.width,n.height),this._backgroundSprite.setAnchorPoint(.5,.5),this._backgroundSprite.setPosition(n.width/2,n.height/2),this.addChild(this._backgroundSprite),this._progressSprite.setAnchorPoint(0,.5),this._progressSprite.setPosition(0,n.height/2),this.addChild(this._progressSprite),this._thumbSprite.setPosition(0,n.height/2),this.addChild(this._thumbSprite),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0}else return!1},setEnabled:function(t){exports.cc.Control.prototype.setEnabled.call(this,t),this._thumbSprite&&this._thumbSprite.setOpacity(t?255:128)},sliderBegan:function(t){this.setSelected(!0),this._thumbSprite.setColor(exports.cc.color.GRAY),this.setValue(this.valueForLocation(t))},sliderMoved:function(t){this.setValue(this.valueForLocation(t))},sliderEnded:function(t){this.isSelected()&&this.setValue(this.valueForLocation(this._thumbSprite.getPosition())),this._thumbSprite.setColor(exports.cc.color.WHITE),this.setSelected(!1)},getTouchLocationInControl:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e),e.x<0?e.x=0:e.x>this._backgroundSprite.getContentSize().width+exports.cc.SLIDER_MARGIN_H&&(e.x=this._backgroundSprite.getContentSize().width+exports.cc.SLIDER_MARGIN_H),e},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var r=this.locationFromTouch(t);return this.sliderBegan(r),!0},onTouchMoved:function(t,e){var r=this.locationFromTouch(t);this.sliderMoved(r)},onTouchEnded:function(t,e){this.sliderEnded(exports.cc.p(0,0))},needsLayout:function(){var t=(this._value-this._minimumValue)/(this._maximumValue-this._minimumValue);this._thumbSprite.setPositionX(t*this._backgroundSprite.getContentSize().width);var e=this._progressSprite.getTextureRect();e=exports.cc.rect(e.x,e.y,this._thumbSprite.getPositionX(),e.height),this._progressSprite.setTextureRect(e,this._progressSprite.isTextureRectRotated()),this._thumbSprite._renderCmd.transform(this._renderCmd)},valueForLocation:function(t){var e=t.x/this._backgroundSprite.getContentSize().width;return Math.max(Math.min(this._minimumValue+e*(this._maximumValue-this._minimumValue),this._maximumAllowedValue),this._minimumAllowedValue)}});var _p=exports.cc.ControlSlider.prototype;_p.value;exports.cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;exports.cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;exports.cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.minAllowedValue;exports.cc.defineGetterSetter(_p,"minAllowedValue",_p.getMinimumAllowedValue,_p.setMinimumAllowedValue);_p.maxAllowedValue;exports.cc.defineGetterSetter(_p,"maxAllowedValue",_p.getMaximumAllowedValue,_p.setMaximumAllowedValue);_p.thumbSprite;exports.cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite);_p.progressSprite;exports.cc.defineGetterSetter(_p,"progressSprite",_p.getProgressSprite);_p.backgroundSprite;exports.cc.defineGetterSetter(_p,"backgroundSprite",_p.getBackgroundSprite);_p=null;exports.cc.ControlSlider.create=function(t,e,r){return new exports.cc.ControlSlider(t,e,r)};exports.cc.ControlSwitch=exports.cc.Control.extend({_switchSprite:null,_initialTouchXPosition:0,_moved:!1,_on:!1,_className:"ControlSwitch",ctor:function(t,e,r,n,s,o){exports.cc.Control.prototype.ctor.call(this),o&&this.initWithMaskSprite(t,e,r,n,s,o)},initWithMaskSprite:function(t,e,r,n,s,o){if(!t)throw new Error("cc.ControlSwitch.initWithMaskSprite(): maskSprite should be non-null.");if(!e)throw new Error("cc.ControlSwitch.initWithMaskSprite(): onSprite should be non-null.");if(!r)throw new Error("cc.ControlSwitch.initWithMaskSprite(): offSprite should be non-null.");if(!n)throw new Error("cc.ControlSwitch.initWithMaskSprite(): thumbSprite should be non-null.");return this.init()?(this._on=!0,this._switchSprite=new exports.cc.ControlSwitchSprite,this._switchSprite.initWithMaskSprite(t,e,r,n,s,o),this._switchSprite.setPosition(this._switchSprite.getContentSize().width/2,this._switchSprite.getContentSize().height/2),this.addChild(this._switchSprite),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(.5,.5),this.setContentSize(this._switchSprite.getContentSize()),!0):!1},setOn:function(t,e){e=e||!1,this._on=t;var r=this._on?this._switchSprite.getOnPosition():this._switchSprite.getOffPosition();e?this._switchSprite.runAction(new exports.cc.ActionTween(.2,"sliderXPosition",this._switchSprite.getSliderXPosition(),r)):this._switchSprite.setSliderXPosition(r),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},isOn:function(){return this._on},hasMoved:function(){return this._moved},setEnabled:function(t){this._enabled=t,this._switchSprite.setOpacity(t?255:128)},locationFromTouch:function(t){var e=t.getLocation();return e=this.convertToNodeSpace(e),e},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;this._moved=!1;var r=this.locationFromTouch(t);return this._initialTouchXPosition=r.x-this._switchSprite.getSliderXPosition(),this._switchSprite.getThumbSprite().setColor(exports.cc.color.GRAY),this._switchSprite.needsLayout(),!0},onTouchMoved:function(t,e){var r=this.locationFromTouch(t);r=exports.cc.p(r.x-this._initialTouchXPosition,0),this._moved=!0,this._switchSprite.setSliderXPosition(r.x)},onTouchEnded:function(t,e){var r=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(exports.cc.color.WHITE),this.hasMoved()?this.setOn(!(r.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)},onTouchCancelled:function(t,e){var r=this.locationFromTouch(t);this._switchSprite.getThumbSprite().setColor(exports.cc.color.WHITE),this.hasMoved()?this.setOn(!(r.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)}});exports.cc.ControlSwitch.create=function(t,e,r,n,s,o){return new exports.cc.ControlSwitch(t,e,r,n,s,o)};exports.cc.ControlSwitchSprite=exports.cc.Sprite.extend({_sliderXPosition:0,_onPosition:0,_offPosition:0,_textureLocation:0,_maskLocation:0,_maskSize:null,_onSprite:null,_offSprite:null,_thumbSprite:null,_onLabel:null,_offLabel:null,_clipper:null,_stencil:null,_backRT:null,ctor:function(){exports.cc.Sprite.prototype.ctor.call(this),this._sliderXPosition=0,this._onPosition=0,this._offPosition=0,this._maskLocation=0,this._maskSize=exports.cc.size(0,0),this._onSprite=null,this._offSprite=null,this._thumbSprite=null,this._onLabel=null,this._offLabel=null},initWithMaskSprite:function(t,e,r,n,s,o){if(exports.cc.Sprite.prototype.init.call(this)){this.setSpriteFrame(t.displayFrame()),this._onPosition=0,this._offPosition=-e.getContentSize().width+n.getContentSize().width/2,this._sliderXPosition=this._onPosition,this.setOnSprite(e),this.setOffSprite(r),this.setThumbSprite(n),this.setOnLabel(s),this.setOffLabel(o),this._stencil=t;var a=this._maskSize=this._stencil.getContentSize();return this._stencil.setPosition(0,0),this._clipper=new exports.cc.ClippingNode,this._clipper.setAnchorPoint(.5,.5),this._clipper.setPosition(a.width/2,a.height/2),this._clipper.setStencil(this._stencil),this.addChild(this._clipper),this._clipper.addChild(e),this._clipper.addChild(r),this._clipper.addChild(s),this._clipper.addChild(o),this.addChild(this._thumbSprite),this.needsLayout(),!0}return!1},needsLayout:function(){var t=this._maskSize;this._onSprite.setPosition(this._onSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._onSprite.getContentSize().height/2-t.height/2),this._offSprite.setPosition(this._onSprite.getContentSize().width+this._offSprite.getContentSize().width/2+this._sliderXPosition-t.width/2,this._offSprite.getContentSize().height/2-t.height/2),this._onLabel&&this._onLabel.setPosition(this._onSprite.getPositionX()-this._thumbSprite.getContentSize().width/6,this._onSprite.getContentSize().height/2-t.height/2),this._offLabel&&this._offLabel.setPosition(this._offSprite.getPositionX()+this._thumbSprite.getContentSize().width/6,this._offSprite.getContentSize().height/2-t.height/2),this._thumbSprite.setPosition(this._onSprite.getContentSize().width+this._sliderXPosition,this._maskSize.height/2)},setSliderXPosition:function(t){t<=this._offPosition?t=this._offPosition:t>=this._onPosition&&(t=this._onPosition),this._sliderXPosition=t,this.needsLayout()},getSliderXPosition:function(){return this._sliderXPosition},_getOnSideWidth:function(){return this._onSprite.getContentSize().width},_getOffSideWidth:function(){return this._offSprite.getContentSize().height},updateTweenAction:function(t,e){e==="sliderXPosition"&&this.setSliderXPosition(t)},setOnPosition:function(t){this._onPosition=t},getOnPosition:function(){return this._onPosition},setOffPosition:function(t){this._offPosition=t},getOffPosition:function(){return this._offPosition},setMaskTexture:function(t){this._stencil.setTexture(t)},getMaskTexture:function(){return this._stencil.getTexture()},setTextureLocation:function(t){this._textureLocation=t},getTextureLocation:function(){return this._textureLocation},setMaskLocation:function(t){this._maskLocation=t},getMaskLocation:function(){return this._maskLocation},setOnSprite:function(t){this._onSprite=t},getOnSprite:function(){return this._onSprite},setOffSprite:function(t){this._offSprite=t},getOffSprite:function(){return this._offSprite},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setOnLabel:function(t){this._onLabel=t},getOnLabel:function(){return this._onLabel},setOffLabel:function(t){this._offLabel=t},getOffLabel:function(){return this._offLabel}});var _p=exports.cc.ControlSwitchSprite.prototype;_p.sliderX;exports.cc.defineGetterSetter(_p,"sliderX",_p.getSliderXPosition,_p.setSliderXPosition);_p.onPos;exports.cc.defineGetterSetter(_p,"onPos",_p.getOnPosition,_p.setOnPosition);_p.offPos;exports.cc.defineGetterSetter(_p,"offPos",_p.getOffPosition,_p.setOffPosition);_p.maskTexture;exports.cc.defineGetterSetter(_p,"maskTexture",_p.getMaskTexture,_p.setMaskTexture);_p.maskPos;exports.cc.defineGetterSetter(_p,"maskPos",_p.getMaskLocation,_p.setMaskLocation);_p.onSprite;exports.cc.defineGetterSetter(_p,"onSprite",_p.getOnSprite,_p.setOnSprite);_p.offSprite;exports.cc.defineGetterSetter(_p,"offSprite",_p.getOffSprite,_p.setOffSprite);_p.thumbSprite;exports.cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);_p.onLabel;exports.cc.defineGetterSetter(_p,"onLabel",_p.getOnLabel,_p.setOnLabel);_p.offLabel;exports.cc.defineGetterSetter(_p,"offLabel",_p.getOffLabel,_p.setOffLabel);_p.onSideWidth;exports.cc.defineGetterSetter(_p,"onSideWidth",_p._getOnSideWidth);_p.offSideWidth;exports.cc.defineGetterSetter(_p,"offSideWidth",_p._getOffSideWidth);_p=null;exports.cc.CONTROL_STEPPER_PARTMINUS=0;exports.cc.CONTROL_STEPPER_PARTPLUS=1;exports.cc.CONTROL_STEPPER_PARTNONE=2;exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED=exports.cc.color(55,55,55);exports.cc.CONTROL_STEPPER_LABELCOLOR_DISABLED=exports.cc.color(147,147,147);exports.cc.CONTROL_STEPPER_LABELFONT="CourierNewPSMT";exports.cc.AUTOREPEAT_DELTATIME=.15;exports.cc.AUTOREPEAT_INCREASETIME_INCREMENT=12;exports.cc.ControlStepper=exports.cc.Control.extend({_minusSprite:null,_plusSprite:null,_minusLabel:null,_plusLabel:null,_value:0,_continuous:!1,_autorepeat:!1,_wraps:!1,_minimumValue:0,_maximumValue:0,_stepValue:0,_touchInsideFlag:!1,_touchedPart:exports.cc.CONTROL_STEPPER_PARTNONE,_autorepeatCount:0,_className:"ControlStepper",ctor:function(t,e){exports.cc.Control.prototype.ctor.call(this),this._minusSprite=null,this._plusSprite=null,this._minusLabel=null,this._plusLabel=null,this._value=0,this._continuous=!1,this._autorepeat=!1,this._wraps=!1,this._minimumValue=0,this._maximumValue=0,this._stepValue=0,this._touchInsideFlag=!1,this._touchedPart=exports.cc.CONTROL_STEPPER_PARTNONE,this._autorepeatCount=0,e&&this.initWithMinusSpriteAndPlusSprite(t,e)},initWithMinusSpriteAndPlusSprite:function(t,e){if(!t)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Minus sprite should be non-null.");if(!e)throw new Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Plus sprite should be non-null.");if(this.init()){this._autorepeat=!0,this._continuous=!0,this._minimumValue=0,this._maximumValue=100,this._value=0,this._stepValue=1,this._wraps=!1,this.ignoreAnchorPointForPosition(!1),this.setMinusSprite(t),this._minusSprite.setPosition(t.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._minusSprite),this.setMinusLabel(new exports.cc.LabelTTF("-",exports.cc.CONTROL_STEPPER_LABELFONT,40,exports.cc.size(40,40),exports.cc.TEXT_ALIGNMENT_CENTER,exports.cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._minusLabel.setColor(exports.cc.CONTROL_STEPPER_LABELCOLOR_DISABLED),this._minusLabel.setPosition(this._minusSprite.getContentSize().width/2,this._minusSprite.getContentSize().height/2),this._minusSprite.addChild(this._minusLabel),this.setPlusSprite(e),this._plusSprite.setPosition(t.getContentSize().width+e.getContentSize().width/2,t.getContentSize().height/2),this.addChild(this._plusSprite),this.setPlusLabel(new exports.cc.LabelTTF("+",exports.cc.CONTROL_STEPPER_LABELFONT,40,exports.cc.size(40,40),exports.cc.TEXT_ALIGNMENT_CENTER,exports.cc.VERTICAL_TEXT_ALIGNMENT_CENTER)),this._plusLabel.setColor(exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setPosition(this._plusSprite.getContentSize().width/2,this._plusSprite.getContentSize().height/2),this._plusSprite.addChild(this._plusLabel);var r=exports.cc.ControlUtils.CCRectUnion(this._minusSprite.getBoundingBox(),this._plusSprite.getBoundingBox());return this.setContentSize(this._minusSprite.getContentSize().width+this._plusSprite.getContentSize().height,r.height),!0}return!1},setWraps:function(t){this._wraps=t,this._wraps&&(this._minusLabel.setColor(exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),this.setValue(this._value)},getWraps:function(){return this._wraps},setMinimumValue:function(t){if(t>=this._maximumValue)throw new Error("cc.ControlStepper.setMinimumValue(): minimumValue should be numerically less than maximumValue.");this._minimumValue=t,this.setValue(this._value)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){if(t<=this._minimumValue)throw new Error("cc.ControlStepper.setMaximumValue(): maximumValue should be numerically less than maximumValue.");this._maximumValue=t,this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setValue:function(t){this.setValueWithSendingEvent(t,!0)},getValue:function(){return this._value},setStepValue:function(t){if(t<=0)throw new Error("cc.ControlStepper.setMaximumValue(): stepValue should be numerically greater than 0.");this._stepValue=t},getStepValue:function(){return this._stepValue},isContinuous:function(){return this._continuous},setValueWithSendingEvent:function(t,e){t<this._minimumValue?t=this._wraps?this._maximumValue:this._minimumValue:t>this._maximumValue&&(t=this._wraps?this._minimumValue:this._maximumValue),this._value=t,this._wraps||(this._minusLabel.setColor(t===this._minimumValue?exports.cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(t===this._maximumValue?exports.cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:exports.cc.CONTROL_STEPPER_LABELCOLOR_ENABLED)),e&&this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},startAutorepeat:function(){this._autorepeatCount=-1,this.schedule(this.update,exports.cc.AUTOREPEAT_DELTATIME,exports.cc.REPEAT_FOREVER,exports.cc.AUTOREPEAT_DELTATIME*3)},stopAutorepeat:function(){this.unschedule(this.update)},update:function(t){this._autorepeatCount++,!(this._autorepeatCount<exports.cc.AUTOREPEAT_INCREASETIME_INCREMENT&&this._autorepeatCount%3!==0)&&(this._touchedPart===exports.cc.CONTROL_STEPPER_PARTMINUS?this.setValueWithSendingEvent(this._value-this._stepValue,this._continuous):this._touchedPart===exports.cc.CONTROL_STEPPER_PARTPLUS&&this.setValueWithSendingEvent(this._value+this._stepValue,this._continuous))},updateLayoutUsingTouchLocation:function(t){t.x<this._minusSprite.getContentSize().width&&this._value>this._minimumValue?(this._touchedPart=exports.cc.CONTROL_STEPPER_PARTMINUS,this._minusSprite.setColor(exports.cc.color.GRAY),this._plusSprite.setColor(exports.cc.color.WHITE)):t.x>=this._minusSprite.getContentSize().width&&this._value<this._maximumValue?(this._touchedPart=exports.cc.CONTROL_STEPPER_PARTPLUS,this._minusSprite.setColor(exports.cc.color.WHITE),this._plusSprite.setColor(exports.cc.color.GRAY)):(this._touchedPart=exports.cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(exports.cc.color.WHITE),this._plusSprite.setColor(exports.cc.color.WHITE))},onTouchBegan:function(t,e){if(!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible())return!1;var r=this.getTouchLocation(t);return this.updateLayoutUsingTouchLocation(r),this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat(),!0},onTouchMoved:function(t,e){if(this.isTouchInside(t)){var r=this.getTouchLocation(t);this.updateLayoutUsingTouchLocation(r),this._touchInsideFlag||(this._touchInsideFlag=!0,this._autorepeat&&this.startAutorepeat())}else this._touchInsideFlag=!1,this._touchedPart=exports.cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(exports.cc.color.WHITE),this._plusSprite.setColor(exports.cc.color.WHITE),this._autorepeat&&this.stopAutorepeat()},onTouchEnded:function(t,e){if(this._minusSprite.setColor(exports.cc.color.WHITE),this._plusSprite.setColor(exports.cc.color.WHITE),this._autorepeat&&this.stopAutorepeat(),this.isTouchInside(t)){var r=this.getTouchLocation(t);this.setValue(this._value+(r.x<this._minusSprite.getContentSize().width?0-this._stepValue:this._stepValue))}},setMinusSprite:function(t){this._minusSprite=t},getMinusSprite:function(){return this._minusSprite},setPlusSprite:function(t){this._plusSprite=t},getPlusSprite:function(){return this._plusSprite},setMinusLabel:function(t){this._minusLabel=t},getMinusLabel:function(){return this._minusLabel},setPlusLabel:function(t){this._plusLabel=t},getPlusLabel:function(){return this._plusLabel}});var _p=exports.cc.ControlStepper.prototype;_p.wraps;exports.cc.defineGetterSetter(_p,"wraps",_p.getWraps,_p.setWraps);_p.value;exports.cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;exports.cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;exports.cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.stepValue;exports.cc.defineGetterSetter(_p,"stepValue",_p.getStepValue,_p.setStepValue);_p.continuous;exports.cc.defineGetterSetter(_p,"continuous",_p.isContinuous);_p.minusSprite;exports.cc.defineGetterSetter(_p,"minusSprite",_p.getMinusSprite,_p.setMinusSprite);_p.plusSprite;exports.cc.defineGetterSetter(_p,"plusSprite",_p.getPlusSprite,_p.setPlusSprite);_p.minusLabel;exports.cc.defineGetterSetter(_p,"minusLabel",_p.getMinusLabel,_p.setMinusLabel);_p.plusLabel;exports.cc.defineGetterSetter(_p,"plusLabel",_p.getPlusLabel,_p.setPlusLabel);_p=null;exports.cc.ControlStepper.create=function(t,e){return new exports.cc.ControlStepper(t,e)};exports.cc.ControlPotentiometer=exports.cc.Control.extend({_thumbSprite:null,_progressTimer:null,_previousLocation:null,_value:0,_minimumValue:0,_maximumValue:1,_className:"ControlPotentiometer",ctor:function(t,e,r){if(exports.cc.Control.prototype.ctor.call(this),r!=null){var n=new exports.cc.Sprite(t),s=new exports.cc.Sprite(r),o=new exports.cc.ProgressTimer(new exports.cc.Sprite(e));this.initWithTrackSprite_ProgressTimer_ThumbSprite(n,o,s)}},initWithTrackSprite_ProgressTimer_ThumbSprite:function(t,e,r){return this.init()?(this.setProgressTimer(e),this.setThumbSprite(r),this._thumbSprite.setPosition(e.getPosition()),this.addChild(r,2),this.addChild(e,1),this.addChild(t),this.setContentSize(t.getContentSize()),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0):!1},setEnabled:function(t){this.setEnabled(t),this._thumbSprite!==null&&this._thumbSprite.setOpacity(t?255:128)},setValue:function(t){t<this._minimumValue&&(t=this._minimumValue),t>this._maximumValue&&(t=this._maximumValue),this._value=t;var e=(t-this._minimumValue)/(this._maximumValue-this._minimumValue);this._progressTimer.setPercentage(e*100),this._thumbSprite.setRotation(e*360),this.sendActionsForControlEvents(exports.cc.CONTROL_EVENT_VALUECHANGED)},getValue:function(){return this._value},setMinimumValue:function(t){this._minimumValue=t,this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1),this.setValue(this._maximumValue)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(t){this._maximumValue=t,this._maximumValue<=this._minimumValue&&(this._minimumValue=this._maximumValue-1),this.setValue(this._minimumValue)},getMaximumValue:function(){return this._maximumValue},isTouchInside:function(t){var e=this.getTouchLocation(t),r=this.distanceBetweenPointAndPoint(this._progressTimer.getPosition(),e);return r<Math.min(this.getContentSize().width/2,this.getContentSize().height/2)},onTouchBegan:function(t,e){return!this.isTouchInside(t)||!this.isEnabled()||!this.isVisible()?!1:(this._previousLocation=this.getTouchLocation(t),this.potentiometerBegan(this._previousLocation),!0)},onTouchMoved:function(t,e){var r=this.getTouchLocation(t);this.potentiometerMoved(r)},onTouchEnded:function(t,e){this.potentiometerEnded(exports.cc.p(0,0))},distanceBetweenPointAndPoint:function(t,e){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)},angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint:function(t,e,r,n){var s=e.x-t.x,o=e.y-t.y,a=n.x-r.x,c=n.y-r.y,l=Math.atan2(s,o),h=Math.atan2(a,c);return(l-h)*180/Math.PI},potentiometerBegan:function(t){this.setSelected(!0),this.getThumbSprite().setColor(exports.cc.color.GRAY)},potentiometerMoved:function(t){var e=this.angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint(this._progressTimer.getPosition(),t,this._progressTimer.getPosition(),this._previousLocation);e>180?e-=360:e<-180&&(e+=360),this.setValue(this._value+e/360*(this._maximumValue-this._minimumValue)),this._previousLocation=t},potentiometerEnded:function(t){this.getThumbSprite().setColor(exports.cc.color.WHITE),this.setSelected(!1)},setThumbSprite:function(t){this._thumbSprite=t},getThumbSprite:function(){return this._thumbSprite},setProgressTimer:function(t){this._progressTimer=t},getProgressTimer:function(){return this._progressTimer},setPreviousLocation:function(t){this._previousLocation=t},getPreviousLocation:function(){return this._previousLocation}});var _p=exports.cc.ControlPotentiometer.prototype;_p.value;exports.cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);_p.minValue;exports.cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);_p.maxValue;exports.cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);_p.progressTimer;exports.cc.defineGetterSetter(_p,"progressTimer",_p.getProgressTimer,_p.setProgressTimer);_p.thumbSprite;exports.cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);_p.prevLocation;exports.cc.defineGetterSetter(_p,"prevLocation",_p.getPreviousLocation,_p.setPreviousLocation);_p=null;exports.cc.ControlPotentiometer.create=function(t,e,r){return new exports.cc.ControlPotentiometer(t,e,r)};exports.cc.SCROLLVIEW_DIRECTION_NONE=-1;exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0;exports.cc.SCROLLVIEW_DIRECTION_VERTICAL=1;exports.cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=.95,SCROLL_DEACCEL_DIST=1,BOUNCE_DURATION=.15,INSET_RATIO=.2,MOVE_INCH=7/160,BOUNCE_BACK_FACTOR=.35;exports.cc.convertDistanceFromPointToInch=function(t){var e=exports.cc.view,r=(e.getScaleX()+e.getScaleY())/2;return t*r/160};exports.cc.ScrollViewDelegate=exports.cc.Class.extend({scrollViewDidScroll:function(t){},scrollViewDidZoom:function(t){}});exports.cc.ScrollView=exports.cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:exports.cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:!1,_contentOffset:null,_container:null,_touchMoved:!1,_maxInset:null,_minInset:null,_bounceable:!1,_clippingToBounds:!1,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:!1,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(t,e){exports.cc.Layer.prototype.ctor.call(this),this._contentOffset=exports.cc.p(0,0),this._maxInset=exports.cc.p(0,0),this._minInset=exports.cc.p(0,0),this._scrollDistance=exports.cc.p(0,0),this._touchPoint=exports.cc.p(0,0),this._touches=[],this._viewSize=exports.cc.size(0,0),this._parentScissorRect=new exports.cc.Rect(0,0,0,0),this._tmpViewRect=new exports.cc.Rect(0,0,0,0),e!=null?this.initWithViewSize(t,e):this.initWithViewSize(exports.cc.size(200,200),null)},init:function(){return this.initWithViewSize(exports.cc.size(200,200),null)},initWithViewSize:function(t,e){var r=exports.cc.p(0,0);return exports.cc.Layer.prototype.init.call(this)?(!e&&!this._container&&(e=new exports.cc.Layer),e&&this.setContainer(e),this.setViewSize(t),this.setTouchEnabled(!0),this._touches.length=0,this._delegate=null,this._bounceable=!0,this._clippingToBounds=!0,this._direction=exports.cc.SCROLLVIEW_DIRECTION_BOTH,this._container.setPosition(r),this._touchLength=0,this._minScale=this._maxScale=1,!0):!1},setContentOffset:function(t,e){if(e){this.setContentOffsetInDuration(t,BOUNCE_DURATION);return}if(!this._bounceable){var r=this.minContainerOffset(),n=this.maxContainerOffset();t.x=Math.max(r.x,Math.min(n.x,t.x)),t.y=Math.max(r.y,Math.min(n.y,t.y))}this._container.setPosition(t);var s=this._delegate;s!=null&&s.scrollViewDidScroll&&s.scrollViewDidScroll(this)},getContentOffset:function(){var t=this._container.getPosition();return exports.cc.p(t.x,t.y)},setContentOffsetInDuration:function(t,e){var r=exports.cc.moveTo(e,t),n=exports.cc.callFunc(this._stoppedAnimatedScroll,this);this._container.runAction(exports.cc.sequence(r,n)),this.schedule(this._performedAnimatedScroll)},setZoomScale:function(t,e){if(e){this.setZoomScaleInDuration(t,BOUNCE_DURATION);return}var r=this._container;if(r.getScale()!==t){var n,s,o;if(this._touchLength===0){var a=this._viewSize;o=exports.cc.p(a.width*.5,a.height*.5),o=this.convertToWorldSpace(o)}else o=this._touchPoint;n=r.convertToNodeSpace(o),r.setScale(Math.max(this._minScale,Math.min(this._maxScale,t))),s=r.convertToWorldSpace(n);var c=exports.cc.pSub(o,s);this._delegate&&this._delegate.scrollViewDidZoom&&this._delegate.scrollViewDidZoom(this),this.setContentOffset(exports.cc.pAdd(r.getPosition(),c))}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(t,e){if(e>0){var r=this._container.getScale();if(r!==t){var n=exports.cc.actionTween(e,"zoomScale",r,t);this.runAction(n)}}else this.setZoomScale(t)},minContainerOffset:function(){var t=this._container,e=t.getContentSize(),r=this._viewSize;return exports.cc.p(r.width-e.width*t.getScaleX(),r.height-e.height*t.getScaleY())},maxContainerOffset:function(){return exports.cc.p(0,0)},isNodeVisible:function(t){var e=this.getContentOffset(),r=this.getViewSize(),n=this.getZoomScale(),s=exports.cc.rect(-e.x/n,-e.y/n,r.width/n,r.height/n);return exports.cc.rectIntersectsRect(s,t.getBoundingBox())},pause:function(t){this._container.pause();for(var e=this._container.getChildren(),r=0;r<e.length;r++)e[r].pause();this._super()},resume:function(t){for(var e=this._container.getChildren(),r=0,n=e.length;r<n;r++)e[r].resume();this._container.resume(),this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(t){this._bounceable=t},getViewSize:function(){return this._viewSize},setViewSize:function(t){this._viewSize=t,exports.cc.Node.prototype.setContentSize.call(this,t)},getContainer:function(){return this._container},setContainer:function(t){t&&(this.removeAllChildren(!0),this._container=t,t.ignoreAnchorPointForPosition(!1),t.setAnchorPoint(0,0),this.addChild(t),this.setViewSize(this._viewSize))},getDirection:function(){return this._direction},setDirection:function(t){this._direction=t},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},onTouchBegan:function(t,e){for(var r=this||window;r!=null;r=r.parent)if(!r.isVisible())return!1;var n=this._getViewRect(),s=this._container,o=s.convertToWorldSpace(s.convertTouchToNodeSpace(t)),a=this._touches;return a.length>2||this._touchMoved||!exports.cc.rectContainsPoint(n,o)?!1:(a.push(t),a.length===1?(this._touchPoint=this.convertTouchToNodeSpace(t),this._touchMoved=!1,this._dragging=!0,this._scrollDistance.x=0,this._scrollDistance.y=0,this._touchLength=0):a.length===2&&(this._touchPoint=exports.cc.pMidpoint(this.convertTouchToNodeSpace(a[0]),this.convertTouchToNodeSpace(a[1])),this._touchLength=exports.cc.pDistance(s.convertTouchToNodeSpace(a[0]),s.convertTouchToNodeSpace(a[1])),this._dragging=!1),!0)},onTouchMoved:function(t,e){if(this.isVisible()){if(this.setNodeDirty(),this._touches.length===1&&this._dragging){this._touchMoved=!0,this._getViewRect();var r=this.convertTouchToNodeSpace(t),n=exports.cc.pSub(r,this._touchPoint),s=0,o=this._direction,a;if(o===exports.cc.SCROLLVIEW_DIRECTION_VERTICAL)s=n.y,a=this._container.getPositionY(),this.minContainerOffset().y<=a&&a<=this.maxContainerOffset().y||(n.y*=BOUNCE_BACK_FACTOR);else if(o===exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL)s=n.x,a=this._container.getPositionX(),this.minContainerOffset().x<=a&&a<=this.maxContainerOffset().x||(n.x*=BOUNCE_BACK_FACTOR);else{s=Math.sqrt(n.x*n.x+n.y*n.y),a=this._container.getPositionY();var c=this.minContainerOffset(),l=this.maxContainerOffset();c.y<=a&&a<=l.y||(n.y*=BOUNCE_BACK_FACTOR),a=this._container.getPositionX(),c.x<=a&&a<=l.x||(n.x*=BOUNCE_BACK_FACTOR)}if(!this._touchMoved&&Math.abs(exports.cc.convertDistanceFromPointToInch(s))<MOVE_INCH)return;if(this._touchMoved||(n.x=0,n.y=0),this._touchPoint=r,this._touchMoved=!0,this._dragging){switch(o){case exports.cc.SCROLLVIEW_DIRECTION_VERTICAL:n.x=0;break;case exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n.y=0;break}var h=this._container.getPosition(),u=h.x+n.x,_=h.y+n.y;this._scrollDistance=n,this.setContentOffset(exports.cc.p(u,_))}}else if(this._touches.length===2&&!this._dragging){var d=exports.cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1]));this.setZoomScale(this.getZoomScale()*d/this._touchLength)}}},onTouchEnded:function(t,e){this.isVisible()&&(this._touches.length===1&&this._touchMoved&&this.schedule(this._deaccelerateScrolling),this._touches.length=0,this._dragging=!1,this._touchMoved=!1)},onTouchCancelled:function(t,e){this.isVisible()&&(this._touches.length=0,this._dragging=!1,this._touchMoved=!1)},setContentSize:function(t,e){this.getContainer()!==null&&(e===void 0?this.getContainer().setContentSize(t):this.getContainer().setContentSize(t,e),this.updateInset())},_setWidth:function(t){var e=this.getContainer();e!==null&&(e._setWidth(t),this.updateInset())},_setHeight:function(t){var e=this.getContainer();e!==null&&(e._setHeight(t),this.updateInset())},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(this.getContainer()!==null){var t=this._viewSize,e=this.maxContainerOffset();this._maxInset.x=e.x+t.width*INSET_RATIO,this._maxInset.y=e.y+t.height*INSET_RATIO,e=this.minContainerOffset(),this._minInset.x=e.x-t.width*INSET_RATIO,this._minInset.y=e.y-t.height*INSET_RATIO}},isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(t){this._clippingToBounds=t},addChild:function(t,e,r){if(!t)throw new Error("child must not nil!");e=e||t.getLocalZOrder(),r=r||t.getTag(),this._container!==t?this._container.addChild(t,e,r):exports.cc.Layer.prototype.addChild.call(this,t,e,r)},isTouchEnabled:function(){return this._touchListener!==null},setTouchEnabled:function(t){if(this._touchListener&&exports.cc.eventManager.removeListener(this._touchListener),this._touchListener=null,!t)this._dragging=!1,this._touchMoved=!1,this._touches.length=0;else{var e=exports.cc.EventListener.create({event:exports.cc.EventListener.TOUCH_ONE_BY_ONE});this.onTouchBegan&&(e.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(e.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(e.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(e.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=e,exports.cc.eventManager.addListener(e,this)}},_initWithViewSize:function(t){return null},_relocateContainer:function(t){var e=this.minContainerOffset(),r=this.maxContainerOffset(),n=this._direction,s=this._container.getPosition(),o=s.x,a=s.y;(n===exports.cc.SCROLLVIEW_DIRECTION_BOTH||n===exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL)&&(o=Math.max(o,e.x),o=Math.min(o,r.x)),(n===exports.cc.SCROLLVIEW_DIRECTION_BOTH||n===exports.cc.SCROLLVIEW_DIRECTION_VERTICAL)&&(a=Math.min(a,r.y),a=Math.max(a,e.y)),(a!==s.y||o!==s.x)&&this.setContentOffset(exports.cc.p(o,a),t)},_deaccelerateScrolling:function(t){if(this._dragging){this.unschedule(this._deaccelerateScrolling);return}var e,r,n=this._container.getPosition(),s=this._scrollDistance;this._container.setPosition(n.x+s.x,n.y+s.y),this._bounceable?(e=this._maxInset,r=this._minInset):(e=this.maxContainerOffset(),r=this.minContainerOffset());var o=this._container.getPositionX(),a=this._container.getPositionY();s.x=s.x*SCROLL_DEACCEL_RATE,s.y=s.y*SCROLL_DEACCEL_RATE,this.setContentOffset(exports.cc.p(o,a)),(Math.abs(s.x)<=SCROLL_DEACCEL_DIST&&Math.abs(s.y)<=SCROLL_DEACCEL_DIST||a>e.y||a<r.y||o>e.x||o<r.x||o===e.x||o===r.x||a===e.y||a===r.y)&&(this.unschedule(this._deaccelerateScrolling),this._relocateContainer(!0))},_performedAnimatedScroll:function(t){if(this._dragging){this.unschedule(this._performedAnimatedScroll);return}this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_stoppedAnimatedScroll:function(t){this.unschedule(this._performedAnimatedScroll),this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_handleZoom:function(){},_getViewRect:function(){for(var t=this.convertToWorldSpace(exports.cc.p(0,0)),e=this._viewSize,r=this.getScaleX(),n=this.getScaleY(),s=this._parent;s!=null;s=s.getParent())r*=s.getScaleX(),n*=s.getScaleY();r<0&&(t.x+=e.width*r,r=-r),n<0&&(t.y+=e.height*n,n=-n);var o=this._tmpViewRect;return o.x=t.x,o.y=t.y,o.width=e.width*r,o.height=e.height*n,o},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ScrollView.CanvasRenderCmd(this):new exports.cc.ScrollView.WebGLRenderCmd(this)}});var _p=exports.cc.ScrollView.prototype;_p.minOffset;exports.cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset);_p.maxOffset;exports.cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset);_p.bounceable;exports.cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable);_p.viewSize;exports.cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize);_p.container;exports.cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer);_p.direction;exports.cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);_p.delegate;exports.cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);_p.clippingToBounds;exports.cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds);_p=null;exports.cc.ScrollView.create=function(t,e){return new exports.cc.ScrollView(t,e)};(function(){exports.cc.ScrollView.CanvasRenderCmd=function(e){exports.cc.Layer.CanvasRenderCmd.call(this,e),this._needDraw=!1,this.startCmd=new exports.cc.CustomRenderCmd(this,this._startCmd),this.startCmd._canUseDirtyRegion=!0,this.endCmd=new exports.cc.CustomRenderCmd(this,this._endCmd),this.endCmd._canUseDirtyRegion=!0};var t=exports.cc.ScrollView.CanvasRenderCmd.prototype=Object.create(exports.cc.Layer.CanvasRenderCmd.prototype);t.constructor=exports.cc.ScrollView.CanvasRenderCmd,t._startCmd=function(e,r,n){var s=this._node,o=e||exports.cc._renderContext,a=o.getContext();if(o.save(),s._clippingToBounds){this._scissorRestored=!1,o.setTransform(this._worldTransform,r,n);var c=s.getScaleX(),l=s.getScaleY(),h=s._viewSize.width*c,u=s._viewSize.height*l;a.beginPath(),a.rect(0,0,h,-u),a.closePath(),a.clip()}},t._endCmd=function(e){e=e||exports.cc._renderContext,e.restore()},t.visit=function(e){var r=this._node;if(r._visible){var n,s=r._children,o;if(this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this.startCmd),s&&s.length>0)for(o=s.length,r.sortAllChildren(),n=0;n<o;n++)s[n]._renderCmd.visit(this);exports.cc.renderer.pushRenderCommand(this.endCmd),this._dirtyFlag=0}}})();exports.cc.SortableObject=exports.cc.Class.extend({setObjectID:function(t){},getObjectID:function(){return 0}});exports.cc.SortedObject=exports.cc.SortableObject.extend({_objectID:0,ctor:function(){this._objectID=0},setObjectID:function(t){this._objectID=t},getObjectID:function(){return this._objectID}});var _compareObject=function(t,e){return t.getObjectID()-e.getObjectID()};exports.cc.ArrayForObjectSorting=exports.cc.Class.extend({_saveObjectArr:null,ctor:function(){this._saveObjectArr=[]},insertSortedObject:function(t){if(!t)throw new Error("cc.ArrayForObjectSorting.insertSortedObject(): addObject should be non-null.");var e=this.indexOfSortedObject(t);this.insertObject(t,e)},removeSortedObject:function(t){if(this.count()!==0){var e=this.indexOfSortedObject(t);if(e<this.count()&&e!==exports.cc.INVALID_INDEX){var r=this.objectAtIndex(e);r.getObjectID()===t.getObjectID()&&this.removeObjectAtIndex(e)}}},setObjectID_ofSortedObject:function(t,e){var r=this.indexOfSortedObject(e);if(r<this.count()&&r!==exports.cc.INVALID_INDEX){var n=this.objectAtIndex(r);n.getObjectID()===e.getObjectID()&&(this.removeObjectAtIndex(r),n.setObjectID(t),this.insertSortedObject(n))}},objectWithObjectID:function(t){if(this.count()===0)return null;var e=new exports.cc.SortedObject;e.setObjectID(t);var r=this.indexOfSortedObject(e);return r<this.count()&&r!==exports.cc.INVALID_INDEX&&(e=this.objectAtIndex(r),e.getObjectID()!==t&&(e=null)),e},getObjectWithObjectID:function(t){return null},indexOfSortedObject:function(t){var e=0;if(t)for(var r=0,n=t.getObjectID(),s=this._saveObjectArr,o=0;o<s.length;o++){var a=s[o],c=a.getObjectID();if(n===c||n>=r&&n<c)break;r=c,e++}else e=exports.cc.INVALID_INDEX;return e},count:function(){return this._saveObjectArr.length},lastObject:function(){var t=this._saveObjectArr;return t.length===0?null:t[t.length-1]},objectAtIndex:function(t){return this._saveObjectArr[t]},addObject:function(t){this._saveObjectArr.push(t),this._saveObjectArr.sort(_compareObject)},removeObjectAtIndex:function(t){this._saveObjectArr.splice(t,1),this._saveObjectArr.sort(_compareObject)},insertObject:function(t,e){this._saveObjectArr.splice(e,0,t),this._saveObjectArr.sort(_compareObject)}});exports.cc.TABLEVIEW_FILL_TOPDOWN=0;exports.cc.TABLEVIEW_FILL_BOTTOMUP=1;exports.cc.TableViewCell=exports.cc.Node.extend({_idx:0,_className:"TableViewCell",getIdx:function(){return this._idx},setIdx:function(t){this._idx=t},reset:function(){this._idx=exports.cc.INVALID_INDEX},setObjectID:function(t){this._idx=t},getObjectID:function(){return this._idx}});var _p=exports.cc.TableViewCell.prototype;_p.objectId;exports.cc.defineGetterSetter(_p,"objectId",_p.getObjectID,_p.setObjectID);_p=null;exports.cc.TableViewDelegate=exports.cc.ScrollViewDelegate.extend({tableCellTouched:function(t,e){},tableCellHighlight:function(t,e){},tableCellUnhighlight:function(t,e){},tableCellWillRecycle:function(t,e){}});exports.cc.TableViewDataSource=exports.cc.Class.extend({tableCellSizeForIndex:function(t,e){return this.cellSizeForTable(t)},cellSizeForTable:function(t){return exports.cc.size(0,0)},tableCellAtIndex:function(t,e){return null},numberOfCellsInTableView:function(t){return 0}});exports.cc.TableView=exports.cc.ScrollView.extend({_vOrdering:null,_indices:null,_cellsFreed:null,_dataSource:null,_tableViewDelegate:null,_oldDirection:null,_cellsPositions:null,_touchedCell:null,ctor:function(t,e,r){exports.cc.ScrollView.prototype.ctor.call(this),this._oldDirection=exports.cc.SCROLLVIEW_DIRECTION_NONE,this._cellsPositions=[],this.initWithViewSize(e,r),this.setDataSource(t),this._updateCellPositions(),this._updateContentSize()},__indexFromOffset:function(t){var e=0,r=this._dataSource.numberOfCellsInTableView(this)-1,n;switch(this.getDirection()){case exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL:n=t.x;break;default:n=t.y;break}for(var s=this._cellsPositions;r>=e;){var o=0|e+(r-e)/2,a=s[o],c=s[o+1];if(n>=a&&n<=c)return o;n<a?r=o-1:e=o+1}return e<=0?0:-1},_indexFromOffset:function(t){var e={x:t.x,y:t.y},r=this._dataSource,n=r.numberOfCellsInTableView(this)-1;this._vOrdering===exports.cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y);var s=this.__indexFromOffset(e);return s!==-1&&(s=Math.max(0,s),s>n&&(s=exports.cc.INVALID_INDEX)),s},__offsetFromIndex:function(t){var e;switch(this.getDirection()){case exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL:e=exports.cc.p(this._cellsPositions[t],0);break;default:e=exports.cc.p(0,this._cellsPositions[t]);break}return e},_offsetFromIndex:function(t){var e=this.__offsetFromIndex(t),r=this._dataSource.tableCellSizeForIndex(this,t);return this._vOrdering===exports.cc.TABLEVIEW_FILL_TOPDOWN&&(e.y=this.getContainer().getContentSize().height-e.y-r.height),e},_updateCellPositions:function(){var t=this._dataSource.numberOfCellsInTableView(this),e=this._cellsPositions;if(t>0){for(var r=0,n,s=this._dataSource,o=0;o<t;o++)switch(e[o]=r,n=s.tableCellSizeForIndex(this,o),this.getDirection()){case exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL:r+=n.width;break;default:r+=n.height;break}this._cellsPositions[t]=r}},_updateContentSize:function(){var t=exports.cc.size(0,0),e=this._dataSource.numberOfCellsInTableView(this);if(e>0){var r=this._cellsPositions[e];switch(this.getDirection()){case exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL:t=exports.cc.size(r,this._viewSize.height);break;default:t=exports.cc.size(this._viewSize.width,r);break}}this.setContentSize(t),this._oldDirection!==this._direction&&(this._direction===exports.cc.SCROLLVIEW_DIRECTION_HORIZONTAL?this.setContentOffset(exports.cc.p(0,0)):this.setContentOffset(exports.cc.p(0,this.minContainerOffset().y)),this._oldDirection=this._direction)},_moveCellOutOfSight:function(t){this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,t),this._cellsFreed.addObject(t),this._cellsUsed.removeSortedObject(t),exports.cc.arrayRemoveObject(this._indices,t.getIdx()),t.reset(),t.getParent()===this.getContainer()&&this.getContainer().removeChild(t,!0)},_setIndexForCell:function(t,e){e.setAnchorPoint(0,0),e.setPosition(this._offsetFromIndex(t)),e.setIdx(t)},_addCellIfNecessary:function(t){t.getParent()!==this.getContainer()&&this.getContainer().addChild(t),this._cellsUsed.insertSortedObject(t);var e=this._indices,r=t.getIdx();e.indexOf(r)===-1&&(e.push(r),e.sort(function(n,s){return n-s}))},getDataSource:function(){return this._dataSource},setDataSource:function(t){this._dataSource=t},getDelegate:function(){return this._tableViewDelegate},setDelegate:function(t){this._tableViewDelegate=t},setVerticalFillOrder:function(t){this._vOrdering!==t&&(this._vOrdering=t,this._cellsUsed.count()>0&&this.reloadData())},getVerticalFillOrder:function(){return this._vOrdering},initWithViewSize:function(t,e){return exports.cc.ScrollView.prototype.initWithViewSize.call(this,t,e)?(this._cellsUsed=new exports.cc.ArrayForObjectSorting,this._cellsFreed=new exports.cc.ArrayForObjectSorting,this._indices=[],this._tableViewDelegate=null,this._vOrdering=exports.cc.TABLEVIEW_FILL_BOTTOMUP,this.setDirection(exports.cc.SCROLLVIEW_DIRECTION_VERTICAL),exports.cc.ScrollView.prototype.setDelegate.call(this,this),!0):!1},updateCellAtIndex:function(t){if(!(t===exports.cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);e&&this._moveCellOutOfSight(e),e=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,e),this._addCellIfNecessary(e)}},insertCellAtIndex:function(t){if(!(t===exports.cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e,r=this._cellsUsed,n=r.objectWithObjectID(t);if(n){e=r.indexOfSortedObject(n);for(var s=e;s<r.count();s++)n=r.objectAtIndex(s),this._setIndexForCell(n.getIdx()+1,n)}n=this._dataSource.tableCellAtIndex(this,t),this._setIndexForCell(t,n),this._addCellIfNecessary(n),this._updateCellPositions(),this._updateContentSize()}},removeCellAtIndex:function(t){if(!(t===exports.cc.INVALID_INDEX||t>this._dataSource.numberOfCellsInTableView(this)-1)){var e=this.cellAtIndex(t);if(e){var r=this._cellsUsed,n=r.indexOfSortedObject(e);this._moveCellOutOfSight(e),exports.cc.arrayRemoveObject(this._indices,t),this._updateCellPositions();for(var s=r.count()-1;s>n;s--)e=r.objectAtIndex(s),this._setIndexForCell(e.getIdx()-1,e)}}},reloadData:function(){this._oldDirection=exports.cc.SCROLLVIEW_DIRECTION_NONE;for(var t=this._cellsUsed,e=this._cellsFreed,r=this.getContainer(),n=0,s=t.count();n<s;n++){var o=t.objectAtIndex(n);this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,o),e.addObject(o),o.reset(),o.getParent()===r&&r.removeChild(o,!0)}this._indices=[],this._cellsUsed=new exports.cc.ArrayForObjectSorting,this._updateCellPositions(),this._updateContentSize(),this._dataSource.numberOfCellsInTableView(this)>0&&this.scrollViewDidScroll(this),this.setNodeDirty()},dequeueCell:function(){if(this._cellsFreed.count()===0)return null;var t=this._cellsFreed.objectAtIndex(0);return this._cellsFreed.removeObjectAtIndex(0),t},cellAtIndex:function(t){var e=this._indices.indexOf(t);return e===-1?null:this._cellsUsed.objectWithObjectID(t)},scrollViewDidScroll:function(t){var e=this._dataSource,r=e.numberOfCellsInTableView(this);if(r!==0){this._tableViewDelegate!==null&&this._tableViewDelegate.scrollViewDidScroll&&this._tableViewDelegate.scrollViewDidScroll(this);var n=0,s=this._viewSize,o=this.getContainer(),a=this.getContentOffset();a.x*=-1,a.y*=-1;var c=Math.max(r-1,0);this._vOrdering===exports.cc.TABLEVIEW_FILL_TOPDOWN&&(a.y=a.y+s.height/o.getScaleY());var l=this._indexFromOffset(a);l===exports.cc.INVALID_INDEX&&(l=r-1),this._vOrdering===exports.cc.TABLEVIEW_FILL_TOPDOWN?a.y-=s.height/o.getScaleY():a.y+=s.height/o.getScaleY(),a.x+=s.width/o.getScaleX();var h=this._indexFromOffset(a);h===exports.cc.INVALID_INDEX&&(h=r-1);var u,_=this._cellsUsed;if(_.count()>0)for(u=_.objectAtIndex(0),n=u.getIdx();n<l&&(this._moveCellOutOfSight(u),_.count()>0);)u=_.objectAtIndex(0),n=u.getIdx();if(_.count()>0)for(u=_.lastObject(),n=u.getIdx();n<=c&&n>h&&(this._moveCellOutOfSight(u),_.count()>0);)u=_.lastObject(),n=u.getIdx();for(var d=this._indices,f=l;f<=h;f++)d.indexOf(f)===-1&&this.updateCellAtIndex(f)}},scrollViewDidZoom:function(t){},onTouchEnded:function(t,e){if(this.isVisible()){if(this._touchedCell){var r=this.getBoundingBox(),n=exports.cc.p(r.x,r.y);n=this._parent.convertToWorldSpace(n),r.x=n.x,r.y=n.y;var s=this._tableViewDelegate;exports.cc.rectContainsPoint(r,t.getLocation())&&s!==null&&(s.tableCellUnhighlight&&s.tableCellUnhighlight(this,this._touchedCell),s.tableCellTouched&&s.tableCellTouched(this,this._touchedCell)),this._touchedCell=null}exports.cc.ScrollView.prototype.onTouchEnded.call(this,t,e)}},onTouchBegan:function(t,e){for(var r=this||window;r!=null;r=r.parent)if(!r.isVisible())return!1;var n=exports.cc.ScrollView.prototype.onTouchBegan.call(this,t,e);if(this._touches.length===1){var s,o;o=this.getContainer().convertTouchToNodeSpace(t),s=this._indexFromOffset(o),s===exports.cc.INVALID_INDEX?this._touchedCell=null:this._touchedCell=this.cellAtIndex(s),this._touchedCell&&this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellHighlight&&this._tableViewDelegate.tableCellHighlight(this,this._touchedCell)}else this._touchedCell&&(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null);return n},onTouchMoved:function(t,e){exports.cc.ScrollView.prototype.onTouchMoved.call(this,t,e),this._touchedCell&&this.isTouchMoved()&&(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)},onTouchCancelled:function(t,e){exports.cc.ScrollView.prototype.onTouchCancelled.call(this,t,e),this._touchedCell&&(this._tableViewDelegate!==null&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)}});var _p=exports.cc.TableView.prototype;_p.dataSource;exports.cc.defineGetterSetter(_p,"dataSource",_p.getDataSource,_p.setDataSource);_p.delegate;exports.cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);_p.verticalFillOrder;exports.cc.defineGetterSetter(_p,"verticalFillOrder",_p.getVerticalFillOrder,_p.setVerticalFillOrder);_p=null;exports.cc.TableView.create=function(t,e,r){return new exports.cc.TableView(t,e,r)};(function(){exports.cc.ScrollView.WebGLRenderCmd=function(e){exports.cc.Layer.WebGLRenderCmd.call(this,e),this._needDraw=!1,this.startCmd=new exports.cc.CustomRenderCmd(this,this._startCmd),this.endCmd=new exports.cc.CustomRenderCmd(this,this._endCmd)};var t=exports.cc.ScrollView.WebGLRenderCmd.prototype=Object.create(exports.cc.Layer.WebGLRenderCmd.prototype);t.constructor=exports.cc.ScrollView.WebGLRenderCmd,t._startCmd=function(){var e=this._node,r=exports.cc.view,n=e._getViewRect();if(r.isScissorEnabled()){if(e._scissorRestored=!0,e._parentScissorRect=r.getScissorRect(),exports.cc.rectIntersection(n,e._parentScissorRect)){var s=e._parentScissorRect,o=Math.max(n.x,s.x),a=Math.max(n.y,s.y),c=Math.min(n.x+n.width,s.x+s.width),l=Math.min(n.y+n.height,s.y+s.height);r.setScissorInPoints(o,a,c-o,l-a)}}else{var h=exports.cc._renderContext;h.enable(h.SCISSOR_TEST),r.setScissorInPoints(n.x,n.y,n.width,n.height)}},t._endCmd=function(){var e=this._node;if(e._scissorRestored){var r=e._parentScissorRect;exports.cc.view.setScissorInPoints(r.x,r.y,r.width,r.height)}else{var n=exports.cc._renderContext;n.disable(n.SCISSOR_TEST)}},t.visit=function(e){var r=this._node;if(r._visible){var n,s=r._children,o,a;if(this._syncStatus(e),r._clippingToBounds&&exports.cc.renderer.pushRenderCommand(this.startCmd),s&&s.length>0){for(a=s.length,n=0;n<a&&(o=s[n],o&&o._localZOrder<0);n++)o._renderCmd.visit();for(;n<a;n++)s[n]._renderCmd.visit()}r._clippingToBounds&&exports.cc.renderer.pushRenderCommand(this.endCmd),this._dirtyFlag=0}}})();var PROPERTY_POSITION="position",PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SKEW="skew",PROPERTY_ANCHORPOINT="anchorPoint",PROPERTY_SCALE="scale",PROPERTY_ROTATION="rotation",PROPERTY_TAG="tag",PROPERTY_IGNOREANCHORPOINTFORPOSITION="ignoreAnchorPointForPosition",PROPERTY_VISIBLE="visible",ASSERT_FAIL_UNEXPECTED_PROPERTY=function(t){exports.cc.log("Unexpected property: '"+t+"'!")},ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE=function(t){exports.cc.log("Unexpected property type: '"+t+"'!")};function BlockData(t,e){this.selMenuHander=t,this.target=e}function BlockCCControlData(t,e,r){this.selCCControlHandler=t,this.target=e,this.controlEvents=r}exports.cc.NodeLoader=exports.cc.Class.extend({_customProperties:null,ctor:function(){this._customProperties=new exports.cc._Dictionary},loadCCNode:function(t,e){return this._createCCNode(t,e)},parseProperties:function(t,e,r){for(var n=r.readInt(!1),s=r.readInt(!1),o=n+s,a=0;a<o;a++){var c=a>=n,l=r.readInt(!1),h=r.readCachedString(),u=!1,_=r.readByte();if((_===CCB_PLATFORM_ALL||_===CCB_PLATFORM_IOS||_===CCB_PLATFORM_MAC)&&(u=!0),t instanceof exports.cc.BuilderFile){if(t.getCCBFileNode()&&c){t=t.getCCBFileNode();var d=t.userObject;u=d.indexOf(h)!==-1}}else if(c&&t===r.getAnimationManager().getRootNode()){var f=t.userObject;f||(f=[],t.userObject=f),f.push(h)}switch(l){case CCB_PROPTYPE_POSITION:{var T=this.parsePropTypePosition(t,e,r,h);u&&this.onHandlePropTypePosition(t,e,h,T,r);break}case CCB_PROPTYPE_POINT:{var x=this.parsePropTypePoint(t,e,r);u&&this.onHandlePropTypePoint(t,e,h,x,r);break}case CCB_PROPTYPE_POINTLOCK:{var m=this.parsePropTypePointLock(t,e,r);u&&this.onHandlePropTypePointLock(t,e,h,m,r);break}case CCB_PROPTYPE_SIZE:{var v=this.parsePropTypeSize(t,e,r);u&&this.onHandlePropTypeSize(t,e,h,v,r);break}case CCB_PROPTYPE_SCALELOCK:{var A=this.parsePropTypeScaleLock(t,e,r,h);u&&this.onHandlePropTypeScaleLock(t,e,h,A,r);break}case CCB_PROPTYPE_FLOATXY:{var D=this.parsePropTypeFloatXY(t,e,r);u&&this.onHandlePropTypeFloatXY(t,e,h,D,r);break}case CCB_PROPTYPE_FLOAT:{var N=this.parsePropTypeFloat(t,e,r);u&&this.onHandlePropTypeFloat(t,e,h,N,r);break}case CCB_PROPTYPE_DEGREES:{var z=this.parsePropTypeDegrees(t,e,r,h);u&&this.onHandlePropTypeDegrees(t,e,h,z,r);break}case CCB_PROPTYPE_FLOATSCALE:{var M=this.parsePropTypeFloatScale(t,e,r);u&&this.onHandlePropTypeFloatScale(t,e,h,M,r);break}case CCB_PROPTYPE_INTEGER:{var J=this.parsePropTypeInteger(t,e,r);u&&this.onHandlePropTypeInteger(t,e,h,J,r);break}case CCB_PROPTYPE_INTEGERLABELED:{var U=this.parsePropTypeIntegerLabeled(t,e,r);u&&this.onHandlePropTypeIntegerLabeled(t,e,h,U,r);break}case CCB_PROPTYPE_FLOATVAR:{var K=this.parsePropTypeFloatVar(t,e,r);u&&this.onHandlePropTypeFloatVar(t,e,h,K,r);break}case CCB_PROPTYPE_CHECK:{var tt=this.parsePropTypeCheck(t,e,r,h);u&&this.onHandlePropTypeCheck(t,e,h,tt,r);break}case CCB_PROPTYPE_SPRITEFRAME:{var rt=this.parsePropTypeSpriteFrame(t,e,r,h);u&&this.onHandlePropTypeSpriteFrame(t,e,h,rt,r);break}case CCB_PROPTYPE_ANIMATION:{var I=this.parsePropTypeAnimation(t,e,r);u&&this.onHandlePropTypeAnimation(t,e,h,I,r);break}case CCB_PROPTYPE_TEXTURE:{var L=this.parsePropTypeTexture(t,e,r);u&&this.onHandlePropTypeTexture(t,e,h,L,r);break}case CCB_PROPTYPE_BYTE:{var G=this.parsePropTypeByte(t,e,r,h);u&&this.onHandlePropTypeByte(t,e,h,G,r);break}case CCB_PROPTYPE_COLOR3:{var w=this.parsePropTypeColor3(t,e,r,h);u&&this.onHandlePropTypeColor3(t,e,h,w,r);break}case CCB_PROPTYPE_COLOR4VAR:{var O=this.parsePropTypeColor4FVar(t,e,r);u&&this.onHandlePropTypeColor4FVar(t,e,h,O,r);break}case CCB_PROPTYPE_FLIP:{var j=this.parsePropTypeFlip(t,e,r);u&&this.onHandlePropTypeFlip(t,e,h,j,r);break}case CCB_PROPTYPE_BLENDMODE:{var Q=this.parsePropTypeBlendFunc(t,e,r);u&&this.onHandlePropTypeBlendFunc(t,e,h,Q,r);break}case CCB_PROPTYPE_FNTFILE:{var C=r.getCCBRootPath()+this.parsePropTypeFntFile(t,e,r);u&&this.onHandlePropTypeFntFile(t,e,h,C,r);break}case CCB_PROPTYPE_FONTTTF:{var b=this.parsePropTypeFontTTF(t,e,r);u&&this.onHandlePropTypeFontTTF(t,e,h,b,r);break}case CCB_PROPTYPE_STRING:{var W=this.parsePropTypeString(t,e,r);u&&this.onHandlePropTypeString(t,e,h,W,r);break}case CCB_PROPTYPE_TEXT:{var S=this.parsePropTypeText(t,e,r);u&&this.onHandlePropTypeText(t,e,h,S,r);break}case CCB_PROPTYPE_BLOCK:{var E=this.parsePropTypeBlock(t,e,r);u&&this.onHandlePropTypeBlock(t,e,h,E,r);break}case CCB_PROPTYPE_BLOCKCCCONTROL:{var R=this.parsePropTypeBlockCCControl(t,e,r);u&&R!=null&&this.onHandlePropTypeBlockCCControl(t,e,h,R,r);break}case CCB_PROPTYPE_CCBFILE:{var F=this.parsePropTypeCCBFile(t,e,r);u&&this.onHandlePropTypeCCBFile(t,e,h,F,r);break}default:ASSERT_FAIL_UNEXPECTED_PROPERTYTYPE(l);break}}},getCustomProperties:function(){return this._customProperties},_createCCNode:function(t,e){return new exports.cc.Node},parsePropTypePosition:function(t,e,r,n){var s=r.readFloat(),o=r.readFloat(),a=r.readInt(!1),c=r.getAnimationManager().getContainerSize(e),l=exports.cc._getAbsolutePosition(s,o,a,c,n);if(t.setPosition(exports.cc.getAbsolutePosition(l,a,c,n)),r.getAnimatedProperties().indexOf(n)>-1){var h=[s,o,a];r.getAnimationManager().setBaseValue(h,t,n)}return l},parsePropTypePoint:function(t,e,r){var n=r.readFloat(),s=r.readFloat();return exports.cc.p(n,s)},parsePropTypePointLock:function(t,e,r){var n=r.readFloat(),s=r.readFloat();return exports.cc.p(n,s)},parsePropTypeSize:function(t,e,r){var n=r.readFloat(),s=r.readFloat(),o=r.readInt(!1),a=r.getAnimationManager().getContainerSize(e);switch(o){case CCB_SIZETYPE_ABSOLUTE:break;case CCB_SIZETYPE_RELATIVE_CONTAINER:n=a.width-n,s=a.height-s;break;case CCB_SIZETYPE_PERCENT:n=a.width*n/100,s=a.height*s/100;break;case CCB_SIZETYPE_HORIZONTAL_PERCENT:n=a.width*n/100;break;case CCB_SIZETYPE_VERTICAL_PERCENT:s=a.height*s/100;break;case CCB_SIZETYPE_MULTIPLY_RESOLUTION:var c=exports.cc.BuilderReader.getResolutionScale();n*=c,s*=c;break;default:exports.cc.log("Unknown CCB type.");break}return exports.cc.size(n,s)},parsePropTypeScaleLock:function(t,e,r,n){var s=r.readFloat(),o=r.readFloat(),a=r.readInt(!1);return exports.cc.setRelativeScale(t,s,o,a,n),r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue([s,o,a],t,n),a===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(s*=exports.cc.BuilderReader.getResolutionScale(),o*=exports.cc.BuilderReader.getResolutionScale()),[s,o]},parsePropTypeFloat:function(t,e,r){return r.readFloat()},parsePropTypeDegrees:function(t,e,r,n){var s=r.readFloat();return r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue(s,t,n),s},parsePropTypeFloatScale:function(t,e,r){var n=r.readFloat(),s=r.readInt(!1);return s===CCB_SCALETYPE_MULTIPLY_RESOLUTION&&(n*=exports.cc.BuilderReader.getResolutionScale()),n},parsePropTypeInteger:function(t,e,r){return r.readInt(!0)},parsePropTypeIntegerLabeled:function(t,e,r){return r.readInt(!0)},parsePropTypeFloatVar:function(t,e,r){var n=r.readFloat(),s=r.readFloat();return[n,s]},parsePropTypeCheck:function(t,e,r,n){var s=r.readBool();return r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue(s,t,n),s},parsePropTypeSpriteFrame:function(t,e,r,n){var s=r.readCachedString(),o=r.readCachedString(),a;if(o!=null&&o.length!==0){if(s.length===0){o=r.getCCBRootPath()+o;var c=exports.cc.textureCache.addImage(o),l=c.getContentSize(),h=exports.cc.rect(0,0,l.width,l.height);a=new exports.cc.SpriteFrame(c,h)}else{var u=exports.cc.spriteFrameCache;s=r.getCCBRootPath()+s,r.getLoadedSpriteSheet().indexOf(s)===-1&&(u.addSpriteFrames(s),r.getLoadedSpriteSheet().push(s)),a=u.getSpriteFrame(o)}r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue(a,t,n)}return a},parsePropTypeAnimation:function(t,e,r){var n=r.getCCBRootPath()+r.readCachedString(),s=r.readCachedString(),o=null;if(s=exports.cc.BuilderReader.lastPathComponent(s),n=exports.cc.BuilderReader.lastPathComponent(n),s!=null&&s!==""){var a=exports.cc.animationCache;a.addAnimations(n),o=a.getAnimation(s)}return o},parsePropTypeTexture:function(t,e,r){var n=r.getCCBRootPath()+r.readCachedString();return n!==""?exports.cc.textureCache.addImage(n):null},parsePropTypeByte:function(t,e,r,n){var s=r.readByte();return r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue(s,t,n),s},parsePropTypeColor3:function(t,e,r,n){var s=r.readByte(),o=r.readByte(),a=r.readByte(),c={r:s,g:o,b:a};return r.getAnimatedProperties().indexOf(n)>-1&&r.getAnimationManager().setBaseValue(exports.cc.Color3BWapper.create(c),t,n),c},parsePropTypeColor4FVar:function(t,e,r){var n=0|r.readFloat()*255,s=0|r.readFloat()*255,o=0|r.readFloat()*255,a=r.readFloat();a=a<=1?0|a*255:a;var c=0|r.readFloat()*255,l=0|r.readFloat()*255,h=0|r.readFloat()*255,u=r.readFloat();u=u<=1?0|u*255:u;var _=[];return _[0]={r:n,g:s,b:o,a},_[1]={r:c,g:l,b:h,a:u},_},parsePropTypeFlip:function(t,e,r){var n=r.readBool(),s=r.readBool();return[n,s]},parsePropTypeBlendFunc:function(t,e,r){var n=r.readInt(!1),s=r.readInt(!1);return new exports.cc.BlendFunc(n,s)},parsePropTypeFntFile:function(t,e,r){return r.readCachedString()},parsePropTypeString:function(t,e,r){return r.readCachedString()},parsePropTypeText:function(t,e,r){return r.readCachedString()},parsePropTypeFontTTF:function(t,e,r){return r.readCachedString()},parsePropTypeBlock:function(t,e,r){var n=r.readCachedString(),s=r.readInt(!1);if(s!==CCB_TARGETTYPE_NONE){var o=null;if(r.isJSControlled())s===CCB_TARGETTYPE_DOCUMENTROOT?(r.addDocumentCallbackNode(t),r.addDocumentCallbackName(n),r.addDocumentCallbackControlEvents(0)):(r.addOwnerCallbackNode(t),r.addOwnerCallbackName(n),r.addOwnerCallbackControlEvents(0));else if(s===CCB_TARGETTYPE_DOCUMENTROOT?o=r.getAnimationManager().getRootNode():s===CCB_TARGETTYPE_OWNER&&(o=r.getOwner()),o!==null)if(n.length>0){var a=0;if(o.onResolveCCBCCMenuItemSelector&&(a=o.onResolveCCBCCMenuItemSelector(o,n)),a===0){var c=r.getCCBSelectorResolver();c!=null&&(a=c.onResolveCCBCCMenuItemSelector(o,n))}if(a===0)exports.cc.log("Skipping selector '"+n+"' since no CCBSelectorResolver is present.");else return new BlockData(a,o)}else exports.cc.log("Unexpected empty selector.");else exports.cc.log("Unexpected NULL target for selector.")}return null},parsePropTypeBlockCCControl:function(t,e,r){var n=r.readCachedString(),s=r.readInt(!1),o=r.readInt(!1);if(s!==CCB_TARGETTYPE_NONE)if(r.isJSControlled())s===CCB_TARGETTYPE_DOCUMENTROOT?(r.addDocumentCallbackNode(t),r.addDocumentCallbackName(n),r.addDocumentCallbackControlEvents(o)):(r.addOwnerCallbackNode(t),r.addOwnerCallbackName(n),r.addOwnerCallbackControlEvents(o));else{var a=null;if(s===CCB_TARGETTYPE_DOCUMENTROOT?a=r.getAnimationManager().getRootNode():s===CCB_TARGETTYPE_OWNER&&(a=r.getOwner()),a!==null)if(n.length>0){var c=0;if(a.onResolveCCBCCControlSelector&&(c=a.onResolveCCBCCControlSelector(a,n)),c===0){var l=r.getCCBSelectorResolver();l!=null&&(c=l.onResolveCCBCCControlSelector(a,n))}if(c===0)exports.cc.log("Skipping selector '"+n+"' since no CCBSelectorResolver is present.");else return new BlockCCControlData(c,a,o)}else exports.cc.log("Unexpected empty selector.");else exports.cc.log("Unexpected NULL target for selector.")}return null},parsePropTypeCCBFile:function(t,e,r){var n=r.getCCBRootPath()+r.readCachedString(),s=exports.cc.BuilderReader.deletePathExtension(n);n=s+".ccbi";var o=new exports.cc.BuilderReader(r),a=exports.cc.loader.getRes(n);if(!a){var c=exports.cc.loader.getUrl(n);a=exports.cc.loader.loadBinarySync(c),exports.cc.loader.cache[n]=a}o.initWithData(a,r.getOwner()),o.getAnimationManager().setRootContainerSize(e.getContentSize()),o.setAnimationManagers(r.getAnimationManagers()),o.getAnimationManager().setOwner(r.getOwner());var l=o.readFileWithCleanUp(!1);return r.setAnimationManagers(o.getAnimationManagers()),l&&o.getAnimationManager().getAutoPlaySequenceId()!==-1&&o.getAnimationManager().runAnimations(o.getAnimationManager().getAutoPlaySequenceId(),0),l},parsePropTypeFloatXY:function(t,e,r){var n=r.readFloat(),s=r.readFloat();return[n,s]},onHandlePropTypePosition:function(t,e,r,n,s){r===PROPERTY_POSITION?t.setPosition(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypePoint:function(t,e,r,n,s){r===PROPERTY_ANCHORPOINT?t.setAnchorPoint(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypePointLock:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeSize:function(t,e,r,n,s){r===PROPERTY_CONTENTSIZE?t.setContentSize(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeScaleLock:function(t,e,r,n,s){r===PROPERTY_SCALE?(t.setScaleX(n[0]),t.setScaleY(n[1])):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFloatXY:function(t,e,r,n,s){if(r===PROPERTY_SKEW)t.setSkewX(n[0]),t.setSkewY(n[1]);else{var o=r+"X",a=r+"Y";(!t[o]||!t[a])&&ASSERT_FAIL_UNEXPECTED_PROPERTY(r),t[o](n[0]),t[a](n[1])}},onHandlePropTypeFloat:function(t,e,r,n,s){this._customProperties.setObject(n,r)},onHandlePropTypeDegrees:function(t,e,r,n,s){r===PROPERTY_ROTATION?t.setRotation(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFloatScale:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeInteger:function(t,e,r,n,s){r===PROPERTY_TAG?t.setTag(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeIntegerLabeled:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFloatVar:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_VISIBLE?t.setVisible(n):r===PROPERTY_IGNOREANCHORPOINTFORPOSITION?t.ignoreAnchorPointForPosition(n):ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeSpriteFrame:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeAnimation:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeTexture:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeByte:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeColor3:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeColor4FVar:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFlip:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFntFile:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeString:function(t,e,r,n,s){this._customProperties.setObject(n,r)},onHandlePropTypeText:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeFontTTF:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeBlock:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeBlockCCControl:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)},onHandlePropTypeCCBFile:function(t,e,r,n,s){ASSERT_FAIL_UNEXPECTED_PROPERTY(r)}});exports.cc.NodeLoader.loader=function(){return new exports.cc.NodeLoader};exports.cc.NodeLoaderListener=exports.cc.Class.extend({onNodeLoaded:function(t,e){}});exports.cc.BuilderSelectorResolver=exports.cc.Class.extend({onResolveCCBCCMenuItemSelector:function(t,e){},onResolveCCBCCCallFuncSelector:function(t,e){},onResolveCCBCCControlSelector:function(t,e){}});exports.cc.BuilderScriptOwnerProtocol=exports.cc.Class.extend({createNew:function(){}});exports.cc.BuilderMemberVariableAssigner=exports.cc.Class.extend({onAssignCCBMemberVariable:function(t,e,r){return!1},onAssignCCBCustomProperty:function(t,e,r){return!1}});var PROPERTY_CCBFILE="ccbFile";exports.cc.BuilderFileLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return exports.cc.BuilderFile.create()},onHandlePropTypeCCBFile:function(t,e,r,n,s){r===PROPERTY_CCBFILE?t.setCCBFileNode(n):exports.cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,r,n,s)}});exports.cc.BuilderFileLoader.loader=function(){return new exports.cc.BuilderFileLoader};var PROPERTY_ENABLED="enabled",PROPERTY_SELECTED="selected",PROPERTY_CCCONTROL="ccControl";exports.cc.ControlLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){},onHandlePropTypeBlockCCControl:function(t,e,r,n,s){r===PROPERTY_CCCONTROL?t.addTargetWithActionForControlEvents(n.target,n.selCCControlHandler,n.controlEvents):exports.cc.NodeLoader.prototype.onHandlePropTypeBlockCCControl.call(this,t,e,r,n,s)},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_ENABLED?t.setEnabled(n):r===PROPERTY_SELECTED?t.setSelected(n):exports.cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,r,n,s)}});var PROPERTY_ZOOMONTOUCHDOWN="zoomOnTouchDown",PROPERTY_TITLE_NORMAL="title|1",PROPERTY_TITLE_HIGHLIGHTED="title|2",PROPERTY_TITLE_DISABLED="title|3",PROPERTY_TITLECOLOR_NORMAL="titleColor|1",PROPERTY_TITLECOLOR_HIGHLIGHTED="titleColor|2",PROPERTY_TITLECOLOR_DISABLED="titleColor|3",PROPERTY_TITLETTF_NORMAL="titleTTF|1",PROPERTY_TITLETTF_HIGHLIGHTED="titleTTF|2",PROPERTY_TITLETTF_DISABLED="titleTTF|3",PROPERTY_TITLETTFSIZE_NORMAL="titleTTFSize|1",PROPERTY_TITLETTFSIZE_HIGHLIGHTED="titleTTFSize|2",PROPERTY_TITLETTFSIZE_DISABLED="titleTTFSize|4",PROPERTY_LABELANCHORPOINT="labelAnchorPoint",PROPERTY_PREFEREDSIZE="preferedSize",PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL="backgroundSpriteFrame|1",PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED="backgroundSpriteFrame|2",PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED="backgroundSpriteFrame|3";exports.cc.ControlButtonLoader=exports.cc.ControlLoader.extend({_createCCNode:function(t,e){return new exports.cc.ControlButton},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_ZOOMONTOUCHDOWN?t.setZoomOnTouchDown(n):exports.cc.ControlLoader.prototype.onHandlePropTypeCheck.call(this,t,e,r,n,s)},onHandlePropTypeString:function(t,e,r,n,s){r===PROPERTY_TITLE_NORMAL?t.setTitleForState(n,exports.cc.CONTROL_STATE_NORMAL):r===PROPERTY_TITLE_HIGHLIGHTED?t.setTitleForState(n,exports.cc.CONTROL_STATE_HIGHLIGHTED):r===PROPERTY_TITLE_DISABLED?t.setTitleForState(n,exports.cc.CONTROL_STATE_DISABLED):exports.cc.ControlLoader.prototype.onHandlePropTypeString.call(this,t,e,r,n,s)},onHandlePropTypeFontTTF:function(t,e,r,n,s){r===PROPERTY_TITLETTF_NORMAL?t.setTitleTTFForState(n,exports.cc.CONTROL_STATE_NORMAL):r===PROPERTY_TITLETTF_HIGHLIGHTED?t.setTitleTTFForState(n,exports.cc.CONTROL_STATE_HIGHLIGHTED):r===PROPERTY_TITLETTF_DISABLED?t.setTitleTTFForState(n,exports.cc.CONTROL_STATE_DISABLED):exports.cc.ControlLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,r,n,s)},onHandlePropTypeFloatScale:function(t,e,r,n,s){r===PROPERTY_TITLETTFSIZE_NORMAL?t.setTitleTTFSizeForState(n,exports.cc.CONTROL_STATE_NORMAL):r===PROPERTY_TITLETTFSIZE_HIGHLIGHTED?t.setTitleTTFSizeForState(n,exports.cc.CONTROL_STATE_HIGHLIGHTED):r===PROPERTY_TITLETTFSIZE_DISABLED?t.setTitleTTFSizeForState(n,exports.cc.CONTROL_STATE_DISABLED):exports.cc.ControlLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,r,n,s)},onHandlePropTypePoint:function(t,e,r,n,s){r===PROPERTY_LABELANCHORPOINT?t.setLabelAnchorPoint(n):exports.cc.ControlLoader.prototype.onHandlePropTypePoint.call(this,t,e,r,n,s)},onHandlePropTypeSize:function(t,e,r,n,s){r===PROPERTY_PREFEREDSIZE?t.setPreferredSize(n):exports.cc.ControlLoader.prototype.onHandlePropTypeSize.call(this,t,e,r,n,s)},onHandlePropTypeSpriteFrame:function(t,e,r,n,s){r===PROPERTY_BACKGROUNDSPRITEFRAME_NORMAL?n!=null&&t.setBackgroundSpriteFrameForState(n,exports.cc.CONTROL_STATE_NORMAL):r===PROPERTY_BACKGROUNDSPRITEFRAME_HIGHLIGHTED?n!=null&&t.setBackgroundSpriteFrameForState(n,exports.cc.CONTROL_STATE_HIGHLIGHTED):r===PROPERTY_BACKGROUNDSPRITEFRAME_DISABLED?n!=null&&t.setBackgroundSpriteFrameForState(n,exports.cc.CONTROL_STATE_DISABLED):exports.cc.ControlLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,r,n,s)},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_TITLECOLOR_NORMAL?t.setTitleColorForState(n,exports.cc.CONTROL_STATE_NORMAL):r===PROPERTY_TITLECOLOR_HIGHLIGHTED?t.setTitleColorForState(n,exports.cc.CONTROL_STATE_HIGHLIGHTED):r===PROPERTY_TITLECOLOR_DISABLED?t.setTitleColorForState(n,exports.cc.CONTROL_STATE_DISABLED):exports.cc.ControlLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)}});exports.cc.ControlButtonLoader.loader=function(){return new exports.cc.ControlButtonLoader};var PROPERTY_CONTAINER="container",PROPERTY_DIRECTION="direction",PROPERTY_CLIPSTOBOUNDS="clipsToBounds",PROPERTY_BOUNCES="bounces",PROPERTY_SCALE="scale";exports.cc.ScrollViewLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return new exports.cc.ScrollView},onHandlePropTypeSize:function(t,e,r,n,s){r===PROPERTY_CONTENTSIZE?t.setViewSize(n):exports.cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,r,n,s)},onHandlePropTypeCCBFile:function(t,e,r,n,s){r===PROPERTY_CONTAINER?(t.setContainer(n),t.updateInset()):exports.cc.NodeLoader.prototype.onHandlePropTypeCCBFile.call(this,t,e,r,n,s)},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_CLIPSTOBOUNDS?t.setClippingToBounds(n):r===PROPERTY_BOUNCES?t.setBounceable(n):exports.cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,r,n,s)},onHandlePropTypeFloat:function(t,e,r,n,s){r===PROPERTY_SCALE?t.setScale(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,r,n,s)},onHandlePropTypeIntegerLabeled:function(t,e,r,n,s){r===PROPERTY_DIRECTION?t.setDirection(n):exports.cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,r,n,s)}});exports.cc.ScrollViewLoader.loader=function(){return new exports.cc.ScrollViewLoader};var PROPERTY_CONTENTSIZE="contentSize",PROPERTY_SPRITEFRAME="spriteFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc",PROPERTY_INSETLEFT="insetLeft",PROPERTY_INSETTOP="insetTop",PROPERTY_INSETRIGHT="insetRight",PROPERTY_INSETBOTTOM="insetBottom";exports.cc.Scale9SpriteLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){var r=new exports.cc.Scale9Sprite;return r.setAnchorPoint(0,0),r},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_COLOR?(n.r!==255||n.g!==255||n.b!==255)&&t.setColor(n):exports.cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_OPACITY?t.setOpacity(n):exports.cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC||exports.cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)},onHandlePropTypeSpriteFrame:function(t,e,r,n,s){r===PROPERTY_SPRITEFRAME?t.setSpriteFrame(n):exports.cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,r,n,s)},onHandlePropTypeSize:function(t,e,r,n,s){r===PROPERTY_CONTENTSIZE||(r===PROPERTY_PREFEREDSIZE?t.setPreferredSize(n):exports.cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,r,n,s))},onHandlePropTypeFloat:function(t,e,r,n,s){r===PROPERTY_INSETLEFT?t.setInsetLeft(n):r===PROPERTY_INSETTOP?t.setInsetTop(n):r===PROPERTY_INSETRIGHT?t.setInsetRight(n):r===PROPERTY_INSETBOTTOM?t.setInsetBottom(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,r,n,s)}});exports.cc.Scale9SpriteLoader.loader=function(){return new exports.cc.Scale9SpriteLoader};var PROPERTY_FLIP="flip",PROPERTY_DISPLAYFRAME="displayFrame",PROPERTY_COLOR="color",PROPERTY_OPACITY="opacity",PROPERTY_BLENDFUNC="blendFunc";exports.cc.SpriteLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return new exports.cc.Sprite},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_COLOR?(n.r!==255||n.g!==255||n.b!==255)&&t.setColor(n):exports.cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_OPACITY?t.setOpacity(n):exports.cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)},onHandlePropTypeSpriteFrame:function(t,e,r,n,s){r===PROPERTY_DISPLAYFRAME?n?t.setSpriteFrame(n):exports.cc.log("ERROR: SpriteFrame is null"):exports.cc.NodeLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,r,n,s)},onHandlePropTypeFlip:function(t,e,r,n,s){r===PROPERTY_FLIP?(t.setFlippedX(n[0]),t.setFlippedY(n[1])):exports.cc.NodeLoader.prototype.onHandlePropTypeFlip.call(this,t,e,r,n,s)}});exports.cc.SpriteLoader.loader=function(){return new exports.cc.SpriteLoader};var PROPERTY_TOUCH_ENABLED="touchEnabled",PROPERTY_IS_TOUCH_ENABLED="isTouchEnabled",PROPERTY_ACCELEROMETER_ENABLED="accelerometerEnabled",PROPERTY_IS_ACCELEROMETER_ENABLED="isAccelerometerEnabled",PROPERTY_IS_MOUSE_ENABLED="isMouseEnabled",PROPERTY_MOUSE_ENABLED="mouseEnabled",PROPERTY_KEYBOARD_ENABLED="keyboardEnabled",PROPERTY_IS_KEYBOARD_ENABLED="isKeyboardEnabled";exports.cc.LayerLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){var r=new exports.cc.Layer;return r.setContentSize(0,0),r},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_TOUCH_ENABLED||r===PROPERTY_IS_TOUCH_ENABLED||r===PROPERTY_ACCELEROMETER_ENABLED||r===PROPERTY_IS_ACCELEROMETER_ENABLED||r===PROPERTY_MOUSE_ENABLED||r===PROPERTY_IS_MOUSE_ENABLED||(r===PROPERTY_KEYBOARD_ENABLED||r===PROPERTY_IS_KEYBOARD_ENABLED?t.setKeyboardEnabled&&!exports.cc.sys.isNative?t.setKeyboardEnabled(n):exports.cc.log("The property '"+PROPERTY_IS_KEYBOARD_ENABLED+"' is not supported!"):exports.cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,r,n,s))}});exports.cc.LayerLoader.loader=function(){return new exports.cc.LayerLoader};exports.cc.LayerColorLoader=exports.cc.LayerLoader.extend({_createCCNode:function(t,e){return new exports.cc.LayerColor},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_COLOR?t.setColor(n):exports.cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_OPACITY?t.setOpacity(n):exports.cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)}});exports.cc.LayerColorLoader.loader=function(){return new exports.cc.LayerColorLoader};var PROPERTY_STARTCOLOR="startColor",PROPERTY_ENDCOLOR="endColor",PROPERTY_STARTOPACITY="startOpacity",PROPERTY_ENDOPACITY="endOpacity",PROPERTY_VECTOR="vector";exports.cc.LayerGradientLoader=exports.cc.LayerLoader.extend({_createCCNode:function(t,e){return new exports.cc.LayerGradient},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_STARTCOLOR?t.setStartColor(n):r===PROPERTY_ENDCOLOR?t.setEndColor(n):exports.cc.LayerLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_STARTOPACITY?t.setStartOpacity(n):r===PROPERTY_ENDOPACITY?t.setEndOpacity(n):exports.cc.LayerLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypePoint:function(t,e,r,n,s){r===PROPERTY_VECTOR?t.setVector(n):exports.cc.LayerLoader.prototype.onHandlePropTypePoint.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.LayerLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)}});exports.cc.LayerGradientLoader.loader=function(){return new exports.cc.LayerGradientLoader};exports.cc.MenuLoader=exports.cc.LayerLoader.extend({_createCCNode:function(t,e){var r=new exports.cc.Menu;return r.setContentSize(0,0),r}});exports.cc.MenuLoader.loader=function(){return new exports.cc.MenuLoader};var PROPERTY_BLOCK="block",PROPERTY_ISENABLED="isEnabled";exports.cc.MenuItemLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return null},onHandlePropTypeBlock:function(t,e,r,n,s){r===PROPERTY_BLOCK?n!=null&&t.setTarget(n.selMenuHander,n.target):exports.cc.NodeLoader.prototype.onHandlePropTypeBlock.call(this,t,e,r,n,s)},onHandlePropTypeCheck:function(t,e,r,n,s){r===PROPERTY_ISENABLED?t.setEnabled(n):exports.cc.NodeLoader.prototype.onHandlePropTypeCheck.call(this,t,e,r,n,s)}});var PROPERTY_NORMALDISPLAYFRAME="normalSpriteFrame",PROPERTY_SELECTEDDISPLAYFRAME="selectedSpriteFrame",PROPERTY_DISABLEDDISPLAYFRAME="disabledSpriteFrame";exports.cc.MenuItemImageLoader=exports.cc.MenuItemLoader.extend({_createCCNode:function(t,e){return new exports.cc.MenuItemImage},onHandlePropTypeSpriteFrame:function(t,e,r,n,s){r===PROPERTY_NORMALDISPLAYFRAME?n!=null&&t.setNormalSpriteFrame(n):r===PROPERTY_SELECTEDDISPLAYFRAME?n!=null&&t.setSelectedSpriteFrame(n):r===PROPERTY_DISABLEDDISPLAYFRAME?n!=null&&t.setDisabledSpriteFrame(n):exports.cc.MenuItemLoader.prototype.onHandlePropTypeSpriteFrame.call(this,t,e,r,n,s)}});exports.cc.MenuItemImageLoader.loader=function(){return new exports.cc.MenuItemImageLoader};var PROPERTY_FONTNAME="fontName",PROPERTY_FONTSIZE="fontSize",PROPERTY_HORIZONTALALIGNMENT="horizontalAlignment",PROPERTY_VERTICALALIGNMENT="verticalAlignment",PROPERTY_STRING="string",PROPERTY_DIMENSIONS="dimensions";exports.cc.LabelTTFLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return new exports.cc.LabelTTF},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_COLOR?(n.r!==255||n.g!==255||n.b!==255)&&t.setColor(n):exports.cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_OPACITY?t.setOpacity(n):exports.cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)},onHandlePropTypeFontTTF:function(t,e,r,n,s){r===PROPERTY_FONTNAME?t.setFontName(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFontTTF.call(this,t,e,r,n,s)},onHandlePropTypeText:function(t,e,r,n,s){r===PROPERTY_STRING?t.setString(n):exports.cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,r,n,s)},onHandlePropTypeFloatScale:function(t,e,r,n,s){r===PROPERTY_FONTSIZE?t.setFontSize(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFloatScale.call(this,t,e,r,n,s)},onHandlePropTypeIntegerLabeled:function(t,e,r,n,s){r===PROPERTY_HORIZONTALALIGNMENT?t.setHorizontalAlignment(n):r===PROPERTY_VERTICALALIGNMENT?t.setVerticalAlignment(n):exports.cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,r,n,s)},onHandlePropTypeSize:function(t,e,r,n,s){r===PROPERTY_DIMENSIONS?t.setDimensions(n):exports.cc.NodeLoader.prototype.onHandlePropTypeSize.call(this,t,e,r,n,s)}});exports.cc.LabelTTFLoader.loader=function(){return new exports.cc.LabelTTFLoader};var PROPERTY_FNTFILE="fntFile";exports.cc.LabelBMFontLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return new exports.cc.LabelBMFont},onHandlePropTypeColor3:function(t,e,r,n,s){r===PROPERTY_COLOR?(n.r!==255||n.g!==255||n.b!==255)&&t.setColor(n):exports.cc.NodeLoader.prototype.onHandlePropTypeColor3.call(this,t,e,r,n,s)},onHandlePropTypeByte:function(t,e,r,n,s){r===PROPERTY_OPACITY?t.setOpacity(n):exports.cc.NodeLoader.prototype.onHandlePropTypeByte.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)},onHandlePropTypeFntFile:function(t,e,r,n,s){r===PROPERTY_FNTFILE?t.setFntFile(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFntFile.call(this,t,e,r,n,s)},onHandlePropTypeText:function(t,e,r,n,s){r===PROPERTY_STRING?t.setString(n):exports.cc.NodeLoader.prototype.onHandlePropTypeText.call(this,t,e,r,n,s)}});exports.cc.LabelBMFontLoader.loader=function(){return new exports.cc.LabelBMFontLoader};var PROPERTY_EMITERMODE="emitterMode",PROPERTY_POSVAR="posVar",PROPERTY_EMISSIONRATE="emissionRate",PROPERTY_DURATION="duration",PROPERTY_TOTALPARTICLES="totalParticles",PROPERTY_LIFE="life",PROPERTY_STARTSIZE="startSize",PROPERTY_ENDSIZE="endSize",PROPERTY_STARTSPIN="startSpin",PROPERTY_ENDSPIN="endSpin",PROPERTY_ANGLE="angle",PROPERTY_GRAVITY="gravity",PROPERTY_SPEED="speed",PROPERTY_TANGENTIALACCEL="tangentialAccel",PROPERTY_RADIALACCEL="radialAccel",PROPERTY_TEXTURE="texture",PROPERTY_STARTRADIUS="startRadius",PROPERTY_ENDRADIUS="endRadius",PROPERTY_ROTATEPERSECOND="rotatePerSecond";exports.cc.ParticleSystemLoader=exports.cc.NodeLoader.extend({_createCCNode:function(t,e){return new exports.cc.ParticleSystem},onHandlePropTypeIntegerLabeled:function(t,e,r,n,s){r===PROPERTY_EMITERMODE?t.setEmitterMode(n):exports.cc.NodeLoader.prototype.onHandlePropTypeIntegerLabeled.call(this,t,e,r,n,s)},onHandlePropTypePoint:function(t,e,r,n,s){r===PROPERTY_POSVAR?t.setPosVar(n):r===PROPERTY_GRAVITY?t.setGravity(n):exports.cc.NodeLoader.prototype.onHandlePropTypePoint.call(this,t,e,r,n,s)},onHandlePropTypeFloat:function(t,e,r,n,s){r===PROPERTY_EMISSIONRATE?t.setEmissionRate(n):r===PROPERTY_DURATION?t.setDuration(n):exports.cc.NodeLoader.prototype.onHandlePropTypeFloat.call(this,t,e,r,n,s)},onHandlePropTypeInteger:function(t,e,r,n,s){r===PROPERTY_TOTALPARTICLES?t.setTotalParticles(n):exports.cc.NodeLoader.prototype.onHandlePropTypeInteger.call(this,t,e,r,n,s)},onHandlePropTypeFloatVar:function(t,e,r,n,s){r===PROPERTY_LIFE?(t.setLife(n[0]),t.setLifeVar(n[1])):r===PROPERTY_STARTSIZE?(t.setStartSize(n[0]),t.setStartSizeVar(n[1])):r===PROPERTY_ENDSIZE?(t.setEndSize(n[0]),t.setEndSizeVar(n[1])):r===PROPERTY_STARTSPIN?(t.setStartSpin(n[0]),t.setStartSpinVar(n[1])):r===PROPERTY_ENDSPIN?(t.setEndSpin(n[0]),t.setEndSpinVar(n[1])):r===PROPERTY_ANGLE?(t.setAngle(n[0]),t.setAngleVar(n[1])):r===PROPERTY_SPEED?(t.setSpeed(n[0]),t.setSpeedVar(n[1])):r===PROPERTY_TANGENTIALACCEL?(t.setTangentialAccel(n[0]),t.setTangentialAccelVar(n[1])):r===PROPERTY_RADIALACCEL?(t.setRadialAccel(n[0]),t.setRadialAccelVar(n[1])):r===PROPERTY_STARTRADIUS?(t.setStartRadius(n[0]),t.setStartRadiusVar(n[1])):r===PROPERTY_ENDRADIUS?(t.setEndRadius(n[0]),t.setEndRadiusVar(n[1])):r===PROPERTY_ROTATEPERSECOND?(t.setRotatePerSecond(n[0]),t.setRotatePerSecondVar(n[1])):exports.cc.NodeLoader.prototype.onHandlePropTypeFloatVar.call(this,t,e,r,n,s)},onHandlePropTypeColor4FVar:function(t,e,r,n,s){r===PROPERTY_STARTCOLOR?(t.setStartColor(n[0]),t.setStartColorVar(n[1])):r===PROPERTY_ENDCOLOR?(t.setEndColor(n[0]),t.setEndColorVar(n[1])):exports.cc.NodeLoader.prototype.onHandlePropTypeColor4FVar.call(this,t,e,r,n,s)},onHandlePropTypeBlendFunc:function(t,e,r,n,s){r===PROPERTY_BLENDFUNC?t.setBlendFunc(n):exports.cc.NodeLoader.prototype.onHandlePropTypeBlendFunc.call(this,t,e,r,n,s)},onHandlePropTypeTexture:function(t,e,r,n,s){r===PROPERTY_TEXTURE?t.setTexture(n):exports.cc.NodeLoader.prototype.onHandlePropTypeTexture.call(this,t,e,r,n,s)}});exports.cc.ParticleSystemLoader.loader=function(){return new exports.cc.ParticleSystemLoader};exports.cc.NodeLoaderLibrary=exports.cc.Class.extend({_ccNodeLoaders:null,ctor:function(){this._ccNodeLoaders={}},registerDefaultCCNodeLoaders:function(){this.registerCCNodeLoader("CCNode",exports.cc.NodeLoader.loader()),this.registerCCNodeLoader("CCLayer",exports.cc.LayerLoader.loader()),this.registerCCNodeLoader("CCLayerColor",exports.cc.LayerColorLoader.loader()),this.registerCCNodeLoader("CCLayerGradient",exports.cc.LayerGradientLoader.loader()),this.registerCCNodeLoader("CCSprite",exports.cc.SpriteLoader.loader()),this.registerCCNodeLoader("CCLabelBMFont",exports.cc.LabelBMFontLoader.loader()),this.registerCCNodeLoader("CCLabelTTF",exports.cc.LabelTTFLoader.loader()),this.registerCCNodeLoader("CCScale9Sprite",exports.cc.Scale9SpriteLoader.loader()),this.registerCCNodeLoader("CCScrollView",exports.cc.ScrollViewLoader.loader()),this.registerCCNodeLoader("CCBFile",exports.cc.BuilderFileLoader.loader()),this.registerCCNodeLoader("CCMenu",exports.cc.MenuLoader.loader()),this.registerCCNodeLoader("CCMenuItemImage",exports.cc.MenuItemImageLoader.loader()),this.registerCCNodeLoader("CCControlButton",exports.cc.ControlButtonLoader.loader()),this.registerCCNodeLoader("CCParticleSystemQuad",exports.cc.ParticleSystemLoader.loader())},registerCCNodeLoader:function(t,e){this._ccNodeLoaders[t]=e},unregisterCCNodeLoader:function(t){this._ccNodeLoaders[t]&&delete this._ccNodeLoaders[t]},getCCNodeLoader:function(t){return this._ccNodeLoaders[t]?this._ccNodeLoaders[t]:null},purge:function(t){if(t)for(var e in this._ccNodeLoaders)delete this._ccNodeLoaders[e];this._ccNodeLoaders={}}});exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null;exports.cc.NodeLoaderLibrary.library=function(){return new exports.cc.NodeLoaderLibrary};exports.cc.NodeLoaderLibrary.sharedCCNodeLoaderLibrary=function(){return exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary==null&&(exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=new exports.cc.NodeLoaderLibrary,exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary.registerDefaultCCNodeLoaders()),exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary};exports.cc.NodeLoaderLibrary.purgeSharedCCNodeLoaderLibrary=function(){exports.cc.NodeLoaderLibrary.sSharedCCNodeLoaderLibrary=null};exports.cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary=function(){var t=exports.cc.NodeLoaderLibrary.library();return t.registerDefaultCCNodeLoaders(),t};var CCB_VERSION=5,CCB_PROPTYPE_POSITION=0,CCB_PROPTYPE_SIZE=1,CCB_PROPTYPE_POINT=2,CCB_PROPTYPE_POINTLOCK=3,CCB_PROPTYPE_SCALELOCK=4,CCB_PROPTYPE_DEGREES=5,CCB_PROPTYPE_INTEGER=6,CCB_PROPTYPE_FLOAT=7,CCB_PROPTYPE_FLOATVAR=8,CCB_PROPTYPE_CHECK=9,CCB_PROPTYPE_SPRITEFRAME=10,CCB_PROPTYPE_TEXTURE=11,CCB_PROPTYPE_BYTE=12,CCB_PROPTYPE_COLOR3=13,CCB_PROPTYPE_COLOR4VAR=14,CCB_PROPTYPE_FLIP=15,CCB_PROPTYPE_BLENDMODE=16,CCB_PROPTYPE_FNTFILE=17,CCB_PROPTYPE_TEXT=18,CCB_PROPTYPE_FONTTTF=19,CCB_PROPTYPE_INTEGERLABELED=20,CCB_PROPTYPE_BLOCK=21,CCB_PROPTYPE_ANIMATION=22,CCB_PROPTYPE_CCBFILE=23,CCB_PROPTYPE_STRING=24,CCB_PROPTYPE_BLOCKCCCONTROL=25,CCB_PROPTYPE_FLOATSCALE=26,CCB_PROPTYPE_FLOATXY=27,CCB_FLOAT0=0,CCB_FLOAT1=1,CCB_FLOAT_MINUS1=2,CCB_FLOAT05=3,CCB_FLOAT_INTEGER=4,CCB_PLATFORM_ALL=0,CCB_PLATFORM_IOS=1,CCB_PLATFORM_MAC=2,CCB_TARGETTYPE_NONE=0,CCB_TARGETTYPE_DOCUMENTROOT=1,CCB_TARGETTYPE_OWNER=2,CCB_KEYFRAME_EASING_INSTANT=0,CCB_KEYFRAME_EASING_LINEAR=1,CCB_KEYFRAME_EASING_CUBIC_IN=2,CCB_KEYFRAME_EASING_CUBIC_OUT=3,CCB_KEYFRAME_EASING_CUBIC_INOUT=4,CCB_KEYFRAME_EASING_ELASTIC_IN=5,CCB_KEYFRAME_EASING_ELASTIC_OUT=6,CCB_KEYFRAME_EASING_ELASTIC_INOUT=7,CCB_KEYFRAME_EASING_BOUNCE_IN=8,CCB_KEYFRAME_EASING_BOUNCE_OUT=9,CCB_KEYFRAME_EASING_BOUNCE_INOUT=10,CCB_KEYFRAME_EASING_BACK_IN=11,CCB_KEYFRAME_EASING_BACK_OUT=12,CCB_KEYFRAME_EASING_BACK_INOUT=13,CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT=0,CCB_POSITIONTYPE_RELATIVE_TOP_LEFT=1,CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT=2,CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT=3,CCB_POSITIONTYPE_PERCENT=4,CCB_POSITIONTYPE_MULTIPLY_RESOLUTION=5,CCB_SIZETYPE_ABSOLUTE=0,CCB_SIZETYPE_PERCENT=1,CCB_SIZETYPE_RELATIVE_CONTAINER=2,CCB_SIZETYPE_HORIZONTAL_PERCENT=3,CCB_SIZETYPE_VERTICAL_PERCENT=4,CCB_SIZETYPE_MULTIPLY_RESOLUTION=5,CCB_SCALETYPE_MULTIPLY_RESOLUTION=1;exports.cc.BuilderFile=exports.cc.Node.extend({_ccbFileNode:null,getCCBFileNode:function(){return this._ccbFileNode},setCCBFileNode:function(t){this._ccbFileNode=t}});exports.cc.BuilderFile.create=function(){return new exports.cc.BuilderFile};exports.cc.BuilderReader=exports.cc.Class.extend({_jsControlled:!1,_data:null,_ccbRootPath:"",_bytes:0,_currentByte:0,_currentBit:0,_stringCache:null,_loadedSpriteSheets:null,_owner:null,_animationManager:null,_animationManagers:null,_animatedProps:null,_ccNodeLoaderLibrary:null,_ccNodeLoaderListener:null,_ccbMemberVariableAssigner:null,_ccbSelectorResolver:null,_ownerOutletNames:null,_ownerOutletNodes:null,_nodesWithAnimationManagers:null,_animationManagerForNodes:null,_ownerCallbackNames:null,_ownerCallbackNodes:null,_ownerCallbackEvents:null,_readNodeGraphFromData:!1,ctor:function(t,e,r,n){if(this._stringCache=[],this._loadedSpriteSheets=[],this._currentBit=-1,this._currentByte=-1,arguments.length!==0)if(t instanceof exports.cc.BuilderReader){var s=t;this._loadedSpriteSheets=s._loadedSpriteSheets,this._ccNodeLoaderLibrary=s._ccNodeLoaderLibrary,this._ccbMemberVariableAssigner=s._ccbMemberVariableAssigner,this._ccbSelectorResolver=s._ccbSelectorResolver,this._ccNodeLoaderListener=s._ccNodeLoaderListener,this._ownerCallbackNames=s._ownerCallbackNames,this._ownerCallbackNodes=s._ownerCallbackNodes,this._ownerCallbackEvents=s._ownerCallbackEvents,this._ownerOutletNames=s._ownerOutletNames,this._ownerOutletNodes=s._ownerOutletNodes,this._ccbRootPath=s._ccbRootPath}else this._ccNodeLoaderLibrary=t,this._ccbMemberVariableAssigner=e,this._ccbSelectorResolver=r,this._ccNodeLoaderListener=n},getCCBRootPath:function(){return this._ccbRootPath},setCCBRootPath:function(t){this._ccbRootPath=t},initWithData:function(t,e){return this._animationManager=new exports.cc.BuilderAnimationManager,this._data=t,this._bytes=t.length,this._currentBit=0,this._currentByte=0,this._owner=e,this._animationManager.setRootContainerSize(exports.cc.director.getWinSize()),!0},_loadBinarySync:function(t){var e=this.getXMLHttpRequest(),r="load "+t+" failed!";e.open("GET",t,!1);var n=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){if(e.setRequestHeader("Accept-Charset","x-user-defined"),e.send(null),e.status!==200)return exports.cc.log(r),null;var s=exports.cc._convertResponseBodyToText(e.responseBody);s&&(n=this._stringConvertToArray(s),this._fileDataCache[t]=n)}else{if(e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),e.status!==200)return exports.cc.log(r),null;n=this._stringConvertToArray(e.responseText),this._fileDataCache[t]=n}return n},readNodeGraphFromFile:function(t,e,r,n){r==null?r=exports.cc.director.getWinSize():r instanceof exports.cc.BuilderAnimationManager&&(n=r,r=exports.cc.director.getWinSize());var s=exports.cc.loader.getRes(t);if(!s){var o=exports.cc.loader.getUrl(t);s=exports.cc.loader.loadBinarySync(o),exports.cc.loader.cache[t]=s}return this.readNodeGraphFromData(s,e,r,n)},readNodeGraphFromData:function(t,e,r){this.initWithData(t,e);var n=this._animationManager;n.setRootContainerSize(r),n.setOwner(e),this._ownerOutletNames=[],this._ownerOutletNodes=[],this._ownerCallbackNames=[],this._ownerCallbackNodes=[],this._ownerCallbackEvents=[],this._animationManagers=new exports.cc._Dictionary;var s=this.readFileWithCleanUp(!0);if(s&&n.getAutoPlaySequenceId()!==-1&&n.runAnimations(n.getAutoPlaySequenceId(),0),this._jsControlled){for(var o=[],a=[],c=this._animationManagers,l=c.allKeys(),h=0;h<l.length;h++)o.push(l[h]),a.push(c.objectForKey(l[h]));this._nodesWithAnimationManagers=o,this._animationManagerForNodes=a}return s},createSceneWithNodeGraphFromFile:function(t,e,r,n){var s=this.readNodeGraphFromFile(t,e,r,n),o=new exports.cc.Scene;return o.addChild(s),o},getCCBMemberVariableAssigner:function(){return this._ccbMemberVariableAssigner},getCCBSelectorResolver:function(){return this._ccbSelectorResolver},getAnimationManager:function(){return this._animationManager},setAnimationManager:function(t){this._animationManager=t},getAnimatedProperties:function(){return this._animatedProps},getLoadedSpriteSheet:function(){return this._loadedSpriteSheets},getOwner:function(){return this._owner},readInt:function(t){for(var e=0;!this._getBit();)e++;for(var r=0,n=e-1;n>=0;n--)this._getBit()&&(r|=1<<n);r|=1<<e;var s;if(t){var o=r%2;o?s=0|r/2:s=0|-r/2}else s=r-1;return this._alignBits(),s},readByte:function(){var t=this._data[this._currentByte];return this._currentByte++,t},readBool:function(){return this.readByte()!==0},readFloat:function(){var t=this.readByte();switch(t){case CCB_FLOAT0:return 0;case CCB_FLOAT1:return 1;case CCB_FLOAT_MINUS1:return-1;case CCB_FLOAT05:return .5;case CCB_FLOAT_INTEGER:return this.readInt(!0);default:var e=this._decodeFloat(23,8);return e}},_decodeFloat:function(t,e){var r=t+e+1,n=r>>3;this._checkSize(r);var s=Math.pow(2,e-1)-1,o=this._readBitsOnly(t+e,1,n),a=this._readBitsOnly(t,e,n),c=0,l=2,h=0;do for(var u=this._readByteOnly(++h,n),_=t%8||8,d=1<<_;d>>=1;)u&d&&(c+=1/l),l*=2;while(t-=_);return this._currentByte+=n,a===(s<<1)+1?c?NaN:o?-1/0:1/0:(1+o*-2)*(a||c?a?Math.pow(2,a-s)*(1+c):Math.pow(2,-s+1)*c:0)},_readBitsOnly:function(t,e,r){var n=(t+e)%8,s=t%8,o=r-(t>>3)-1,a=r+(-(t+e)>>3),c=o-a,l=this._readByteOnly(o,r)>>s&(1<<(c?8-s:e))-1;for(c&&n&&(l+=(this._readByteOnly(a++,r)&(1<<n)-1)<<(c--<<3)-s);c;)l+=this._shl(this._readByteOnly(a++,r),(c--<<3)-s);return l},_readByteOnly:function(t,e){return this._data[this._currentByte+e-t-1]},_shl:function(t,e){for(++e;--e;t=((t%=2147483647+1)&1073741824)===1073741824?t*2:(t-1073741824)*2+2147483647+1);return t},_checkSize:function(t){if(!(this._currentByte+Math.ceil(t/8)<this._data.length))throw new Error("Index out of bound")},readCachedString:function(){return this._stringCache[this.readInt(!1)]},isJSControlled:function(){return this._jsControlled},getOwnerCallbackNames:function(){return this._ownerCallbackNames},getOwnerCallbackNodes:function(){return this._ownerCallbackNodes},getOwnerCallbackControlEvents:function(){return this._ownerCallbackEvents},getOwnerOutletNames:function(){return this._ownerOutletNames},getOwnerOutletNodes:function(){return this._ownerOutletNodes},getNodesWithAnimationManagers:function(){return this._nodesWithAnimationManagers},getAnimationManagersForNodes:function(){return this._animationManagerForNodes},getAnimationManagers:function(){return this._animationManagers},setAnimationManagers:function(t){this._animationManagers=t},addOwnerCallbackName:function(t){this._ownerCallbackNames.push(t)},addOwnerCallbackNode:function(t){this._ownerCallbackNodes.push(t)},addOwnerCallbackControlEvents:function(t){this._ownerCallbackEvents.push(t)},addDocumentCallbackName:function(t){this._animationManager.addDocumentCallbackName(t)},addDocumentCallbackNode:function(t){this._animationManager.addDocumentCallbackNode(t)},addDocumentCallbackControlEvents:function(t){this._animationManager.addDocumentCallbackControlEvents(t)},readFileWithCleanUp:function(t){if(!this._readHeader()||!this._readStringCache()||!this._readSequences())return null;var e=this._readNodeGraph();return this._animationManagers.setObject(this._animationManager,e),t&&this._cleanUpNodeGraph(e),e},addOwnerOutletName:function(t){this._ownerOutletNames.push(t)},addOwnerOutletNode:function(t){t!=null&&this._ownerOutletNodes.push(t)},_cleanUpNodeGraph:function(t){t.userObject=null;for(var e=t.getChildren(),r=0,n=e.length;r<n;r++)this._cleanUpNodeGraph(e[r])},_readCallbackKeyframesForSeq:function(t){var e=this.readInt(!1);if(!e)return!0;for(var r=new exports.cc.BuilderSequenceProperty,n=this._jsControlled,s=this._animationManager,o=r.getKeyframes(),a=0;a<e;a++){var c=this.readFloat(),l=this.readCachedString(),h=this.readInt(!1),u=[l,h],_=new exports.cc.BuilderKeyframe;_.setTime(c),_.setValue(u),n&&s.getKeyframeCallbacks().push(h+":"+l),o.push(_)}return t.setCallbackChannel(r),!0},_readSoundKeyframesForSeq:function(t){var e=this.readInt(!1);if(!e)return!0;for(var r=new exports.cc.BuilderSequenceProperty,n=r.getKeyframes(),s=0;s<e;s++){var o=this.readFloat(),a=this.readCachedString(),c=this.readFloat(),l=this.readFloat(),h=this.readFloat(),u=[a,c,l,h],_=new exports.cc.BuilderKeyframe;_.setTime(o),_.setValue(u),n.push(_)}return t.setSoundChannel(r),!0},_readSequences:function(){for(var t=this._animationManager.getSequences(),e=this.readInt(!1),r=0;r<e;r++){var n=new exports.cc.BuilderSequence;if(n.setDuration(this.readFloat()),n.setName(this.readCachedString()),n.setSequenceId(this.readInt(!1)),n.setChainedSequenceId(this.readInt(!0)),!this._readCallbackKeyframesForSeq(n)||!this._readSoundKeyframesForSeq(n))return!1;t.push(n)}return this._animationManager.setAutoPlaySequenceId(this.readInt(!0)),!0},readKeyframe:function(t){var e=new exports.cc.BuilderKeyframe;e.setTime(this.readFloat());var r=this.readInt(!1),n=0,s=null;if((r===CCB_KEYFRAME_EASING_CUBIC_IN||r===CCB_KEYFRAME_EASING_CUBIC_OUT||r===CCB_KEYFRAME_EASING_CUBIC_INOUT||r===CCB_KEYFRAME_EASING_ELASTIC_IN||r===CCB_KEYFRAME_EASING_ELASTIC_OUT||r===CCB_KEYFRAME_EASING_ELASTIC_INOUT)&&(n=this.readFloat()),e.setEasingType(r),e.setEasingOpt(n),t===CCB_PROPTYPE_CHECK)s=this.readBool();else if(t===CCB_PROPTYPE_BYTE)s=this.readByte();else if(t===CCB_PROPTYPE_COLOR3){var o=exports.cc.color(this.readByte(),this.readByte(),this.readByte());s=exports.cc.Color3BWapper.create(o)}else if(t===CCB_PROPTYPE_FLOATXY)s=[this.readFloat(),this.readFloat()];else if(t===CCB_PROPTYPE_DEGREES)s=this.readFloat();else if(t===CCB_PROPTYPE_SCALELOCK||t===CCB_PROPTYPE_POSITION||t===CCB_PROPTYPE_FLOATXY)s=[this.readFloat(),this.readFloat()];else if(t===CCB_PROPTYPE_SPRITEFRAME){var a=this.readCachedString(),c=this.readCachedString();if(a===""){c=this._ccbRootPath+c;var l=exports.cc.textureCache.addImage(c),h=l.getContentSize(),u=exports.cc.rect(0,0,h.width,h.height);s=new exports.cc.SpriteFrame(l,u)}else{a=this._ccbRootPath+a;var _=exports.cc.spriteFrameCache;this._loadedSpriteSheets.indexOf(a)===-1&&(_.addSpriteFrames(a),this._loadedSpriteSheets.push(a)),s=_.getSpriteFrame(c)}}return e.setValue(s),e},_readHeader:function(){if(!this._data)return!1;var t=this._readStringFromBytes(this._currentByte,4,!0);if(this._currentByte+=4,t!=="ccbi")return!1;var e=this.readInt(!1);return e!==CCB_VERSION?(exports.cc.log("WARNING! Incompatible ccbi file version (file: "+e+" reader: "+CCB_VERSION+")"),!1):(this._jsControlled=this.readBool(),this._animationManager._jsControlled=this._jsControlled,!0)},_readStringFromBytes:function(t,e,r){r=r||!1;var n="",s,o=this._data,a=this._currentByte;if(r)for(s=e-1;s>=0;s--)n+=String.fromCharCode(o[a+s]);else for(s=0;s<e;s++)n+=String.fromCharCode(o[a+s]);return n},_readStringCache:function(){for(var t=this.readInt(!1),e=0;e<t;e++)this._readStringCacheEntry();return!0},_readStringCacheEntry:function(){for(var t=this.readByte(),e=this.readByte(),r=t<<8|e,n="",s=this._data,o=this._currentByte,a=0;a<r;a++){var c=s[o+a].toString("16").toUpperCase();c=c.length>1?c:"0"+c,n+="%"+c}n=decodeURIComponent(n),this._currentByte+=r,this._stringCache.push(n)},_readNodeGraph:function(t){var e=this.readCachedString(),r,n=this._jsControlled,s=this._animationManager;n&&(r=this.readCachedString());var o=this.readInt(!1),a;o!==CCB_TARGETTYPE_NONE&&(a=this.readCachedString());var c=this._ccNodeLoaderLibrary.getCCNodeLoader(e);c||(c=this._ccNodeLoaderLibrary.getCCNodeLoader("CCNode"));var l=c.loadCCNode(t,this);s.getRootNode()||s.setRootNode(l),n&&l===s.getRootNode()&&s.setDocumentControllerName(r);var h=new exports.cc._Dictionary;this._animatedProps=[];var u,_=this._animatedProps,d=this.readInt(!1);for(u=0;u<d;++u){for(var f=this.readInt(!1),T=new exports.cc._Dictionary,x=this.readInt(!1),m=0;m<x;++m){var v=new exports.cc.BuilderSequenceProperty;v.setName(this.readCachedString()),v.setType(this.readInt(!1)),_.push(v.getName());for(var A=this.readInt(!1),D=v.getKeyframes(),N=0;N<A;++N){var z=this.readKeyframe(v.getType());D.push(z)}T.setObject(v,v.getName())}h.setObject(T,f)}h.count()>0&&s.addNode(l,h),c.parseProperties(l,t,this);var M=l instanceof exports.cc.BuilderFile;if(M){var J=l.getCCBFileNode();J.setPosition(l.getPosition()),J.setRotation(l.getRotation()),J.setScaleX(l.getScaleX()),J.setScaleY(l.getScaleY()),J.setTag(l.getTag()),J.setVisible(!0),s.moveAnimationsFromNode(l,J),l.setCCBFileNode(null),l=J}var U=null,K=null;if(o!==CCB_TARGETTYPE_NONE){if(n)o===CCB_TARGETTYPE_DOCUMENTROOT?(s.addDocumentOutletName(a),s.addDocumentOutletNode(l)):(this._ownerOutletNames.push(a),this._ownerOutletNodes.push(l));else if(o===CCB_TARGETTYPE_DOCUMENTROOT?U=s.getRootNode():o===CCB_TARGETTYPE_OWNER&&(U=this._owner),!U){var tt=!1;U.onAssignCCBMemberVariable&&(tt=U.onAssignCCBMemberVariable(U,a,l)),K=this._ccbMemberVariableAssigner,!tt&&K!=null&&K.onAssignCCBMemberVariable&&K.onAssignCCBMemberVariable(U,a,l)}}if(c.getCustomProperties().length>0){var rt=!1;if(!n&&(U=l,U!=null&&U.onAssignCCBCustomProperty!=null)){var I=c.getCustomProperties(),L=I.allKeys();for(u=0;u<L.length;u++){var G=I.objectForKey(L[u]);rt=U.onAssignCCBCustomProperty(U,L[u],G),K=this._ccbMemberVariableAssigner,!rt&&K!=null&&K.onAssignCCBCustomProperty!=null&&(rt=K.onAssignCCBCustomProperty(U,L[u],G))}}}this._animatedProps=null;var w=this.readInt(!1);for(u=0;u<w;u++){var O=this._readNodeGraph(l);l.addChild(O)}return M||(l!=null&&l.onNodeLoaded?l.onNodeLoaded(l,c):this._ccNodeLoaderListener!=null&&this._ccNodeLoaderListener.onNodeLoaded(l,c)),l},_getBit:function(){var t=(this._data[this._currentByte]&1<<this._currentBit)!==0;if(this._currentBit++,this._currentBit>=8&&(this._currentBit=0,this._currentByte++,this._currentByte>this._data.length))throw new Error("out of the data bound");return t},_alignBits:function(){this._currentBit&&(this._currentBit=0,this._currentByte++)},_readUTF8:function(){}});exports.cc.BuilderReader._ccbResolutionScale=1;exports.cc.BuilderReader.setResolutionScale=function(t){exports.cc.BuilderReader._ccbResolutionScale=t};exports.cc.BuilderReader.getResolutionScale=function(){return exports.cc.BuilderReader._ccbResolutionScale};exports.cc.BuilderReader.loadAsScene=function(t,e,r,n){n=n||exports.cc.BuilderReader.getResourcePath();var s=exports.cc.BuilderReader.load(t,e,r,n),o=new exports.cc.Scene;return o.addChild(s),o};exports.cc.BuilderReader._controllerClassCache={};exports.cc.BuilderReader.registerController=function(t,e){exports.cc.BuilderReader._controllerClassCache[t]=exports.cc.Class.extend(e)};exports.cc.BuilderReader.load=function(t,e,r,n){n=n||exports.cc.BuilderReader.getResourcePath();var s=new exports.cc.BuilderReader(exports.cc.NodeLoaderLibrary.newDefaultCCNodeLoaderLibrary());s.setCCBRootPath(n),(t.length<5||t.toLowerCase().lastIndexOf(".ccbi")!==t.length-5)&&(t=t+".ccbi");var o=s.readNodeGraphFromFile(t,e,r),a,c,l,h,u,_;if(e){var d=s.getOwnerCallbackNames(),f=s.getOwnerCallbackNodes(),T=s.getOwnerCallbackControlEvents();for(a=0;a<d.length;a++)c=d[a],l=f[a],h=T[a],l instanceof exports.cc.ControlButton?l.addTargetWithActionForControlEvents(e,e[c],h):l.setCallback(e[c],e);var x=s.getOwnerOutletNames(),m=s.getOwnerOutletNodes();for(a=0;a<x.length;a++)u=x[a],_=m[a],e[u]=_}var v=s.getNodesWithAnimationManagers(),A=s.getAnimationManagersForNodes();if(!v||!A)return o;var D=exports.cc.BuilderReader._controllerClassCache;for(a=0;a<v.length;a++){var N=v[a],z=A[a],M;N.animationManager=z;var J=z.getDocumentControllerName();if(J){var U=D[J];if(!U)throw new Error("Can not find controller : "+J);var K=new U;K.controllerName=J,N.controller=K,K.rootNode=N;var tt=z.getDocumentCallbackNames(),rt=z.getDocumentCallbackNodes(),I=z.getDocumentCallbackControlEvents();for(M=0;M<tt.length;M++)c=tt[M],l=rt[M],h=I[M],l instanceof exports.cc.ControlButton?l.addTargetWithActionForControlEvents(K,K[c],h):l.setCallback(K[c],K);var L=z.getDocumentOutletNames(),G=z.getDocumentOutletNodes();for(M=0;M<L.length;M++)u=L[M],_=G[M],K[u]=_;K.onDidLoadFromCCB&&exports.cc.isFunction(K.onDidLoadFromCCB)&&K.onDidLoadFromCCB();var w=z.getKeyframeCallbacks();for(M=0;M<w.length;M++){var O=w[M].split(":"),j=O[0],Q=O[1];j==1?z.setCallFunc(exports.cc.callFunc(K[Q],K),w[M]):j==2&&e&&z.setCallFunc(exports.cc.callFunc(e[Q],e),w[M])}}}return z.runAnimations(z.getAutoPlaySequenceId(),0),o};exports.cc.BuilderReader._resourcePath="";exports.cc.BuilderReader.setResourcePath=function(t){exports.cc.BuilderReader._resourcePath=t};exports.cc.BuilderReader.getResourcePath=function(){return exports.cc.BuilderReader._resourcePath};exports.cc.BuilderReader.lastPathComponent=function(t){var e=t.lastIndexOf("/");return e!==-1?t.substring(e+1,t.length-e):t};exports.cc.BuilderReader.deletePathExtension=function(t){var e=t.lastIndexOf(".");return e!==-1?t.substring(0,e):t};exports.cc.BuilderReader.toLowerCase=function(t){return t.toLowerCase()};exports.cc.BuilderReader.endsWith=function(t,e){return t.length>=e.length?t.lastIndexOf(e)===0:!1};exports.cc.BuilderReader.concat=function(t,e){return t+e};exports.cc.loader.register(["ccbi"],exports.cc._binaryLoader);exports.cc.INT_VALUE=0;exports.cc.FLOAT_VALUE=1;exports.cc.POINTER_VALUE=2;exports.cc.BOOL_VALUE=3;exports.cc.UNSIGNEDCHAR_VALUE=4;exports.cc.Color3BWapper=exports.cc.Class.extend({_color:null,ctor:function(){this._color=exports.cc.color(0,0,0)},getColor:function(){return this._color}});exports.cc.Color3BWapper.create=function(t){var e=new exports.cc.Color3BWapper;return e&&(e._color.r=t.r,e._color.g=t.g,e._color.b=t.b),e};exports.cc.BuilderValue=exports.cc.Class.extend({_value:null,_type:0,getIntValue:function(){},getFloatValue:function(){},getBoolValue:function(){},getByteValue:function(){},getPointer:function(){},getValue:function(){return this._value}});exports.cc.BuilderValue.create=function(t){return new exports.cc.BuilderValue};exports.cc.BuilderKeyframe=exports.cc.Class.extend({_value:null,_time:0,_easingType:0,_easingOpt:0,getValue:function(){return this._value},setValue:function(t){this._value=t},getTime:function(){return this._time},setTime:function(t){this._time=t},getEasingType:function(){return this._easingType},setEasingType:function(t){this._easingType=t},getEasingOpt:function(){return this._easingOpt},setEasingOpt:function(t){this._easingOpt=t}});exports.cc.BuilderSequence=exports.cc.Class.extend({_duration:0,_name:"",_sequenceId:0,_chainedSequenceId:0,_callbackChannel:null,_soundChannel:null,ctor:function(){this._name=""},getDuration:function(){return this._duration},setDuration:function(t){this._duration=t},getName:function(){return this._name},setName:function(t){this._name=t},getSequenceId:function(){return this._sequenceId},setSequenceId:function(t){this._sequenceId=t},getChainedSequenceId:function(){return this._chainedSequenceId},setChainedSequenceId:function(t){this._chainedSequenceId=t},getCallbackChannel:function(){return this._callbackChannel},setCallbackChannel:function(t){this._callbackChannel=t},getSoundChannel:function(){return this._soundChannel},setSoundChannel:function(t){this._soundChannel=t}});exports.cc.BuilderSequenceProperty=exports.cc.Class.extend({_name:null,_type:0,_keyFrames:null,ctor:function(){this.init()},init:function(){this._keyFrames=[],this._name=""},getName:function(){return this._name},setName:function(t){this._name=t},getType:function(){return this._type},setType:function(t){this._type=t},getKeyframes:function(){return this._keyFrames}});exports.cc.getAbsolutePosition=function(t,e,r,n){var s=exports.cc.p(0,0);if(e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT)s=t;else if(e===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT)s.x=t.x,s.y=r.height-t.y;else if(e===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT)s.x=r.width-t.x,s.y=r.height-t.y;else if(e===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT)s.x=r.width-t.x,s.y=t.y;else if(e===CCB_POSITIONTYPE_PERCENT)s.x=r.width*t.x/100,s.y=r.height*t.y/100;else if(e===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var o=exports.cc.BuilderReader.getResolutionScale();s.x=t.x*o,s.y=t.y*o}return s};exports.cc._getAbsolutePosition=function(t,e,r,n,s){var o=exports.cc.p(0,0);if(r===CCB_POSITIONTYPE_RELATIVE_BOTTOM_LEFT)o.x=t,o.y=e;else if(r===CCB_POSITIONTYPE_RELATIVE_TOP_LEFT)o.x=t,o.y=n.height-e;else if(r===CCB_POSITIONTYPE_RELATIVE_TOP_RIGHT)o.x=n.width-t,o.y=n.height-e;else if(r===CCB_POSITIONTYPE_RELATIVE_BOTTOM_RIGHT)o.x=n.width-t,o.y=e;else if(r===CCB_POSITIONTYPE_PERCENT)o.x=n.width*t/100,o.y=n.height*e/100;else if(r===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var a=exports.cc.BuilderReader.getResolutionScale();o.x=t*a,o.y=e*a}return o};exports.cc.setRelativeScale=function(t,e,r,n,s){if(!t)throw new Error("cc.setRelativeScale(): node should be non-null");if(n===CCB_POSITIONTYPE_MULTIPLY_RESOLUTION){var o=exports.cc.BuilderReader.getResolutionScale();e*=o,r*=o}t.setScaleX(e),t.setScaleY(r)};exports.cc.BuilderAnimationManagerDelegate=exports.cc.Class.extend({completedAnimationSequenceNamed:function(t){}});exports.cc.BuilderAnimationManager=exports.cc.Class.extend({_sequences:null,_nodeSequences:null,_baseValues:null,_autoPlaySequenceId:0,_rootNode:null,_owner:null,_rootContainerSize:null,_delegate:null,_runningSequence:null,_documentOutletNames:null,_documentOutletNodes:null,_documentCallbackNames:null,_documentCallbackNodes:null,_documentCallbackControlEvents:null,_documentControllerName:"",_lastCompletedSequenceName:"",_keyframeCallbacks:null,_keyframeCallFuncs:null,_animationCompleteCallbackFunc:null,_target:null,_jsControlled:!1,ctor:function(){this._rootContainerSize=exports.cc.size(0,0),this.init()},init:function(){return this._sequences=[],this._nodeSequences=new exports.cc._Dictionary,this._baseValues=new exports.cc._Dictionary,this._documentOutletNames=[],this._documentOutletNodes=[],this._documentCallbackNames=[],this._documentCallbackNodes=[],this._documentCallbackControlEvents=[],this._keyframeCallbacks=[],this._keyframeCallFuncs={},!0},getSequences:function(){return this._sequences},setSequences:function(t){this._sequences=t},getAutoPlaySequenceId:function(){return this._autoPlaySequenceId},setAutoPlaySequenceId:function(t){this._autoPlaySequenceId=t},getRootNode:function(){return this._rootNode},setRootNode:function(t){this._rootNode=t},getOwner:function(){return this._owner},setOwner:function(t){this._owner=t},addDocumentCallbackNode:function(t){this._documentCallbackNodes.push(t)},addDocumentCallbackName:function(t){this._documentCallbackNames.push(t)},addDocumentCallbackControlEvents:function(t){this._documentCallbackControlEvents.push(t)},addDocumentOutletNode:function(t){this._documentOutletNodes.push(t)},addDocumentOutletName:function(t){this._documentOutletNames.push(t)},setDocumentControllerName:function(t){this._documentControllerName=t},getDocumentControllerName:function(){return this._documentControllerName},getDocumentCallbackNames:function(){return this._documentCallbackNames},getDocumentCallbackNodes:function(){return this._documentCallbackNodes},getDocumentCallbackControlEvents:function(){return this._documentCallbackControlEvents},getDocumentOutletNames:function(){return this._documentOutletNames},getDocumentOutletNodes:function(){return this._documentOutletNodes},getLastCompletedSequenceName:function(){return this._lastCompletedSequenceName},getKeyframeCallbacks:function(){return this._keyframeCallbacks},getRootContainerSize:function(){return this._rootContainerSize},setRootContainerSize:function(t){this._rootContainerSize=exports.cc.size(t.width,t.height)},getDelegate:function(){return this._delegate},setDelegate:function(t){this._delegate=t},getRunningSequenceName:function(){return this._runningSequence?this._runningSequence.getName():null},getContainerSize:function(t){return t?t.getContentSize():this._rootContainerSize},addNode:function(t,e){this._nodeSequences.setObject(e,t)},setBaseValue:function(t,e,r){var n=this._baseValues.objectForKey(e);n||(n=new exports.cc._Dictionary,this._baseValues.setObject(n,e)),n.setObject(t,r)},moveAnimationsFromNode:function(t,e){var r=this._baseValues,n=r.objectForKey(t);n!==null&&(r.setObject(n,e),r.removeObjectForKey(t));var s=this._nodeSequences,o=s.objectForKey(t);o!=null&&(s.setObject(o,e),s.removeObjectForKey(t))},getActionForCallbackChannel:function(t){for(var e=0,r=[],n=t.getKeyframes(),s=n.length,o=0;o<s;++o){var a=n[o],c=a.getTime()-e;e=a.getTime(),c>0&&r.push(exports.cc.delayTime(c));var l=a.getValue(),h=l[0],u=l[1];if(this._jsControlled){var _=u+":"+h,d=this._keyframeCallFuncs[_];d!=null&&r.push(d)}else{var f;if(u===CCB_TARGETTYPE_DOCUMENTROOT?f=this._rootNode:u===CCB_TARGETTYPE_OWNER&&(f=this._owner),f!=null)if(h.length>0){var T=0;f.onResolveCCBCCCallFuncSelector!=null&&(T=f.onResolveCCBCCCallFuncSelector(f,h)),T===0?exports.cc.log("Skipping selector '"+h+"' since no CCBSelectorResolver is present."):r.push(exports.cc.callFunc(T,f))}else exports.cc.log("Unexpected empty selector.")}}return r.length<1?null:exports.cc.sequence(r)},getActionForSoundChannel:function(t){for(var e=0,r=[],n=t.getKeyframes(),s=n.length,o=0;o<s;++o){var a=n[o],c=a.getTime()-e;e=a.getTime(),c>0&&r.push(exports.cc.delayTime(c));var l=a.getValue(),h=exports.cc.BuilderReader.getResourcePath()+l[0],u=parseFloat(l[1]),_=parseFloat(l[2]),d=parseFloat(l[3]);r.push(exports.cc.BuilderSoundEffect.create(h,u,_,d))}return r.length<1?null:exports.cc.sequence(r)},runAnimationsForSequenceNamed:function(t){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),0)},runAnimationsForSequenceNamedTweenDuration:function(t,e){this.runAnimationsForSequenceIdTweenDuration(this._getSequenceId(t),e)},runAnimationsForSequenceIdTweenDuration:function(t,e){if(t===-1)throw new Error("cc.BuilderAnimationManager.runAnimationsForSequenceIdTweenDuration(): Sequence id should not be -1");e=e||0,this._rootNode.stopAllActions();for(var r=this._nodeSequences.allKeys(),n=0,s=r.length;n<s;n++){var o=r[n];o.stopAllActions();var a=this._nodeSequences.objectForKey(o),c=a.objectForKey(t),l,h=[];if(c){var u=c.allKeys();for(l=0;l<u.length;l++){var _=u[l],d=c.objectForKey(_);h.push(_),this._setFirstFrame(o,d,e),this._runAction(o,d,e)}}var f=this._baseValues.objectForKey(o);if(f){var T=f.allKeys();for(l=0;l<T.length;l++){var x=T[l];if(h.indexOf(x)===-1){var m=f.objectForKey(x);m!=null&&this._setAnimatedProperty(x,o,m,e)}}}}var v=this._getSequence(t),A=exports.cc.sequence(exports.cc.delayTime(v.getDuration()+e),exports.cc.callFunc(this._sequenceCompleted,this));this._rootNode.runAction(A);var D;v.getCallbackChannel()&&(D=this.getActionForCallbackChannel(v.getCallbackChannel()),D&&this._rootNode.runAction(D)),v.getSoundChannel()&&(D=this.getActionForSoundChannel(v.getSoundChannel()),D&&this._rootNode.runAction(D)),this._runningSequence=this._getSequence(t)},runAnimations:function(t,e){e=e||0;var r;exports.cc.isString(t)?r=this._getSequenceId(t):r=t,this.runAnimationsForSequenceIdTweenDuration(r,e)},setAnimationCompletedCallback:function(t,e){this._target=t,this._animationCompleteCallbackFunc=e},setCompletedAnimationCallback:function(t,e){this.setAnimationCompletedCallback(t,e)},setCallFunc:function(t,e){this._keyframeCallFuncs[e]=t},debug:function(){},_getBaseValue:function(t,e){var r=this._baseValues.objectForKey(t);return r?r.objectForKey(e):null},_getSequenceId:function(t){for(var e=null,r=this._sequences,n=0,s=r.length;n<s;n++)if(e=r[n],e&&e.getName()===t)return e.getSequenceId();return-1},_getSequence:function(t){for(var e=null,r=this._sequences,n=0,s=r.length;n<s;n++)if(e=r[n],e&&e.getSequenceId()===t)return e;return null},_getAction:function(t,e,r,n){var s=e.getTime()-(t?t.getTime():0),o,a,c,l,h;if(r==="rotation")return exports.cc.BuilderRotateTo.create(s,e.getValue());if(r==="rotationX")return exports.cc.BuilderRotateXTo.create(s,e.getValue());if(r==="rotationY")return exports.cc.BuilderRotateYTo.create(s,e.getValue());if(r==="opacity")return exports.cc.fadeTo(s,e.getValue());if(r==="color"){var u=e.getValue().getColor();return exports.cc.tintTo(s,u.r,u.g,u.b)}else if(r==="visible"){var _=e.getValue();return _?exports.cc.sequence(exports.cc.delayTime(s),exports.cc.show()):exports.cc.sequence(exports.cc.delayTime(s),exports.cc.hide())}else{if(r==="displayFrame")return exports.cc.sequence(exports.cc.delayTime(s),exports.cc.BuilderSetSpriteFrame.create(e.getValue()));if(r==="position"){o=this._getBaseValue(n,r),a=o[2],c=e.getValue(),l=c[0],h=c[1];var d=this.getContainerSize(n.getParent()),f=exports.cc._getAbsolutePosition(l,h,a,d,r);return exports.cc.moveTo(s,f)}else if(r==="scale"){if(o=this._getBaseValue(n,r),a=o[2],c=e.getValue(),l=c[0],h=c[1],a===CCB_SCALETYPE_MULTIPLY_RESOLUTION){var T=exports.cc.BuilderReader.getResolutionScale();l*=T,h*=T}return exports.cc.scaleTo(s,l,h)}else{if(r==="skew")return c=e.getValue(),l=c[0],h=c[1],exports.cc.skewTo(s,l,h);exports.cc.log("BuilderReader: Failed to create animation for property: "+r)}}return null},_setAnimatedProperty:function(t,e,r,n){if(n>0){var s=new exports.cc.BuilderKeyframe;s.setValue(r),s.setTime(n),s.setEasingType(CCB_KEYFRAME_EASING_LINEAR);var o=this._getAction(null,s,t,e);e.runAction(o)}else{var a,c,l,h;if(t==="position")a=this._getBaseValue(e,t),c=a[2],l=r[0],h=r[1],e.setPosition(exports.cc._getAbsolutePosition(l,h,c,this.getContainerSize(e.getParent()),t));else if(t==="scale")a=this._getBaseValue(e,t),c=a[2],l=r[0],h=r[1],exports.cc.setRelativeScale(e,l,h,c,t);else if(t==="skew")l=r[0],h=r[1],e.setSkewX(l),e.setSkewY(h);else if(t==="rotation")e.setRotation(r);else if(t==="rotationX")e.setRotationSkewX(r);else if(t==="rotationY")e.setRotationSkewY(r);else if(t==="opacity")e.setOpacity(r);else if(t==="displayFrame")e.setSpriteFrame(r);else if(t==="color"){var u=r.getColor();(u.r!==255||u.g!==255||u.b!==255)&&e.setColor(u)}else t==="visible"?(r=r||!1,e.setVisible(r)):exports.cc.log("unsupported property name is "+t)}},_setFirstFrame:function(t,e,r){var n=e.getKeyframes();if(n.length===0){var s=this._getBaseValue(t,e.getName());s||exports.cc.log("cc.BuilderAnimationManager._setFirstFrame(): No baseValue found for property"),this._setAnimatedProperty(e.getName(),t,s,r)}else{var o=n[0];this._setAnimatedProperty(e.getName(),t,o.getValue(),r)}},_getEaseAction:function(t,e,r){return e===CCB_KEYFRAME_EASING_LINEAR||e===CCB_KEYFRAME_EASING_INSTANT?t:e===CCB_KEYFRAME_EASING_CUBIC_IN?t.easing(exports.cc.easeIn(r)):e===CCB_KEYFRAME_EASING_CUBIC_OUT?t.easing(exports.cc.easeOut(r)):e===CCB_KEYFRAME_EASING_CUBIC_INOUT?t.easing(exports.cc.easeInOut(r)):e===CCB_KEYFRAME_EASING_BACK_IN?t.easing(exports.cc.easeBackIn()):e===CCB_KEYFRAME_EASING_BACK_OUT?t.easing(exports.cc.easeBackOut()):e===CCB_KEYFRAME_EASING_BACK_INOUT?t.easing(exports.cc.easeBackInOut()):e===CCB_KEYFRAME_EASING_BOUNCE_IN?t.easing(exports.cc.easeBounceIn()):e===CCB_KEYFRAME_EASING_BOUNCE_OUT?t.easing(exports.cc.easeBounceOut()):e===CCB_KEYFRAME_EASING_BOUNCE_INOUT?t.easing(exports.cc.easeBounceInOut()):e===CCB_KEYFRAME_EASING_ELASTIC_IN?t.easing(exports.cc.easeElasticIn(r)):e===CCB_KEYFRAME_EASING_ELASTIC_OUT?t.easing(exports.cc.easeElasticOut(r)):e===CCB_KEYFRAME_EASING_ELASTIC_INOUT?t.easing(exports.cc.easeElasticInOut(r)):(exports.cc.log("BuilderReader: Unknown easing type "+e),t)},_runAction:function(t,e,r){var n=e.getKeyframes(),s=n.length;if(s>1){var o=[],a=n[0],c=a.getTime()+r;c>0&&o.push(exports.cc.delayTime(c));for(var l=0;l<s-1;++l){var h=n[l],u=n[l+1],_=this._getAction(h,u,e.getName(),t);_&&(_=this._getEaseAction(_,h.getEasingType(),h.getEasingOpt()),o.push(_))}t.runAction(exports.cc.sequence(o))}},_sequenceCompleted:function(){var t=this._runningSequence,e=t.getName();this._lastCompletedSequenceName!=t.getName()&&(this._lastCompletedSequenceName=t.getName());var r=t.getChainedSequenceId();this._runningSequence=null,r!==-1&&this.runAnimations(r,0),this._delegate&&this._delegate.completedAnimationSequenceNamed(e),this._target&&this._animationCompleteCallbackFunc&&this._animationCompleteCallbackFunc.call(this._target)}});exports.cc.BuilderSetSpriteFrame=exports.cc.ActionInstant.extend({_spriteFrame:null,initWithSpriteFrame:function(t){return this._spriteFrame=t,!0},update:function(t){this.target.setSpriteFrame(this._spriteFrame)}});exports.cc.BuilderSetSpriteFrame.create=function(t){var e=new exports.cc.BuilderSetSpriteFrame;return e&&e.initWithSpriteFrame(t)?e:null};exports.cc.BuilderRotateTo=exports.cc.ActionInterval.extend({_startAngle:0,_dstAngle:0,_diffAngle:0,initWithDuration:function(t,e){return exports.cc.ActionInterval.prototype.initWithDuration.call(this,t)?(this._dstAngle=e,!0):!1},update:function(t){this.target.setRotation(this._startAngle+this._diffAngle*t)},startWithTarget:function(t){exports.cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngle=this.target.getRotation(),this._diffAngle=this._dstAngle-this._startAngle}});exports.cc.BuilderRotateTo.create=function(t,e){var r=new exports.cc.BuilderRotateTo;return r&&r.initWithDuration(t,e)?r:null};exports.cc.BuilderRotateXTo=exports.cc.ActionInterval.extend({});exports.cc.BuilderRotateXTo.create=function(t,e){throw new Error("rotationX has not been implemented in cocos2d-html5")};exports.cc.BuilderRotateYTo=exports.cc.ActionInterval.extend({});exports.cc.BuilderRotateYTo.create=function(t,e){throw new Error("rotationY has not been implemented in cocos2d-html5")};exports.cc.BuilderSoundEffect=exports.cc.ActionInstant.extend({init:function(t){return this._file=t,!0},update:function(t){exports.cc.audioEngine.playEffect(this._file)}});exports.cc.BuilderSoundEffect.create=function(t,e,r,n){var s=new exports.cc.BuilderSoundEffect;return s&&s.init(t)?s:null};exports.cc.DOM={};exports.cc.DOM._addMethods=function(t){for(var e in exports.cc.DOM.methods)t[e]=exports.cc.DOM.methods[e];exports.cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),exports.cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),exports.cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),exports.cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),exports.cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),exports.cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),exports.cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),exports.cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),exports.cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),exports.cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),exports.cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),exports.cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),exports.cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),exports.cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),exports.cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity)};exports.cc.DOM.methods={setPosition:function(t,e){e===void 0?(this._position.x=t.x,this._position.y=t.y):(this._position.x=t,this._position.y=e),this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionY:function(t){this._position.y=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setPositionX:function(t){this._position.x=t,this.setNodeDirty(),this.dom.translates(this._position.x,-this._position.y)},setScale:function(t,e){this._scaleX=t,this._scaleY=e||t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleX:function(t){this._scaleX=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setScaleY:function(t){this._scaleY=t,this.setNodeDirty(),this.dom.resize(this._scaleX,this._scaleY)},setAnchorPoint:function(t,e){var r=this._renderCmd,n=this._anchorPoint;e===void 0?(n.x=t.x,n.y=t.y):(n.x=t,n.y=e);var s=r._anchorPointInPoints,o=this._contentSize;s.x=o.width*n.x,s.y=o.height*n.y,this.dom.style[exports.cc.$.pfx+"TransformOrigin"]=""+s.x+"px "+-s.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):(this.dom.style.marginLeft=this.isToggler?0:-s.x+"px",this.dom.style.marginBottom=-s.y+"px"),this.setNodeDirty()},_setAnchorX:function(t){var e=this._anchorPoint,r=this._renderCmd;if(t!==e.x){e.x=t;var n=r._anchorPointInPoints,s=this._contentSize;n.x=s.width*e.x,this.dom.style[exports.cc.$.pfx+"TransformOrigin"]=""+n.x+"px "+-n.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginLeft=this.isToggler?0:-n.x+"px",this.setNodeDirty()}},_setAnchorY:function(t){var e=this._anchorPoint,r=this._renderCmd;if(t!==e.y){e.y=t;var n=r._anchorPointInPoints,s=this._contentSize;n.y=s.height*e.y,this.dom.style[exports.cc.$.pfx+"TransformOrigin"]=""+n.x+"px "+-n.y+"px",this.ignoreAnchor?(this.dom.style.marginLeft=0,this.dom.style.marginBottom=0):this.dom.style.marginBottom=-n.y+"px",this.setNodeDirty()}},setContentSize:function(t,e){var r=this._renderCmd,n=this._contentSize;e===void 0?(n.width=t.width,n.height=t.height):(n.width=t,n.height=e);var s=r._anchorPointInPoints,o=this._anchorPoint;s.x=n.width*o.x,s.y=n.height*o.y,this.dom.width=n.width,this.dom.height=n.height,this.setAnchorPoint(this.getAnchorPoint()),this.canvas&&(this.canvas.width=n.width,this.canvas.height=n.height),this.setNodeDirty(),this.redraw()},_setWidth:function(t){var e=this._contentSize,r=this._renderCmd;if(t!==e.width){e.width=t;var n=r._anchorPointInPoints,s=this._anchorPoint;n.x=e.width*s.x,this.dom.width=e.width,this.anchorX=s.x,this.canvas&&(this.canvas.width=e.width),this.setNodeDirty(),this.redraw()}},_setHeight:function(t){var e=this._contentSize,r=this._renderCmd;if(t!==e.height){e.height=t;var n=r._anchorPointInPoints,s=this._anchorPoint;n.y=e.height*s.y,this.dom.height=e.height,this.anchorY=s.y,this.canvas&&(this.canvas.height=e.height),this.setNodeDirty(),this.redraw()}},setRotation:function(t){this._rotation!==t&&(this._rotationX=this._rotationY=t,this.setNodeDirty(),this.dom.rotate(t))},setSkewX:function(t){this._skewX=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setSkewY:function(t){this._skewY=t,this.setNodeDirty(),this.dom.setSkew(this._skewX,this._skewY)},setVisible:function(t){this._visible=t,this.setNodeDirty(),this.dom&&(this.dom.style.display=t?"block":"none")},_setLocalZOrder:function(t){this._localZOrder=t,this.setNodeDirty(),this.dom&&(this.dom.zIndex=t)},setParent:function(t){this._parent=t,t!==null&&(t.setAnchorPoint(t.getAnchorPoint()),this.setNodeDirty(),exports.cc.DOM.parentDOM(this))},resume:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this),exports.cc.eventManager.resumeTarget(this),this.dom&&!this.dom.parentNode&&(this.getParent()?exports.cc.DOM.parentDOM(this):this.dom.id===""?exports.cc.DOM._createEGLViewDiv(this):this.dom.appendTo(exports.cc.container)),this.dom&&(this.dom.style.visibility="visible")},pause:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this),exports.cc.eventManager.pauseTarget(this),this.dom&&(this.dom.style.visibility="hidden")},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),exports.cc.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,exports.cc.Node._stateCallbackType.cleanup),this.dom&&this.dom.remove()},setOpacity:function(t){this._opacity=t,this.dom.style.opacity=t/255},redraw:function(){if(this.isSprite){var t=this._children;this._children=[],exports.cc.Sprite.prototype.visit.call(this,this.ctx),this._children=t}else exports.cc.Sprite.prototype.visit.call(this,this.ctx)}};exports.cc.DOM._resetEGLViewDiv=function(){var t=exports.cc.$("#EGLViewDiv");if(t){var e=exports.cc.view,r=e.getDesignResolutionSize(),n=e.getViewPortRect(),s=e.getFrameSize(),o=e.getDevicePixelRatio(),a=r.width,c=r.height,l=parseInt(exports.cc.container.style.paddingLeft),h=parseInt(exports.cc.container.style.paddingBottom);r.width===0&&r.height===0&&(a=s.width,c=s.height),n.width/o,n.width===0&&n.height===0&&s.width,t.style.position="absolute",t.style.width=a+"px",t.style.maxHeight=c+"px",t.style.margin=0,t.resize(e.getScaleX()/o,e.getScaleY()/o),t.translates(l,-h),e.getResolutionPolicy()===e._rpNoBorder?(t.style.left=(e.getFrameSize().width-a)/2+"px",t.style.bottom=(e.getFrameSize().height-c*e.getScaleY()/o)/2+"px"):(t.style.left=(a*e.getScaleX()/o-a)/2+"px",t.style.bottom="0px")}};exports.cc.DOM.parentDOM=function(t){var e=t.getParent();if(!e||!t.dom)return!1;if(e.dom||(exports.cc.DOM.placeHolder(e),e.setParent=exports.cc.DOM.methods.setParent),t.dom.appendTo(e.dom),e.setAnchorPoint(e.getAnchorPoint()),e.getParent())exports.cc.DOM.parentDOM(e);else if(e.isRunning()){var r=exports.cc.$("#EGLViewDiv");r?e.dom.appendTo(r):exports.cc.DOM._createEGLViewDiv(e)}return!0};exports.cc.DOM._createEGLViewDiv=function(t){var e=exports.cc.$("#EGLViewDiv");e||(e=exports.cc.$new("div"),e.id="EGLViewDiv");var r=exports.cc.view,n=r.getDesignResolutionSize(),s=r.getViewPortRect(),o=r.getFrameSize(),a=r.getDevicePixelRatio(),c=n.width,l=n.height,h=parseInt(exports.cc.container.style.paddingLeft),u=parseInt(exports.cc.container.style.paddingBottom);n.width===0&&n.height===0&&(c=o.width,l=o.height),s.width/a,s.width===0&&s.height===0&&o.width,e.style.position="absolute",e.style.width=c+"px",e.style.maxHeight=l+"px",e.style.margin=0,e.resize(r.getScaleX()/a,r.getScaleY()/a),e.translates(h,-u),r.getResolutionPolicy()===r._rpNoBorder?(e.style.left=(o.width-c)/2+"px",e.style.bottom=(o.height-l*r.getScaleY()/a)/2+"px"):(e.style.left=(c*r.getScaleX()/a-c)/2+"px",e.style.bottom="0px"),t.dom.appendTo(e),e.appendTo(exports.cc.container)};exports.cc.DOM.setTransform=function(t){if(t.ctx)if(t.ctx.translate(t.getAnchorPointInPoints().x,t.getAnchorPointInPoints().y),t.isSprite){var e=t._children;t._children=[],exports.cc.Sprite.prototype.visit.call(t),t._children=e}else exports.cc.Sprite.prototype.visit.call(t);t.dom&&(t.dom.position.x=t.getPositionX(),t.dom.position.y=-t.getPositionY(),t.dom.rotation=t.getRotation(),t.dom.scale={x:t.getScaleX(),y:t.getScaleY()},t.dom.skew={x:t.getSkewX(),y:t.getSkewY()},t.setAnchorPoint&&t.setAnchorPoint(t.getAnchorPoint()),t.dom.transforms())};exports.cc.DOM.forSprite=function(t){t.dom=exports.cc.$new("div"),t.canvas=exports.cc.$new("canvas");var e=t.getContentSize();t.canvas.width=e.width,t.canvas.height=e.height,t.dom.style.position="absolute",t.dom.style.bottom=0,t.ctx=t.canvas.getContext("2d"),t.dom.appendChild(t.canvas),t.getParent()&&exports.cc.DOM.parentDOM(t),t.isSprite=!0};exports.cc.DOM.placeHolder=function(t){t.dom=exports.cc.$new("div"),t.placeholder=!0,t.dom.style.position="absolute",t.dom.style.bottom=0,t.dom.style.width=(t.getContentSize().width||exports.cc.director.getWinSize().width)+"px",t.dom.style.maxHeight=(t.getContentSize().height||exports.cc.director.getWinSize().height)+"px",t.dom.style.margin=0,exports.cc.DOM.setTransform(t),t.dom.transforms(),exports.cc.DOM._addMethods(t)};exports.cc.DOM.convert=function(t){if(arguments.length>1){exports.cc.DOM.convert(arguments);return}else if(arguments.length===1&&!arguments[0].length){exports.cc.DOM.convert([arguments[0]]);return}for(var e=arguments[0],r=0;r<e.length;r++)e[r]instanceof exports.cc.Sprite?e[r].dom||exports.cc.DOM.forSprite(e[r]):exports.cc.log("DOM converter only supports sprite and menuitems yet"),exports.cc.DOM._addMethods(e[r]),e[r].visit=function(){},e[r].transform=function(){},exports.cc.DOM.setTransform(e[r]),e[r].setVisible(e[r].isVisible())};exports.cc.KEYBOARD_RETURNTYPE_DEFAULT=0;exports.cc.KEYBOARD_RETURNTYPE_DONE=1;exports.cc.KEYBOARD_RETURNTYPE_SEND=2;exports.cc.KEYBOARD_RETURNTYPE_SEARCH=3;exports.cc.KEYBOARD_RETURNTYPE_GO=4;exports.cc.EDITBOX_INPUT_MODE_ANY=0;exports.cc.EDITBOX_INPUT_MODE_EMAILADDR=1;exports.cc.EDITBOX_INPUT_MODE_NUMERIC=2;exports.cc.EDITBOX_INPUT_MODE_PHONENUMBER=3;exports.cc.EDITBOX_INPUT_MODE_URL=4;exports.cc.EDITBOX_INPUT_MODE_DECIMAL=5;exports.cc.EDITBOX_INPUT_MODE_SINGLELINE=6;exports.cc.EDITBOX_INPUT_FLAG_PASSWORD=0;exports.cc.EDITBOX_INPUT_FLAG_SENSITIVE=1;exports.cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2;exports.cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3;exports.cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4;exports.cc.EditBoxDelegate=exports.cc.Class.extend({editBoxEditingDidBegin:function(t){},editBoxEditingDidEnd:function(t){},editBoxTextChanged:function(t,e){},editBoxReturn:function(t){}});exports.cc.EditBox=exports.cc.ControlButton.extend({_domInputSprite:null,_delegate:null,_editBoxInputMode:exports.cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:exports.cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:exports.cc.KEYBOARD_RETURNTYPE_DEFAULT,_text:"",_placeholderText:"",_textColor:null,_placeholderColor:null,_maxLength:50,_adjustHeight:18,_edTxt:null,_edFontSize:14,_edFontName:"Arial",_placeholderFontName:"",_placeholderFontSize:14,_tooltip:!1,_className:"EditBox",_onCanvasClick:null,_inputEvent:null,_keyPressEvent:null,_focusEvent:null,_blurEvent:null,ctor:function(t,e,r,n){exports.cc.ControlButton.prototype.ctor.call(this),this._textColor=exports.cc.color.WHITE,this._placeholderColor=exports.cc.color.GRAY,this.setContentSize(t);var s=this._domInputSprite=new exports.cc.Sprite;s.draw=function(){},this.addChild(s);var o=this._edTxt=document.createElement("input");o.type="text",o.style.fontSize=this._edFontSize+"px",o.style.color="#000000",o.style.border=0,o.style.background="transparent",o.style.width="100%",o.style.height="100%",o.style.active=0,o.style.outline="medium",o.style.padding="0";var a=function(){this._edTxt.blur()};this._onCanvasClick=a.bind(this);var c=function(){this._delegate&&this._delegate.editBoxTextChanged&&this._delegate.editBoxTextChanged(this,this._edTxt.value)};this._inputEvent=c.bind(this);var l=function(_){_.keyCode===exports.cc.KEY.enter&&(_.stopPropagation(),_.preventDefault(),this._delegate&&this._delegate.editBoxReturn&&this._delegate.editBoxReturn(this),exports.cc._canvas.focus())};this._keyPressEvent=l.bind(this);var h=function(){this._edTxt.value===this._placeholderText&&(this._edTxt.value="",this._edTxt.style.fontSize=this._edFontSize+"px",this._edTxt.style.color=exports.cc.colorToHex(this._textColor),this._editBoxInputFlag===exports.cc.EDITBOX_INPUT_FLAG_PASSWORD?this._edTxt.type="password":this._edTxt.type="text"),this._delegate&&this._delegate.editBoxEditingDidBegin&&this._delegate.editBoxEditingDidBegin(this),exports.cc._canvas.addEventListener("click",this._onCanvasClick)};this._focusEvent=h.bind(this);var u=function(){this._edTxt.value===""&&(this._edTxt.value=this._placeholderText,this._edTxt.style.fontSize=this._placeholderFontSize+"px",this._edTxt.style.color=exports.cc.colorToHex(this._placeholderColor),this._edTxt.type="text"),this._delegate&&this._delegate.editBoxEditingDidEnd&&this._delegate.editBoxEditingDidEnd(this),exports.cc._canvas.removeEventListener("click",this._onCanvasClick)};this._blurEvent=u.bind(this),o.addEventListener("input",this._inputEvent),o.addEventListener("keypress",this._keyPressEvent),o.addEventListener("focus",this._focusEvent),o.addEventListener("blur",this._blurEvent),exports.cc.DOM.convert(s),s.dom.appendChild(o),s.dom.showTooltipDiv=!1,s.dom.style.width=t.width-6+"px",s.dom.style.height=t.height-6+"px",s.canvas.remove(),this.initWithSizeAndBackgroundSprite(t,e)&&(r&&this.setBackgroundSpriteForState(r,exports.cc.CONTROL_STATE_HIGHLIGHTED),n&&this.setBackgroundSpriteForState(n,exports.cc.CONTROL_STATE_DISABLED))},setFont:function(t,e){this._edFontSize=e,this._edFontName=t,this._setFontToEditBox()},_setFont:function(t){var e=exports.cc.LabelTTF._fontStyleRE.exec(t);e&&(this._edFontSize=parseInt(e[1]),this._edFontName=e[2],this._setFontToEditBox())},setFontName:function(t){this._edFontName=t,this._setFontToEditBox()},setFontSize:function(t){this._edFontSize=t,this._setFontToEditBox()},_setFontToEditBox:function(){this._edTxt.value!==this._placeholderText&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px",this._editBoxInputFlag===exports.cc.EDITBOX_INPUT_FLAG_PASSWORD?this._edTxt.type="password":this._edTxt.type="text")},setText:function(t){exports.cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!=null&&(t===""?(this._edTxt.value=this._placeholderText,this._edTxt.style.color=exports.cc.colorToHex(this._placeholderColor),this._edTxt.type="text"):(this._edTxt.value=t,this._edTxt.style.color=exports.cc.colorToHex(this._textColor),this._editBoxInputFlag===exports.cc.EDITBOX_INPUT_FLAG_PASSWORD?this._edTxt.type="password":this._edTxt.type="text"))},setFontColor:function(t){this._textColor=t,this._edTxt.value!==this._placeholderText&&(this._edTxt.style.color=exports.cc.colorToHex(t))},setMaxLength:function(t){!isNaN(t)&&t>0&&(this._maxLength=t,this._edTxt.maxLength=t)},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){if(t!=null){var e=this._placeholderText;this._placeholderText=t,this._edTxt.value===e&&(this._edTxt.value=t,this._edTxt.style.color=exports.cc.colorToHex(this._placeholderColor),this._setPlaceholderFontToEditText())}},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._setPlaceholderFontToEditText()},_setPlaceholderFont:function(t){var e=exports.cc.LabelTTF._fontStyleRE.exec(t);e&&(this._placeholderFontName=e[2],this._placeholderFontSize=parseInt(e[1]),this._setPlaceholderFontToEditText())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._setPlaceholderFontToEditText()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._setPlaceholderFontToEditText()},_setPlaceholderFontToEditText:function(){this._edTxt.value===this._placeholderText&&(this._edTxt.style.fontFamily=this._placeholderFontName,this._edTxt.style.fontSize=this._placeholderFontSize+"px",this._edTxt.type="text")},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._edTxt.value===this._placeholderText&&(this._edTxt.style.color=exports.cc.colorToHex(t))},setInputFlag:function(t){this._editBoxInputFlag=t,this._edTxt.value!==this._placeholderText&&t===exports.cc.EDITBOX_INPUT_FLAG_PASSWORD?this._edTxt.type="password":this._edTxt.type="text"},getText:function(){return exports.cc.log("Please use the getString"),this._edTxt.value},getString:function(){return this._edTxt.value===this._placeholderText?"":this._edTxt.value},initWithSizeAndBackgroundSprite:function(t,e){return this.initWithBackgroundSprite(e)?(this._domInputSprite.x=3,this._domInputSprite.y=3,this.setZoomOnTouchDown(!1),this.setPreferredSize(t),this.x=0,this.y=0,this._addTargetWithActionForControlEvent(this,this.touchDownAction,exports.cc.CONTROL_EVENT_TOUCH_UP_INSIDE),!0):!1},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){this._editBoxInputMode=t},setReturnType:function(t){this._keyboardReturnType=t},keyboardWillShow:function(t){var e=exports.cc.EditBox.getRect(this);if(e.y-=4,!e.intersectsRect(t.end)){exports.cc.log("needn't to adjust view layout.");return}this._adjustHeight=t.end.getMaxY()-e.getMinY()},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){},touchDownAction:function(t,e){},initWithBackgroundColor:function(t,e){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=exports.cc.colorToHex(e)},cleanup:function(){this._edTxt.removeEventListener("input",this._inputEvent),this._edTxt.removeEventListener("keypress",this._keyPressEvent),this._edTxt.removeEventListener("focus",this._focusEvent),this._edTxt.removeEventListener("blur",this._blurEvent),exports.cc._canvas.removeEventListener("click",this._onCanvasClick),this._super()}});var _p=exports.cc.EditBox.prototype;_p.font;exports.cc.defineGetterSetter(_p,"font",null,_p._setFont);_p.fontName;exports.cc.defineGetterSetter(_p,"fontName",null,_p.setFontName);_p.fontSize;exports.cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize);_p.fontColor;exports.cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor);_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.maxLength;exports.cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);_p.placeHolder;exports.cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);_p.placeHolderFont;exports.cc.defineGetterSetter(_p,"placeHolderFont",null,_p._setPlaceholderFont);_p.placeHolderFontName;exports.cc.defineGetterSetter(_p,"placeHolderFontName",null,_p.setPlaceholderFontName);_p.placeHolderFontSize;exports.cc.defineGetterSetter(_p,"placeHolderFontSize",null,_p.setPlaceholderFontSize);_p.placeHolderFontColor;exports.cc.defineGetterSetter(_p,"placeHolderFontColor",null,_p.setPlaceholderFontColor);_p.inputFlag;exports.cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag);_p.delegate;exports.cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate);_p.inputMode;exports.cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode);_p.returnType;exports.cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType);_p=null;exports.cc.EditBox.getRect=function(t){var e=t.getContentSize(),r=exports.cc.rect(0,0,e.width,e.height);return exports.cc.rectApplyAffineTransform(r,t.getNodeToWorldTransform())};exports.cc.EditBox.create=function(t,e,r,n){return new exports.cc.EditBox(t,e,r,n)};exports.cc.ProtectedNode=exports.cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(t),t._setLocalZOrder(e)},ctor:function(){exports.cc.Node.prototype.ctor.call(this),this._protectedChildren=[]},addProtectedChild:function(t,e,r){exports.cc.assert(t!=null,"child must be non-nil"),exports.cc.assert(!t.parent,"child already added. It can't be added again"),e=e||t.getLocalZOrder(),r&&t.setTag(r),this._insertProtectedChild(t,e),t.setParent(this),t.setOrderOfArrival(exports.cc.s_globalOrderOfArrival),this._running&&(t.onEnter(),this._isTransitionFinished&&t.onEnterTransitionDidFinish()),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){exports.cc.assert(t!==exports.cc.NODE_TAG_INVALID,"Invalid tag");for(var e=this._protectedChildren,r=0,n=e.length;r<n;r++)if(e.getTag()===t)return e[r];return null},removeProtectedChild:function(t,e){e==null&&(e=!0);var r=this._protectedChildren;if(r.length!==0){var n=r.indexOf(t);n>-1&&(this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.setParent(null),r.splice(n,1))}},removeProtectedChildByTag:function(t,e){exports.cc.assert(t!==exports.cc.NODE_TAG_INVALID,"Invalid tag"),e==null&&(e=!0);var r=this.getProtectedChildByTag(t);r==null?exports.cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",t):this.removeProtectedChild(r,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(t){t==null&&(t=!0);for(var e=this._protectedChildren,r=0,n=e.length;r<n;r++){var s=e[r];this._running&&(s.onExitTransitionDidStart(),s.onExit()),t&&s.cleanup(),s.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){exports.cc.assert(t!=null,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,t.setOrderOfArrival(exports.cc.s_globalOrderOfArrival++),t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var t=this._protectedChildren,e=t.length,r,n,s;for(r=1;r<e;r++){for(s=t[r],n=r-1;n>=0;){if(s._localZOrder<t[n]._localZOrder)t[n+1]=t[n];else if(s._localZOrder===t[n]._localZOrder&&s.arrivalOrder<t[n].arrivalOrder)t[n+1]=t[n];else break;n--}t[n+1]=s}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},cleanup:function(){exports.cc.Node.prototype.cleanup.call(this);for(var t=this._protectedChildren,e=0,r=t.length;e<r;e++)t[e].cleanup()},onEnter:function(){exports.cc.Node.prototype.onEnter.call(this);for(var t=this._protectedChildren,e=0,r=t.length;e<r;e++)t[e].onEnter()},onEnterTransitionDidFinish:function(){exports.cc.Node.prototype.onEnterTransitionDidFinish.call(this);for(var t=this._protectedChildren,e=0,r=t.length;e<r;e++)t[e].onEnterTransitionDidFinish()},onExit:function(){exports.cc.Node.prototype.onExit.call(this);for(var t=this._protectedChildren,e=0,r=t.length;e<r;e++)t[e].onExit()},onExitTransitionDidStart:function(){exports.cc.Node.prototype.onExitTransitionDidStart.call(this);for(var t=this._protectedChildren,e=0,r=t.length;e<r;e++)t[e].onExitTransitionDidStart()},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.ProtectedNode.CanvasRenderCmd(this):new exports.cc.ProtectedNode.WebGLRenderCmd(this)}});exports.cc.ProtectedNode.create=function(){return new exports.cc.ProtectedNode};(function(){exports.cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(e){var r=this._node,n=this._displayedColor,s=r._realColor,o,a,c,l;if(this._cascadeColorEnabledDirty&&!r._cascadeColorEnabled){n.r=s.r,n.g=s.g,n.b=s.b;var h=new exports.cc.Color(255,255,255,255);for(c=r._children,o=0,a=c.length;o<a;o++)l=c[o],l&&l._renderCmd&&l._renderCmd._updateDisplayColor(h);this._cascadeColorEnabledDirty=!1}else{if(e===void 0){var u=r._parent;u&&u._cascadeColorEnabled?e=u.getDisplayedColor():e=exports.cc.color.WHITE}if(n.r=0|s.r*e.r/255,n.g=0|s.g*e.g/255,n.b=0|s.b*e.b/255,r._cascadeColorEnabled)for(c=r._children,o=0,a=c.length;o<a;o++)l=c[o],l&&l._renderCmd&&(l._renderCmd._updateDisplayColor(n),l._renderCmd._updateColor());for(c=r._protectedChildren,o=0,a=c.length;o<a;o++)l=c[o],l&&l._renderCmd&&(l._renderCmd._updateDisplayColor(n),l._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(e){var r=this._node,n,s,o,a;if(this._cascadeOpacityEnabledDirty&&!r._cascadeOpacityEnabled){for(this._displayedOpacity=r._realOpacity,o=r._children,n=0,s=o.length;n<s;n++)a=o[n],a&&a._renderCmd&&a._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(e===void 0){var c=r._parent;e=255,c&&c._cascadeOpacityEnabled&&(e=c.getDisplayedOpacity())}if(this._displayedOpacity=r._realOpacity*e/255,r._cascadeOpacityEnabled)for(o=r._children,n=0,s=o.length;n<s;n++)a=o[n],a&&a._renderCmd&&(a._renderCmd._updateDisplayOpacity(this._displayedOpacity),a._renderCmd._updateColor());for(o=r._protectedChildren,n=0,s=o.length;n<s;n++)a=o[n],a&&a._renderCmd&&(a._renderCmd._updateDisplayOpacity(this._displayedOpacity),a._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_changeProtectedChild:function(e){var r=e._renderCmd,n=r._dirtyFlag,s=exports.cc.Node._dirtyFlags;this._dirtyFlag&s.colorDirty&&(n|=s.colorDirty),this._dirtyFlag&s.opacityDirty&&(n|=s.opacityDirty);var o=n&s.colorDirty,a=n&s.opacityDirty;o&&r._updateDisplayColor(this._displayedColor),a&&r._updateDisplayOpacity(this._displayedOpacity),(o||a)&&r._updateColor()}},exports.cc.ProtectedNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._cachedParent=null,this._cacheDirty=!1};var t=exports.cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);exports.cc.inject(exports.cc.ProtectedNode.RenderCmd,t),t.constructor=exports.cc.ProtectedNode.CanvasRenderCmd,t.visit=function(e){var r=this._node;if(r._visible){var n,s,o=r._children,a,c=r._children,l=r._protectedChildren,h=c.length,u=l.length;this._syncStatus(e),r.sortAllChildren(),r.sortAllProtectedChildren();var _;for(n=0;n<h&&(a=o[n],a._localZOrder<0);n++)a.visit(this);for(s=0;s<u&&(_=l[s],_&&_._localZOrder<0);s++)this._changeProtectedChild(_),_.visit(this);for(exports.cc.renderer.pushRenderCommand(this);n<h;n++)o[n]&&o[n].visit(this);for(;s<u;s++)_=l[s],_&&(this._changeProtectedChild(_),_.visit(this));this._dirtyFlag=0,this._cacheDirty=!1}},t.transform=function(e,r){var n=this._node;n._changePosition&&n._changePosition(),this.originTransform(e,r);var s,o,a=n._protectedChildren;if(r&&a&&a.length!==0)for(s=0,o=a.length;s<o;s++)a[s]._renderCmd.transform(this,r)},t.pNodeVisit=t.visit,t.pNodeTransform=t.transform})();(function(){if(exports.cc.Node.WebGLRenderCmd){exports.cc.ProtectedNode.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e)};var t=exports.cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);exports.cc.inject(exports.cc.ProtectedNode.RenderCmd,t),t.constructor=exports.cc.ProtectedNode.WebGLRenderCmd,t.visit=function(e){var r=this._node;if(r._visible){var n,s;this._syncStatus(e);var o=r.grid;o&&o._active&&o.beforeDraw();var a=r._children,c=r._protectedChildren,l=a.length,h=c.length;r.sortAllChildren(),r.sortAllProtectedChildren();var u;for(n=0;n<l&&(a[n]&&a[n]._localZOrder<0);n++)a[n].visit(this);for(s=0;s<h&&(u=c[s],u&&u._localZOrder<0);s++)this._changeProtectedChild(u),u.visit(this);for(exports.cc.renderer.pushRenderCommand(this);n<l;n++)a[n]&&a[n].visit(this);for(;s<h;s++)u=c[s],u&&(this._changeProtectedChild(u),u.visit(this));o&&o._active&&o.afterDraw(r),this._dirtyFlag=0}},t.transform=function(e,r){this.originTransform(e,r);var n,s,o=this._node._protectedChildren;if(r&&o&&o.length!==0)for(n=0,s=o.length;n<s;n++)o[n]._renderCmd.transform(this,r)},t.pNodeVisit=t.visit,t.pNodeTransform=t.transform}})();var ccui=ccui||{};ccui.Class=ccui.Class||exports.cc.Class;ccui.Class.extend=ccui.Class.extend||exports.cc.Class.extend;ccui.Node=ccui.Node||exports.cc.Node;ccui.Node.extend=ccui.Node.extend||exports.cc.Node.extend;ccui.ProtectedNode=ccui.ProtectedNode||exports.cc.ProtectedNode;ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||exports.cc.ProtectedNode.extend;ccui.cocosGUIVersion="CocosGUI v1.0.0.0";ccui._FocusNavigationController=exports.cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(t){this._enableFocusNavigation!==t&&(this._enableFocusNavigation=t,t?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(t){this._firstFocusedWidget=t},_onKeyPressed:function(t,e){this._enableFocusNavigation&&this._firstFocusedWidget&&(t===exports.cc.KEY.dpadDown&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)),t===exports.cc.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)),t===exports.cc.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)),t===exports.cc.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)))},_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=exports.cc.EventListener.create({event:exports.cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),exports.cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(exports.cc.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}});ccui.__LAYOUT_COMPONENT_NAME="__ui_layout";ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,ctor:function(){exports.cc.ProtectedNode.prototype.ctor.call(this),this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=exports.cc.p(0,0),this._touchMovePosition=exports.cc.p(0,0),this._touchEndPosition=exports.cc.p(0,0),this._widgetType=ccui.Widget.TYPE_WIDGET,this._customSize=exports.cc.size(0,0),this._layoutParameterDictionary={},this._sizeType=ccui.Widget.SIZE_ABSOLUTE,this._sizePercent=exports.cc.p(0,0),this._positionType=ccui.Widget.POSITION_ABSOLUTE,this._positionPercent=exports.cc.p(0,0),this._nodes=[],this._layoutParameterType=ccui.LayoutParameter.NONE,ccui.Widget.prototype.init.call(this)},init:function(){return exports.cc.ProtectedNode.prototype.init.call(this)?(this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange,this.onNextFocusedWidget=null,this.setAnchorPoint(exports.cc.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0):!1},onEnter:function(){var t=this._touchListener;t&&!t._isRegistered()&&this._touchEnabled&&exports.cc.eventManager.addListener(t,this),this._usingLayoutComponent||this.updateSizeAndPosition(),exports.cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),exports.cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);return t==null&&(t=new ccui.LayoutComponent,this.addComponent(t)),t},getWidgetParent:function(){var t=this.getParent();return t instanceof ccui.Widget?t:null},_updateContentSizeWithTextureSize:function(t){if(this._unifySize){this.setContentSize(t);return}this.setContentSize(this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);return t==null?!0:t&&!t.isEnabled()?!1:t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){this._touchListener&&this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){return this._touchListener?this._touchListener.isSwallowTouches():!1},_getAncensterWidget:function(t){if(t==null)return null;var e=t.getParent();return e==null?null:e instanceof ccui.Widget?e:this._getAncensterWidget(e.getParent())},_isAncestorsVisible:function(t){if(t==null)return!0;var e=t.getParent();return e&&!e.isVisible()?!1:this._isAncestorsVisible(e)},_cleanupWidget:function(){this._eventDispatcher.removeEventListener(this._touchListener),this._touchEnabled=!1,this._touchListener=null,ccui.Widget._focusedWidget===this&&(ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null)},setEnabled:function(t){this._enabled=t},_initRenderer:function(){},setContentSize:function(t,e){var r=e===void 0?t.width:t,n=e===void 0?t.height:e;if(exports.cc.Node.prototype.setContentSize.call(this,r,n),this._customSize.width=r,this._customSize.height=n,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var s=this.getWidgetParent(),o=s?s.getContentSize():this._parent.getContentSize();this._sizePercent.x=o.width>0?r/o.width:0,this._sizePercent.y=o.height>0?n/o.height:0}this._onSizeChanged()},_setWidth:function(t){if(exports.cc.Node.prototype._setWidth.call(this,t),this._customSize.width=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent(),r=e?e.width:this._parent.width;this._sizePercent.x=r>0?this._customSize.width/r:0}this._onSizeChanged()},_setHeight:function(t){if(exports.cc.Node.prototype._setHeight.call(this,t),this._customSize.height=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent(),r=e?e.height:this._parent.height;this._sizePercent.y=r>0?this._customSize.height/r:0}this._onSizeChanged()},setSizePercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(!0),e.setPercentContentSize(t),e.refreshLayout();return}this._sizePercent.x=t.x,this._sizePercent.y=t.y;var r=this._customSize.width,n=this._customSize.height;if(this._running){var s=this.getWidgetParent();s?(r=s.width*t.x,n=s.height*t.y):(r=this._parent.width*t.x,n=this._parent.height*t.y)}this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(r,n),this._customSize.width=r,this._customSize.height=n},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;if(this._running){var r=this.getWidgetParent();e=(r?r.width:this._parent.width)*t}this._ignoreSize?this._setWidth(this.getVirtualRendererSize().width):this._setWidth(e),this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;if(this._running){var r=this.getWidgetParent();e=(r?r.height:this._parent.height)*t}this._ignoreSize?this._setHeight(this.getVirtualRendererSize().height):this._setHeight(e),this._customSize.height=e},updateSizeAndPosition:function(t){if(!t){var e=this.getWidgetParent();e?t=e.getLayoutSize():t=this._parent.getContentSize()}switch(this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(this._customSize),this._sizePercent.x=t.width>0?this._customSize.width/t.width:0,this._sizePercent.y=t.height>0?this._customSize.height/t.height:0;break;case ccui.Widget.SIZE_PERCENT:var r=exports.cc.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(r),this._customSize.width=r.width,this._customSize.height=r.height;break}this._onSizeChanged();var n=this.getPosition();switch(this._positionType){case ccui.Widget.POSITION_ABSOLUTE:t.width<=0||t.height<=0?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=n.x/t.width,this._positionPercent.y=n.y/t.height);break;case ccui.Widget.POSITION_PERCENT:n=exports.cc.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y);break}if(this._parent instanceof ccui.ImageView){var s=this._parent._imageRenderer;if(s&&!s._textureLoaded)return}this.setPosition(n)},setSizeType:function(t){if(this._sizeType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)}},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){if(this._unifySize){this.setContentSize(this._customSize);return}this._ignoreSize!==t&&(this._ignoreSize=t,this.setContentSize(t?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return exports.cc.size(this._customSize)},getLayoutSize:function(){return exports.cc.size(this._contentSize)},getSizePercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._sizePercent=t.getPercentContentSize()}return this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(exports.cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return exports.cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent)for(var t=this.getChildren(),e=0,r=t.length;e<r;e++){var n=t[e];n instanceof ccui.Widget&&n.updateSizeAndPosition()}},setTouchEnabled:function(t){this._touchEnabled!==t&&(this._touchEnabled=t,this._touchEnabled?(this._touchListener||(this._touchListener=exports.cc.EventListener.create({event:exports.cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),exports.cc.eventManager.addListener(this._touchListener,this)):exports.cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){t!==this._highlight&&(this._highlight=t,this._bright?this._highlight?this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(t){this._focused=t,t&&(ccui.Widget._focusedWidget=this||window,ccui.Widget._focusNavigationController&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this))},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){if(this.onNextFocusedWidget===null||this.onNextFocusedWidget(t)==null){var r=e instanceof ccui.Layout;if(this.isFocused()||r){var n=this.getParent();return n===null||!(n instanceof ccui.Layout)?r?e.findNextFocusedWidget(t,e):e:n.findNextFocusedWidget(t,e)}else return e}else{var s=this.onNextFocusedWidget(t);return this.dispatchFocusEvent(this,s),s}},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(t,e,r){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,r)},onFocusChange:function(t,e){t&&t.setFocused(!1),e&&e.setFocused(!0)},dispatchFocusEvent:function(t,e){t&&!t.isFocused()&&(t=ccui.Widget._focusedWidget),e!==t&&(e&&e.onFocusChanged&&e.onFocusChanged(t,e),t&&e.onFocusChanged&&t.onFocusChanged(t,e),exports.cc.eventManager.dispatchEvent(new exports.cc.EventFocus(t,e)))},setBright:function(t){this._bright=t,this._bright?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle!==t)switch(t=t||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle=t,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed();break}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(t,e){if(this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var r=t.getLocation();this._touchBeganPosition.x=r.x,this._touchBeganPosition.y=r.y,this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}return this._hit?(this.setHighlighted(!0),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,t),this._pushDownEvent(),!0):!1},propagateTouchEvent:function(t,e,r){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,r)},onTouchMoved:function(t,e){var r=t.getLocation();this._touchMovePosition.x=r.x,this._touchMovePosition.y=r.y,this.setHighlighted(this.hitTest(r)),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,t),this._moveEvent()},onTouchEnded:function(t,e){var r=t.getLocation();this._touchEndPosition.x=r.x,this._touchEndPosition.y=r.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,t);var n=this._highlight;this.setHighlighted(!1),n?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(t){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(t){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED),this._clickEventListener&&this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){e===void 0?this._touchEventCallback=t:(this._touchEventSelector=t,this._touchEventListener=e)},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=exports.cc.rect(0,0,this._contentSize.width,this._contentSize.height);return exports.cc.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=!1;for(var e=this.getParent(),r=null;e;){if(e instanceof ccui.Layout&&e.isClippingEnabled()){this._affectByClipping=!0,r=e;break}e=e.getParent()}return this._affectByClipping&&r?r.hitTest(t)?r.isClippingParentContainsPoint(t):!1:!0},checkChildInfo:function(t,e,r){var n=this.getWidgetParent();n&&n.checkChildInfo(t,e,r)},setPosition:function(t,e){if(!this._usingLayoutComponent&&this._running){var r=this.getWidgetParent();if(r){var n=r.getContentSize();n.width<=0||n.height<=0?(this._positionPercent.x=0,this._positionPercent.y=0):e===void 0?(this._positionPercent.x=t.x/n.width,this._positionPercent.y=t.y/n.height):(this._positionPercent.x=t/n.width,this._positionPercent.y=e/n.height)}}exports.cc.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){if(this._running){var e=this.getWidgetParent();if(e){var r=e.width;r<=0?this._positionPercent.x=0:this._positionPercent.x=t/r}}exports.cc.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){if(this._running){var e=this.getWidgetParent();if(e){var r=e.height;r<=0?this._positionPercent.y=0:this._positionPercent.y=t/r}}exports.cc.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.setPositionPercentY(t.y),e.refreshLayout();return}else this._setXPercent(t.x),this._setYPercent(t.y);this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},_setXPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentX(t.x),e.refreshLayout();return}this._positionPercent.x=t},_setYPercent:function(t){if(this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();e.setPositionPercentY(t.x),e.refreshLayout();return}this._positionPercent.y=t},getPositionPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return exports.cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var t=this._getOrCreateLayoutComponent();this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(t){if(this._positionType=t,this._usingLayoutComponent){var e=this._getOrCreateLayoutComponent();t===ccui.POSITION_ABSOLUTE?(e.setPositionPercentXEnabled(!1),e.setPositionPercentYEnabled(!1)):(e.setPositionPercentXEnabled(!0),e.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return exports.cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return exports.cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return exports.cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){t&&(this._layoutParameterDictionary[t.getLayoutType()]=t,this._layoutParameterType=t.getLayoutType())},getLayoutParameter:function(t){return t=t||this._layoutParameterType,this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t._copyClonedWidgetChildren(this),t},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(t){for(var e=t.getChildren(),r=0;r<e.length;r++){var n=e[r];n instanceof ccui.Widget&&this.addChild(n.clone())}},_copySpecialProperties:function(t){},_copyProperties:function(t){this.setEnabled(t.isEnabled()),this.setVisible(t.isVisible()),this.setBright(t.isBright()),this.setTouchEnabled(t.isTouchEnabled()),this.setLocalZOrder(t.getLocalZOrder()),this.setTag(t.getTag()),this.setName(t.getName()),this.setActionTag(t.getActionTag()),this._ignoreSize=t._ignoreSize,this.setContentSize(t._contentSize),this._customSize.width=t._customSize.width,this._customSize.height=t._customSize.height,this._copySpecialProperties(t),this._sizeType=t.getSizeType(),this._sizePercent.x=t._sizePercent.x,this._sizePercent.y=t._sizePercent.y,this._positionType=t._positionType,this._positionPercent.x=t._positionPercent.x,this._positionPercent.y=t._positionPercent.y,this.setPosition(t.getPosition()),this.setAnchorPoint(t.getAnchorPoint()),this.setScaleX(t.getScaleX()),this.setScaleY(t.getScaleY()),this.setRotation(t.getRotation()),this.setRotationX(t.getRotationX()),this.setRotationY(t.getRotationY()),this.setFlippedX(t.isFlippedX()),this.setFlippedY(t.isFlippedY()),this.setColor(t.getColor()),this.setOpacity(t.getOpacity()),this._touchEventCallback=t._touchEventCallback,this._touchEventListener=t._touchEventListener,this._touchEventSelector=t._touchEventSelector,this._clickEventListener=t._clickEventListener,this._focused=t._focused,this._focusEnabled=t._focusEnabled,this._propagateTouchEvents=t._propagateTouchEvents;for(var e in t._layoutParameterDictionary){var r=t._layoutParameterDictionary[e];r&&this.setLayoutParameter(r.clone())}this._onSizeChanged()},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},getLeftInParent:function(){return exports.cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead."),this.getLeftBoundary()},getBottomInParent:function(){return exports.cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead."),this.getBottomBoundary()},getRightInParent:function(){return exports.cc.log("getRightInParent is deprecated. Please use getRightBoundary instead."),this.getRightBoundary()},getTopInParent:function(){return exports.cc.log("getTopInParent is deprecated. Please use getTopBoundary instead."),this.getTopBoundary()},getTouchEndPos:function(){return exports.cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead."),this.getTouchEndPosition()},getTouchMovePos:function(){return exports.cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead."),this.getTouchMovePosition()},clippingParentAreaContainPoint:function(t){exports.cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead."),this.isClippingParentContainsPoint(t)},getTouchStartPos:function(){return exports.cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead."),this.getTouchBeganPosition()},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,r){if(t instanceof ccui.Widget){exports.cc.log("Please use addChild to add a Widget.");return}exports.cc.Node.prototype.addChild.call(this,t,e,r),this._nodes.push(t)},getNodeByTag:function(t){for(var e=this._nodes,r=0;r<e.length;r++){var n=e[r];if(n&&n.getTag()===t)return n}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){exports.cc.Node.prototype.removeChild.call(this,t,e),exports.cc.arrayRemoveObject(this._nodes,t)},removeNodeByTag:function(t,e){var r=this.getChildByTag(t);r?this.removeChild(r,e):exports.cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];exports.cc.Node.prototype.removeChild.call(this,e)}this._nodes.length=0},_findLayout:function(){exports.cc.renderer.childrenOrderDirty=!0;for(var t=this._parent;t;)if(t._doLayout){t._doLayoutDirty=!0;break}else t=t._parent},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){this._flippedX&&(t=t*-1),exports.cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t=t*-1),exports.cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){e===void 0&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=exports.cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t=t*-1),t},getScaleY:function(){var t=exports.cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t=t*-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&exports.cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new ccui.Widget.WebGLRenderCmd(this):new ccui.Widget.CanvasRenderCmd(this)}});var _p=ccui.Widget.prototype;_p.xPercent;exports.cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent);_p.yPercent;exports.cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent);_p.widthPercent;exports.cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent);_p.heightPercent;exports.cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent);_p.widgetParent;exports.cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent);_p.enabled;exports.cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);_p.focused;exports.cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused);_p.sizeType;exports.cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType);_p.widgetType;exports.cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType);_p.touchEnabled;exports.cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled);_p.updateEnabled;exports.cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled);_p.bright;exports.cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright);_p.name;exports.cc.defineGetterSetter(_p,"name",_p.getName,_p.setName);_p.actionTag;exports.cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag);_p.opacity;exports.cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);_p=null;ccui.Widget.create=function(){return new ccui.Widget};ccui.Widget._focusedWidget=null;ccui.Widget._focusNavigationController=null;ccui.Widget.enableDpadNavigation=function(t){t?(ccui.Widget._focusNavigationController==null&&(ccui.Widget._focusNavigationController=new ccui._FocusNavigationController,ccui.Widget._focusedWidget&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)),ccui.Widget._focusNavigationController.enableFocusNavigation(!0)):ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController.enableFocusNavigation(!1),ccui.Widget._focusNavigationController=null)};ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget};ccui.Widget.BRIGHT_STYLE_NONE=-1;ccui.Widget.BRIGHT_STYLE_NORMAL=0;ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1;ccui.Widget.TYPE_WIDGET=0;ccui.Widget.TYPE_CONTAINER=1;ccui.Widget.LEFT=0;ccui.Widget.RIGHT=1;ccui.Widget.UP=2;ccui.Widget.DOWN=3;ccui.Widget.LOCAL_TEXTURE=0;ccui.Widget.PLIST_TEXTURE=1;ccui.Widget.TOUCH_BEGAN=0;ccui.Widget.TOUCH_MOVED=1;ccui.Widget.TOUCH_ENDED=2;ccui.Widget.TOUCH_CANCELED=3;ccui.Widget.SIZE_ABSOLUTE=0;ccui.Widget.SIZE_PERCENT=1;ccui.Widget.POSITION_ABSOLUTE=0;ccui.Widget.POSITION_PERCENT=1;exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS){ccui.Widget.CanvasRenderCmd=function(e){exports.cc.ProtectedNode.CanvasRenderCmd.call(this,e),this._needDraw=!1};var t=ccui.Widget.CanvasRenderCmd.prototype=Object.create(exports.cc.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Widget.CanvasRenderCmd,t.visit=function(e){var r=this._node;r._visible&&(r._adaptRenderers(),this.pNodeVisit(e))},t.transform=function(e,r){var n=this._node;if(n._visible&&n._running){if(n._adaptRenderers(),!this._usingLayoutComponent){var s=n.getWidgetParent();if(s){var o=s.getContentSize();o.width!==0&&o.height!==0&&(n._position.x=o.width*n._positionPercent.x,n._position.y=o.height*n._positionPercent.y)}}this.pNodeTransform(e,r)}},t.widgetVisit=t.visit,t.widgetTransform=t.transform}else{ccui.Widget.WebGLRenderCmd=function(r){exports.cc.ProtectedNode.WebGLRenderCmd.call(this,r),this._needDraw=!1};var t=ccui.Widget.WebGLRenderCmd.prototype=Object.create(exports.cc.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Widget.WebGLRenderCmd,t.visit=function(r){var n=this._node;n._visible&&(n._adaptRenderers(),this.pNodeVisit(r))},t.transform=function(r,n){var s=this._node;if(s._visible&&s._running){if(s._adaptRenderers(),!this._usingLayoutComponent){var o=s.getWidgetParent();if(o){var a=o.getContentSize();a.width!==0&&a.height!==0&&(s._position.x=a.width*s._positionPercent.x,s._position.y=a.height*s._positionPercent.y)}}this.pNodeTransform(r,n)}},t.widgetVisit=t.visit,t.widgetTransform=t.transform}});ccui.Scale9Sprite=exports.cc.Scale9Sprite=exports.cc.Node.extend({_spriteRect:null,_capInsetsInternal:null,_positionsAreDirty:!1,_scale9Image:null,_topLeft:null,_top:null,_topRight:null,_left:null,_centre:null,_right:null,_bottomLeft:null,_bottom:null,_bottomRight:null,_scale9Enabled:!0,_brightState:0,_renderers:null,_opacityModifyRGB:!1,_originalSize:null,_preferredSize:null,_opacity:0,_color:null,_capInsets:null,_insetLeft:0,_insetTop:0,_insetRight:0,_insetBottom:0,_spriteFrameRotated:!1,_textureLoaded:!1,_className:"Scale9Sprite",_flippedX:!1,_flippedY:!1,textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},_updateCapInset:function(){var t,e=this._insetLeft,r=this._insetTop,n=this._insetRight,s=this._spriteRect,o=this._insetBottom;e===0&&r===0&&n===0&&o===0?t=exports.cc.rect(0,0,0,0):t=this._spriteFrameRotated?exports.cc.rect(o,e,s.width-n-e,s.height-r-o):exports.cc.rect(e,r,s.width-e-n,s.height-r-o),this.setCapInsets(t)},_updatePositions:function(){if(this._topLeft&&this._topRight&&this._bottomRight&&this._bottomLeft&&this._centre){var t=this._contentSize,e=this._topLeft,r=this._topRight,n=this._bottomRight,s=this._bottomLeft,o=this._left,a=this._right,c=this._top,l=this._bottom,h=this._centre,u=this._centre.getContentSize(),_=e.getContentSize(),d=s.getContentSize(),f=t.width-_.width-r.getContentSize().width,T=t.height-_.height-n.getContentSize().height,x=f/u.width,m=T/u.height,v=u.width*x,A=u.height*m,D=d.width,N=d.height,z=exports.cc.p(this._offset.x*x,this._offset.y*m);if(exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL){var M=Math.round(v);v!==M&&(v=M,x=v/u.width);var J=Math.round(A);A!==J&&(A=J,m=A/u.height)}h.setScaleX(x),h.setScaleY(m),s.setAnchorPoint(1,1),s.setPosition(D,N),n.setAnchorPoint(0,1),n.setPosition(D+v,N),e.setAnchorPoint(1,0),e.setPosition(D,N+A),r.setAnchorPoint(0,0),r.setPosition(D+v,N+A),o.setAnchorPoint(1,.5),o.setPosition(D,N+A/2+z.y),o.setScaleY(m),a.setAnchorPoint(0,.5),a.setPosition(D+v,N+A/2+z.y),a.setScaleY(m),c.setAnchorPoint(.5,0),c.setPosition(D+v/2+z.x,N+A),c.setScaleX(x),l.setAnchorPoint(.5,1),l.setPosition(D+v/2+z.x,N),l.setScaleX(x),h.setAnchorPoint(.5,.5),h.setPosition(D+v/2+z.x,N+A/2+z.y),h.setScaleX(x),h.setScaleY(m)}},ctor:function(t,e,r){if(exports.cc.Node.prototype.ctor.call(this),this._loader=new exports.cc.Sprite.LoadManager,this._spriteRect=exports.cc.rect(0,0,0,0),this._capInsetsInternal=exports.cc.rect(0,0,0,0),this._originalSize=exports.cc.size(0,0),this._preferredSize=exports.cc.size(0,0),this._capInsets=exports.cc.rect(0,0,0,0),this._renderers=[],t!==void 0)if(t instanceof exports.cc.SpriteFrame)this.initWithSpriteFrame(t,e);else{var n=exports.cc.spriteFrameCache.getSpriteFrame(t);n?this.initWithSpriteFrame(n,e):this.initWithFile(t,e,r)}else this.init(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setAnchorPoint(.5,.5),this._positionsAreDirty=!0},getSprite:function(){return this._scale9Image},getOriginalSize:function(){return exports.cc.size(this._originalSize)},getPreferredSize:function(){return exports.cc.size(this._preferredSize)},_getPreferredWidth:function(){return this._preferredSize.width},_getPreferredHeight:function(){return this._preferredSize.height},_asyncSetPreferredSize:function(){this.removeEventListener("load",this._asyncSetPreferredSize,this),this.setPreferredSize(this._cachePreferredSize),this._cachePreferredSize=null},setPreferredSize:function(t){if(t){if(!this._textureLoaded)return this._cachePreferredSize=t,this.removeEventListener("load",this._asyncSetPreferredSize,this),this.addEventListener("load",this._asyncSetPreferredSize,this),!1;this.setContentSize(t),this._preferredSize=t,this._positionsAreDirty&&(this._updatePositions(),this._positionsAreDirty=!1,this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty))}},_setPreferredWidth:function(t){this._setWidth(t),this._preferredSize.width=t},_setPreferredHeight:function(t){this._setHeight(t),this._preferredSize.height=t},setOpacity:function(t){if(exports.cc.Node.prototype.setOpacity.call(this,t),this._scale9Enabled)for(var e=this._renderers,r=0;r<e.length;r++)e[r].setOpacity(t);else this._scale9Image&&this._scale9Image.setOpacity(t);this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},setColor:function(t){if(exports.cc.Node.prototype.setColor.call(this,t),this._scale9Enabled)for(var e=this._renderers,r=0;r<e.length;r++){var n=e[r];n&&n.setColor(t)}else this._scale9Image&&this._scale9Image.setColor(t);this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},getCapInsets:function(){return exports.cc.rect(this._capInsets)},_asyncSetCapInsets:function(){this.removeEventListener("load",this._asyncSetCapInsets,this),this.setCapInsets(this._cacheCapInsets),this._cacheCapInsets=null},setCapInsets:function(t){var e=this._contentSize,r=e.width,n=e.height;if(!this._textureLoaded)return this._cacheCapInsets=t,this.removeEventListener("load",this._asyncSetCapInsets,this),this.addEventListener("load",this._asyncSetCapInsets,this),!1;this.updateWithSprite(this._scale9Image,this._spriteRect,this._spriteFrameRotated,this._offset,this._originalSize,t),this._insetLeft=t.x,this._insetTop=t.y,this._insetRight=this._originalSize.width-this._insetLeft-t.width,this._insetBottom=this._originalSize.height-this._insetTop-t.height,this.setContentSize(r,n)},getInsetLeft:function(){return this._insetLeft},setInsetLeft:function(t){this._insetLeft=t,this._updateCapInset()},getInsetTop:function(){return this._insetTop},setInsetTop:function(t){this._insetTop=t,this._updateCapInset()},getInsetRight:function(){return this._insetRight},setInsetRight:function(t){this._insetRight=t,this._updateCapInset()},getInsetBottom:function(){return this._insetBottom},setInsetBottom:function(t){this._insetBottom=t,this._updateCapInset()},setContentSize:function(t,e){exports.cc.Node.prototype.setContentSize.call(this,t,e),this._positionsAreDirty=!0},setAnchorPoint:function(t,e){exports.cc.Node.prototype.setAnchorPoint.call(this,t,e),this._scale9Enabled||this._scale9Image&&(this._scale9Image.setAnchorPoint(t,e),this._positionsAreDirty=!0)},_setWidth:function(t){exports.cc.Node.prototype._setWidth.call(this,t),this._positionsAreDirty=!0},_setHeight:function(t){exports.cc.Node.prototype._setHeight.call(this,t),this._positionsAreDirty=!0},init:function(){return this.initWithBatchNode(null,exports.cc.rect(0,0,0,0),!1,exports.cc.rect(0,0,0,0))},initWithBatchNode:function(t,e,r,n){return t?(n===void 0&&(n=r,r=!1),this.updateWithBatchNode(t,e,r,n),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setAnchorPoint(.5,.5),this._positionsAreDirty=!0,!0):!1},initWithFile:function(t,e,r){if(t instanceof exports.cc.Rect?(t=arguments[1],r=arguments[0],e=exports.cc.rect(0,0,0,0)):(e=e||exports.cc.rect(0,0,0,0),r=r||exports.cc.rect(0,0,0,0)),!t)throw new Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");var n=exports.cc.textureCache.getTextureForKey(t);n||(n=exports.cc.textureCache.addImage(t));var s=n.isLoaded();return this._textureLoaded=s,this._loader.clear(),s?this.initWithBatchNode(new exports.cc.SpriteBatchNode(t,9),e,!1,r):(this._loader.once(n,function(){this.initWithFile(t,e,r),this.dispatchEvent("load")},this),!1)},initWithSpriteFrame:function(t,e){if(!t||!t.getTexture())throw new Error("ccui.Scale9Sprite.initWithSpriteFrame(): spriteFrame should be non-null and its texture should be non-null");e=e||exports.cc.rect(0,0,0,0);var r=t.getTexture(),n=this._textureLoaded=r.isLoaded();if(this._loader.clear(),!n)return this._loader.once(r,function(){this.initWithSpriteFrame(t,e),this.dispatchEvent("load")},this),!1;var s=new exports.cc.SpriteBatchNode(t.getTexture(),9);return this.initWithBatchNode(s,t.getRect(),exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&t.isRotated(),e),!0},initWithSpriteFrameName:function(t,e){if(!t)throw new Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");e=e||exports.cc.rect(0,0,0,0);var r=exports.cc.spriteFrameCache.getSpriteFrame(t);return r==null?(exports.cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1):this.initWithSpriteFrame(r,e)},resizableSpriteWithCapInsets:function(t){var e=new ccui.Scale9Sprite;return e&&e.initWithBatchNode(this._scale9Image,this._spriteRect,!1,t)?e:null},setOpacityModifyRGB:function(t){if(this._scale9Image){this._opacityModifyRGB=t;var e=this._scale9Image.getChildren();if(e)for(var r=0,n=e.length;r<n;r++)e[r].setOpacityModifyRGB(t);this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},createSlicedSprites:function(){var t=this._originalSize.width,e=this._originalSize.height,r=this._spriteRect,n=Math.floor(this._offset.x+(t-r.width)/2),s=Math.floor(this._offset.y+(e-r.height)/2),o=r.x,a=r.y,c=this._capInsetsInternal,l=this._scale9Image,h=l.getTexture(),u=this._spriteFrameRotated,_=exports.cc.rect(r.x,r.y,r.width,r.height);exports.cc._rectEqualToZero(c)&&(c=exports.cc.rect(t/3,e/3,t/3,e/3)),this._spriteFrameRotated?(o-=s,a-=n):(o-=n,a-=s),r=exports.cc.rect(o,a,t,e);var d=c.x,f=c.width,T=r.width-(d+f),x=c.y,m=c.height,v=r.height-(x+m),A=0,D=0,N=exports.cc.rect(A+.5|0,D+.5|0,d+.5|0,x+.5|0),z=N;A+=d;var M=exports.cc.rect(A+.5|0,D+.5|0,f+.5|0,x+.5|0),J=M;A+=f;var U=exports.cc.rect(A+.5|0,D+.5|0,T+.5|0,x+.5|0),K=U;A=0,D=0,D+=x;var tt=exports.cc.rect(A+.5|0,D+.5|0,d+.5|0,m+.5|0);A+=d;var rt=exports.cc.rect(A+.5|0,D+.5|0,f+.5|0,m+.5|0),I=rt;A+=f;var L=exports.cc.rect(A+.5|0,D+.5|0,T+.5|0,m+.5|0);A=0,D=0,D+=x,D+=m;var G=exports.cc.rect(A+.5|0,D+.5|0,d+.5|0,v+.5|0);A+=d;var w=exports.cc.rect(A+.5|0,D+.5|0,f+.5|0,v+.5|0);A+=f;var O=exports.cc.rect(A+.5|0,D+.5|0,T+.5|0,v+.5|0),j=O,Q=N,C=rt,b=O,W=I,S=j,E=G,R=K,F=z,k=L,X=tt,Z=w,V=J,Y=exports.cc.affineTransformMakeIdentity();u?(Y=exports.cc.affineTransformTranslate(Y,_.height+_.x,_.y),Y=exports.cc.affineTransformRotate(Y,1.57079633),N=exports.cc.rectApplyAffineTransform(N,Y),rt=exports.cc.rectApplyAffineTransform(rt,Y),O=exports.cc.rectApplyAffineTransform(O,Y),I=exports.cc.rectApplyAffineTransform(I,Y),j=exports.cc.rectApplyAffineTransform(j,Y),G=exports.cc.rectApplyAffineTransform(G,Y),K=exports.cc.rectApplyAffineTransform(K,Y),z=exports.cc.rectApplyAffineTransform(z,Y),L=exports.cc.rectApplyAffineTransform(L,Y),tt=exports.cc.rectApplyAffineTransform(tt,Y),w=exports.cc.rectApplyAffineTransform(w,Y),J=exports.cc.rectApplyAffineTransform(J,Y),Q.x=N.x,C.x=rt.x,b.x=O.x,W.x=I.x,S.x=j.x,E.x=G.x,R.x=K.x,F.x=z.x,k.x=L.x,X.x=tt.x,Z.x=w.x,V.x=J.x,Q.y=N.y,C.y=rt.y,b.y=O.y,W.y=I.y,S.y=j.y,E.y=G.y,R.y=K.y,F.y=z.y,k.y=L.y,X.y=tt.y,Z.y=w.y,V.y=J.y):(Y=exports.cc.affineTransformTranslate(Y,_.x,_.y),Q=exports.cc.rectApplyAffineTransform(Q,Y),C=exports.cc.rectApplyAffineTransform(C,Y),b=exports.cc.rectApplyAffineTransform(b,Y),W=exports.cc.rectApplyAffineTransform(W,Y),S=exports.cc.rectApplyAffineTransform(S,Y),E=exports.cc.rectApplyAffineTransform(E,Y),R=exports.cc.rectApplyAffineTransform(R,Y),F=exports.cc.rectApplyAffineTransform(F,Y),k=exports.cc.rectApplyAffineTransform(k,Y),X=exports.cc.rectApplyAffineTransform(X,Y),Z=exports.cc.rectApplyAffineTransform(Z,Y),V=exports.cc.rectApplyAffineTransform(V,Y)),this._centre||(this._centre=new exports.cc.Sprite),this._centre.initWithTexture(h,W,u),W.width>0&&W.height>0&&this._renderers.push(this._centre),this._top||(this._top=new exports.cc.Sprite),this._top.initWithTexture(h,V,u),V.width>0&&V.height>0&&this._renderers.push(this._top),this._bottom||(this._bottom=new exports.cc.Sprite),this._bottom.initWithTexture(h,Z,u),Z.width>0&&Z.height>0&&this._renderers.push(this._bottom),this._left||(this._left=new exports.cc.Sprite),this._left.initWithTexture(h,X,u),X.width>0&&X.height>0&&this._renderers.push(this._left),this._right||(this._right=new exports.cc.Sprite),this._right.initWithTexture(h,k,u),k.width>0&&k.height>0&&this._renderers.push(this._right),this._topLeft||(this._topLeft=new exports.cc.Sprite),this._topLeft.initWithTexture(h,F,u),F.width>0&&F.height>0&&this._renderers.push(this._topLeft),this._topRight||(this._topRight=new exports.cc.Sprite),this._topRight.initWithTexture(h,R,u),R.width>0&&R.height>0&&this._renderers.push(this._topRight),this._bottomLeft||(this._bottomLeft=new exports.cc.Sprite),this._bottomLeft.initWithTexture(h,E,u),E.width>0&&E.height>0&&this._renderers.push(this._bottomLeft),this._bottomRight||(this._bottomRight=new exports.cc.Sprite),this._bottomRight.initWithTexture(h,S,u),S.width>0&&S.height>0&&this._renderers.push(this._bottomRight)},updateWithSprite:function(t,e,r,n,s,o){if(!t)return!1;if(this._loader.clear(),this._textureLoaded=t._textureLoaded,!t._textureLoaded)return this._loader.once(t,function(){this.updateWithSprite(t,e,r,n,s,o),this.dispatchEvent("load")},this),!1;if(this._scale9Image=t,!this._scale9Image)return!1;var a=this._scale9Image.getTexture();this._textureLoaded=a&&a.isLoaded();var c=t.getSpriteFrame();exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS&&c&&a._htmlElementObj instanceof window.HTMLCanvasElement&&(r=!1,e={x:0,y:0,height:e.height,width:e.width});var l=this.getOpacity(),h=this.getColor();this._renderers.length=0;var u=e,_=s;if(exports.cc._rectEqualToZero(u)){var d=a.getContentSize();u=exports.cc.rect(0,0,d.width,d.height)}return _.width===0&&_.height===0&&(_=exports.cc.size(u.width,u.height)),this._capInsets=o,this._spriteRect=u,this._offset=n,this._spriteFrameRotated=r,this._originalSize=_,this._preferredSize=_,this._capInsetsInternal=o,this._scale9Enabled?this.createSlicedSprites():this._scale9Image.initWithTexture(a,this._spriteRect,this._spriteFrameRotated),this.setState(this._brightState),this.setContentSize(_),this.setOpacity(l),this.setColor(h),!0},updateWithBatchNode:function(t,e,r,n){if(!t)return!1;var s=t.getTexture();this._loader.clear();var o=this._textureLoaded=s.isLoaded();if(!o)return this._loader.once(s,function(){this.updateWithBatchNode(t,e,r,n),this.dispatchEvent("load")},this),!1;var a=new exports.cc.Sprite(s),c=exports.cc.p(0,0),l=exports.cc.size(e.width,e.height);return this.updateWithSprite(a,e,r,c,l,n)},setSpriteFrame:function(t,e){e=e||exports.cc.rect();var r=t.getTexture();if(this._textureLoaded=r._textureLoaded,this._loader.clear(),!r._textureLoaded)return this._loader.once(t,function(){this.setSpriteFrame(t,e),this.dispatchEvent("load")},this),!1;var n=new exports.cc.Sprite(t.getTexture());this.updateWithSprite(n,t.getRect(),t.isRotated(),t.getOffset(),t.getOriginalSize(),e),this._insetLeft=e.x,this._insetTop=e.y,this._insetRight=this._originalSize.width-this._insetLeft-e.width,this._insetBottom=this._originalSize.height-this._insetTop-e.height},setState:function(t){(t===ccui.Scale9Sprite.state.NORMAL||t===ccui.Scale9Sprite.state.GRAY)&&(this._brightState=t,this._renderCmd.setState(t))},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this._renderers.length=0,exports.cc.Node.transformDirty=!0,this._scale9Enabled&&this._scale9Image&&this.updateWithSprite(this._scale9Image,this._spriteRect,this._spriteFrameRotated,this._offset,this._originalSize,this._capInsets),this._positionsAreDirty=!0)},_setRenderersPosition:function(){this._positionsAreDirty&&(this._updatePositions(),this._adjustScale9ImagePosition(),this._positionsAreDirty=!1)},_adjustScale9ImagePosition:function(){var t=this._scale9Image,e=this._contentSize;t&&(t.x=e.width*t.getAnchorPoint().x,t.y=e.height*t.getAnchorPoint().y)},_adjustScale9ImageScale:function(){var t=this._scale9Image,e=this._contentSize;t&&t.setScale(e.width/t.width,e.height/t.height)},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},isFlippedY:function(){return this._flippedY},setScaleX:function(t){this._flippedX&&(t=t*-1),exports.cc.Node.prototype.setScaleX.call(this,t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},setScaleY:function(t){this._flippedY&&(t=t*-1),exports.cc.Node.prototype.setScaleY.call(this,t),this._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty)},setScale:function(t,e){e===void 0&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=exports.cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t=t*-1),t},getScaleY:function(){var t=exports.cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t=t*-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&exports.cc.log("Scale9Sprite#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new ccui.Scale9Sprite.CanvasRenderCmd(this):new ccui.Scale9Sprite.WebGLRenderCmd(this)}});var _p=ccui.Scale9Sprite.prototype;exports.cc.EventHelper.prototype.apply(_p);_p.preferredSize;exports.cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize);_p.capInsets;exports.cc.defineGetterSetter(_p,"capInsets",_p.getCapInsets,_p.setCapInsets);_p.insetLeft;exports.cc.defineGetterSetter(_p,"insetLeft",_p.getInsetLeft,_p.setInsetLeft);_p.insetTop;exports.cc.defineGetterSetter(_p,"insetTop",_p.getInsetTop,_p.setInsetTop);_p.insetRight;exports.cc.defineGetterSetter(_p,"insetRight",_p.getInsetRight,_p.setInsetRight);_p.insetBottom;exports.cc.defineGetterSetter(_p,"insetBottom",_p.getInsetBottom,_p.setInsetBottom);_p=null;ccui.Scale9Sprite.create=function(t,e,r){return new ccui.Scale9Sprite(t,e,r)};ccui.Scale9Sprite.createWithSpriteFrame=function(t,e){return new ccui.Scale9Sprite(t,e)};ccui.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new ccui.Scale9Sprite(t,e)};ccui.Scale9Sprite.POSITIONS_CENTRE=0;ccui.Scale9Sprite.POSITIONS_TOP=1;ccui.Scale9Sprite.POSITIONS_LEFT=2;ccui.Scale9Sprite.POSITIONS_RIGHT=3;ccui.Scale9Sprite.POSITIONS_BOTTOM=4;ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5;ccui.Scale9Sprite.POSITIONS_TOPLEFT=6;ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7;ccui.Scale9Sprite.state={NORMAL:0,GRAY:1};(function(){ccui.Scale9Sprite.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._cachedParent=null,this._cacheDirty=!1,this._state=ccui.Scale9Sprite.state.NORMAL;var r=this._node,n=this._cacheCanvas=document.createElement("canvas");n.width=1,n.height=1,this._cacheContext=new exports.cc.CanvasContextWrapper(n.getContext("2d"));var s=this._cacheTexture=new exports.cc.Texture2D;s.initWithElement(n),s.handleLoadedTexture(),this._cacheSprite=new exports.cc.Sprite(s),this._cacheSprite.setAnchorPoint(0,0),r.addChild(this._cacheSprite)};var t=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.CanvasRenderCmd,t.visit=function(e){var r=this._node;r._visible&&(r._positionsAreDirty&&(r._updatePositions(),r._positionsAreDirty=!1),this.originVisit(e))},t.transform=function(e){var r=this._node;exports.cc.Node.CanvasRenderCmd.prototype.transform.call(this,e),r._positionsAreDirty&&(r._updatePositions(),r._positionsAreDirty=!1);for(var n=r._children,s=0;s<n.length;s++)n[s].transform(this,!0)},t._updateDisplayColor=function(e){exports.cc.Node.CanvasRenderCmd.prototype._updateDisplayColor.call(this,e);var r=this._node;if(r){var n=r._renderers;if(r._scale9Enabled)for(var s=n.length,o=0;o<s;o++){var a=n[o];if(a)a._renderCmd._updateDisplayColor(e),a._renderCmd._updateColor();else break}else r._scale9Image&&(r._scale9Image._renderCmd._updateDisplayColor(e),r._scale9Image._renderCmd._updateColor())}},t.updateStatus=function(){var e=exports.cc.Node._dirtyFlags,r=this._dirtyFlag;exports.cc.Node.RenderCmd.prototype.updateStatus.call(this),r&e.cacheDirty&&(this._cacheScale9Sprite(),this._dirtyFlag=this._dirtyFlag&e.cacheDirty^this._dirtyFlag)},t._syncStatus=function(e){var r=exports.cc.Node._dirtyFlags,n=this._dirtyFlag;exports.cc.Node.RenderCmd.prototype._syncStatus.call(this,e),n&r.cacheDirty&&(this._cacheScale9Sprite(),this._dirtyFlag=this._dirtyFlag&r.cacheDirty^this._dirtyFlag)},t._cacheScale9Sprite=function(){var e=this._node;if(e._scale9Image){var r=exports.cc.contentScaleFactor(),n=e._contentSize,s=exports.cc.size(n.width*r,n.height*r),o=this._cacheCanvas,a=this._cacheContext,c=a.getContext(),l=!1;if((o.width!==s.width||o.height!==s.height)&&(o.width=s.width,o.height=s.height,l=!0),exports.cc.renderer._turnToCacheMode(e.__instanceId),e._scale9Enabled){var h=e._renderers;e._setRenderersPosition();for(var u=h.length,_=0;_<u;_++){var d=h[_];if(d){var f=d._renderCmd;f.updateStatus(),exports.cc.renderer.pushRenderCommand(f)}else break}}else{var f=e._scale9Image._renderCmd;e._adjustScale9ImagePosition(),e._adjustScale9ImageScale(),f.updateStatus(),exports.cc.renderer.pushRenderCommand(e._scale9Image._renderCmd)}var T=e._scale9Image.getTexture();T&&this._state===ccui.Scale9Sprite.state.GRAY&&T._switchToGray(!0),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,s.width,s.height),exports.cc.renderer._renderingToCacheCanvas(a,e.__instanceId,r,r),exports.cc.renderer._turnToNormalMode(),T&&this._state===ccui.Scale9Sprite.state.GRAY&&T._switchToGray(!1),l&&this._cacheSprite.setTextureRect(exports.cc.rect(0,0,n.width,n.height)),this._cacheSprite.getParent()||e.addChild(this._cacheSprite,-1),this._cacheSprite._renderCmd._updateColor()}},t.setState=function(e){var r=this._node._scale9Image;r&&(this._state=e,this.setDirtyFlag(exports.cc.Node._dirtyFlags.cacheDirty))}})();(function(){if(exports.cc.Node.WebGLRenderCmd){ccui.Scale9Sprite.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._cachedParent=null,this._cacheDirty=!1};var t=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=ccui.Scale9Sprite.WebGLRenderCmd,t.setShaderProgram=function(e){var r=this._node;if(r._scale9Enabled)for(var n=r._renderers,s=n.length,o=0;o<s;o++)n[o]&&(n[o]._renderCmd._shaderProgram=e);else r._scale9Image._renderCmd._shaderProgram=e;this._shaderProgram=e},t.visit=function(e){var r=this._node;if(r._visible&&r._scale9Image){if(r._positionsAreDirty&&(r._updatePositions(),r._positionsAreDirty=!1),e=e||this.getParentRenderCmd(),r._parent&&r._parent._renderCmd&&(this._curLevel=r._parent._renderCmd._curLevel+1),this._syncStatus(e),r._scale9Enabled)for(var n=r._renderers,s=n.length,o=0;o<s;o++){var a=n[o];if(a){var c=a._renderCmd;c.visit(this)}else break}else r._adjustScale9ImageScale(),r._adjustScale9ImagePosition(),r._scale9Image._renderCmd.visit(this);this._dirtyFlag=0,this.originVisit(e)}},t.transform=function(e,r){var n=this._node;if(e=e||this.getParentRenderCmd(),this.originTransform(e,r),n._positionsAreDirty&&(n._updatePositions(),n._positionsAreDirty=!1),n._scale9Enabled)for(var s=n._renderers,o=s.length,a=exports.cc.Node._dirtyFlags,c=0;c<o;c++){var l=s[c];if(l){l._vertexZ=e._node._vertexZ;var h=l._renderCmd;h.transform(this,!0),h._dirtyFlag=h._dirtyFlag&a.transformDirty^h._dirtyFlag}else break}else n._adjustScale9ImageScale(),n._adjustScale9ImagePosition(),n._scale9Image._renderCmd.transform(this,!0)},t.setDirtyFlag=function(e,r){e===exports.cc.Node._dirtyFlags.cacheDirty&&(e=exports.cc.Node._dirtyFlags.transformDirty),exports.cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,e,r)},t._syncStatus=function(e){exports.cc.Node.WebGLRenderCmd.prototype._syncStatus.call(this,e),this._updateDisplayColor(this._displayedColor),this._updateDisplayOpacity(this._displayedOpacity)},t._updateDisplayColor=function(e){exports.cc.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,e);var r=this._node,n=r._scale9Image;if(e=this._displayedColor,r._scale9Enabled)for(var s=r._renderers,o=0;o<s.length;o++)s[o]._renderCmd._updateDisplayColor(e),s[o]._renderCmd._updateColor();else n._renderCmd._updateDisplayColor(e),n._renderCmd._updateColor()},t._updateDisplayOpacity=function(e){exports.cc.Node.WebGLRenderCmd.prototype._updateDisplayOpacity.call(this,e);var r=this._node,n=r._scale9Image;if(e=this._displayedOpacity,r._scale9Enabled)for(var s=r._renderers,o=0;o<s.length;o++)s[o]._renderCmd._updateDisplayOpacity(e),s[o]._renderCmd._updateColor();else n._renderCmd._updateDisplayOpacity(e),n._renderCmd._updateColor()},t.setState=function(e){e===ccui.Scale9Sprite.state.NORMAL?this.setShaderProgram(exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)):e===ccui.Scale9Sprite.state.GRAY&&this.setShaderProgram(ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram())},ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=null,ccui.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram=function(){var e=ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram;return e||(e=new exports.cc.GLProgram,e.initWithVertexShaderByteArray(exports.cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),e.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),e.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),e.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS),e.link(),e.updateUniforms(),ccui.Scale9Sprite.WebGLRenderCmd._grayShaderProgram=e,e)},ccui.Scale9Sprite.WebGLRenderCmd._grayShaderFragment=`precision lowp float;
varying vec4 v_fragmentColor; 
varying vec2 v_texCoord; 
void main() 
{ 
    vec4 c = texture2D(CC_Texture0, v_texCoord); 
    gl_FragColor.xyz = vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); 
     gl_FragColor.w = c.w ; 
}`}})();ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE,this._widgetType=ccui.Widget.TYPE_CONTAINER,this._clippingType=ccui.Layout.CLIPPING_SCISSOR,this._colorType=ccui.Layout.BG_COLOR_NONE,ccui.Widget.prototype.ctor.call(this),this.ignoreContentAdaptWithSize(!1),this.setContentSize(exports.cc.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),this._backGroundImageCapInsets=exports.cc.rect(0,0,0,0),this._color=exports.cc.color(255,255,255,255),this._startColor=exports.cc.color(255,255,255,255),this._endColor=exports.cc.color(255,255,255,255),this._alongVector=exports.cc.p(0,-1),this._backGroundImageTextureSize=exports.cc.size(0,0),this._clippingRect=exports.cc.rect(0,0,0,0),this._backGroundImageColor=exports.cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil.onEnter(),this._doLayoutDirty=!0,this._clippingRectDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil.onExit()},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(t,e){if(this._isFocusPassing||this.isFocused()){var r=this.getParent();if(this._isFocusPassing=!1,this.__passFocusToChild){var n=this._passFocusToChild(t,e);return n instanceof ccui.Layout&&r?(r._isFocusPassing=!0,r.findNextFocusedWidget(t,this)):n}return r==null||!(r instanceof ccui.Layout)?this:(r._isFocusPassing=!0,r.findNextFocusedWidget(t,this))}else if(e.isFocused()||e instanceof ccui.Layout)if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL)switch(t){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(t,e);case ccui.Widget.RIGHT:return this._getNextFocusedWidget(t,e);case ccui.Widget.DOWN:case ccui.Widget.UP:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);default:return exports.cc.assert(0,"Invalid Focus Direction"),e}else if(this._layoutType===ccui.Layout.LINEAR_VERTICAL)switch(t){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:return this._isLastWidgetInContainer(this,t)?this._isWidgetAncestorSupportLoopFocus(e,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this);case ccui.Widget.DOWN:return this._getNextFocusedWidget(t,e);case ccui.Widget.UP:return this._getPreviousFocusedWidget(t,e);default:return exports.cc.assert(0,"Invalid Focus Direction"),e}else return exports.cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),e;else return e},onPassFocusToChild:null,addChild:function(t,e,r){t instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(t),ccui.Widget.prototype.addChild.call(this,t,e,r),this._doLayoutDirty=!0},removeChild:function(t,e){ccui.Widget.prototype.removeChild.call(this,t,e),this._doLayoutDirty=!0},removeAllChildren:function(t){ccui.Widget.prototype.removeAllChildren.call(this,t),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(t){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,t),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},visit:function(t){if(this._visible)if(this._adaptRenderers(),this._doLayout(),this._clippingEnabled)switch(this._clippingType){case ccui.Layout.CLIPPING_STENCIL:this._renderCmd.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this._renderCmd.scissorClippingVisit(t);break}else ccui.Widget.prototype.visit.call(this,t)},setClippingEnabled:function(t){if(t!==this._clippingEnabled)switch(this._clippingEnabled=t,this._clippingType){case ccui.Layout.CLIPPING_SCISSOR:case ccui.Layout.CLIPPING_STENCIL:t?(this._clippingStencil=new exports.cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil.onEnter(),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil.onExit(),this._clippingStencil=null);break}},setClippingType:function(t){if(t!==this._clippingType){var e=this.isClippingEnabled();this.setClippingEnabled(!1),this._clippingType=t,this.setClippingEnabled(e)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){if(this._clippingEnabled){var e=[];e[0]=exports.cc.p(0,0),e[1]=exports.cc.p(t.width,0),e[2]=exports.cc.p(t.width,t.height),e[3]=exports.cc.p(0,t.height);var r=exports.cc.color.GREEN;this._clippingStencil.clear(),this._clippingStencil.setLocalBB&&this._clippingStencil.setLocalBB(0,0,t.width,t.height),this._clippingStencil.drawPoly(e,4,r,0,r)}},_getClippingRect:function(){if(this._clippingRectDirty){for(var t=this.convertToWorldSpace(exports.cc.p(0,0)),e=this.getNodeToWorldTransform(),r=this._contentSize.width*e.a,n=this._contentSize.height*e.d,s,o=this||window;o;)if(o=o.getParent(),o&&o instanceof ccui.Layout&&o.isClippingEnabled()){this._clippingParent=o;break}if(this._clippingParent){s=this._clippingParent._getClippingRect(),this._clippingRect.x=Math.max(t.x,s.x),this._clippingRect.y=Math.max(t.y,s.y);var a=Math.min(t.x+r,s.x+s.width),c=Math.min(t.y+n,s.y+s.height);this._clippingRect.width=Math.max(0,a-this._clippingRect.x),this._clippingRect.height=Math.max(0,c-this._clippingRect.y)}else this._clippingRect.x=t.x,this._clippingRect.y=t.y,this._clippingRect.width=r,this._clippingRect.height=n;this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t),this._doLayoutDirty=!0,this._clippingRectDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(t.width*.5,t.height*.5),this._backGroundScale9Enabled&&this._backGroundImage instanceof ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(t)),this._colorRender&&this._colorRender.setContentSize(t),this._gradientRender&&this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){this._backGroundScale9Enabled!==t&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=t,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundImage===null&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=t,this._bgImageTexType=e;var r=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._backGroundScale9Enabled&&r.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=r.getContentSize(),r.setPosition(this._contentSize.width*.5,this._contentSize.height*.5),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(t){if(t){var e=this._backGroundImageCapInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(t)}},getBackGroundImageCapInsets:function(){return exports.cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(t)switch(this._layoutType){case ccui.Layout.ABSOLUTE:break;case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR);e||t.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:var e=t.getLayoutParameter(ccui.LayoutParameter.RELATIVE);e||t.setLayoutParameter(new ccui.RelativeLayoutParameter);break}},_addBackGroundImage:function(){var t=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(t)):this._backGroundImage=new exports.cc.Sprite,this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(t.width*.5,t.height*.5)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(t){if(this._colorType!==t){switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null),this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break}switch(this._colorType=t,this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new exports.cc.LayerColor,this._colorRender.setContentSize(this._contentSize),this._colorRender.setOpacity(this._opacity),this._colorRender.setColor(this._color),this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new exports.cc.LayerGradient(exports.cc.color(255,0,0,255),exports.cc.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){e?(this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._gradientRender&&this._gradientRender.setStartColor(t),this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._gradientRender&&this._gradientRender.setEndColor(e)):(this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._colorRender&&this._colorRender.setColor(t))},getBackGroundColor:function(){var t=this._color;return exports.cc.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return exports.cc.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return exports.cc.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){switch(this._opacity=t,this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t);break}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._gradientRender&&this._gradientRender.setVector(t)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r,this._backGroundImageColor.g=t.g,this._backGroundImageColor.b=t.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return exports.cc.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t;for(var e=this._children,r=null,n=0;n<e.length;n++)r=e[n],r instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(r);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var t=ccui.getLayoutManager(this._layoutType);t&&t._doLayout(this),this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var t=this.getChildren(),e=exports.cc.size(0,0),r=0,n,s=0,o=t.length;s<o;s++){var a=t[s];if(a!==null&&a instanceof ccui.Layout)n=a._getLayoutAccumulatedSize(),e.width+=n.width,e.height+=n.height;else if(a instanceof ccui.Widget){r++;var c=a.getLayoutParameter().getMargin();n=a.getContentSize(),e.width+=n.width+(c.right+c.left)*.5,e.height+=n.height+(c.top+c.bottom)*.5}}var l=this.getLayoutType();return l===ccui.Layout.LINEAR_HORIZONTAL&&(e.height=e.height-e.height/r*(r-1)),l===ccui.Layout.LINEAR_VERTICAL&&(e.width=e.width-e.width/r*(r-1)),e},_findNearestChildWidgetIndex:function(t,e){if(e==null||e===this)return this._findFirstFocusEnabledWidgetIndex();var r=0,n=this.getChildren(),s=n.length,o,a=exports.cc.FLT_MAX,c=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(o=this._getWorldCenterPoint(e);r<s;){var l=n[r];if(l&&l instanceof ccui.Widget&&l.isFocusEnabled()){var h=l instanceof ccui.Layout?l._calculateNearestDistance(e):exports.cc.pLength(exports.cc.pSub(this._getWorldCenterPoint(l),o));h<a&&(c=r,a=h)}r++}return c}return exports.cc.log("invalid focus direction!"),0},_findFarthestChildWidgetIndex:function(t,e){if(e==null||e===this)return this._findFirstFocusEnabledWidgetIndex();var r=0,n=this.getChildren(),s=n.length,o=-exports.cc.FLT_MAX,a=0;if(t===ccui.Widget.LEFT||t===ccui.Widget.RIGHT||t===ccui.Widget.DOWN||t===ccui.Widget.UP){for(var c=this._getWorldCenterPoint(e);r<s;){var l=n[r];if(l&&l instanceof ccui.Widget&&l.isFocusEnabled()){var h=l instanceof ccui.Layout?l._calculateFarthestDistance(e):exports.cc.pLength(exports.cc.pSub(this._getWorldCenterPoint(l),c));h>o&&(a=r,o=h)}r++}return a}return exports.cc.log("invalid focus direction!!!"),0},_calculateNearestDistance:function(t){for(var e=exports.cc.FLT_MAX,r=this._getWorldCenterPoint(t),n=this._children,s=0,o=n.length;s<o;s++){var a=n[s],c;if(a instanceof ccui.Layout)c=a._calculateNearestDistance(t);else if(a instanceof ccui.Widget&&a.isFocusEnabled())c=exports.cc.pLength(exports.cc.pSub(this._getWorldCenterPoint(a),r));else continue;c<e&&(e=c)}return e},_calculateFarthestDistance:function(t){for(var e=-exports.cc.FLT_MAX,r=this._getWorldCenterPoint(t),n=this._children,s=0,o=n.length;s<o;s++){var a=n[s],c;if(a instanceof ccui.Layout)c=a._calculateFarthestDistance(t);else if(a instanceof ccui.Widget&&a.isFocusEnabled()){var l=this._getWorldCenterPoint(a);c=exports.cc.pLength(exports.cc.pSub(l,r))}else continue;c>e&&(e=c)}return e},_findProperSearchingFunctor:function(t,e){if(e!==void 0){var r=this._getWorldCenterPoint(e),n=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());t===ccui.Widget.LEFT?this.onPassFocusToChild=r.x>n.x?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:t===ccui.Widget.RIGHT?this.onPassFocusToChild=r.x>n.x?this._findFarthestChildWidgetIndex:this._findNearestChildWidgetIndex:t===ccui.Widget.DOWN?this.onPassFocusToChild=r.y>n.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:t===ccui.Widget.UP?this.onPassFocusToChild=r.y<n.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:exports.cc.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var t=this._children,e=0,r=t.length;e<r;e++){var n=t[e];if(n instanceof ccui.Layout){var s=n._findFirstNonLayoutWidget();if(s)return s}else if(n instanceof ccui.Widget)return n}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var t=0,e=this.getChildren(),r=e.length;t<r;){var n=e[t];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return t;t++}return 0},_findFocusEnabledChildWidgetByIndex:function(t){var e=this._getChildWidgetByIndex(t);return e?e.isFocusEnabled()?e:(t=t+1,this._findFocusEnabledChildWidgetByIndex(t)):null},_getWorldCenterPoint:function(t){var e=t instanceof ccui.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(exports.cc.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var r=null,n=this._children,s=n.indexOf(e);return s=s+1,s<n.length?(r=this._getChildWidgetByIndex(s),r?r.isFocusEnabled()?r instanceof ccui.Layout?(r._isFocusPassing=!0,r.findNextFocusedWidget(t,r)):(this.dispatchFocusEvent(e,r),r):this._getNextFocusedWidget(t,r):e):this._loopFocus?this._checkFocusEnabledChild()?(s=0,r=this._getChildWidgetByIndex(s),r.isFocusEnabled()?r instanceof ccui.Layout?(r._isFocusPassing=!0,r.findNextFocusedWidget(t,r)):(this.dispatchFocusEvent(e,r),r):this._getNextFocusedWidget(t,r)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getPreviousFocusedWidget:function(t,e){var r=null,n=this._children,s=n.indexOf(e);return s=s-1,s>=0?(r=this._getChildWidgetByIndex(s),r.isFocusEnabled()?r instanceof ccui.Layout?(r._isFocusPassing=!0,r.findNextFocusedWidget(t,r)):(this.dispatchFocusEvent(e,r),r):this._getPreviousFocusedWidget(t,r)):this._loopFocus?this._checkFocusEnabledChild()?(s=n.length-1,r=this._getChildWidgetByIndex(s),r.isFocusEnabled()?r instanceof ccui.Layout?(r._isFocusPassing=!0,r.findNextFocusedWidget(t,r)):(this.dispatchFocusEvent(e,r),r):this._getPreviousFocusedWidget(t,r)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:this._isLastWidgetInContainer(e,t)?this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this)},_getChildWidgetByIndex:function(t){for(var e=this._children,r=e.length,n=t;t<r;){var s=e[t];if(s&&s instanceof ccui.Widget)return s;t++}for(var o=0;o<n;){var a=e[o];if(a&&a instanceof ccui.Widget)return a;o++}return null},_isLastWidgetInContainer:function(t,e){var r=t.getParent();if(r==null||!(r instanceof ccui.Layout))return!0;var n=r.getChildren(),s=n.indexOf(t);if(r.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(e===ccui.Widget.LEFT)return s===0?this._isLastWidgetInContainer(r,e):!1;if(e===ccui.Widget.RIGHT)return s===n.length-1?this._isLastWidgetInContainer(r,e):!1;if(e===ccui.Widget.DOWN)return this._isLastWidgetInContainer(r,e);if(e===ccui.Widget.UP)return this._isLastWidgetInContainer(r,e)}else if(r.getLayoutType()===ccui.Layout.LINEAR_VERTICAL){if(e===ccui.Widget.UP)return s===0?this._isLastWidgetInContainer(r,e):!1;if(e===ccui.Widget.DOWN)return s===n.length-1?this._isLastWidgetInContainer(r,e):!1;if(e===ccui.Widget.LEFT)return this._isLastWidgetInContainer(r,e);if(e===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(r,e)}else return exports.cc.log("invalid layout Type"),!1},_isWidgetAncestorSupportLoopFocus:function(t,e){var r=t.getParent();if(r==null||!(r instanceof ccui.Layout))return!1;if(r.isLoopFocus()){var n=r.getLayoutType();return n===ccui.Layout.LINEAR_HORIZONTAL?e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT?!0:this._isWidgetAncestorSupportLoopFocus(r,e):n===ccui.Layout.LINEAR_VERTICAL?e===ccui.Widget.DOWN||e===ccui.Widget.UP?!0:this._isWidgetAncestorSupportLoopFocus(r,e):(exports.cc.assert(0,"invalid layout type"),!1)}else return this._isWidgetAncestorSupportLoopFocus(r,e)},_passFocusToChild:function(t,e){if(this._checkFocusEnabledChild()){var r=ccui.Widget.getCurrentFocusedWidget();this._findProperSearchingFunctor(t,r);var n=this.onPassFocusToChild(t,r),s=this._getChildWidgetByIndex(n);return s instanceof ccui.Layout?(s._isFocusPassing=!0,s.findNextFocusedWidget(t,s)):(this.dispatchFocusEvent(e,s),s)}else return this},_checkFocusEnabledChild:function(){for(var t=this._children,e=0,r=t.length;e<r;e++){var n=t[e];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(t){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled),this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType),this.setBackGroundImageCapInsets(t._backGroundImageCapInsets),this.setBackGroundColorType(t._colorType),this.setBackGroundColor(t._color),this.setBackGroundColor(t._startColor,t._endColor),this.setBackGroundColorOpacity(t._opacity),this.setBackGroundColorVector(t._alongVector),this.setLayoutType(t._layoutType),this.setClippingEnabled(t._clippingEnabled),this.setClippingType(t._clippingType),this._loopFocus=t._loopFocus,this.__passFocusToChild=t.__passFocusToChild,this._isInterceptTouch=t._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new ccui.Layout.WebGLRenderCmd(this):new ccui.Layout.CanvasRenderCmd(this)}});var _p=ccui.Layout.prototype;_p.clippingEnabled;exports.cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled);_p.clippingType;exports.cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType);_p.layoutType;exports.cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType);_p=null;ccui.Layout.create=function(){return new ccui.Layout};ccui.Layout.BG_COLOR_NONE=0;ccui.Layout.BG_COLOR_SOLID=1;ccui.Layout.BG_COLOR_GRADIENT=2;ccui.Layout.ABSOLUTE=0;ccui.Layout.LINEAR_VERTICAL=1;ccui.Layout.LINEAR_HORIZONTAL=2;ccui.Layout.RELATIVE=3;ccui.Layout.CLIPPING_STENCIL=0;ccui.Layout.CLIPPING_SCISSOR=1;ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1;ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2;(function(){ccui.Layout.CanvasRenderCmd=function(e){ccui.ProtectedNode.CanvasRenderCmd.call(this,e),this._needDraw=!1,this._rendererSaveCmd=new exports.cc.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererClipCmd=new exports.cc.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new exports.cc.CustomRenderCmd(this,this._onRenderRestoreCmd),this._rendererSaveCmd._canUseDirtyRegion=!0,this._rendererClipCmd._canUseDirtyRegion=!0,this._rendererRestoreCmd._canUseDirtyRegion=!0};var t=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);t.constructor=ccui.Layout.CanvasRenderCmd,exports.cc.game.addEventListener(exports.cc.game.EVENT_RENDERER_INITED,function(){ccui.Widget.CanvasRenderCmd&&(ccui.Layout.CanvasRenderCmd.prototype.widgetVisit=ccui.Widget.CanvasRenderCmd.prototype.widgetVisit)}),t.visit=function(e){var r=this._node;if(r._visible)if(r._adaptRenderers(),r._doLayout(),r._clippingEnabled)switch(r._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(e);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(e);break}else this.widgetVisit(e)},t.layoutVisit=t.visit,t._onRenderSaveCmd=function(e,r,n){var s=e||exports.cc._renderContext,o=s.getContext();s.save(),s.save(),s.setTransform(this._worldTransform,r,n);for(var a=this._node._clippingStencil._renderCmd._buffer,c=0,l=a.length;c<l;c++){var h=a[c],u=h.verts,_=u[0];o.beginPath(),o.moveTo(_.x,-_.y);for(var d=1,f=u.length;d<f;d++)o.lineTo(u[d].x,-u[d].y);o.closePath()}},t._onRenderClipCmd=function(e){var r=e||exports.cc._renderContext,n=r.getContext();r.restore(),n.clip()},t._onRenderRestoreCmd=function(e){var r=e||exports.cc._renderContext;r.getContext(),r.restore()},t.rebindStencilRendering=function(e){e._renderCmd.rendering=this.__stencilDraw,e._renderCmd._canUseDirtyRegion=!0},t.__stencilDraw=function(e,r,n){},t.stencilClippingVisit=t.scissorClippingVisit=function(e){var r=this._node;if(!(!r._clippingStencil||!r._clippingStencil.isVisible())){this._syncStatus(e),exports.cc.renderer.pushRenderCommand(this._rendererSaveCmd),r._clippingStencil.visit(this),exports.cc.renderer.pushRenderCommand(this._rendererClipCmd),r.sortAllChildren(),r.sortAllProtectedChildren();for(var n=r._children,s=0,o=r._protectedChildren,a=0,c,l=n.length,h=o.length;a<l&&(c=n[a],c&&c.getLocalZOrder()<0);a++)c.visit(this);for(;s<h&&(c=o[s],c&&c.getLocalZOrder()<0);s++)c.visit(this);for(;a<l;a++)n[a].visit(this);for(;s<h;s++)o[s].visit(this);exports.cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}},ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return exports.cc.ClippingNode._sharedCache||(exports.cc.ClippingNode._sharedCache=document.createElement("canvas"))}})();(function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.Layout.WebGLRenderCmd=function(e){ccui.ProtectedNode.WebGLRenderCmd.call(this,e),this._needDraw=!1,this._currentStencilEnabled=0,this._scissorOldState=!1,this._clippingOldRect=null,this._mask_layer_le=0,this._beforeVisitCmdStencil=new exports.cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new exports.cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new exports.cc.CustomRenderCmd(this,this._onAfterVisitStencil),this._beforeVisitCmdScissor=new exports.cc.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new exports.cc.CustomRenderCmd(this,this._onAfterVisitScissor)};var t=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);t.constructor=ccui.Layout.WebGLRenderCmd,t.visit=function(e){var r=this._node;if(r._visible)if(e&&e._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty&&(r._clippingRectDirty=!0),r._adaptRenderers(),r._doLayout(),r._clippingEnabled)switch(r._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(e);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(e);break}else this.pNodeVisit(e)},t.layoutVisit=t.visit,t._onBeforeVisitStencil=function(e){var r=e||exports.cc._renderContext;ccui.Layout.WebGLRenderCmd._layer++;var n=1<<ccui.Layout.WebGLRenderCmd._layer,s=n-1;this._mask_layer_le=n|s,this._currentStencilEnabled=r.isEnabled(r.STENCIL_TEST),r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.depthMask(!1),r.stencilFunc(r.NEVER,n,n),r.stencilOp(r.REPLACE,r.KEEP,r.KEEP),r.stencilMask(n),r.clear(r.STENCIL_BUFFER_BIT)},t._onAfterDrawStencil=function(e){var r=e||exports.cc._renderContext;r.depthMask(!0),r.stencilFunc(r.EQUAL,this._mask_layer_le,this._mask_layer_le),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)},t._onAfterVisitStencil=function(e){var r=e||exports.cc._renderContext;if(ccui.Layout.WebGLRenderCmd._layer--,this._currentStencilEnabled){var n=1<<ccui.Layout.WebGLRenderCmd._layer,s=n-1,o=n|s;r.stencilMask(n),r.stencilFunc(r.EQUAL,o,o)}else r.disable(r.STENCIL_TEST)},t._onBeforeVisitScissor=function(e){this._node._clippingRectDirty=!0;var r=this._node._getClippingRect(),n=e||exports.cc._renderContext;this._scissorOldState=n.isEnabled(n.SCISSOR_TEST),this._scissorOldState?(this._clippingOldRect=exports.cc.view.getScissorRect(),exports.cc.rectEqualToRect(this._clippingOldRect,r)||exports.cc.view.setScissorInPoints(r.x,r.y,r.width,r.height)):(n.enable(n.SCISSOR_TEST),exports.cc.view.setScissorInPoints(r.x,r.y,r.width,r.height))},t._onAfterVisitScissor=function(e){var r=e||exports.cc._renderContext;this._scissorOldState?exports.cc.rectEqualToRect(this._clippingOldRect,this._node._clippingRect)||exports.cc.view.setScissorInPoints(this._clippingOldRect.x,this._clippingOldRect.y,this._clippingOldRect.width,this._clippingOldRect.height):r.disable(r.SCISSOR_TEST)},t.rebindStencilRendering=function(e){},t.transform=function(e,r){var n=this._node;this.pNodeTransform(e,r),n._clippingStencil&&n._clippingStencil._renderCmd.transform(this,r)},t.stencilClippingVisit=function(e){var r=this._node;if(!(!r._clippingStencil||!r._clippingStencil.isVisible())){if(ccui.Layout.WebGLRenderCmd._layer+1===exports.cc.stencilBits){ccui.Layout.WebGLRenderCmd._visit_once=!0,ccui.Layout.WebGLRenderCmd._visit_once&&(exports.cc.log("Nesting more than "+exports.cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1),exports.cc.Node.prototype.visit.call(r,e);return}exports.cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var n=exports.cc.current_stack;n.stack.push(n.top),this._syncStatus(e),this._dirtyFlag=0,n.top=this._stackMatrix,r._clippingStencil.visit(this),exports.cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var s=0,o=0;r.sortAllChildren(),r.sortAllProtectedChildren();for(var a=r._children,c=r._protectedChildren,l=a.length,h=c.length,u;s<l&&(u=a[s],u&&u.getLocalZOrder()<0);s++)u.visit(this);for(;o<h&&(u=c[o],u&&u.getLocalZOrder()<0);o++)u.visit(this);for(;s<l;s++)a[s].visit(this);for(;o<h;o++)c[o].visit(this);exports.cc.renderer.pushRenderCommand(this._afterVisitCmdStencil),n.top=n.stack.pop()}},t.scissorClippingVisit=function(e){exports.cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor),this.pNodeVisit(e),exports.cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)},ccui.Layout.WebGLRenderCmd._layer=-1,ccui.Layout.WebGLRenderCmd._visit_once=null}})();ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,r,n){t!==void 0&&e===void 0&&(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom),n!==void 0&&(this.left=t,this.top=e,this.right=r,this.bottom=n)},setMargin:function(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}});ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)};ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin,this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(t){exports.cc.isObject(t)?(this._margin.left=t.left,this._margin.top=t.top,this._margin.right=t.right,this._margin.bottom=t.bottom):(this._margin.left=arguments[0],this._margin.top=arguments[1],this._margin.right=arguments[2],this._margin.bottom=arguments[3])},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom,this._margin.left=t._margin.left,this._margin.right=t._margin.right,this._margin.top=t._margin.top}});ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter};ccui.LayoutParameter.NONE=0;ccui.LayoutParameter.LINEAR=1;ccui.LayoutParameter.RELATIVE=2;ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._linearGravity=ccui.LinearLayoutParameter.NONE,this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.LinearLayoutParameter&&this.setGravity(t._linearGravity)}});ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter};ccui.LinearLayoutParameter.NONE=0;ccui.LinearLayoutParameter.LEFT=1;ccui.LinearLayoutParameter.TOP=2;ccui.LinearLayoutParameter.RIGHT=3;ccui.LinearLayoutParameter.BOTTOM=4;ccui.LinearLayoutParameter.CENTER_VERTICAL=5;ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6;ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=ccui.RelativeLayoutParameter.NONE,this._relativeWidgetName="",this._relativeLayoutName="",this._put=!1,this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.RelativeLayoutParameter&&(this.setAlign(t._relativeAlign),this.setRelativeToWidgetName(t._relativeWidgetName),this.setRelativeName(t._relativeLayoutName))}});ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter};ccui.RelativeLayoutParameter.NONE=0;ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1;ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3;ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4;ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5;ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7;ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8;ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9;ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10;ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11;ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18;ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19;ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20;ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21;ccui.LINEAR_GRAVITY_NONE=0;ccui.LINEAR_GRAVITY_LEFT=1;ccui.LINEAR_GRAVITY_TOP=2;ccui.LINEAR_GRAVITY_RIGHT=3;ccui.LINEAR_GRAVITY_BOTTOM=4;ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5;ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6;ccui.RELATIVE_ALIGN_NONE=0;ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1;ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3;ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4;ccui.RELATIVE_ALIGN_PARENT_CENTER=5;ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7;ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8;ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12;ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13;ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14;ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18;ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19;ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20;ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21;ccui.getLayoutManager=function(t){switch(t){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null};ccui.linearVerticalLayoutManager={_doLayout:function(t){for(var e=t._getLayoutContentSize(),r=t._getLayoutElements(),n=e.height,s=0,o=r.length;s<o;s++){var a=r[s];if(a){var c=a.getLayoutParameter();if(c){var l=c.getGravity(),h=a.getAnchorPoint(),u=a.getContentSize(),_=h.x*u.width,d=n-(1-h.y)*u.height;switch(l){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.LEFT:break;case ccui.LinearLayoutParameter.RIGHT:_=e.width-(1-h.x)*u.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:_=e.width/2-u.width*(.5-h.x);break}var f=c.getMargin();_+=f.left,d-=f.top,a.setPosition(_,d),n=a.getPositionY()-h.y*u.height-f.bottom}}}}};ccui.linearHorizontalLayoutManager={_doLayout:function(t){for(var e=t._getLayoutContentSize(),r=t._getLayoutElements(),n=0,s=0,o=r.length;s<o;s++){var a=r[s];if(a){var c=a.getLayoutParameter();if(c){var l=c.getGravity(),h=a.getAnchorPoint(),u=a.getContentSize(),_=n+h.x*u.width,d=e.height-(1-h.y)*u.height;switch(l){case ccui.LinearLayoutParameter.NONE:case ccui.LinearLayoutParameter.TOP:break;case ccui.LinearLayoutParameter.BOTTOM:d=h.y*u.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:d=e.height/2-u.height*(.5-h.y);break}var f=c.getMargin();_+=f.left,d-=f.top,a.setPosition(_,d),n=a.getRightBoundary()+f.right}}}}};ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(t){this._widgetChildren=this._getAllWidgets(t);for(var e=this._widgetChildren;this._unlayoutChildCount>0;){for(var r=0,n=e.length;r<n;r++){this._widget=e[r];var s=this._widget.getLayoutParameter();if(s){if(s._put)continue;var o=this._calculateFinalPositionWithRelativeWidget(t);if(!o)continue;this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),s._put=!0}}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(t){var e=t._getLayoutElements(),r=this._widgetChildren;r.length=0;for(var n=0,s=e.length;n<s;n++){var o=e[n];if(o&&o instanceof ccui.Widget){var a=o.getLayoutParameter();a._put=!1,this._unlayoutChildCount++,r.push(o)}}return r},_getRelativeWidget:function(t){var e=null,r=t.getLayoutParameter(),n=r.getRelativeToWidgetName();if(n&&n.length!==0)for(var s=this._widgetChildren,o=0,a=s.length;o<a;o++){var c=s[o];if(c){var l=c.getLayoutParameter();if(l&&l.getRelativeName()===n){e=c,this._relativeWidgetLP=l;break}}}return e},_calculateFinalPositionWithRelativeWidget:function(t){var e=this._widget,r=e.getAnchorPoint(),n=e.getContentSize();this._finalPositionX=0,this._finalPositionY=0;var s=this._getRelativeWidget(e),o=e.getLayoutParameter(),a=o.getAlign(),c=t._getLayoutContentSize();switch(a){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=r.x*n.width,this._finalPositionY=c.height-(1-r.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=c.width*.5-n.width*(.5-r.x),this._finalPositionY=c.height-(1-r.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=c.width-(1-r.x)*n.width,this._finalPositionY=c.height-(1-r.y)*n.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=r.x*n.width,this._finalPositionY=c.height*.5-n.height*(.5-r.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=c.width*.5-n.width*(.5-r.x),this._finalPositionY=c.height*.5-n.height*(.5-r.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=c.width-(1-r.x)*n.width,this._finalPositionY=c.height*.5-n.height*(.5-r.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=r.x*n.width,this._finalPositionY=r.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=c.width*.5-n.width*(.5-r.x),this._finalPositionY=r.y*n.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=c.width-(1-r.x)*n.width,this._finalPositionY=r.y*n.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()+r.y*n.height,this._finalPositionX=s.getLeftBoundary()+r.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var l=s.getContentSize();this._finalPositionY=s.getTopBoundary()+r.y*n.height,this._finalPositionX=s.getLeftBoundary()+l.width*.5+r.x*n.width-n.width*.5}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()+r.y*n.height,this._finalPositionX=s.getRightBoundary()-(1-r.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()-(1-r.y)*n.height,this._finalPositionX=s.getLeftBoundary()-(1-r.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var l=s.getContentSize();this._finalPositionX=s.getLeftBoundary()-(1-r.x)*n.width,this._finalPositionY=s.getBottomBoundary()+l.height*.5+r.y*n.height-n.height*.5}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()+r.y*n.height,this._finalPositionX=s.getLeftBoundary()-(1-r.x)*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getTopBoundary()-(1-r.y)*n.height,this._finalPositionX=s.getRightBoundary()+r.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var l=s.getContentSize(),h=s.getRightBoundary();this._finalPositionX=h+r.x*n.width,this._finalPositionY=s.getBottomBoundary()+l.height*.5+r.y*n.height-n.height*.5}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()+r.y*n.height,this._finalPositionX=s.getRightBoundary()+r.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()-(1-r.y)*n.height,this._finalPositionX=s.getLeftBoundary()+r.x*n.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;var l=s.getContentSize();this._finalPositionY=s.getBottomBoundary()-(1-r.y)*n.height,this._finalPositionX=s.getLeftBoundary()+l.width*.5+r.x*n.width-n.width*.5}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(s){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=s.getBottomBoundary()-(1-r.y)*n.height,this._finalPositionX=s.getRightBoundary()-(1-r.x)*n.width}break}return!0},_calculateFinalPositionWithRelativeAlign:function(){var t=this._widget.getLayoutParameter(),e=t.getMargin(),r=t.getAlign();switch(r){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=e.bottom,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=e.right,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=e.right,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=e.left,this._finalPositionY-=e.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=e.left,this._finalPositionY+=e.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=e.top,this._finalPositionX+=e.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=e.top,this._finalPositionX-=e.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=e.top;break}}};ccui.HBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL),t&&this.setContentSize(t)}});ccui.HBox.create=function(t){return new ccui.HBox(t)};ccui.RelativeBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.RELATIVE),t&&this.setContentSize(t)}});ccui.RelativeBox.create=function(t){return new ccui.RelativeBox(t)};ccui.VBox=ccui.Layout.extend({ctor:function(t){ccui.Layout.prototype.ctor.call(this),this.setLayoutType(ccui.Layout.LINEAR_VERTICAL),t&&this.setContentSize(t)},initWithSize:function(t){return!!this.init()}});ccui.VBox.create=function(t){return new ccui.VBox(t)};ccui.helper={seekWidgetByTag:function(t,e){if(!t)return null;if(t.getTag()===e)return t;for(var r=t.getChildren(),n=r.length,s=0;s<n;s++){var o=r[s],a=ccui.helper.seekWidgetByTag(o,e);if(a!==null)return a}return null},seekWidgetByName:function(t,e){if(!t)return null;if(t.getName()===e)return t;for(var r=t.getChildren(),n=r.length,s=0;s<n;s++){var o=r[s],a=ccui.helper.seekWidgetByName(o,e);if(a!==null)return a}return null},seekWidgetByRelativeName:function(t,e){if(!t)return null;for(var r=t.getChildren(),n=r.length,s=0;s<n;s++){var o=r[s],a=o.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(a&&a.getRelativeName()===e)return o}return null},seekActionWidgetByActionTag:function(t,e){if(!t)return null;if(t.getActionTag()===e)return t;for(var r=t.getChildren(),n=0;n<r.length;n++){var s=r[n],o=ccui.helper.seekActionWidgetByActionTag(s,e);if(o!==null)return o}return null},_activeLayout:!0,doLayout:function(t){if(this._activeLayout)for(var e=t.getChildren(),r,n=0,s=e.length;n<s;n++){r=e[n];var o=r.getComponent(ccui.LayoutComponent.NAME),a=r.getParent();o!=null&&a!==null&&o.refreshLayout&&o.refreshLayout()}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var r=t.x,n=t.y,s=t.width,o=t.height;return e.width<s&&(r=0,s=0),e.height<o&&(n=0,o=0),exports.cc.rect(r,n,s,o)},_createSpriteFromBase64:function(t,e){var r=exports.cc.textureCache.getTextureForKey(e);if(!r){var n=new Image;n.src=t,exports.cc.textureCache.cacheImage(e,n),r=exports.cc.textureCache.getTextureForKey(e)}var s=new exports.cc.Sprite(r);return s}};ccui.Button=ccui.Widget.extend({_buttonNormalRenderer:null,_buttonClickedRenderer:null,_buttonDisableRenderer:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_capInsetsPressed:null,_capInsetsDisabled:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,_pressedTextureSize:null,_disabledTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_normalTextureScaleXInSize:1,_normalTextureScaleYInSize:1,_pressedTextureScaleXInSize:1,_pressedTextureScaleYInSize:1,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_pressedTextureAdaptDirty:!0,_disabledTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,r,n){this._capInsetsNormal=exports.cc.rect(0,0,0,0),this._capInsetsPressed=exports.cc.rect(0,0,0,0),this._capInsetsDisabled=exports.cc.rect(0,0,0,0),this._normalTextureSize=exports.cc.size(0,0),this._pressedTextureSize=exports.cc.size(0,0),this._disabledTextureSize=exports.cc.size(0,0),this._titleColor=exports.cc.color.WHITE,ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),t&&this.loadTextures(t,e,r,n)},_initRenderer:function(){this._buttonNormalRenderer=new exports.cc.Sprite,this._buttonClickedRenderer=new exports.cc.Sprite,this._buttonDisableRenderer=new exports.cc.Sprite,this._titleRenderer=new exports.cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._scale9Enabled=t,this.removeProtectedChild(this._buttonNormalRenderer),this.removeProtectedChild(this._buttonClickedRenderer),this.removeProtectedChild(this._buttonDisableRenderer),this._scale9Enabled?(this._buttonNormalRenderer=new ccui.Scale9Sprite,this._buttonClickedRenderer=new ccui.Scale9Sprite,this._buttonDisableRenderer=new ccui.Scale9Sprite):(this._buttonNormalRenderer=new exports.cc.Sprite,this._buttonClickedRenderer=new exports.cc.Sprite,this._buttonDisableRenderer=new exports.cc.Sprite),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this.loadTextureNormal(this._normalFileName,this._normalTexType),this.loadTexturePressed(this._clickedFileName,this._pressedTexType),this.loadTextureDisabled(this._disabledFileName,this._disabledTexType),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsetsNormalRenderer(this._capInsetsNormal),this.setCapInsetsPressedRenderer(this._capInsetsPressed),this.setCapInsetsDisabledRenderer(this._capInsetsDisabled),this.setBright(this._bright),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){if(this._unifySize){this._updateContentSize();return}(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&this._titleRenderer.getString().length>0?this._titleRenderer.getContentSize():exports.cc.size(this._normalTextureSize)},loadTextures:function(t,e,r,n){this.loadTextureNormal(t,n),this.loadTexturePressed(e,n),this.loadTextureDisabled(r,n)},loadTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._normalFileName=t,this._normalTexType=e;var r=this||window,n=this._buttonNormalRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){r.loadTextureNormal(r._normalFileName,r._normalTexType)}),this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break}this._normalTextureLoaded=n._textureLoaded,this._normalTextureSize=this._buttonNormalRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(n.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=!0,this._findLayout()}},loadTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._clickedFileName=t,this._pressedTexType=e;var r=this||window,n=this._buttonClickedRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){r.loadTexturePressed(r._clickedFileName,r._pressedTexType)}),this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break}this._scale9Enabled&&n.setCapInsets(this._capInsetsPressed),this._pressedTextureSize=this._buttonClickedRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0,this._pressedTextureAdaptDirty=!0,this._findLayout()}},loadTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._disabledFileName=t,this._disabledTexType=e;var r=this||window,n=this._buttonDisableRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){r.loadTextureDisabled(r._disabledFileName,r._disabledTexType)}),this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t);break}this._scale9Enabled&&n.setCapInsets(this._capInsetsDisabled),this._disabledTextureSize=this._buttonDisableRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._disabledTextureAdaptDirty=!0,this._findLayout()}},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t),this.setCapInsetsPressedRenderer(t),this.setCapInsetsDisabledRenderer(t)},setCapInsetsNormalRenderer:function(t){if(t){var e=t.x,r=t.y,n=t.width,s=t.height;this._normalTextureSize.width<n&&(e=0,n=0),this._normalTextureSize.height<s&&(r=0,s=0);var o=this._capInsetsNormal;o.x=e,o.y=r,o.width=n,o.height=s,this._scale9Enabled&&this._buttonNormalRenderer.setCapInsets(o)}},getCapInsetsNormalRenderer:function(){return exports.cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){if(!(!t||!this._scale9Enabled)){var e=t.x,r=t.y,n=t.width,s=t.height;this._pressedTextureSize.width<n&&(e=0,n=0),this._pressedTextureSize.height<s&&(r=0,s=0);var o=this._capInsetsPressed;o.x=e,o.y=r,o.width=n,o.height=s,this._buttonClickedRenderer.setCapInsets(o)}},getCapInsetsPressedRenderer:function(){return exports.cc.rect(this._capInsetsPressed)},setCapInsetsDisabledRenderer:function(t){if(!(!t||!this._scale9Enabled)){var e=t.x,r=t.y,n=t.width,s=t.height;this._disabledTextureSize.width<n&&(e=0,n=0),this._disabledTextureSize.height<s&&(r=0,s=0);var o=this._capInsetsDisabled;o.x=e,o.y=r,o.width=n,o.height=s,this._buttonDisableRenderer.setCapInsets(o)}},getCapInsetsDisabledRenderer:function(){return exports.cc.rect(this._capInsetsDisabled)},_onPressStateChangedToNormal:function(){if(this._buttonNormalRenderer.setVisible(!0),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(this.pressedActionEnabled)if(this._buttonNormalRenderer.stopAllActions(),this._buttonClickedRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._unifySize){var t=exports.cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1);this._titleRenderer.runAction(t)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonNormalRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._scale9Enabled&&this._buttonNormalRenderer.setColor(exports.cc.color.WHITE),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)},_onPressStateChangedToPressed:function(){var t=this._buttonNormalRenderer;if(this._scale9Enabled&&t.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded){if(t.setVisible(!1),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),this.pressedActionEnabled){t.stopAllActions(),this._buttonClickedRenderer.stopAllActions();var e=exports.cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale);this._buttonClickedRenderer.runAction(e),t.setScale(this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(exports.cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale))}}else t.setVisible(!0),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),t.stopAllActions(),t.setScale(this._normalTextureScaleXInSize+this._zoomScale,this._normalTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?(this._buttonNormalRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!0)):this._normalTextureLoaded&&this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.GRAY),this._buttonClickedRenderer.setVisible(!1),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var t=this._getNormalSize();ccui.ProtectedNode.setContentSize(t)}this._onSizeChanged();return}this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._updateTitleLocation(),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0},getVirtualRenderer:function(){if(this._bright)switch(this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:return this._buttonNormalRenderer;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:return this._buttonClickedRenderer;default:return null}else return this._buttonDisableRenderer},_normalTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonNormalRenderer.setScale(1),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonNormalRenderer.setPreferredSize(this._contentSize),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1,this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);else{var t=this._normalTextureSize;if(t.width<=0||t.height<=0){this._buttonNormalRenderer.setScale(1);return}var e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._buttonNormalRenderer.setScaleX(e),this._buttonNormalRenderer.setScaleY(r),this._normalTextureScaleXInSize=e,this._normalTextureScaleYInSize=r}this._buttonNormalRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_pressedTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonClickedRenderer.setScale(1),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonClickedRenderer.setPreferredSize(this._contentSize),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1,this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize);else{var t=this._pressedTextureSize;if(t.width<=0||t.height<=0){this._buttonClickedRenderer.setScale(1);return}var e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._buttonClickedRenderer.setScaleX(e),this._buttonClickedRenderer.setScaleY(r),this._pressedTextureScaleXInSize=e,this._pressedTextureScaleYInSize=r}this._buttonClickedRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_disabledTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled&&this._buttonDisableRenderer.setScale(1);else if(this._scale9Enabled)this._buttonDisableRenderer.setScale(1),this._buttonDisableRenderer.setPreferredSize(this._contentSize);else{var t=this._disabledTextureSize;if(t.width<=0||t.height<=0){this._buttonDisableRenderer.setScale(1);return}var e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._buttonDisableRenderer.setScaleX(e),this._buttonDisableRenderer.setScaleY(r)}this._buttonDisableRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1),this._pressedTextureAdaptDirty&&(this._pressedTextureScaleChangedWithSize(),this._pressedTextureAdaptDirty=!1),this._disabledTextureAdaptDirty&&(this._disabledTextureScaleChangedWithSize(),this._disabledTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(this._contentSize.width*.5,this._contentSize.height*.5)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){if(t!==this.getTitleText())if(this._titleRenderer.setString(t),this._ignoreSize){var e=this.getVirtualRendererSize();this.setContentSize(e)}else this._titleRenderer._renderCmd._updateTTF()},getTitleText:function(){return this._titleRenderer.getString()},setTitleColor:function(t){this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer._getFillStyle()},setTitleFontSize:function(t){this._titleRenderer.setFontSize(t),this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer.getFontSize()},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._titleRenderer.setFontName(t),this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer.getFontName()},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTextureNormal(t._normalFileName,t._normalTexType),this.loadTexturePressed(t._clickedFileName,t._pressedTexType),this.loadTextureDisabled(t._disabledFileName,t._disabledTexType),this.setCapInsetsNormalRenderer(t._capInsetsNormal),this.setCapInsetsPressedRenderer(t._capInsetsPressed),this.setCapInsetsDisabledRenderer(t._capInsetsDisabled),this.setTitleText(t.getTitleText()),this.setTitleFontName(t.getTitleFontName()),this.setTitleFontSize(t.getTitleFontSize()),this.setTitleColor(t.getTitleColor()),this.setPressedActionEnabled(t.pressedActionEnabled),this.setZoomScale(t._zoomScale)},_getNormalSize:function(){var t;this._titleRenderer!==null&&(t=this._titleRenderer.getContentSize());var e;this._buttonNormalRenderer!==null&&(e=this._buttonNormalRenderer.getContentSize());var r=t.width>e.width?t.width:e.width,n=t.height>e.height?t.height:e.height;return exports.cc.size(r,n)}});var _p=ccui.Button.prototype;_p.titleText;exports.cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText);_p.titleFont;exports.cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont);_p.titleFontSize;exports.cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize);_p.titleFontName;exports.cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName);_p.titleColor;exports.cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor);_p=null;ccui.Button.create=function(t,e,r,n){return new ccui.Button(t,e,r,n)};ccui.Button.NORMAL_RENDERER_ZORDER=-2;ccui.Button.PRESSED_RENDERER_ZORDER=-2;ccui.Button.DISABLED_RENDERER_ZORDER=-2;ccui.Button.TITLE_RENDERER_ZORDER=-1;ccui.Button.ZOOM_ACTION_TIME_STEP=.05;ccui.Button.SYSTEM=0;ccui.Button.TTF=1;ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(t,e,r,n,s,o){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var a=0,c=0;c<arguments.length;c++){var l=typeof arguments[c];l==="string"?isNaN(arguments[c]-0)?a++:(o=arguments[c],arguments[c]=void 0):l==="number"&&a++}switch(a){case 2:o=r,r=e,e=void 0}o=o===void 0?0:o,this._isSelected=!0,this.setSelected(!1),this.loadTextures(t,e,r,n,s,o)},_initRenderer:function(){this._backGroundBoxRenderer=new exports.cc.Sprite,this._backGroundSelectedBoxRenderer=new exports.cc.Sprite,this._frontCrossRenderer=new exports.cc.Sprite,this._backGroundBoxDisabledRenderer=new exports.cc.Sprite,this._frontCrossDisabledRenderer=new exports.cc.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,r,n,s,o){t&&this.loadTextureBackGround(t,o),e&&this.loadTextureBackGroundSelected(e,o),r&&this.loadTextureFrontCross(r,o),n&&this.loadTextureBackGroundDisabled(n,o),s&&this.loadTextureFrontCrossDisabled(s,o)},loadTextureBackGround:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundFileName=t,this._backGroundTexType=e;var r=this._backGroundBoxRenderer;switch(r._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):r.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this),this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=t,this._backGroundSelectedTexType=e;var r=this._backGroundSelectedBoxRenderer;switch(r._textureLoaded||r.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this),this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossFileName=t,this._frontCrossTexType=e;var r=this._frontCrossRenderer;switch(r._textureLoaded||r.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this),this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=t,this._backGroundDisabledTexType=e;var r=this._backGroundBoxDisabledRenderer;switch(r._textureLoaded||r.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this),this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=t,this._frontCrossDisabledTexType=e;var r=this._frontCrossDisabledRenderer;switch(r._textureLoaded||r.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this),this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){t!==this._isSelected&&(this._isSelected=t,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t,this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._backGroundBoxRendererAdaptDirty=!0,this._backGroundSelectedBoxRendererAdaptDirty=!0,this._frontCrossRendererAdaptDirty=!0,this._backGroundBoxDisabledRendererAdaptDirty=!0,this._frontCrossDisabledRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var r=t.getContentSize();if(r.width<=0||r.height<=0){t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;return}var n=e.width/r.width,s=e.height/r.height;this._backgroundTextureScaleX=n,this._backgroundTextureScaleY=s,t.setScaleX(n),t.setScaleY(s)}t.setPosition(e.width*.5,e.height*.5)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var r=t.getContentSize();if(r.width<=0||r.height<=0){t.setScale(1);return}var n=e.width/r.width,s=e.height/r.height;t.setScaleX(n),t.setScaleY(s)}t.setPosition(e.width*.5,e.height*.5)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var r=t.getContentSize();if(r.width<=0||r.height<=0){t.setScale(1);return}var n=e.width/r.width,s=e.height/r.height;t.setScaleX(n),t.setScaleY(s)}t.setPosition(e.width*.5,e.height*.5)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var r=t.getContentSize();if(r.width<=0||r.height<=0){t.setScale(1);return}var n=e.width/r.width,s=e.height/r.height;t.setScaleX(n),t.setScaleY(s)}t.setPosition(e.width*.5,e.height*.5)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var r=t.getContentSize();if(r.width<=0||r.height<=0){t.setScale(1);return}var n=e.width/r.width,s=e.height/r.height;t.setScaleX(n),t.setScaleY(s)}t.setPosition(e.width*.5,e.height*.5)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(t){t instanceof ccui.CheckBox&&(this.loadTextureBackGround(t._backGroundFileName,t._backGroundTexType),this.loadTextureBackGroundSelected(t._backGroundSelectedFileName,t._backGroundSelectedTexType),this.loadTextureFrontCross(t._frontCrossFileName,t._frontCrossTexType),this.loadTextureBackGroundDisabled(t._backGroundDisabledFileName,t._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(t._frontCrossDisabledFileName,t._frontCrossDisabledTexType),this.setSelected(t._isSelected),this._checkBoxEventListener=t._checkBoxEventListener,this._checkBoxEventSelector=t._checkBoxEventSelector,this._ccEventCallback=t._ccEventCallback,this._zoomScale=t._zoomScale,this._backgroundTextureScaleX=t._backgroundTextureScaleX,this._backgroundTextureScaleY=t._backgroundTextureScaleY)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}});var _p=ccui.CheckBox.prototype;_p.selected;exports.cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);_p=null;ccui.CheckBox.create=function(t,e,r,n,s,o){return new ccui.CheckBox(t,e,r,n,s,o)};ccui.CheckBox.EVENT_SELECTED=0;ccui.CheckBox.EVENT_UNSELECTED=1;ccui.CheckBox.BOX_RENDERER_ZORDER=-1;ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1;ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1;ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(t,e){this._capInsets=exports.cc.rect(0,0,0,0),this._imageTextureSize=exports.cc.size(this._capInsets.width,this._capInsets.height),ccui.Widget.prototype.ctor.call(this),e=e===void 0?0:e,t?this.loadTexture(t,e):this._imageTexType=ccui.Widget.LOCAL_TEXTURE},_initRenderer:function(){this._imageRenderer=new exports.cc.Sprite,this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(t,e){if(t){var r=this||window;e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._imageTexType=e;var n=r._imageRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){r.loadTexture(r._textureFile,r._imageTexType)}),r._imageTexType){case ccui.Widget.LOCAL_TEXTURE:r._scale9Enabled?(n.initWithFile(t),n.setCapInsets(r._capInsets)):n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r._scale9Enabled?(n.initWithSpriteFrameName(t),n.setCapInsets(r._capInsets)):n.initWithSpriteFrameName(t);break}r._imageTextureSize=n.getContentSize(),this._updateChildrenDisplayedRGBA(),r._updateContentSizeWithTextureSize(r._imageTextureSize),r._imageRendererAdaptDirty=!0,r._findLayout()}},setTextureRect:function(t){this._scale9Enabled||this._imageRenderer.setTextureRect(t)},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._imageRenderer),this._imageRenderer=null,this._scale9Enabled?this._imageRenderer=new ccui.Scale9Sprite:this._imageRenderer=new exports.cc.Sprite,this.loadTexture(this._textureFile,this._imageTexType),this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._imageRenderer.setCapInsets(t)}},getCapInsets:function(){return exports.cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return exports.cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){if(this._ignoreSize)this._scale9Enabled||this._imageRenderer.setScale(1);else if(this._scale9Enabled)this._imageRenderer.setPreferredSize(this._contentSize),this._imageRenderer.setScale(1);else{var t=this._imageTextureSize;if(t.width<=0||t.height<=0){this._imageRenderer.setScale(1);return}this._imageRenderer.setScaleX(this._contentSize.width/t.width),this._imageRenderer.setScaleY(this._contentSize.height/t.height)}this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(t){t instanceof ccui.ImageView&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._imageTexType),this.setCapInsets(t._capInsets))},setContentSize:function(t,e){if(e!=null&&(t=exports.cc.size(t,e)),ccui.Widget.prototype.setContentSize.call(this,t),this._scale9Enabled)this._imageRenderer.setContentSize(t);else{var r=this._imageRenderer.getContentSize();this._imageRenderer.setScaleX(t.width/r.width),this._imageRenderer.setScaleY(t.height/r.height)}}});ccui.ImageView.create=function(t,e){return new ccui.ImageView(t,e)};ccui.ImageView.RENDERER_ZORDER=-1;ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(t,e){this._direction=ccui.LoadingBar.TYPE_LEFT,this._barRendererTextureSize=exports.cc.size(0,0),this._capInsets=exports.cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),t!==void 0&&this.loadTexture(t),e!==void 0&&this.setPercent(e)},_initRenderer:function(){this._barRenderer=new exports.cc.Sprite,this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._barRenderer.setAnchorPoint(0,.5)},setDirection:function(t){if(this._direction!==t)switch(this._direction=t,this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,.5),this._barRenderer.setPosition(0,this._contentSize.height*.5),this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,.5),this._barRenderer.setPosition(this._totalLength,this._contentSize.height*.5),this._scale9Enabled||this._barRenderer.setFlippedX(!0);break}},getDirection:function(){return this._direction},loadTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._renderBarTexType=e,this._textureFile=t;var r=this._barRenderer,n=this||window;switch(r._textureLoaded||r.addEventListener("load",function(){n.loadTexture(n._textureFile,n._renderBarTexType),n._setPercent(n._percent)}),this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}var s=r.getContentSize();switch(this._barRendererTextureSize.width=s.width,this._barRendererTextureSize.height=s.height,this._direction){case ccui.LoadingBar.TYPE_LEFT:r.setAnchorPoint(0,.5),this._scale9Enabled||r.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:r.setAnchorPoint(1,.5),this._scale9Enabled||r.setFlippedX(!0);break}this._scale9Enabled&&r.setCapInsets(this._capInsets),this._updateChildrenDisplayedRGBA(),this._barRendererScaleChangedWithSize(),this._updateContentSizeWithTextureSize(this._barRendererTextureSize),this._barRendererAdaptDirty=!0,this._findLayout()}},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new exports.cc.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(t){if(t){var e=this._capInsets;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsets:function(){return exports.cc.rect(this._capInsets)},setPercent:function(t){t>100&&(t=100),t<0&&(t=0),t!==this._percent&&(this._percent=t,this._setPercent(t))},_setPercent:function(){var t,e,r,n;this._totalLength<=0||(t=this._percent/100,this._scale9Enabled?this._setScale9Scale():(r=this._barRenderer,n=this._barRendererTextureSize,e=r.getTextureRect(),e.width=n.width*t,r.setTextureRect(exports.cc.rect(e.x,e.y,n.width*t,n.height),r._rectRotated)))},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),this._totalLength=e===void 0?t.width:t},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return exports.cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){var t=this._barRenderer,e=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,t.setScale(1));else if(this._totalLength=e.width,this._scale9Enabled)this._setScale9Scale(),t.setScale(1);else{var r=this._barRendererTextureSize;if(r.width<=0||r.height<=0){t.setScale(1);return}var n=e.width/r.width,s=e.height/r.height;t.setScaleX(n),t.setScaleY(s)}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:t.setPosition(0,e.height*.5);break;case ccui.LoadingBar.TYPE_RIGHT:t.setPosition(this._totalLength,e.height*.5);break}},_setScale9Scale:function(){var t=this._percent/100*this._totalLength;this._barRenderer.setPreferredSize(exports.cc.size(t,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(t){t instanceof ccui.LoadingBar&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._renderBarTexType),this.setCapInsets(t._capInsets),this.setPercent(t._percent),this.setDirection(t._direction))}});var _p=ccui.LoadingBar.prototype;_p.direction;exports.cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);_p.percent;exports.cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.LoadingBar.create=function(t,e){return new ccui.LoadingBar(t,e)};ccui.LoadingBar.TYPE_LEFT=0;ccui.LoadingBar.TYPE_RIGHT=1;ccui.LoadingBar.RENDERER_ZORDER=-1;ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(t,e,r){this._barTextureSize=exports.cc.size(0,0),this._progressBarTextureSize=exports.cc.size(0,0),this._capInsetsBarRenderer=exports.cc.rect(0,0,0,0),this._capInsetsProgressBarRenderer=exports.cc.rect(0,0,0,0),ccui.Widget.prototype.ctor.call(this),r=r||0,this.setTouchEnabled(!0),t&&this.loadBarTexture(t,r),e&&this.loadSlidBallTextures(e,r)},_initRenderer:function(){this._barRenderer=new exports.cc.Sprite,this._progressBarRenderer=new exports.cc.Sprite,this._progressBarRenderer.setAnchorPoint(0,.5),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._slidBallNormalRenderer=new exports.cc.Sprite,this._slidBallPressedRenderer=new exports.cc.Sprite,this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer=new exports.cc.Sprite,this._slidBallDisabledRenderer.setVisible(!1),this._slidBallRenderer=new exports.cc.Node,this._slidBallRenderer.addChild(this._slidBallNormalRenderer),this._slidBallRenderer.addChild(this._slidBallPressedRenderer),this._slidBallRenderer.addChild(this._slidBallDisabledRenderer),this._slidBallRenderer.setCascadeColorEnabled(!0),this._slidBallRenderer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._barTexType=e;var r=this._barRenderer,n=this||window;switch(r._textureLoaded||r.addEventListener("load",function(){n.loadBarTexture(n._textureFile,n._barTexType)}),this._barTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0,this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize()),this._findLayout(),this._barTextureSize=this._barRenderer.getContentSize()}},loadProgressBarTexture:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._progressBarTextureFile=t,this._progressBarTexType=e;var r=this._progressBarRenderer,n=this||window;switch(r._textureLoaded||r.addEventListener("load",function(){n.loadProgressBarTexture(n._progressBarTextureFile,n._progressBarTexType)}),this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:r.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:r.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._progressBarRenderer.setAnchorPoint(exports.cc.p(0,.5));var s=this._progressBarRenderer.getContentSize();this._progressBarTextureSize={width:s.width,height:s.height},this._progressBarRendererDirty=!0,this._findLayout()}},setScale9Enabled:function(t){if(this._scale9Enabled!==t){if(this._scale9Enabled=t,this.removeProtectedChild(this._barRenderer,!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._barRenderer=null,this._progressBarRenderer=null,this._scale9Enabled?(this._barRenderer=new ccui.Scale9Sprite,this._progressBarRenderer=new ccui.Scale9Sprite):(this._barRenderer=new exports.cc.Sprite,this._progressBarRenderer=new exports.cc.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled){var e=this._ignoreSize;this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=e}else this.ignoreContentAdaptWithSize(this._prevIgnoreSize);this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0}},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){(!this._scale9Enabled||this._scale9Enabled&&!t)&&(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){this.setCapInsetsBarRenderer(t),this.setCapInsetProgressBarRenderer(t)},setCapInsetsBarRenderer:function(t){if(t){var e=this._capInsetsBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._barRenderer.setCapInsets(t)}},getCapInsetsBarRenderer:function(){return exports.cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(t){if(t){var e=this._capInsetsProgressBarRenderer;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled&&this._progressBarRenderer.setCapInsets(t)}},getCapInsetsProgressBarRenderer:function(){return exports.cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(t,e,r,n){this.loadSlidBallTextureNormal(t,n),this.loadSlidBallTexturePressed(e,n),this.loadSlidBallTextureDisabled(r,n)},loadSlidBallTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallNormalTextureFile=t,this._ballNTexType=e;var r=this||window;switch(this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.addEventListener("load",function(){r.loadSlidBallTextureNormal(r._slidBallNormalTextureFile,r._ballNTexType)}),this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallPressedTextureFile=t,this._ballPTexType=e;var r=this||window;switch(this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.addEventListener("load",function(){r.loadSlidBallTexturePressed(r._slidBallPressedTextureFile,r._ballPTexType)}),this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._findLayout()}},loadSlidBallTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._slidBallDisabledTextureFile=t,this._ballDTexType=e;var r=this||window;switch(this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.addEventListener("load",function(){r.loadSlidBallTextureDisabled(r._slidBallDisabledTextureFile,r._ballDTexType)}),this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(t);break}this._updateChildrenDisplayedRGBA(),this._findLayout()}},setPercent:function(t){t>100&&(t=100),t<0&&(t=0),this._percent=t;var e=t/100,r=this._barLength*e;if(this._slidBallRenderer.setPosition(r,this._contentSize.height/2),this._scale9Enabled)this._progressBarRenderer.setPreferredSize(exports.cc.size(r,this._contentSize.height));else{var n=this._progressBarRenderer,s=n.getTextureRect();n.setTextureRect(exports.cc.rect(s.x,s.y,r/n._scaleX,s.height),n.isTextureRectRotated())}},hitTest:function(t){var e=this._slidBallNormalRenderer.convertToNodeSpace(t),r=this._slidBallNormalRenderer.getContentSize(),n=exports.cc.rect(0,0,r.width,r.height);return e.x>=n.x&&e.x<=n.x+n.width&&e.y>=n.y&&e.y<=n.y+n.height},onTouchBegan:function(t,e){var r=ccui.Widget.prototype.onTouchBegan.call(this,t,e);if(this._hit){var n=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(n.x)),this._percentChangedEvent()}return r},onTouchMoved:function(t,e){var r=t.getLocation(),n=this.convertToNodeSpace(r);this.setPercent(this._getPercentWithBallPos(n.x)),this._percentChangedEvent()},onTouchEnded:function(t,e){ccui.Widget.prototype.onTouchEnded.call(this,t,e)},onTouchCancelled:function(t,e){ccui.Widget.prototype.onTouchCancelled.call(this,t,e)},_getPercentWithBallPos:function(t){return t/this._barLength*100},addEventListenerSlider:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._sliderEventSelector=t,this._sliderEventListener=e},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,this,ccui.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED)),this._ccEventCallback&&this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._barRendererAdaptDirty=!0,this._progressBarRendererDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1),this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var t=this._barTextureSize;if(t.width<=0||t.height<=0)this._barRenderer.setScale(1);else{var e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._barRenderer.setScaleX(e),this._barRenderer.setScaleY(r)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2),this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize){if(!this._scale9Enabled){var t=this._progressBarTextureSize,e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(r)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{var t=this._progressBarTextureSize;if(t.width<=0||t.height<=0){this._progressBarRenderer.setScale(1);return}var e=this._contentSize.width/t.width,r=this._contentSize.height/t.height;this._progressBarRenderer.setScaleX(e),this._progressBarRenderer.setScaleY(r)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2),this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0),this._slidBallPressedRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!1),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY)},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale)},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile&&(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)),this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY),this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadBarTexture(t._textureFile,t._barTexType),this.loadProgressBarTexture(t._progressBarTextureFile,t._progressBarTexType),this.loadSlidBallTextureNormal(t._slidBallNormalTextureFile,t._ballNTexType),this.loadSlidBallTexturePressed(t._slidBallPressedTextureFile,t._ballPTexType),this.loadSlidBallTextureDisabled(t._slidBallDisabledTextureFile,t._ballDTexType),this.setPercent(t.getPercent()),this._sliderEventListener=t._sliderEventListener,this._sliderEventSelector=t._sliderEventSelector,this._zoomScale=t._zoomScale,this._ccEventCallback=t._ccEventCallback}});var _p=ccui.Slider.prototype;_p.percent;exports.cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.Slider.create=function(t,e,r){return new ccui.Slider(t,e,r)};ccui.Slider.EVENT_PERCENT_CHANGED=0;ccui.Slider.BASEBAR_RENDERER_ZORDER=-3;ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2;ccui.Slider.BALL_RENDERER_ZORDER=-1;ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:.5,_labelRenderer:null,_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(t,e,r){this._type=ccui.Text.Type.SYSTEM,this._textAreaSize=exports.cc.size(0,0),ccui.Widget.prototype.ctor.call(this),r!==void 0?(this.setFontName(e),this.setFontSize(r),this.setString(t)):this.setFontName(this._fontName)},_initRenderer:function(){this._labelRenderer=new exports.cc.LabelTTF,this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(t){exports.cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelRenderer.getString()&&(this._labelRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0)},getStringValue:function(){return exports.cc.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._labelRenderer.setFontSize(t),this._fontSize=t,this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._labelRenderer.setFontName(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontName:function(){return this._fontName},_setFont:function(t){var e=exports.cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._labelRenderer._setFont(t),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._labelRenderer.setDimensions(t),this._ignoreSize||(this._customSize=t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),t=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize)this._labelRenderer.setDimensions(0,0),this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(exports.cc.size(t.width,t.height));var e=this._labelRenderer.getContentSize();if(e.width<=0||e.height<=0){this._labelRenderer.setScale(1);return}var r=t.width/e.width,n=t.height/e.height;this._labelRenderer.setScaleX(r),this._labelRenderer.setScaleY(n),this._normalScaleValueX=r,this._normalScaleValueY=n}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,r){this._labelRenderer.enableShadow(t,e,r)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(t)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(t){t instanceof ccui.Text&&(this.setFontName(t._fontName),this.setFontSize(t.getFontSize()),this.setString(t.getString()),this.setTouchScaleChangeEnabled(t.touchScaleEnabled),this.setTextAreaSize(t._textAreaSize),this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment()),this.setContentSize(t.getContentSize()),this.setTextColor(t.getTextColor()))},_setBoundingWidth:function(t){this._textAreaSize.width=t,this._labelRenderer._setBoundingWidth(t),this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t,this._labelRenderer._setBoundingHeight(t),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){exports.cc.ProtectedNode.prototype.setColor.call(this,t),this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}});var _p=ccui.Text.prototype;_p.boundingWidth;exports.cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth);_p.boundingHeight;exports.cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight);_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.stringLength;exports.cc.defineGetterSetter(_p,"stringLength",_p.getStringLength);_p.font;exports.cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);_p.fontSize;exports.cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;exports.cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);_p.textAlign;exports.cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment);_p.verticalAlign;exports.cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment);_p=null;ccui.Label=ccui.Text.create=function(t,e,r){return new ccui.Text(t,e,r)};ccui.Text.RENDERER_ZORDER=-1;ccui.Text.Type={SYSTEM:0,TTF:1};ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(t,e,r,n,s){ccui.Widget.prototype.ctor.call(this),s!==void 0&&this.setProperty(t,e,r,n,s)},_initRenderer:function(){this._labelAtlasRenderer=new exports.cc.LabelAtlas,this._labelAtlasRenderer.setAnchorPoint(exports.cc.p(.5,.5)),this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,-1)},setProperty:function(t,e,r,n,s){this._stringValue=t,this._charMapFileName=e,this._itemWidth=r,this._itemHeight=n,this._startCharMap=s,this._labelAtlasRenderer.initWithString(t,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0},setString:function(t){t!==this._labelAtlasRenderer.getString()&&(this._stringValue=t,this._labelAtlasRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(t){exports.cc.log("Please use the setString"),this.setString(t)},getStringValue:function(){return exports.cc.log("Please use the getString"),this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var t=this._labelAtlasRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0){t.setScale(1);return}t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(t){t&&this.setProperty(t._stringValue,t._charMapFileName,t._itemWidth,t._itemHeight,t._startCharMap)},_createCloneInstance:function(){return new ccui.TextAtlas}});var _p=ccui.TextAtlas.prototype;_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextAtlas.create=function(t,e,r,n,s){return new ccui.TextAtlas(t,e,r,n,s)};ccui.TextAtlas.RENDERER_ZORDER=-1;ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(t,e){ccui.Widget.prototype.ctor.call(this),e!==void 0&&(this.setFntFile(e),this.setString(t))},_initRenderer:function(){this._labelBMFontRenderer=new exports.cc.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){if(t){this._fntFileName=t,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,t),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0;var e=this||window,r=e._labelBMFontRenderer;r._textureLoaded||r.addEventListener("load",function(){e.setFntFile(e._fntFileName);for(var n=e.parent;n;){if(n.requestDoLayout){n.requestDoLayout();break}n=n.parent}})}},setText:function(t){exports.cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelBMFontRenderer.getString()&&(this._stringValue=t,this._labelBMFontRenderer.setString(t),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0))},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0){t.setScale(1);return}t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName),this.setString(t._stringValue)}});var _p=ccui.TextBMFont.prototype;_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextBMFont.create=function(t,e){return new ccui.TextBMFont(t,e)};ccui.TextBMFont.RENDERER_ZORDER=-1;ccui._TextFieldRenderer=exports.cc.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){exports.cc.TextFieldTTF.prototype.ctor.call(this),this._maxLengthEnabled=!1,this._maxLength=0,this._passwordEnabled=!1,this._passwordStyleText="*",this._attachWithIME=!1,this._detachWithIME=!1,this._insertText=!1,this._deleteBackward=!1},onEnter:function(){exports.cc.TextFieldTTF.prototype.onEnter.call(this),exports.cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(t){return this.setAttachWithIME(!0),!1},onTextFieldInsertText:function(t,e,r){return r===1&&e===`
`?!1:(this.setInsertText(!0),this._maxLengthEnabled&&exports.cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength)},onTextFieldDeleteBackward:function(t,e,r){return this.setDeleteBackward(!0),!1},onTextFieldDetachWithIME:function(t){return this.setDetachWithIME(!0),!1},insertText:function(t,e){var r=t;if(t!==`
`&&this._maxLengthEnabled){var n=this.getString().length;if(n>=this._maxLength){this._passwordEnabled&&this.setPasswordText(this.getString());return}}exports.cc.TextFieldTTF.prototype.insertText.call(this,r,e),this._passwordEnabled&&exports.cc.TextFieldTTF.prototype.getCharCount.call(this)>0&&this.setPasswordText(this.getString())},deleteBackward:function(){exports.cc.TextFieldTTF.prototype.deleteBackward.call(this),exports.cc.TextFieldTTF.prototype.getCharCount.call(this)>0&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){exports.cc.TextFieldTTF.prototype.attachWithIME.call(this)},closeIME:function(){exports.cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(t){this._maxLengthEnabled=t},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(t){this._maxLength=t},getMaxLength:function(){return this._maxLength},getCharCount:function(){return exports.cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(t){this._passwordEnabled=t},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(t){if(!(t.length>1)){var e=t.charCodeAt(0);e<33||e>126||(this._passwordStyleText=t)}},setPasswordText:function(t){var e="",r=t.length,n=r;this._maxLengthEnabled&&r>this._maxLength&&(n=this._maxLength);for(var s=0;s<n;++s)e+=this._passwordStyleText;exports.cc.LabelTTF.prototype.setString.call(this,e)},setAttachWithIME:function(t){this._attachWithIME=t},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(t){this._detachWithIME=t},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(t){this._insertText=t},getInsertText:function(){return this._insertText},setDeleteBackward:function(t){this._deleteBackward=t},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(t){return!1}});ccui._TextFieldRenderer.create=function(t,e,r){var n=new ccui._TextFieldRenderer;return n&&n.initWithString("",e,r)?(t&&n.setPlaceHolder(t),n):null};ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(t,e,r){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),e&&this.setFontName(e),r&&this.setFontSize(r),t&&this.setPlaceHolder(t)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this.scheduleUpdate()},_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20),this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(t){this._touchWidth=t.width,this._touchHeight=t.height},setTouchAreaEnabled:function(t){this._useTouchArea=t},hitTest:function(t){if(this._useTouchArea){var e=this.convertToNodeSpace(t),r=exports.cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,this._touchHeight);return e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height}else return ccui.Widget.prototype.hitTest.call(this,t)},getTouchSize:function(){return exports.cc.size(this._touchWidth,this._touchHeight)},setText:function(t){exports.cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!=null&&(t=String(t),this.isMaxLengthEnabled()&&(t=t.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(t),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(t,t.length)):this._textFieldRenderer.setString(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(t){this._textFieldRenderer.setPlaceHolder(t),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},setPlaceHolderColor:function(t){this._textFieldRenderer.setColorSpaceHolder(t)},setTextColor:function(t){this._textFieldRenderer.setTextColor(t)},setFontSize:function(t){this._textFieldRenderer.setFontSize(t),this._fontSize=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(t){this._textFieldRenderer.setFontName(t),this._fontName=t,this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){return exports.cc.log("Please use the getString"),this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(t,e){var r=this||window,n=ccui.Widget.prototype.onTouchBegan.call(r,t,e);return r._hit?setTimeout(function(){r._textFieldRenderer.attachWithIME()},0):setTimeout(function(){r._textFieldRenderer.detachWithIME()},0),n},setMaxLengthEnabled:function(t){this._textFieldRenderer.setMaxLengthEnabled(t)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(t){this._textFieldRenderer.setMaxLength(t),this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(t){this._textFieldRenderer.setPasswordEnabled(t)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},setPasswordStyleText:function(t){this._textFieldRenderer.setPasswordStyleText(t),this._passwordStyleText=t,this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(t){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1)),this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1)),this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._insertTextEvent(),this.setInsertText(!1)),this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(t){this._textFieldRenderer.setAttachWithIME(t)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(t){this._textFieldRenderer.setDetachWithIME(t)},getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(t){this._textFieldRenderer.setInsertText(t)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(t){this._textFieldRenderer.setDeleteBackward(t)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_ATTACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,ccui.TextField.EVENT_DELETE_BACKWARD)),this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._textFieldEventSelector=t,this._textFieldEventListener=e},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize),this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var t=this._textFieldRenderer.getContentSize();return this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),t=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(t){this.setString(t._textFieldRenderer.getString()),this.setPlaceHolder(t.getString()),this.setFontSize(t._textFieldRenderer.getFontSize()),this.setFontName(t._textFieldRenderer.getFontName()),this.setMaxLengthEnabled(t.isMaxLengthEnabled()),this.setMaxLength(t.getMaxLength()),this.setPasswordEnabled(t.isPasswordEnabled()),this.setPasswordStyleText(t._passwordStyleText),this.setAttachWithIME(t.getAttachWithIME()),this.setDetachWithIME(t.getDetachWithIME()),this.setInsertText(t.getInsertText()),this.setDeleteBackward(t.getDeleteBackward()),this._ccEventCallback=t._ccEventCallback,this._textFieldEventListener=t._textFieldEventListener,this._textFieldEventSelector=t._textFieldEventSelector},setTextAreaSize:function(t){this.setContentSize(t)},setTextHorizontalAlignment:function(t){this._textFieldRenderer.setHorizontalAlignment(t)},setTextVerticalAlignment:function(t){this._textFieldRenderer.setVerticalAlignment(t)},_setFont:function(t){this._textFieldRenderer._setFont(t),this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}});ccui.TextField.create=function(t,e,r){return new ccui.TextField(t,e,r)};var _p=ccui.TextField.prototype;_p.string;exports.cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p.placeHolder;exports.cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);_p.font;exports.cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);_p.fontSize;exports.cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);_p.fontName;exports.cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);_p.maxLengthEnabled;exports.cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled);_p.maxLength;exports.cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);_p.passwordEnabled;exports.cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled);_p=null;ccui.TextField.EVENT_ATTACH_WITH_IME=0;ccui.TextField.EVENT_DETACH_WITH_IME=1;ccui.TextField.EVENT_INSERT_TEXT=2;ccui.TextField.EVENT_DELETE_BACKWARD=3;ccui.TextField.RENDERER_ZORDER=-1;ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(t,e,r){this._type=0,this._tag=t||0,this._color=exports.cc.color(255,255,255,255),e&&(this._color.r=e.r,this._color.g=e.g,this._color.b=e.b),this._opacity=r||0,r===void 0?this._color.a=e.a:this._color.a=r}});ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(t,e,r,n,s,o){var a=e;e&&e instanceof exports.cc.FontDefinition&&(a=e.fillStyle,s=e.fontName,o=e.fontSize,this._fontDefinition=e),ccui.RichElement.prototype.ctor.call(this,t,a,r),this._type=ccui.RichElement.TEXT,this._text=n,this._fontName=s,this._fontSize=o}});ccui.RichElementText.create=function(t,e,r,n,s,o){return new ccui.RichElementText(t,e,r,n,s,o)};ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(t,e,r,n){ccui.RichElement.prototype.ctor.call(this,t,e,r),this._type=ccui.RichElement.IMAGE,this._filePath=n||"",this._textureRect=exports.cc.rect(0,0,0,0),this._textureType=0}});ccui.RichElementImage.create=function(t,e,r,n){return new ccui.RichElementImage(t,e,r,n)};ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(t,e,r,n){ccui.RichElement.prototype.ctor.call(this,t,e,r),this._type=ccui.RichElement.CUSTOM,this._customNode=n||null}});ccui.RichElementCustomNode.create=function(t,e,r,n){return new ccui.RichElementCustomNode(t,e,r,n)};ccui.RichText=ccui.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this),this._formatTextDirty=!1,this._richElements=[],this._elementRenders=[],this._leftSpaceWidth=0,this._verticalSpace=0,this._textHorizontalAlignment=exports.cc.TEXT_ALIGNMENT_LEFT,this._textVerticalAlignment=exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP},_initRenderer:function(){this._elementRenderersContainer=new exports.cc.Node,this._elementRenderersContainer.setAnchorPoint(.5,.5),this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(t,e){this._richElements.splice(e,0,t),this._formatTextDirty=!0},pushBackElement:function(t){this._richElements.push(t),this._formatTextDirty=!0},removeElement:function(t){exports.cc.isNumber(t)?this._richElements.splice(t,1):exports.cc.arrayRemoveObject(this._richElements,t),this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren(),this._elementRenders.length=0;var t,e,r=this._richElements;if(this._ignoreSize)for(this._addNewLine(),t=0;t<r.length;t++){e=r[t];var n=null;switch(e._type){case ccui.RichElement.TEXT:e._fontDefinition?n=new exports.cc.LabelTTF(e._text,e._fontDefinition):n=new exports.cc.LabelTTF(e._text,e._fontName,e._fontSize);break;case ccui.RichElement.IMAGE:n=new exports.cc.Sprite(e._filePath);break;case ccui.RichElement.CUSTOM:n=e._customNode;break}n.setColor(e._color),n.setOpacity(e._color.a),this._pushToContainer(n)}else for(this._addNewLine(),t=0;t<r.length;t++)switch(e=r[t],e._type){case ccui.RichElement.TEXT:e._fontDefinition?this._handleTextRenderer(e._text,e._fontDefinition,e._fontDefinition.fontSize,e._fontDefinition.fillStyle):this._handleTextRenderer(e._text,e._fontName,e._fontSize,e._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(e._filePath,e._color,e._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(e._customNode);break}this.formatRenderers(),this._formatTextDirty=!1}},_handleTextRenderer:function(t,e,r,n){if(t!==""){if(t===`
`){this._addNewLine();return}var s=e instanceof exports.cc.FontDefinition?new exports.cc.LabelTTF(t,e):new exports.cc.LabelTTF(t,e,r),o=s.getContentSize().width;if(this._leftSpaceWidth-=o,this._leftSpaceWidth<0){var a=-this._leftSpaceWidth/o,c=t,l=c.length,h=l*(1-a),u=c.substr(0,h),_=c.substr(h,c.length-1),d=h>0;if(this._lineBreakOnSpace){var f=u.lastIndexOf(" ");h=f===-1?h:f+1,_=c.substr(h,c.length-1),d=h>0&&_!==" "}if(d){var T=null;e instanceof exports.cc.FontDefinition?(T=new exports.cc.LabelTTF(u.substr(0,h),e),T.setOpacity(e.fillStyle.a)):(T=new exports.cc.LabelTTF(u.substr(0,h),e,r),T.setColor(n),T.setOpacity(n.a)),this._pushToContainer(T)}this._addNewLine(),this._handleTextRenderer(_,e,r,n)}else e instanceof exports.cc.FontDefinition?s.setOpacity(e.fillStyle.a):(s.setColor(n),s.setOpacity(n.a)),this._pushToContainer(s)}},_handleImageRenderer:function(t,e,r){var n=new exports.cc.Sprite(t);this._handleCustomRenderer(n)},_handleCustomRenderer:function(t){var e=t.getContentSize();this._leftSpaceWidth-=e.width,this._leftSpaceWidth<0?(this._addNewLine(),this._pushToContainer(t),this._leftSpaceWidth-=e.width):this._pushToContainer(t)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width,this._elementRenders.push([])},formatRenderers:function(){var t=0,e=this._elementRenderersContainer,r=this._elementRenders,n,s,o,a,c,l,h;if(this._ignoreSize){var u=0;for(o=r[0],a=0,s=0;s<o.length;s++){c=o[s],c.setAnchorPoint(exports.cc.p(0,0)),c.setPosition(a,0),e.addChild(c,1,s),l=c.getLineHeight?c.getLineHeight():t;var _=c.getContentSize();u+=_.width,t=Math.max(Math.min(t,l),_.height),a+=_.width}if(this._textHorizontalAlignment!==exports.cc.TEXT_ALIGNMENT_LEFT)for(h=0,this._textHorizontalAlignment===exports.cc.TEXT_ALIGNMENT_RIGHT?h=this._contentSize.width-a:this._textHorizontalAlignment===exports.cc.TEXT_ALIGNMENT_CENTER&&(h=(this._contentSize.width-a)/2),s=0;s<o.length;s++)o[s].x+=h;e.setContentSize(u,t)}else{var d=[];for(n=0;n<r.length;n++){o=r[n];var f=0;for(s=0;s<o.length;s++)c=o[s],l=c.getLineHeight?c.getLineHeight():c.getContentSize().height,f=Math.max(Math.min(c.getContentSize().height,l),f);d[n]=f,t+=d[n]}var T=this._customSize.height;for(n=0;n<r.length;n++){for(o=r[n],a=0,T-=d[n]+this._verticalSpace,s=0;s<o.length;s++)c=o[s],c.setAnchorPoint(exports.cc.p(0,0)),c.setPosition(exports.cc.p(a,T)),e.addChild(c,1),a+=c.getContentSize().width;if(this._textHorizontalAlignment!==exports.cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==exports.cc.VERTICAL_TEXT_ALIGNMENT_TOP){h=0,this._textHorizontalAlignment===exports.cc.TEXT_ALIGNMENT_RIGHT?h=this._contentSize.width-a:this._textHorizontalAlignment===exports.cc.TEXT_ALIGNMENT_CENTER&&(h=(this._contentSize.width-a)/2);var x=0;for(this._textVerticalAlignment===exports.cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?x=this._customSize.height-t:this._textVerticalAlignment===exports.cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(x=(this._customSize.height-t)/2),s=0;s<o.length;s++)c=o[s],c.x+=h,c.y-=x}}e.setContentSize(this._contentSize)}var m=r.length;for(n=0;n<m;n++)r[n].length=0;this._elementRenders.length=0,this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize),this._updateContentSizeWithTextureSize(this._contentSize),e.setPosition(this._contentSize.width*.5,this._contentSize.height*.5)},_pushToContainer:function(t){this._elementRenders.length<=0||this._elementRenders[this._elementRenders.length-1].push(t)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(t){this._verticalSpace=t},setAnchorPoint:function(t){ccui.Widget.prototype.setAnchorPoint.call(this,t),this._elementRenderersContainer.setAnchorPoint(t)},_setAnchorX:function(t){ccui.Widget.prototype._setAnchorX.call(this,t),this._elementRenderersContainer._setAnchorX(t)},_setAnchorY:function(t){ccui.Widget.prototype._setAnchorY.call(this,t),this._elementRenderersContainer._setAnchorY(t)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(t){this._ignoreSize!==t&&(this._formatTextDirty=!0,ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t))},getContentSize:function(){return this.formatText(),exports.cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this.formatText(),exports.cc.Node.prototype._getWidth.call(this)},_getHeight:function(){return this.formatText(),exports.cc.Node.prototype._getHeight.call(this)},setContentSize:function(t,e){var r=e===void 0?t.width:t,n=e===void 0?t.height:e;ccui.Widget.prototype.setContentSize.call(this,r,n),this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(t){this._super(t),this._elementRenderersContainer.setCascadeOpacityEnabled(t)},setLineBreakOnSpace:function(t){this._lineBreakOnSpace=t,this._formatTextDirty=!0,this.formatText()},setTextHorizontalAlignment:function(t){t!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=t,this.formatText())},setTextVerticalAlignment:function(t){t!==this._textVerticalAlignment&&(this._textVerticalAlignment=t,this.formatText())}});ccui.RichText.create=function(){return new ccui.RichText};ccui.RichElement.TEXT=0;ccui.RichElement.IMAGE=1;ccui.RichElement.CUSTOM=2;ccui.ScrollViewBar=ccui.ProtectedNode.extend({_parentScroll:null,_direction:null,_upperHalfCircle:null,_lowerHalfCircle:null,_body:null,_opacity:255,_marginFromBoundary:0,_marginForLength:0,_touching:!1,_autoHideEnabled:!0,autoHideTime:0,_autoHideRemainingTime:0,_className:"ScrollViewBar",ctor:function(t,e){exports.cc.ProtectedNode.prototype.ctor.call(this),this._direction=e,this._parentScroll=t,this._marginFromBoundary=ccui.ScrollViewBar.DEFAULT_MARGIN,this._marginForLength=ccui.ScrollViewBar.DEFAULT_MARGIN,this.opacity=255*ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY,this.autoHideTime=ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME,this._autoHideEnabled=!0,ccui.ScrollViewBar.prototype.init.call(this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},init:function(){this._upperHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._upperHalfCircle.setAnchorPoint(exports.cc.p(.5,0)),this._lowerHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._lowerHalfCircle.setAnchorPoint(exports.cc.p(.5,0)),this._lowerHalfCircle.setScaleY(-1),this.addProtectedChild(this._upperHalfCircle),this.addProtectedChild(this._lowerHalfCircle),this._body=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY),this._body.setAnchorPoint(exports.cc.p(.5,0)),this.addProtectedChild(this._body),this.setColor(ccui.ScrollViewBar.DEFAULT_COLOR),this.onScrolled(exports.cc.p(0,0)),exports.cc.ProtectedNode.prototype.setOpacity.call(this,0),this._autoHideRemainingTime=0,this._direction===ccui.ScrollView.DIR_HORIZONTAL&&this.setRotation(90)},setPositionFromCorner:function(t){this._direction===ccui.ScrollView.DIR_VERTICAL?(this._marginForLength=t.y,this._marginFromBoundary=t.x):(this._marginForLength=t.x,this._marginFromBoundary=t.y)},onEnter:function(){exports.cc.ProtectedNode.prototype.onEnter.call(this),this.scheduleUpdate()},getPositionFromCorner:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?exports.cc.p(this._marginFromBoundary,this._marginForLength):exports.cc.p(this._marginForLength,this._marginFromBoundary)},setWidth:function(t){var e=t/this._body.width;this._body.setScaleX(e),this._upperHalfCircle.setScale(e),this._lowerHalfCircle.setScale(-e)},getWidth:function(){return this._body.getBoundingBox().width},setAutoHideEnabled:function(t){this._autoHideEnabled=t,!this._autoHideEnabled&&!this._touching&&this._autoHideRemainingTime<=0?exports.cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity):exports.cc.ProtectedNode.prototype.setOpacity.call(this,0)},isAutoHideEnabled:function(){return this._autoHideEnabled},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},_updateLength:function(t){var e=t/this._body.getTextureRect().height;this._body.setScaleY(e),this._upperHalfCircle.setPositionY(this._body.getPositionY()+t)},_processAutoHide:function(t){!this._autoHideEnabled||this._autoHideRemainingTime<=0||this._touching||(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),exports.cc.ProtectedNode.prototype.setOpacity.call(this,this._opacity*(this._autoHideRemainingTime/this.autoHideTime))))},update:function(t){this._processAutoHide(t)},onTouchBegan:function(){this._autoHideEnabled&&(this._touching=!0)},onTouchEnded:function(){this._autoHideEnabled&&(this._touching=!1,!(this._autoHideRemainingTime<=0)&&(this._autoHideRemainingTime=this.autoHideTime))},onScrolled:function(t){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,exports.cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var e=this._parentScroll.getInnerContainer(),r=0,n=0,s=0,o=0;this._direction===ccui.ScrollView.DIR_VERTICAL?(r=e.height,n=this._parentScroll.height,s=t.y,o=-e.getPositionY()):this._direction===ccui.ScrollView.DIR_HORIZONTAL&&(r=e.width,n=this._parentScroll.width,s=t.x,o=-e.getPositionX());var a=this._calculateLength(r,n,s),c=this._calculatePosition(r,n,o,s,a);this._updateLength(a),this.setPosition(c)},_calculateLength:function(t,e,r){var n=t;if(r!==0){var s=20;n+=(r>0?r:-r)*s}var o=e/n;return Math.abs(e-2*this._marginForLength)*o},_calculatePosition:function(t,e,r,n,s){var o=t-e;n!==0&&(o+=Math.abs(n));var a=0;o!==0&&(a=r/o,a=Math.max(a,0),a=Math.min(a,1));var c=(e-s-2*this._marginForLength)*a+this._marginForLength;return this._direction===ccui.ScrollView.DIR_VERTICAL?exports.cc.p(this._parentScroll.width-this._marginFromBoundary,c):exports.cc.p(c,this._marginFromBoundary)}});var _p=ccui.ScrollViewBar.prototype;_p.opacity;exports.cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);_p.autoHideEnabled;exports.cc.defineGetterSetter(_p,"autoHideEnabled",_p.isAutoHideEnabled,_p.setAutoHideEnabled);ccui.ScrollViewBar.DEFAULT_COLOR=exports.cc.color(52,65,87);ccui.ScrollViewBar.DEFAULT_MARGIN=20;ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME=.2;ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY=.4;ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY="/__half_circle_image";ccui.ScrollViewBar.HALF_CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMABgcbbW7Hz9Dz+PmlcJP5AAAAMElEQVR4AUXHwQ2AQAhFwYcLH1H6r1djzDK3ASxUpTBeK/uTCyz7dx54b44m4p5cD1MwAooEJyk3AAAAAElFTkSuQmCC";ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY="/__body_image_height";ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAABCAMAAADdNb8LAAAAA1BMVEX///+nxBvIAAAACklEQVR4AWNABgAADQABYc2cpAAAAABJRU5ErkJggg==";ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,_direction:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_touchMoveDisplacements:null,_touchMoveTimeDeltas:null,_touchMovePreviousTimestamp:0,_touchTotalTimeThreshold:.5,_autoScrolling:!1,_autoScrollTargetDelta:null,_autoScrollAttenuate:!0,_autoScrollStartPosition:null,_autoScrollTotalTime:0,_autoScrollAccumulatedTime:0,_autoScrollCurrentlyOutOfBoundary:!1,_autoScrollBraking:!1,_autoScrollBrakingStartPosition:null,_bePressed:!1,_childFocusCancelOffset:0,bounceEnabled:!1,_outOfBoundaryAmount:null,_outOfBoundaryAmountDirty:!0,inertiaScrollEnabled:!1,_scrollBarEnabled:!0,_verticalScrollBar:null,_horizontalScrollBar:null,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this),this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),this._direction=ccui.ScrollView.DIR_NONE,this._childFocusCancelOffset=5,this.inertiaScrollEnabled=!0,this._outOfBoundaryAmount=exports.cc.p(0,0),this._autoScrollTargetDelta=exports.cc.p(0,0),this._autoScrollStartPosition=exports.cc.p(0,0),this._autoScrollBrakingStartPosition=exports.cc.p(0,0),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._scrollBarEnabled=!0,this._initScrollBar(),this.setTouchEnabled(!0)},init:function(){return!!ccui.Layout.prototype.init.call(this)},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){exports.cc.renderer._removeCache(this.__instanceId),ccui.Layout.prototype.onExit.call(this)},findNextFocusedWidget:function(t,e){return this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(t,e):ccui.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this),this._innerContainer=new ccui.Layout,this._innerContainer.setColor(exports.cc.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?new ccui.ScrollView.WebGLRenderCmd(this):new ccui.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize;this._topBoundary=t.height,this._rightBoundary=t.width;var e=this._innerContainer.getContentSize();this._innerContainer.setContentSize(exports.cc.size(Math.max(e.width,t.width),Math.max(e.height,t.height))),this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height),this._verticalScrollBar&&this._verticalScrollBar.onScrolled(this._getHowMuchOutOfBoundary()),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(this._getHowMuchOutOfBoundary())},setInnerContainerSize:function(t){var e=this._innerContainer,r=this._contentSize,n=r.width,s=r.height;t.width<r.width?exports.cc.log("Inner width <= ScrollView width, it will be force sized!"):n=t.width,t.height<r.height?exports.cc.log("Inner height <= ScrollView height, it will be force sized!"):s=t.height,e.setContentSize(exports.cc.size(n,s));var o=this._innerContainer.getPosition(),a=this._innerContainer.getAnchorPoint();this._innerContainer.getLeftBoundary()!=0&&(o.x=a.x*n),this._innerContainer.getTopBoundary()!=this._contentSize.height&&(o.y=this._contentSize.height-(1-a.y)*s),this.setInnerContainerPosition(o),this._updateScrollBar(exports.cc.p(0,0))},_setInnerWidth:function(t){var e=this._contentSize.width,r=e,n=this._innerContainer,s=n.width;switch(t<e?exports.cc.log("Inner width <= scrollview width, it will be force sized!"):r=t,n.width=r,this._direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:if(n.getRightBoundary()<=e){var o=n.width,a=s-o;this._scrollChildren(a,0)}break}var c=n.anchorX;n.getLeftBoundary()>0&&(n.x=c*r),n.getRightBoundary()<e&&(n.x=e-(1-c)*r)},_setInnerHeight:function(t){var e=this._contentSize.height,r=e,n=this._innerContainer,s=n.height;switch(t<e?exports.cc.log("Inner height <= scrollview height, it will be force sized!"):r=t,n.height=r,this._direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:var o=r,a=s-o;this._scrollChildren(0,a);break}var c=n.anchorY;n.getLeftBoundary()>0&&(n.y=c*r),n.getRightBoundary()<e&&(n.y=e-(1-c)*r)},setInnerContainerPosition:function(t){if(!(t.x===this._innerContainer.getPositionX()&&t.y===this._innerContainer.getPositionY())){if(this._innerContainer.setPosition(t),this._outOfBoundaryAmountDirty=!0,this.bounceEnabled)for(var e=ccui.ScrollView.MOVEDIR_TOP;e<ccui.ScrollView.MOVEDIR_RIGHT;++e)this._isOutOfBoundary(e)&&this._processScrollEvent(e,!0);this._dispatchEvent(ccui.ScrollView.EVENT_CONTAINER_MOVED)}},getInnerContainerPosition:function(){return this._innerContainer.getPosition()},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(t){if(!this._clippingEnabled)return!0;var e=t._position,r=t._contentSize,n=t._anchorPoint,s=this._customSize,o=this._innerContainer._position,a=0,c=0;return!((a=e.y-n.y*r.height)>=s.height-o.y||a+r.height<=-o.y||(c=e.x-n.x*r.width)>=s.width-o.x||c+r.width<=-o.x)},updateChildren:function(){var t,e,r,n=this._innerContainer._children;for(e=0,r=n.length;e<r;e++)t=n[e],t._inViewRect===!0&&this._isInContainer(t)===!1?t._inViewRect=!1:t._inViewRect===!1&&this._isInContainer(t)===!0&&(t._inViewRect=!0)},addChild:function(t,e,r){return t?(this._isInContainer(t)===!1&&(t._inViewRect=!1),e=e||t.getLocalZOrder(),r=r||t.getTag(),this._innerContainer.addChild(t,e,r)):!1},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_flattenVectorByDirection:function(t){var e=exports.cc.p(0,0);return e.x=this._direction===ccui.ScrollView.DIR_VERTICAL?0:t.x,e.y=this._direction===ccui.ScrollView.DIR_HORIZONTAL?0:t.y,e},_getHowMuchOutOfBoundary:function(t){if(t===void 0&&(t=exports.cc.p(0,0)),t.x===0&&t.y===0&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=exports.cc.p(0,0);return this._innerContainer.getLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._innerContainer.getLeftBoundary()+t.x):this._innerContainer.getRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._innerContainer.getRightBoundary()+t.x)),this._innerContainer.getTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._innerContainer.getTopBoundary()+t.y):this._innerContainer.getBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._innerContainer.getBottomBoundary()+t.y)),t.x===0&&t.y===0&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e},_isOutOfBoundary:function(t){var e=this._getHowMuchOutOfBoundary();if(t!==void 0)switch(t){case ccui.ScrollView.MOVEDIR_TOP:return e.y>0;case ccui.ScrollView.MOVEDIR_BOTTOM:return e.y<0;case ccui.ScrollView.MOVEDIR_LEFT:return e.x<0;case ccui.ScrollView.MOVEDIR_RIGHT:return e.x>0}else return!this._fltEqualZero(e);return!1},_moveInnerContainer:function(t,e){var r=this._flattenVectorByDirection(t);this.setInnerContainerPosition(exports.cc.pAdd(this.getInnerContainerPosition(),r));var n=this._getHowMuchOutOfBoundary();this._updateScrollBar(n),this.bounceEnabled&&e&&this._startBounceBackIfNeeded()},_updateScrollBar:function(t){this._verticalScrollBar&&this._verticalScrollBar.onScrolled(t),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(t)},_calculateTouchMoveVelocity:function(){for(var t=0,e=0;e<this._touchMoveTimeDeltas.length;++e)t+=this._touchMoveTimeDeltas[e];if(t==0||t>=this._touchTotalTimeThreshold)return exports.cc.p(0,0);for(var r=exports.cc.p(0,0),e=0;e<this._touchMoveDisplacements.length;++e)r.x+=this._touchMoveDisplacements[e].x,r.y+=this._touchMoveDisplacements[e].y;return exports.cc.pMult(r,1/t)},setTouchTotalTimeThreshold:function(t){this._touchTotalTimeThreshold=t},getTouchTotalTimeThreshold:function(){return this._touchTotalTimeThreshold},_startInertiaScroll:function(t){var e=.7,r=exports.cc.pMult(t,e);this._startAttenuatingAutoScroll(r,t)},_startBounceBackIfNeeded:function(){if(!this.bounceEnabled)return!1;var t=this._getHowMuchOutOfBoundary();if(this._fltEqualZero(t))return!1;var e=1;return this._startAutoScroll(t,e,!0),!0},_startAutoScrollToDestination:function(t,e,r){this._startAutoScroll(exports.cc.pSub(t,this._innerContainer.getPosition()),e,r)},_calculateAutoScrollTimeByInitialSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAttenuatingAutoScroll:function(t,e){var r=this._calculateAutoScrollTimeByInitialSpeed(exports.cc.pLength(e));this._startAutoScroll(t,r,!0)},_startAutoScroll:function(t,e,r){var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=r,this._autoScrollStartPosition=this._innerContainer.getPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=exports.cc.p(0,0);var s=this._getHowMuchOutOfBoundary();if(!this._fltEqualZero(s)){this._autoScrollCurrentlyOutOfBoundary=!0;var o=this._getHowMuchOutOfBoundary(n);(s.x*o.x>0||s.y*o.y>0)&&(this._autoScrollBraking=!0)}},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAttenuate=!0,this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getInnerContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_getAutoScrollStopEpsilon:function(){return 1e-4},_fltEqualZero:function(t){return Math.abs(t.x)<=1e-4&&Math.abs(t.y)<=1e-4},_processAutoScrolling:function(t){var e=.05,r=this._isNecessaryAutoScrollBrake()?e:1;this._autoScrollAccumulatedTime+=t*(1/r);var n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(n-=1,n=n*n*n*n*n+1);var s=exports.cc.pAdd(this._autoScrollStartPosition,exports.cc.pMult(this._autoScrollTargetDelta,n)),o=Math.abs(n-1)<=this._getAutoScrollStopEpsilon();if(this.bounceEnabled)s=exports.cc.pAdd(this._autoScrollBrakingStartPosition,exports.cc.pMult(exports.cc.pSub(s,this._autoScrollBrakingStartPosition),r));else{var a=exports.cc.pSub(s,this.getInnerContainerPosition()),c=this._getHowMuchOutOfBoundary(a);this._fltEqualZero(c)||(s.x+=c.x,s.y+=c.y,o=!0)}o&&(this._autoScrolling=!1,this._dispatchEvent(ccui.ScrollView.EVENT_AUTOSCROLL_ENDED)),this._moveInnerContainer(exports.cc.pSub(s,this.getInnerContainerPosition()),o)},_jumpToDestination:function(t,e){t.x===void 0&&(t=exports.cc.p(t,e)),this._autoScrolling=!1,this._moveInnerContainer(exports.cc.pSub(t,this.getInnerContainerPosition()),!0)},_scrollChildren:function(t){var e=t;if(this.bounceEnabled){var r=this._getHowMuchOutOfBoundary();e.x*=r.x==0?1:.5,e.y*=r.y==0?1:.5}if(!this.bounceEnabled){var r=this._getHowMuchOutOfBoundary(e);e.x+=r.x,e.y+=r.y}var n=!1,s=!1,o=!1,a=!1;if(e.y>0){var c=this._innerContainer.getBottomBoundary();c+e.y>=this._bottomBoundary&&(a=!0)}else if(e.y<0){var l=this._innerContainer.getTopBoundary();l+e.y<=this._topBoundary&&(o=!0)}if(e.x<0){var h=this._innerContainer.getRightBoundary();h+e.x<=this._rightBoundary&&(s=!0)}else if(e.x>0){var u=this._innerContainer.getLeftBoundary();u+e.x>=this._leftBoundary&&(n=!0)}this._moveInnerContainer(e,!1),(e.x!=0||e.y!=0)&&this._processScrollingEvent(),a&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_BOTTOM,!1),o&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_TOP,!1),n&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_LEFT,!1),s&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_RIGHT,!1)},scrollToBottom:function(t,e){this._startAutoScrollToDestination(exports.cc.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollToDestination(exports.cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollToDestination(exports.cc.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollToDestination(exports.cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll direction is not both!");return}this._startAutoScrollToDestination(exports.cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll direction is not both!");return}var r=this._innerContainer.getContentSize();this._startAutoScrollToDestination(exports.cc.p(this._contentSize.width-r.width,this._contentSize.height-r.height),t,e)},scrollToBottomLeft:function(t,e){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll direction is not both!");return}this._startAutoScrollToDestination(exports.cc.p(0,0),t,e)},scrollToBottomRight:function(t,e){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll direction is not both!");return}this._startAutoScrollToDestination(exports.cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,r){var n=this._contentSize.height-this._innerContainer.getContentSize().height,s=-n;this._startAutoScrollToDestination(exports.cc.p(this._innerContainer.getPositionX(),n+t*s/100),e,r)},scrollToPercentHorizontal:function(t,e,r){var n=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(exports.cc.p(-(t*n/100),this._innerContainer.getPositionY()),e,r)},scrollToPercentBothDirection:function(t,e,r){if(this._direction===ccui.ScrollView.DIR_BOTH){var n=this._contentSize.height-this._innerContainer.getContentSize().height,s=-n,o=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(exports.cc.p(-(t.x*o/100),n+t.y*s/100),e,r)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll _direction is not both!");return}this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll _direction is not both!");return}var t=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height)},jumpToBottomLeft:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll _direction is not both!");return}this._jumpToDestination(0,0)},jumpToBottomRight:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH){exports.cc.log("Scroll _direction is not both!");return}this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height,r=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*r/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-(t*e/100),this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){if(this._direction===ccui.ScrollView.DIR_BOTH){var e=this._innerContainer.getContentSize(),r=this._contentSize.height-e.height,n=-r,s=e.width-this._contentSize.width;this._jumpToDestination(-(t.x*s/100),r+t.y*n/100)}},_gatherTouchMove:function(t){for(var e=5;this._touchMoveDisplacements.length>=e;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(t);var r=new Date().getTime();this._touchMoveTimeDeltas.push((r-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=r},_handlePressLogic:function(t){this._bePressed=!0,this._autoScrolling=!1,this._touchMovePreviousTimestamp=new Date().getTime(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._verticalScrollBar&&this._verticalScrollBar.onTouchBegan(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan()},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),r=this.convertToNodeSpace(t.getPreviousLocation()),n=exports.cc.pSub(e,r);this._scrollChildren(n),this._gatherTouchMove(n)},_handleReleaseLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),r=this.convertToNodeSpace(t.getPreviousLocation()),n=exports.cc.pSub(e,r);this._gatherTouchMove(n),this._bePressed=!1;var s=this._startBounceBackIfNeeded();if(!s&&this.inertiaScrollEnabled){var o=this._calculateTouchMoveVelocity();(o.x!==0||o.y!==0)&&this._startInertiaScroll(o)}this._verticalScrollBar&&this._verticalScrollBar.onTouchEnded(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded()},onTouchBegan:function(t,e){var r=ccui.Layout.prototype.onTouchBegan.call(this,t,e);return this._isInterceptTouch||this._hit&&this._handlePressLogic(t),r},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)},interceptTouchEvent:function(t,e,r){if(!this._touchEnabled){ccui.Layout.prototype.interceptTouchEvent.call(this,t,e,r);return}if(this._direction!==ccui.ScrollView.DIR_NONE){var n=r.getLocation();switch(t){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0,this._touchBeganPosition.x=n.x,this._touchBeganPosition.y=n.y,this._handlePressLogic(r);break;case ccui.Widget.TOUCH_MOVED:var s=exports.cc.pLength(exports.cc.pSub(e.getTouchBeganPosition(),n));this._touchMovePosition.x=n.x,this._touchMovePosition.y=n.y,s>this._childFocusCancelOffset&&(e.setHighlighted(!1),this._handleMoveLogic(r));break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=n.x,this._touchEndPosition.y=n.y,this._handleReleaseLogic(r),e.isSwallowTouches()&&(this._isInterceptTouch=!1);break}}},_processScrollEvent:function(t,e){var r=0;switch(t){case ccui.ScrollView.MOVEDIR_TOP:r=e?ccui.ScrollView.EVENT_BOUNCE_TOP:ccui.ScrollView.EVENT_SCROLL_TO_TOP;break;case ccui.ScrollView.MOVEDIR_BOTTOM:r=e?ccui.ScrollView.EVENT_BOUNCE_BOTTOM:ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM;break;case ccui.ScrollView.MOVEDIR_LEFT:r=e?ccui.ScrollView.EVENT_BOUNCE_LEFT:ccui.ScrollView.EVENT_SCROLL_TO_LEFT;break;case ccui.ScrollView.MOVEDIR_RIGHT:r=e?ccui.ScrollView.EVENT_BOUNCE_RIGHT:ccui.ScrollView.EVENT_SCROLL_TO_RIGHT;break}this._dispatchEvent(r)},_processScrollingEvent:function(){this._dispatchEvent(ccui.ScrollView.EVENT_SCROLLING)},_dispatchEvent:function(t){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,t):this._scrollViewEventSelector(this,t)),this._ccEventCallback&&this._ccEventCallback(this,t)},addEventListenerScrollView:function(t,e){this._scrollViewEventSelector=t,this._scrollViewEventListener=e},addEventListener:function(t){this._ccEventCallback=t},setDirection:function(t){this._direction=t,this._scrollBarEnabled&&(this._removeScrollBar(),this._initScrollBar())},getDirection:function(){return this._direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},setScrollBarEnabled:function(t){this._scrollBarEnabled!==t&&(this._scrollBarEnabled&&this._removeScrollBar(),this._scrollBarEnabled=t,this._scrollBarEnabled&&this._initScrollBar())},isScrollBarEnabled:function(){return this._scrollBarEnabled},setScrollBarPositionFromCorner:function(t){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t)},setScrollBarPositionFromCornerForVertical:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),exports.cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForVertical:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),exports.cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.getPositionFromCorner()},setScrollBarPositionFromCornerForHorizontal:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),exports.cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForHorizontal:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),exports.cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.getPositionFromCorner()},setScrollBarWidth:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setWidth(t),this._horizontalScrollBar&&this._horizontalScrollBar.setWidth(t)},getScrollBarWidth:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.getWidth():this._horizontalScrollBar?this._horizontalScrollBar.getWidth():0},setScrollBarColor:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setColor(t),this._horizontalScrollBar&&this._horizontalScrollBar.setColor(t)},getScrollBarColor:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.getColor(),this._horizontalScrollBar&&this._horizontalScrollBar.getColor(),exports.cc.color.WHITE},setScrollBarOpacity:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.opacity=t),this._horizontalScrollBar&&(this._horizontalScrollBar.opacity=t)},getScrollBarOpacity:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.opacity:this._horizontalScrollBar?this._horizontalScrollBar.opacity:-1},setScrollBarAutoHideEnabled:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideEnabled=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideEnabled=t)},isScrollBarAutoHideEnabled:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideEnabled:this._horizontalScrollBar?this._horizontalScrollBar.autoHideEnabled:!1},setScrollBarAutoHideTime:function(t){exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideTime=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideTime=t)},getScrollBarAutoHideTime:function(){return exports.cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideTime:this._horizontalScrollBar?this._horizontalScrollBar.autoHideTime:0},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(t){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,t),this.setInnerContainerSize(t.getInnerContainerSize()),this.setInnerContainerPosition(t.getInnerContainerPosition()),this.setDirection(t._direction),this._topBoundary=t._topBoundary,this._bottomBoundary=t._bottomBoundary,this._leftBoundary=t._leftBoundary,this._rightBoundary=t._rightBoundary,this._bePressed=t._bePressed,this._childFocusCancelOffset=t._childFocusCancelOffset,this._touchMoveDisplacements=t._touchMoveDisplacements,this._touchMoveTimeDeltas=t._touchMoveTimeDeltas,this._touchMovePreviousTimestamp=t._touchMovePreviousTimestamp,this._autoScrolling=t._autoScrolling,this._autoScrollAttenuate=t._autoScrollAttenuate,this._autoScrollStartPosition=t._autoScrollStartPosition,this._autoScrollTargetDelta=t._autoScrollTargetDelta,this._autoScrollTotalTime=t._autoScrollTotalTime,this._autoScrollAccumulatedTime=t._autoScrollAccumulatedTime,this._autoScrollCurrentlyOutOfBoundary=t._autoScrollCurrentlyOutOfBoundary,this._autoScrollBraking=t._autoScrollBraking,this._autoScrollBrakingStartPosition=t._autoScrollBrakingStartPosition,this.setBounceEnabled(t.bounceEnabled),this.setInertiaScrollEnabled(t.inertiaScrollEnabled),this._scrollViewEventListener=t._scrollViewEventListener,this._scrollViewEventSelector=t._scrollViewEventSelector,this._ccEventCallback=t._ccEventCallback,this.setScrollBarEnabled(t.isScrollBarEnabled()),this.isScrollBarEnabled()&&(this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t.getScrollBarPositionFromCornerForVertical()),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t.getScrollBarPositionFromCornerForHorizontal()),this.setScrollBarWidth(t.getScrollBarWidth()),this.setScrollBarColor(t.getScrollBarColor()),this.setScrollBarAutoHideEnabled(t.isScrollBarAutoHideEnabled()),this.setScrollBarAutoHideTime(t.getScrollBarAutoHideTime())))},_initScrollBar:function(){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&!this._verticalScrollBar&&(this._verticalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_VERTICAL),this.addProtectedChild(this._verticalScrollBar,2)),this._direction!==ccui.ScrollView.DIR_VERTICAL&&!this._horizontalScrollBar&&(this._horizontalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_HORIZONTAL),this.addProtectedChild(this._horizontalScrollBar,2))},_removeScrollBar:function(){this._verticalScrollBar&&(this.removeProtectedChild(this._verticalScrollBar),this._verticalScrollBar=null),this._horizontalScrollBar&&(this.removeProtectedChild(this._horizontalScrollBar),this._horizontalScrollBar=null)},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,r){this._innerContainer.addNode(t,e,r)}});var _p=ccui.ScrollView.prototype;_p.innerWidth;exports.cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth);_p.innerHeight;exports.cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight);_p.direction;exports.cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);_p.touchTotalTimeThreshold;exports.cc.defineGetterSetter(_p,"touchTotalTimeThreshold",_p.getTouchTotalTimeThreshold,_p.setTouchTotalTimeThreshold);_p=null;ccui.ScrollView.create=function(){return new ccui.ScrollView};ccui.ScrollView.DIR_NONE=0;ccui.ScrollView.DIR_VERTICAL=1;ccui.ScrollView.DIR_HORIZONTAL=2;ccui.ScrollView.DIR_BOTH=3;ccui.ScrollView.EVENT_SCROLL_TO_TOP=0;ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1;ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2;ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3;ccui.ScrollView.EVENT_SCROLLING=4;ccui.ScrollView.EVENT_BOUNCE_TOP=5;ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6;ccui.ScrollView.EVENT_BOUNCE_LEFT=7;ccui.ScrollView.EVENT_BOUNCE_RIGHT=8;ccui.ScrollView.EVENT_CONTAINER_MOVED=9;ccui.ScrollView.EVENT_AUTOSCROLL_ENDED=10;ccui.ScrollView.MOVEDIR_TOP=0;ccui.ScrollView.MOVEDIR_BOTTOM=1;ccui.ScrollView.MOVEDIR_LEFT=2;ccui.ScrollView.MOVEDIR_RIGHT=3;(function(){if(ccui.ProtectedNode.CanvasRenderCmd){ccui.ScrollView.CanvasRenderCmd=function(e){ccui.Layout.CanvasRenderCmd.call(this,e),this._dirty=!1};var t=ccui.ScrollView.CanvasRenderCmd.prototype=Object.create(ccui.Layout.CanvasRenderCmd.prototype);t.constructor=ccui.ScrollView.CanvasRenderCmd,t.visit=function(e){var r=this._node;r._visible&&(r.__instanceId,exports.cc.renderer.pushRenderCommand(this),this.layoutVisit(e),this._dirtyFlag=0)},t.rendering=function(e){var r=this._node.__instanceId,n=exports.cc.renderer._cacheToCanvasCmds[r],s,o,a=exports.cc.view.getScaleX(),c=exports.cc.view.getScaleY(),l=e||exports.cc._renderContext;for(l.computeRealOffsetY(),this._node.updateChildren(),s=0,o=n.length;s<o;s++){var h=n[s]._node;h instanceof ccui.ScrollView||h&&h._parent&&h._parent._inViewRect===!1||n[s].rendering(l,a,c)}}}})();(function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.ScrollView.WebGLRenderCmd=function(e){ccui.Layout.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._dirty=!1};var t=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype);t.constructor=ccui.ScrollView.WebGLRenderCmd,t.visit=function(e){var r=this._node;if(r._visible){var n=this._node.__instanceId;exports.cc.renderer.pushRenderCommand(this),exports.cc.renderer._turnToCacheMode(n),this.layoutVisit(e),r.updateChildren(),this._dirtyFlag=0,exports.cc.renderer._turnToNormalMode()}},t.rendering=function(e){var r=this._node.__instanceId,n=exports.cc.renderer._cacheToBufferCmds[r],s,o,a,c,l=e||exports.cc._renderContext;if(n)for(this._node.updateChildren(),l.bindBuffer(gl.ARRAY_BUFFER,null),s=0,o=n.length;s<o;s++)c=n[s],a=c._node,!(a instanceof ccui.ScrollView)&&(a&&a._parent&&a._parent._inViewRect===!1||(c.uploadData?exports.cc.renderer._uploadBufferData(c):(c._batchingSize>0&&exports.cc.renderer._batchRendering(),c.rendering(l)),exports.cc.renderer._batchRendering()))}}})();ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,_ccListViewEventCallback:null,_magneticAllowedOutOfBoundary:!0,_magneticType:0,_className:"ListView",ctor:function(){this._items=[],ccui.ScrollView.prototype.ctor.call(this),this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL,this.setTouchEnabled(!0),this.setDirection(ccui.ScrollView.DIR_VERTICAL)},setItemModel:function(t){if(!t){exports.cc.log("Can't set a null to item model!");return}this._model=t},_handleReleaseLogic:function(t){ccui.ScrollView.prototype._handleReleaseLogic.call(this,t),this._autoScrolling||this._startMagneticScroll()},_onItemListChanged:function(){this._outOfBoundaryAmountDirty=!0},_updateInnerContainerSize:function(){var t=this._items,e,r;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:e=t.length;var n=(e-1)*this._itemsMargin;for(r=0;r<e;r++)n+=t[r].getContentSize().height;this.setInnerContainerSize(exports.cc.size(this._contentSize.width,n));break;case ccui.ScrollView.DIR_HORIZONTAL:e=t.length;var s=(e-1)*this._itemsMargin;for(r=0;r<e;r++)s+=t[r].getContentSize().width;this.setInnerContainerSize(exports.cc.size(s,this._contentSize.height));break}},_remedyLayoutParameter:function(t){exports.cc.assert(t!=null,"ListView Item can't be nil!");var e=t.getLayoutParameter(ccui.LayoutParameter.LINEAR),r=!0;e||(e=new ccui.LinearLayoutParameter,r=!1);var n=this.getIndex(t);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(e,n);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(e,n);break}r||t.setLayoutParameter(e)},_remedyVerticalLayoutParameter:function(t,e){switch(exports.cc.assert(t!=null,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_LEFT:t.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:t.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL);break}e===0?t.setMargin(ccui.MarginZero()):t.setMargin(new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(t,e){switch(exports.cc.assert(t!=null,"Layout parameter can't be nil!"),this._gravity){case ccui.ListView.GRAVITY_TOP:t.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:t.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:t.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL);break}e===0?t.setMargin(ccui.MarginZero()):t.setMargin(new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(this._model!=null){var t=this._model.clone();this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0}},insertDefaultItem:function(t){if(this._model!=null){var e=this._model.clone();this._items.splice(t,0,e),ccui.ScrollView.prototype.addChild.call(this,e),this._remedyLayoutParameter(e),this._refreshViewDirty=!0}},pushBackCustomItem:function(t){this._remedyLayoutParameter(t),this.addChild(t),this._refreshViewDirty=!0},addChild:function(t,e,r){t&&(e=e||t.getLocalZOrder(),r=r||t.getName(),ccui.ScrollView.prototype.addChild.call(this,t,e,r),t instanceof ccui.Widget&&(this._items.push(t),this._onItemListChanged()))},removeChild:function(t,e){if(t){var r=this._items.indexOf(t);r>-1&&this._items.splice(r,1),this._onItemListChanged(),ccui.ScrollView.prototype.removeChild.call(this,t,e)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,t),this._items=[],this._onItemListChanged()},insertCustomItem:function(t,e){this._items.splice(e,0,t),this._onItemListChanged(),ccui.ScrollView.prototype.addChild.call(this,t),this._remedyLayoutParameter(t),this._refreshViewDirty=!0},removeItem:function(t){var e=this.getItem(t);e!=null&&(this.removeChild(e,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(t){return t<0||t>=this._items.length?null:this._items[t]},getItems:function(){return this._items},getIndex:function(t){return t==null?-1:this._items.indexOf(t)},setGravity:function(t){this._gravity!==t&&(this._gravity=t,this._refreshViewDirty=!0)},setMagneticType:function(t){this._magneticType=t,this._onItemListChanged(),this._startMagneticScroll()},getMagneticType:function(){return this._magneticType},setMagneticAllowedOutOfBoundary:function(t){this._magneticAllowedOutOfBoundary=t},getMagneticAllowedOutOfBoundary:function(){return this._magneticAllowedOutOfBoundary},setItemsMargin:function(t){this._itemsMargin!==t&&(this._itemsMargin=t,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(t){switch(t){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:return;default:return}ccui.ScrollView.prototype.setDirection.call(this,t)},_getHowMuchOutOfBoundary:function(t){if(t===void 0&&(t=exports.cc.p(0,0)),!this._magneticAllowedOutOfBoundary||this._items.length===0)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,t);if(this._magneticType===ccui.ListView.MAGNETIC_NONE||this._magneticType===ccui.ListView.MAGNETIC_BOTH_END)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,t);if(t.x===0&&t.y===0&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=this._leftBoundary,r=this._rightBoundary,n=this._topBoundary,s=this._bottomBoundary,o=this._items.length-1,a=this.getContentSize(),c=exports.cc.p(0,0),l=exports.cc.p(0,0);switch(this._magneticType){case ccui.ListView.MAGNETIC_CENTER:c.x=(a.width-this._items[0].width)/2,c.y=(a.height-this._items[0].height)/2,l.x=(a.width-this._items[o].width)/2,l.y=(a.height-this._items[o].height)/2;break;case ccui.ListView.MAGNETIC_LEFT:case ccui.ListView.MAGNETIC_TOP:l.x=a.width-this._items[o].width,l.y=a.height-this._items[o].height;break;case ccui.ListView.MAGNETIC_RIGHT:case ccui.ListView.MAGNETIC_BOTTOM:c.x=a.width-this._items[0].width,c.y=a.height-this._items[0].height;break}e+=c.x,r-=l.x,n-=c.y,s+=l.y;var h=exports.cc.p(0,0);return this._innerContainer.getLeftBoundary()+t.x>e?h.x=e-(this._innerContainer.getLeftBoundary()+t.x):this._innerContainer.getRightBoundary()+t.x<r&&(h.x=r-(this._innerContainer.getRightBoundary()+t.x)),this._innerContainer.getTopBoundary()+t.y<n?h.y=n-(this._innerContainer.getTopBoundary()+t.y):this._innerContainer.getBottomBoundary()+t.y>s&&(h.y=s-(this._innerContainer.getBottomBoundary()+t.y)),t.x===0&&t.y===0&&(this._outOfBoundaryAmount=h,this._outOfBoundaryAmountDirty=!1),h},_calculateItemPositionWithAnchor:function(t,e){var r=exports.cc.p(t.getLeftBoundary(),t.getBottomBoundary()),n=t.getContentSize();return exports.cc.p(r.x+n.width*e.x,r.y+n.height*e.y)},_findClosestItem:function(t,e,r,n,s,o,a){if(exports.cc.assert(n>=0&&o<e.length&&n<=o,""),n===o)return e[n];if(o-n===1)return s<=a?e[n]:e[o];var c=Math.floor((n+o)/2),l=this._calculateItemPositionWithAnchor(e[c],r),h=exports.cc.pLength(exports.cc.pSub(t,l));return s<=a?this._findClosestItem(t,e,r,n,s,c,h):this._findClosestItem(t,e,r,c,h,o,a)},getClosestItemToPosition:function(t,e){if(this._items.length===0)return null;var r=0,n=this._calculateItemPositionWithAnchor(this._items[r],e),s=exports.cc.pLength(exports.cc.pSub(t,n)),o=this._items.length-1,a=this._calculateItemPositionWithAnchor(this._items[o],e),c=exports.cc.pLength(exports.cc.pSub(t,a));return this._findClosestItem(t,this._items,e,r,s,o,c)},getClosestItemToPositionInCurrentView:function(t,e){var r=this.getContentSize(),n=exports.cc.pMult(this._innerContainer.getPosition(),-1);return n.x+=r.width*t.x,n.y+=r.height*t.y,this.getClosestItemToPosition(n,e)},getCenterItemInCurrentView:function(){return this.getClosestItemToPositionInCurrentView(exports.cc.p(.5,.5),exports.cc.p(.5,.5))},getLeftmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(exports.cc.p(0,.5),exports.cc.p(.5,.5)):null},getRightmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(exports.cc.p(1,.5),exports.cc.p(.5,.5)):null},getTopmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(exports.cc.p(.5,1),exports.cc.p(.5,.5)):null},getBottommostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(exports.cc.p(.5,0),exports.cc.p(.5,.5)):null},_calculateItemDestination:function(t,e,r){var n=this.getContentSize(),s=exports.cc.p(0,0);s.x+=n.width*t.x,s.y+=n.height*t.y;var o=this._calculateItemPositionWithAnchor(e,r);return exports.cc.pMult(exports.cc.pSub(o,s),-1)},jumpToBottom:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottom.call(this)},jumpToTop:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTop.call(this)},jumpToLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToLeft.call(this)},jumpToRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToRight.call(this)},jumpToTopLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopLeft.call(this)},jumpToTopRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToTopRight.call(this)},jumpToBottomLeft:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomLeft.call(this)},jumpToBottomRight:function(){this.doLayout(),ccui.ScrollView.prototype.jumpToBottomRight.call(this)},jumpToPercentVertical:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentVertical.call(this,t)},jumpToPercentHorizontal:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentHorizontal.call(this,t)},jumpToPercentBothDirection:function(t){this.doLayout(),ccui.ScrollView.prototype.jumpToPercentBothDirection.call(this,t)},jumpToItem:function(t,e,r){var n=this.getItem(t);if(n){this.doLayout();var s=this._calculateItemDestination(e,n,r);if(!this.bounceEnabled){var o=exports.cc.pSub(s,this._innerContainer.getPosition()),a=this._getHowMuchOutOfBoundary(o);s.x+=a.x,s.y+=a.y}this._jumpToDestination(s)}},scrollToItem:function(t,e,r,n){n===void 0&&(n=1);var s=this.getItem(t);if(s){var o=this._calculateItemDestination(e,s,r);this._startAutoScrollToDestination(o,n,!0)}},requestRefreshView:function(){this._refreshViewDirty=!0},refreshView:function(){this.forceDoLayout()},doLayout:function(){this._doLayout()},requestDoLayout:function(){this._refreshViewDirty=!0},_doLayout:function(){if(this._refreshViewDirty){for(var t=this._items,e=0;e<t.length;e++){var r=t[e];r.setLocalZOrder(e),this._remedyLayoutParameter(r)}this._updateInnerContainerSize(),this._innerContainer.forceDoLayout(),this._refreshViewDirty=!1}},addEventListenerListView:function(t,e){this._listViewEventListener=e,this._listViewEventSelector=t},addEventListener:function(t){this._ccListViewEventCallback=t},_selectedItemEvent:function(t){var e=t===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END;this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,e):this._listViewEventSelector(this,e)),this._ccListViewEventCallback&&this._ccListViewEventCallback(this,e)},interceptTouchEvent:function(t,e,r){if(ccui.ScrollView.prototype.interceptTouchEvent.call(this,t,e,r),!!this._touchEnabled&&t!==ccui.Widget.TOUCH_MOVED){for(var n=e;n;){if(n&&n.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(n);break}n=n.getParent()}e.isHighlighted()&&this._selectedItemEvent(t)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this),this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(t){for(var e=t.getItems(),r=0;r<e.length;r++){var n=e[r];this.pushBackCustomItem(n.clone())}},_copySpecialProperties:function(t){t instanceof ccui.ListView&&(ccui.ScrollView.prototype._copySpecialProperties.call(this,t),this.setItemModel(t._model),this.setItemsMargin(t._itemsMargin),this.setGravity(t._gravity),this._listViewEventListener=t._listViewEventListener,this._listViewEventSelector=t._listViewEventSelector)},_startAttenuatingAutoScroll:function(t,e){var r=t;if(this._items.length!==0&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){r=this._flattenVectorByDirection(r);var n=this._getHowMuchOutOfBoundary(r);if(n.x===0&&n.y===0){var s=this._magneticType;s===ccui.ListView.MAGNETIC_BOTH_END&&(this._direction===ccui.ScrollView.DIR_HORIZONTAL?s=r.x>0?ccui.ListView.MAGNETIC_LEFT:ccui.ListView.MAGNETIC_RIGHT:this._direction===ccui.ScrollView.DIR_VERTICAL&&(s=r.y>0?ccui.ListView.MAGNETIC_BOTTOM:ccui.ListView.MAGNETIC_TOP));var o=this._getAnchorPointByMagneticType(s),a=exports.cc.pMult(this._innerContainer.getPosition(),-1);a.x+=this.width*o.x,a.y+=this.height*o.y;var c=this.getClosestItemToPosition(exports.cc.pSub(a,r),o),l=this._calculateItemPositionWithAnchor(c,o);r=exports.cc.pSub(a,l)}}ccui.ScrollView.prototype._startAttenuatingAutoScroll.call(this,r,e)},_getAnchorPointByMagneticType:function(t){switch(t){case ccui.ListView.MAGNETIC_NONE:return exports.cc.p(0,0);case ccui.ListView.MAGNETIC_BOTH_END:return exports.cc.p(0,1);case ccui.ListView.MAGNETIC_CENTER:return exports.cc.p(.5,.5);case ccui.ListView.MAGNETIC_LEFT:return exports.cc.p(0,.5);case ccui.ListView.MAGNETIC_RIGHT:return exports.cc.p(1,.5);case ccui.ListView.MAGNETIC_TOP:return exports.cc.p(.5,1);case ccui.ListView.MAGNETIC_BOTTOM:return exports.cc.p(.5,0)}return exports.cc.p(0,0)},_startMagneticScroll:function(){if(!(this._items.length===0||this._magneticType===ccui.ListView.MAGNETIC_NONE)){var t=this._getAnchorPointByMagneticType(this._magneticType),e=exports.cc.pMult(this._innerContainer.getPosition(),-1);e.x+=this.width*t.x,e.y+=this.height*t.y;var r=this.getClosestItemToPosition(e,t);this.scrollToItem(this.getIndex(r),t,t)}}});ccui.ListView.create=function(){return new ccui.ListView};ccui.ListView.EVENT_SELECTED_ITEM=0;ccui.ListView.ON_SELECTED_ITEM_START=0;ccui.ListView.ON_SELECTED_ITEM_END=1;ccui.ListView.GRAVITY_LEFT=0;ccui.ListView.GRAVITY_RIGHT=1;ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2;ccui.ListView.GRAVITY_TOP=3;ccui.ListView.GRAVITY_BOTTOM=4;ccui.ListView.GRAVITY_CENTER_VERTICAL=5;ccui.ListView.MAGNETIC_NONE=0;ccui.ListView.MAGNETIC_CENTER=1;ccui.ListView.MAGNETIC_BOTH_END=2;ccui.ListView.MAGNETIC_LEFT=3;ccui.ListView.MAGNETIC_RIGHT=4;ccui.ListView.MAGNETIC_TOP=5;ccui.ListView.MAGNETIC_BOTTOM=6;ccui.PageView=ccui.ListView.extend({_curPageIdx:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_indicator:null,_indicatorPositionAsAnchorPoint:null,ctor:function(){ccui.ListView.prototype.ctor.call(this),this._childFocusCancelOffset=5,this._indicatorPositionAsAnchorPoint=exports.cc.p(.5,.1),this._pageViewEventListener=null,this._pageViewEventSelector=null,this.setDirection(ccui.ScrollView.DIR_HORIZONTAL),this.setMagneticType(ccui.ListView.MAGNETIC_CENTER),this.setScrollBarEnabled(!1)},addWidgetToPage:function(t,e,r){this.insertCustomItem(t,e)},addPage:function(t){this.pushBackCustomItem(t)},insertPage:function(t,e){this.insertCustomItem(t,e)},removePage:function(t){this.removeItem(this.getIndex(t))},removePageAtIndex:function(t){this.removeItem(t)},removeAllPages:function(){this.removeAllItems()},scrollToItem:function(t){ccui.ListView.prototype.scrollToItem.call(this,t,exports.cc.p(.5,.5),exports.cc.p(.5,.5))},scrollToPage:function(t){this.scrollToItem(t)},_doLayout:function(){if(this._refreshViewDirty){if(ccui.ListView.prototype._doLayout.call(this),this._indicator){var t=this.getIndex(this.getCenterItemInCurrentView());this._indicator.indicate(t)}this._refreshViewDirty=!1}},setDirection:function(t){ccui.ListView.prototype.setDirection.call(this,t),t===ccui.ScrollView.DIR_HORIZONTAL?this._indicatorPositionAsAnchorPoint=exports.cc.p(.5,.1):t===ccui.ScrollView.DIR_VERTICAL&&(this._indicatorPositionAsAnchorPoint=exports.cc.p(.1,.5)),this._indicator&&(this._indicator.setDirection(t),this._refreshIndicatorPosition())},setCustomScrollThreshold:function(t){},getCustomScrollThreshold:function(){return 0},setUsingCustomScrollThreshold:function(t){},isUsingCustomScrollThreshold:function(){return!1},_moveInnerContainer:function(t,e){ccui.ListView.prototype._moveInnerContainer.call(this,t,e),this._curPageIdx=this.getIndex(this.getCenterItemInCurrentView()),this._indicator&&this._indicator.indicate(this._curPageIdx)},_onItemListChanged:function(){ccui.ListView.prototype._onItemListChanged.call(this),this._indicator&&this._indicator.reset(this._items.length)},_onSizeChanged:function(){ccui.ListView.prototype._onSizeChanged.call(this),this._refreshIndicatorPosition()},_remedyLayoutParameter:function(t){t.setContentSize(this.getContentSize()),ccui.ListView.prototype._remedyLayoutParameter.call(this,t)},_refreshIndicatorPosition:function(){if(this._indicator){var t=this.getContentSize(),e=t.width*this._indicatorPositionAsAnchorPoint.x,r=t.height*this._indicatorPositionAsAnchorPoint.y;this._indicator.setPosition(exports.cc.p(e,r))}},_handleReleaseLogic:function(t){if(ccui.ScrollView.prototype._handleReleaseLogic.call(this,t),!(this._items.length<=0)){var e=this._flattenVectorByDirection(this._calculateTouchMoveVelocity()),r=500;if(exports.cc.pLength(e)<r)this._startMagneticScroll();else{var n=this.getItem(this._curPageIdx),s=this._calculateItemDestination(exports.cc.p(.5,.5),n,exports.cc.p(.5,.5)),o=exports.cc.pSub(s,this.getInnerContainerPosition());o=this._flattenVectorByDirection(o),e.x*o.x>0||e.y*o.y>0?this._startMagneticScroll():(e.x<0||e.y>0?++this._curPageIdx:--this._curPageIdx,this._curPageIdx=Math.min(this._curPageIdx,this._items.length),this._curPageIdx=Math.max(this._curPageIdx,0),this.scrollToItem(this._curPageIdx))}}},_getAutoScrollStopEpsilon:function(){return .001},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING):this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING)),this._ccEventCallback&&this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(t,e){this._pageViewEventSelector=t,this._pageViewEventListener=e},addEventListener:function(t){this._ccEventCallback=function(e,r){r==ccui.ScrollView.EVENT_AUTOSCROLL_ENDED&&t(this,r)}},setCurrentPageIndex:function(t){this.jumpToItem(t,exports.cc.p(.5,.5),exports.cc.p(.5,.5))},setCurPageIndex:function(t){this.setCurrentPageIndex(t)},getCurrentPageIndex:function(){return this._curPageIdx},getCurPageIndex:function(){var t=this.getCenterItemInCurrentView();return this.getIndex(t)},getPages:function(){return this.getItems()},getPage:function(t){return this.getItem(t)},getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(t){for(var e=t.getPages(),r=0;r<e.length;r++){var n=e[r];this.addPage(n.clone())}},_copySpecialProperties:function(t){ccui.ListView.prototype._copySpecialProperties.call(this,t),this._ccEventCallback=t._ccEventCallback,this._pageViewEventListener=t._pageViewEventListener,this._pageViewEventSelector=t._pageViewEventSelector,this._customScrollThreshold=t._customScrollThreshold},setIndicatorEnabled:function(t){t!=(this._indicator!==null)&&(t?(this._indicator=new ccui.PageViewIndicator,this._indicator.setDirection(this.getDirection()),this.addProtectedChild(this._indicator,1e4),this.setIndicatorSelectedIndexColor(exports.cc.color(100,100,255)),this._refreshIndicatorPosition()):(this.removeProtectedChild(this._indicator),this._indicator=null))},getIndicatorEnabled:function(){return this._indicator!==null},setIndicatorPositionAsAnchorPoint:function(t){this._indicatorPositionAsAnchorPoint=t,this._refreshIndicatorPosition()},getIndicatorPositionAsAnchorPoint:function(){return this._indicatorPositionAsAnchorPoint},setIndicatorPosition:function(t){if(this._indicator){var e=this.getContentSize();this._indicatorPositionAsAnchorPoint.x=t.x/e.width,this._indicatorPositionAsAnchorPoint.y=t.y/e.height,this._indicator.setPosition(t)}},getIndicatorPosition:function(){return exports.cc.assert(this._indicator!==null,""),this._indicator.getPosition()},setIndicatorSpaceBetweenIndexNodes:function(t){this._indicator&&this._indicator.setSpaceBetweenIndexNodes(t)},getIndicatorSpaceBetweenIndexNodes:function(){return exports.cc.assert(this._indicator!==null,""),this._indicator.getSpaceBetweenIndexNodes()},setIndicatorSelectedIndexColor:function(t){this._indicator&&this._indicator.setSelectedIndexColor(t)},getIndicatorSelectedIndexColor:function(){return exports.cc.assert(this._indicator!==null,""),this._indicator.getSelectedIndexColor()},setIndicatorIndexNodesColor:function(t){this._indicator&&this._indicator.setIndexNodesColor(t)},getIndicatorIndexNodesColor:function(){return exports.cc.assert(this._indicator!==null,""),this._indicator.getIndexNodesColor()},setIndicatorIndexNodesScale:function(t){this._indicator&&(this._indicator.setIndexNodesScale(t),this._indicator.indicate(this._curPageIdx))},getIndicatorIndexNodesScale:function(){return exports.cc.assert(this._indicator!==null,""),this._indicator.getIndexNodesScale()},setIndicatorIndexNodesTexture:function(t,e){this._indicator&&(this._indicator.setIndexNodesTexture(t,e),this._indicator.indicate(this._curPageIdx))}});ccui.PageView.create=function(){return new ccui.PageView};ccui.PageView.EVENT_TURNING=0;ccui.PageView.TOUCH_DIR_LEFT=0;ccui.PageView.TOUCH_DIR_RIGHT=1;ccui.PageView.DIRECTION_LEFT=0;ccui.PageView.DIRECTION_RIGHT=1;ccui.PageViewIndicator=ccui.ProtectedNode.extend({_direction:null,_indexNodes:null,_currentIndexNode:null,_spaceBetweenIndexNodes:0,_indexNodesScale:1,_indexNodesColor:null,_useDefaultTexture:!0,_indexNodesTextureFile:"",_indexNodesTexType:ccui.Widget.LOCAL_TEXTURE,_className:"PageViewIndicator",ctor:function(){exports.cc.ProtectedNode.prototype.ctor.call(this),this._direction=ccui.ScrollView.DIR_HORIZONTAL,this._indexNodes=[],this._spaceBetweenIndexNodes=ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT,this._indexNodesColor=exports.cc.color.WHITE,this._currentIndexNode=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY),this._currentIndexNode.setVisible(!1),this.addProtectedChild(this._currentIndexNode,1)},setDirection:function(t){this._direction=t,this._rearrange()},reset:function(t){for(;this._indexNodes.length<t;)this._increaseNumberOfPages();for(;this._indexNodes.length>t;)this._decreaseNumberOfPages();this._rearrange(),this._currentIndexNode.setVisible(this._indexNodes.length>0)},indicate:function(t){t<0||t>=this._indexNodes.length||this._currentIndexNode.setPosition(this._indexNodes[t].getPosition())},_rearrange:function(){if(this._indexNodes.length!==0)for(var t=this._direction===ccui.ScrollView.DIR_HORIZONTAL,e=this._indexNodes[0].getContentSize(),r=t?e.width:e.height,n=this._indexNodes.length,s=r*n+this._spaceBetweenIndexNodes*(n-1),o=-(s/2)+r/2,a=0;a<this._indexNodes.length;++a){var c;t?c=exports.cc.p(o,e.height/2):c=exports.cc.p(e.width/2,-o),this._indexNodes[a].setPosition(c),o+=r+this._spaceBetweenIndexNodes}},setSpaceBetweenIndexNodes:function(t){this._spaceBetweenIndexNodes!==t&&(this._spaceBetweenIndexNodes=t,this._rearrange())},getSpaceBetweenIndexNodes:function(){return this._spaceBetweenIndexNodes},setSelectedIndexColor:function(t){this._currentIndexNode.setColor(t)},getSelectedIndexColor:function(){return this._currentIndexNode.getColor()},setIndexNodesColor:function(t){this._indexNodesColor=t;for(var e=0;e<this._indexNodes.length;++e)this._indexNodes[e].setColor(t)},getIndexNodesColor:function(){var t=this._indexNodesColor;return exports.cc.color(t.r,t.g,t.b,t.a)},setIndexNodesScale:function(t){if(this._indexNodesScale!==t){this._indexNodesScale=t,this._currentIndexNode.setScale(t);for(var e=0;e<this._indexNodes.length;++e)this._indexNodes[e].setScale(this,_indexNodesScale);this._rearrange()}},getIndexNodesScale:function(){return this._indexNodesScale},setIndexNodesTexture:function(t,e){switch(e===void 0&&(e=ccui.Widget.LOCAL_TEXTURE),this._useDefaultTexture=!1,this._indexNodesTextureFile=t,this._indexNodesTexType=e,e){case ccui.Widget.LOCAL_TEXTURE:this._currentIndexNode.setTexture(t);for(var r=0;r<this._indexNodes.length;++r)this._indexNodes[r].setTexture(t);break;case ccui.Widget.PLIST_TEXTURE:this._currentIndexNode.setSpriteFrame(t);for(var r=0;r<this._indexNodes.length;++r)this._indexNodes[r].setSpriteFrame(t);break}this._rearrange()},_increaseNumberOfPages:function(){var t;if(this._useDefaultTexture)t=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY);else switch(t=new exports.cc.Sprite,this._indexNodesTexType){case ccui.Widget.LOCAL_TEXTURE:t.initWithFile(this._indexNodesTextureFile);break;case ccui.Widget.PLIST_TEXTURE:t.initWithSpriteFrameName(this._indexNodesTextureFile);break}t.setColor(this._indexNodesColor),t.setScale(this._indexNodesScale),this.addProtectedChild(t),this._indexNodes.push(t)},_decreaseNumberOfPages:function(){this._indexNodes.length!==0&&(this.removeProtectedChild(this._indexNodes[0]),this._indexNodes.splice(0,1))},clear:function(){for(var t=0;t<this._indexNodes.length;++t)this.removeProtectedChild(this._indexNodes[t]);this._indexNodes.length=0,this._currentIndexNode.setVisible(!1)}});var _p=ccui.PageViewIndicator.prototype;_p.spaceBetweenIndexNodes;exports.cc.defineGetterSetter(_p,"spaceBetweenIndexNodes",_p.getSpaceBetweenIndexNodes,_p.setSpaceBetweenIndexNodes);ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT=23;ccui.PageViewIndicator.CIRCLE_IMAGE_KEY="/__circle_image";ccui.PageViewIndicator.CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAA8ElEQVRIx62VyRGCQBBF+6gWRCEmYDIQkhiBCgHhSclC8YqWzOV5oVzKAYZp3r1/9fpbxAIBMTsKrjx5cqVgR0wgLhCRUWOjJiPqD56xoaGPhpRZV/iSEy6crHmw5oIrF9b/lVeMofrJgjlnxlIy/wik+JB+mme8BExbBhm+5CJC2LE2LtSEQoyGWDioBA5CoRIohJtK4CYDxzNEM4GAugR1E9VjVC+SZpXvhCJCrjomESLvc17pDGX7bWmlh6UtpjPVCWy9zaJ0TD7qfm3pwERMz2trRVZk3K3BD/L34AY+dEDCniMVBkPFkT2J/b2/AIV+dRpFLOYoAAAAAElFTkSuQmCC";ccui.VideoPlayer=ccui.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.setURL(t)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){var t=this,e=this._renderCmd._video;e&&(this._played=!0,e.pause(),(this._stopped!==!1||this._playing!==!1||this._played!==!0)&&(e.currentTime=0),ccui.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){e.play(),t._playing=!0,t._stopped=!1},20):(e.play(),this._playing=!0,this._stopped=!1))},pause:function(){var t=this._renderCmd._video;t&&this._playing===!0&&this._stopped===!1&&(t.pause(),this._playing=!1)},resume:function(){this._stopped===!1&&this._playing===!1&&this._played===!0&&this.play()},stop:function(){var t=this,e=this._renderCmd._video;e&&(e.pause(),e.currentTime=0,this._playing=!1,this._stopped=!0),setTimeout(function(){t._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(t){var e=this._renderCmd._video;e&&(e.currentTime=t,ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){e.play()},20))},isPlaying:function(){return ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){video.play()},20),this._playing},setKeepAspectRatioEnabled:function(t){exports.cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?exports.cc.screen.requestFullScreen(e):exports.cc.screen.exitFullScreen(e))},isFullScreenEnabled:function(){exports.cc.log("Can't know status")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var t=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(t)for(var e=0;e<t.length;e++)t[e].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),e===void 0&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);var t=ccui.VideoPlayer.elements;t.indexOf(this)===-1&&t.push(this)},onExit:function(){ccui.Widget.prototype.onExit.call(this);var t=ccui.VideoPlayer.elements,e=t.indexOf(this);e!==-1&&t.splice(e,1)}});ccui.VideoPlayer.elements=[];ccui.VideoPlayer.pauseElements=[];exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_HIDE,function(){for(var t=ccui.VideoPlayer.elements,e,r=0;r<t.length;r++)e=t[r],t[r]._playing&&(e.pause(),ccui.VideoPlayer.pauseElements.push(e))});exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_SHOW,function(){for(var t=ccui.VideoPlayer.pauseElements,e=t.pop();e;)e.play(),e=t.pop()});ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"};(function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},function(){var r=document.createElement("video");r.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),r.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),r.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm")}(),exports.cc.sys.OS_IOS===exports.cc.sys.os&&(t._polyfill.devicePixelRatio=!0,t._polyfill.event="progress"),exports.cc.sys.browserType===exports.cc.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0);var e=document.createElement("style");e.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(e)})(ccui.VideoPlayer);(function(t){var e=null;exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?e=exports.cc.Node.WebGLRenderCmd:e=exports.cc.Node.CanvasRenderCmd,ccui.VideoPlayer.RenderCmd=function(n){e.call(this,n),this._listener=null,this._url="",this.initStyle()};var r=ccui.VideoPlayer.RenderCmd.prototype=Object.create(e.prototype);r.constructor=ccui.VideoPlayer.RenderCmd,r.visit=function(){var n=this,s=exports.cc.container,o=exports.cc.eventManager;if(this._node._visible)s.appendChild(this._video),this._listener===null&&(this._listener=exports.cc.eventManager.addCustomListener(exports.cc.game.EVENT_RESIZE,function(){n.resize()}));else{var a=!1;"contains"in s?a=s.contains(this._video):a=s.compareDocumentPosition(this._video)%16,a&&s.removeChild(this._video),o.removeListener(this._listener),this._listener=null}this.updateStatus()},r.transform=function(n,s){this.originTransform(n,s),this.updateMatrix(this._worldTransform,exports.cc.view._scaleX,exports.cc.view._scaleY)},r.updateStatus=function(){t.devicePixelRatio=exports.cc.view.isRetinaEnabled();var n=exports.cc.Node._dirtyFlags,s=this._dirtyFlag;s&n.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,exports.cc.view._scaleX,exports.cc.view._scaleY),this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty^this._dirtyFlag),s&n.orderDirty&&(this._dirtyFlag=this._dirtyFlag&n.orderDirty^this._dirtyFlag)},r.resize=function(n){n=n||exports.cc.view;var s=this._node,o=exports.cc.eventManager;s._parent&&s._visible?this.updateMatrix(this._worldTransform,n._scaleX,n._scaleY):(o.removeListener(this._listener),this._listener=null)},r.updateMatrix=function(n,s,o){var a=this._node;if(t.devicePixelRatio){var c=exports.cc.view.getDevicePixelRatio();s=s/c,o=o/c}if(this._loaded!==!1){var l=a._contentSize.width,h=a._contentSize.height,u=n.a*s,_=n.b,d=n.c,f=n.d*o,T=n.tx*s-l/2+l*a._scaleX/2*s,x=n.ty*o-h/2+h*a._scaleY/2*o,m="matrix("+u+","+_+","+d+","+f+","+T+","+-x+")";this._video.style.transform=m,this._video.style["-webkit-transform"]=m}},r.updateURL=function(n){var s,o,a,c,l,h=this._node;if(this._url!=n){this._url=n,exports.cc.loader.resPath&&!/^http/.test(n)&&(n=exports.cc.path.join(exports.cc.loader.resPath,n)),a=!1,c=exports.cc.container,"contains"in c?a=c.contains(this._video):a=c.compareDocumentPosition(this._video)%16,a&&c.removeChild(this._video),this._video=document.createElement("video"),o=this._video,this.bindEvent();var u=this||window,_=function(){u._loaded!=!0&&(u._loaded=!0,u.changeSize(),u.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),o.removeEventListener(t.event,_),o.currentTime=0,o.style.visibility="visible",o.play(),h._played||(o.pause(),o.currentTime=0))};o.addEventListener(t.event,_),o.preload="metadata",o.style.visibility="hidden",this._loaded=!1,h._played=!1,h._playing=!1,h._stopped=!0,this.initStyle(),this.visit(),s=document.createElement("source"),s.src=n,o.appendChild(s),l=exports.cc.path.extname(n);for(var d=0;d<t.canPlayType.length;d++)l!==t.canPlayType[d]&&(s=document.createElement("source"),s.src=n.replace(l,t.canPlayType[d]),o.appendChild(s))}},r.bindEvent=function(){var n=this,s=this._node,o=this._video;o.addEventListener("ended",function(){s._renderCmd.updateMatrix(n._worldTransform,exports.cc.view._scaleX,exports.cc.view._scaleY),s._playing=!1,s._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)}),o.addEventListener("play",function(){s._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)}),o.addEventListener("pause",function(){s._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)})},r.initStyle=function(){if(this._video){var n=this._video;n.style.position="absolute",n.style.bottom="0px",n.style.left="0px",n.className="cocosVideo"}},r.changeSize=function(n,s){var o=this._node._contentSize;n=n||o.width,s=s||o.height;var a=this._video;a&&(n!==0&&(a.width=n),s!==0&&(a.height=s))},r.removeDom=function(){var n=this._video;if(n){var s=!1;"contains"in exports.cc.container?s=exports.cc.container.contains(n):s=exports.cc.container.compareDocumentPosition(n)%16,s&&exports.cc.container.removeChild(n)}}})(ccui.VideoPlayer._polyfill);ccui.WebView=ccui.Widget.extend({ctor:function(t){ccui.Widget.prototype.ctor.call(this),this._EventList={},t&&this.loadURL(t)},setJavascriptInterfaceScheme:function(t){},loadData:function(t,e,r,n){},loadHTMLString:function(t,e){},loadURL:function(t){this._renderCmd.updateURL(t),this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){exports.cc.log("Web does not support loading")},reload:function(){var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;e&&e.location&&e.location.reload()}},canGoBack:function(){return exports.cc.log("Web does not support query history"),!0},canGoForward:function(){return exports.cc.log("Web does not support query history"),!0},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return exports.cc.log("The current browser does not support the GoBack");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)try{e.history.back.call(e)}catch(r){e.history.back()}}}catch(r){exports.cc.log(r)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return exports.cc.log("The current browser does not support the GoForward");var t=this._renderCmd._iframe;if(t){var e=t.contentWindow;if(e&&e.location)try{e.history.forward.call(e)}catch(r){e.history.forward()}}}catch(r){exports.cc.log(r)}},evaluateJS:function(t){var e=this._renderCmd._iframe;if(e){var r=e.contentWindow;try{r.eval(t),this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(n){console.error(n)}}},setScalesPageToFit:function(){exports.cc.log("Web does not support zoom")},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(t,e){ccui.Widget.prototype.setContentSize.call(this,t,e),e===void 0&&(e=t.height,t=t.width),this._renderCmd.changeSize(t,e)},cleanup:function(){this._renderCmd.removeDom(),this.stopAllActions(),this.unscheduleAllCallbacks()}});ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"};(function(){var t=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};exports.cc.sys.os===exports.cc.sys.OS_IOS&&(t.enableDiv=!0),exports.cc.sys.isMobile?exports.cc.sys.browserType===exports.cc.sys.BROWSER_TYPE_FIREFOX&&(t.enableBG=!0):exports.cc.sys.browserType===exports.cc.sys.BROWSER_TYPE_IE&&(t.closeHistory=!0)})();(function(t){var e=null;exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?e=exports.cc.Node.WebGLRenderCmd:e=exports.cc.Node.CanvasRenderCmd,ccui.WebView.RenderCmd=function(n){e.call(this,n),this._div=null,this._iframe=null,t.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._div.appendChild(this._iframe)):this._div=this._iframe=document.createElement("iframe"),t.enableBG&&(this._div.style.background="#FFF"),this._iframe.addEventListener("load",function(){n._dispatchEvent(ccui.WebView.EventType.LOADED)}),this._iframe.addEventListener("error",function(){n._dispatchEvent(ccui.WebView.EventType.ERROR)}),this._div.style.background="#FFF",this._div.style.height="200px",this._div.style.width="300px",this._div.style.overflow="scroll",this._listener=null,this.initStyle()};var r=ccui.WebView.RenderCmd.prototype=Object.create(e.prototype);r.constructor=ccui.WebView.RenderCmd,r.transform=function(n,s){this.originTransform(n,s),this.updateMatrix(this._worldTransform,exports.cc.view._scaleX,exports.cc.view._scaleY)},r.updateStatus=function(){t.devicePixelRatio=exports.cc.view.isRetinaEnabled();var n=exports.cc.Node._dirtyFlags,s=this._dirtyFlag;s&n.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,exports.cc.view._scaleX,exports.cc.view._scaleY),this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty^this._dirtyFlag),s&n.orderDirty&&(this._dirtyFlag=this._dirtyFlag&n.orderDirty^this._dirtyFlag)},r.visit=function(){var n=this,s=exports.cc.container,o=exports.cc.eventManager;if(this._node._visible)s.appendChild(this._div),this._listener===null&&(this._listener=o.addCustomListener(exports.cc.game.EVENT_RESIZE,function(){n.resize()}));else{var a=!1;"contains"in s?a=s.contains(this._div):a=s.compareDocumentPosition(this._div)%16,a&&s.removeChild(this._div);var c=o._listenersMap[exports.cc.game.EVENT_RESIZE].getFixedPriorityListeners();o._removeListenerInVector(c,this._listener),this._listener=null}this.updateStatus(),this.resize(exports.cc.view)},r.resize=function(n){n=n||exports.cc.view;var s=this._node,o=exports.cc.eventManager;if(s._parent&&s._visible)this.updateMatrix(this._worldTransform,n._scaleX,n._scaleY);else{var a=o._listenersMap[exports.cc.game.EVENT_RESIZE].getFixedPriorityListeners();o._removeListenerInVector(a,this._listener),this._listener=null}},r.updateMatrix=function(n,s,o){var a=this._node;if(t.devicePixelRatio&&s!==1&&s!==1){var c=exports.cc.view.getDevicePixelRatio();s=s/c,o=o/c}if(this._loaded!==!1){var l=a._contentSize.width,h=a._contentSize.height,u=n.a*s,_=n.b,d=n.c,f=n.d*o,T=n.tx*s-l/2+l*a._scaleX/2*s,x=n.ty*o-h/2+h*a._scaleY/2*o,m="matrix("+u+","+_+","+d+","+f+","+T+","+-x+")";this._div.style.transform=m,this._div.style["-webkit-transform"]=m}},r.initStyle=function(){if(this._div){var n=this._div;n.style.position="absolute",n.style.bottom="0px",n.style.left="0px"}},r.updateURL=function(n){var s=this._iframe;s.src=n;var o=this||window,a=function(){o._loaded=!0,s.removeEventListener("load",a)};s.addEventListener("load",a)},r.changeSize=function(n,s){var o=this._div;o&&(o.style.width=n+"px",o.style.height=s+"px")},r.removeDom=function(){var n=this._div;if(n){var s=!1;"contains"in exports.cc.container?s=exports.cc.container.contains(n):s=exports.cc.container.compareDocumentPosition(n)%16,s&&exports.cc.container.removeChild(n)}}})(ccui.WebView._polyfill);exports.cc.Component=exports.cc.Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null,this._name="",this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(t){},serialize:function(t){},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},getName:function(){return this._name},setName:function(t){this._name=t},setOwner:function(t){this._owner=t},getOwner:function(){return this._owner}});exports.cc.Component.create=function(){return new exports.cc.Component};ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3};ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3};ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2};ccui.LayoutComponent=exports.cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){var t=!0;return exports.cc.Component.prototype.init.call(this)?t:!1},getPercentContentSize:function(){return exports.cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(t){this.setPercentWidth(t.x),this.setPercentHeight(t.y)},setUsingPercentContentSize:function(t){this._usingPercentWidth=this._usingPercentHeight=t},SetActiveEnable:function(t){this._actived=t},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(t,e){var r=this._owner.getBoundingBox();this._owner.setAnchorPoint(t,e);var n=this._owner.getBoundingBox(),s=r.x-n.x,o=r.y-n.y,a=this._owner.getPosition();a.x+=s,a.y+=o,this.setPosition(a)},getPosition:function(){return this._owner.getPosition()},setPosition:function(t,e){var r=this._getOwnerParent(),n;if(r!=null){e===void 0?(n=t.x,e=t.y):n=t;var s=r.getContentSize();s.width!==0?this._positionPercentX=n/s.width:(this._positionPercentX=0,this._usingPositionPercentX&&(n=0)),s.height!==0?this._positionPercentY=e/s.height:(this._positionPercentY=0,this._usingPositionPercentY&&(e=0)),this._owner.setPosition(n,e),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setPosition(t,e)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(t){this._usingPositionPercentX=t,this._usingPositionPercentX&&(this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE)},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(t){this._positionPercentX=t;var e=this._getOwnerParent();e!==null&&(this._owner.setPositionX(e.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(t){this._usingPositionPercentY=t,this._usingPositionPercentY&&(this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE)},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(t){this._positionPercentY=t;var e=this._getOwnerParent();e!==null&&(this._owner.setPositionY(e.height*this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(t){this._horizontalEdge=t,this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var e=this._getOwnerParent();if(e!==null){var r=this._owner.getPosition(),n=e.getContentSize();n.width!==0?this._positionPercentX=r.x/n.width:(this._positionPercentX=0,r.x=0,this._usingPositionPercentX&&this._owner.setPosition(r)),this._refreshHorizontalMargin()}},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(t){this._verticalEdge=t,this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var e=this._getOwnerParent();if(e!==null){var r=this._owner.getPosition(),n=e.getContentSize();n.height!==0?this._positionPercentY=r.y/n.height:(this._positionPercentY=0,r.y=0,this._usingPositionPercentY&&this._owner.setPosition(r)),this._refreshVerticalMargin()}},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(t){this._leftMargin=t},getRightMargin:function(){return this._rightMargin},setRightMargin:function(t){this._rightMargin=t},getTopMargin:function(){return this._topMargin},setTopMargin:function(t){this._topMargin=t},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(t){this._bottomMargin=t},getSize:function(){return this.getOwner().getContentSize()},setSize:function(t){var e=this._getOwnerParent();if(e!==null){var r=t,n=e.getContentSize();n.width!==0?this._percentWidth=r.width/n.width:(this._percentWidth=0,this._usingPercentWidth&&(r.width=0)),n.height!==0?this._percentHeight=r.height/n.height:(this._percentHeight=0,this._usingPercentHeight&&(r.height=0)),this._owner.setContentSize(r),this._refreshHorizontalMargin(),this._refreshVerticalMargin()}else this._owner.setContentSize(t)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(t){this._usingPercentWidth=t,this._usingPercentWidth&&(this._usingStretchWidth=!1)},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(t){var e=this._owner.getContentSize();e.width=t;var r=this._getOwnerParent();if(r!==null){var n=r.getContentSize();n.width!==0?this._percentWidth=e.width/n.width:(this._percentWidth=0,this._usingPercentWidth&&(e.width=0)),this._owner.setContentSize(e),this._refreshHorizontalMargin()}else this._owner.setContentSize(e)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(t){this._percentWidth=t;var e=this._getOwnerParent();if(e!==null){var r=this._owner.getContentSize();r.width=e.width*this._percentWidth,this._owner.setContentSize(r),this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(t){this._usingPercentHeight=t,this._usingPercentHeight&&(this._usingStretchHeight=!1)},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(t){var e=this._owner.getContentSize();e.height=t;var r=this._getOwnerParent();if(r!==null){var n=r.getContentSize();n.height!==0?this._percentHeight=e.height/n.height:(this._percentHeight=0,this._usingPercentHeight&&(e.height=0)),this._owner.setContentSize(e),this._refreshVerticalMargin()}else this._owner.setContentSize(e)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(t){this._percentHeight=t;var e=this._getOwnerParent();if(e!==null){var r=this._owner.getContentSize();r.height=e.height*this._percentHeight,this._owner.setContentSize(r),this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(t){this._usingStretchWidth=t,this._usingStretchWidth&&(this._usingPercentWidth=!1)},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(t){this._usingStretchHeight=t,this._usingStretchHeight&&(this._usingPercentHeight=!1)},setPercentOnlyEnabled:function(t){this._isPercentOnly=t},setActiveEnabled:function(t){this._actived=t},refreshLayout:function(){if(this._actived){var t=this._getOwnerParent();if(t!==null){var e=t.getContentSize(),r=this._owner,n=r.getAnchorPoint(),s=r.getContentSize(),o=r.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&!this._isPercentOnly?(s.width=e.width*this._percentWidth,o.x=this._leftMargin+n.x*s.width):(this._usingPositionPercentX&&(o.x=e.width*this._positionPercentX),this._usingPercentWidth&&(s.width=e.width*this._percentWidth));break;case ccui.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(s.width=e.width*this._percentWidth),o.x=this._leftMargin+n.x*s.width;break;case ccui.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;(this._usingPercentWidth||this._usingStretchWidth)&&(s.width=e.width*this._percentWidth),o.x=e.width-(this._rightMargin+(1-n.x)*s.width);break;case ccui.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchWidth?(s.width=e.width-this._leftMargin-this._rightMargin,s.width<0&&(s.width=0),o.x=this._leftMargin+n.x*s.width):(this._usingPercentWidth&&(s.width=e.width*this._percentWidth),o.x=e.width*this._positionPercentX);break}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&!this._isPercentOnly?(s.height=e.height*this._percentHeight,o.y=this._bottomMargin+n.y*s.height):(this._usingPositionPercentY&&(o.y=e.height*this._positionPercentY),this._usingPercentHeight&&(s.height=e.height*this._percentHeight));break;case ccui.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(s.height=e.height*this._percentHeight),o.y=this._bottomMargin+n.y*s.height;break;case ccui.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;(this._usingPercentHeight||this._usingStretchHeight)&&(s.height=e.height*this._percentHeight),o.y=e.height-(this._topMargin+(1-n.y)*s.height);break;case ccui.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchHeight?(s.height=e.height-this._topMargin-this._bottomMargin,s.height<0&&(s.height=0),o.y=this._bottomMargin+n.y*s.height):(this._usingPercentHeight&&(s.height=e.height*this._percentHeight),o.y=e.height*this._positionPercentY);break}if(r.setPosition(o),r.setContentSize(s),r instanceof ccui.PageView){r.forceDoLayout();for(var a=r.getPages(),c=0;c<a.length;c++)ccui.helper.doLayout(a[c])}else ccui.helper.doLayout(r)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var t=this._getOwnerParent();if(t!==null){var e=this._owner.getPosition(),r=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),s=t.getContentSize();this._leftMargin=e.x-r.x*n.width,this._rightMargin=s.width-(e.x+(1-r.x)*n.width)}},_refreshVerticalMargin:function(){var t=this._getOwnerParent();if(t!==null){var e=this._owner.getPosition(),r=this._owner.getAnchorPoint(),n=this._owner.getContentSize(),s=t.getContentSize();this._bottomMargin=e.y-r.y*n.height,this._topMargin=s.height-(e.y+(1-r.y)*n.height)}}});ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3};ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3};ccui.LayoutComponent.NAME="__ui_layout";ccui.LayoutComponent.bindLayoutComponent=function(t){var e=t.getComponent(ccui.LayoutComponent.NAME);return e!==void 0||(e=new ccui.LayoutComponent,e.init(),t.addComponent(e),t instanceof ccui.Widget||t.addEventListener&&t.addEventListener("load",function(){e.refreshLayout()},this)),e};exports.cc.ComponentContainer=exports.cc.Class.extend({_components:null,_owner:null,ctor:function(t){this._components=null,this._owner=t},getComponent:function(t){if(!t)throw new Error("cc.ComponentContainer.getComponent(): name should be non-null");return t=t.trim(),this._components||(this._components={}),this._components[t]},add:function(t){if(!t)throw new Error("cc.ComponentContainer.add(): component should be non-null");if(t.getOwner())return exports.cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1;this._components==null&&(this._components={},this._owner.scheduleUpdate());var e=this._components[t.getName()];return e?(exports.cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(t.setOwner(this._owner),this._components[t.getName()]=t,t.onEnter(),!0)},remove:function(t){if(!t)throw new Error("cc.ComponentContainer.remove(): name should be non-null");return this._components?t instanceof exports.cc.Component?this._removeByComponent(t):(t=t.trim(),this._removeByComponent(this._components[t])):!1},_removeByComponent:function(t){return t?(t.onExit(),t.setOwner(null),delete this._components[t.getName()],!0):!1},removeAll:function(){if(this._components){var t=this._components;for(var e in t){var r=t[e];r.onExit(),r.setOwner(null),delete t[e]}this._owner.unscheduleUpdate(),this._components=null}},_alloc:function(){this._components={}},visit:function(t){if(this._components){var e=this._components;for(var r in e)e[r].update(t)}},isEmpty:function(){return this._components?this._components.length===0:!0}});var ccs=ccs||{};ccs.Class=ccs.Class||exports.cc.Class;ccs.Class.extend=ccs.Class.extend||exports.cc.Class.extend;ccs.Node=ccs.Node||exports.cc.Node;ccs.Node.extend=ccs.Node.extend||exports.cc.Node.extend;ccs.Sprite=ccs.Sprite||exports.cc.Sprite;ccs.Sprite.extend=ccs.Sprite.extend||exports.cc.Sprite.extend;ccs.Component=ccs.Component||exports.cc.Component;ccs.Component.extend=ccs.Component.extend||exports.cc.Component.extend;ccs.cocostudioVersion="v1.3.0.0";ccs.VERSION_COMBINED=.3;ccs.VERSION_CHANGE_ROTATION_RANGE=1;ccs.VERSION_COLOR_READING=1.1;ccs.MAX_VERTEXZ_VALUE=5e6;ccs.ARMATURE_MAX_CHILD=50;ccs.ARMATURE_MAX_ZORDER=100;ccs.ARMATURE_MAX_COUNT=ccs.MAX_VERTEXZ_VALUE/ccs.ARMATURE_MAX_CHILD/ccs.ARMATURE_MAX_ZORDER;ccs.AUTO_ADD_SPRITE_FRAME_NAME_PREFIX=!1;ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT=!1;ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX=!1;ccs.armatureVersion=function(){return"v1.1.0.0"};ccs.CONST_VERSION="version";ccs.CONST_VERSION_2_0=2;ccs.CONST_VERSION_COMBINED=.3;ccs.CONST_ARMATURES="armatures";ccs.CONST_ARMATURE="armature";ccs.CONST_BONE="b";ccs.CONST_DISPLAY="d";ccs.CONST_ANIMATIONS="animations";ccs.CONST_ANIMATION="animation";ccs.CONST_MOVEMENT="mov";ccs.CONST_FRAME="f";ccs.CONST_TEXTURE_ATLAS="TextureAtlas";ccs.CONST_SUB_TEXTURE="SubTexture";ccs.CONST_SKELETON="skeleton";ccs.CONST_A_NAME="name";ccs.CONST_A_DURATION="dr";ccs.CONST_A_FRAME_INDEX="fi";ccs.CONST_A_DURATION_TO="to";ccs.CONST_A_DURATION_TWEEN="drTW";ccs.CONST_A_LOOP="lp";ccs.CONST_A_MOVEMENT_SCALE="sc";ccs.CONST_A_MOVEMENT_DELAY="dl";ccs.CONST_A_DISPLAY_INDEX="dI";ccs.CONST_A_PLIST="plist";ccs.CONST_A_PARENT="parent";ccs.CONST_A_SKEW_X="kX";ccs.CONST_A_SKEW_Y="kY";ccs.CONST_A_SCALE_X="cX";ccs.CONST_A_SCALE_Y="cY";ccs.CONST_A_Z="z";ccs.CONST_A_EVENT="evt";ccs.CONST_A_SOUND="sd";ccs.CONST_A_SOUND_EFFECT="sdE";ccs.CONST_A_TWEEN_EASING="twE";ccs.CONST_A_EASING_PARAM="twEP";ccs.CONST_A_TWEEN_ROTATE="twR";ccs.CONST_A_IS_ARMATURE="isArmature";ccs.CONST_A_DISPLAY_TYPE="displayType";ccs.CONST_A_MOVEMENT="mov";ccs.CONST_A_X="x";ccs.CONST_A_Y="y";ccs.CONST_A_COCOS2DX_X="cocos2d_x";ccs.CONST_A_COCOS2DX_Y="cocos2d_y";ccs.CONST_A_WIDTH="width";ccs.CONST_A_HEIGHT="height";ccs.CONST_A_PIVOT_X="pX";ccs.CONST_A_PIVOT_Y="pY";ccs.CONST_A_COCOS2D_PIVOT_X="cocos2d_pX";ccs.CONST_A_COCOS2D_PIVOT_Y="cocos2d_pY";ccs.CONST_A_BLEND_TYPE="bd";ccs.CONST_A_BLEND_SRC="bd_src";ccs.CONST_A_BLEND_DST="bd_dst";ccs.CONST_A_ALPHA="a";ccs.CONST_A_RED="r";ccs.CONST_A_GREEN="g";ccs.CONST_A_BLUE="b";ccs.CONST_A_ALPHA_OFFSET="aM";ccs.CONST_A_RED_OFFSET="rM";ccs.CONST_A_GREEN_OFFSET="gM";ccs.CONST_A_BLUE_OFFSET="bM";ccs.CONST_A_COLOR_TRANSFORM="colorTransform";ccs.CONST_A_TWEEN_FRAME="tweenFrame";ccs.CONST_CONTOUR="con";ccs.CONST_CONTOUR_VERTEX="con_vt";ccs.CONST_FL_NAN="NaN";ccs.CONST_FRAME_DATA="frame_data";ccs.CONST_MOVEMENT_BONE_DATA="mov_bone_data";ccs.CONST_MOVEMENT_DATA="mov_data";ccs.CONST_ANIMATION_DATA="animation_data";ccs.CONST_DISPLAY_DATA="display_data";ccs.CONST_SKIN_DATA="skin_data";ccs.CONST_BONE_DATA="bone_data";ccs.CONST_ARMATURE_DATA="armature_data";ccs.CONST_CONTOUR_DATA="contour_data";ccs.CONST_TEXTURE_DATA="texture_data";ccs.CONST_VERTEX_POINT="vertex";ccs.CONST_COLOR_INFO="color";ccs.CONST_CONFIG_FILE_PATH="config_file_path";ccs.CONST_CONTENT_SCALE="content_scale";ccs.DataInfo=function(){this.asyncStruct=null,this.configFileQueue=[],this.contentScale=1,this.filename="",this.baseFilePath="",this.flashToolVersion=0,this.cocoStudioVersion=0};ccs.dataReaderHelper={ConfigType:{DragonBone_XML:0,CocoStudio_JSON:1,CocoStudio_Binary:2},_configFileList:[],_flashToolVersion:ccs.CONST_VERSION_2_0,_positionReadScale:1,_asyncRefCount:0,_asyncRefTotalCount:0,_dataQueue:null,setPositionReadScale:function(t){this._positionReadScale=t},getPositionReadScale:function(){return this._positionReadScale},addDataFromFile:function(t){if(this._configFileList.indexOf(t)===-1){this._configFileList.push(t);var e=this._initBaseFilePath(t),r=exports.cc.path.extname(t).toLowerCase(),n=new ccs.DataInfo;n.filename=t,n.basefilePath=e,r===".xml"?ccs.dataReaderHelper.addDataFromXML(t,n):r===".json"||r===".exportjson"?ccs.dataReaderHelper.addDataFromJson(t,n):r===".csb"&&ccs.dataReaderHelper.addDataFromBinaryCache(t,n)}},addDataFromFileAsync:function(t,e,r,n,s){if(this._configFileList.indexOf(r)!==-1){s&&n&&(this._asyncRefTotalCount===0&&this._asyncRefCount===0?this._asyncCallBack(n,s,1):this._asyncCallBack(n,s,(this._asyncRefTotalCount-this._asyncRefCount)/this._asyncRefTotalCount));return}this._asyncRefTotalCount++,this._asyncRefCount++;var o=this||window,a=function(){o.addDataFromFile(r),o._asyncRefCount--,o._asyncCallBack(n,s,(o._asyncRefTotalCount-o._asyncRefCount)/o._asyncRefTotalCount)};exports.cc.director.getScheduler().schedule(a,this,.1,!1,0,!1,"armatrueDataHelper")},removeConfigFile:function(t){for(var e=this._configFileList,r=e.length,n=e[r],s=0;s<r;s++)e[s]===t&&(n=s);n!==e[r]&&exports.cc.arrayRemoveObject(e,t)},addDataFromCache:function(t,e){if(!t){exports.cc.log("XML error  or  XML is empty.");return}e.flashToolVersion=parseFloat(t.getAttribute(ccs.CONST_VERSION));var r=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ARMATURES+" >  "+ccs.CONST_ARMATURE),n=ccs.armatureDataManager,s;for(s=0;s<r.length;s++){var o=this.decodeArmature(r[s],e);n.addArmatureData(o.name,o,e.filename)}var a=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_ANIMATIONS+" >  "+ccs.CONST_ANIMATION);for(s=0;s<a.length;s++){var c=this.decodeAnimation(a[s],e);n.addAnimationData(c.name,c,e.filename)}var l=t.querySelectorAll(ccs.CONST_SKELETON+" > "+ccs.CONST_TEXTURE_ATLAS+" >  "+ccs.CONST_SUB_TEXTURE);for(s=0;s<l.length;s++){var h=this.decodeTexture(l[s],e);n.addTextureData(h.name,h,e.filename)}},decodeArmature:function(t,e){var r=new ccs.ArmatureData;r.init(),r.name=t.getAttribute(ccs.CONST_A_NAME);for(var n=t.querySelectorAll(ccs.CONST_ARMATURE+" > "+ccs.CONST_BONE),s=0;s<n.length;s++){var o=n[s],a=o.getAttribute(ccs.CONST_A_PARENT),c=null;if(a)for(var l=0;l<n.length&&(c=n[l],a!=n[l].getAttribute(ccs.CONST_A_NAME));l++);var h=this.decodeBone(o,c,e);r.addBoneData(h)}return r},decodeArmatureFromJSON:function(t,e){var r=new ccs.ArmatureData;r.init();var n=t[ccs.CONST_A_NAME];n&&(r.name=n),e.cocoStudioVersion=r.dataVersion=t[ccs.CONST_VERSION]||.1;for(var s=t[ccs.CONST_BONE_DATA],o=0;o<s.length;o++){var a=this.decodeBoneFromJson(s[o],e);r.addBoneData(a)}return r},decodeBone:function(t,e,r){var n=new ccs.BoneData;n.init(),n.name=t.getAttribute(ccs.CONST_A_NAME),n.parentName=t.getAttribute(ccs.CONST_A_PARENT)||"",n.zOrder=parseInt(t.getAttribute(ccs.CONST_A_Z))||0;for(var s=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_DISPLAY),o=0;o<s.length;o++){var a=s[o],c=this.decodeBoneDisplay(a,r);n.addDisplayData(c)}return n},decodeBoneFromJson:function(t,e){var r=new ccs.BoneData;r.init(),this.decodeNodeFromJson(r,t,e),r.name=t[ccs.CONST_A_NAME]||"",r.parentName=t[ccs.CONST_A_PARENT]||"";for(var n=t[ccs.CONST_DISPLAY_DATA]||[],s=0;s<n.length;s++){var o=this.decodeBoneDisplayFromJson(n[s],e);r.addDisplayData(o)}return r},decodeBoneDisplay:function(t,e){var r=parseFloat(t.getAttribute(ccs.CONST_A_IS_ARMATURE))||0,n=null;r===1?(n=new ccs.ArmatureDisplayData,n.displayType=ccs.DISPLAY_TYPE_ARMATURE):(n=new ccs.SpriteDisplayData,n.displayType=ccs.DISPLAY_TYPE_SPRITE);var s=t.getAttribute(ccs.CONST_A_NAME)||"";return s&&(n.displayName=s),n},decodeBoneDisplayFromJson:function(t,e){var r=t[ccs.CONST_A_DISPLAY_TYPE]||ccs.DISPLAY_TYPE_SPRITE,n=null;switch(r){case ccs.DISPLAY_TYPE_SPRITE:n=new ccs.SpriteDisplayData;var c=t[ccs.CONST_A_NAME];c!=null&&(n.displayName=c);var s=t[ccs.CONST_SKIN_DATA]||[],o=s[0];if(o){var a=n.skinData;a.x=o[ccs.CONST_A_X]*this._positionReadScale,a.y=o[ccs.CONST_A_Y]*this._positionReadScale,a.scaleX=o[ccs.CONST_A_SCALE_X]==null?1:o[ccs.CONST_A_SCALE_X],a.scaleY=o[ccs.CONST_A_SCALE_Y]==null?1:o[ccs.CONST_A_SCALE_Y],a.skewX=o[ccs.CONST_A_SKEW_X]==null?1:o[ccs.CONST_A_SKEW_X],a.skewY=o[ccs.CONST_A_SKEW_Y]==null?1:o[ccs.CONST_A_SKEW_Y],a.x*=e.contentScale,a.y*=e.contentScale}break;case ccs.DISPLAY_TYPE_ARMATURE:n=new ccs.ArmatureDisplayData;var c=t[ccs.CONST_A_NAME];c!=null&&(n.displayName=t[ccs.CONST_A_NAME]);break;case ccs.DISPLAY_TYPE_PARTICLE:n=new ccs.ParticleDisplayData;var l=t[ccs.CONST_A_PLIST];l!=null&&(e.asyncStruct?n.displayName=e.asyncStruct.basefilePath+l:n.displayName=e.basefilePath+l);break;default:n=new ccs.SpriteDisplayData;break}return n.displayType=r,n},decodeAnimation:function(t,e){var r=new ccs.AnimationData,n=t.getAttribute(ccs.CONST_A_NAME),s=ccs.armatureDataManager.getArmatureData(n);r.name=n;for(var o=t.querySelectorAll(ccs.CONST_ANIMATION+" > "+ccs.CONST_MOVEMENT),a=null,c=0;c<o.length;c++){a=o[c];var l=this.decodeMovement(a,s,e);r.addMovement(l)}return r},decodeAnimationFromJson:function(t,e){var r=new ccs.AnimationData,n=t[ccs.CONST_A_NAME];n&&(r.name=t[ccs.CONST_A_NAME]);for(var s=t[ccs.CONST_MOVEMENT_DATA]||[],o=0;o<s.length;o++){var a=this.decodeMovementFromJson(s[o],e);r.addMovement(a)}return r},decodeMovement:function(t,e,r){var n=new ccs.MovementData;n.name=t.getAttribute(ccs.CONST_A_NAME);var s,o,a,c,l=0;s=t.getAttribute(ccs.CONST_A_DURATION),n.duration=s==null?0:parseFloat(s),o=t.getAttribute(ccs.CONST_A_DURATION_TO),n.durationTo=o==null?0:parseFloat(o),a=t.getAttribute(ccs.CONST_A_DURATION_TWEEN),n.durationTween=a==null?0:parseFloat(a),c=t.getAttribute(ccs.CONST_A_LOOP),n.loop=c?!!parseFloat(c):!0;var h=t.getAttribute(ccs.CONST_A_TWEEN_EASING);h&&(h!=ccs.CONST_FL_NAN?(l=h==null?0:parseFloat(h),n.tweenEasing=l===2?ccs.TweenType.SINE_EASEINOUT:l):n.tweenEasing=ccs.TweenType.LINEAR);for(var u=t.querySelectorAll(ccs.CONST_MOVEMENT+" > "+ccs.CONST_BONE),_=null,d=0;d<u.length;d++){_=u[d];var f=_.getAttribute(ccs.CONST_A_NAME);if(!n.getMovementBoneData(f)){var T=e.getBoneData(f),x=T.parentName,m=null;if(x!=="")for(var v=0;v<u.length&&(m=u[v],x!==m.getAttribute(ccs.CONST_A_NAME));v++);var A=this.decodeMovementBone(_,m,T,r);n.addMovementBoneData(A)}}return n},decodeMovementFromJson:function(t,e){var r=new ccs.MovementData;r.loop=t[ccs.CONST_A_LOOP]==null?!1:t[ccs.CONST_A_LOOP],r.durationTween=t[ccs.CONST_A_DURATION_TWEEN]||0,r.durationTo=t[ccs.CONST_A_DURATION_TO]||0,r.duration=t[ccs.CONST_A_DURATION]||0,t[ccs.CONST_A_DURATION]==null?r.scale=1:r.scale=t[ccs.CONST_A_MOVEMENT_SCALE]==null?1:t[ccs.CONST_A_MOVEMENT_SCALE],r.tweenEasing=t[ccs.CONST_A_TWEEN_EASING]==null?ccs.TweenType.LINEAR:t[ccs.CONST_A_TWEEN_EASING];var n=t[ccs.CONST_A_NAME];n&&(r.name=n);for(var s=t[ccs.CONST_MOVEMENT_BONE_DATA]||[],o=0;o<s.length;o++){var a=this.decodeMovementBoneFromJson(s[o],e);r.addMovementBoneData(a)}return r},decodeMovementBone:function(t,e,r,n){var s=new ccs.MovementBoneData;s.init();var o,a;t&&(o=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_SCALE))||0,s.scale=o,a=parseFloat(t.getAttribute(ccs.CONST_A_MOVEMENT_DELAY))||0,a>0&&(a-=1),s.delay=a);var c=0,l=0,h=0,u=null,_=[];if(e!=null){for(var d=e.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME),f=0;f<d.length;f++)_.push(d[f]);c=_.length}s.name=t.getAttribute(ccs.CONST_A_NAME);for(var T=t.querySelectorAll(ccs.CONST_BONE+" > "+ccs.CONST_FRAME),x=0,m=0,v=0;v<T.length;v++){var A=T[v];if(e)for(;x<c&&(!u||m<l||m>=l+h);)u=_[x],l+=h,h=parseFloat(u.getAttribute(ccs.CONST_A_DURATION)),x++;var D=this.decodeFrame(A,u,r,n);s.addFrameData(D),D.frameID=m,m+=D.duration,s.duration=m}for(var N=s.frameList,z=Math.PI,f=N.length-1;f>=0;f--)if(f>0){var M=N[f].skewX-N[f-1].skewX,J=N[f].skewY-N[f-1].skewY;(M<-z||M>z)&&(N[f-1].skewX=M<0?N[f-1].skewX-2*z:N[f-1].skewX+2*z),(J<-z||J>z)&&(N[f-1].skewY=J<0?N[f-1].skewY-2*z:N[f-1].skewY+2*z)}var U=new ccs.FrameData;return U.copy(s.frameList[s.frameList.length-1]),U.frameID=s.duration,s.addFrameData(U),s},decodeMovementBoneFromJson:function(t,e){var r=new ccs.MovementBoneData;r.init(),r.delay=t[ccs.CONST_A_MOVEMENT_DELAY]||0;var n=t[ccs.CONST_A_NAME];n&&(r.name=n);for(var s=t[ccs.CONST_FRAME_DATA]||[],o=s.length,a=0;a<o;a++){var c=t[ccs.CONST_FRAME_DATA][a],l=this.decodeFrameFromJson(c,e);r.addFrameData(l),e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&(l.frameID=r.duration,r.duration+=l.duration)}if(e.cocoStudioVersion<ccs.VERSION_CHANGE_ROTATION_RANGE){for(var h=r.frameList,u=Math.PI,a=h.length-1;a>=0;a--)if(a>0){var _=h[a].skewX-h[a-1].skewX,d=h[a].skewY-h[a-1].skewY;(_<-u||_>u)&&(h[a-1].skewX=_<0?h[a-1].skewX-2*u:h[a-1].skewX+2*u),(d<-u||d>u)&&(h[a-1].skewY=d<0?h[a-1].skewY-2*u:h[a-1].skewY+2*u)}}if(e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&r.frameList.length>0){var l=new ccs.FrameData;l.copy(r.frameList[r.frameList.length-1]),r.addFrameData(l),l.frameID=r.duration}return r},decodeFrame:function(t,e,r,n){var s=0,o=0,a=0,c=0,l=0,h=0,u=0,_=0,d=0,f=0,T=0,x=0,m=new ccs.FrameData;m.strMovement=t.getAttribute(ccs.CONST_A_MOVEMENT)||"",m.movement=m.strMovement,m.strEvent=t.getAttribute(ccs.CONST_A_EVENT)||"",m.event=m.strEvent,m.strSound=t.getAttribute(ccs.CONST_A_SOUND)||"",m.sound=m.strSound,m.strSoundEffect=t.getAttribute(ccs.CONST_A_SOUND_EFFECT)||"",m.soundEffect=m.strSoundEffect;var v=t.getAttribute(ccs.CONST_A_TWEEN_FRAME);if(m.isTween=!(v!==void 0&&(v==="false"||v==="0")),n.flashToolVersion>=ccs.CONST_VERSION_2_0?(s=t.getAttribute(ccs.CONST_A_COCOS2DX_X),s&&(m.x=parseFloat(s),m.x*=this._positionReadScale),o=t.getAttribute(ccs.CONST_A_COCOS2DX_Y),o&&(m.y=-parseFloat(o),m.y*=this._positionReadScale)):(s=t.getAttribute(ccs.CONST_A_X),s&&(m.x=parseFloat(s),m.x*=this._positionReadScale),o=t.getAttribute(ccs.CONST_A_Y),o&&(m.y=-parseFloat(o),m.y*=this._positionReadScale)),a=t.getAttribute(ccs.CONST_A_SCALE_X),a!=null&&(m.scaleX=parseFloat(a)),c=t.getAttribute(ccs.CONST_A_SCALE_Y),c!=null&&(m.scaleY=parseFloat(c)),l=t.getAttribute(ccs.CONST_A_SKEW_X),l!=null&&(m.skewX=exports.cc.degreesToRadians(parseFloat(l))),h=t.getAttribute(ccs.CONST_A_SKEW_Y),h!=null&&(m.skewY=exports.cc.degreesToRadians(-parseFloat(h))),_=t.getAttribute(ccs.CONST_A_DURATION),_!=null&&(m.duration=parseFloat(_)),d=t.getAttribute(ccs.CONST_A_DISPLAY_INDEX),d!=null&&(m.displayIndex=parseFloat(d)),f=t.getAttribute(ccs.CONST_A_Z),f!=null&&(m.zOrder=parseInt(f)),u=t.getAttribute(ccs.CONST_A_TWEEN_ROTATE),u!=null&&(m.tweenRotate=parseFloat(u)),x=t.getAttribute(ccs.CONST_A_BLEND_TYPE),x!=null){var A=m.blendFunc;switch(x){case ccs.BLEND_TYPE_NORMAL:A.src=exports.cc.BLEND_SRC,A.dst=exports.cc.BLEND_DST;break;case ccs.BLEND_TYPE_ADD:A.src=exports.cc.SRC_ALPHA,A.dst=exports.cc.ONE;break;case ccs.BLEND_TYPE_MULTIPLY:A.src=exports.cc.DST_COLOR,A.dst=exports.cc.ONE_MINUS_SRC_ALPHA;break;case ccs.BLEND_TYPE_SCREEN:A.src=exports.cc.ONE,A.dst=exports.cc.ONE_MINUS_DST_COLOR;break;default:m.blendFunc.src=exports.cc.BLEND_SRC,m.blendFunc.dst=exports.cc.BLEND_DST;break}}var D=t.querySelectorAll(ccs.CONST_FRAME+" > "+ccs.CONST_A_COLOR_TRANSFORM);if(D&&D.length>0){D=D[0];var N,z,M,J,U,K,tt,rt;N=parseFloat(D.getAttribute(ccs.CONST_A_ALPHA))||0,z=parseFloat(D.getAttribute(ccs.CONST_A_RED))||0,M=parseFloat(D.getAttribute(ccs.CONST_A_GREEN))||0,J=parseFloat(D.getAttribute(ccs.CONST_A_BLUE))||0,U=parseFloat(D.getAttribute(ccs.CONST_A_ALPHA_OFFSET))||0,K=parseFloat(D.getAttribute(ccs.CONST_A_RED_OFFSET))||0,tt=parseFloat(D.getAttribute(ccs.CONST_A_GREEN_OFFSET))||0,rt=parseFloat(D.getAttribute(ccs.CONST_A_BLUE_OFFSET))||0,m.a=2.55*U+N,m.r=2.55*K+z,m.g=2.55*tt+M,m.b=2.55*rt+J,m.isUseColorInfo=!0}var I=t.getAttribute(ccs.CONST_A_TWEEN_EASING);if(I!=null&&(I!=ccs.CONST_FL_NAN?(T=t.getAttribute(ccs.CONST_A_TWEEN_EASING),T&&(m.tweenEasing=T===2?ccs.TweenType.SINE_EASEINOUT:T)):m.tweenEasing=ccs.TweenType.LINEAR),e){var L=new ccs.BaseData;n.flashToolVersion>=ccs.CONST_VERSION_2_0?(L.x=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_X)),L.y=parseFloat(e.getAttribute(ccs.CONST_A_COCOS2DX_Y))):(L.x=parseFloat(e.getAttribute(ccs.CONST_A_X)),L.y=parseFloat(e.getAttribute(ccs.CONST_A_Y))),L.skewX=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_X)),L.skewY=parseFloat(e.getAttribute(ccs.CONST_A_SKEW_Y)),L.y=-L.y,L.skewX=exports.cc.degreesToRadians(L.skewX),L.skewY=exports.cc.degreesToRadians(-L.skewY),ccs.TransformHelp.transformFromParent(m,L)}return m},decodeFrameFromJson:function(t,e){var r=new ccs.FrameData;this.decodeNodeFromJson(r,t,e),r.tweenEasing=t[ccs.CONST_A_TWEEN_EASING]||ccs.TweenType.LINEAR,r.displayIndex=t[ccs.CONST_A_DISPLAY_INDEX];var n=t[ccs.CONST_A_BLEND_SRC]==null?exports.cc.BLEND_SRC:t[ccs.CONST_A_BLEND_SRC],s=t[ccs.CONST_A_BLEND_DST]==null?exports.cc.BLEND_DST:t[ccs.CONST_A_BLEND_DST];r.blendFunc.src=n,r.blendFunc.dst=s,r.isTween=t[ccs.CONST_A_TWEEN_FRAME]==null?!0:t[ccs.CONST_A_TWEEN_FRAME];var o=t[ccs.CONST_A_EVENT];o!=null&&(r.strEvent=o,r.event=o),e.cocoStudioVersion<ccs.CONST_VERSION_COMBINED?r.duration=t[ccs.CONST_A_DURATION]==null?1:t[ccs.CONST_A_DURATION]:r.frameID=t[ccs.CONST_A_FRAME_INDEX];for(var a=t[ccs.CONST_A_EASING_PARAM]||[],c=0;c<a.length;c++)r.easingParams[c]=a[c];return r},decodeTexture:function(t,e){var r=new ccs.TextureData;r.init(),t.getAttribute(ccs.CONST_A_NAME)&&(r.name=t.getAttribute(ccs.CONST_A_NAME));var n,s;e.flashToolVersion>=ccs.CONST_VERSION_2_0?(n=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_X))||0,s=parseFloat(t.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_Y))||0):(n=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_X))||0,s=parseFloat(t.getAttribute(ccs.CONST_A_PIVOT_Y))||0);var o=parseFloat(t.getAttribute(ccs.CONST_A_WIDTH))||0,a=parseFloat(t.getAttribute(ccs.CONST_A_HEIGHT))||0,c=n/o,l=(a-s)/a;r.pivotX=c,r.pivotY=l;for(var h=t.querySelectorAll(ccs.CONST_SUB_TEXTURE+" > "+ccs.CONST_CONTOUR),u=0;u<h.length;u++)r.addContourData(this.decodeContour(h[u],e));return r},decodeTextureFromJson:function(t){var e=new ccs.TextureData;e.init();var r=t[ccs.CONST_A_NAME];r!=null&&(e.name=r),e.width=t[ccs.CONST_A_WIDTH]||0,e.height=t[ccs.CONST_A_HEIGHT]||0,e.pivotX=t[ccs.CONST_A_PIVOT_X]||0,e.pivotY=t[ccs.CONST_A_PIVOT_Y]||0;for(var n=t[ccs.CONST_CONTOUR_DATA]||[],s=0;s<n.length;s++)e.contourDataList.push(this.decodeContourFromJson(n[s]));return e},decodeContour:function(t,e){var r=new ccs.ContourData;r.init();for(var n=t.querySelectorAll(ccs.CONST_CONTOUR+" > "+ccs.CONST_CONTOUR_VERTEX),s,o=0;o<n.length;o++){s=n[o];var a=exports.cc.p(0,0);a.x=parseFloat(s.getAttribute(ccs.CONST_A_X))||0,a.y=parseFloat(s.getAttribute(ccs.CONST_A_Y))||0,a.y=-a.y,r.vertexList.push(a)}return r},decodeContourFromJson:function(t){var e=new ccs.ContourData;e.init();for(var r=t[ccs.CONST_VERTEX_POINT]||[],n=r.length,s=0;s<n;s++){var o=r[s],a=exports.cc.p(0,0);a.x=o[ccs.CONST_A_X]||0,a.y=o[ccs.CONST_A_Y]||0,e.vertexList.push(a)}return e},addDataFromJsonCache:function(t,e){e.contentScale=t[ccs.CONST_CONTENT_SCALE]==null?1:t[ccs.CONST_CONTENT_SCALE];var r=t[ccs.CONST_ARMATURE_DATA]||[],n,s;for(n=0;n<r.length;n++)s=this.decodeArmatureFromJSON(r[n],e),ccs.armatureDataManager.addArmatureData(s.name,s,e.filename);var o=t[ccs.CONST_ANIMATION_DATA]||[],a;for(n=0;n<o.length;n++)a=this.decodeAnimationFromJson(o[n],e),ccs.armatureDataManager.addAnimationData(a.name,a,e.filename);var c=t[ccs.CONST_TEXTURE_DATA]||[],l;for(n=0;n<c.length;n++)l=this.decodeTextureFromJson(c[n],e),ccs.armatureDataManager.addTextureData(l.name,l,e.filename);var h=e.asyncStruct==null?ccs.armatureDataManager.isAutoLoadSpriteFile():e.asyncStruct.autoLoadSpriteFile;if(h){var u=t[ccs.CONST_CONFIG_FILE_PATH]||[],_,d,f,T;for(n=0;n<u.length;n++)_=u[n],d=_.lastIndexOf("."),_=_.substring(0,d),f=e.basefilePath+_+".plist",T=e.basefilePath+_+".png",ccs.armatureDataManager.addSpriteFrameFromFile(f,T,e.filename)}s=null,a=null},decodeNodeFromJson:function(t,e,r){t.x=e[ccs.CONST_A_X]*this._positionReadScale,t.y=e[ccs.CONST_A_Y]*this._positionReadScale,t.x*=r.contentScale,t.y*=r.contentScale,t.zOrder=e[ccs.CONST_A_Z],t.skewX=e[ccs.CONST_A_SKEW_X]||0,t.skewY=e[ccs.CONST_A_SKEW_Y]||0,t.scaleX=e[ccs.CONST_A_SCALE_X]==null?1:e[ccs.CONST_A_SCALE_X],t.scaleY=e[ccs.CONST_A_SCALE_Y]==null?1:e[ccs.CONST_A_SCALE_Y];var n;r.cocoStudioVersion<ccs.VERSION_COLOR_READING?(n=e[0],n&&(t.a=n[ccs.CONST_A_ALPHA]==null?255:n[ccs.CONST_A_ALPHA],t.r=n[ccs.CONST_A_RED]==null?255:n[ccs.CONST_A_RED],t.g=n[ccs.CONST_A_GREEN]==null?255:n[ccs.CONST_A_GREEN],t.b=n[ccs.CONST_A_BLUE]==null?255:n[ccs.CONST_A_BLUE],t.isUseColorInfo=!0)):(n=e[ccs.CONST_COLOR_INFO]||null,n&&(t.a=n[ccs.CONST_A_ALPHA]==null?255:n[ccs.CONST_A_ALPHA],t.r=n[ccs.CONST_A_RED]==null?255:n[ccs.CONST_A_RED],t.g=n[ccs.CONST_A_GREEN]==null?255:n[ccs.CONST_A_GREEN],t.b=n[ccs.CONST_A_BLUE]==null?255:n[ccs.CONST_A_BLUE],t.isUseColorInfo=!0))},clear:function(){this._configFileList=[],this._asyncRefCount=0,this._asyncRefTotalCount=0},_asyncCallBack:function(t,e,r){t&&exports.cc.isFunction(t)&&t.call(e,r),e&&t&&typeof t=="string"&&e[t](r)},_initBaseFilePath:function(t){var e=t,r=e.lastIndexOf("/");return r>-1?e=e.substr(0,r+1):e="",e},addDataFromXML:function(t,e){var r=exports.cc.loader.getRes(t);if(!r)throw new Error("Please load the resource first : "+t);var n=exports.cc.saxParser.parse(r),s=n.documentElement;s&&this.addDataFromCache(s,e)},addDataFromJson:function(t,e){var r=exports.cc.loader.getRes(t);this.addDataFromJsonCache(r,e)}};ccs.spriteFrameCacheHelper={_textureAtlasDic:{},_imagePaths:[],addSpriteFrameFromFile:function(t,e){exports.cc.spriteFrameCache.addSpriteFrames(t,e)},getTextureAtlasWithTexture:function(t){return null},clear:function(){this._textureAtlasDic={},this._imagePaths=[]}};ccs.TransformHelp=ccs.TransformHelp||ccs.Class.extend({});ccs.TransformHelp.helpMatrix1=exports.cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpMatrix2=exports.cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpPoint1=exports.cc.p(0,0);ccs.TransformHelp.helpPoint2=exports.cc.p(0,0);ccs.TransformHelp.helpParentNode={};ccs.TransformHelp.transformFromParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(e,this.helpMatrix2),this.helpMatrix2=exports.cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=exports.cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformToParent=function(t,e){this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(e,this.helpMatrix2),this.helpMatrix1=exports.cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformFromParentWithoutScale=function(t,e){for(var r in e)this.helpParentNode[r]=e[r];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix2=exports.cc.affineTransformInvert(this.helpMatrix2),this.helpMatrix1=exports.cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.transformToParentWithoutScale=function(t,e){for(var r in e)this.helpParentNode[r]=e[r];this.helpParentNode.scaleX=1,this.helpParentNode.scaleY=1,this.nodeToMatrix(t,this.helpMatrix1),this.nodeToMatrix(this.helpParentNode,this.helpMatrix2),this.helpMatrix1=exports.cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2),this.matrixToNode(this.helpMatrix1,t)};ccs.TransformHelp.nodeToMatrix=function(t,e){if(t.skewX===-t.skewY){var r=Math.sin(t.skewX),n=Math.cos(t.skewX);e.a=t.scaleX*n,e.b=t.scaleX*-r,e.c=t.scaleY*r,e.d=t.scaleY*n}else e.a=t.scaleX*Math.cos(t.skewY),e.b=t.scaleX*Math.sin(t.skewY),e.c=t.scaleY*Math.sin(t.skewX),e.d=t.scaleY*Math.cos(t.skewX);e.tx=t.x,e.ty=t.y};ccs.TransformHelp.matrixToNode=function(t,e){this.helpPoint1.x=0,this.helpPoint1.y=1,this.helpPoint1=exports.cc.pointApplyAffineTransform(this.helpPoint1,t),this.helpPoint1.x-=t.tx,this.helpPoint1.y-=t.ty,this.helpPoint2.x=1,this.helpPoint2.y=0,this.helpPoint2=exports.cc.pointApplyAffineTransform(this.helpPoint2,t),this.helpPoint2.x-=t.tx,this.helpPoint2.y-=t.ty,e.skewX=-(Math.atan2(this.helpPoint1.y,this.helpPoint1.x)-1.5707964),e.skewY=Math.atan2(this.helpPoint2.y,this.helpPoint2.x),e.scaleX=Math.sqrt(t.a*t.a+t.b*t.b),e.scaleY=Math.sqrt(t.c*t.c+t.d*t.d),e.x=t.tx,e.y=t.ty};ccs.TransformHelp.nodeConcat=function(t,e){t.x+=e.x,t.y+=e.y,t.skewX+=e.skewX,t.skewY+=e.skewY,t.scaleX+=e.scaleX,t.scaleY+=e.scaleY};ccs.TransformHelp.nodeSub=function(t,e){t.x-=e.x,t.y-=e.y,t.skewX-=e.skewX,t.skewY-=e.skewY,t.scaleX-=e.scaleX,t.scaleY-=e.scaleY};ccs.TweenType={CUSTOM_EASING:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e4};ccs.TweenFunction=ccs.TweenFunction||ccs.Class.extend({});ccs.DOUBLE_PI=ccs.M_PI_X_2=Math.PI*2;ccs.HALF_PI=ccs.M_PI_2=Math.PI/2;ccs.M_PI=Math.PI;ccs.TweenFunction.tweenTo=function(t,e,r){var n=0;switch(e){case ccs.TweenType.CUSTOM_EASING:n=this.customEase(t,r);break;case ccs.TweenType.LINEAR:n=this.linear(t);break;case ccs.TweenType.SINE_EASEIN:n=this.sineEaseIn(t);break;case ccs.TweenType.SINE_EASEOUT:n=this.sineEaseOut(t);break;case ccs.TweenType.SINE_EASEINOUT:n=this.sineEaseInOut(t);break;case ccs.TweenType.QUAD_EASEIN:n=this.quadEaseIn(t);break;case ccs.TweenType.QUAD_EASEOUT:n=this.quadEaseOut(t);break;case ccs.TweenType.QUAD_EASEINOUT:n=this.quadEaseInOut(t);break;case ccs.TweenType.CUBIC_EASEIN:n=this.cubicEaseIn(t);break;case ccs.TweenType.CUBIC_EASEOUT:n=this.cubicEaseOut(t);break;case ccs.TweenType.CUBIC_EASEINOUT:n=this.cubicEaseInOut(t);break;case ccs.TweenType.QUART_EASEIN:n=this.quartEaseIn(t);break;case ccs.TweenType.QUART_EASEOUT:n=this.quartEaseOut(t);break;case ccs.TweenType.QUART_EASEINOUT:n=this.quartEaseInOut(t);break;case ccs.TweenType.QUINT_EASEIN:n=this.quintEaseIn(t);break;case ccs.TweenType.QUINT_EASEOUT:n=this.quintEaseOut(t);break;case ccs.TweenType.QUINT_EASEINOUT:n=this.quintEaseInOut(t);break;case ccs.TweenType.EXPO_EASEIN:n=this.expoEaseIn(t);break;case ccs.TweenType.EXPO_EASEOUT:n=this.expoEaseOut(t);break;case ccs.TweenType.EXPO_EASEINOUT:n=this.expoEaseInOut(t);break;case ccs.TweenType.CIRC_EASEIN:n=this.circEaseIn(t);break;case ccs.TweenType.CIRC_EASEOUT:n=this.circEaseOut(t);break;case ccs.TweenType.CIRC_EASEINOUT:n=this.circEaseInOut(t);break;case ccs.TweenType.ELASTIC_EASEIN:var s=.3;r!=null&&r.length>0&&(s=r[0]),n=this.elasticEaseIn(t,s);break;case ccs.TweenType.ELASTIC_EASEOUT:var s=.3;r!=null&&r.length>0&&(s=r[0]),n=this.elasticEaseOut(t,s);break;case ccs.TweenType.ELASTIC_EASEINOUT:var s=.3;r!=null&&r.length>0&&(s=r[0]),n=this.elasticEaseInOut(t,s);break;case ccs.TweenType.BACK_EASEIN:n=this.backEaseIn(t);break;case ccs.TweenType.BACK_EASEOUT:n=this.backEaseOut(t);break;case ccs.TweenType.BACK_EASEINOUT:n=this.backEaseInOut(t);break;case ccs.TweenType.BOUNCE_EASEIN:n=this.bounceEaseIn(t);break;case ccs.TweenType.BOUNCE_EASEOUT:n=this.bounceEaseOut(t);break;case ccs.TweenType.BOUNCE_EASEINOUT:n=this.bounceEaseInOut(t);break;default:n=this.sineEaseInOut(t);break}return n};ccs.TweenFunction.linear=function(t){return t};ccs.TweenFunction.sineEaseIn=function(t){return-1*Math.cos(t*ccs.HALF_PI)+1};ccs.TweenFunction.sineEaseOut=function(t){return Math.sin(t*ccs.HALF_PI)};ccs.TweenFunction.sineEaseInOut=function(t){return-.5*(Math.cos(ccs.M_PI*t)-1)};ccs.TweenFunction.quadEaseIn=function(t){return t*t};ccs.TweenFunction.quadEaseOut=function(t){return-1*t*(t-2)};ccs.TweenFunction.quadEaseInOut=function(t){return t=t*2,t<1?.5*t*t:(--t,-.5*(t*(t-2)-1))};ccs.TweenFunction.cubicEaseIn=function(t){return t*t*t};ccs.TweenFunction.cubicEaseOut=function(t){return t-=1,t*t*t+1};ccs.TweenFunction.cubicEaseInOut=function(t){return t=t*2,t<1?.5*t*t*t:(t-=2,.5*(t*t*t+2))};ccs.TweenFunction.quartEaseIn=function(t){return t*t*t*t};ccs.TweenFunction.quartEaseOut=function(t){return t-=1,-(t*t*t*t-1)};ccs.TweenFunction.quartEaseInOut=function(t){return t=t*2,t<1?.5*t*t*t*t:(t-=2,-.5*(t*t*t*t-2))};ccs.TweenFunction.quintEaseIn=function(t){return t*t*t*t*t};ccs.TweenFunction.quintEaseOut=function(t){return t-=1,t*t*t*t*t+1};ccs.TweenFunction.quintEaseInOut=function(t){return t=t*2,t<1?.5*t*t*t*t*t:(t-=2,.5*(t*t*t*t*t+2))};ccs.TweenFunction.expoEaseIn=function(t){return t===0?0:Math.pow(2,10*(t-1))-.001};ccs.TweenFunction.expoEaseOut=function(t){return t===1?1:-Math.pow(2,-10*t)+1};ccs.TweenFunction.expoEaseInOut=function(t){return t/=.5,t<1?t=.5*Math.pow(2,10*(t-1)):t=.5*(-Math.pow(2,-10*(t-1))+2),t};ccs.TweenFunction.circEaseIn=function(t){return-1*(Math.sqrt(1-t*t)-1)};ccs.TweenFunction.circEaseOut=function(t){return t=t-1,Math.sqrt(1-t*t)};ccs.TweenFunction.circEaseInOut=function(t){return t=t*2,t<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))};ccs.TweenFunction.elasticEaseIn=function(t,e){var r=.3;e.length>0&&(r=e[0]);var n=0;if(t===0||t===1)n=t;else{var s=r/4;t=t-1,n=-Math.pow(2,10*t)*Math.sin((t-s)*ccs.DOUBLE_PI/r)}return n};ccs.TweenFunction.elasticEaseOut=function(t,e){var r=.3;e.length>0&&(r=e[0]);var n=0;if(t===0||t===1)n=t;else{var s=r/4;n=Math.pow(2,-10*t)*Math.sin((t-s)*ccs.DOUBLE_PI/r)+1}return n};ccs.TweenFunction.elasticEaseInOut=function(t,e){var r=.3;e.length>0&&(r=e[0]);var n=0;if(t===0||t===1)n=t;else{t=t*2,r||(r=.3*1.5);var s=r/4;t=t-1,t<0?n=-.5*Math.pow(2,10*t)*Math.sin((t-s)*ccs.DOUBLE_PI/r):n=Math.pow(2,-10*t)*Math.sin((t-s)*ccs.DOUBLE_PI/r)*.5+1}return n};ccs.TweenFunction.backEaseIn=function(t){var e=1.70158;return t*t*((e+1)*t-e)};ccs.TweenFunction.backEaseOut=function(t){var e=1.70158;return t=t-1,t*t*((e+1)*t+e)+1};ccs.TweenFunction.backEaseInOut=function(t){var e=2.5949095;return t=t*2,t<1?t*t*((e+1)*t-e)/2:(t=t-2,t*t*((e+1)*t+e)/2+1)};ccs.bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?(t-=1.5/2.75,7.5625*t*t+.75):t<2.5/2.75?(t-=2.25/2.75,7.5625*t*t+.9375):(t-=2.625/2.75,7.5625*t*t+.984375)};ccs.TweenFunction.bounceEaseIn=function(t){return 1-ccs.bounceTime(1-t)};ccs.TweenFunction.bounceEaseOut=function(t){return ccs.bounceTime(t)};ccs.TweenFunction.bounceEaseInOut=function(t){var e=0;return t<.5?(t=t*2,e=(1-ccs.bounceTime(1-t))*.5):e=ccs.bounceTime(t*2-1)*.5+.5,e};ccs.TweenFunction.customEase=function(t,e){if(e.length>0){var r=1-t;return e[1]*r*r*r+3*e[3]*t*r*r+3*e[5]*t*t*r+e[7]*t*t*t}return t};ccs.TweenFunction.easeIn=function(t,e){return Math.pow(t,e)};ccs.TweenFunction.easeOut=function(t,e){return Math.pow(t,1/e)};ccs.TweenFunction.easeInOut=function(t,e){return t*=2,t<1?.5*Math.pow(t,e):1-.5*Math.pow(2-t,e)};ccs.TweenFunction.quadraticIn=function(t){return Math.pow(t,2)};ccs.TweenFunction.quadraticOut=function(t){return-t*(t-2)};ccs.TweenFunction.bezieratFunction=function(t,e,r,n,s){return Math.pow(1-s,3)*t+3*s*Math.pow(1-s,2)*e+3*Math.pow(s,2)*(1-s)*r+Math.pow(s,3)*n};ccs.fmodf=function(t,e){for(;t>e;)t-=e;return t};ccs.isSpriteContainPoint=function(t,e,r){var n=t.convertToNodeSpace(e);r&&(r.x=n.x,r.y=n.y);var s=t.getContentSize();return exports.cc.rectContainsPoint(exports.cc.rect(0,0,s.width,s.height),n)};ccs.SPRITE_CONTAIN_POINT=ccs.isSpriteContainPoint;ccs.SPRITE_CONTAIN_POINT_WITH_RETURN=ccs.isSpriteContainPoint;ccs.extBezierTo=function(t,e,r,n,s){var o=exports.cc.p(0,0);return n&&!s&&(o.x=Math.pow(1-t,2)*e.x+2*t*(1-t)*r.x+Math.pow(t,2)*n.x,o.y=Math.pow(1-t,2)*e.y+2*t*(1-t)*r.y+Math.pow(t,2)*n.y),s&&(o.x=e.x*Math.pow(1-t,3)+3*t*r.x*Math.pow(1-t,2)+3*n.x*Math.pow(t,2)*(1-t)+s.x*Math.pow(t,3),o.y=e.y*Math.pow(1-t,3)+3*t*r.y*Math.pow(1-t,2)+3*n.y*Math.pow(t,2)*(1-t)+s.y*Math.pow(t,3)),o};ccs.extCircleTo=function(t,e,r,n,s){var o=exports.cc.p(0,0);return o.x=e.x+r*Math.cos(n+s*t),o.y=e.y+r*Math.sin(n+s*t),o};ccs.RelativeData=function(){this.plistFiles=[],this.armatures=[],this.animations=[],this.textures=[]};ccs.armatureDataManager={_animationDatas:{},_armatureDatas:{},_textureDatas:{},_autoLoadSpriteFile:!1,_relativeDatas:{},s_sharedArmatureDataManager:null,removeArmatureFileInfo:function(t){var e=this.getRelativeData(t);if(e){var r,n;for(r=0;r<e.armatures.length;r++)n=e.armatures[r],this.removeArmatureData(n);for(r=0;r<e.animations.length;r++)n=e.animations[r],this.removeAnimationData(n);for(r=0;r<e.textures.length;r++)n=e.textures[r],this.removeTextureData(n);for(r=0;r<e.plistFiles.length;r++)n=e.plistFiles[r],exports.cc.spriteFrameCache.removeSpriteFramesFromFile(n);delete this._relativeDatas[t],ccs.dataReaderHelper.removeConfigFile(t)}},addArmatureData:function(t,e,r){var n=this.getRelativeData(r);n&&n.armatures.push(t),this._armatureDatas[t]=e},getArmatureData:function(t){var e=null;return this._armatureDatas&&(e=this._armatureDatas[t]),e},removeArmatureData:function(t){this._armatureDatas[t]&&delete this._armatureDatas[t]},addAnimationData:function(t,e,r){var n=this.getRelativeData(r);n&&n.animations.push(t),this._animationDatas[t]=e},getAnimationData:function(t){var e=null;return this._animationDatas[t]&&(e=this._animationDatas[t]),e},removeAnimationData:function(t){this._animationDatas[t]&&delete this._animationDatas[t]},addTextureData:function(t,e,r){var n=this.getRelativeData(r);n&&n.textures.push(t),this._textureDatas[t]=e},getTextureData:function(t){var e=null;return this._textureDatas&&(e=this._textureDatas[t]),e},removeTextureData:function(t){this._textureDatas[t]&&delete this._textureDatas[t]},addArmatureFileInfo:function(){var t,e,r;switch(arguments.length){case 1:r=arguments[0],this.addRelativeData(r),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFile(r);break;case 3:t=arguments[0],e=arguments[1],r=arguments[2],this.addRelativeData(r),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFile(r),this.addSpriteFrameFromFile(e,t)}},addArmatureFileInfoAsync:function(){var t,e,r,n,s;switch(arguments.length){case 3:r=arguments[0],n=arguments[2],s=arguments[1],this.addRelativeData(r),this._autoLoadSpriteFile=!0,ccs.dataReaderHelper.addDataFromFileAsync("","",r,s,n);break;case 5:t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[4],s=arguments[3],this.addRelativeData(r),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFileAsync(t,e,r,s,n),this.addSpriteFrameFromFile(e,t)}},addSpriteFrameFromFile:function(t,e,r){var n=this.getRelativeData(r);n&&n.plistFiles.push(t),ccs.spriteFrameCacheHelper.addSpriteFrameFromFile(t,e)},isAutoLoadSpriteFile:function(){return this._autoLoadSpriteFile},getArmatureDatas:function(){return this._armatureDatas},getAnimationDatas:function(){return this._animationDatas},getTextureDatas:function(){return this._textureDatas},addRelativeData:function(t){this._relativeDatas[t]||(this._relativeDatas[t]=new ccs.RelativeData)},getRelativeData:function(t){return this._relativeDatas[t]},clear:function(){for(var t in this._relativeDatas)this.removeArmatureFileInfo(t);this._animationDatas={},this._armatureDatas={},this._textureDatas={},this._relativeDatas={},ccs.spriteFrameCacheHelper.clear(),ccs.dataReaderHelper.clear()}};ccs.BLEND_TYPE_NORMAL=0;ccs.BLEND_TYPE_LAYER=1;ccs.BLEND_TYPE_DARKEN=2;ccs.BLEND_TYPE_MULTIPLY=3;ccs.BLEND_TYPE_LIGHTEN=4;ccs.BLEND_TYPE_SCREEN=5;ccs.BLEND_TYPE_OVERLAY=6;ccs.BLEND_TYPE_HIGHLIGHT=7;ccs.BLEND_TYPE_ADD=8;ccs.BLEND_TYPE_SUBTRACT=9;ccs.BLEND_TYPE_DIFFERENCE=10;ccs.BLEND_TYPE_INVERT=11;ccs.BLEND_TYPE_ALPHA=12;ccs.BLEND_TYPE_ERASE=13;ccs.DISPLAY_TYPE_SPRITE=0;ccs.DISPLAY_TYPE_ARMATURE=1;ccs.DISPLAY_TYPE_PARTICLE=2;ccs.DISPLAY_TYPE_MAX=3;ccs.BaseData=ccs.Class.extend({x:0,y:0,zOrder:0,skewX:0,skewY:0,scaleX:1,scaleY:1,tweenRotate:0,isUseColorInfo:!1,r:255,g:255,b:255,a:255,ctor:function(){this.x=0,this.y=0,this.zOrder=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1,this.tweenRotate=0,this.isUseColorInfo=!1,this.r=255,this.g=255,this.b=255,this.a=255},copy:function(t){this.x=t.x,this.y=t.y,this.zOrder=t.zOrder,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.skewX=t.skewX,this.skewY=t.skewY,this.tweenRotate=t.tweenRotate,this.isUseColorInfo=t.isUseColorInfo,this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},setColor:function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},getColor:function(){return exports.cc.color(this.r,this.g,this.b,this.a)},subtract:function(t,e,r){this.x=e.x-t.x,this.y=e.y-t.y,this.scaleX=e.scaleX-t.scaleX,this.scaleY=e.scaleY-t.scaleY,this.skewX=e.skewX-t.skewX,this.skewY=e.skewY-t.skewY,this.isUseColorInfo||t.isUseColorInfo||e.isUseColorInfo?(this.a=e.a-t.a,this.r=e.r-t.r,this.g=e.g-t.g,this.b=e.b-t.b,this.isUseColorInfo=!0):(this.a=this.r=this.g=this.b=0,this.isUseColorInfo=!1),r&&(this.skewX>ccs.M_PI&&(this.skewX-=ccs.DOUBLE_PI),this.skewX<-ccs.M_PI&&(this.skewX+=ccs.DOUBLE_PI),this.skewY>ccs.M_PI&&(this.skewY-=ccs.DOUBLE_PI),this.skewY<-ccs.M_PI&&(this.skewY+=ccs.DOUBLE_PI)),e.tweenRotate&&(this.skewX+=e.tweenRotate*ccs.PI*2,this.skewY-=e.tweenRotate*ccs.PI*2)}});ccs.DisplayData=ccs.Class.extend({displayType:ccs.DISPLAY_TYPE_MAX,displayName:"",ctor:function(){this.displayType=ccs.DISPLAY_TYPE_MAX},changeDisplayToTexture:function(t){var e=t,r=e.lastIndexOf(".");return r!==-1&&(e=e.substring(0,r)),e},copy:function(t){this.displayName=t.displayName,this.displayType=t.displayType}});ccs.SpriteDisplayData=ccs.DisplayData.extend({skinData:null,ctor:function(){this.skinData=new ccs.BaseData,this.displayType=ccs.DISPLAY_TYPE_SPRITE},copy:function(t){ccs.DisplayData.prototype.copy.call(this,t),this.skinData=t.skinData}});ccs.ArmatureDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayName="",this.displayType=ccs.DISPLAY_TYPE_ARMATURE}});ccs.ParticleDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayType=ccs.DISPLAY_TYPE_PARTICLE}});ccs.BoneData=ccs.BaseData.extend({displayDataList:null,name:"",parentName:"",boneDataTransform:null,ctor:function(){this.displayDataList=[],this.name="",this.parentName="",this.boneDataTransform=null},init:function(){return this.displayDataList.length=0,!0},addDisplayData:function(t){this.displayDataList.push(t)},getDisplayData:function(t){return this.displayDataList[t]}});ccs.ArmatureData=ccs.Class.extend({boneDataDic:null,name:"",dataVersion:.1,ctor:function(){this.boneDataDic={},this.name="",this.dataVersion=.1},init:function(){return!0},addBoneData:function(t){this.boneDataDic[t.name]=t},getBoneDataDic:function(){return this.boneDataDic},getBoneData:function(t){return this.boneDataDic[t]}});ccs.FrameData=ccs.BaseData.extend({duration:0,tweenEasing:0,easingParamNumber:0,easingParams:null,displayIndex:-1,movement:"",event:"",sound:"",soundEffect:"",blendFunc:null,frameID:0,isTween:!0,ctor:function(){ccs.BaseData.prototype.ctor.call(this),this.duration=1,this.tweenEasing=ccs.TweenType.LINEAR,this.easingParamNumber=0,this.easingParams=[],this.displayIndex=0,this.movement="",this.event="",this.sound="",this.soundEffect="",this.blendFunc=new exports.cc.BlendFunc(exports.cc.BLEND_SRC,exports.cc.BLEND_DST),this.frameID=0,this.isTween=!0},copy:function(t){if(ccs.BaseData.prototype.copy.call(this,t),this.duration=t.duration,this.displayIndex=t.displayIndex,this.tweenEasing=t.tweenEasing,this.easingParamNumber=t.easingParamNumber,this.easingParamNumber!==0){this.easingParams.length=0;for(var e=0;e<this.easingParamNumber;e++)this.easingParams[e]=t.easingParams[e]}this.blendFunc=t.blendFunc,this.isTween=t.isTween}});ccs.MovementBoneData=ccs.Class.extend({delay:0,scale:1,duration:0,frameList:null,name:"",ctor:function(){this.delay=0,this.scale=1,this.duration=0,this.frameList=[],this.name=""},init:function(){return!0},addFrameData:function(t){this.frameList.push(t)},getFrameData:function(t){return this.frameList[t]}});ccs.MovementData=function(){this.name="",this.duration=0,this.scale=1,this.durationTo=0,this.durationTween=0,this.loop=!0,this.tweenEasing=ccs.TweenType.LINEAR,this.movBoneDataDic={}};ccs.MovementData.prototype.addMovementBoneData=function(t){this.movBoneDataDic[t.name]=t};ccs.MovementData.prototype.getMovementBoneData=function(t){return this.movBoneDataDic[t]};ccs.AnimationData=function(){this.movementDataDic={},this.movementNames=[],this.name=""};ccs.AnimationData.prototype.addMovement=function(t){this.movementDataDic[t.name]=t,this.movementNames.push(t.name)};ccs.AnimationData.prototype.getMovement=function(t){return this.movementDataDic[t]};ccs.AnimationData.prototype.getMovementCount=function(){return Object.keys(this.movementDataDic).length};ccs.ContourVertex2=function(t,e){this.x=t||0,this.y=e||0};ccs.ContourData=function(){this.vertexList=[]};ccs.ContourData.prototype.init=function(){return this.vertexList.length=0,!0};ccs.ContourData.prototype.addVertex=function(t){this.vertexList.push(t)};ccs.TextureData=function(){this.height=0,this.width=0,this.pivotX=.5,this.pivotY=.5,this.name="",this.contourDataList=[]};ccs.TextureData.prototype.init=function(){this.contourDataList.length=0};ccs.TextureData.prototype.addContourData=function(t){this.contourDataList.push(t)};ccs.TextureData.prototype.getContourData=function(t){return this.contourDataList[t]};ccs.DecorativeDisplay=ccs.Class.extend({_display:null,_colliderDetector:null,_displayData:null,ctor:function(){this._display=null,this._colliderDetector=null,this._displayData=null},init:function(){return!0},setDisplay:function(t){t._parent&&(t._parent.removeChild(t),delete t._parent),this._display=t},getDisplay:function(){return this._display},setColliderDetector:function(t){this._colliderDetector=t},getColliderDetector:function(){return this._colliderDetector},setDisplayData:function(t){this._displayData=t},getDisplayData:function(){return this._displayData},release:function(){this._display=null,this._displayData=null,this._colliderDetector=null}});ccs.DecorativeDisplay.create=function(){return new ccs.DecorativeDisplay};ccs.displayFactory={addDisplay:function(t,e,r){switch(r.displayType){case ccs.DISPLAY_TYPE_SPRITE:this.addSpriteDisplay(t,e,r);break;case ccs.DISPLAY_TYPE_PARTICLE:this.addParticleDisplay(t,e,r);break;case ccs.DISPLAY_TYPE_ARMATURE:this.addArmatureDisplay(t,e,r);break}},createDisplay:function(t,e){switch(e.getDisplayData().displayType){case ccs.DISPLAY_TYPE_SPRITE:this.createSpriteDisplay(t,e);break;case ccs.DISPLAY_TYPE_PARTICLE:this.createParticleDisplay(t,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.createArmatureDisplay(t,e);break}},_helpTransform:{a:1,b:0,c:0,d:1,tx:0,ty:0},updateDisplay:function(t,e,r){var n=t.getDisplayRenderNode();if(n){switch(t.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:r&&(n._renderCmd.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty),n.updateArmatureTransform());break;case ccs.DISPLAY_TYPE_PARTICLE:this.updateParticleDisplay(t,n,e);break;case ccs.DISPLAY_TYPE_ARMATURE:this.updateArmatureDisplay(t,n,e);break;default:var s=t.getNodeToArmatureTransform();n.setAdditionalTransform(s);break}if((ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&r){var o=t.getDisplayManager().getCurrentDecorativeDisplay(),a=o.getColliderDetector();if(a){var c=o.getDisplay(),l=c.getNodeToParentTransform(),h=this._helpTransform;h.a=l.a,h.b=l.b,h.c=l.c,h.d=l.d,h.tx=l.tx,h.ty=l.ty;var u=exports.cc.pointApplyAffineTransform(c.getAnchorPointInPoints(),h);h.tx=u.x,h.ty=u.y;var _=exports.cc.affineTransformConcat(h,t.getArmature().getNodeToParentTransform());a.updateTransform(_)}}}},addSpriteDisplay:function(t,e,r){var n=new ccs.SpriteDisplayData;n.copy(r),e.setDisplayData(n),this.createSpriteDisplay(t,e)},createSpriteDisplay:function(t,e){var r=null,n=e.getDisplayData(),s=n.displayName,o=s.lastIndexOf(".");o!==-1&&(s=s.substring(0,o)),s===""?r=new ccs.Skin:r=new ccs.Skin("#"+s+".png"),e.setDisplay(r),r.setBone(t),this.initSpriteDisplay(t,e,n.displayName,r);var a=t.getArmature();a&&(a.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?r.setSkinData(n.skinData):r.setSkinData(t.boneData))},initSpriteDisplay:function(t,e,r,n){var s=r,o=s.lastIndexOf(".");o!==-1&&(s=s.substring(0,o));var a=ccs.armatureDataManager.getTextureData(s);if(a&&n.setAnchorPoint(exports.cc.p(a.pivotX,a.pivotY)),(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&a&&a.contourDataList.length>0){var c=new ccs.ColliderDetector(t);c.addContourDataList(a.contourDataList),e.setColliderDetector(c)}},addArmatureDisplay:function(t,e,r){var n=new ccs.ArmatureDisplayData;n.copy(r),e.setDisplayData(n),this.createArmatureDisplay(t,e)},createArmatureDisplay:function(t,e){var r=e.getDisplayData(),n=new ccs.Armature(r.displayName,t);e.setDisplay(n)},updateArmatureDisplay:function(t,e,r){e&&(e.sortAllChildren(),e.update(r))},addParticleDisplay:function(t,e,r){var n=new ccs.ParticleDisplayData;n.copy(r),e.setDisplayData(n),this.createParticleDisplay(t,e)},createParticleDisplay:function(t,e){var r=e.getDisplayData(),n=new exports.cc.ParticleSystem(r.displayName);n.removeFromParent(),n.cleanup();var s=t.getArmature();s&&n.setParent(t.getArmature()),e.setDisplay(n)},updateParticleDisplay:function(t,e,r){var n=new ccs.BaseData;ccs.TransformHelp.matrixToNode(t.nodeToArmatureTransform(),n),e.setPosition(n.x,n.y),e.setScaleX(n.scaleX),e.setScaleY(n.scaleY),e.update(r)}};ccs.DisplayManager=ccs.Class.extend({_decoDisplayList:null,_currentDecoDisplay:null,_displayRenderNode:null,_displayIndex:null,_forceChangeDisplay:!1,_bone:null,_visible:!0,_displayType:null,ctor:function(t){this._decoDisplayList=[],this._currentDecoDisplay=null,this._displayRenderNode=null,this._displayIndex=null,this._forceChangeDisplay=!1,this._bone=null,this._visible=!0,this._displayType=ccs.DISPLAY_TYPE_MAX,t&&ccs.DisplayManager.prototype.init.call(this,t)},init:function(t){return this._bone=t,this.initDisplayList(t.getBoneData()),!0},addDisplay:function(t,e){var r,n=this._decoDisplayList;if(e>=0&&e<n.length?r=n[e]:(r=new ccs.DecorativeDisplay,n.push(r)),t instanceof ccs.DisplayData){ccs.displayFactory.addDisplay(this._bone,r,t),e===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(e,!1));return}var s=null;if(t instanceof ccs.Skin){t.setBone(this._bone),s=new ccs.SpriteDisplayData,ccs.displayFactory.initSpriteDisplay(this._bone,r,t.getDisplayName(),t);var o=r.getDisplayData();if(o instanceof ccs.SpriteDisplayData)t.setSkinData(o.skinData),s.skinData=o.skinData;else{for(var a=!1,c=n.length-2;c>=0;c--){var l=n[c],h=l.getDisplayData();if(h instanceof ccs.SpriteDisplayData){a=!0,t.setSkinData(h.skinData),s.skinData=h.skinData;break}}a||t.setSkinData(new ccs.BaseData)}}else if(t instanceof exports.cc.ParticleSystem){s=new ccs.ParticleDisplayData,t.removeFromParent(),t.cleanup();var u=this._bone.getArmature();u&&t.setParent(u)}else t instanceof ccs.Armature?(s=new ccs.ArmatureDisplayData,s.displayName=t.getName(),t.setParentBone(this._bone)):s=new ccs.DisplayData;r.setDisplay(t),r.setDisplayData(s),e===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(e,!1))},_addDisplayOther:function(t,e){var r=null;if(e instanceof ccs.Skin){var n=e;n.setBone(this._bone),r=new ccs.SpriteDisplayData,r.displayName=n.getDisplayName(),ccs.displayFactory.initSpriteDisplay(this._bone,t,n.getDisplayName(),n);var s=t.getDisplayData();if(s instanceof ccs.SpriteDisplayData)n.setSkinData(s.skinData);else{for(var o=!1,a=this._decoDisplayList.length-2;a>=0;a--){var c=this._decoDisplayList[a],l=c.getDisplayData();if(l){o=!0,n.setSkinData(l.skinData),r.skinData=l.skinData;break}}o||n.setSkinData(new ccs.BaseData),n.setSkinData(new ccs.BaseData)}}else e instanceof exports.cc.ParticleSystem?(r=new ccs.ParticleDisplayData,r.displayName=e._plistFile):e instanceof ccs.Armature?(r=new ccs.ArmatureDisplayData,r.displayName=e.getName(),e.setParentBone(this._bone)):r=new ccs.DisplayData;t.setDisplay(e),t.setDisplayData(r)},removeDisplay:function(t){this._decoDisplayList.splice(t,1),t===this._displayIndex&&(this.setCurrentDecorativeDisplay(null),this._displayIndex=-1)},getDecorativeDisplayList:function(){return this._decoDisplayList},changeDisplayWithIndex:function(t,e){if(t>=this._decoDisplayList.length){exports.cc.log("the index value is out of range");return}if(this._forceChangeDisplay=e,this._displayIndex!==t){if(this._displayIndex=t,t<0){this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this.setCurrentDecorativeDisplay(null));return}this.setCurrentDecorativeDisplay(this._decoDisplayList[t])}},changeDisplayWithName:function(t,e){for(var r=this._decoDisplayList,n=0;n<r.length;n++)if(r[n].getDisplayData().displayName===t){this.changeDisplayWithIndex(n,e);break}},setCurrentDecorativeDisplay:function(t){var e=this._currentDecoDisplay;(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&e&&e.getColliderDetector()&&e.getColliderDetector().setActive(!1),this._currentDecoDisplay=t,e=this._currentDecoDisplay,(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&e&&e.getColliderDetector()&&e.getColliderDetector().setActive(!0);var r=e?e.getDisplay():null,n=this._displayRenderNode,s=this._bone;n&&(n instanceof ccs.Armature&&s.setChildArmature(null),n.removeFromParent(!0)),this._displayRenderNode=r,r?(r instanceof ccs.Armature?(this._bone.setChildArmature(r),r.setParentBone(this._bone)):r instanceof exports.cc.ParticleSystem&&(r instanceof ccs.Armature?(s.setChildArmature(r),r.setParentBone(s)):r instanceof exports.cc.ParticleSystem&&r.resetSystem()),r.setColor(s.getDisplayedColor()),r.setOpacity(s.getDisplayedOpacity()),this._displayRenderNode.setVisible(this._visible),this._displayType=this._currentDecoDisplay.getDisplayData().displayType):this._displayType=ccs.DISPLAY_TYPE_MAX,exports.cc.renderer.childrenOrderDirty=!0},getDisplayRenderNode:function(){return this._displayRenderNode},getDisplayRenderNodeType:function(){return this._displayType},getCurrentDisplayIndex:function(){return this._displayIndex},getCurrentDecorativeDisplay:function(){return this._currentDecoDisplay},getDecorativeDisplayByIndex:function(t){return this._decoDisplayList[t]},initDisplayList:function(t){if(this._decoDisplayList.length=0,!!t)for(var e=t.displayDataList,r=this._decoDisplayList,n=this._bone,s=0;s<e.length;s++){var o=e[s],a=new ccs.DecorativeDisplay;a.setDisplayData(o),ccs.displayFactory.createDisplay(n,a),r.push(a)}},containPoint:function(t,e){if(!this._visible||this._displayIndex<0)return!1;if(e!==void 0&&(t=exports.cc.p(t,e)),this._currentDecoDisplay.getDisplayData().displayType===ccs.DISPLAY_TYPE_SPRITE){var r=this._currentDecoDisplay.getDisplay();return r=r.getChildByTag(0),ccs.SPRITE_CONTAIN_POINT_WITH_RETURN(r,t)}return!1},setVisible:function(t){this._displayRenderNode&&(this._visible=t,this._displayRenderNode.setVisible(t))},isVisible:function(){return this._visible},getContentSize:function(){return this._displayRenderNode?this._displayRenderNode.getContentSize():exports.cc.size(0,0)},getBoundingBox:function(){return this._displayRenderNode?this._displayRenderNode.getBoundingBox():exports.cc.rect(0,0,0,0)},getAnchorPoint:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPoint():exports.cc.p(0,0)},getAnchorPointInPoints:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPointInPoints():exports.cc.p(0,0)},getForceChangeDisplay:function(){return this._forceChangeDisplay},release:function(){this._decoDisplayList=null,this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this._displayRenderNode=null)}});ccs.DisplayManager.create=function(t){return new ccs.DisplayManager(t)};ccs.Skin=ccs.Sprite.extend({_skinData:null,bone:null,_skinTransform:null,_displayName:"",_armature:null,_className:"Skin",ctor:function(t,e){exports.cc.Sprite.prototype.ctor.call(this),this._skinData=null,this.bone=null,this._displayName="",this._skinTransform=exports.cc.affineTransformIdentity(),this._armature=null,t==null||t===""?ccs.Skin.prototype.init.call(this):t[0]==="#"?ccs.Skin.prototype.initWithSpriteFrameName.call(this,t.substr(1)):ccs.Skin.prototype.initWithFile.call(this,t,e)},initWithSpriteFrameName:function(t){if(t==="")return!1;var e=exports.cc.spriteFrameCache.getSpriteFrame(t),r=!0;return e?this.initWithSpriteFrame(e):(exports.cc.log("Can't find CCSpriteFrame with %s. Please check your .plist file",t),r=!1),this._displayName=t,r},initWithFile:function(t,e){var r=e?exports.cc.Sprite.prototype.initWithFile.call(this,t,e):exports.cc.Sprite.prototype.initWithFile.call(this,t);return this._displayName=t,r},setSkinData:function(t){this._skinData=t,this.setScaleX(t.scaleX),this.setScaleY(t.scaleY),this.setRotationX(exports.cc.radiansToDegrees(t.skewX)),this.setRotationY(exports.cc.radiansToDegrees(-t.skewY)),this.setPosition(t.x,t.y),this._renderCmd.transform()},getSkinData:function(){return this._skinData},updateArmatureTransform:function(){this._renderCmd.transform()},getNodeToWorldTransform:function(){return this._renderCmd.getNodeToWorldTransform()},getNodeToWorldTransformAR:function(){return this._renderCmd.getNodeToWorldTransformAR()},setBone:function(t){this.bone=t;var e=this.bone.getArmature();e&&(this._armature=e)},getBone:function(){return this.bone},getDisplayName:function(){return this._displayName},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new ccs.Skin.CanvasRenderCmd(this):new ccs.Skin.WebGLRenderCmd(this)}});var _p=ccs.Skin.prototype;_p.skinData;exports.cc.defineGetterSetter(_p,"skinData",_p.getSkinData,_p.setSkinData);_p.displayName;exports.cc.defineGetterSetter(_p,"displayName",_p.getDisplayName);_p=null;ccs.Skin.create=function(t,e){return new ccs.Skin(t,e)};ccs.Skin.createWithSpriteFrameName=function(t){return new ccs.Skin("#"+t)};(function(){ccs.Skin.RenderCmd={_realWorldTM:null,transform:function(e,r){var n=this._node,s=e?e._worldTransform:null,o=this._transform,a=this._worldTransform,c=this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty;if((c||s)&&(this.originTransform(),exports.cc.affineTransformConcatIn(o,n.bone.getNodeToArmatureTransform()),this._dirtyFlag=this._dirtyFlag&exports.cc.Node._dirtyFlags.transformDirty^this._dirtyFlag),s){a.a=o.a*s.a+o.b*s.c,a.b=o.a*s.b+o.b*s.d,a.c=o.c*s.a+o.d*s.c,a.d=o.c*s.b+o.d*s.d,a.tx=o.tx*s.a+o.ty*s.c+s.tx,a.ty=o.tx*s.b+o.ty*s.d+s.ty;var l=this._vertices;if(l){var h=n._offsetPosition.x,u=h+n._rect.width,_=n._offsetPosition.y,d=_+n._rect.height;l[0].x=h*a.a+d*a.c+a.tx,l[0].y=h*a.b+d*a.d+a.ty,l[1].x=h*a.a+_*a.c+a.tx,l[1].y=h*a.b+_*a.d+a.ty,l[2].x=u*a.a+d*a.c+a.tx,l[2].y=u*a.b+d*a.d+a.ty,l[3].x=u*a.a+_*a.c+a.tx,l[3].y=u*a.b+_*a.d+a.ty}}else a.a=o.a,a.b=o.b,a.c=o.c,a.d=o.d,a.tx=o.tx,a.ty=o.ty;var f=this._realWorldTM;f&&(f.a=o.a,f.b=o.b,f.c=o.c,f.d=o.d,f.tx=o.tx,f.ty=o.ty,exports.cc.affineTransformConcatIn(f,this._node.bone.getArmature()._renderCmd._worldTransform))},getNodeToWorldTransform:function(){return exports.cc.affineTransformConcat(this._transform,this._node.bone.getArmature().getNodeToWorldTransform())},getNodeToWorldTransformAR:function(){var e=this._transform,r=this._node;return this._anchorPointInPoints=exports.cc.pointApplyAffineTransform(this._anchorPointInPoints,e),e.tx=this._anchorPointInPoints.x,e.ty=this._anchorPointInPoints.y,exports.cc.affineTransformConcat(e,r.bone.getArmature().getNodeToWorldTransform())}},ccs.Skin.CanvasRenderCmd=function(e){exports.cc.Sprite.CanvasRenderCmd.call(this,e),this._realWorldTM={a:1,b:0,c:0,d:1,tx:0,ty:0}};var t=ccs.Skin.CanvasRenderCmd.prototype=Object.create(exports.cc.Sprite.CanvasRenderCmd.prototype);exports.cc.inject(ccs.Skin.RenderCmd,t),t.constructor=ccs.Skin.CanvasRenderCmd,t._updateCurrentRegions=function(){var e=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=e,exports.cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble===this._regionFlag&&!this._currentRegion.isEmpty()&&this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._realWorldTM)},ccs.Skin.WebGLRenderCmd=function(e){exports.cc.Sprite.WebGLRenderCmd.call(this,e)},t=ccs.Skin.WebGLRenderCmd.prototype=Object.create(exports.cc.Sprite.WebGLRenderCmd.prototype),exports.cc.inject(ccs.Skin.RenderCmd,t),t.constructor=ccs.Skin.WebGLRenderCmd})();ccs.ANIMATION_TYPE_SINGLE_FRAME=-4;ccs.ANIMATION_TYPE_NO_LOOP=-3;ccs.ANIMATION_TYPE_TO_LOOP_FRONT=-2;ccs.ANIMATION_TYPE_TO_LOOP_BACK=-1;ccs.ANIMATION_TYPE_LOOP_FRONT=0;ccs.ANIMATION_TYPE_LOOP_BACK=1;ccs.ANIMATION_TYPE_MAX=2;ccs.ProcessBase=ccs.Class.extend({_processScale:1,_isComplete:!0,_isPause:!0,_isPlaying:!1,_currentPercent:0,_rawDuration:0,_loopType:0,_tweenEasing:0,animationInternal:null,_currentFrame:0,_durationTween:0,_nextFrameIndex:0,_curFrameIndex:null,_isLoopBack:!1,ctor:function(){this._processScale=1,this._isComplete=!0,this._isPause=!0,this._isPlaying=!1,this._currentFrame=0,this._currentPercent=0,this._durationTween=0,this._rawDuration=0,this._loopType=ccs.ANIMATION_TYPE_LOOP_BACK,this._tweenEasing=ccs.TweenType.LINEAR,this.animationInternal=1/60,this._curFrameIndex=0,this._durationTween=0,this._isLoopBack=!1},pause:function(){this._isPause=!0,this._isPlaying=!1},resume:function(){this._isPause=!1,this._isPlaying=!0},stop:function(){this._isComplete=!0,this._isPlaying=!1},play:function(t,e,r,n){this._isComplete=!1,this._isPause=!1,this._isPlaying=!0,this._currentFrame=0,this._nextFrameIndex=t,this._tweenEasing=n},update:function(t){if(!(this._isComplete||this._isPause)&&!(this._rawDuration<=0||t>1)){var e=this._nextFrameIndex===void 0?0:this._nextFrameIndex,r=this._currentFrame;e<=0?(this._currentPercent=1,r=0):(r+=this._processScale*(t/this.animationInternal),this._currentPercent=r/e,r=ccs.fmodf(r,e)),this._currentFrame=r,this.updateHandler()}},gotoFrame:function(t){var e=this._loopType;e===ccs.ANIMATION_TYPE_NO_LOOP?e=ccs.ANIMATION_TYPE_MAX:e===ccs.ANIMATION_TYPE_TO_LOOP_FRONT&&(e=ccs.ANIMATION_TYPE_LOOP_FRONT),this._loopType=e,this._curFrameIndex=t,this._nextFrameIndex=this._durationTween},getCurrentFrameIndex:function(){return this._curFrameIndex=(this._rawDuration-1)*this._currentPercent,this._curFrameIndex},updateHandler:function(){},isPause:function(){return this._isPause},isComplete:function(){return this._isComplete},getCurrentPercent:function(){return this._currentPercent},getRawDuration:function(){return this._rawDuration},getLoop:function(){return this._loopType},getTweenEasing:function(){return this._tweenEasing},getAnimationInternal:function(){return this.animationInternal},setAnimationInternal:function(t){this.animationInternal=t},getProcessScale:function(){return this._processScale},setProcessScale:function(t){this._processScale=t},isPlaying:function(){return this._isPlaying}});var _p=ccs.ProcessBase.prototype;_p.currentFrameIndex;exports.cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex);_p.paused;exports.cc.defineGetterSetter(_p,"paused",_p.isPause);_p.completed;exports.cc.defineGetterSetter(_p,"completed",_p.isComplete);_p.currentPercent;exports.cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent);_p.rawDuration;exports.cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration);_p.loop;exports.cc.defineGetterSetter(_p,"loop",_p.getLoop);_p.tweenEasing;exports.cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing);_p.playing;exports.cc.defineGetterSetter(_p,"playing",_p.isPlaying);_p=null;ccs.MovementEventType={start:0,complete:1,loopComplete:2};ccs.AnimationEvent=ccs.Class.extend({_arguments:null,_callFunc:null,_selectorTarget:null,ctor:function(t,e,r){this._data=r,this._callFunc=t,this._selectorTarget=e},call:function(){this._callFunc&&this._callFunc.apply(this._selectorTarget,this._arguments)},setArguments:function(t){this._arguments=t}});ccs.MovementEvent=function(){this.armature=null,this.movementType=ccs.MovementEventType.start,this.movementID=""};ccs.FrameEvent=function(){this.bone=null,this.frameEventName="",this.originFrameIndex=0,this.currentFrameIndex=0};ccs.ArmatureAnimation=ccs.ProcessBase.extend({_animationData:null,_movementData:null,_armature:null,_movementID:"",_toIndex:0,_tweenList:null,_speedScale:1,_ignoreFrameEvent:!1,_frameEventQueue:null,_movementEventQueue:null,_movementList:null,_onMovementList:!1,_movementListLoop:!1,_movementIndex:0,_movementListDurationTo:-1,_movementEventCallFunc:null,_frameEventCallFunc:null,_movementEventTarget:null,_frameEventTarget:null,_movementEventListener:null,_frameEventListener:null,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this),this._tweenList=[],this._movementList=[],this._frameEventQueue=[],this._movementEventQueue=[],this._armature=null,t&&ccs.ArmatureAnimation.prototype.init.call(this,t)},init:function(t){return this._armature=t,this._tweenList.length=0,!0},pause:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].pause();ccs.ProcessBase.prototype.pause.call(this)},resume:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].resume();ccs.ProcessBase.prototype.resume.call(this)},stop:function(){for(var t=this._tweenList,e=0;e<t.length;e++)t[e].stop();t.length=0,ccs.ProcessBase.prototype.stop.call(this)},setAnimationScale:function(t){this.setSpeedScale(t)},getAnimationScale:function(){return this.getSpeedScale()},setSpeedScale:function(t){if(t!==this._speedScale){this._speedScale=t,this._processScale=this._movementData?this._speedScale*this._movementData.scale:this._speedScale;var e=this._armature.getBoneDic();for(var r in e){var n=e[r];n.getTween().setProcessScale(this._processScale),n.getChildArmature()&&n.getChildArmature().getAnimation().setSpeedScale(this._processScale)}}},getSpeedScale:function(){return this._speedScale},play:function(t,e,r){exports.cc.assert(this._animationData,"this.animationData can not be null"),this._movementData=this._animationData.getMovement(t),exports.cc.assert(this._movementData,"this._movementData can not be null"),e=e===void 0?-1:e,r=r===void 0?-1:r,this._rawDuration=this._movementData.duration,this._movementID=t,this._processScale=this._speedScale*this._movementData.scale,e=e===-1?this._movementData.durationTo:e;var n=this._movementData.durationTween===0?this._rawDuration:this._movementData.durationTween,s=this._movementData.tweenEasing;r=r<0?this._movementData.loop:r,this._onMovementList=!1,ccs.ProcessBase.prototype.play.call(this,e,n,r,s),this._rawDuration===0?this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME:(this._loopType=r?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._durationTween=n),this._tweenList.length=0;var o,a=this._armature.getBoneDic();for(var c in a){var l=a[c];o=this._movementData.movBoneDataDic[l.getName()];var h=l.getTween();o&&o.frameList.length>0?(this._tweenList.push(h),o.duration=this._movementData.duration,h.play(o,e,n,r,s),h.setProcessScale(this._processScale),l.getChildArmature()&&(l.getChildArmature().getAnimation().setSpeedScale(this._processScale),l.getChildArmature().getAnimation().isPlaying()||l.getChildArmature().getAnimation().playWithIndex(0))):l.isIgnoreMovementBoneData()||(l.getDisplayManager().changeDisplayWithIndex(-1,!1),h.stop())}this._armature.update(0)},playByIndex:function(t,e,r,n,s){exports.cc.log("playByIndex is deprecated. Use playWithIndex instead."),this.playWithIndex(t,e,n)},playWithIndex:function(t,e,r){var n=this._animationData.movementNames;exports.cc.assert(t>-1&&t<n.length);var s=n[t];this.play(s,e,r)},playWithNames:function(t,e,r){e=e===void 0?-1:e,r=r===void 0?!0:r,this._movementListLoop=r,this._movementListDurationTo=e,this._onMovementList=!0,this._movementIndex=0,t instanceof Array?this._movementList=t:this._movementList.length=0,this.updateMovementList()},playWithIndexes:function(t,e,r){e=e===void 0?-1:e,r=r===void 0?!0:r,this._movementList.length=0,this._movementListLoop=r,this._movementListDurationTo=e,this._onMovementList=!0,this._movementIndex=0;for(var n=this._animationData.movementNames,s=0;s<t.length;s++){var o=n[t[s]];this._movementList.push(o)}this.updateMovementList()},gotoAndPlay:function(t){if(!this._movementData||t<0||t>=this._movementData.duration){exports.cc.log("Please ensure you have played a movement, and the frameIndex is in the range.");return}var e=this._ignoreFrameEvent;this._ignoreFrameEvent=!0,this._isPlaying=!0,this._isComplete=this._isPause=!1,ccs.ProcessBase.prototype.gotoFrame.call(this,t),this._currentPercent=this._curFrameIndex/(this._movementData.duration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent;for(var r=this._tweenList,n=0;n<r.length;n++)r[n].gotoAndPlay(t);this._armature.update(0),this._ignoreFrameEvent=e},gotoAndPause:function(t){this.gotoAndPlay(t),this.pause()},getMovementCount:function(){return this._animationData.getMovementCount()},update:function(t){ccs.ProcessBase.prototype.update.call(this,t);for(var e=this._tweenList,r=0;r<e.length;r++)e[r].update(t);for(var n=this._frameEventQueue,s;n.length>0;)s=n.shift(),this._ignoreFrameEvent=!0,this._frameEventCallFunc&&this._frameEventCallFunc.call(this._frameEventTarget,s.bone,s.frameEventName,s.originFrameIndex,s.currentFrameIndex),this._frameEventListener&&this._frameEventListener(s.bone,s.frameEventName,s.originFrameIndex,s.currentFrameIndex),this._ignoreFrameEvent=!1;for(var o=this._movementEventQueue;o.length>0;)s=o.shift(),this._movementEventCallFunc&&this._movementEventCallFunc.call(this._movementEventTarget,s.armature,s.movementType,s.movementID),this._movementEventListener&&this._movementEventListener(s.armature,s.movementType,s.movementID)},updateHandler:function(){var t=this._currentPercent;if(t>=1){switch(this._loopType){case ccs.ANIMATION_TYPE_NO_LOOP:if(this._loopType=ccs.ANIMATION_TYPE_MAX,this._currentFrame=(t-1)*this._nextFrameIndex,t=this._currentFrame/this._durationTween,t<1){this._nextFrameIndex=this._durationTween,this.movementEvent(this._armature,ccs.MovementEventType.start,this._movementID);break}break;case ccs.ANIMATION_TYPE_MAX:case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1,this._isComplete=!0,this._isPlaying=!1,this.movementEvent(this._armature,ccs.MovementEventType.complete,this._movementID),this.updateMovementList();break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:this._loopType=ccs.ANIMATION_TYPE_LOOP_FRONT,t=ccs.fmodf(t,1),this._currentFrame=this._nextFrameIndex===0?0:ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._nextFrameIndex=this._durationTween>0?this._durationTween:1,this.movementEvent(this,ccs.MovementEventType.start,this._movementID);break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._toIndex=0,this.movementEvent(this._armature,ccs.MovementEventType.loopComplete,this._movementID);break}this._currentPercent=t}},getCurrentMovementID:function(){return this._isComplete?"":this._movementID},setMovementEventCallFunc:function(t,e){arguments.length===1?this._movementEventListener=t:arguments.length===2&&(this._movementEventTarget=e,this._movementEventCallFunc=t)},setFrameEventCallFunc:function(t,e){arguments.length===1?this._frameEventListener=t:arguments.length===2&&(this._frameEventTarget=e,this._frameEventCallFunc=t)},setUserObject:function(t){this._userObject=t},frameEvent:function(t,e,r,n){if(this._frameEventTarget&&this._frameEventCallFunc||this._frameEventListener){var s=new ccs.FrameEvent;s.bone=t,s.frameEventName=e,s.originFrameIndex=r,s.currentFrameIndex=n,this._frameEventQueue.push(s)}},movementEvent:function(t,e,r){if(this._movementEventTarget&&this._movementEventCallFunc||this._movementEventListener){var n=new ccs.MovementEvent;n.armature=t,n.movementType=e,n.movementID=r,this._movementEventQueue.push(n)}},updateMovementList:function(){if(this._onMovementList){var t,e=this._movementList;this._movementListLoop?(t=e[this._movementIndex],this.play(t,t.durationTo,0),this._movementIndex++,this._movementIndex>=e.length&&(this._movementIndex=0)):this._movementIndex<e.length?(t=e[this._movementIndex],this.play(t,t.durationTo,0),this._movementIndex++):this._onMovementList=!1,this._onMovementList=!0}},setAnimationData:function(t){this._animationData!==t&&(this._animationData=t)},getAnimationData:function(){return this._animationData},getUserObject:function(){return this._userObject},isIgnoreFrameEvent:function(){return this._ignoreFrameEvent}});var _p=ccs.ArmatureAnimation.prototype;_p.speedScale;exports.cc.defineGetterSetter(_p,"speedScale",_p.getSpeedScale,_p.setSpeedScale);_p.animationScale;exports.cc.defineGetterSetter(_p,"animationScale",_p.getAnimationScale,_p.setAnimationScale);_p=null;ccs.ArmatureAnimation.create=function(t){return new ccs.ArmatureAnimation(t)};ccs.Tween=ccs.ProcessBase.extend({_tweenData:null,_to:null,_from:null,_between:null,_movementBoneData:null,_bone:null,_frameTweenEasing:0,_betweenDuration:0,_totalDuration:0,_toIndex:0,_fromIndex:0,_animation:null,_passLastFrame:!1,ctor:function(t){ccs.ProcessBase.prototype.ctor.call(this),this._frameTweenEasing=ccs.TweenType.LINEAR,ccs.Tween.prototype.init.call(this,t)},init:function(t){return this._from=new ccs.FrameData,this._between=new ccs.FrameData,this._bone=t,this._tweenData=this._bone.getTweenData(),this._tweenData.displayIndex=-1,this._animation=this._bone!==null&&this._bone.getArmature()!==null?this._bone.getArmature().getAnimation():null,!0},play:function(t,e,r,n,s){ccs.ProcessBase.prototype.play.call(this,e,r,n,s),this._loopType=n?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;var o=t!==this._movementBoneData;this.setMovementBoneData(t),this._rawDuration=this._movementBoneData.duration;var a=this._movementBoneData.getFrameData(0);this._tweenData.displayIndex=a.displayIndex,this._bone.getArmature().getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeSub(this._tweenData,this._bone.getBoneData()),this._tweenData.scaleX+=1,this._tweenData.scaleY+=1),this._rawDuration===0?(this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME,e===0?this.setBetween(a,a):this.setBetween(this._tweenData,a),this._frameTweenEasing=ccs.TweenType.LINEAR):this._movementBoneData.frameList.length>1&&(this._durationTween=r*this._movementBoneData.scale,n&&this._movementBoneData.delay!==0?this.setBetween(this._tweenData,this.tweenNodeTo(this.updateFrameData(1-this._movementBoneData.delay),this._between)):!o||e===0?this.setBetween(a,a):this.setBetween(this._tweenData,a)),this.tweenNodeTo(0)},gotoAndPlay:function(t){ccs.ProcessBase.prototype.gotoFrame.call(this,t),this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0,this._isPlaying=!0,this._isComplete=this._isPause=!1,this._currentPercent=this._curFrameIndex/(this._rawDuration-1),this._currentFrame=this._nextFrameIndex*this._currentPercent},gotoAndPause:function(t){this.gotoAndPlay(t),this.pause()},updateHandler:function(){var t=this._currentPercent==null?1:this._currentPercent,e=this._loopType;if(t>=1)switch(e){case ccs.ANIMATION_TYPE_SINGLE_FRAME:t=1,this._isComplete=!0,this._isPlaying=!1;break;case ccs.ANIMATION_TYPE_NO_LOOP:if(e=ccs.ANIMATION_TYPE_MAX,this._durationTween<=0?t=1:t=(t-1)*this._nextFrameIndex/this._durationTween,t>=1){t=1,this._isComplete=!0,this._isPlaying=!1;break}else{this._nextFrameIndex=this._durationTween,this._currentFrame=t*this._nextFrameIndex,this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;break}case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:e=ccs.ANIMATION_TYPE_LOOP_FRONT,this._nextFrameIndex=this._durationTween>0?this._durationTween:1,this._movementBoneData.delay!==0?(this._currentFrame=(1-this._movementBoneData.delay)*this._nextFrameIndex,t=this._currentFrame/this._nextFrameIndex):(t=0,this._currentFrame=0),this._totalDuration=0,this._betweenDuration=0,this._fromIndex=this._toIndex=0;break;case ccs.ANIMATION_TYPE_MAX:t=1,this._isComplete=!0,this._isPlaying=!1;break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex);break}t<1&&e<ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(t=Math.sin(t*exports.cc.PI/2)),this._currentPercent=t,this._loopType=e,e>ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(t=this.updateFrameData(t)),this._frameTweenEasing!==ccs.TweenType.TWEEN_EASING_MAX&&this.tweenNodeTo(t)},setBetween:function(t,e,r){r===void 0&&(r=!0);do{if(t.displayIndex<0&&e.displayIndex>=0){this._from.copy(e),this._between.subtract(e,e,r);break}if(e.displayIndex<0&&t.displayIndex>=0){this._from.copy(t),this._between.subtract(e,e,r);break}this._from.copy(t),this._between.subtract(t,e,r)}while(0);t.isTween||(this._tweenData.copy(t),this._tweenData.isTween=!0),this.arriveKeyFrame(t)},arriveKeyFrame:function(t){if(t){var e=this._bone,r=e.getDisplayManager(),n=t.displayIndex;r.getForceChangeDisplay()||r.changeDisplayWithIndex(n,!1),this._tweenData.zOrder=t.zOrder,e.updateZOrder(),this._bone.setBlendFunc(t.blendFunc);var s=e.getChildArmature();s&&t.movement!==""&&s.getAnimation().play(t.movement)}},tweenNodeTo:function(t,e){e||(e=this._tweenData);var r=this._from,n=this._between;return r.isTween||(t=0),e.x=r.x+t*n.x,e.y=r.y+t*n.y,e.scaleX=r.scaleX+t*n.scaleX,e.scaleY=r.scaleY+t*n.scaleY,e.skewX=r.skewX+t*n.skewX,e.skewY=r.skewY+t*n.skewY,this._bone.setTransformDirty(!0),e&&n.isUseColorInfo&&this.tweenColorTo(t,e),e},tweenColorTo:function(t,e){var r=this._from,n=this._between;e.a=r.a+t*n.a,e.r=r.r+t*n.r,e.g=r.g+t*n.g,e.b=r.b+t*n.b,this._bone.updateColor()},updateFrameData:function(t){t>1&&this._movementBoneData.delay!==0&&(t=ccs.fmodf(t,1));var e=(this._rawDuration-1)*t,r,n,s=this._totalDuration,o=this._betweenDuration,a=this._toIndex;if(e<s||e>=s+o){var c=this._movementBoneData.frameList,l=c.length;if(e<c[0].frameID)return r=n=c[0],this.setBetween(r,n),this._currentPercent;if(e>=c[l-1].frameID){if(this._passLastFrame)return r=n=c[l-1],this.setBetween(r,n),this._currentPercent;this._passLastFrame=!0}else this._passLastFrame=!1;do if(this._fromIndex=a,r=c[this._fromIndex],s=r.frameID,a=this._fromIndex+1,a>=l&&(a=0),n=c[a],r.strEvent&&!this._animation.isIgnoreFrameEvent()&&this._animation.frameEvent(this._bone,r.strEvent,r.frameID,e),e===r.frameID||this._passLastFrame&&this._fromIndex===l-1)break;while(e<r.frameID||e>=n.frameID);o=n.frameID-r.frameID,this._frameTweenEasing=r.tweenEasing,this.setBetween(r,n,!1),this._totalDuration=s,this._betweenDuration=o,this._toIndex=a}t=o===0?0:(e-this._totalDuration)/this._betweenDuration;var h=this._frameTweenEasing!==ccs.TweenType.LINEAR?this._frameTweenEasing:this._tweenEasing;return h!==ccs.TweenType.TWEEN_EASING_MAX&&h!==ccs.TweenType.LINEAR&&!this._passLastFrame&&(t=ccs.TweenFunction.tweenTo(t,h,this._from.easingParams)),t},setAnimation:function(t){this._animation=t},getAnimation:function(){return this._animation},setMovementBoneData:function(t){this._movementBoneData=t}});var _p=ccs.Tween.prototype;_p.animation;exports.cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation);_p=null;ccs.Tween.create=function(t){return new ccs.Tween(t)};ccs.PT_RATIO=32;ccs.ColliderFilter=ccs.Class.extend({_collisionType:0,_group:0,_categoryBits:0,_groupIndex:0,_maskBits:0,ctor:function(t,e){this._collisionType=t||0,this._group=e||0},updateShape:function(t){if(t instanceof cp.Shape)t.collision_type=this._collisionType,t.group=this._group;else if(t instanceof Box2D.b2FilterData){var e=new Box2D.b2FilterData;e.categoryBits=this._categoryBits,e.groupIndex=this._groupIndex,e.maskBits=this._maskBits,t.SetFilterData(e)}}});ccs.ColliderBody=ccs.Class.extend({shape:null,coutourData:null,colliderFilter:null,_calculatedVertexList:null,ctor:function(t){this.shape=null,this.coutourData=t,this.colliderFilter=new ccs.ColliderFilter,ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX&&(this._calculatedVertexList=[])},getContourData:function(){return this.coutourData},setColliderFilter:function(t){this.colliderFilter=t},getCalculatedVertexList:function(){return this._calculatedVertexList},setB2Fixture:function(t){this._fixture=t},getB2Fixture:function(){return this._fixture},setShape:function(t){this.shape=t},getShape:function(){return this.shape},setContourData:function(t){this.coutourData=t},getColliderFilter:function(){return this.colliderFilter}});ccs.ColliderDetector=ccs.Class.extend({_colliderBodyList:null,_bone:null,_body:null,_active:!1,_filter:null,helpPoint:exports.cc.p(0,0),ctor:function(t){this._colliderBodyList=[],this._bone=null,this._body=null,this._active=!1,this._filter=null,ccs.ColliderDetector.prototype.init.call(this,t)},init:function(t){return this._colliderBodyList.length=0,t&&(this._bone=t),this._filter=new ccs.ColliderFilter,!0},addContourData:function(t){var e=new ccs.ColliderBody(t);if(this._colliderBodyList.push(e),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)for(var r=e.getCalculatedVertexList(),n=t.vertexList,s=0;s<n.length;s++){var o=new ccs.ContourVertex2(0,0);r.push(o)}},addContourDataList:function(t){for(var e=0;e<t.length;e++)this.addContourData(t[e])},removeContourData:function(t){var e=[],r,n=this._colliderBodyList;for(r=0;r<n.length;r++){var s=n[r];s&&s.getContourData()===t&&e.push(s)}for(r=0;r<e.length;r++)exports.cc.arrayRemoveObject(n,e[r])},removeAll:function(){this._colliderBodyList.length=0},setActive:function(t){if(this._active!==t){this._active=t;var e=this._body,r;if(e){var n=null;if(this._active)for(var s=0;s<this._colliderBodyList.length;s++)n=this._colliderBodyList[s],r=n.getShape(),e.space.addShape(r);else for(var s=0;s<this._colliderBodyList.length;s++)n=this._colliderBodyList[s],r=n.getShape(),e.space.removeShape(r)}}},getActive:function(){return this._active},getColliderBodyList:function(){return this._colliderBodyList},setColliderFilter:function(t){this._filter=t;for(var e=this._colliderBodyList,r=0;r<e.length;r++){var n=e[r];n.setColliderFilter(t),n.getShape()&&n.getColliderFilter().updateShape(n.getShape())}},getColliderFilter:function(){return this._filter},updateTransform:function(t){if(this._active)for(var e=null,r=this._body,n=this.helpPoint,s=0;s<this._colliderBodyList.length;s++){e=this._colliderBodyList[s];var o=e.getContourData(),a=null;r&&(a=e.getShape());for(var c=o.vertexList,l=e.getCalculatedVertexList(),h=0;h<c.length;h++){if(n.x=c[h].x,n.y=c[h].y,n=exports.cc.pointApplyAffineTransform(n,t),ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var u=exports.cc.p(0,0);u.x=n.x,u.y=n.y,l[h]=u}a&&(a.verts[h*2]=n.x,a.verts[h*2+1]=n.y)}if(a)for(var h=0;h<c.length;h++){var _=a.verts[(h+1)%a.verts.length],d=cp.v.normalize(cp.v.perp(cp.v.sub(_,a.verts[h])));a.planes&&(a.planes[h].n=d,a.planes[h].d=cp.v.dot(d,a.verts[h]))}}},setBody:function(t){this._body=t;for(var e,r=this._colliderBodyList,n=0;n<r.length;n++){e=r[n];for(var s=e.getContourData(),o=[],a=s.vertexList,c=0;c<a.length;c++){var l=a[c];o.push(l.x),o.push(l.y)}var h=new cp.PolyShape(this._body,o,cp.vzero);h.sensor=!0,h.data=this._bone,this._active&&this._body.space.addShape(h),e.setShape(h),e.getColliderFilter().updateShape(h)}},getBody:function(){return this._body}});var _p=ccs.ColliderDetector.prototype;_p.colliderFilter;exports.cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);_p.active;exports.cc.defineGetterSetter(_p,"active",_p.getActive,_p.setActive);_p.body;exports.cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);_p=null;ccs.ColliderDetector.create=function(t){return new ccs.ColliderDetector(t)};ccs.Armature=ccs.Node.extend({animation:null,armatureData:null,batchNode:null,_textureAtlas:null,_parentBone:null,_boneDic:null,_topBoneList:null,_armatureIndexDic:null,_offsetPoint:null,version:0,_armatureTransformDirty:!0,_body:null,_blendFunc:null,_className:"Armature",ctor:function(t,e){exports.cc.Node.prototype.ctor.call(this),this._name="",this._topBoneList=[],this._armatureIndexDic={},this._offsetPoint=exports.cc.p(0,0),this._armatureTransformDirty=!0,this._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},t&&ccs.Armature.prototype.init.call(this,t,e)},init:function(t,e){exports.cc.Node.prototype.init.call(this),e&&(this._parentBone=e),this.removeAllChildren(),this.animation=new ccs.ArmatureAnimation,this.animation.init(this),this._boneDic={},this._topBoneList.length=0;var r=ccs.armatureDataManager,n;if(t!==""){n=r.getAnimationData(t),exports.cc.assert(n,"AnimationData not exist!"),this.animation.setAnimationData(n);var s=r.getArmatureData(t);exports.cc.assert(s,"ArmatureData not exist!"),this.armatureData=s;var o=s.getBoneDataDic();for(var a in o){var c=this.createBone(String(a));do{var l=n.getMovement(n.movementNames[0]);if(!l)break;var h=l.getMovementBoneData(c.getName());if(!h||h.frameList.length<=0)break;var u=h.getFrameData(0);if(!u)break;c.getTweenData().copy(u),c.changeDisplayWithIndex(u.displayIndex,!1)}while(0)}this.update(0),this.updateOffsetPoint()}else t="new_armature",this.armatureData=new ccs.ArmatureData,this.armatureData.name=t,n=new ccs.AnimationData,n.name=t,r.addArmatureData(t,this.armatureData),r.addAnimationData(t,n),this.animation.setAnimationData(n);return this._renderCmd.initShaderCache(),this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),!0},addChild:function(t,e,r){if(t instanceof ccui.Widget){exports.cc.log("Armature doesn't support to add Widget as its child, it will be fix soon.");return}exports.cc.Node.prototype.addChild.call(this,t,e,r)},createBone:function(t){var e=this.getBone(t);if(e)return e;var r=this.armatureData.getBoneData(t),n=r.parentName,s=null;return n?(this.createBone(n),s=new ccs.Bone(t),this.addBone(s,n)):(s=new ccs.Bone(t),this.addBone(s,"")),s.setBoneData(r),s.getDisplayManager().changeDisplayWithIndex(-1,!1),s},addBone:function(t,e){exports.cc.assert(t,"Argument must be non-nil");var r=this._boneDic;if(t.getName()&&exports.cc.assert(!r[t.getName()],"bone already added. It can't be added again"),e){var n=r[e];n?n.addChildBone(t):this._topBoneList.push(t)}else this._topBoneList.push(t);t.setArmature(this),r[t.getName()]=t,this.addChild(t)},removeBone:function(t,e){exports.cc.assert(t,"bone must be added to the bone dictionary!"),t.setArmature(null),t.removeFromParent(e),exports.cc.arrayRemoveObject(this._topBoneList,t),delete this._boneDic[t.getName()],this.removeChild(t,!0)},getBone:function(t){return this._boneDic[t]},changeBoneParent:function(t,e){exports.cc.assert(t,"bone must be added to the bone dictionary!");var r=t.getParentBone();if(r&&(exports.cc.arrayRemoveObject(r.getChildren(),t),t.setParentBone(null)),e){var n=this._boneDic[e];n?(n.addChildBone(t),exports.cc.arrayRemoveObject(this._topBoneList,t)):this._topBoneList.push(t)}},getBoneDic:function(){return this._boneDic},updateOffsetPoint:function(){var t=this.getBoundingBox();this.setContentSize(t);var e=this._offsetPoint;e.x=-t.x,e.y=-t.y,t.width!==0&&t.height!==0&&this.setAnchorPoint(e.x/t.width,e.y/t.height)},getOffsetPoints:function(){return{x:this._offsetPoint.x,y:this._offsetPoint.y}},setAnimation:function(t){this.animation=t},getAnimation:function(){return this.animation},getArmatureTransformDirty:function(){return this._armatureTransformDirty},update:function(t){this.animation.update(t);for(var e=this._topBoneList,r=0;r<e.length;r++)e[r].update(t);this._armatureTransformDirty=!1},onEnter:function(){exports.cc.Node.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){exports.cc.Node.prototype.onExit.call(this),this.unscheduleUpdate()},getBoundingBox:function(){for(var t,e,r,n=0,s=!0,o=exports.cc.rect(0,0,0,0),a=this._children,c=a.length,l=0;l<c;l++){var h=a[l];if(h){var u=h.getDisplayManager().getBoundingBox();if(u.x===0&&u.y===0&&u.width===0&&u.height===0)continue;s?(t=u.x,e=u.y,r=u.x+u.width,n=u.y+u.height,s=!1):(t=u.x<o.x?u.x:o.x,e=u.y<o.y?u.y:o.y,r=u.x+u.width>o.x+o.width?u.x+u.width:o.x+o.width,n=u.y+u.height>o.y+o.height?u.y+u.height:o.y+o.height),o.x=t,o.y=e,o.width=r-t,o.height=n-e}}return exports.cc.rectApplyAffineTransform(o,this.getNodeToParentTransform())},getBoneAtPoint:function(t,e){for(var r=this._children,n=r.length-1;n>=0;n--){var s=r[n];if(s instanceof ccs.Bone&&s.getDisplayManager().containPoint(t,e))return s}return null},setParentBone:function(t){this._parentBone=t;var e=this._boneDic;for(var r in e)e[r].setArmature(this)},getParentBone:function(){return this._parentBone},drawContour:function(){exports.cc._drawingUtil.setDrawColor(255,255,255,255),exports.cc._drawingUtil.setLineWidth(1);var t=this._boneDic;for(var e in t){var r=t[e],n=r.getColliderDetector();if(n)for(var s=n.getColliderBodyList(),o=0;o<s.length;o++){var a=s[o],c=a.getCalculatedVertexList();exports.cc._drawingUtil.drawPoly(c,c.length,!0)}}},setBody:function(t){if(this._body!==t){this._body=t,this._body.data=this||window;for(var e,r,n=this._children,s=0;s<n.length;s++)if(e=n[s],e instanceof ccs.Bone)for(var o=e.getDisplayManager().getDecorativeDisplayList(),a=0;a<o.length;a++){r=o[a];var c=r.getColliderDetector();c&&c.setBody(this._body)}}},getShapeList:function(){return this._body?this._body.shapeList:null},getBody:function(){return this._body},setBlendFunc:function(t,e){e===void 0?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},getBlendFunc:function(){return new exports.cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setColliderFilter:function(t){var e=this._boneDic;for(var r in e)e[r].setColliderFilter(t)},getArmatureData:function(){return this.armatureData},setArmatureData:function(t){this.armatureData=t},getBatchNode:function(){return this.batchNode},setBatchNode:function(t){this.batchNode=t},getVersion:function(){return this.version},setVersion:function(t){this.version=t},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new ccs.Armature.CanvasRenderCmd(this):new ccs.Armature.WebGLRenderCmd(this)}});var _p=ccs.Armature.prototype;_p.parentBone;exports.cc.defineGetterSetter(_p,"parentBone",_p.getParentBone,_p.setParentBone);_p.body;exports.cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);_p.colliderFilter;exports.cc.defineGetterSetter(_p,"colliderFilter",null,_p.setColliderFilter);_p=null;ccs.Armature.create=function(t,e){return new ccs.Armature(t,e)};(function(){ccs.Armature.RenderCmd={_updateAnchorPointInPoint:function(){var t=this._node,e=t._contentSize,r=t._anchorPoint,n=t._offsetPoint;this._anchorPointInPoints.x=e.width*r.x-n.x,this._anchorPointInPoints.y=e.height*r.y-n.y,this._realAnchorPointInPoints.x=e.width*r.x,this._realAnchorPointInPoints.y=e.height*r.y,this.setDirtyFlag(exports.cc.Node._dirtyFlags.transformDirty)},getAnchorPointInPoints:function(){return exports.cc.p(this._realAnchorPointInPoints)}}})();(function(){ccs.Armature.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!0,this._realAnchorPointInPoints=new exports.cc.Point(0,0),this._canUseDirtyRegion=!0,this._startRenderCmd=new exports.cc.CustomRenderCmd(this,this._startCmdCallback),this._RestoreRenderCmd=new exports.cc.CustomRenderCmd(this,this._RestoreCmdCallback),this._startRenderCmd._canUseDirtyRegion=!0,this._RestoreRenderCmd._canUseDirtyRegion=!0};var t=ccs.Armature.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);exports.cc.inject(ccs.Armature.RenderCmd,t),t.constructor=ccs.Armature.CanvasRenderCmd,t._startCmdCallback=function(e,r,n){var s=this._node,o=s._parent;this.transform(o?o._renderCmd:null);var a=e||exports.cc._renderContext;a.save(),a._switchToArmatureMode(!0,this._worldTransform,r,n)},t.transform=function(e,r){ccs.Node.CanvasRenderCmd.prototype.transform.call(this,e,r);for(var n=this._node._children,s=0,o=n.length;s<o;s++){var a=n[s],c=a._renderCmd;if(a&&a.getDisplayRenderNode){var l=a.getDisplayRenderNodeType(),h=a.getDisplayRenderNode();if(h&&h._renderCmd){var u=h._renderCmd;u.transform(null),l!==ccs.DISPLAY_TYPE_ARMATURE&&l!==ccs.DISPLAY_TYPE_SPRITE&&exports.cc.affineTransformConcatIn(u._worldTransform,a._worldTransform);var _=exports.cc.Node._dirtyFlags,d=u._dirtyFlag,f=c._dirtyFlag,T=f&_.colorDirty,x=f&_.opacityDirty;T&&c._updateDisplayColor(),x&&c._updateDisplayOpacity(),(T||x)&&c._updateColor();var m=a._renderCmd._displayedColor,v=a._renderCmd._displayedOpacity;T=d&_.colorDirty,x=d&_.opacityDirty,T&&u._updateDisplayColor(m),x&&u._updateDisplayOpacity(v),(T||x)&&u._updateColor()}}}},t._RestoreCmdCallback=function(e){this._cacheDirty=!1,e._switchToArmatureMode(!1),e.restore()},t.initShaderCache=function(){},t.setShaderProgram=function(){},t.updateChildPosition=function(e,r){e.visit()},t.rendering=function(e,r,n){var s=this._node,o=s._children;exports.cc.BlendFunc.ALPHA_PREMULTIPLIED,exports.cc.BlendFunc.ALPHA_NON_PREMULTIPLIED;for(var a=0,c=o.length;a<c;a++){var l=o[a];if(l&&l.getDisplayRenderNode){var h=l.getDisplayRenderNode();if(h===null)continue;var u=l._renderCmd;switch(u._syncStatus(this),l.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:h._renderCmd.visit(u);break;case ccs.DISPLAY_TYPE_ARMATURE:h._renderCmd.rendering(e,r,n);break;default:h._renderCmd.visit(u);break}}else l instanceof exports.cc.Node&&this._visitNormalChild(l)}},t._visitNormalChild=function(e){if(e){var r=e._renderCmd;if(e._visible){r._curLevel=this._curLevel+1;var n,s=e._children,o;r._syncStatus(this),r.transform(null);var a=s.length;if(a>0){for(e.sortAllChildren(),n=0;n<a&&(o=s[n],o._localZOrder<0);n++)o._renderCmd.visit(r);for(exports.cc.renderer.pushRenderCommand(r);n<a;n++)s[n]._renderCmd.visit(r)}else exports.cc.renderer.pushRenderCommand(r);this._dirtyFlag=0}}},t.visit=function(e){var r=this._node;r._visible&&(this._syncStatus(e),r.sortAllChildren(),exports.cc.renderer.pushRenderCommand(this._startRenderCmd),this.rendering(),exports.cc.renderer.pushRenderCommand(this._RestoreRenderCmd),this._cacheDirty=!1)}})();ccs.Bone=ccs.Node.extend({_boneData:null,_armature:null,_childArmature:null,_displayManager:null,ignoreMovementBoneData:!1,_tween:null,_tweenData:null,_parentBone:null,_boneTransformDirty:!1,_worldTransform:null,_blendFunc:null,blendDirty:!1,_worldInfo:null,_armatureParentBone:null,_dataVersion:0,_className:"Bone",ctor:function(t){exports.cc.Node.prototype.ctor.call(this),this._tweenData=null,this._parentBone=null,this._armature=null,this._childArmature=null,this._boneData=null,this._tween=null,this._displayManager=null,this.ignoreMovementBoneData=!1,this._worldTransform=exports.cc.affineTransformMake(1,0,0,1,0,0),this._boneTransformDirty=!0,this._blendFunc=new exports.cc.BlendFunc(exports.cc.BLEND_SRC,exports.cc.BLEND_DST),this.blendDirty=!1,this._worldInfo=null,this._armatureParentBone=null,this._dataVersion=0,ccs.Bone.prototype.init.call(this,t)},init:function(t){return t&&(this._name=t),this._tweenData=new ccs.FrameData,this._tween=new ccs.Tween(this),this._displayManager=new ccs.DisplayManager(this),this._worldInfo=new ccs.BaseData,this._boneData=new ccs.BaseData,!0},setBoneData:function(t){exports.cc.assert(t,"_boneData must not be null"),this._boneData!==t&&(this._boneData=t),this.setName(this._boneData.name),this._localZOrder=this._boneData.zOrder,this._displayManager.initDisplayList(t)},getBoneData:function(){return this._boneData},setArmature:function(t){this._armature=t,t?(this._tween.setAnimation(this._armature.getAnimation()),this._dataVersion=this._armature.getArmatureData().dataVersion,this._armatureParentBone=this._armature.getParentBone()):this._armatureParentBone=null},getArmature:function(){return this._armature},update:function(t){if(this._parentBone&&(this._boneTransformDirty=this._boneTransformDirty||this._parentBone.isTransformDirty()),this._armatureParentBone&&!this._boneTransformDirty&&(this._boneTransformDirty=this._armatureParentBone.isTransformDirty()),this._boneTransformDirty){var e=this._tweenData;this._dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeConcat(e,this._boneData),e.scaleX-=1,e.scaleY-=1);var r=this._worldInfo;r.copy(e),r.x=e.x+this._position.x,r.y=e.y+this._position.y,r.scaleX=e.scaleX*this._scaleX,r.scaleY=e.scaleY*this._scaleY,r.skewX=e.skewX+this._skewX+exports.cc.degreesToRadians(this._rotationX),r.skewY=e.skewY+this._skewY-exports.cc.degreesToRadians(this._rotationY),this._parentBone?this._applyParentTransform(this._parentBone):this._armatureParentBone&&this._applyParentTransform(this._armatureParentBone),ccs.TransformHelp.nodeToMatrix(r,this._worldTransform),this._armatureParentBone&&exports.cc.affineTransformConcatIn(this._worldTransform,this._armature.getNodeToParentTransform())}ccs.displayFactory.updateDisplay(this,t,this._boneTransformDirty||this._armature.getArmatureTransformDirty());for(var n=0;n<this._children.length;n++){var s=this._children[n];s.update(t)}this._boneTransformDirty=!1},_applyParentTransform:function(t){var e=this._worldInfo,r=t._worldTransform,n=t._worldInfo,s=e.x,o=e.y;e.x=s*r.a+o*r.c+n.x,e.y=s*r.b+o*r.d+n.y,e.scaleX=e.scaleX*n.scaleX,e.scaleY=e.scaleY*n.scaleY,e.skewX=e.skewX+n.skewX,e.skewY=e.skewY+n.skewY},setBlendFunc:function(t,e){var r=this._blendFunc,n,s;e===void 0?(n=t.src,s=t.dst):(n=t,s=e),(r.src!==n||r.dst!==s)&&(r.src=n,r.dst=s,this.blendDirty=!0)},updateColor:function(){var t=this._displayManager.getDisplayRenderNode();if(t!==null){var e=this._renderCmd;t.setColor(exports.cc.color(e._displayedColor.r*this._tweenData.r/255,e._displayedColor.g*this._tweenData.g/255,e._displayedColor.b*this._tweenData.b/255)),t.setOpacity(e._displayedOpacity*this._tweenData.a/255)}},updateZOrder:function(){this._armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?this.setLocalZOrder(this._tweenData.zOrder+this._boneData.zOrder):this.setLocalZOrder(this._tweenData.zOrder)},addChildBone:function(t){exports.cc.assert(t,"Argument must be non-nil"),exports.cc.assert(!t.parentBone,"child already added. It can't be added again"),this._children.indexOf(t)<0&&(this._children.push(t),t.setParentBone(this))},removeChildBone:function(t,e){if(this._children.length>0&&this._children.getIndex(t)!==-1){if(e)for(var r=t._children,n=0;n<r.length;n++){var s=r[n];t.removeChildBone(s,e)}t.setParentBone(null),t.getDisplayManager().setCurrentDecorativeDisplay(null),exports.cc.arrayRemoveObject(this._children,t)}},removeFromParent:function(t){this._parentBone&&this._parentBone.removeChildBone(this,t)},setParentBone:function(t){this._parentBone=t},getParentBone:function(){return this._parentBone},setChildArmature:function(t){this._childArmature!==t&&(t==null&&this._childArmature&&this._childArmature.setParentBone(null),this._childArmature=t)},getChildArmature:function(){return this._childArmature},getTween:function(){return this._tween},setLocalZOrder:function(t){this._localZOrder!==t&&exports.cc.Node.prototype.setLocalZOrder.call(this,t)},getNodeToArmatureTransform:function(){return this._worldTransform},getNodeToWorldTransform:function(){return exports.cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToWorldTransform())},getDisplayRenderNode:function(){return this._displayManager.getDisplayRenderNode()},getDisplayRenderNodeType:function(){return this._displayManager.getDisplayRenderNodeType()},addDisplay:function(t,e){return e=e||0,this._displayManager.addDisplay(t,e)},removeDisplay:function(t){this._displayManager.removeDisplay(t)},changeDisplayByIndex:function(t,e){exports.cc.log("changeDisplayByIndex is deprecated. Use changeDisplayWithIndex instead."),this.changeDisplayWithIndex(t,e)},changeDisplayByName:function(t,e){exports.cc.log("changeDisplayByName is deprecated. Use changeDisplayWithName instead."),this.changeDisplayWithName(t,e)},changeDisplayWithIndex:function(t,e){this._displayManager.changeDisplayWithIndex(t,e)},changeDisplayWithName:function(t,e){this._displayManager.changeDisplayWithName(t,e)},getColliderDetector:function(){var t=this._displayManager.getCurrentDecorativeDisplay();if(t){var e=t.getColliderDetector();if(e)return e}return null},setColliderFilter:function(t){for(var e=this._displayManager.getDecorativeDisplayList(),r=0;r<e.length;r++){var n=e[r],s=n.getColliderDetector();s&&s.setColliderFilter(t)}},getColliderFilter:function(){var t=this.displayManager.getCurrentDecorativeDisplay();if(t){var e=t.getColliderDetector();if(e)return e.getColliderFilter()}return null},setTransformDirty:function(t){this._boneTransformDirty=t},isTransformDirty:function(){return this._boneTransformDirty},getDisplayManager:function(){return this._displayManager},setIgnoreMovementBoneData:function(t){this._ignoreMovementBoneData=t},isIgnoreMovementBoneData:function(){return this._ignoreMovementBoneData},getBlendFunc:function(){return new exports.cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setBlendDirty:function(t){this._blendDirty=t},isBlendDirty:function(){return this._blendDirty},getTweenData:function(){return this._tweenData},getWorldInfo:function(){return this._worldInfo},getChildrenBone:function(){return this._children},nodeToArmatureTransform:function(){return this.getNodeToArmatureTransform()},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getColliderBodyList:function(){var t=this.getColliderDetector();return t?t.getColliderBodyList():null},getIgnoreMovementBoneData:function(){return this.isIgnoreMovementBoneData()},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new ccs.Bone.CanvasRenderCmd(this):new ccs.Bone.WebGLRenderCmd(this)}});var _p=ccs.Bone.prototype;_p.boneData;exports.cc.defineGetterSetter(_p,"boneData",_p.getBoneData,_p.setBoneData);_p.armature;exports.cc.defineGetterSetter(_p,"armature",_p.getArmature,_p.setArmature);_p.childArmature;exports.cc.defineGetterSetter(_p,"childArmature",_p.getChildArmature,_p.setChildArmature);_p.childrenBone;exports.cc.defineGetterSetter(_p,"childrenBone",_p.getChildrenBone);_p.tween;exports.cc.defineGetterSetter(_p,"tween",_p.getTween);_p.tweenData;exports.cc.defineGetterSetter(_p,"tweenData",_p.getTweenData);_p.colliderFilter;exports.cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);_p=null;ccs.Bone.create=function(t){return new ccs.Bone(t)};ccs.Bone.RenderCmd={_updateColor:function(){var t=this._node,e=t._displayManager.getDisplayRenderNode();if(e!==null){var r=e._renderCmd;e.setColor(this._displayedColor),e.setOpacity(this._displayedOpacity),r._syncDisplayColor(t._tweenData),r._syncDisplayOpacity(t._tweenData.a),r._updateColor()}},transform:function(t,e){var r=this._node,n=this._transform,s=this._worldTransform,o=t?t._worldTransform:null;o&&(this.originTransform(),exports.cc.affineTransformConcatIn(n,r._worldTransform)),o?(s.a=n.a*o.a+n.b*o.c,s.b=n.a*o.b+n.b*o.d,s.c=n.c*o.a+n.d*o.c,s.d=n.c*o.b+n.d*o.d,s.tx=n.tx*o.a+n.ty*o.c+o.tx,s.ty=n.tx*o.b+n.ty*o.d+o.ty):(s.a=n.a,s.b=n.b,s.c=n.c,s.d=n.d,s.tx=n.tx,s.ty=n.ty)}};(function(){ccs.Bone.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._needDraw=!1};var t=ccs.Bone.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);exports.cc.inject(ccs.Bone.RenderCmd,t),t.constructor=ccs.Bone.CanvasRenderCmd})();(function(){if(exports.cc.Node.WebGLRenderCmd){ccs.Bone.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!1};var t=ccs.Bone.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);exports.cc.inject(ccs.Bone.RenderCmd,t),t.constructor=ccs.Bone.WebGLRenderCmd}})();ccs.FRAME_TYPE_MOVE=0;ccs.FRAME_TYPE_SCALE=1;ccs.FRAME_TYPE_ROTATE=2;ccs.FRAME_TYPE_TINT=3;ccs.FRAME_TYPE_FADE=4;ccs.FRAME_TYPE_MAX=5;ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e3};ccs.ActionFrame=ccs.Class.extend({frameType:0,easingType:0,frameIndex:0,_Parameter:null,time:0,ctor:function(){this.frameType=0,this.easingType=ccs.FrameEaseType.LINEAR,this.frameIndex=0,this.time=0},getAction:function(t,e){return exports.cc.log("Need a definition of <getAction> for ActionFrame"),null},_getEasingAction:function(t){if(t===null)return console.error("Action cannot be null!"),null;var e;switch(this.easingType){case ccs.FrameEaseType.CUSTOM:break;case ccs.FrameEaseType.LINEAR:e=t;break;case ccs.FrameEaseType.SINE_EASEIN:e=t.easing(exports.cc.easeSineIn());break;case ccs.FrameEaseType.SINE_EASEOUT:e=t.easing(exports.cc.easeSineOut());break;case ccs.FrameEaseType.SINE_EASEINOUT:e=t.easing(exports.cc.easeSineInOut());break;case ccs.FrameEaseType.QUAD_EASEIN:e=t.easing(exports.cc.easeQuadraticActionIn());break;case ccs.FrameEaseType.QUAD_EASEOUT:e=t.easing(exports.cc.easeQuadraticActionOut());break;case ccs.FrameEaseType.QUAD_EASEINOUT:e=t.easing(exports.cc.easeQuadraticActionInOut());break;case ccs.FrameEaseType.CUBIC_EASEIN:e=t.easing(exports.cc.easeCubicActionIn());break;case ccs.FrameEaseType.CUBIC_EASEOUT:e=t.easing(exports.cc.easeCubicActionOut());break;case ccs.FrameEaseType.CUBIC_EASEINOUT:e=t.easing(exports.cc.easeCubicActionInOut());break;case ccs.FrameEaseType.QUART_EASEIN:e=t.easing(exports.cc.easeQuarticActionIn());break;case ccs.FrameEaseType.QUART_EASEOUT:e=t.easing(exports.cc.easeQuarticActionOut());break;case ccs.FrameEaseType.QUART_EASEINOUT:e=t.easing(exports.cc.easeQuarticActionInOut());break;case ccs.FrameEaseType.QUINT_EASEIN:e=t.easing(exports.cc.easeQuinticActionIn());break;case ccs.FrameEaseType.QUINT_EASEOUT:e=t.easing(exports.cc.easeQuinticActionOut());break;case ccs.FrameEaseType.QUINT_EASEINOUT:e=t.easing(exports.cc.easeQuinticActionInOut());break;case ccs.FrameEaseType.EXPO_EASEIN:e=t.easing(exports.cc.easeExponentialIn());break;case ccs.FrameEaseType.EXPO_EASEOUT:e=t.easing(exports.cc.easeExponentialOut());break;case ccs.FrameEaseType.EXPO_EASEINOUT:e=t.easing(exports.cc.easeExponentialInOut());break;case ccs.FrameEaseType.CIRC_EASEIN:e=t.easing(exports.cc.easeCircleActionIn());break;case ccs.FrameEaseType.CIRC_EASEOUT:e=t.easing(exports.cc.easeCircleActionOut());break;case ccs.FrameEaseType.CIRC_EASEINOUT:e=t.easing(exports.cc.easeCircleActionInOut());break;case ccs.FrameEaseType.ELASTIC_EASEIN:e=t.easing(exports.cc.easeElasticIn());break;case ccs.FrameEaseType.ELASTIC_EASEOUT:e=t.easing(exports.cc.easeElasticOut());break;case ccs.FrameEaseType.ELASTIC_EASEINOUT:e=t.easing(exports.cc.easeElasticInOut());break;case ccs.FrameEaseType.BACK_EASEIN:e=t.easing(exports.cc.easeBackIn());break;case ccs.FrameEaseType.BACK_EASEOUT:e=t.easing(exports.cc.easeBackOut());break;case ccs.FrameEaseType.BACK_EASEINOUT:e=t.easing(exports.cc.easeBackInOut());break;case ccs.FrameEaseType.BOUNCE_EASEIN:e=t.easing(exports.cc.easeBounceIn());break;case ccs.FrameEaseType.BOUNCE_EASEOUT:e=t.easing(exports.cc.easeBounceOut());break;case ccs.FrameEaseType.BOUNCE_EASEINOUT:e=t.easing(exports.cc.easeBounceInOut());break}return e},setEasingParameter:function(t){this._Parameter=[];for(var e=0;e<t.length;e++)this._Parameter.push(t[e])},setEasingType:function(t){this.easingType=t}});ccs.ActionMoveFrame=ccs.ActionFrame.extend({_position:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._position=exports.cc.p(0,0),this.frameType=ccs.FRAME_TYPE_MOVE},setPosition:function(t,e){e===void 0?(this._position.x=t.x,this._position.y=t.y):(this._position.x=t,this._position.y=e)},getPosition:function(){return this._position},getAction:function(t){return this._getEasingAction(exports.cc.moveTo(t,this._position))}});ccs.ActionScaleFrame=ccs.ActionFrame.extend({_scaleX:1,_scaleY:1,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1,this.frameType=ccs.FRAME_TYPE_SCALE},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY},getAction:function(t){return this._getEasingAction(exports.cc.scaleTo(t,this._scaleX,this._scaleY))}});ccs.ActionRotationFrame=ccs.ActionFrame.extend({_rotation:0,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._rotation=0,this.frameType=ccs.FRAME_TYPE_ROTATE},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation},getAction:function(t,e){if(e===void 0)return this._getEasingAction(exports.cc.rotateTo(t,this._rotation));if(e instanceof exports.cc.ActionRotationFrame){var r=this._rotation-e._rotation;return this._getEasingAction(exports.cc.rotateBy(t,r))}else return this.getAction(t)}});ccs.ActionFadeFrame=ccs.ActionFrame.extend({_opacity:255,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._opacity=255,this.frameType=ccs.FRAME_TYPE_FADE},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},getAction:function(t){return this._getEasingAction(exports.cc.fadeTo(t,this._opacity))}});ccs.ActionTintFrame=ccs.ActionFrame.extend({_color:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this),this._color=exports.cc.color(255,255,255,255),this.frameType=ccs.FRAME_TYPE_TINT},setColor:function(t){var e=this._color;e.r=t.r,e.g=t.g,e.b=t.b},getColor:function(){var t=this._color;return exports.cc.color(t.r,t.g,t.b,t.a)},getAction:function(t){return this._getEasingAction(exports.cc.tintTo(t,this._color.r,this._color.g,this._color.b))}});ccs.actionManager={_actionDic:{},initWithDictionary:function(t,e,r){for(var n=t,s=n.lastIndexOf("/"),o=n.substr(s+1,n.length),a=e.actionlist,c=[],l=0;l<a.length;l++){var h=new ccs.ActionObject,u=a[l];h.initWithDictionary(u,r),c.push(h)}this._actionDic[o]=c},getActionByName:function(t,e){var r=t,n=r.lastIndexOf("/"),s=r.substr(n+1,r.length),o=this._actionDic[s];if(!o)return null;for(var a=0;a<o.length;a++){var c=o[a];if(e===c.getName())return c}return null},playActionByName:function(t,e,r){var n=this.getActionByName(t,e);n&&n.play(r)},stopActionByName:function(t,e){var r=this.getActionByName(t,e);r&&r.stop()},releaseActions:function(){this._actionDic={}},clear:function(){this._actionDic={}}};ccs.ActionNode=ccs.Class.extend({_currentFrameIndex:0,_destFrameIndex:0,_unitTime:0,_actionTag:0,_object:null,_actionSpawn:null,_action:null,_frameArray:null,_frameArrayNum:0,ctor:function(){this._currentFrameIndex=0,this._destFrameIndex=0,this._unitTime=.1,this._actionTag=0,this._object=null,this._actionSpawn=null,this._action=null,this._frameArray=[],this._frameArrayNum=ccs.FRAME_TYPE_MAX;for(var t=0;t<this._frameArrayNum;t++)this._frameArray.push([])},initWithDictionary:function(t,e){this.setActionTag(t.ActionTag);for(var r=t.actionframelist,n=ccui.helper.seekActionWidgetByActionTag(e,t.ActionTag),s=n instanceof ccui.Widget&&!(n instanceof ccui.Layout),o=0;o<r.length;o++){var a=r[o],c=a.frameid,l=a.tweenType;l==null&&(l=0);for(var h=a.tweenParameter,u=[],_=0;_<h;_++){var d=a.tweenParameter[_];u.push(d)}var f,T;if(a.positionx!==void 0){var x=a.positionx,m=a.positiony;if(s&&n.parent){var v=n.parent.getAnchorPointInPoints();x+=v.x,m+=v.y}f=new ccs.ActionMoveFrame,f.frameIndex=c,f.setEasingType(l),f.setEasingParameter(u),f.setPosition(x,m),T=this._frameArray[ccs.FRAME_TYPE_MOVE],T.push(f)}if(a.scalex!==void 0){var A=a.scalex,D=a.scaley;f=new ccs.ActionScaleFrame,f.frameIndex=c,f.setEasingType(l),f.setEasingParameter(u),f.setScaleX(A),f.setScaleY(D),T=this._frameArray[ccs.FRAME_TYPE_SCALE],T.push(f)}if(a.rotation!==void 0){var N=a.rotation;f=new ccs.ActionRotationFrame,f.frameIndex=c,f.setEasingType(l),f.setEasingParameter(u),f.setRotation(N),T=this._frameArray[ccs.FRAME_TYPE_ROTATE],T.push(f)}if(a.opacity!==void 0){var z=a.opacity;f=new ccs.ActionFadeFrame,f.frameIndex=c,f.setEasingType(l),f.setEasingParameter(u),f.setOpacity(z),T=this._frameArray[ccs.FRAME_TYPE_FADE],T.push(f)}if(a.colorr!==void 0){var M=a.colorr,J=a.colorg,U=a.colorb;f=new ccs.ActionTintFrame,f.frameIndex=c,f.setEasingType(l),f.setEasingParameter(u),f.setColor(exports.cc.color(M,J,U)),T=this._frameArray[ccs.FRAME_TYPE_TINT],T.push(f)}a=null}this._initActionNodeFromRoot(e)},_initActionNodeFromRoot:function(t){if(t instanceof ccui.Widget){var e=ccui.helper.seekActionWidgetByActionTag(t,this.getActionTag());e&&this.setObject(e)}},setUnitTime:function(t){this._unitTime=t,this._refreshActionProperty()},getUnitTime:function(){return this._unitTime},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setObject:function(t){this._object=t},getObject:function(){return this._object},getActionNode:function(){return this._object instanceof exports.cc.Node?this._object:null},insertFrame:function(t,e){if(e!=null){var r=e.frameType,n=this._frameArray[r];n.splice(t,0,e)}},addFrame:function(t){if(t){var e=t.frameType,r=this._frameArray[e];r.push(t)}},deleteFrame:function(t){if(t!=null){var e=t.frameType,r=this._frameArray[e];exports.cc.arrayRemoveObject(r,t)}},clearAllFrame:function(){for(var t=0;t<this._frameArrayNum;t++)this._frameArray[t].length=0},_refreshActionProperty:function(){if(this._object===null)return null;for(var t=[],e=0;e<this._frameArrayNum;e++){var r=this._frameArray[e];if(!(r.length<=0)){for(var n=[],s=0;s<r.length;s++){var o=r[s],a=null;if(s!==0){var c=r[s-1],l=(o.frameIndex-c.frameIndex)*this.getUnitTime();a=o.getAction(l)}else a=o.getAction(0);a&&n.push(a)}if(n){var h=exports.cc.sequence(n);h!==null&&t.push(h)}}}return this._action=null,this._actionSpawn=exports.cc.spawn(t),this._actionSpawn},playAction:function(t){this._object===null||this._actionSpawn===null||(t?this._action=exports.cc.sequence(this._actionSpawn,t):this._action=exports.cc.sequence(this._actionSpawn),this._runAction())},_runAction:function(){var t=this.getActionNode();t!==null&&this._action!==null&&t.runAction(this._action)},stopAction:function(){var t=this.getActionNode();t!==null&&this._action!==null&&(this._action.isDone()||t.stopAction(this._action))},getFirstFrameIndex:function(){for(var t=99999,e=!1,r=this._frameArray,n=0,s=this._frameArrayNum;n<s;n++){var o=r[n];if(!(o.length<=0)){e=!0;var a=o[0].frameIndex;t=t>a?a:t}}return e||(t=0),t},getLastFrameIndex:function(){for(var t=-1,e=!1,r=this._frameArray,n=0,s=this._frameArrayNum;n<s;n++){var o=r[n];if(!(o.length<=0)){e=!0;var a=o[o.length-1],c=a.frameIndex;t=t<c?c:t}}return e||(t=0),t},updateActionToTimeLine:function(t){for(var e=!1,r=this.getUnitTime(),n=0;n<this._frameArrayNum;n++){var s=this._frameArray[n];if(s!==null)for(var o=0;o<s.length;o++){var a=s[o];if(a.frameIndex*r===t){this._easingToFrame(1,1,a),e=!0;break}else if(a.frameIndex*r>t){if(o===0)this._easingToFrame(1,1,a),e=!1;else{var c=s[o-1],l=(a.frameIndex-c.frameIndex)*r,h=t-c.frameIndex*r;this._easingToFrame(l,1,c),this._easingToFrame(l,h/l,a),e=!0}break}}}return e},_easingToFrame:function(t,e,r){var n=r.getAction(t),s=this.getActionNode();n==null||s==null||(n.startWithTarget(s),n.update(e))},isActionDoneOnce:function(){return this._action===null?!0:this._action.isDone()}});ccs.ActionObject=ccs.Class.extend({_actionNodeList:null,_name:"",_loop:!1,_pause:!1,_playing:!1,_unitTime:0,_currentTime:0,_scheduler:null,_callback:null,_fTotalTime:0,ctor:function(){this._actionNodeList=[],this._name="",this._loop=!1,this._pause=!1,this._playing=!1,this._unitTime=.1,this._currentTime=0,this._fTotalTime=0,this._scheduler=exports.cc.director.getScheduler()},setName:function(t){this._name=t},getName:function(){return this._name},setLoop:function(t){this._loop=t},getLoop:function(){return this._loop},setUnitTime:function(t){this._unitTime=t;for(var e=this._actionNodeList.length,r=0;r<e;r++){var n=this._actionNodeList[r];n.setUnitTime(this._unitTime)}},getUnitTime:function(){return this._unitTime},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(t){this._currentTime=t},getTotalTime:function(){return this._fTotalTime},isPlaying:function(){return this._playing},initWithDictionary:function(t,e){this.setName(t.name),this.setLoop(t.loop),this.setUnitTime(t.unittime);for(var r=t.actionnodelist,n=0,s=0;s<r.length;s++){var o=new ccs.ActionNode,a=r[s];o.initWithDictionary(a,e),o.setUnitTime(this.getUnitTime()),this._actionNodeList.push(o);var c=o.getLastFrameIndex()-o.getFirstFrameIndex();c>n&&(n=c)}this._fTotalTime=n*this._unitTime},addActionNode:function(t){t&&(this._actionNodeList.push(t),t.setUnitTime(this._unitTime))},removeActionNode:function(t){t!=null&&exports.cc.arrayRemoveObject(this._actionNodeList,t)},play:function(t){this.stop(),this.updateToFrameByTime(0);for(var e=this._actionNodeList,r=e.length,n=0;n<r;n++)e[n].playAction(t);this._loop&&this._scheduler.schedule(this.simulationActionUpdate,this,0,exports.cc.REPEAT_FOREVER,0,!1,this.__instanceId+""),t!==void 0&&(this._callback=t)},pause:function(){this._pause=!0,this._playing=!1},stop:function(){for(var t=this._actionNodeList,e=0;e<t.length;e++)t[e].stopAction();this._scheduler.unschedule(this.simulationActionUpdate,this),this._pause=!1,this._playing=!1},updateToFrameByTime:function(t){this._currentTime=t;for(var e=0;e<this._actionNodeList.length;e++){var r=this._actionNodeList[e];r.updateActionToTimeLine(t)}},simulationActionUpdate:function(t){for(var e=!0,r=this._actionNodeList,n=0,s=r.length;n<s;n++)if(!r[n].isActionDoneOnce()){e=!1;break}e&&(this._callback!==null&&this._callback.execute(),this._loop?this.play():(this._playing=!1,this._scheduler.unschedule(this.simulationActionUpdate,this)))}});ccs.ComAttribute=ccs.Component.extend({_jsonDict:null,_filePath:"",ctor:function(){exports.cc.Component.prototype.ctor.call(this),this._jsonDict={},this._filePath="",this._name="CCComAttribute",ccs.ComAttribute.prototype.init.call(this)},init:function(){return this._jsonDict={},!0},setInt:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setDouble:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setFloat:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setBool:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setString:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},setObject:function(t,e){if(!t){exports.cc.log("Argument must be non-nil");return}this._jsonDict[t]=e},getInt:function(t){var e=this._jsonDict[t];return parseInt(e||0)},getDouble:function(t){var e=this._jsonDict[t];return parseFloat(e||0)},getFloat:function(t){var e=this._jsonDict[t];return parseFloat(e||0)},getBool:function(t){var e=this._jsonDict[t];return!!e},getString:function(t){var e=this._jsonDict[t];return e||""},getObject:function(t){return this._jsonDict[t]},parse:function(t){this._jsonDict=exports.cc.loader.getRes(t)}});ccs.ComAttribute.create=function(){return new ccs.ComAttribute};ccs.ComAudio=ccs.Component.extend({_filePath:"",_loop:!1,ctor:function(){exports.cc.Component.prototype.ctor.call(this),this._name="Audio",ccs.ComAudio.prototype.init.call(this)},init:function(){return!0},onExit:function(){this.stopBackgroundMusic(!0),this.stopAllEffects()},end:function(){exports.cc.audioEngine.end()},preloadBackgroundMusic:function(t){exports.cc.loader.load(t)},playBackgroundMusic:function(t,e){t?exports.cc.audioEngine.playMusic(t,e):exports.cc.audioEngine.playMusic(this._filePath,this._loop)},stopBackgroundMusic:function(t){exports.cc.audioEngine.stopMusic(t)},pauseBackgroundMusic:function(){exports.cc.audioEngine.pauseMusic()},resumeBackgroundMusic:function(){exports.cc.audioEngine.resumeMusic()},rewindBackgroundMusic:function(){exports.cc.audioEngine.rewindMusic()},willPlayBackgroundMusic:function(){return exports.cc.audioEngine.willPlayMusic()},isBackgroundMusicPlaying:function(){return exports.cc.audioEngine.isMusicPlaying()},getBackgroundMusicVolume:function(){return exports.cc.audioEngine.getMusicVolume()},setBackgroundMusicVolume:function(t){exports.cc.audioEngine.setMusicVolume(t)},getEffectsVolume:function(){return exports.cc.audioEngine.getEffectsVolume()},setEffectsVolume:function(t){exports.cc.audioEngine.setEffectsVolume(t)},playEffect:function(t,e){return t?exports.cc.audioEngine.playEffect(t,e):exports.cc.audioEngine.playEffect(this._filePath,this._loop)},pauseEffect:function(t){exports.cc.audioEngine.pauseEffect(t)},pauseAllEffects:function(){exports.cc.audioEngine.pauseAllEffects()},resumeEffect:function(t){exports.cc.audioEngine.resumeEffect(t)},resumeAllEffects:function(){exports.cc.audioEngine.resumeAllEffects()},stopEffect:function(t){exports.cc.audioEngine.stopEffect(t)},stopAllEffects:function(){exports.cc.audioEngine.stopAllEffects()},preloadEffect:function(t){exports.cc.loader.getRes(t),this.setFile(t),this.setLoop(!1)},unloadEffect:function(t){exports.cc.audioEngine.unloadEffect(t)},setFile:function(t){this._filePath=t},setLoop:function(t){this._loop=t},getFile:function(){return this._filePath},isLoop:function(){return this._loop}});ccs.ComAudio.create=function(){return new ccs.ComAudio};ccs.ComController=ccs.Component.extend({ctor:function(){exports.cc.Component.prototype.ctor.call(this),this._name="ComController",ccs.ComController.prototype.init.call(this)},onEnter:function(){this._owner!==null&&this._owner.scheduleUpdate()},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t}});ccs.ComController.create=function(){return new ccs.ComController};ccs.ComRender=ccs.Component.extend({_render:null,ctor:function(t,e){exports.cc.Component.prototype.ctor.call(this),this._render=t,this._name=e,this.isRenderer=!0,ccs.ComRender.prototype.init.call(this)},onEnter:function(){this._owner&&this._owner.addChild(this._render)},onExit:function(){this._owner&&(this._owner.removeChild(this._render,!0),this._render=null)},getNode:function(){return this._render},setNode:function(t){this._render=t}});ccs.ComRender.create=function(t,e){return new ccs.ComRender(t,e)};ccs.objectFactory={_typeMap:{},createObject:function(t){var e=null,r=this._typeMap[t];return r&&(exports.cc.isFunction(r._fun)?e=new r._fun:e=r._fun),e},registerType:function(t){this._typeMap[t._className]=t},createGUI:function(t){var e=null;t==="Panel"?t="Layout":t==="TextArea"?t="Label":t==="TextButton"&&(t="Button");var r=this._typeMap[t];return r&&r._fun&&(e=r._fun),e},removeAll:function(){this._typeMap={}}};ccs.TInfo=ccs.Class.extend({_className:"",_fun:null,ctor:function(t,e){e?(this._className=t,this._fun=e):(this._className=t._className,this._fun=t._fun),ccs.objectFactory.registerType(this)}});ccs.sendEvent=function(t){var e=ccs.triggerManager.get(t);if(e!=null)for(var r=0;r<e.length;r++){var n=e[r];n!=null&&n.detect()&&n.done()}};ccs.registerTriggerClass=function(t,e){new ccs.TInfo(t,e)};ccs.triggerManager={_eventTriggers:{},_triggerObjs:{},_movementDispatches:[],parse:function(t){for(var e=0;e<t.length;++e){var r=t[e],n=new ccs.TriggerObj;n.serialize(r);for(var s=n.getEvents(),o=0;o<s.length;o++){var a=s[o];this.add(a,n)}this._triggerObjs[n.getId()]=n}},get:function(t){return this._eventTriggers[t]},getTriggerObj:function(t){return this._triggerObjs[t]},add:function(t,e){var r=this._eventTriggers[t];r||(r=[]),r.indexOf(e)===-1&&(r.push(e),this._eventTriggers[t]=r)},removeAll:function(){for(var t in this._eventTriggers)for(var e=this._eventTriggers[t],r=0;r<e.length;r++){var n=e[r];n.removeAll()}this._eventTriggers={}},remove:function(t,e){if(e)return this._removeObj(t,e);var r=!1;do{var n=this._eventTriggers[t];if(!n)break;for(var s=0;s<n.length;s++){var o=n[s];o&&o.removeAll()}delete this._eventTriggers[t],r=!0}while(0);return r},_removeObj:function(t,e){var r=!1;do{var n=this._eventTriggers[t];if(!n)break;for(var s=0;s<n.length;s++){var o=n[s];if(o&&o==e){o.removeAll(),n.splice(s,1);break}}r=!0}while(0);return r},removeTriggerObj:function(t){var e=this.getTriggerObj(t);if(!e)return!1;for(var r=e.getEvents(),n=0;n<r.length;n++){var s=r[n];this.remove(s,e)}return!0},isEmpty:function(){return!this._eventTriggers||this._eventTriggers.length<=0},addArmatureMovementCallBack:function(t,e,r){if(!(t==null||r==null||e==null)){for(var n,s=!1,o=0;o<this._movementDispatches.length;o++)n=this._movementDispatches[o],n&&n[0]===t&&(n.addAnimationEventCallBack(e,r),s=!0);if(!s){var a=new ccs.ArmatureMovementDispatcher;t.getAnimation().setMovementEventCallFunc(a.animationEvent,a),a.addAnimationEventCallBack(e,r),this._movementDispatches.push([t,a])}}},removeArmatureMovementCallBack:function(t,e,r){if(!(t==null||e==null||r==null))for(var n,s=0;s<this._movementDispatches.length;s++)n=this._movementDispatches[s],n&&n[0]===t&&n.removeAnimationEventCallBack(r,e)},removeArmatureAllMovementCallBack:function(t){if(t!=null){for(var e,r=0;r<this._movementDispatches.length;r++)if(e=this._movementDispatches[r],e&&e[0]===t){this._movementDispatches.splice(r,1);break}}},removeAllArmatureMovementCallBack:function(){this._movementDispatches.length=0},version:function(){return"1.2.0.0"}};ccs.ArmatureMovementDispatcher=ccs.Class.extend({_mapEventAnimation:null,ctor:function(){this._mapEventAnimation=[]},animationEvent:function(t,e,r){for(var n,s,o,a=0;a<this._mapEventAnimation.length;a++)n=this._mapEventAnimation[a],s=n[0],o=n[1],o&&o.call(s,t,e,r)},addAnimationEventCallBack:function(t,e){this._mapEventAnimation.push([e,t])},removeAnimationEventCallBack:function(t,e){for(var r,n=0;n<this._mapEventAnimation.length;n++)r=this._mapEventAnimation[n],r[0]===e&&this._mapEventAnimation.splice(n,1)}});ccs.BaseTriggerCondition=ccs.Class.extend({ctor:function(){},init:function(){return!0},detect:function(){return!0},serialize:function(t){},removeAll:function(){}});ccs.BaseTriggerAction=ccs.Class.extend({ctor:function(){},init:function(){return!0},done:function(){},serialize:function(t){},removeAll:function(){}});ccs.TriggerObj=ccs.Class.extend({_cons:null,_acts:null,_id:0,_enable:!0,_vInt:null,ctor:function(){this._id=0,this._enable=!0,ccs.TriggerObj.prototype.init.call(this)},init:function(){return this._cons=[],this._acts=[],this._vInt=[],!0},detect:function(){if(!this._enable||this._cons.length===0)return!0;for(var t=!0,e=null,r=0;r<this._cons.length;r++)e=this._cons[r],e&&e.detect&&(t=t&&e.detect());return t},done:function(){if(!(!this._enable||this._acts.length===0))for(var t,e=0;e<this._acts.length;e++)t=this._acts[e],t&&t.done&&t.done()},removeAll:function(){for(var t=null,e=0;e<this._cons.length;e++)t=this._cons[e],t&&t.removeAll();this._cons=[];for(var e=0;e<this._acts.length;e++)t=this._acts[e],t&&t.removeAll();this._acts=[]},serialize:function(t){this._id=t.id||0;for(var e=t.conditions||[],r=0;r<e.length;r++){var n=e[r],s=n.classname,o=ccs.objectFactory.createObject(s);if(!o){exports.cc.log("class named classname("+s+") can not implement!");continue}o.serialize(n),o.init(),this._cons.push(o)}for(var a=t.actions||[],r=0;r<a.length;r++){var n=a[r],s=n.classname,c=ccs.objectFactory.createObject(s);if(!c){exports.cc.log("class named classname("+s+") can not implement!");continue}c.serialize(n),c.init(),this._acts.push(c)}for(var l=t.events||[],r=0;r<l.length;r++){var n=l[r],h=n.id;h<0||this._vInt.push(h)}},getId:function(){return this._id},setEnable:function(t){this._enable=t},getEvents:function(){return this._vInt}});ccs.TriggerObj.create=function(){return new ccs.TriggerObj};ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(t){this._init(t)},_init:function(t){return this._actionTag=t,!0},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag}});ccs.AnimationInfo=function(t,e,r){this.name=t,this.startIndex=e,this.endIndex=r};ccs.ComExtensionData=ccs.Component.extend({_customProperty:null,_timelineData:null,_name:"ComExtensionData",ctor:function(){return this._customProperty="",this._timelineData=new ccs.ActionTimelineData(0),!0},setActionTag:function(t){this._timelineData.setActionTag(t)},getActionTag:function(){return this._timelineData.getActionTag()},setCustomProperty:function(t){this._customProperty=t},getCustomProperty:function(){return this._customProperty}});ccs.ComExtensionData.create=function(){return new ccs.ComExtensionData};ccs.ActionTimelineData.create=function(t){return new ccs.ActionTimelineData(t)};ccs.ActionTimeline=exports.cc.Action.extend({_timelineMap:null,_timelineList:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:!1,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){exports.cc.Action.prototype.ctor.call(this),this._timelineMap={},this._timelineList=[],this._animationInfos={},this.init()},_gotoFrame:function(t){for(var e=this._timelineList.length,r=0;r<e;r++)this._timelineList[r]._gotoFrame(t)},_stepToFrame:function(t){for(var e=this._timelineList.length,r=0;r<e;r++)this._timelineList[r]._stepToFrame(t)},_emitFrameEvent:function(t){this._frameEventListener&&this._frameEventListener(t)},init:function(){return!0},gotoFrameAndPlay:function(t,e,r,n){var s=0,o=arguments.length,a=[],c;for(s;s<o;s++)typeof arguments[s]=="boolean"?c=arguments[s]:a.push(arguments[s]);t=a[0],e=a[1]!==void 0?a[1]:this._duration,r=a[2]||t,n=c!=null?c:!0,this._startFrame=t,this._endFrame=e,this._currentFrame=r,this._loop=n,this._time=this._currentFrame*this._frameInternal,this.resume(),this._gotoFrame(this._currentFrame)},gotoFrameAndPause:function(t){this._startFrame=this._currentFrame=t,this._time=this._currentFrame*this._frameInternal,this.pause(),this._gotoFrame(this._currentFrame)},pause:function(){this._playing=!1},resume:function(){this._playing=!0},isPlaying:function(){return this._playing},setTimeSpeed:function(t){this._timeSpeed=t},getTimeSpeed:function(){return this._timeSpeed},setDuration:function(t){this._duration=t},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(t){t>=this._startFrame&&t<=this._endFrame?(this._currentFrame=t,this._time=this._currentFrame*this._frameInternal):exports.cc.log("frame index is not between start frame and end frame")},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(t){var e=t.getActionTag();this._timelineMap[e]||(this._timelineMap[e]=[]),this._timelineMap[e].indexOf(t)===-1&&(this._timelineList.push(t),this._timelineMap[e].push(t),t.setActionTimeline(this))},removeTimeline:function(t){var e=t.getActionTag();this._timelineMap[e]&&this._timelineMap[e].some(function(r){if(r===t)return!0})&&(exports.cc.arrayRemoveObject(this._timelineMap[e],t),exports.cc.arrayRemoveObject(this._timelineList,t),t.setActionTimeline(null))},getTimelines:function(){return this._timelineList},setFrameEventCallFunc:function(t){this._frameEventListener=t},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var t=new ccs.ActionTimeline;t.setDuration(this._duration),t.setTimeSpeed(this._timeSpeed);for(var e in this._timelineMap){var r=this._timelineMap[e];for(var n in r){var s=r[n],o=s.clone();t.addTimeline(o)}}return t},reverse:function(){return null},step:function(t){if(!(!this._playing||this._timelineMap.length===0||this._duration===0)){this._time+=t*this._timeSpeed;var e=this._time-this._endFrame*this._frameInternal;e<this._frameInternal?(this._currentFrame=Math.floor(this._time/this._frameInternal),this._stepToFrame(this._currentFrame),e>=0&&this._lastFrameListener&&this._lastFrameListener()):(this._playing=this._loop,this._playing?this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop):(this._time=this._endFrame*this._frameInternal,this._currentFrame!=this._endFrame&&(this._currentFrame=this._endFrame,this._stepToFrame(this._currentFrame),this._lastFrameListener&&this._lastFrameListener())))}},_foreachNodeDescendant:function(t,e){e(t);for(var r=t.getChildren(),n=0;n<r.length;n++){var s=r[n];this._foreachNodeDescendant(s,e)}},startWithTarget:function(t){exports.cc.Action.prototype.startWithTarget.call(this,t);var e=this||window,r=function(n){var s=n.getComponent("ComExtensionData");if(s){var o=s.getActionTag();if(e._timelineMap[o])for(var a=e._timelineMap[o],c=0;c<a.length;c++){var l=a[c];l.setNode(n)}}};this._foreachNodeDescendant(t,r)},isDone:function(){return!1},play:function(t,e){var r=this._animationInfos[t];if(!r)return exports.cc.log("Can't find animation info for %s",t);this.gotoFrameAndPlay(r.startIndex,r.endIndex,e)},addAnimationInfo:function(t){this._animationInfos[t.name]=t},removeAnimationInfo:function(t){delete this._animationInfos[t]},isAnimationInfoExists:function(t){return this._animationInfos[t]},getAnimationInfo:function(t){return this._animationInfos[t]},setLastFrameCallFunc:function(t){this._lastFrameListener=t},clearLastFrameCallFunc:function(){this._lastFrameListener=null}});ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline};ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0,this._tween=!0,this._timeline=null,this._node=null,this._enterWhenPassed=!1,this._easingParam=[]},_emitEvent:function(){this._timeline&&this._timeline.getActionTimeline()._emitFrameEvent(this)},_cloneProperty:function(t){this._frameIndex=t.getFrameIndex(),this._tween=t.isTween(),this._tweenType=t.getTweenType(),this.setEasingParams(t.getEasingParams())},setFrameIndex:function(t){this._frameIndex=t},getFrameIndex:function(){return this._frameIndex},setTimeline:function(t){this._timeline=t},getTimeline:function(t){return this._timeline},setNode:function(t){this._node=t},getNode:function(){return this._node},setTween:function(t){this._tween=t},isTween:function(){return this._tween},onEnter:function(t){},apply:function(t){this._tween&&(this._tweenType!==ccs.FrameEaseType.TWEEN_EASING_MAX&&this._tweenType!==ccs.FrameEaseType.LINEAR&&(t=this.tweenPercent(t)),this._onApply(t))},_onApply:function(t){},clone:function(){},tweenPercent:function(t){var e=ccs.Frame.tweenToMap[this._tweenType];return e?e(t,this._easingParam):t},setEasingParams:function(t){if(t){this._easingParam.length=0;for(var e=0;e<t.length;e++)this._easingParam[e]=t[e]}},getEasingParams:function(){return this._easingParam},setTweenType:function(t){this._tweenType=t},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}});ccs.Frame.tweenToMap={"-1":function(t,e){if(e){var r=1-t;return e[1]*r*r*r+3*e[3]*t*r*r+3*e[5]*t*t*r+e[7]*t*t*t}return t},1:exports.cc._easeSineInObj.easing,2:exports.cc._easeSineOutObj.easing,3:exports.cc._easeSineInOutObj.easing,4:exports.cc._easeQuadraticActionIn.easing,5:exports.cc._easeQuadraticActionOut.easing,6:exports.cc._easeQuadraticActionInOut.easing,7:exports.cc._easeCubicActionIn.easing,8:exports.cc._easeCubicActionOut.easing,9:exports.cc._easeCubicActionInOut.easing,10:exports.cc._easeCubicActionIn.easing,11:exports.cc._easeCubicActionOut.easing,12:exports.cc._easeCubicActionInOut.easing,13:exports.cc._easeQuinticActionIn.easing,14:exports.cc._easeQuinticActionOut.easing,15:exports.cc._easeQuinticActionInOut.easing,16:exports.cc._easeExponentialInObj.easing,17:exports.cc._easeExponentialOutObj.easing,18:exports.cc._easeExponentialInOutObj.easing,19:exports.cc._easeCircleActionIn.easing,20:exports.cc._easeCircleActionOut.easing,21:exports.cc._easeCircleActionInOut.easing,22:function(t,e){var r=.3;return e!=null&&(r=e[0]),exports.cc.easeElasticIn(r).easing(t)},23:function(t,e){var r=.3;return e!=null&&(r=e[0]),exports.cc.easeElasticOut(r).easing(t)},24:function(t,e){var r=.3;return e!=null&&(r=e[0]),exports.cc.easeElasticInOut(r).easing(t)},25:exports.cc._easeBackInObj.easing,26:exports.cc._easeBackOutObj.easing,27:exports.cc._easeBackInOutObj.easing,28:exports.cc._easeBounceInObj.easing,29:exports.cc._easeBounceOutObj.easing,30:exports.cc._easeBounceInOutObj.easing};ccs.VisibleFrame=ccs.Frame.extend({_visible:!0,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._visible=!0},onEnter:function(t){this._node&&this._node.setVisible(this._visible)},clone:function(){var t=new ccs.VisibleFrame;return t.setVisible(this._visible),t._cloneProperty(this),t},setVisible:function(t){this._visible=t},isVisible:function(){return this._visible}});ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame};ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._textureName=""},setNode:function(t){ccs.Frame.prototype.setNode.call(this,t),this._sprite=t},onEnter:function(t){if(this._sprite){var e=this._sprite.getBlendFunc(),r=exports.cc.spriteFrameCache._spriteFrames[this._textureName];r!=null?this._sprite.setSpriteFrame(r):this._sprite.setTexture(this._textureName),this._sprite.getBlendFunc()!==e&&this._sprite.setBlendFunc(e)}},clone:function(){var t=new ccs.TextureFrame;return t.setTextureName(this._textureName),t._cloneProperty(this),t},setTextureName:function(t){this._textureName=t},getTextureName:function(){return this._textureName}});ccs.TextureFrame.create=function(){return new ccs.TextureFrame};ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._rotation=0},onEnter:function(t){this._node&&(this._node.setRotation(this._rotation),this._tween&&(this._betwennRotation=t._rotation-this._rotation))},_onApply:function(t){if(this._betwennRotation!==0){var e=this._rotation+t*this._betwennRotation;this._node.setRotation(e)}},clone:function(){var t=new ccs.RotationFrame;return t.setRotation(this._rotation),t._cloneProperty(this),t},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation}});ccs.RotationFrame.create=function(){return new ccs.RotationFrame};ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._skewX=0,this._skewY=0},onEnter:function(t){this._node&&(this._node.setSkewX(this._skewX),this._node.setSkewY(this._skewY),this._tween&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY))},_onApply:function(t){if(this._betweenSkewX!==0||this._betweenSkewY!==0){var e=this._skewX+t*this._betweenSkewX,r=this._skewY+t*this._betweenSkewY;this._node.setSkewX(e),this._node.setSkewY(r)}},clone:function(){var t=new ccs.SkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t._cloneProperty(this),t},setSkewX:function(t){this._skewX=t},getSkewX:function(){return this._skewX},setSkewY:function(t){this._skewY=t},getSkewY:function(){return this._skewY}});ccs.SkewFrame.create=function(){return new ccs.SkewFrame};ccs.RotationSkewFrame=ccs.SkewFrame.extend({onEnter:function(t){this._node&&(this._node.setRotationX(this._skewX),this._node.setRotationY(this._skewY),this._tween&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY))},_onApply:function(t){if(this._node&&(this._betweenSkewX!==0||this._betweenSkewY!==0)){var e=this._skewX+t*this._betweenSkewX,r=this._skewY+t*this._betweenSkewY;this._node.setRotationX(e),this._node.setRotationY(r)}},clone:function(){var t=new ccs.RotationSkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t._cloneProperty(this),t}});ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame};ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._position=exports.cc.p(0,0)},onEnter:function(t){this._node&&(this._node.setPosition(this._position),this._tween&&(this._betweenX=t._position.x-this._position.x,this._betweenY=t._position.y-this._position.y))},_onApply:function(t){if(this._node&&(this._betweenX!==0||this._betweenY!==0)){var e=exports.cc.p(0,0);e.x=this._position.x+this._betweenX*t,e.y=this._position.y+this._betweenY*t,this._node.setPosition(e)}},clone:function(){var t=new ccs.PositionFrame;return t.setPosition(this._position),t._cloneProperty(this),t},setPosition:function(t){this._position=t},getPosition:function(){return this._position},setX:function(t){this._position.x=t},getX:function(){return this._position.x},setY:function(t){this._position.y=t},getY:function(){return this._position.y}});ccs.PositionFrame.create=function(){return new ccs.PositionFrame};ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1},onEnter:function(t){this._node&&(this._node.setScaleX(this._scaleX),this._node.setScaleY(this._scaleY),this._tween&&(this._betweenScaleX=t._scaleX-this._scaleX,this._betweenScaleY=t._scaleY-this._scaleY))},_onApply:function(t){if(this._node&&(this._betweenScaleX!==0||this._betweenScaleY!==0)){var e=this._scaleX+this._betweenScaleX*t,r=this._scaleY+this._betweenScaleY*t;this._node.setScaleX(e),this._node.setScaleY(r)}},clone:function(){var t=new ccs.ScaleFrame;return t.setScaleX(this._scaleX),t.setScaleY(this._scaleY),t._cloneProperty(this),t},setScale:function(t){this._scaleX=t,this._scaleY=t},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY}});ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame};ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._anchorPoint=exports.cc.p(0,0)},onEnter:function(t){this._node&&this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var t=new ccs.AnchorPointFrame;return t.setAnchorPoint(this._anchorPoint),t._cloneProperty(this),t},setAnchorPoint:function(t){this._anchorPoint=t},getAnchorPoint:function(){return this._anchorPoint}});ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame};ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2};ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this),this._enterWithName=!1,this._innerActionType=ccs.InnerActionType.LoopAction,this._startFrameIndex=0},onEnter:function(t){if(this._node){var e=this._node.getActionByTag(this._node.getTag());if(e){if(ccs.InnerActionType.SingleFrame===this._innerActionType){e.gotoFrameAndPause(this._singleFrameIndex);return}var r=this._startFrameIndex,n=this._endFrameIndex;if(this._enterWithName)if(this._animationName==="-- ALL --")r=0,n=e.getDuration();else if(e.isAnimationInfoExists(this._animationName)){var s=e.getAnimationInfo(this._animationName);r=s.startIndex,n=s.endIndex}else exports.cc.log("Animation %s not exists!",this._animationName);var o=this._timeline.getActionTimeline().getDuration(),a=o-this._frameIndex-n+r;a<0&&(n+=a),ccs.InnerActionType.NoLoopAction===this._innerActionType?e.gotoFrameAndPlay(r,n,!1):ccs.InnerActionType.LoopAction===this._innerActionType&&e.gotoFrameAndPlay(r,n,!0)}}},setAnimationName:function(t){this._animationName=t},setSingleFrameIndex:function(t){this._singleFrameIndex=t},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(t){this._enterWithName=t},getEnterWithName:function(){return this._enterWithName},clone:function(){var t=new ccs.InnerActionFrame;return t.setInnerActionType(this._innerActionType),t.setStartFrameIndex(this._startFrameIndex),t.setEnterWithName(this._enterWithName),t.setAnimationName(this._animationName),t.setSingleFrameIndex(this._singleFrameIndex),t._cloneProperty(this),t},setInnerActionType:function(t){this._innerActionType=t},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(t){this._startFrameIndex=t},getStartFrameIndex:function(){return this._startFrameIndex}});ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame};ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._color=exports.cc.color(255,255,255)},onEnter:function(t){if(this._node&&(this._node.setColor(this._color),this._tween)){var e=t._color;this._betweenRed=e.r-this._color.r,this._betweenGreen=e.g-this._color.g,this._betweenBlue=e.b-this._color.b}},_onApply:function(t){if(this._node&&this._tween&&(this._betweenAlpha!==0||this._betweenRed!==0||this._betweenGreen!==0||this._betweenBlue!==0)){var e=exports.cc.color(255,255,255);if(e.r=this._color.r+this._betweenRed*t,e.g=this._color.g+this._betweenGreen*t,e.b=this._color.b+this._betweenBlue*t,this._node.setColor(e),this._alpha!==null){var r=this._alpha+this._betweenAlpha*t;this._node.setOpacity(r)}}},clone:function(){var t=new ccs.ColorFrame;return t.setColor(this._color),t._cloneProperty(this),t},setColor:function(t){this._color=t},getColor:function(){return this._color}});ccs.ColorFrame.create=function(){return new ccs.ColorFrame};ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._alpha=255},onEnter:function(t){this._node&&(this._node.setOpacity(this._alpha),this._tween&&(this._betweenAlpha=t._alpha-this._alpha))},_onApply:function(t){if(this._node){var e=this._alpha+this._betweenAlpha*t;this._node.setOpacity(e)}},setAlpha:function(t){this._alpha=t},getAlpha:function(){return this._alpha},clone:function(){var t=new ccs.AlphaFrame;return t.setAlpha(this._alpha),t._cloneProperty(this),t}});ccs.EventFrame=ccs.Frame.extend({_event:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._event="",this._enterWhenPassed=!0},onEnter:function(t){this._emitEvent()},clone:function(){var t=new ccs.EventFrame;return t.setEvent(this._event),t._cloneProperty(this),t},setEvent:function(t){this._event=t},getEvent:function(){return this._event}});ccs.EventFrame.create=function(){return new ccs.EventFrame};ccs.ZOrderFrame=ccs.Frame.extend({_zorder:0,onEnter:function(t){this._node&&this._node.setLocalZOrder(this._zorder)},clone:function(){var t=new ccs.ZOrderFrame;return t.setZOrder(this._zorder),t._cloneProperty(this),t},setZOrder:function(t){this._zorder=t},getZOrder:function(){return this._zorder}});ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame};ccs.BlendFuncFrame=ccs.Frame.extend({ctor:function(){this._super(),this._blendFunc=null},onEnter:function(t,e){this._node&&this._blendFunc&&this._node.setBlendFunc(this._blendFunc)},clone:function(){var t=new ccs.BlendFuncFrame;return t.setBlendFunc(this._blendFunc),t._cloneProperty(this),t},setBlendFunc:function(t){t&&t.src&&t.dst&&(this._blendFunc=t)},getBlendFunc:function(){return this._blendFunc}});ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame};ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[],this._currentKeyFrame=null,this._currentKeyFrameIndex=0,this._fromIndex=0,this._toIndex=0,this._betweenDuration=0,this._actionTag=0,this._ActionTimeline=null,this._node=null},_gotoFrame:function(t){this._frames.length!==0&&(this._binarySearchKeyFrame(t),this._apply(t))},_stepToFrame:function(t){this._frames.length!==0&&(this._updateCurrentKeyFrame(t),this._apply(t))},getFrames:function(){return this._frames},addFrame:function(t){this._frames.push(t),t.setTimeline(this)},insertFrame:function(t,e){this._frames.splice(e,0,t),t.setTimeline(this)},removeFrame:function(t){exports.cc.arrayRemoveObject(this._frames,t),t.setTimeline(null)},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setNode:function(t){for(var e=0;e<this._frames.length;e++){var r=this._frames[e];r.setNode(t)}},getNode:function(){return this._node},setActionTimeline:function(t){this._ActionTimeline=t},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var t=new ccs.Timeline;t._actionTag=this._actionTag;for(var e=0;e<this._frames.length;e++){var r=this._frames[e],n=r.clone();t.addFrame(n)}return t},_apply:function(t){if(this._currentKeyFrame){var e=this._betweenDuration<=0?0:(t-this._currentKeyFrameIndex)/this._betweenDuration;this._currentKeyFrame.apply(e)}},_binarySearchKeyFrame:function(t){var e=null,r=null,n=this._frames.length,s=!1;do{if(t<this._frames[0].getFrameIndex()){this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(s=!0),this._fromIndex=0,this._toIndex=0,e=r=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}else if(t>=this._frames[n-1].getFrameIndex()){this._fromIndex=n-1,this._toIndex=0,e=r=this._frames[n-1],this._currentKeyFrameIndex=this._frames[n-1].getFrameIndex(),this._betweenDuration=0;break}for(var o=-1,a=0,c=n-1,l=0;a<=c;){if(l=Math.ceil((a+c)/2),t>=this._frames[l].getFrameIndex()&&t<this._frames[l+1].getFrameIndex()){o=l;break}this._frames[l].getFrameIndex()>t?c=l-1:a=l+1}this._fromIndex=o,n>1?this._toIndex=o+1|0:this._toIndex=o|0,e=this._frames[this._fromIndex],r=this._frames[this._toIndex],e=this._frames[o],r=this._frames[o+1],o===0&&this._currentKeyFrameIndex<e.getFrameIndex()&&(s=!0),this._currentKeyFrameIndex=e.getFrameIndex(),this._betweenDuration=r.getFrameIndex()-e.getFrameIndex()}while(0);(s||this._currentKeyFrame!=e)&&(this._currentKeyFrame=e,this._currentKeyFrame.onEnter(r))},_updateCurrentKeyFrame:function(t){if(t<this._currentKeyFrameIndex||t>=this._currentKeyFrameIndex+this._betweenDuration){var e=null,r=null;do{var n=this._frames.length;if(t<this._frames[0].getFrameIndex()){e=r=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}else if(t>=this._frames[n-1].getFrameIndex()){var s=this._frames[n-1].getFrameIndex();if(this._currentKeyFrameIndex>=s)return;t=s}do{if(this._fromIndex=this._toIndex,e=this._frames[this._fromIndex],this._currentKeyFrameIndex=e.getFrameIndex(),this._toIndex=this._fromIndex+1,this._toIndex>=n&&(this._toIndex=0),r=this._frames[this._toIndex],t===e.getFrameIndex()||t>e.getFrameIndex()&&t<r.getFrameIndex())break;e.isEnterWhenPassed()&&e.onEnter(r)}while(!0);this._betweenDuration=r.getFrameIndex()-e.getFrameIndex()}while(0);this._currentKeyFrame=e,this._currentKeyFrame.onEnter(r)}}});ccs.Timeline.create=function(){return new ccs.Timeline};ccs.SkinNode=function(){var t=exports.cc.Node,e={},r=t.extend(e);return r.create=function(){},r}();ccs.BoneNode=function(){var t=exports.cc.Node,e=ccs.SkinNode,r=exports.cc.BlendFunc,n={p:exports.cc.p,size:exports.cc.size,rect:exports.cc.rect},s={log:exports.cc.log,assert:exports.cc.assert},o=t.extend({_customCommand:null,_blendFunc:null,_rackColor:null,_rackLength:null,_rackWidth:null,_childBones:null,_boneSkins:null,_rootSkeleton:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,ctor:function(l){t.prototype.ctor.call(this),this._squareVertices===null&&(this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]),this._rackColor=exports.cc.color.WHITE,this._blendFunc=r.ALPHA_NON_PREMULTIPLIED,this._childBones=[],this._boneSkins=[],this._rackLength=l===void 0?50:l,this._rackWidth=20,this._updateVertices()},addSkin:function(l,h,u){var _=this._boneSkins;if(s.assert(l!=null,"Argument must be non-nil"),u)for(var d=0;d<_.length;d++)_[d].setVisible(!1);t.prototype.addChild.call(this,l),this._boneSkins.push(l),l.setVisible(h)},getChildBones:function(){return this._childBones},getSkins:function(){return this._boneSkins},displaySkin:function(l,h){var u=this._boneSkins,_,d;if(typeof l=="string")for(d=0;d<u.length;d++)_=u[d],l==_.getName()?_.setVisible(!0):h&&_.setVisible(!1);else for(d=0;d<u.length;d++)_=u[d],_==l?_.setVisible(!0):h&&_.setVisible(!1)},getVisibleSkins:function(){for(var l=[],h=this._boneSkins,u,_=0;_<h.length;_++)u=h[_],u.isVisible()&&l.push(u);return l},getRootSkeletonNode:function(){return this._rootSkeleton},getAllSubBones:function(){for(var l=[],h=[],u=this._childBones,_=0;_<u.length;_++)h.push(u[_]);for(;h.length>0;){var d=h.pop();l.push(d);for(var f=d.getChildBones(),T=0;T<f;T++)h.push(f[T])}return l},getAllSubSkins:function(){for(var l=this.getAllSubBones(),h=[],u=0;u<l.length;u++)for(var _=l[u].getSkins(),d=0;d<_.length;d++)h.push(_[u]);return h},addChild:function(l,h,u){t.prototype.addChild.call(this,l,h,u),this._addToChildrenListHelper(l)},removeChild:function(l,h){this._children.indexOf(l)!==-1&&(t.prototype.removeChild.call(this,l,h),this._removeFromChildrenListHelper(l))},setBlendFunc:function(l){var h=this._blendFunc;if(l&&h.src!==l.src&&h.dst!==l.dst){this._blendFunc=l;for(var u=this._boneSkins,_,d=0;d<u.length;d++)_=u[d],_.setBlendFunc(l)}},getBlendFunc:function(){return this._blendFunc},setDebugDrawLength:function(l){this._rackLength=l,this._updateVertices()},getDebugDrawLength:function(){return this._rackLength},setDebugDrawWidth:function(l){this._rackWidth=l,this._updateVertices()},getDebugDrawWidth:function(){return this._rackWidth},setDebugDrawEnabled:function(l){var h=this._renderCmd;h._debug!==l&&(h._debug=l,exports.cc.renderer.childrenOrderDirty=!0,this._visible&&this._rootSkeleton!=null&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},isDebugDrawEnabled:function(){return this._renderCmd._debug},setDebugDrawColor:function(l){this._rackColor=l},getDebugDrawColor:function(){return this._rackColor},getVisibleSkinsRect:function(){var l,h,u,_=0;l=h=u=_;var d=!0,f=n.rect(0,0,0,0);this._renderCmd._debug&&this._rootSkeleton!=null&&this._rootSkeleton._renderCmd._debug&&(u=this._rackWidth,_=this._rackLength,d=!1);for(var T=this._boneSkins,x,m=0;m<T.length;m++){x=T[m];var v=x.getBoundingBox();!x.isVisible()||v.x===0&&v.y===0&&v.width===0&&v.height===0||(d?(l=exports.cc.rectGetMinX(v),h=exports.cc.rectGetMinY(v),u=exports.cc.rectGetMaxX(v),_=exports.cc.rectGetMaxY(v),d=!1):(l=Math.min(exports.cc.rectGetMinX(v),l),h=Math.min(exports.cc.rectGetMinY(v),h),u=Math.max(exports.cc.rectGetMaxX(v),u),_=Math.max(exports.cc.rectGetMaxY(v),_)),f.setRect(l,h,u-l,_-h))}return f},getBoundingBox:function(){var l=this.getVisibleSkinsRect();return exports.cc.rectApplyAffineTransform(l,this.getNodeToParentAffineTransform())},batchBoneDrawToSkeleton:function(l){},setLocalZOrder:function(l){t.prototype.setLocalZOrder.call(this,l),this._rootSkeleton!=null&&(this._rootSkeleton._subBonesOrderDirty=!0)},setName:function(l){var h=this._rootSkeleton,u=this.getName();if(t.prototype.setName.call(this,l),h!=null){var _=h._subBonesMap[u],d=h._subBonesMap[l];_&&!d&&(delete h._subBonesMap[_],h._subBonesMap[l]=_)}},setContentSize:function(l){t.prototype.setContentSize.call(this,l),this._updateVertices()},setAnchorPoint:function(l){t.prototype.setAnchorPoint.call(this,l),this._updateVertices()},setVisible:function(l){this._visible!=l&&(t.prototype.setVisible.call(this,l),this._rootSkeleton!=null&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},_addToChildrenListHelper:function(l){l instanceof o?this._addToBoneList(l):this._addToSkinList(l)},_removeFromChildrenListHelper:function(l){l instanceof o?this._removeFromBoneList(l):l instanceof e&&this._removeFromSkinList(skin)},_removeFromBoneList:function(l){if(this._rootSkeleton!=null&&l instanceof ccs.SkeletonNode&&l._rootSkeleton===this._rootSkeleton){l._rootSkeleton=null;var h=l.getAllSubBones();h.push(l);for(var u,_=0;_<h.length;_++)u=h[_],u._rootSkeleton=null,delete this._rootSkeleton._subBonesMap[u.getName()],this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0}else this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0;exports.cc.arrayRemoveObject(this._childBones,l)},_setRootSkeleton:function(l){this._rootSkeleton=l;for(var h=this.getAllSubBones(),u=0;u<h.length;u++)this._addToBoneList(h[u])},_addToBoneList:function(l){if(this._childBones.indexOf(l)===-1&&this._childBones.push(l),this._rootSkeleton!=null){var h=l;if(!(h instanceof e)&&!l._rootSkeleton){var u=l.getAllSubBones();u.push(l);for(var _,d=0;d<u.length;d++){_=u[d],_._setRootSkeleton(this._rootSkeleton);var f=_.getName();this._rootSkeleton._subBonesMap[f]?(exports.cc.log("already has a bone named %s in skeleton %s",f,this._rootSkeleton.getName()),this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0):(this._rootSkeleton._subBonesMap[_.getName()]=_,this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0)}}}},_visitSkins:function(){var l=this._renderCmd;if(this._visible){var h=l.getParentRenderCmd();h&&(l._curLevel=h._curLevel+1);var u,_=this._boneSkins,d;l._syncStatus(h);var f=_.length;if(f>0){for(this.sortAllChildren(),u=0;u<f&&(d=_[u],d._localZOrder<0);u++)d._renderCmd.visit(l);for(;u<f;u++)_[u]._renderCmd.visit(l)}l._dirtyFlag=0}},_addToSkinList:function(l){if(this._boneSkins.push(l),l.getBlendFunc){var h=l.getBlendFunc();this._blendFunc.src!==h.src&&this._blendFunc.dst!==h.dst&&l.setBlendFunc(this._blendFunc)}},_removeFromSkinList:function(l){exports.cc.arrayRemoveObject(this._boneSkins,l)},sortAllChildren:function(){this._sortArray(this._childBones),this._sortArray(this._boneSkins),t.prototype.sortAllChildren.call(this)},_sortArray:function(l){if(l){var h=l.length,u,_,d;for(u=1;u<h;u++){for(d=l[u],_=u-1;_>=0;){if(d._localZOrder<l[_]._localZOrder)l[_+1]=l[_];else if(d._localZOrder===l[_]._localZOrder&&d.arrivalOrder<l[_].arrivalOrder)l[_+1]=l[_];else break;_--}l[_+1]=d}}},_updateVertices:function(){var l=this._squareVertices,h=this._renderCmd._anchorPointInPoints;if(this._rackLength!=l[2].x-h.x||l[3].y!=this._rackWidth/2-h.y){l[1].x=l[1].y=l[3].y=0,l[0].x=l[2].x=this._rackLength*.1,l[2].y=this._rackWidth*.5,l[0].y=-l[2].y,l[3].x=this._rackLength;for(var u=0;u<l.length;u++)l[u].x+=h.x,l[u].y+=h.y;this._renderCmd.updateDebugPoint(l)}},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new a(this):new c(this)}});o.create=function(l,h){return new ccui.BoneNode(l,h)};var a=function(){var l=function(u){t.CanvasRenderCmd.call(this,u),this._debug=!1,this._color=exports.cc.color.WHITE,this._drawNode=new exports.cc.DrawNode},h=l.prototype=Object.create(t.CanvasRenderCmd.prototype);return h.constructor=l,h.visit=function(u){var _=this._node;_._visit&&_._visit(u)},h.updateDebugPoint=function(u){this._drawNode.clear(),this._drawNode.drawPoly(u,this._color,0,this._color)},h.transform=function(u,_){var d=this._node._rootSkeleton;t.CanvasRenderCmd.prototype.transform.call(this,u,_),d&&d._renderCmd._debug&&this._drawNode._renderCmd.transform(this)},l}(),c=function(){var l=function(u){t.WebGLRenderCmd.call(this,u),this._debug=!1,this._color=exports.cc.color.WHITE,this._drawNode=new exports.cc.DrawNode},h=l.prototype=Object.create(t.WebGLRenderCmd.prototype);return h.constructor=l,h.visit=function(u){var _=this._node;_._visit&&_._visit(u)},h.updateDebugPoint=function(u){this._drawNode.clear(),this._drawNode.drawPoly(u,this._color,0,this._color)},h.transform=function(u,_){var d=this._node._rootSkeleton;t.WebGLRenderCmd.prototype.transform.call(this,u,_),d&&d._renderCmd._debug&&this._drawNode._renderCmd.transform(this)},l}();return o}();ccs.SkeletonNode=function(){var t=ccs.BoneNode;exports.cc.p,exports.cc.size,exports.cc.rect;var e=t.extend({_subBonesMap:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,_skinGroupMap:null,_sortedAllBonesDirty:!1,_sortedAllBones:null,_batchedBoneVetices:null,_batchedBoneColors:null,_batchedVeticesCount:null,_batchBoneCommand:null,_subOrderedAllBones:null,ctor:function(){this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this._rootSkeleton=this||window,t.prototype.ctor.call(this),this._subBonesMap={},this._subOrderedAllBones=[],this._skinGroupMap={},this._rackLength=this._rackWidth=20,this._updateVertices()},getBoneNode:function(r){var n=this._subBonesMap[r];return n||null},getAllSubBonesMap:function(){return this._subBonesMap},changeSkins:function(r){if(typeof r=="object"){var n;for(var s in r){n=r[s];var o=this.getBoneNode(s);o!==null&&o.displaySkin(n,!0)}}else{var a=this._suitMap[r];a&&this.changeSkins(a,!0)}},addSkinGroup:function(r,n){this._skinGroupMap[r]=n},getBoundingBox:function(){var r,n,s,o=0;r=n=s=o;var a=this.getVisibleSkinsRect(),c=!0;(a.x!==0||a.y!==0||a.width!==0||a.height!==0)&&(r=exports.cc.rectGetMinX(a),n=exports.cc.rectGetMinY(a),s=exports.cc.rectGetMaxX(a),o=exports.cc.rectGetMaxY(a),c=!1);for(var l=this.getAllSubBones(),h,u=0;u<l.length;u++){h=l[u];var _=exports.cc.rectApplyAffineTransform(h.getVisibleSkinsRect(),h.getNodeToParentTransform(h.getRootSkeletonNode()));_.x===0&&_.y===0&&_.width===0&&_.height===0||(c?(r=exports.cc.rectGetMinX(_),n=exports.cc.rectGetMinY(_),s=exports.cc.rectGetMaxX(_),o=exports.cc.rectGetMaxY(_),c=!1):(r=Math.min(exports.cc.rectGetMinX(_),r),n=Math.min(exports.cc.rectGetMinY(_),n),s=Math.max(exports.cc.rectGetMaxX(_),s),o=Math.max(exports.cc.rectGetMaxY(_),o)))}return a.x=r,a.y=n,a.width=s-r,a.height=o-n,exports.cc.rectApplyAffineTransform(a,this.getNodeToParentTransform())},_visit:function(r){if(this._visible){var n=this._renderCmd;r=r||n.getParentRenderCmd(),n._syncStatus(r);var s,o;if(this._children.length!==0)for(s=0;s<this._children.length;s++)o=this._children[s],o._renderCmd.visit(n);this._checkSubBonesDirty();var a=this._subOrderedAllBones,c,l;for(s=0;s<a.length;s++)c=a[s],c._visitSkins();if(n._debug)for(s=0;s<a.length;s++)l=a[s]._renderCmd,exports.cc.renderer.pushRenderCommand(l._drawNode._renderCmd);this._dirtyFlag=0}},_checkSubBonesDirty:function(){this._subBonesDirty&&(this._updateOrderedAllbones(),this._subBonesDirty=!1),this._subBonesOrderDirty&&(this._sortOrderedAllBones(),this._subBonesOrderDirty=!1)},_updateOrderedAllbones:function(){this._subOrderedAllBones.length=0;for(var r=[],n=this._childBones,s,o=0;o<n.length;o++)s=n[o],s.isVisible()&&r.push(s);for(;r.length>0;){var a=r.pop(),c=a._renderCmd;c._syncStatus(c.getParentRenderCmd()),this._subOrderedAllBones.push(a);for(var l=a.getChildBones(),h,o=0;o<l.length;o++)h=l[o],h.isVisible()&&r.push(h)}},_sortOrderedAllBones:function(){this._sortArray(this._subOrderedAllBones)},_updateVertices:function(){var r=this._squareVertices,n=this._renderCmd._anchorPointInPoints;if(this._rackLength!=r[6].x-n.x||this._rackWidth!=r[3].y-n.y){var s=this._rackLength*.5,o=this._rackWidth*.5,a=s*.25,c=o*.25;r[5].y=r[2].y=r[1].y=r[6].y=r[0].x=r[4].x=r[7].x=r[3].x=0,r[5].x=-s,r[0].y=-o,r[6].x=s,r[3].y=o,r[1].x=a,r[7].y=c,r[2].x=-a,r[4].y=-c;for(var l=0;l<r.length;l++)r[l].x+=n.x,r[l].y+=n.y}},_updateAllDrawBones:function(){this._subDrawBones={};for(var r in this._subBonesMap){var n=this._subBonesMap[r];n.isVisible()&&n.isDebugDrawEnabled()&&this._subDrawBones.push(n)}this._sortArray(this._sortedAllBones),this._subDrawBones=!1}});return e.create=function(){return new e},e}();ccs._load=function(){var t=function(a,c,l){var h=exports.cc.loader.getRes(a);if(!h)return exports.cc.log("%s does not exist",a);var u=r(a).toLocaleLowerCase();if(u!=="json"&&u!=="exportjson")return exports.cc.log("%s load error, must be json file",a);var _;if(c?_=e[c]:h.widgetTree?_=e.ccui:h.nodeTree||h.Content&&h.Content.Content?_=e.timeline:h.gameobjects&&(_=e.scene),!_)return exports.cc.log("Can't find the parser : %s",a),new exports.cc.Node;var d=h.version||h.Version;if(!d&&h.armature_data)return exports.cc.warn("%s is armature. please use:",a),exports.cc.warn("    ccs.armatureDataManager.addArmatureFileInfoAsync(%s);",a),exports.cc.warn("    var armature = new ccs.Armature('name');"),new exports.cc.Node;var f=o(_,d);return f?f.parse(a,h,l)||null:(exports.cc.log("Can't find the parser : %s",a),new exports.cc.Node)},e={ccui:{},timeline:{},action:{},scene:{}};t.registerParser=function(a,c,l){if(!a||!c||!l)return exports.cc.log("register parser error");e[a]||(e[a]={}),e[a][c]=l},t.getParser=function(a,c){return a&&c?e[a]?e[a][c]:void 0:a?e[a]:e};var r=function(a){var c=a.match(n);return c&&c[1]?c[1]:null},n=/\.([^\.]+)$/,s=/([^\.](\.\*)?)*$/,o=function(a,c){return a[c]?a[c]:c==="*"?null:o(a,c.replace(s,"*"))};return t}();ccs._parser=exports.cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(t){var e=t.match(this._dirnameReg);return e&&e[0]?e[0]:""},getClass:function(t){return t.classname},getNodeJson:function(t){return t.widgetTree},parse:function(t,e,r){r=r||this._dirname(t),this.pretreatment(e,r);var n=this.parseNode(this.getNodeJson(e),r,t);return n&&this.deferred(e,r,n,t),n},pretreatment:function(t,e,r){},deferred:function(t,e,r,n){},parseNode:function(t,e){var r=this.parsers[this.getClass(t)],n=null;return r?n=r.call(this,t,e):exports.cc.log("Can't find the parser : %s",this.getClass(t)),n},registerParser:function(t,e){this.parsers[t]=e}});ccs.load=function(t,e){var r={node:null,action:null};return r.node=ccs._load(t,null,e),r.action=ccs._load(t,"action",e),r.action&&r.action.tag===-1&&r.node&&(r.action.tag=r.node.tag),r};ccs.load.validate={};ccs.load.preload=!0;ccs.loadWithVisibleSize=function(t,e){var r=ccs.load(t,e),n=exports.cc.director.getVisibleSize();return r.node&&n&&(r.node.setContentSize(n.width,n.height),ccui.helper.doLayout(r.node)),r};ccs.actionTimelineCache={createAction:function(t){return ccs._load(t,"action")}};ccs.csLoader={createNode:function(t){return ccs._load(t)}};exports.cc.loader.register(["json"],{load:function(t,e,r,n){exports.cc.loader.loadJson(t,function(s,o){var a=exports.cc.path;if(o&&o.Content&&o.Content.Content.UsedResources){for(var c=o.Content.Content.UsedResources,l=a.dirname(e),h=[],u,_,d=0;d<c.length;d++)!ccs.load.preload&&/\.(png|jpg$)/.test(c[d])||(u=a.join(l,c[d]),_=a._normalize(u),ccs.load.validate[_]||(ccs.load.validate[_]=!0,h.push(_)));exports.cc.loader.load(h,function(){n(s,o)})}else n(s,o)})}});(function(t,e){var r=e.extend({getNodeJson:function(o){return o.action},parseNode:function(o,a,c){if(!o)return null;var l=this,h=new ccs.ActionTimeline;h.setDuration(o.duration),h.setTimeSpeed(o.speed||1);var u=o.timelines;return u.forEach(function(_){var d=l.parsers[_.frameType],f;d?f=d.call(l,_,a):exports.cc.log("parser does not exist : %s",_.frameType),f&&h.addTimeline(f),_.frameType==="ColorFrame"&&h.addTimeline(l.parsers.AlphaFrame.call(l,_,a))}),h}}),n=new r,s=[{name:"PositionFrame",handle:function(o){var a=new ccs.PositionFrame,c=o.x,l=o.y;return a.setPosition(exports.cc.p(c,l)),a}},{name:"VisibleFrame",handle:function(o){var a=new ccs.VisibleFrame,c=o.value;return a.setVisible(c),a}},{name:"ScaleFrame",handle:function(o){var a=new ccs.ScaleFrame,c=o.x,l=o.y;return a.setScaleX(c),a.setScaleY(l),a}},{name:"RotationFrame",handle:function(o){var a=new ccs.RotationFrame,c=o.rotation;return a.setRotation(c),a}},{name:"SkewFrame",handle:function(o){var a=new ccs.SkewFrame,c=o.x,l=o.y;return a.setSkewX(c),a.setSkewY(l),a}},{name:"RotationSkewFrame",handle:function(o){var a=new ccs.RotationSkewFrame,c=o.x,l=o.y;return a.setSkewX(c),a.setSkewY(l),a}},{name:"AnchorFrame",handle:function(o){var a=new ccs.AnchorPointFrame,c=o.x,l=o.y;return a.setAnchorPoint(exports.cc.p(c,l)),a}},{name:"InnerActionFrame",handle:function(o){var a=new ccs.InnerActionFrame,c=o.innerActionType,l=o.startFrame;return a.setInnerActionType(c),a.setStartFrameIndex(l),a}},{name:"ColorFrame",handle:function(o){var a=new ccs.ColorFrame,c=o.red,l=o.green,h=o.blue;a.setColor(exports.cc.color(c,l,h));var u=new ccs.AlphaFrame,_=o.alpha;return u.setAlpha(_),a}},{name:"AlphaFrame",handle:function(o){var a=new ccs.AlphaFrame,c=o.alpha;return a.setAlpha(c),a}},{name:"TextureFrame",handle:function(o){var a=new ccs.TextureFrame,c=o.value;if(c!=null){var l=c,h=exports.cc.spriteFrameCache.getSpriteFrame(l);if(h==null){var u=ccs.csLoader.getJsonPath();l=u+c}a.setTextureName(l)}return a}},{name:"EventFrame",handle:function(o){var a=new ccs.EventFrame,c=o.value;return c!=null&&a.setEvent(c),a}},{name:"ZOrderFrame",handle:function(o){var a=new ccs.ZOrderFrame,c=o.value;return a.setZOrder(c),a}}];s.forEach(function(o){n.registerParser(o.name,function(a,c){var l=new ccs.Timeline;l.setActionTag(a.actionTag);var h=a.frames;return h&&h.length&&h.forEach(function(u){var _=o.handle(u);_.setFrameIndex(u.frameIndex),_.setTween(u.tween),l.addFrame(_)}),l})}),t.registerParser("action","0.*",n),t.registerParser("action","1.*",n)})(ccs._load,ccs._parser);(function(t,e){var r=e.extend({getNodeJson:function(a){return a.Content.Content.Animation},parseNode:function(a,c,l){if(!a)return null;var h=this,u=new ccs.ActionTimeline;u.setDuration(a.Duration),u.setTimeSpeed(a.Speed||1);var _=a.Timelines;return _.forEach(function(d){var f=h.parsers[d.Property],T;f?T=f.call(h,d,c):exports.cc.log("parser does not exist : %s",d.Property),T&&u.addTimeline(T)}),u},deferred:function(a,c,l,h){for(var u=a.Content.Content.AnimationList,_=u?u.length:0,d=0;d<_;d++){var f=u[d],T={name:null,startIndex:null,endIndex:null};T.name=f.Name,T.startIndex=f.StartIndex,T.endIndex=f.EndIndex,l.addAnimationInfo(T)}}}),n=new r,s=[{name:"Position",handle:function(a){var c=new ccs.PositionFrame,l=a.X,h=a.Y;return c.setPosition(exports.cc.p(l,h)),c}},{name:"VisibleForFrame",handle:function(a){var c=new ccs.VisibleFrame,l=a.Value;return c.setVisible(l),c}},{name:"Scale",handle:function(a){var c=new ccs.ScaleFrame,l=a.X,h=a.Y;return c.setScaleX(l),c.setScaleY(h),c}},{name:"Rotation",handle:function(a){var c=new ccs.RotationFrame,l=a.Rotation||a.Value||0;return c.setRotation(l),c}},{name:"Skew",handle:function(a){var c=new ccs.SkewFrame,l=a.X,h=a.Y;return c.setSkewX(l),c.setSkewY(h),c}},{name:"RotationSkew",handle:function(a){var c=new ccs.RotationSkewFrame,l=a.X,h=a.Y;return c.setSkewX(l),c.setSkewY(h),c}},{name:"Anchor",handle:function(a){var c=new ccs.AnchorPointFrame,l=a.X,h=a.Y;return c.setAnchorPoint(exports.cc.p(l,h)),c}},{name:"AnchorPoint",handle:function(a){var c=new ccs.AnchorPointFrame,l=a.X,h=a.Y;return c.setAnchorPoint(exports.cc.p(l,h)),c}},{name:"InnerAction",handle:function(a){var c=new ccs.InnerActionFrame,l=a.InnerActionType,h=a.StartFrame;return c.setInnerActionType(l),c.setStartFrameIndex(h),c}},{name:"CColor",handle:function(a){var c=new ccs.ColorFrame,l=a.Color;return l||(l={}),l.R=l.R===void 0?255:l.R,l.G=l.G===void 0?255:l.G,l.B=l.B===void 0?255:l.B,c.setColor(exports.cc.color(l.R,l.G,l.B)),c}},{name:"Alpha",handle:function(a){var c=new ccs.AlphaFrame,l=a.Value;return c.setAlpha(l),c}},{name:"FileData",handle:function(a,c){var l,h,u,_,d;return l=new ccs.TextureFrame,h=a.TextureFile,h!=null&&(u=h.Plist,_=h.Path,d=exports.cc.spriteFrameCache.getSpriteFrame(_),!d&&u&&(exports.cc.loader.getRes(c+u)?(exports.cc.spriteFrameCache.addSpriteFrames(c+u),d=exports.cc.spriteFrameCache.getSpriteFrame(_)):exports.cc.log("%s need to be preloaded",c+u)),d==null&&(_=c+_),l.setTextureName(_)),l}},{name:"FrameEvent",handle:function(a){var c=new ccs.EventFrame,l=a.Value;return l!=null&&c.setEvent(l),c}},{name:"ZOrder",handle:function(a){var c=new ccs.ZOrderFrame,l=a.Value;return c.setZOrder(l),c}},{name:"ActionValue",handle:function(a){var c=new ccs.InnerActionFrame,l=a.InnerActionType,h=a.CurrentAniamtionName,u=a.SingleFrameIndex,_=a.FrameIndex;return _!==void 0&&c.setFrameIndex(_),c.setInnerActionType(ccs.InnerActionType[l]),c.setSingleFrameIndex(u),c.setEnterWithName(!0),h&&c.setAnimationName(h),c}},{name:"BlendFunc",handle:function(a){var c=new ccs.BlendFuncFrame,l=a.BlendFunc;return l&&l.Src!==void 0&&l.Dst!==void 0&&c.setBlendFunc(new exports.cc.BlendFunc(l.Src,l.Dst)),c}}],o=function(a,c){var l=c.Type;a.setTweenType(l);var h=c.Points,u=[];h&&(h.forEach(function(_){u.push(_.X),u.push(_.Y)}),a.setEasingParams(u))};s.forEach(function(a){n.registerParser(a.name,function(c,l){var h=new ccs.Timeline;h.setActionTag(c.ActionTag);var u=c.Frames;return u&&u.length&&u.forEach(function(_){var d=a.handle(_,l);d.setFrameIndex(_.FrameIndex);var f=_.Tween!=null?_.Tween:!0;d.setTween(f);var T=_.EasingData;T&&o(d,T),h.addFrame(d)}),h})}),t.registerParser("action","2.*",n),t.registerParser("action","*",n)})(ccs._load,ccs._parser);(function(t,e){var r=e.extend({getNodeJson:function(c){return c},parseNode:function(c,l){var h=this.parsers[this.getClass(c)],u=null;return h?u=h.call(this,c,l):exports.cc.log("Can't find the parser : %s",this.getClass(c)),u},deferred:function(c,l,h,u){ccs.triggerManager.parse(c.Triggers||[]),ccs.sceneReader&&(ccs.sceneReader._node=h)},setPropertyFromJsonDict:function(c,l){var h=exports.cc.isUndefined(l.x)?0:l.x,u=exports.cc.isUndefined(l.y)?0:l.y;c.setPosition(h,u);var _=!!(exports.cc.isUndefined(l.visible)||l.visible);c.setVisible(_);var d=exports.cc.isUndefined(l.objecttag)?-1:l.objecttag;c.setTag(d);var f=exports.cc.isUndefined(l.zorder)?0:l.zorder;c.setLocalZOrder(f);var T=exports.cc.isUndefined(l.scalex)?1:l.scalex,x=exports.cc.isUndefined(l.scaley)?1:l.scaley;c.setScaleX(T),c.setScaleY(x);var m=exports.cc.isUndefined(l.rotation)?0:l.rotation;c.setRotation(m);var v=l.name||"";c.setName(v)}}),n=new r;n.parseChild=function(c,l,h){for(var u=0;u<l.length;u++){var _,d=l[u];d&&(_=this.parseNode(d,h)),_&&c.addChild(_)}};var s={CCSprite:function(c,l,h){var u=new exports.cc.Sprite;a(l.fileData,h,function(d,f){if(f===0)u.setTexture(d);else if(f===1){var T=exports.cc.spriteFrameCache.getSpriteFrame(d);u.setSpriteFrame(T)}});var _=new ccs.ComRender(u,"CCSprite");return c.addComponent(_),_},CCTMXTiledMap:function(c,l,h){var u=null;a(l.fileData,h,function(d,f){f===0&&(u=new exports.cc.TMXTiledMap(d))});var _=new ccs.ComRender(u,"CCTMXTiledMap");return c.addComponent(_),_},CCParticleSystemQuad:function(c,l,h){var u=null;a(l.fileData,h,function(d,f){f===0?u=new exports.cc.ParticleSystem(d):exports.cc.log("unknown resourcetype on CCParticleSystemQuad!"),u.setPosition(0,0)});var _=new ccs.ComRender(u,"CCParticleSystemQuad");return c.addComponent(_),_},CCArmature:function(c,l,h){var u=null;if(a(l.fileData,h,function(f,T){if(T===0){var x=exports.cc.loader.getRes(f);x||exports.cc.log("Please load the resource [%s] first!",f);var m=x.armature_data,v=m[0],A=v.name;ccs.armatureDataManager.addArmatureFileInfo(f),u=new ccs.Armature(A)}}),u){var _=new ccs.ComRender(u,"CCArmature");c.addComponent(_);var d=l.selectedactionname;return d&&u.getAnimation()&&u.getAnimation().play(d),_}},CCComAudio:function(c,l,h){var u=null;a(l.fileData,h,function(_,d){if(d===0){u=new ccs.ComAudio,u.preloadEffect(_);var f=l.name;f&&u.setName(f),c.addComponent(u)}})},CCComAttribute:function(c,l,h){var u=null;return a(l.fileData,h,function(_,d){d===0?(u=new ccs.ComAttribute,_!==""&&u.parse(_),c.addComponent(u)):exports.cc.log("unknown resourcetype on CCComAttribute!")}),u},CCBackgroundAudio:function(c,l,h){var u=null;a(l.fileData,h,function(_,d){if(d===0){u=new ccs.ComAudio,u.preloadBackgroundMusic(_),u.setFile(_);var f=!!l.loop;u.setLoop(f);var T=l.name;T&&u.setName(T),c.addComponent(u),u.playBackgroundMusic(_,f)}})},GUIComponent:function(c,l,h){var u=null;a(l.fileData,h,function(d,f){u=ccs._load(d,"ccui")});var _=new ccs.ComRender(u,"GUIComponent");return c.addComponent(_),_},CCScene:function(){}},o={},a=function(c,l,h){if(c!=null){var u=c.path,_=c.resourceType,d=c.plist;if(!u)return;d&&(exports.cc.loader.getRes(l+d)?(o[l+d]=!0,exports.cc.spriteFrameCache.addSpriteFrames(l+d)):o[l+d]||exports.cc.log("%s need to be preloaded",l+d)),h(_!==0?u:l+u,_)}};n.parseComponents=function(c,l,h){!c||!l||l.forEach(function(u){var _=s[u.classname],d=null;_?d=_(c,u,h):exports.cc.log("Can't find the component parser : %s",u.classname);var f=u.name;d&&f&&d.setName(f)})},n.registerParser("CCNode",function(c,l){var h=new exports.cc.Node;this.setPropertyFromJsonDict(h,c),this.parseChild.call(this,h,c.gameobjects,l),this.parseComponents(h,c.components,l);var u=c.CanvasSize;return u&&h.setContentSize(exports.cc.size(u._width,u._height)),h}),t.registerParser("scene","*",n)})(ccs._load,ccs._parser);(function(t,e){var r={},n=e.extend({getNodeJson:function(c){return c.nodeTree},addSpriteFrame:function(c,l,h){if(!(!c||!l||c.length!==l.length))for(var u=0;u<c.length;u++){var _=h+c[u];!exports.cc.loader.getRes(_)&&!r[_]?exports.cc.log("%s need to be preloaded",_):r[_]=!0,exports.cc.spriteFrameCache.addSpriteFrames(_,h+l[u])}},pretreatment:function(c,l,h){this.addSpriteFrame(c.textures,c.texturesPng,l)}}),s=new n;s.generalAttributes=function(c,l){var h=l.width!=null?l.width:0,u=l.height!=null?l.height:0,_=l.x!=null?l.x:0,d=l.y!=null?l.y:0,f=l.scaleX!=null?l.scaleX:1,T=l.scaleY!=null?l.scaleY:1,x=l.rotation!=null?l.rotation:0,m=l.rotationSkewX!=null?l.rotationSkewX:0,v=l.rotationSkewY!=null?l.rotationSkewY:0,A=l.skewX!=null?l.skewX:0,D=l.skewY!=null?l.skewY:0,N=l.anchorPointX!=null?l.anchorPointX:.5,z=l.anchorPointY!=null?l.anchorPointY:.5,M=l.opacity!=null?l.opacity:255,J=l.colorR!=null?l.colorR:255,U=l.colorG!=null?l.colorG:255,K=l.colorB!=null?l.colorB:255,tt=l.colorR!=null?l.colorR:0,rt=l.tag!=null?l.tag:0,I=l.actionTag!=null?l.actionTag:0,L=l.visible!=null?l.visible:!0;(_!=0||d!=0)&&c.setPosition(exports.cc.p(_,d)),f!=1&&c.setScaleX(f),T!=1&&c.setScaleY(T),x!=0&&c.setRotation(x),m!=0&&c.setRotationX(m),v!=0&&c.setRotationY(v),A!=0&&c.setSkewX(A),D!=0&&c.setSkewY(D),(N!=.5||z!=.5)&&c.setAnchorPoint(exports.cc.p(N,z)),(h!=0||u!=0)&&c.setContentSize(exports.cc.size(h,u)),tt!=0&&c.setLocalZOrder(tt),L!=!0&&c.setVisible(L),M!=255&&c.setOpacity(M),(J!=255||U!=255||K!=255)&&c.setColor(exports.cc.color(J,U,K)),c.setTag(rt),c.setUserObject(new ccs.ActionTimelineData(I))},s.parseComponent=function(c,l){if(l)for(var h=0;h<l.length;++h){var u=l[h],_=this.loadComponent(u);_&&c.addComponent(_)}},s.parseChild=function(c,l,h,u){for(var _=h.children,d=0;d<_.length;d++){var f=this.parseNode(_[d],u);if(f)if(l instanceof ccui.PageView)f instanceof ccui.Layout&&l.addPage(f);else if(l instanceof ccui.ListView)f instanceof ccui.Widget&&l.pushBackCustomItem(f);else{if(!(l instanceof ccui.Layout)&&f instanceof ccui.Widget){if(f.getPositionType()===ccui.Widget.POSITION_PERCENT){var T=f.getPositionPercent(),x=l.getAnchorPoint();f.setPositionPercent(exports.cc.p(T.x+x.x,T.y+x.y))}var m=l.getAnchorPointInPoints();f.setPosition(exports.cc.p(f.getPositionX()+m.x,f.getPositionY()+m.y))}l.addChild(f)}}},s.initNode=function(c){var l=new exports.cc.Node;return this.generalAttributes(l,c),l},s.initSubGraph=function(c){var l=c.fileName,h;return l&&l!==""?h=this.createNode(l):h=new ccs.Node,this.generalAttributes(h,c),h},s.initSprite=function(c,l){var h=c.fileName,u;if(h!=null){var _=exports.cc.spriteFrameCache.getSpriteFrame(h);_?u=ccs.Sprite.createWithSpriteFrame(_):(h=l+h,u=new ccs.Sprite(h)),u||(u=new exports.cc.Sprite,exports.cc.log("filePath is empty. Create a sprite with no texture"))}else u=new ccs.Sprite;this.generalAttributes(u,c);var d=c.flipX,f=c.flipY;return d!=!1&&u.setFlippedX(d),f!=!1&&u.setFlippedY(f),u},s.initParticle=function(c,l){var h=c.plistFile,u=c.tmxFile,_=new exports.cc.ParticleSystemQuad(h);return _.setTotalParticles(u),this.generalAttributes(_,c),_},s.initTMXTiledMap=function(c,l){var h=c.tmxFile,u=c.tmxString,_=c.resourcePath,d=null;return h&&h!==""?d=new exports.cc.TMXTiledMap(h):u&&u!==""&&_&&_!==""&&(d=new exports.cc.TMXTiledMap(u,_)),d};var o=t.getParser("ccui")["*"];s.initWidget=function(c,l){var h=c.classname,u=o.parsers[h];if(!u)return exports.cc.log("%s parser is not found",h);var _=u.call(o,c,l);if(_){var d=c.rotationSkewX,f=c.rotationSkewY,T=c.skewX,x=c.skewY;d!=0&&_.setRotationX(d),f!=0&&_.setRotationY(f),T!=0&&_.setSkewX(T),x!=0&&_.setSkewY(x);var m=c.actionTag;_.setUserObject(new ccs.ActionTimelineData(m))}return _};var a=[{name:"Node",handle:s.initNode},{name:"SubGraph",handle:s.initSubGraph},{name:"Sprite",handle:s.initSprite},{name:"Particle",handle:s.initParticle},{name:"TMXTiledMap",handle:s.initTMXTiledMap},{name:"Widget",handle:s.initWidget},{name:"Panel",handle:s.initWidget},{name:"Button",handle:s.initWidget},{name:"CheckBox",handle:s.initWidget},{name:"ImageView",handle:s.initWidget},{name:"LabelAtlas",handle:s.initWidget},{name:"LabelBMFont",handle:s.initWidget},{name:"Label",handle:s.initWidget},{name:"ListView",handle:s.initWidget},{name:"LoadingBar",handle:s.initWidget},{name:"PageView",handle:s.initWidget},{name:"ScrollView",handle:s.initWidget},{name:"Slider",handle:s.initWidget},{name:"TextField",handle:s.initWidget}];a.forEach(function(c){s.registerParser(c.name,function(l,h,u){var _=c.handle.call(this,l.options);return this.parseComponent(_,l.components),this.parseChild(h,_,l,u),_})}),t.registerParser("timeline","0.*",s),t.registerParser("timeline","1.*",s)})(ccs._load,ccs._parser);(function(t,e){var r=e.extend({parse:function(x,m,v){var A;v!==void 0?A=v:A=this._dirname(x),this.pretreatment(m,A,x);var D=this.parseNode(this.getNodeJson(m),A);return this.deferred(m,A,D,x),D},getNodeJson:function(x){var m=x.Content;return m.ObjectData?m.ObjectData:m.Content.ObjectData},getClass:function(x){return x.ctype}}),n=new r,s=function(x,m){return x===void 0?m:x};n.generalAttributes=function(x,m){m.Name!=null&&x.setName(m.Name);var v=m.Position;v!=null&&(v.X!=null||v.Y!=null)&&x.setPosition(exports.cc.p(v.X||0,v.Y||0));var A=m.Scale;A!=null&&(A.ScaleX!=null&&x.setScaleX(A.ScaleX),A.ScaleY!=null&&x.setScaleY(A.ScaleY));var D=m.RotationSkewX;D!=null&&x.setRotationX(D);var N=m.RotationSkewY;m.RotationSkewY!=null&&x.setRotationY(N);var z=m.AnchorPoint;z!=null&&(z.ScaleX==null&&(z.ScaleX=0),z.ScaleY==null&&(z.ScaleY=0),(z.ScaleX!=.5||z.ScaleY!=.5)&&x.setAnchorPoint(exports.cc.p(z.ScaleX,z.ScaleY))),m.ZOrder!=null&&x.setLocalZOrder(m.ZOrder);var M=s(m.VisibleForFrame,!0);x.setVisible(M);var J=m.Size;J&&f(x,J),m.Alpha!=null&&x.setOpacity(m.Alpha),x.setTag(m.Tag||0);var U=m.ActionTag||0,K=new ccs.ComExtensionData,tt=m.UserData;tt!==void 0&&K.setCustomProperty(tt),K.setActionTag(U),x.getComponent("ComExtensionData")&&x.removeComponent("ComExtensionData"),x.addComponent(K),x.setCascadeColorEnabled(!0),x.setCascadeOpacityEnabled(!0),a(x,m)},n.parseChild=function(x,m,v){if(!(!x||!m))for(var A=0;A<m.length;A++){var D=this.parseNode(m[A],v);if(D)if(x instanceof ccui.PageView)D instanceof ccui.Layout&&x.addPage(D);else if(x instanceof ccui.ListView)D instanceof ccui.Widget&&x.pushBackCustomItem(D);else{if(!(x instanceof ccui.Layout)&&D instanceof ccui.Widget&&D.getPositionType()===ccui.Widget.POSITION_PERCENT){var N=D.getPositionPercent(),z=x.getAnchorPoint();D.setPositionPercent(exports.cc.p(N.x+z.x,N.y+z.y))}x.addChild(D)}}},n.initSingleNode=function(x){var m=new exports.cc.Node;this.generalAttributes(m,x);var v=x.CColor;return v!=null&&m.setColor(d(v)),m},n.initSprite=function(x,m){var v=new exports.cc.Sprite;_(x.FileData,m,function(z,M){if(M===0)v.setTexture(z);else if(M===1){var J=exports.cc.spriteFrameCache.getSpriteFrame(z);J&&v.setSpriteFrame(J)}});var A=x.BlendFunc;if(x.BlendFunc){var D=exports.cc.BlendFunc.ALPHA_PREMULTIPLIED;A.Src!==void 0&&(D.src=A.Src),A.Dst!==void 0&&(D.dst=A.Dst),v.setBlendFunc(D)}x.FlipX&&v.setFlippedX(!0),x.FlipY&&v.setFlippedY(!0),this.generalAttributes(v,x);var N=x.CColor;return N!=null&&v.setColor(d(N)),v},n.initParticle=function(x,m){var v,A=this||window;return _(x.FileData,m,function(D,N){exports.cc.loader.getRes(D)||exports.cc.log("%s need to be preloaded",D),v=new exports.cc.ParticleSystem(D),A.generalAttributes(v,x),v.setPositionType(exports.cc.ParticleSystem.TYPE_GROUPED),!exports.cc.sys.isNative&&v.setDrawMode(exports.cc.ParticleSystem.TEXTURE_MODE);var z=x.BlendFunc;if(x.BlendFunc){var M=exports.cc.BlendFunc.ALPHA_PREMULTIPLIED;z.Src!==void 0&&(M.src=z.Src),z.Dst!==void 0&&(M.dst=z.Dst),v.setBlendFunc(M)}}),v},n.widgetAttributes=function(x,m,v){x.setCascadeColorEnabled(!0),x.setCascadeOpacityEnabled(!0),x.setUnifySizeEnabled(!1),x.ignoreContentAdaptWithSize(!1),!v&&f(x,m.Size);var A=m.Name;A&&x.setName(A);var D=m.ActionTag||0;x.setActionTag(D);var N=new ccs.ComExtensionData,z=m.UserData;z!==void 0&&N.setCustomProperty(z),N.setActionTag(D),x.getComponent("ComExtensionData")&&x.removeComponent("ComExtensionData"),x.addComponent(N);var M=m.RotationSkewX;M&&x.setRotationX(M);var J=m.RotationSkewY;J&&x.setRotationY(J);var U=m.FlipX;U&&x.setFlippedX(!0);var K=m.FlipY;K&&x.setFlippedY(!0);var tt=m.zOrder;tt!=null&&x.setLocalZOrder(tt);var rt=s(m.VisibleForFrame,!0);x.setVisible(rt);var I=m.Alpha;I!=null&&x.setOpacity(I),x.setTag(m.Tag||0);var L=m.TouchEnable||!1;x.setTouchEnabled(L);var G=m.CallBackType;G!=null&&x.setCallbackType(G);var w=m.CallBackName;w&&x.setCallbackName(w);var O=m.Position;O!=null&&x.setPosition(O.X||0,O.Y||0);var j=m.Scale;if(j!=null){var Q=s(j.ScaleX,1),C=s(j.ScaleY,1);x.setScaleX(Q),x.setScaleY(C)}var b=m.AnchorPoint;b!=null&&x.setAnchorPoint(b.ScaleX||0,b.ScaleY||0);var W=m.CColor;W!=null&&x.setColor(d(W)),a(x,m),o(x,m)};var o=function(x,m){var v=m.CallBackType,A=m.CallBackName,D=function(N){typeof x[A]=="function"&&x[A](N)};v==="Click"?x.addClickEventListener(D):v==="Touch"?x.addTouchEventListener(D):v==="Event"&&x.addCCSEventListener(D)},a=function(x,m){var v=ccui.LayoutComponent.bindLayoutComponent(x);if(v){var A=m.PositionPercentXEnable||m.PositionPercentXEnabled||!1,D=m.PositionPercentYEnable||m.PositionPercentYEnabled||!1,N=0,z=0,M=m.PrePosition;M!=null&&(N=M.X||0,z=M.Y||0);var J=m.PercentWidthEnable||m.PercentWidthEnabled||!1,U=m.PercentHeightEnable||m.PercentHeightEnabled||!1,K=0,tt=0,rt=m.PreSize;M!=null&&(K=rt.X||0,tt=rt.Y||0);var I=m.StretchWidthEnable||!1,L=m.StretchHeightEnable||!1,G=m.HorizontalEdge,w=m.VerticalEdge,O=m.LeftMargin||0,j=m.RightMargin||0,Q=m.TopMargin||0,C=m.BottomMargin||0;v.setPositionPercentXEnabled(A),v.setPositionPercentYEnabled(D),v.setPositionPercentX(N),v.setPositionPercentY(z),v.setPercentWidthEnabled(J),v.setPercentHeightEnabled(U),v.setPercentWidth(K),v.setPercentHeight(tt),v.setPercentWidthEnabled(J||U),v.setStretchWidthEnabled(I),v.setStretchHeightEnabled(L);var b=ccui.LayoutComponent.horizontalEdge.NONE;G==="LeftEdge"?b=ccui.LayoutComponent.horizontalEdge.LEFT:G==="RightEdge"?b=ccui.LayoutComponent.horizontalEdge.RIGHT:G==="BothEdge"&&(b=ccui.LayoutComponent.horizontalEdge.CENTER),v.setHorizontalEdge(b);var W=ccui.LayoutComponent.verticalEdge.NONE;w==="TopEdge"?W=ccui.LayoutComponent.verticalEdge.TOP:w==="BottomEdge"?W=ccui.LayoutComponent.verticalEdge.BOTTOM:w==="BothEdge"&&(W=ccui.LayoutComponent.verticalEdge.CENTER),v.setVerticalEdge(W),v.setTopMargin(Q),v.setBottomMargin(C),v.setLeftMargin(O),v.setRightMargin(j),v.setVerticalEdge(W),v.setTopMargin(Q),v.setBottomMargin(C),v.setLeftMargin(O),v.setRightMargin(j)}},c=function(x,m,v,A){x.getBackGroundColorType()===2?(v=v||{},A=A||{},x.setBackGroundColor(d(v),d(A))):(m=m||{},x.setBackGroundColor(d(m)))},l=function(x,m){var v=m.ScaleX||0,A=m.ScaleY||0;x.setBackGroundColorVector(exports.cc.p(v,A))};n.initPanel=function(x,m){var v=new ccui.Layout;this.widgetAttributes(v,x);var A=x.ClipAble||!1;A!=null&&v.setClippingEnabled(A);var D=s(x.ComboBoxIndex,0);v.setBackGroundColorType(D);var N=s(x.BackColorAlpha,255);N!=null&&v.setBackGroundColorOpacity(N);var z=x.Scale9Enable;z!=null&&v.setBackGroundImageScale9Enabled(z);var M=s(x.Alpha,255);if(v.setOpacity(M),_(x.FileData,m,function(rt,I){v.setBackGroundImage(rt,I)}),z){var J=x.Scale9OriginX||0,U=x.Scale9OriginY||0,K=x.Scale9Width||0,tt=x.Scale9Height||0;v.setBackGroundImageCapInsets(exports.cc.rect(J,U,K,tt)),f(v,x.Size)}else v.isIgnoreContentAdaptWithSize()||f(v,x.Size);return c(v,x.SingleColor,x.FirstColor,x.EndColor),l(v,x.ColorVector),v},n.initText=function(x,m){var v=new ccui.Text,A=x.TouchScaleChangeAble;A!=null&&v.setTouchScaleChangeEnabled(A);var D=x.LabelText;D!=null&&v.setString(D);var N=x.FontSize;N!=null&&v.setFontSize(N);var z=x.FontName;z!=null&&v.setFontName(z);var M=x.AreaWidth,J=x.areaHeight;M&&J&&v.setTextAreaSize(exports.cc.size(M,J));var U=x.HorizontalAlignmentType||"HT_Left";switch(U){case"HT_Right":U=2;break;case"HT_Center":U=1;break;case"HT_Left":default:U=0}v.setTextHorizontalAlignment(U);var K=x.VerticalAlignmentType||"VT_Top";switch(K){case"VT_Bottom":K=2;break;case"VT_Center":K=1;break;case"VT_Top":default:K=0}v.setTextVerticalAlignment(K);var tt=x.FontResource;if(tt!=null){var rt=tt.Path;rt!=null&&(exports.cc.sys.isNative?z=exports.cc.path.join(exports.cc.loader.resPath,m,rt):(z=rt.match(/([^\/]+)\.(\S+)/),z=z?z[1]:""),v.setFontName(z))}x.OutlineEnabled&&x.OutlineColor&&v.enableOutline&&v.enableOutline(d(x.OutlineColor),s(x.OutlineSize,1)),x.ShadowEnabled&&x.ShadowColor&&v.enableShadow&&v.enableShadow(d(x.ShadowColor),exports.cc.size(s(x.ShadowOffsetX,2),s(x.ShadowOffsetY,-2)),x.ShadowBlurRadius||0);var I=x.IsCustomSize;I!=null&&v.ignoreContentAdaptWithSize(!I),v.setUnifySizeEnabled(!1);var L=x.CColor;return x.CColor=null,v.setTextColor(d(L)),this.widgetAttributes(v,x,v.isIgnoreContentAdaptWithSize()),x.CColor=L,v},n.initButton=function(x,m){var v=new ccui.Button;_(x.NormalFileData,m,function(I,L){v.loadTextureNormal(I,L)}),_(x.PressedFileData,m,function(I,L){v.loadTexturePressed(I,L)}),_(x.DisabledFileData,m,function(I,L){v.loadTextureDisabled(I,L)});var A=s(x.Scale9Enable,!1);A&&v.setScale9Enabled(A);var D=x.ButtonText;D!=null&&v.setTitleText(D);var N=x.FontSize;N!=null&&v.setTitleFontSize(N);var z=x.FontName;z!=null&&v.setTitleFontName(z);var M=x.TextColor;M!=null&&v.setTitleColor(d(M));var J=s(x.DisplayState,!0);v.setBright(J),v.setEnabled(J);var U=x.FontResource;if(U!=null){var K=U.Path;K!=null&&(exports.cc.sys.isNative?z=exports.cc.path.join(exports.cc.loader.resPath,m,K):(z=K.match(/([^\/]+)\.(\S+)/),z=z?z[1]:""),v.setTitleFontName(z))}var tt=v.getTitleRenderer();if(tt&&x.ShadowEnabled&&x.ShadowColor&&tt.enableShadow&&tt.enableShadow(d(x.ShadowColor),exports.cc.size(s(x.ShadowOffsetX,2),s(x.ShadowOffsetY,-2)),x.ShadowBlurRadius||0),tt&&x.OutlineEnabled&&x.OutlineColor&&tt.enableStroke&&tt.enableStroke(d(x.OutlineColor),s(x.OutlineSize,1)),this.widgetAttributes(v,x),A){v.setUnifySizeEnabled(!1),v.ignoreContentAdaptWithSize(!1);var rt=exports.cc.rect(x.Scale9OriginX||0,x.Scale9OriginY||0,x.Scale9Width||0,x.Scale9Height||0);v.setCapInsets(rt)}return f(v,x.Size),v},n.initCheckBox=function(x,m){var v=new ccui.CheckBox;this.widgetAttributes(v,x);var A=[{name:"NormalBackFileData",handle:v.loadTextureBackGround},{name:"PressedBackFileData",handle:v.loadTextureBackGroundSelected},{name:"NodeNormalFileData",handle:v.loadTextureFrontCross},{name:"DisableBackFileData",handle:v.loadTextureBackGroundDisabled},{name:"NodeDisableFileData",handle:v.loadTextureFrontCrossDisabled}];A.forEach(function(z){_(x[z.name],m,function(M,J){z.handle.call(v,M,J)})});var D=s(x.CheckedState,!1);v.setSelected(D);var N=s(x.DisplayState,!0);return v.setBright(N),v.setEnabled(N),v},n.initScrollView=function(x,m){var v=new ccui.ScrollView;this.widgetAttributes(v,x),_(x.FileData,m,function(G,w){v.setBackGroundImage(G,w)});var A=x.ClipAble||!1;v.setClippingEnabled(A);var D=s(x.ComboBoxIndex,0);v.setBackGroundColorType(D);var N=x.BackColorAlpha;N!=null&&v.setBackGroundColorOpacity(N);var z=x.Scale9Enable;if(z){v.setBackGroundImageScale9Enabled(!0);var M=x.Scale9OriginX||0,J=x.Scale9OriginY||0,U=x.Scale9Width||0,K=x.Scale9Height||0;v.setBackGroundImageCapInsets(exports.cc.rect(M,J,U,K)),f(v,x.Size)}else v.isIgnoreContentAdaptWithSize()||f(v,x.Size);c(v,x.SingleColor,x.FirstColor,x.EndColor),l(v,x.ColorVector);var tt=x.InnerNodeSize,rt=exports.cc.size(tt.Width||0,tt.Height||0);v.setInnerContainerSize(rt);var I=0;x.ScrollDirectionType==="Vertical"&&(I=1),x.ScrollDirectionType==="Horizontal"&&(I=2),x.ScrollDirectionType==="Vertical_Horizontal"&&(I=3),v.setDirection(I);var L=s(x.IsBounceEnabled,!1);return v.setBounceEnabled(L),v},n.initImageView=function(x,m){var v=new ccui.ImageView;_(x.FileData,m,function(J,U){v.loadTexture(J,U)}),_(x.ImageFileData,m,function(J,U){v.loadTexture(J,U)});var A=x.Scale9Enable;if(A){v.setScale9Enabled(!0),v.setUnifySizeEnabled(!1),v.ignoreContentAdaptWithSize(!1);var D=x.Scale9OriginX||0,N=x.Scale9OriginY||0,z=x.Scale9Width||0,M=x.Scale9Height||0;v.setCapInsets(exports.cc.rect(D,N,z,M))}else f(v,x.Size);return this.widgetAttributes(v,x),v},n.initLoadingBar=function(x,m){var v=new ccui.LoadingBar;this.widgetAttributes(v,x),_(x.ImageFileData,m,function(N,z){v.loadTexture(N,z)});var A=x.ProgressType==="Right_To_Left"?1:0;v.setDirection(A);var D=s(x.ProgressInfo,80);return D!=null&&v.setPercent(D),v},n.initSlider=function(x,m){var v=new ccui.Slider,A=exports.cc.loader;this.widgetAttributes(v,x);var D=[{name:"BackGroundData",handle:v.loadBarTexture},{name:"BallNormalData",handle:v.loadSlidBallTextureNormal},{name:"BallPressedData",handle:v.loadSlidBallTexturePressed},{name:"BallDisabledData",handle:v.loadSlidBallTextureDisabled},{name:"ProgressBarData",handle:v.loadProgressBarTexture}];D.forEach(function(M){_(x[M.name],m,function(J,U){U===0&&!A.getRes(J)&&exports.cc.log("%s need to be preloaded",J),M.handle.call(v,J,U)})});var N=x.PercentInfo||0;v.setPercent(N);var z=s(x.DisplayState,!0);return v.setBright(z),v.setEnabled(z),v},n.initPageView=function(x,m){var v=new ccui.PageView;this.widgetAttributes(v,x),_(x.FileData,m,function(tt,rt){v.setBackGroundImage(tt,rt)});var A=x.ClipAble||!1;v.setClippingEnabled(A);var D=x.Scale9Enable;if(D){v.setBackGroundImageScale9Enabled(!0);var N=x.Scale9OriginX||0,z=x.Scale9OriginY||0,M=x.Scale9Width||0,J=x.Scale9Height||0;v.setBackGroundImageCapInsets(exports.cc.rect(N,z,M,J))}var U=s(x.ComboBoxIndex,0);v.setBackGroundColorType(U),c(v,x.SingleColor,x.FirstColor,x.EndColor),l(v,x.ColorVector);var K=x.BackColorAlpha;return K!=null&&v.setBackGroundColorOpacity(K),f(v,x.Size),v},n.initListView=function(x,m){var v=new ccui.ListView;this.widgetAttributes(v,x),_(x.FileData,m,function(O,j){v.setBackGroundImage(O,j)});var A=x.ClipAble||!1;v.setClippingEnabled(A);var D=s(x.ComboBoxIndex,0);v.setBackGroundColorType(D);var N=s(x.BackColorAlpha,255),z=x.Scale9Enable;if(z){v.setBackGroundImageScale9Enabled(!0);var M=x.Scale9OriginX||0,J=x.Scale9OriginY||0,U=x.Scale9Width||0,K=x.Scale9Height||0;v.setBackGroundImageCapInsets(exports.cc.rect(M,J,U,K))}var tt=s(x.DirectionType,ccui.ListView.DIR_HORIZONTAL),rt=s(x.VerticalType,"Align_Left"),I=s(x.HorizontalType,"Align_Top");tt?tt==="Vertical"&&(v.setDirection(ccui.ScrollView.DIR_VERTICAL),I===""?v.setGravity(ccui.ListView.GRAVITY_LEFT):I==="Align_Right"?v.setGravity(ccui.ListView.GRAVITY_RIGHT):I==="Align_HorizontalCenter"&&v.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL)):(v.setDirection(ccui.ScrollView.DIR_HORIZONTAL),rt==="Align_Bottom"?v.setGravity(ccui.ListView.GRAVITY_BOTTOM):rt==="Align_VerticalCenter"?v.setGravity(ccui.ListView.GRAVITY_CENTER_VERTICAL):v.setGravity(ccui.ListView.GRAVITY_TOP));var L=s(x.IsBounceEnabled,!1);v.setBounceEnabled(L);var G=x.ItemMargin||0;v.setItemsMargin(G);var w=x.InnerNodeSize;return w!=null&&v.setInnerContainerSize(exports.cc.size(w.Widget||0,w.Height||0)),c(v,x.SingleColor,x.FirstColor,x.EndColor),l(v,x.ColorVector),N!=null&&v.setBackGroundColorOpacity(N),f(v,x.Size),v},n.initTextAtlas=function(x,m){var v=new ccui.TextAtlas,A=x.LabelText,D=x.CharWidth,N=x.CharHeight,z=x.StartChar;return _(x.LabelAtlasFileImage_CNB,m,function(M,J){exports.cc.loader.getRes(M)||exports.cc.log("%s need to be preloaded",M),J===0&&v.setProperty(A,M,D,N,z)}),this.widgetAttributes(v,x),v.ignoreContentAdaptWithSize(!0),v},n.initTextBMFont=function(x,m){var v=new ccui.TextBMFont;this.widgetAttributes(v,x);var A=x.LabelText;return v.setString(A),_(x.LabelBMFontFile_CNB,m,function(D,N){exports.cc.loader.getRes(D)||exports.cc.log("%s need to be pre loaded",D),v.setFntFile(D)}),v.ignoreContentAdaptWithSize(!0),v},n.initTextField=function(x,m){var v=new ccui.TextField,A=x.PasswordEnable;if(A){v.setPasswordEnabled(!0);var D=x.PasswordStyleText||"*";v.setPasswordStyleText(D)}var N=x.PlaceHolderText;N!=null&&v.setPlaceHolder(N);var z=x.FontSize;z!=null&&v.setFontSize(z);var M=x.FontName;M!=null&&v.setFontName(M);var J=x.MaxLengthEnable;if(J){v.setMaxLengthEnabled(!0);var U=x.MaxLengthText||0;v.setMaxLength(U)}this.widgetAttributes(v,x);var K=x.LabelText;K!=null&&v.setString(K);var tt=x.FontResource;if(tt!=null){var rt=tt.Path;rt!=null&&(exports.cc.sys.isNative?M=exports.cc.path.join(exports.cc.loader.resPath,m,rt):(M=rt.match(/([^\/]+)\.(\S+)/),M=M?M[1]:""),v.setFontName(M))}v.setUnifySizeEnabled(!1),v.ignoreContentAdaptWithSize(!1);var I=x.CColor;return I!=null&&v.setTextColor(d(I)),v.isIgnoreContentAdaptWithSize()||(f(v,x.Size),exports.cc.sys.isNative&&v.getVirtualRenderer().setLineBreakWithoutSpace(!0)),v},n.initSimpleAudio=function(x,m){var v=new ccs.ComAudio,A=x.Loop||!1;v.setLoop(A),_(x.FileData,m,function(D,N){v.setFile(D)})},n.initGameMap=function(x,m){var v=null;return _(x.FileData,m,function(A,D){D===0&&(v=new exports.cc.TMXTiledMap(A)),n.generalAttributes(v,x)}),v},n.initProjectNode=function(x,m){var v=x.FileData;if(v!=null&&v.Path){var A=m+v.Path;if(exports.cc.loader.getRes(A)){var D=ccs.load(A,m);if(n.generalAttributes(D.node,x),D.action&&D.node){D.action.tag=D.node.tag;var N=x.InnerActionSpeed;N!==void 0&&D.action.setTimeSpeed(N),D.node.runAction(D.action),D.action.gotoFrameAndPause(0)}return D.node}else exports.cc.log("%s need to be preloaded",A)}};var h=function(x){if(!x)return"";var m=x.match(/([^\/]+)\.[^\/]+$/);return m&&m[1]?m[1]:""};n.initArmature=function(x,m){var v=new ccs.Armature,A=x.IsLoop,D=x.IsAutoPlay,N=x.CurrentAnimationName;return _(x.FileData,m,function(z,M){var J,U,K=exports.cc.loader.getRes(z);K?(J=K.config_file_path,U=K.config_png_path,J.forEach(function(tt,rt){U[rt]&&exports.cc.spriteFrameCache.addSpriteFrames(tt,U[rt])})):exports.cc.log("%s need to be preloaded",z),ccs.armatureDataManager.addArmatureFileInfo(z),v.init(h(z)),D?v.getAnimation().play(N,-1,A):(v.getAnimation().play(N),v.getAnimation().gotoAndPause(0))}),delete x.AnchorPoint,delete x.Size,n.generalAttributes(v,x),v.setColor(d(x.CColor)),v},n.initBoneNode=function(x,m){var v=new ccs.BoneNode,A=x.Length;A!==void 0&&v.setDebugDrawLength(A);var D=x.BlendFunc;D&&D.Src!==void 0&&D.Dst!==void 0&&v.setBlendFunc(new exports.cc.BlendFunc(D.Src,D.Dst)),n.generalAttributes(v,x);var N=x.CColor;return N&&(N.R!==void 0||N.G!==void 0||N.B!==void 0)&&v.setColor(d(N)),v},n.initSkeletonNode=function(x){var m=new ccs.SkeletonNode;n.generalAttributes(m,x);var v=x.CColor;return v&&(v.R!==void 0||v.G!==void 0||v.B!==void 0)&&m.setColor(d(v)),m};var u={},_=function(x,m,v){if(x!=null){var A=x.Path,D;x.Type==="Default"||x.Type==="Normal"?D=0:D=1;var N=x.Plist;N&&(exports.cc.loader.getRes(m+N)?(u[m+N]=!0,exports.cc.spriteFrameCache.addSpriteFrames(m+N)):!u[m+N]&&!exports.cc.spriteFrameCache.getSpriteFrame(A)&&exports.cc.log("%s need to be preloaded",m+N)),D!==0?exports.cc.spriteFrameCache.getSpriteFrame(A)?v(A,D):exports.cc.log("failed to get spriteFrame: %s",A):v(m+A,D)}},d=function(x){if(x){var m=x.R!=null?x.R:255,v=x.G!=null?x.G:255,A=x.B!=null?x.B:255,D=x.A!=null?x.A:255;return exports.cc.color(m,v,A,D)}},f=function(x,m){var v=m.X||0,A=m.Y||0;m&&x.setContentSize(exports.cc.size(v,A))},T=[{name:"SingleNodeObjectData",handle:n.initSingleNode},{name:"NodeObjectData",handle:n.initSingleNode},{name:"LayerObjectData",handle:n.initSingleNode},{name:"GameNodeObjectData",handle:n.initSingleNode},{name:"GameLayerObjectData",handle:n.initSingleNode},{name:"SpriteObjectData",handle:n.initSprite},{name:"ParticleObjectData",handle:n.initParticle},{name:"PanelObjectData",handle:n.initPanel},{name:"TextObjectData",handle:n.initText},{name:"ButtonObjectData",handle:n.initButton},{name:"CheckBoxObjectData",handle:n.initCheckBox},{name:"ScrollViewObjectData",handle:n.initScrollView},{name:"ImageViewObjectData",handle:n.initImageView},{name:"LoadingBarObjectData",handle:n.initLoadingBar},{name:"SliderObjectData",handle:n.initSlider},{name:"PageViewObjectData",handle:n.initPageView},{name:"ListViewObjectData",handle:n.initListView},{name:"TextAtlasObjectData",handle:n.initTextAtlas},{name:"TextBMFontObjectData",handle:n.initTextBMFont},{name:"TextFieldObjectData",handle:n.initTextField},{name:"SimpleAudioObjectData",handle:n.initSimpleAudio},{name:"GameMapObjectData",handle:n.initGameMap},{name:"ProjectNodeObjectData",handle:n.initProjectNode},{name:"ArmatureNodeObjectData",handle:n.initArmature},{name:"BoneNodeObjectData",handle:n.initBoneNode},{name:"SkeletonNodeObjectData",handle:n.initSkeletonNode}];T.forEach(function(x){n.registerParser(x.name,function(m,v){var A=x.handle.call(this,m,v);return this.parseChild(A,m.Children,v),A})}),t.registerParser("timeline","2.*",n),t.registerParser("timeline","*",n)})(ccs._load,ccs._parser);(function(t,e){var r=e.extend({addSpriteFrame:function(c,l){if(c)for(var h=0;h<c.length;h++)exports.cc.spriteFrameCache.addSpriteFrames(l+c[h])},pretreatment:function(c,l){this.addSpriteFrame(c.textures,l)},deferred:function(c,l,h,u){h&&(ccs.actionManager.initWithDictionary(u,c.animation,h),h.setContentSize(exports.cc.size(c.designWidth,c.designHeight)))}}),n=new r;n.generalAttributes=function(c,l){var h=l.ignoreSize;h!=null&&c.ignoreContentAdaptWithSize(h),l.sizeType&&c.setSizeType(l.sizeType),l.positionType&&c.setPositionType(l.positionType),c.setSizePercent(exports.cc.p(l.sizePercentX,l.sizePercentY)),c.setPositionPercent(exports.cc.p(l.positionPercentX,l.positionPercentY));var u=0,_=0,d=l.adaptScreen;if(d){var f=exports.cc.director.getWinSize();u=f.width,_=f.height}else u=l.width,_=l.height;c.setContentSize(u,_),c.setTag(l.tag),c.setActionTag(l.actiontag),c.setTouchEnabled(l.touchAble);var T=l.name,x=T||"default";c.setName(x);var m=l.x,v=l.y;c.setPosition(m,v);var A=l.scaleX!=null?l.scaleX:1;c.setScaleX(A);var D=l.scaleY!=null?l.scaleY:1;c.setScaleY(D);var N=l.rotation||0;c.setRotation(N);var z=l.visible||!1;z!=null&&c.setVisible(z),c.setLocalZOrder(l.ZOrder);var M=l.layoutParameter;if(M!=null){var J=l.layoutParameter,U=J.type,K=null;switch(U){case 0:break;case 1:K=new ccui.LinearLayoutParameter;var tt=J.gravity;K.setGravity(tt);break;case 2:K=new ccui.RelativeLayoutParameter;var rt=K,I=J.relativeName;rt.setRelativeName(I);var L=J.relativeToName;rt.setRelativeToWidgetName(L);var G=J.align;rt.setAlign(G);break}if(K!=null){var w=J.marginLeft||0,O=J.marginTop||0,j=J.marginRight||0,Q=J.marginDown||0;K.setMargin(w,O,j,Q),c.setLayoutParameter(K)}}},n.colorAttributes=function(c,l){var h=l.opacity;h!=null&&c.setOpacity(h);var u=l.colorR,_=l.colorG,d=l.colorB;c.setColor(exports.cc.color(u==null?255:u,_==null?255:_,d==null?255:d)),c.setFlippedX(l.flipX),c.setFlippedY(l.flipY)},n.anchorPointAttributes=function(c,l){var h=l.anchorPointX,u;h!=null?u=l.anchorPointX:u=c.getAnchorPoint().x;var _=l.anchorPointY,d;_!=null?d=l.anchorPointY:d=c.getAnchorPoint().y,(h!=null||_!=null)&&c.setAnchorPoint(exports.cc.p(u,d))},n.parseChild=function(c,l,h){for(var u=l.children,_=0;_<u.length;_++){var d=this.parseNode(u[_],h);if(d)if(c instanceof ccui.PageView)c.addPage(d);else if(c instanceof ccui.ListView)c.pushBackCustomItem(d);else{if(!(c instanceof ccui.Layout)){if(d.getPositionType()===ccui.Widget.POSITION_PERCENT){var f=d.getPositionPercent(),T=c.getAnchorPoint();d.setPositionPercent(exports.cc.p(f.x+T.x,f.y+T.y))}var x=c.getAnchorPointInPoints();d.setPosition(exports.cc.p(d.getPositionX()+x.x,d.getPositionY()+x.y))}c.addChild(d)}}};var s=function(c,l,h,u){h&&u(l===0?c+h:h,l)};n.LayoutAttributes=function(c,l,h){var u=0,_=0,d=l.adaptScreen;if(d){var f=exports.cc.director.getWinSize();u=f.width,_=f.height}else u=l.width,_=l.height;c.setSize(exports.cc.size(u,_)),c.setClippingEnabled(l.clipAble);var T=l.backGroundScale9Enable;c.setBackGroundImageScale9Enabled(T);var x=l.bgColorR,m=l.bgColorG,v=l.bgColorB,A=l.bgStartColorR,D=l.bgStartColorG,N=l.bgStartColorB,z=l.bgEndColorR,M=l.bgEndColorG,J=l.bgEndColorB,U=l.vectorX,K=l.vectorY;c.setBackGroundColorVector(exports.cc.p(U,K));var tt=l.bgColorOpacity,rt=l.colorType;c.setBackGroundColorType(rt),c.setBackGroundColor(exports.cc.color(A,D,N),exports.cc.color(z,M,J)),c.setBackGroundColor(exports.cc.color(x,m,v)),c.setBackGroundColorOpacity(tt);var I=l.backGroundImageData;if(I&&s(h,I.resourceType,I.path,function(j,Q){c.setBackGroundImage(j,Q)}),T){var L=l.capInsetsX,G=l.capInsetsY,w=l.capInsetsWidth,O=l.capInsetsHeight;c.setBackGroundImageCapInsets(exports.cc.rect(L,G,w,O))}l.layoutType&&c.setLayoutType(l.layoutType)},n.ButtonAttributes=function(c,l,h){var u=c,_=l.scale9Enable;u.setScale9Enabled(_);var d=l.normalData;s(h,d.resourceType,d.path,function(G,w){u.loadTextureNormal(G,w)});var f=l.pressedData;s(h,f.resourceType,f.path,function(G,w){u.loadTexturePressed(G,w)});var T=l.disabledData;if(s(h,T.resourceType,T.path,function(G,w){u.loadTextureDisabled(G,w)}),_){var x=l.capInsetsX,m=l.capInsetsY,v=l.capInsetsWidth,A=l.capInsetsHeight;u.setCapInsets(exports.cc.rect(x,m,v,A));var D=l.scale9Width,N=l.scale9Height;D!=null&&N!=null&&u.setSize(exports.cc.size(D,N))}var z=l.text;z!=null&&u.setTitleText(z);var M=l.textColorR,J=l.textColorG,U=l.textColorB,K=M!==null?l.textColorR:255,tt=J!==null?l.textColorG:255,rt=U!==null?l.textColorB:255;u.setTitleColor(exports.cc.color(K,tt,rt));var I=l.fontSize;I!=null&&u.setTitleFontSize(l.fontSize);var L=l.fontName;L&&u.setTitleFontName(l.fontName)},n.CheckBoxAttributes=function(c,l,h){var u=l.backGroundBoxData;s(h,u.resourceType,u.path,function(x,m){c.loadTextureBackGround(x,m)});var _=l.backGroundBoxSelectedData;s(h,_.resourceType||u.resourceType,_.path||u.path,function(x,m){c.loadTextureBackGroundSelected(x,m)});var d=l.frontCrossData;s(h,d.resourceType,d.path,function(x,m){c.loadTextureFrontCross(x,m)});var f=l.backGroundBoxDisabledData;s(h,f.resourceType||d.resourceType,f.path||d.path,function(x,m){c.loadTextureBackGroundDisabled(x,m)});var T=l.frontCrossDisabledData;s(h,T.resourceType,T.path,function(x,m){c.loadTextureFrontCrossDisabled(x,m)}),l.selectedState&&c.setSelected(l.selectedState)},n.ImageViewAttributes=function(c,l,h){var u=l.fileNameData;s(h,u.resourceType,u.path,function(z,M){c.loadTexture(z,M)});var _=l.scale9Enable,d=!1;if(_&&(d=l.scale9Enable),c.setScale9Enabled(d),d){var f=l.scale9Width,T=l.scale9Height;if(f&&T){var x=l.scale9Width,m=l.scale9Height;c.setSize(exports.cc.size(x,m))}var v=l.capInsetsX,A=l.capInsetsY,D=l.capInsetsWidth,N=l.capInsetsHeight;c.setCapInsets(exports.cc.rect(v,A,D,N))}},n.TextAtlasAttributes=function(c,l,h){var u=l.stringValue,_=l.charMapFileData,d=l.itemWidth,f=l.itemHeight,T=l.startCharMap;if(u!=null&&_&&d!=null&&f!=null&&T!=null){var x=l.charMapFileData,m=x.resourceType;switch(m){case 0:var v=h,A=x.path,D=v+A;c.setProperty(u,D,d,f,T);break;case 1:exports.cc.log("Wrong res type of LabelAtlas!");break}}},n.TextBMFontAttributes=function(c,l,h){var u=l.fileNameData,_=u.resourceType;switch(_){case 0:var d=h,f=u.path,T=d+f;c.setFntFile(T);break;case 1:exports.cc.log("Wrong res type of LabelAtlas!");break}var x=l.text;c.setString(x)};var o=/\.ttf$/;n.TextAttributes=function(c,l,h){var u=l.touchScaleEnable;c.setTouchScaleChangeEnabled(u);var _=l.text;c.setString(_);var d=l.fontSize;d!=null&&c.setFontSize(l.fontSize);var f=l.fontName;f!=null&&(exports.cc.sys.isNative?o.test(f)?c.setFontName(exports.cc.path.join(exports.cc.loader.resPath,h,f)):c.setFontName(f):c.setFontName(f.replace(o,"")));var T=l.areaWidth,x=l.areaHeight;if(T!=null&&x!=null){var m=exports.cc.size(l.areaWidth,l.areaHeight);c.setTextAreaSize(m)}var v=l.hAlignment;v!=null&&c.setTextHorizontalAlignment(l.hAlignment);var A=l.vAlignment;A!=null&&c.setTextVerticalAlignment(l.vAlignment)},n.ListViewAttributes=function(c,l,h){n.ScrollViewAttributes(c,l,h);var u=l.direction;c.setDirection(u);var _=l.gravity;c.setGravity(_);var d=l.itemMargin;c.setItemsMargin(d)},n.LoadingBarAttributes=function(c,l,h){var u=l.textureData;s(h,u.resourceType,u.path,function(A,D){c.loadTexture(A,D)});var _=l.scale9Enable;if(c.setScale9Enabled(_),_){var d=l.capInsetsX,f=l.capInsetsY,T=l.capInsetsWidth,x=l.capInsetsHeight;c.setCapInsets(exports.cc.rect(d,f,T,x));var m=l.width,v=l.height;c.setSize(exports.cc.size(m,v))}c.setDirection(l.direction),c.setPercent(l.percent)},n.PageViewAttributes=n.LayoutAttributes,n.ScrollViewAttributes=function(c,l,h){n.LayoutAttributes(c,l,h);var u=l.innerWidth!=null?l.innerWidth:200,_=l.innerHeight!=null?l.innerHeight:200;c.setInnerContainerSize(exports.cc.size(u,_));var d=l.direction!=null?l.direction:1;c.setDirection(d),c.setBounceEnabled(l.bounceEnable)},n.SliderAttributes=function(c,l,h){var u=c,_=l.scale9Enable;u.setScale9Enabled(_);var d=l.barFileName,f=l.length,T=l.barFileNameData,x=T.resourceType,m=T.path;d!=null?_&&(s(h,x,m,function(z,M){u.loadBarTexture(z,M)}),u.setSize(exports.cc.size(f,u.getContentSize().height))):s(h,x,m,function(z,M){u.loadBarTexture(z,M)});var v=l.ballNormalData;s(h,v.resourceType,v.path,function(z,M){u.loadSlidBallTextureNormal(z,M)});var A=l.ballPressedData;s(h,A.resourceType||v.resourceType,A.path||v.path,function(z,M){u.loadSlidBallTexturePressed(z,M)});var D=l.ballDisabledData;s(h,D.resourceType,D.path,function(z,M){u.loadSlidBallTextureDisabled(z,M)});var N=l.progressBarData;s(h,N.resourceType,N.path,function(z,M){u.loadProgressBarTexture(z,M)})},n.TextFieldAttributes=function(c,l,h){var u=l.placeHolder;u&&c.setPlaceHolder(u),c.setString(l.text||"");var _=l.fontSize;_&&c.setFontSize(_);var d=l.fontName;d!=null&&(exports.cc.sys.isNative?o.test(d)?c.setFontName(exports.cc.path.join(exports.cc.loader.resPath,h,d)):c.setFontName(d):c.setFontName(d.replace(o,"")));var f=l.touchSizeWidth,T=l.touchSizeHeight;f!=null&&T!=null&&c.setTouchSize(f,T),l.width,l.height;var x=l.maxLengthEnable;if(c.setMaxLengthEnabled(x),x){var m=l.maxLength;c.setMaxLength(m)}var v=l.passwordEnable;c.setPasswordEnabled(v),v&&c.setPasswordStyleText(l.passwordStyleText);var A=l.areaWidth,D=l.areaHeight;if(A&&D){var N=exports.cc.size(A,D);c.setTextAreaSize(N)}var z=l.hAlignment;z&&c.setTextHorizontalAlignment(z);var M=l.vAlignment;M&&c.setTextVerticalAlignment(M);var J=l.colorR,U=l.colorG,K=l.colorB;J!==void 0&&U!==void 0&&K!==void 0&&c.setTextColor(exports.cc.color(J,U,K))};var a=[{name:"Panel",object:ccui.Layout,handle:n.LayoutAttributes},{name:"Button",object:ccui.Button,handle:n.ButtonAttributes},{name:"CheckBox",object:ccui.CheckBox,handle:n.CheckBoxAttributes},{name:"ImageView",object:ccui.ImageView,handle:n.ImageViewAttributes},{name:"LabelAtlas",object:ccui.TextAtlas,handle:n.TextAtlasAttributes},{name:"LabelBMFont",object:ccui.TextBMFont,handle:n.TextBMFontAttributes},{name:"Label",object:ccui.Text,handle:n.TextAttributes},{name:"ListView",object:ccui.ListView,handle:n.ListViewAttributes},{name:"LoadingBar",object:ccui.LoadingBar,handle:n.LoadingBarAttributes},{name:"PageView",object:ccui.PageView,handle:n.PageViewAttributes},{name:"ScrollView",object:ccui.ScrollView,handle:n.ScrollViewAttributes},{name:"Slider",object:ccui.Slider,handle:n.SliderAttributes},{name:"TextField",object:ccui.TextField,handle:n.TextFieldAttributes}];a.forEach(function(c){n.registerParser(c.name,function(l,h){var u=new c.object,_=l.options;return n.generalAttributes(u,_),c.handle(u,_,h),n.colorAttributes(u,_),n.anchorPointAttributes(u,_),n.parseChild.call(this,u,l,h),u})}),t.registerParser("ccui","*",n)})(ccs._load,ccs._parser);(function(){ccs.uiReader={_fileDesignSizes:{},widgetFromJsonFile:function(e){var r=exports.cc.loader.getRes(e);r&&(this._fileDesignSizes[e]=exports.cc.size(r.designWidth||0,r.designHeight||0));var n=r.Version||r.version,s=ccs.uiReader.getVersionInteger(n);return!n||s>=1700?(exports.cc.warn("Not supported file types, Please try use the ccs.load"),null):ccs._load(e,"ccui")},registerTypeAndCallBack:function(e,r,n,s){var o=ccs._load.getParser("ccui")["*"],a=s.bind(n);o.registerParser(e,function(c,l){var h=new r,u=c.options;n.setPropsFromJsonDictionary&&n.setPropsFromJsonDictionary(h,u),this.generalAttributes(h,u);var _=u.customProperty;return _?_=JSON.parse(_):_={},a(e,h,_),this.colorAttributes(h,u),this.anchorPointAttributes(h,u),this.parseChild.call(this,h,c,l),h})},getVersionInteger:function(e){if(!e||typeof e!="string")return 0;var r=e.split(".");if(r.length!==4)return 0;var n=0;return r.forEach(function(s,o){n+=s*Math.pow(10,3-o)}),n},storeFileDesignSize:function(e,r){this._fileDesignSizes[e]=r},getFileDesignSize:function(e){return this._fileDesignSizes[e]},getFilePath:function(){return this._filePath},setFilePath:function(e){this._filePath=e},getParseObjectMap:function(){return ccs._load.getParser("ccui")["*"].parsers},getParseCallBackMap:function(){return ccs._load.getParser("ccui")["*"].parsers},clear:function(){}};var t=ccs._load.getParser("ccui")["*"];ccs.imageViewReader={setPropsFromJsonDictionary:t.ImageViewAttributes},ccs.buttonReader={setPropsFromJsonDictionary:t.ButtonAttributes},ccs.checkBoxReader={setPropsFromJsonDictionary:t.CheckBoxAttributes},ccs.labelAtlasReader={setPropsFromJsonDictionary:t.TextAtlasAttributes},ccs.labelBMFontReader={setPropsFromJsonDictionary:t.TextBMFontAttributes},ccs.labelReader={setPropsFromJsonDictionary:t.TextAttributes},ccs.layoutReader={setPropsFromJsonDictionary:t.LayoutAttributes},ccs.listViewReader={setPropsFromJsonDictionary:t.ListViewAttributes},ccs.loadingBarReader={setPropsFromJsonDictionary:t.LoadingBarAttributes},ccs.pageViewReader={setPropsFromJsonDictionary:t.PageViewAttributes},ccs.scrollViewReader={setPropsFromJsonDictionary:t.ScrollViewAttributes},ccs.sliderReader={setPropsFromJsonDictionary:t.SliderAttributes},ccs.textFieldReader={setPropsFromJsonDictionary:t.TextFieldAttributes}})();(function(){ccs.sceneReader={_node:null,createNodeWithSceneFile:function(t){var e=ccs._load(t,"scene");return this._node=e,e},getNodeByTag:function(t){return this._node==null?null:this._node.getTag()===t?this._node:this._nodeByTag(this._node,t)},_nodeByTag:function(t,e){if(t==null)return null;for(var r=null,n=t.getChildren(),s=0;s<n.length;s++){var o=n[s];if(o&&o.getTag()===e){r=o;break}else if(r=this._nodeByTag(o,e),r)break}return r},version:function(){return"*"},setTarget:function(){},clear:function(){ccs.triggerManager.removeAll(),exports.cc.audioEngine.end()}}})();(function(){ccs.Armature.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._parentCmd=null,this._realAnchorPointInPoints=new exports.cc.Point(0,0)};var t=ccs.Armature.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);exports.cc.inject(ccs.Armature.RenderCmd,t),t.constructor=ccs.Armature.WebGLRenderCmd,t.uploadData=function(e,r,n){for(var s=this._node,o,a=this._parentCmd||this,c=s._children,l=exports.cc.BlendFunc.ALPHA_PREMULTIPLIED,h=exports.cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,u=0,_=c.length;u<_;u++){var d=c[u],f=d._renderCmd;if(d&&d.getDisplayRenderNode){var T=d.getDisplayRenderNode();if(T===null)continue;switch(o=T._renderCmd,d.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:if(T instanceof ccs.Skin){T.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(o,d),o.transform(a);var x=d.getBlendFunc();if(x.src!==l.src||x.dst!==l.dst)T.setBlendFunc(d.getBlendFunc());else{var m=T.getTexture();s._blendFunc.src===l.src&&s._blendFunc.dst===l.dst&&m&&!m.hasPremultipliedAlpha()?T.setBlendFunc(h):T.setBlendFunc(s._blendFunc)}exports.cc.renderer._uploadBufferData(o)}break;case ccs.DISPLAY_TYPE_ARMATURE:T.setShaderProgram(this._shaderProgram),o._parentCmd=this||window;default:f._syncStatus(a),o._syncStatus(f),o.uploadData?exports.cc.renderer._uploadBufferData(o):o.rendering&&(exports.cc.renderer._batchRendering(),o.rendering(exports.cc._renderContext));break}}else d instanceof exports.cc.Node&&(d.setShaderProgram(this._shaderProgram),f._syncStatus(a),f.uploadData?exports.cc.renderer._uploadBufferData(f):f.rendering&&(exports.cc.renderer._batchRendering(),f.rendering(exports.cc._renderContext)))}return this._parentCmd=null,0},t.initShaderCache=function(){this._shaderProgram=exports.cc.shaderCache.programForKey(exports.cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},t.setShaderProgram=function(e){this._shaderProgram=e},t._updateColorAndOpacity=function(e,r){var n=r._renderCmd._displayedColor,s=r._renderCmd._displayedOpacity,o=exports.cc.Node._dirtyFlags,a=e._dirtyFlag,c=a&o.colorDirty,l=a&o.opacityDirty;c&&e._updateDisplayColor(n),l&&e._updateDisplayOpacity(s),(c||l)&&e._updateColor()},t.visit=function(e){var r=this._node;if(r._visible){e=e||this.getParentRenderCmd(),e&&(this._curLevel=e._curLevel+1),this._syncStatus(e),r.sortAllChildren();var n=exports.cc.renderer,s=r._children,o,a,c=s.length;for(isNaN(r._customZ)&&(r._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep),a=0;a<c&&(o=s[a],o._localZOrder<0);a++)isNaN(o._customZ)&&(o._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep);for(n.pushRenderCommand(this);a<c;a++)o=s[a],isNaN(o._customZ)&&(o._vertexZ=n.assignedZ,n.assignedZ+=n.assignedZStep);this._dirtyFlag=0}}})();exports.cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=t._running===void 0?!1:!t._running;exports.cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=t.constructor.prototype.__pid;if(!e){var r={writable:!0,enumerable:!1,configurable:!0};r.value=ClassManager.getNewID(),Object.defineProperty(t.constructor.prototype,"__pid",r)}this._pool[e]||(this._pool[e]=[]),t.retain&&t.retain(),t.unuse&&t.unuse(),this._pool[e].push(t)},hasObject:function(t){var e=t.prototype.__pid,r=this._pool[e];return!(!r||r.length===0)},removeObject:function(t){var e=t.constructor.prototype.__pid;if(e){var r=this._pool[e];if(r)for(var n=0;n<r.length;n++)t===r[n]&&(t.release&&t.release(),r.splice(n,1))}},getFromPool:function(t){if(this.hasObject(t)){var e=t.prototype.__pid,r=this._pool[e],n=Array.prototype.slice.call(arguments);n.shift();var s=r.pop();return s.reuse&&s.reuse.apply(s,n),exports.cc.sys.isNative&&s.release&&this._autoRelease(s),s}},drainAllPools:function(){for(var t in this._pool)for(var e=0;e<this._pool[t].length;e++){var r=this._pool[t][e];r.release&&r.release()}this._pool={}}};(function(){if(exports.cc!==void 0){var PluginManager=function(){};PluginManager.prototype={constructor:PluginManager,getInstance:function(){return this},loadPlugin:function(t){},unloadPlugin:function(t){}};var PluginAssembly=function(){};PluginAssembly.prototype={constructor:PluginAssembly,setDebugMode:function(t){},startSession:function(t){},setCaptureUncaughtException:function(t){},callFuncWithParam:function(t){if(typeof this[t]=="function")return this[t].apply(this,Array.prototype.splice.call(arguments,1));exports.cc.log("function is not define")},callStringFuncWithParam:function(t){this.callFuncWithParam.apply(arguments)},getPluginName:function(){return this._name},getPluginVersion:function(){return this._version}},PluginAssembly.extend=function(name,porp){var p,prototype={};for(p in PluginAssembly.prototype)prototype[p]=PluginAssembly.prototype[p];for(p in porp)prototype[p]=porp[p];var tmp=eval("(function "+name+"Plugin(){})");return prototype.constructor=tmp,tmp.prototype=prototype,tmp};var Param=function(t,e){var r=plugin.PluginParam.ParamType,n;switch(t){case r.TypeInt:n=parseInt(e);break;case r.TypeFloat:n=parseFloat(e);break;case r.TypeBool:n=!!e;break;case r.TypeString:n=String(e);break;case r.TypeStringMap:n=e;break;default:n=e}return n};Param.ParamType={TypeInt:1,TypeFloat:2,TypeBool:3,TypeString:4,TypeStringMap:5},Param.AdsResultCode={AdsReceived:0,FullScreenViewShown:1,FullScreenViewDismissed:2,PointsSpendSucceed:3,PointsSpendFailed:4,NetworkError:5,UnknownError:6},Param.PayResultCode={PaySuccess:0,PayFail:1,PayCancel:2,PayTimeOut:3},Param.ShareResultCode={ShareSuccess:0,ShareFail:1,ShareCancel:2,ShareTimeOut:3};var PluginList={},Plugin={extend:function(t,e){var r=exports.cc.game.config&&exports.cc.game.config.plugin||{};PluginList[t]=new(PluginAssembly.extend(t,e)),typeof PluginList[t].ctor=="function"&&PluginList[t].ctor(r[t])},PluginList,PluginParam:Param,PluginManager:new PluginManager};window.plugin=Plugin}})();(function(){var t={_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(r,n){if(exports.cc.Sprite.prototype.ctor.call(this),r===void 0)exports.cc.PhysicsSprite.prototype.init.call(this);else if(exports.cc.isString(r))if(r[0]==="#"){var s=r.substr(1,r.length-1),o=exports.cc.spriteFrameCache.getSpriteFrame(s);this.initWithSpriteFrame(o)}else this.init(r,n);else exports.cc.isObject(r)&&(r instanceof exports.cc.Texture2D?this.initWithTexture(r,n):r instanceof exports.cc.SpriteFrame&&this.initWithSpriteFrame(r));exports.cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){exports.cc.renderer.pushRenderCommand(this._renderCmd),exports.cc.Sprite.prototype.visit.call(this)},setBody:function(r){this._body=r},getBody:function(){return this._body},getPosition:function(){var r=this._body;return{x:r.p.x,y:r.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(r,n){n===void 0?(this._body.p.x=r.x,this._body.p.y=r.y):(this._body.p.x=r,this._body.p.y=n)},setPositionX:function(r){this._body.p.x=r},setPositionY:function(r){this._body.p.y=r},_syncPosition:function(){var r=this._position,n=this._body;(r.x!==n.p.x||r.y!==n.p.y)&&exports.cc.Sprite.prototype.setPosition.call(this,n.p.x,n.p.y)},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-exports.cc.radiansToDegrees(this._body.a)},setRotation:function(r){this._ignoreBodyRotation?exports.cc.Sprite.prototype.setRotation.call(this,r):this._body.a=-exports.cc.degreesToRadians(r)},_syncRotation:function(){var r=-exports.cc.radiansToDegrees(this._body.a);this._rotationX!==r&&exports.cc.Sprite.prototype.setRotation.call(this,r)},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(r){this._ignoreBodyRotation=r},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.PhysicsSprite.CanvasRenderCmd(this):new exports.cc.PhysicsSprite.WebGLRenderCmd(this)}};exports.cc.PhysicsSprite=exports.cc.Sprite.extend(t),exports.cc.PhysicsSprite._className="PhysicsSprite";var e=exports.cc.PhysicsSprite.prototype;e.body,exports.cc.defineGetterSetter(e,"body",e.getBody,e.setBody),e.dirty,exports.cc.defineGetterSetter(e,"dirty",e.isDirty,e.setDirty),exports.cc.PhysicsSprite.create=function(r,n){return new exports.cc.PhysicsSprite(r,n)},exports.cc.PhysicsSprite.createWithSpriteFrameName=exports.cc.PhysicsSprite.create,exports.cc.PhysicsSprite.createWithSpriteFrame=exports.cc.PhysicsSprite.create})();(function(){exports.cc.PhysicsSprite.CanvasRenderCmd=function(e){exports.cc.Sprite.CanvasRenderCmd.call(this,e),this._needDraw=!0};var t=exports.cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(exports.cc.Sprite.CanvasRenderCmd.prototype);t.constructor=exports.cc.PhysicsSprite.CanvasRenderCmd,t.rendering=function(e,r,n){var s=this._node;s._syncPosition(),s._ignoreBodyRotation||s._syncRotation(),this.transform(this.getParentRenderCmd()),exports.cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,e,r,n)}})();exports.cc.__convertVerts=function(t){for(var e=[],r=0;r<t.length/2;r++)e[r]={x:t[r*2],y:t[r*2+1]};return e};exports.cc.ColorForBody=function(t){return t.isRogue()||t.isSleeping()?exports.cc.color(128,128,128,128):t.nodeIdleTime>t.space.sleepTimeThreshold?exports.cc.color(84,84,84,128):exports.cc.color(255,0,0,128)};exports.cc.DrawShape=function(t,e){var r=t.body,n=exports.cc.ColorForBody(r);switch(t.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(t.tc,Math.max(t.r,1),n),this.drawSegment(t.tc,cp.v.add(t.tc,cp.v.mult(r.rot,t.r)),1,n);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(t.ta,t.tb,Math.max(t.r,2),n);break;case cp.PolyShape.prototype.collisionCode:var s=exports.cc.color(n.r,n.g,n.b,exports.cc.lerp(n.a,255,.5));this.drawPoly(exports.cc.__convertVerts(t.tVerts),n,1,s);break;default:exports.cc.log("cc.DrawShape(): Bad assertion in DrawShape()");break}};exports.cc.DrawConstraint=function(t,e){var r=t.a,n=t.b,s,o;if(t instanceof cp.PinJoint)s=r.local2World(t.anchr1),o=n.local2World(t.anchr2),this.drawDot(s,3,exports.cc.CONSTRAINT_COLOR),this.drawDot(o,3,exports.cc.CONSTRAINT_COLOR),this.drawSegment(s,o,1,exports.cc.CONSTRAINT_COLOR);else if(t instanceof cp.SlideJoint)s=r.local2World(t.anchr1),o=n.local2World(t.anchr2),this.drawDot(s,3,exports.cc.CONSTRAINT_COLOR),this.drawDot(o,3,exports.cc.CONSTRAINT_COLOR),this.drawSegment(s,o,1,exports.cc.CONSTRAINT_COLOR);else if(t instanceof cp.PivotJoint)s=r.local2World(t.anchr1),o=n.local2World(t.anchr2),this.drawDot(s,3,exports.cc.CONSTRAINT_COLOR),this.drawDot(o,3,exports.cc.CONSTRAINT_COLOR);else if(t instanceof cp.GrooveJoint){s=r.local2World(t.grv_a),o=r.local2World(t.grv_b);var a=n.local2World(t.anchr2);this.drawDot(a,3,exports.cc.CONSTRAINT_COLOR),this.drawSegment(s,o,1,exports.cc.CONSTRAINT_COLOR)}else t instanceof cp.DampedSpring};exports.cc.CONSTRAINT_COLOR=exports.cc.color(0,255,0,128);exports.cc.PhysicsDebugNode=exports.cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(t){exports.cc.DrawNode.prototype.ctor.call(this),this._space=t},getSpace:function(){return this._space},setSpace:function(t){this._space=t},draw:function(t){this._space&&(this._space.eachShape(exports.cc.DrawShape.bind(this)),this._space.eachConstraint(exports.cc.DrawConstraint.bind(this)),exports.cc.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.cc.PhysicsDebugNode.CanvasRenderCmd(this):new exports.cc.PhysicsDebugNode.WebGLRenderCmd(this)}});exports.cc.PhysicsDebugNode.create=function(t){return new exports.cc.PhysicsDebugNode(t)};(function(){exports.cc.PhysicsDebugNode.CanvasRenderCmd=function(e){exports.cc.Node.CanvasRenderCmd.call(this,e),this._buffer=e._buffer,this._needDraw=!0};var t=exports.cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=exports.cc.PhysicsDebugNode.CanvasRenderCmd,t.rendering=function(e,r,n){var s=this._node;s._space&&(s._space.eachShape(exports.cc.DrawShape.bind(s)),s._space.eachConstraint(exports.cc.DrawConstraint.bind(s)),exports.cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,e,r,n),s.clear())},t._drawDot=exports.cc.DrawNode.CanvasRenderCmd.prototype._drawDot,t._drawSegment=exports.cc.DrawNode.CanvasRenderCmd.prototype._drawSegment,t._drawPoly=exports.cc.DrawNode.CanvasRenderCmd.prototype._drawPoly})();(function(){exports.cc.PhysicsDebugNode.WebGLRenderCmd=function(t){exports.cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity()},exports.cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype),exports.cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=exports.cc.PhysicsDebugNode.WebGLRenderCmd,exports.cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._space){e._space.eachShape(exports.cc.DrawShape.bind(e)),e._space.eachConstraint(exports.cc.DrawConstraint.bind(e));var r=this._worldTransform;this._matrix.mat[0]=r.a,this._matrix.mat[4]=r.c,this._matrix.mat[12]=r.tx,this._matrix.mat[1]=r.b,this._matrix.mat[5]=r.d,this._matrix.mat[13]=r.ty,exports.cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render(),e.clear()}}})();(function(){exports.cc.PhysicsSprite.WebGLRenderCmd=function(e){exports.cc.Sprite.WebGLRenderCmd.call(this,e),this._needDraw=!0};var t=exports.cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(exports.cc.Sprite.WebGLRenderCmd.prototype);t.constructor=exports.cc.PhysicsSprite.WebGLRenderCmd,t.spUploadData=exports.cc.Sprite.WebGLRenderCmd.prototype.uploadData,t.uploadData=function(e,r,n){var s=this._node;return s._syncPosition(),s._ignoreBodyRotation||s._syncRotation(),this.transform(this.getParentRenderCmd(),!0),this.spUploadData(e,r,n)}})();(function(t){if(typeof exports$1=="object"&&typeof module$1!="undefined")module$1.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window!="undefined"?e=window:typeof global!="undefined"?e=global:typeof self!="undefined"&&(e=self),e.io=t()}})(function(){return function t(e,r,n){function s(c,l){if(!r[c]){if(!e[c]){var h=typeof require=="function"&&require;if(!l&&h)return h(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+c+"'")}var u=r[c]={exports:{}};e[c][0].call(u.exports,function(_){var d=e[c][1][_];return s(d||_)},u,u.exports,t,e,r,n)}return r[c].exports}for(var o=typeof require=="function"&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e,r){e.exports=t("./lib/")},{"./lib/":2}],2:[function(t,e,r){var n=t("./url"),s=t("socket.io-parser"),o=t("./manager"),a=t("debug")("socket.io-client");e.exports=r=l;var c=r.managers={};function l(h,u){typeof h=="object"&&(u=h,h=void 0),u=u||{};var _=n(h),d=_.source,f=_.id,T;return u.forceNew||u["force new connection"]||u.multiplex===!1?(a("ignoring socket cache for %s",d),T=o(d,u)):(c[f]||(a("new io instance for %s",d),c[f]=o(d,u)),T=c[f]),T.socket(_.path)}r.protocol=s.protocol,r.connect=l,r.Manager=t("./manager"),r.Socket=t("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(t,e,r){t("./url");var n=t("engine.io-client"),s=t("./socket"),o=t("component-emitter"),a=t("socket.io-parser"),c=t("./on"),l=t("component-bind");t("object-component");var h=t("debug")("socket.io-client:manager"),u=t("indexof"),_=t("backo2");e.exports=d;function d(f,T){if(!(this instanceof d))return new d(f,T);f&&typeof f=="object"&&(T=f,f=void 0),T=T||{},T.path=T.path||"/socket.io",this.nsps={},this.subs=[],this.opts=T,this.reconnection(T.reconnection!==!1),this.reconnectionAttempts(T.reconnectionAttempts||1/0),this.reconnectionDelay(T.reconnectionDelay||1e3),this.reconnectionDelayMax(T.reconnectionDelayMax||5e3),this.randomizationFactor(T.randomizationFactor||.5),this.backoff=new _({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(T.timeout==null?2e4:T.timeout),this.readyState="closed",this.uri=f,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=T.autoConnect!==!1,this.autoConnect&&this.open()}d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var f in this.nsps)this.nsps[f].emit.apply(this.nsps[f],arguments)},d.prototype.updateSocketIds=function(){for(var f in this.nsps)this.nsps[f].id=this.engine.id},o(d.prototype),d.prototype.reconnection=function(f){return arguments.length?(this._reconnection=!!f,this||window):this._reconnection},d.prototype.reconnectionAttempts=function(f){return arguments.length?(this._reconnectionAttempts=f,this||window):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(f){return arguments.length?(this._reconnectionDelay=f,this.backoff&&this.backoff.setMin(f),this||window):this._reconnectionDelay},d.prototype.randomizationFactor=function(f){return arguments.length?(this._randomizationFactor=f,this.backoff&&this.backoff.setJitter(f),this||window):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(f){return arguments.length?(this._reconnectionDelayMax=f,this.backoff&&this.backoff.setMax(f),this||window):this._reconnectionDelayMax},d.prototype.timeout=function(f){return arguments.length?(this._timeout=f,this||window):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},d.prototype.open=d.prototype.connect=function(f){if(h("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=n(this.uri,this.opts);var T=this.engine,x=this;this.readyState="opening",this.skipReconnect=!1;var m=c(T,"open",function(){x.onopen(),f&&f()}),v=c(T,"error",function(N){if(h("connect_error"),x.cleanup(),x.readyState="closed",x.emitAll("connect_error",N),f){var z=new Error("Connection error");z.data=N,f(z)}else x.maybeReconnectOnOpen()});if(this._timeout!==!1){var A=this._timeout;h("connect attempt will timeout after %d",A);var D=setTimeout(function(){h("connect attempt timed out after %d",A),m.destroy(),T.close(),T.emit("error","timeout"),x.emitAll("connect_timeout",A)},A);this.subs.push({destroy:function(){clearTimeout(D)}})}return this.subs.push(m),this.subs.push(v),this||window},d.prototype.onopen=function(){h("open"),this.cleanup(),this.readyState="open",this.emit("open");var f=this.engine;this.subs.push(c(f,"data",l(this,"ondata"))),this.subs.push(c(this.decoder,"decoded",l(this,"ondecoded"))),this.subs.push(c(f,"error",l(this,"onerror"))),this.subs.push(c(f,"close",l(this,"onclose")))},d.prototype.ondata=function(f){this.decoder.add(f)},d.prototype.ondecoded=function(f){this.emit("packet",f)},d.prototype.onerror=function(f){h("error",f),this.emitAll("error",f)},d.prototype.socket=function(f){var T=this.nsps[f];if(!T){T=new s(this,f),this.nsps[f]=T;var x=this;T.on("connect",function(){T.id=x.engine.id,~u(x.connected,T)||x.connected.push(T)})}return T},d.prototype.destroy=function(f){var T=u(this.connected,f);~T&&this.connected.splice(T,1),!this.connected.length&&this.close()},d.prototype.packet=function(f){h("writing packet %j",f);var T=this;T.encoding?T.packetBuffer.push(f):(T.encoding=!0,this.encoder.encode(f,function(x){for(var m=0;m<x.length;m++)T.engine.write(x[m]);T.encoding=!1,T.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var f=this.packetBuffer.shift();this.packet(f)}},d.prototype.cleanup=function(){for(var f;f=this.subs.shift();)f.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(f){h("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",f),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var f=this;if(this.backoff.attempts>=this._reconnectionAttempts)h("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var T=this.backoff.duration();h("will wait %dms before reconnect attempt",T),this.reconnecting=!0;var x=setTimeout(function(){f.skipReconnect||(h("attempting reconnect"),f.emitAll("reconnect_attempt",f.backoff.attempts),f.emitAll("reconnecting",f.backoff.attempts),!f.skipReconnect&&f.open(function(m){m?(h("reconnect attempt error"),f.reconnecting=!1,f.reconnect(),f.emitAll("reconnect_error",m.data)):(h("reconnect success"),f.onreconnect())}))},T);this.subs.push({destroy:function(){clearTimeout(x)}})}},d.prototype.onreconnect=function(){var f=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",f)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(t,e,r){e.exports=n;function n(s,o,a){return s.on(o,a),{destroy:function(){s.removeListener(o,a)}}}},{}],5:[function(t,e,r){var n=t("socket.io-parser"),s=t("component-emitter"),o=t("to-array"),a=t("./on"),c=t("component-bind"),l=t("debug")("socket.io-client:socket"),h=t("has-binary");e.exports=d;var u={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},_=s.prototype.emit;function d(f,T){this.io=f,this.nsp=T,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}s(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var f=this.io;this.subs=[a(f,"open",c(this,"onopen")),a(f,"packet",c(this,"onpacket")),a(f,"close",c(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),this.io.readyState=="open"&&this.onopen(),this||window)},d.prototype.send=function(){var f=o(arguments);return f.unshift("message"),this.emit.apply(this,f),this||window},d.prototype.emit=function(f){if(u.hasOwnProperty(f))return _.apply(this,arguments),this||window;var T=o(arguments),x=n.EVENT;h(T)&&(x=n.BINARY_EVENT);var m={type:x,data:T};return typeof T[T.length-1]=="function"&&(l("emitting packet with ack id %d",this.ids),this.acks[this.ids]=T.pop(),m.id=this.ids++),this.connected?this.packet(m):this.sendBuffer.push(m),this||window},d.prototype.packet=function(f){f.nsp=this.nsp,this.io.packet(f)},d.prototype.onopen=function(){l("transport is open - connecting"),this.nsp!="/"&&this.packet({type:n.CONNECT})},d.prototype.onclose=function(f){l("close (%s)",f),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",f)},d.prototype.onpacket=function(f){if(f.nsp==this.nsp)switch(f.type){case n.CONNECT:this.onconnect();break;case n.EVENT:this.onevent(f);break;case n.BINARY_EVENT:this.onevent(f);break;case n.ACK:this.onack(f);break;case n.BINARY_ACK:this.onack(f);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",f.data);break}},d.prototype.onevent=function(f){var T=f.data||[];l("emitting event %j",T),f.id!=null&&(l("attaching ack callback to event"),T.push(this.ack(f.id))),this.connected?_.apply(this,T):this.receiveBuffer.push(T)},d.prototype.ack=function(f){var T=this,x=!1;return function(){if(!x){x=!0;var m=o(arguments);l("sending ack %j",m);var v=h(m)?n.BINARY_ACK:n.ACK;T.packet({type:v,id:f,data:m})}}},d.prototype.onack=function(f){l("calling ack %s with %j",f.id,f.data);var T=this.acks[f.id];T.apply(this,f.data),delete this.acks[f.id]},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var f;for(f=0;f<this.receiveBuffer.length;f++)_.apply(this,this.receiveBuffer[f]);for(this.receiveBuffer=[],f=0;f<this.sendBuffer.length;f++)this.packet(this.sendBuffer[f]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){l("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var f=0;f<this.subs.length;f++)this.subs[f].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(l("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this||window}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(t,e,r){(function(n){var s=t("parseuri"),o=t("debug")("socket.io-client:url");e.exports=a;function a(c,u){var h=c,u=u||n.location;return c==null&&(c=u.protocol+"//"+u.host),typeof c=="string"&&(c.charAt(0)=="/"&&(c.charAt(1)=="/"?c=u.protocol+c:c=u.hostname+c),/^(https?|wss?):\/\//.test(c)||(o("protocol-less url %s",c),typeof u!="undefined"?c=u.protocol+"//"+c:c="https://"+c),o("parse %s",c),h=s(c)),h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443")),h.path=h.path||"/",h.id=h.protocol+"://"+h.host+":"+h.port,h.href=h.protocol+"://"+h.host+(u&&u.port==h.port?"":":"+h.port),h}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(t,e,r){e.exports=n;function n(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}n.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),a=Math.floor(o*this.jitter*s);s=Math.floor(o*10)&1?s+a:s-a}return Math.min(s,this.max)|0},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(s){this.ms=s},n.prototype.setMax=function(s){this.max=s},n.prototype.setJitter=function(s){this.jitter=s}},{}],8:[function(t,e,r){var n=[].slice;e.exports=function(s,o){if(typeof o=="string"&&(o=s[o]),typeof o!="function")throw new Error("bind() requires a function");var a=n.call(arguments,2);return function(){return o.apply(s,a.concat(n.call(arguments)))}}},{}],9:[function(t,e,r){e.exports=n;function n(o){if(o)return s(o)}function s(o){for(var a in n.prototype)o[a]=n.prototype[a];return o}n.prototype.on=n.prototype.addEventListener=function(o,a){return this._callbacks=this._callbacks||{},(this._callbacks[o]=this._callbacks[o]||[]).push(a),this||window},n.prototype.once=function(o,a){var c=this;this._callbacks=this._callbacks||{};function l(){c.off(o,l),a.apply(this,arguments)}return l.fn=a,this.on(o,l),this||window},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(o,a){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this||window;var c=this._callbacks[o];if(!c)return this;if(arguments.length==1)return delete this._callbacks[o],this||window;for(var l,h=0;h<c.length;h++)if(l=c[h],l===a||l.fn===a){c.splice(h,1);break}return this||window},n.prototype.emit=function(o){this._callbacks=this._callbacks||{};var a=[].slice.call(arguments,1),c=this._callbacks[o];if(c){c=c.slice(0);for(var l=0,h=c.length;l<h;++l)c[l].apply(this,a)}return this||window},n.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks[o]||[]},n.prototype.hasListeners=function(o){return!!this.listeners(o).length}},{}],10:[function(t,e,r){e.exports=n;function n(o){return n.enabled(o)?function(a){a=s(a);var c=new Date,l=c-(n[o]||c);n[o]=c,a=o+" "+a+" +"+n.humanize(l),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}n.names=[],n.skips=[],n.enable=function(o){try{localStorage.debug=o}catch(h){}for(var a=(o||"").split(/[\s,]+/),c=a.length,l=0;l<c;l++)o=a[l].replace("*",".*?"),o[0]==="-"?n.skips.push(new RegExp("^"+o.substr(1)+"$")):n.names.push(new RegExp("^"+o+"$"))},n.disable=function(){n.enable("")},n.humanize=function(o){var a=1e3,c=60*1e3,l=60*c;return o>=l?(o/l).toFixed(1)+"h":o>=c?(o/c).toFixed(1)+"m":o>=a?(o/a|0)+"s":o+"ms"},n.enabled=function(o){for(var a=0,c=n.skips.length;a<c;a++)if(n.skips[a].test(o))return!1;for(var a=0,c=n.names.length;a<c;a++)if(n.names[a].test(o))return!0;return!1};function s(o){return o instanceof Error?o.stack||o.message:o}try{window.localStorage&&n.enable(localStorage.debug)}catch(o){}},{}],11:[function(t,e,r){e.exports=t("./lib/")},{"./lib/":12}],12:[function(t,e,r){e.exports=t("./socket"),e.exports.parser=t("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(t,e,r){(function(n){var s=t("./transports"),o=t("component-emitter"),a=t("debug")("engine.io-client:socket"),c=t("indexof"),l=t("engine.io-parser"),h=t("parseuri"),u=t("parsejson"),_=t("parseqs");e.exports=d;function d(T,x){if(!(this instanceof d))return new d(T,x);if(x=x||{},T&&typeof T=="object"&&(x=T,T=null),T&&(T=h(T),x.host=T.host,x.secure=T.protocol=="https"||T.protocol=="wss",x.port=T.port,T.query&&(x.query=T.query)),this.secure=x.secure!=null?x.secure:n.location&&location.protocol=="https:",x.host){var m=x.host.split(":");x.hostname=m.shift(),m.length?x.port=m.pop():x.port||(x.port=this.secure?"443":"80")}this.agent=x.agent||!1,this.hostname=x.hostname||(n.location?location.hostname:"localhost"),this.port=x.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=x.query||{},typeof this.query=="string"&&(this.query=_.decode(this.query)),this.upgrade=x.upgrade!==!1,this.path=(x.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!x.forceJSONP,this.jsonp=x.jsonp!==!1,this.forceBase64=!!x.forceBase64,this.enablesXDR=!!x.enablesXDR,this.timestampParam=x.timestampParam||"t",this.timestampRequests=x.timestampRequests,this.transports=x.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=x.policyPort||843,this.rememberUpgrade=x.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=x.onlyBinaryUpgrades,this.pfx=x.pfx||null,this.key=x.key||null,this.passphrase=x.passphrase||null,this.cert=x.cert||null,this.ca=x.ca||null,this.ciphers=x.ciphers||null,this.rejectUnauthorized=x.rejectUnauthorized||null,this.open()}d.priorWebsocketSuccess=!1,o(d.prototype),d.protocol=l.protocol,d.Socket=d,d.Transport=t("./transport"),d.transports=t("./transports"),d.parser=t("engine.io-parser"),d.prototype.createTransport=function(T){a('creating transport "%s"',T);var x=f(this.query);x.EIO=l.protocol,x.transport=T,this.id&&(x.sid=this.id);var m=new s[T]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:x,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return m};function f(T){var x={};for(var m in T)T.hasOwnProperty(m)&&(x[m]=T[m]);return x}d.prototype.open=function(){var x;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)x="websocket";else if(this.transports.length==0){var T=this;setTimeout(function(){T.emit("error","No transports available")},0);return}else x=this.transports[0];this.readyState="opening";var x;try{x=this.createTransport(x)}catch(m){this.transports.shift(),this.open();return}x.open(),this.setTransport(x)},d.prototype.setTransport=function(T){a("setting transport %s",T.name);var x=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=T,T.on("drain",function(){x.onDrain()}).on("packet",function(m){x.onPacket(m)}).on("error",function(m){x.onError(m)}).on("close",function(){x.onClose("transport close")})},d.prototype.probe=function(T){a('probing transport "%s"',T);var x=this.createTransport(T,{probe:1}),m=!1,v=this;d.priorWebsocketSuccess=!1;function A(){if(v.onlyBinaryUpgrades){var K=!this.supportsBinary&&v.transport.supportsBinary;m=m||K}m||(a('probe transport "%s" opened',T),x.send([{type:"ping",data:"probe"}]),x.once("packet",function(tt){if(!m)if(tt.type=="pong"&&tt.data=="probe"){if(a('probe transport "%s" pong',T),v.upgrading=!0,v.emit("upgrading",x),!x)return;d.priorWebsocketSuccess=x.name=="websocket",a('pausing current transport "%s"',v.transport.name),v.transport.pause(function(){m||v.readyState!="closed"&&(a("changing transport and sending upgrade packet"),U(),v.setTransport(x),x.send([{type:"upgrade"}]),v.emit("upgrade",x),x=null,v.upgrading=!1,v.flush())})}else{a('probe transport "%s" failed',T);var rt=new Error("probe error");rt.transport=x.name,v.emit("upgradeError",rt)}}))}function D(){m||(m=!0,U(),x.close(),x=null)}function N(K){var tt=new Error("probe error: "+K);tt.transport=x.name,D(),a('probe transport "%s" failed because of error: %s',T,K),v.emit("upgradeError",tt)}function z(){N("transport closed")}function M(){N("socket closed")}function J(K){x&&K.name!=x.name&&(a('"%s" works - aborting "%s"',K.name,x.name),D())}function U(){x.removeListener("open",A),x.removeListener("error",N),x.removeListener("close",z),v.removeListener("close",M),v.removeListener("upgrading",J)}x.once("open",A),x.once("error",N),x.once("close",z),this.once("close",M),this.once("upgrading",J),x.open()},d.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",d.priorWebsocketSuccess=this.transport.name=="websocket",this.emit("open"),this.flush(),this.readyState=="open"&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var T=0,x=this.upgrades.length;T<x;T++)this.probe(this.upgrades[T])}},d.prototype.onPacket=function(T){if(this.readyState=="opening"||this.readyState=="open")switch(a('socket receive: type "%s", data "%s"',T.type,T.data),this.emit("packet",T),this.emit("heartbeat"),T.type){case"open":this.onHandshake(u(T.data));break;case"pong":this.setPing();break;case"error":var x=new Error("server error");x.code=T.data,this.emit("error",x);break;case"message":this.emit("data",T.data),this.emit("message",T.data);break}else a('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(T){this.emit("handshake",T),this.id=T.sid,this.transport.query.sid=T.sid,this.upgrades=this.filterUpgrades(T.upgrades),this.pingInterval=T.pingInterval,this.pingTimeout=T.pingTimeout,this.onOpen(),this.readyState!="closed"&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(T){clearTimeout(this.pingTimeoutTimer);var x=this;x.pingTimeoutTimer=setTimeout(function(){x.readyState!="closed"&&x.onClose("ping timeout")},T||x.pingInterval+x.pingTimeout)},d.prototype.setPing=function(){var T=this;clearTimeout(T.pingIntervalTimer),T.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",T.pingTimeout),T.ping(),T.onHeartbeat(T.pingTimeout)},T.pingInterval)},d.prototype.ping=function(){this.sendPacket("ping")},d.prototype.onDrain=function(){for(var T=0;T<this.prevBufferLen;T++)this.callbackBuffer[T]&&this.callbackBuffer[T]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length==0?this.emit("drain"):this.flush()},d.prototype.flush=function(){this.readyState!="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(T,x){return this.sendPacket("message",T,x),this||window},d.prototype.sendPacket=function(T,x,m){if(!(this.readyState=="closing"||this.readyState=="closed")){var v={type:T,data:x};this.emit("packetCreate",v),this.writeBuffer.push(v),this.callbackBuffer.push(m),this.flush()}},d.prototype.close=function(){if(this.readyState=="opening"||this.readyState=="open"){let A=function(){T.onClose("forced close"),a("socket closing - telling transport to close"),T.transport.close()},D=function(){T.removeListener("upgrade",D),T.removeListener("upgradeError",D),A()},N=function(){T.once("upgrade",D),T.once("upgradeError",D)};var x=A,m=D,v=N;this.readyState="closing";var T=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?N():A()}):this.upgrading?N():A()}return this||window},d.prototype.onError=function(T){a("socket error %j",T),d.priorWebsocketSuccess=!1,this.emit("error",T),this.onClose("transport error",T)},d.prototype.onClose=function(T,x){if(this.readyState=="opening"||this.readyState=="open"||this.readyState=="closing"){a('socket close with reason: "%s"',T);var m=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){m.writeBuffer=[],m.callbackBuffer=[],m.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",T,x)}},d.prototype.filterUpgrades=function(T){for(var x=[],m=0,v=T.length;m<v;m++)~c(this.transports,T[m])&&x.push(T[m]);return x}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(t,e,r){var n=t("engine.io-parser"),s=t("component-emitter");e.exports=o;function o(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized}s(o.prototype),o.timestamps=0,o.prototype.onError=function(a,c){var l=new Error(a);return l.type="TransportError",l.description=c,this.emit("error",l),this||window},o.prototype.open=function(){return(this.readyState=="closed"||this.readyState=="")&&(this.readyState="opening",this.doOpen()),this||window},o.prototype.close=function(){return(this.readyState=="opening"||this.readyState=="open")&&(this.doClose(),this.onClose()),this||window},o.prototype.send=function(a){if(this.readyState=="open")this.write(a);else throw new Error("Transport not open")},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(a){var c=n.decodePacket(a,this.socket.binaryType);this.onPacket(c)},o.prototype.onPacket=function(a){this.emit("packet",a)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(t,e,r){(function(n){var s=t("xmlhttprequest"),o=t("./polling-xhr"),a=t("./polling-jsonp"),c=t("./websocket");r.polling=l,r.websocket=c;function l(h){var u,_=!1,d=!1,f=h.jsonp!==!1;if(n.location){var T=location.protocol=="https:",x=location.port;x||(x=T?443:80),_=h.hostname!=location.hostname||x!=h.port,d=h.secure!=T}if(h.xdomain=_,h.xscheme=d,u=new s(h),"open"in u&&!h.forceJSONP)return new o(h);if(!f)throw new Error("JSONP disabled");return new a(h)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(t,e,r){(function(n){var s=t("./polling"),o=t("component-inherit");e.exports=u;var a=/\n/g,c=/\\n/g,l;function h(){}function u(_){s.call(this,_),this.query=this.query||{},l||(n.___eio||(n.___eio=[]),l=n.___eio),this.index=l.length;var d=this;l.push(function(f){d.onData(f)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=h)},!1)}o(u,s),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),s.prototype.doClose.call(this)},u.prototype.doPoll=function(){var _=this,d=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),d.async=!0,d.src=this.uri(),d.onerror=function(x){_.onError("jsonp poll error",x)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(d,f),this.script=d;var T=typeof navigator!="undefined"&&/gecko/i.test(navigator.userAgent);T&&setTimeout(function(){var x=document.createElement("iframe");document.body.appendChild(x),document.body.removeChild(x)},100)},u.prototype.doWrite=function(_,d){var f=this;if(!this.form){var T=document.createElement("form"),x=document.createElement("textarea"),m=this.iframeId="eio_iframe_"+this.index,v;T.className="socketio",T.style.position="absolute",T.style.top="-1000px",T.style.left="-1000px",T.target=m,T.method="POST",T.setAttribute("accept-charset","utf-8"),x.name="d",T.appendChild(x),document.body.appendChild(T),this.form=T,this.area=x}this.form.action=this.uri();function A(){D(),d()}function D(){if(f.iframe)try{f.form.removeChild(f.iframe)}catch(z){f.onError("jsonp polling iframe removal error",z)}try{var N='<iframe src="javascript:0" name="'+f.iframeId+'">';v=document.createElement(N)}catch(z){v=document.createElement("iframe"),v.name=f.iframeId,v.src="javascript:0"}v.id=f.iframeId,f.form.appendChild(v),f.iframe=v}D(),_=_.replace(c,`\\
`),this.area.value=_.replace(a,"\\n");try{this.form.submit()}catch(N){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){f.iframe.readyState=="complete"&&A()}:this.iframe.onload=A}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(t,e,r){(function(n){var s=t("xmlhttprequest"),o=t("./polling"),a=t("component-emitter"),c=t("component-inherit"),l=t("debug")("engine.io-client:polling-xhr");e.exports=u,e.exports.Request=_;function h(){}function u(f){if(o.call(this,f),n.location){var T=location.protocol=="https:",x=location.port;x||(x=T?443:80),this.xd=f.hostname!=n.location.hostname||x!=f.port,this.xs=f.secure!=T}}c(u,o),u.prototype.supportsBinary=!0,u.prototype.request=function(f){return f=f||{},f.uri=this.uri(),f.xd=this.xd,f.xs=this.xs,f.agent=this.agent||!1,f.supportsBinary=this.supportsBinary,f.enablesXDR=this.enablesXDR,f.pfx=this.pfx,f.key=this.key,f.passphrase=this.passphrase,f.cert=this.cert,f.ca=this.ca,f.ciphers=this.ciphers,f.rejectUnauthorized=this.rejectUnauthorized,new _(f)},u.prototype.doWrite=function(f,T){var x=typeof f!="string"&&f!==void 0,m=this.request({method:"POST",data:f,isBinary:x}),v=this;m.on("success",T),m.on("error",function(A){v.onError("xhr post error",A)}),this.sendXhr=m},u.prototype.doPoll=function(){l("xhr poll");var f=this.request(),T=this;f.on("data",function(x){T.onData(x)}),f.on("error",function(x){T.onError("xhr poll error",x)}),this.pollXhr=f};function _(f){this.method=f.method||"GET",this.uri=f.uri,this.xd=!!f.xd,this.xs=!!f.xs,this.async=f.async!==!1,this.data=f.data!=null?f.data:null,this.agent=f.agent,this.isBinary=f.isBinary,this.supportsBinary=f.supportsBinary,this.enablesXDR=f.enablesXDR,this.pfx=f.pfx,this.key=f.key,this.passphrase=f.passphrase,this.cert=f.cert,this.ca=f.ca,this.ciphers=f.ciphers,this.rejectUnauthorized=f.rejectUnauthorized,this.create()}a(_.prototype),_.prototype.create=function(){var f={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};f.pfx=this.pfx,f.key=this.key,f.passphrase=this.passphrase,f.cert=this.cert,f.ca=this.ca,f.ciphers=this.ciphers,f.rejectUnauthorized=this.rejectUnauthorized;var T=this.xhr=new s(f),x=this;try{if(l("xhr open %s: %s",this.method,this.uri),T.open(this.method,this.uri,this.async),this.supportsBinary&&(T.responseType="arraybuffer"),this.method=="POST")try{this.isBinary?T.setRequestHeader("Content-type","application/octet-stream"):T.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(m){}"withCredentials"in T&&(T.withCredentials=!0),this.hasXDR()?(T.onload=function(){x.onLoad()},T.onerror=function(){x.onError(T.responseText)}):T.onreadystatechange=function(){T.readyState==4&&(T.status==200||T.status==1223?x.onLoad():setTimeout(function(){x.onError(T.status)},0))},l("xhr data %s",this.data),T.send(this.data)}catch(m){setTimeout(function(){x.onError(m)},0);return}n.document&&(this.index=_.requestsCount++,_.requests[this.index]=this)},_.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},_.prototype.onData=function(f){this.emit("data",f),this.onSuccess()},_.prototype.onError=function(f){this.emit("error",f),this.cleanup(!0)},_.prototype.cleanup=function(f){if(!(typeof this.xhr=="undefined"||this.xhr===null)){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=h:this.xhr.onreadystatechange=h,f)try{this.xhr.abort()}catch(T){}n.document&&delete _.requests[this.index],this.xhr=null}},_.prototype.onLoad=function(){var f;try{var T;try{T=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(x){}T==="application/octet-stream"?f=this.xhr.response:this.supportsBinary?f="ok":f=this.xhr.responseText}catch(x){this.onError(x)}f!=null&&this.onData(f)},_.prototype.hasXDR=function(){return typeof n.XDomainRequest!="undefined"&&!this.xs&&this.enablesXDR},_.prototype.abort=function(){this.cleanup()},n.document&&(_.requestsCount=0,_.requests={},n.attachEvent?n.attachEvent("onunload",d):n.addEventListener&&n.addEventListener("beforeunload",d,!1));function d(){for(var f in _.requests)_.requests.hasOwnProperty(f)&&_.requests[f].abort()}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(t,e,r){var n=t("../transport"),s=t("parseqs"),o=t("engine.io-parser"),a=t("component-inherit"),c=t("debug")("engine.io-client:polling");e.exports=h;var l=function(){var u=t("xmlhttprequest"),_=new u({xdomain:!1});return _.responseType!=null}();function h(u){var _=u&&u.forceBase64;(!l||_)&&(this.supportsBinary=!1),n.call(this,u)}a(h,n),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(u){var _=this;this.readyState="pausing";function d(){c("paused"),_.readyState="paused",u()}if(this.polling||!this.writable){var f=0;this.polling&&(c("we are currently polling - waiting to pause"),f++,this.once("pollComplete",function(){c("pre-pause polling complete"),--f||d()})),this.writable||(c("we are currently writing - waiting to pause"),f++,this.once("drain",function(){c("pre-pause writing complete"),--f||d()}))}else d()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(u){var _=this;c("polling got data %s",u);var d=function(f,T,x){if(_.readyState=="opening"&&_.onOpen(),f.type=="close")return _.onClose(),!1;_.onPacket(f)};o.decodePayload(u,this.socket.binaryType,d),this.readyState!="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState=="open"?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var u=this;function _(){c("writing close packet"),u.write([{type:"close"}])}this.readyState=="open"?(c("transport open - closing"),_()):(c("transport not open - deferring close"),this.once("open",_))},h.prototype.write=function(u){var d=this;this.writable=!1;var _=function(){d.writable=!0,d.emit("drain")},d=this;o.encodePayload(u,this.supportsBinary,function(f){d.doWrite(f,_)})},h.prototype.uri=function(){var u=this.query||{},_=this.secure?"https":"http",d="";return this.timestampRequests!==!1&&(u[this.timestampParam]=+new Date+"-"+n.timestamps++),!this.supportsBinary&&!u.sid&&(u.b64=1),u=s.encode(u),this.port&&(_=="https"&&this.port!=443||_=="http"&&this.port!=80)&&(d=":"+this.port),u.length&&(u="?"+u),_+"://"+this.hostname+d+this.path+u}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(t,e,r){var n=t("../transport"),s=t("engine.io-parser"),o=t("parseqs"),a=t("component-inherit"),c=t("debug")("engine.io-client:websocket"),l=t("ws");e.exports=h;function h(u){var _=u&&u.forceBase64;_&&(this.supportsBinary=!1),n.call(this,u)}a(h,n),h.prototype.name="websocket",h.prototype.supportsBinary=!0,h.prototype.doOpen=function(){if(this.check()){var u=this.uri(),_=void 0,d={agent:this.agent};d.pfx=this.pfx,d.key=this.key,d.passphrase=this.passphrase,d.cert=this.cert,d.ca=this.ca,d.ciphers=this.ciphers,d.rejectUnauthorized=this.rejectUnauthorized,this.ws=new l(u,_,d),this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},h.prototype.addEventListeners=function(){var u=this;this.ws.onopen=function(){u.onOpen()},this.ws.onclose=function(){u.onClose()},this.ws.onmessage=function(_){u.onData(_.data)},this.ws.onerror=function(_){u.onError("websocket error",_)}},typeof navigator!="undefined"&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(h.prototype.onData=function(u){var _=this;setTimeout(function(){n.prototype.onData.call(_,u)},0)}),h.prototype.write=function(u){var _=this;this.writable=!1;for(var d=0,f=u.length;d<f;d++)s.encodePacket(u[d],this.supportsBinary,function(x){try{_.ws.send(x)}catch(m){c("websocket closed before onclose event")}});function T(){_.writable=!0,_.emit("drain")}setTimeout(T,0)},h.prototype.onClose=function(){n.prototype.onClose.call(this)},h.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},h.prototype.uri=function(){var u=this.query||{},_=this.secure?"wss":"ws",d="";return this.port&&(_=="wss"&&this.port!=443||_=="ws"&&this.port!=80)&&(d=":"+this.port),this.timestampRequests&&(u[this.timestampParam]=+new Date),this.supportsBinary||(u.b64=1),u=o.encode(u),u.length&&(u="?"+u),_+"://"+this.hostname+d+this.path+u},h.prototype.check=function(){return!!l&&!("__initialize"in l&&this.name===h.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(t,e,r){var n=t("has-cors");e.exports=function(s){var o=s.xdomain,a=s.xscheme,c=s.enablesXDR;try{if(typeof XMLHttpRequest!="undefined"&&(!o||n))return new XMLHttpRequest}catch(l){}try{if(typeof XDomainRequest!="undefined"&&!a&&c)return new XDomainRequest}catch(l){}if(!o)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(l){}}},{"has-cors":40}],21:[function(t,e,r){e.exports=function(n,s){var o=function(){};o.prototype=s.prototype,n.prototype=new o,n.prototype.constructor=n}},{}],22:[function(t,e,r){r=e.exports=t("./debug"),r.log=o,r.formatArgs=s,r.save=a,r.load=c,r.useColors=n,r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}r.formatters.j=function(l){return JSON.stringify(l)};function s(){var l=arguments,h=this.useColors;if(l[0]=(h?"%c":"")+this.namespace+(h?" %c":" ")+l[0]+(h?"%c ":" ")+"+"+r.humanize(this.diff),!h)return l;var u="color: "+this.color;l=[l[0],u,"color: inherit"].concat(Array.prototype.slice.call(l,1));var _=0,d=0;return l[0].replace(/%[a-z%]/g,function(f){f!=="%"&&(_++,f==="%c"&&(d=_))}),l.splice(d,0,u),l}function o(){return typeof console=="object"&&typeof console.log=="function"&&Function.prototype.apply.call(console.log,console,arguments)}function a(l){try{l==null?localStorage.removeItem("debug"):localStorage.debug=l}catch(h){}}function c(){var l;try{l=localStorage.debug}catch(h){}return l}r.enable(c())},{"./debug":23}],23:[function(t,e,r){r=e.exports=a,r.coerce=u,r.disable=l,r.enable=c,r.enabled=h,r.humanize=t("ms"),r.names=[],r.skips=[],r.formatters={};var n=0,s;function o(){return r.colors[n++%r.colors.length]}function a(_){function d(){}d.enabled=!1;function f(){var x=f,m=+new Date,v=m-(s||m);x.diff=v,x.prev=s,x.curr=m,s=m,x.useColors==null&&(x.useColors=r.useColors()),x.color==null&&x.useColors&&(x.color=o());var A=Array.prototype.slice.call(arguments);A[0]=r.coerce(A[0]),typeof A[0]!="string"&&(A=["%o"].concat(A));var D=0;A[0]=A[0].replace(/%([a-z%])/g,function(z,M){if(z==="%")return z;D++;var J=r.formatters[M];if(typeof J=="function"){var U=A[D];z=J.call(x,U),A.splice(D,1),D--}return z}),typeof r.formatArgs=="function"&&(A=r.formatArgs.apply(x,A));var N=f.log||r.log||console.log.bind(console);N.apply(x,A)}f.enabled=!0;var T=r.enabled(_)?f:d;return T.namespace=_,T}function c(_){r.save(_);for(var d=(_||"").split(/[\s,]+/),f=d.length,T=0;T<f;T++)d[T]&&(_=d[T].replace(/\*/g,".*?"),_[0]==="-"?r.skips.push(new RegExp("^"+_.substr(1)+"$")):r.names.push(new RegExp("^"+_+"$")))}function l(){r.enable("")}function h(_){var d,f;for(d=0,f=r.skips.length;d<f;d++)if(r.skips[d].test(_))return!1;for(d=0,f=r.names.length;d<f;d++)if(r.names[d].test(_))return!0;return!1}function u(_){return _ instanceof Error?_.stack||_.message:_}},{ms:24}],24:[function(t,e,r){var n=1e3,s=n*60,o=s*60,a=o*24,c=a*365.25;e.exports=function(d,f){return f=f||{},typeof d=="string"?l(d):f.long?u(d):h(d)};function l(d){var f=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(d);if(f){var T=parseFloat(f[1]),x=(f[2]||"ms").toLowerCase();switch(x){case"years":case"year":case"y":return T*c;case"days":case"day":case"d":return T*a;case"hours":case"hour":case"h":return T*o;case"minutes":case"minute":case"m":return T*s;case"seconds":case"second":case"s":return T*n;case"ms":return T}}}function h(d){return d>=a?Math.round(d/a)+"d":d>=o?Math.round(d/o)+"h":d>=s?Math.round(d/s)+"m":d>=n?Math.round(d/n)+"s":d+"ms"}function u(d){return _(d,a,"day")||_(d,o,"hour")||_(d,s,"minute")||_(d,n,"second")||d+" ms"}function _(d,f,T){if(!(d<f))return d<f*1.5?Math.floor(d/f)+" "+T:Math.ceil(d/f)+" "+T+"s"}},{}],25:[function(t,e,r){(function(n){var s=t("./keys"),o=t("has-binary"),a=t("arraybuffer.slice"),c=t("base64-arraybuffer"),l=t("after"),h=t("utf8"),u=navigator.userAgent.match(/Android/i),_=/PhantomJS/i.test(navigator.userAgent),d=u||_;r.protocol=3;var f=r.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},T=s(f),x={type:"error",data:"parser error"},m=t("blob");r.encodePacket=function(M,J,U,K){typeof J=="function"&&(K=J,J=!1),typeof U=="function"&&(K=U,U=null);var tt=M.data===void 0?void 0:M.data.buffer||M.data;if(n.ArrayBuffer&&tt instanceof ArrayBuffer)return A(M,J,K);if(m&&tt instanceof n.Blob)return N(M,J,K);if(tt&&tt.base64)return v(M,K);var rt=f[M.type];return M.data!==void 0&&(rt+=U?h.encode(String(M.data)):String(M.data)),K(""+rt)};function v(M,J){var U="b"+r.packets[M.type]+M.data.data;return J(U)}function A(M,J,U){if(!J)return r.encodeBase64Packet(M,U);var K=M.data,tt=new Uint8Array(K),rt=new Uint8Array(1+K.byteLength);rt[0]=f[M.type];for(var I=0;I<tt.length;I++)rt[I+1]=tt[I];return U(rt.buffer)}function D(M,J,U){if(!J)return r.encodeBase64Packet(M,U);var K=new FileReader;return K.onload=function(){M.data=K.result,r.encodePacket(M,J,!0,U)},K.readAsArrayBuffer(M.data)}function N(M,J,U){if(!J)return r.encodeBase64Packet(M,U);if(d)return D(M,J,U);var K=new Uint8Array(1);K[0]=f[M.type];var tt=new m([K.buffer,M.data]);return U(tt)}r.encodeBase64Packet=function(M,J){var U="b"+r.packets[M.type];if(m&&M.data instanceof m){var K=new FileReader;return K.onload=function(){var G=K.result.split(",")[1];J(U+G)},K.readAsDataURL(M.data)}var tt;try{tt=String.fromCharCode.apply(null,new Uint8Array(M.data))}catch(G){for(var rt=new Uint8Array(M.data),I=new Array(rt.length),L=0;L<rt.length;L++)I[L]=rt[L];tt=String.fromCharCode.apply(null,I)}return U+=n.btoa(tt),J(U)},r.decodePacket=function(M,J,U){if(typeof M=="string"||M===void 0){if(M.charAt(0)=="b")return r.decodeBase64Packet(M.substr(1),J);if(U)try{M=h.decode(M)}catch(L){return x}var tt=M.charAt(0);return Number(tt)!=tt||!T[tt]?x:M.length>1?{type:T[tt],data:M.substring(1)}:{type:T[tt]}}var K=new Uint8Array(M),tt=K[0],rt=a(M,1);return m&&J==="blob"&&(rt=new m([rt])),{type:T[tt],data:rt}},r.decodeBase64Packet=function(M,J){var U=T[M.charAt(0)];if(!n.ArrayBuffer)return{type:U,data:{base64:!0,data:M.substr(1)}};var K=c.decode(M.substr(1));return J==="blob"&&m&&(K=new m([K])),{type:U,data:K}},r.encodePayload=function(M,J,U){typeof J=="function"&&(U=J,J=null);var K=o(M);if(J&&K)return m&&!d?r.encodePayloadAsBlob(M,U):r.encodePayloadAsArrayBuffer(M,U);if(!M.length)return U("0:");function tt(I){return I.length+":"+I}function rt(I,L){r.encodePacket(I,K?J:!1,!0,function(G){L(null,tt(G))})}z(M,rt,function(I,L){return U(L.join(""))})};function z(M,J,U){for(var K=new Array(M.length),tt=l(M.length,U),rt=function(L,G,w){J(G,function(O,j){K[L]=j,w(O,K)})},I=0;I<M.length;I++)rt(I,M[I],tt)}r.decodePayload=function(M,J,U){if(typeof M!="string")return r.decodePayloadAsBinary(M,J,U);typeof J=="function"&&(U=J,J=null);var K;if(M=="")return U(x,0,1);for(var tt="",rt,I,L=0,G=M.length;L<G;L++){var w=M.charAt(L);if(w!=":")tt+=w;else{if(tt==""||tt!=(rt=Number(tt))||(I=M.substr(L+1,rt),tt!=I.length))return U(x,0,1);if(I.length){if(K=r.decodePacket(I,J,!0),x.type==K.type&&x.data==K.data)return U(x,0,1);var O=U(K,L+rt,G);if(O===!1)return}L+=rt,tt=""}}if(tt!="")return U(x,0,1)},r.encodePayloadAsArrayBuffer=function(M,J){if(!M.length)return J(new ArrayBuffer(0));function U(K,tt){r.encodePacket(K,!0,!0,function(rt){return tt(null,rt)})}z(M,U,function(K,tt){var rt=tt.reduce(function(G,w){var O;return typeof w=="string"?O=w.length:O=w.byteLength,G+O.toString().length+O+2},0),I=new Uint8Array(rt),L=0;return tt.forEach(function(G){var w=typeof G=="string",O=G;if(w){for(var C=new Uint8Array(G.length),j=0;j<G.length;j++)C[j]=G.charCodeAt(j);O=C.buffer}w?I[L++]=0:I[L++]=1;for(var Q=O.byteLength.toString(),j=0;j<Q.length;j++)I[L++]=parseInt(Q[j]);I[L++]=255;for(var C=new Uint8Array(O),j=0;j<C.length;j++)I[L++]=C[j]}),J(I.buffer)})},r.encodePayloadAsBlob=function(M,J){function U(K,tt){r.encodePacket(K,!0,!0,function(rt){var I=new Uint8Array(1);if(I[0]=1,typeof rt=="string"){for(var L=new Uint8Array(rt.length),G=0;G<rt.length;G++)L[G]=rt.charCodeAt(G);rt=L.buffer,I[0]=0}for(var w=rt instanceof ArrayBuffer?rt.byteLength:rt.size,O=w.toString(),j=new Uint8Array(O.length+1),G=0;G<O.length;G++)j[G]=parseInt(O[G]);if(j[O.length]=255,m){var Q=new m([I.buffer,j.buffer,rt]);tt(null,Q)}})}z(M,U,function(K,tt){return J(new m(tt))})},r.decodePayloadAsBinary=function(M,J,U){typeof J=="function"&&(U=J,J=null);for(var K=M,tt=[],rt=!1;K.byteLength>0;){for(var I=new Uint8Array(K),L=I[0]===0,G="",w=1;I[w]!=255;w++){if(G.length>310){rt=!0;break}G+=I[w]}if(rt)return U(x,0,1);K=a(K,2+G.length),G=parseInt(G);var O=a(K,0,G);if(L)try{O=String.fromCharCode.apply(null,new Uint8Array(O))}catch(C){var j=new Uint8Array(O);O="";for(var w=0;w<j.length;w++)O+=String.fromCharCode(j[w])}tt.push(O),K=a(K,G)}var Q=tt.length;tt.forEach(function(C,b){U(r.decodePacket(C,J,!0),b,Q)})}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(t,e,r){e.exports=Object.keys||function(s){var o=[],a=Object.prototype.hasOwnProperty;for(var c in s)a.call(s,c)&&o.push(c);return o}},{}],27:[function(t,e,r){e.exports=n;function n(o,a,c){var l=!1;return c=c||s,h.count=o,o===0?a():h;function h(u,_){if(h.count<=0)throw new Error("after called too many times");--h.count,u?(l=!0,a(u),a=c):h.count===0&&!l&&a(null,_)}}function s(){}},{}],28:[function(t,e,r){e.exports=function(n,s,o){var a=n.byteLength;if(s=s||0,o=o||a,n.slice)return n.slice(s,o);if(s<0&&(s+=a),o<0&&(o+=a),o>a&&(o=a),s>=a||s>=o||a===0)return new ArrayBuffer(0);for(var c=new Uint8Array(n),l=new Uint8Array(o-s),h=s,u=0;h<o;h++,u++)l[u]=c[h];return l.buffer}},{}],29:[function(t,e,r){(function(n){r.encode=function(s){var o=new Uint8Array(s),a,c=o.length,l="";for(a=0;a<c;a+=3)l+=n[o[a]>>2],l+=n[(o[a]&3)<<4|o[a+1]>>4],l+=n[(o[a+1]&15)<<2|o[a+2]>>6],l+=n[o[a+2]&63];return c%3===2?l=l.substring(0,l.length-1)+"=":c%3===1&&(l=l.substring(0,l.length-2)+"=="),l},r.decode=function(s){var o=s.length*.75,a=s.length,c,l=0,h,u,_,d;s[s.length-1]==="="&&(o--,s[s.length-2]==="="&&o--);var f=new ArrayBuffer(o),T=new Uint8Array(f);for(c=0;c<a;c+=4)h=n.indexOf(s[c]),u=n.indexOf(s[c+1]),_=n.indexOf(s[c+2]),d=n.indexOf(s[c+3]),T[l++]=h<<2|u>>4,T[l++]=(u&15)<<4|_>>2,T[l++]=(_&3)<<6|d&63;return f}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(t,e,r){(function(n){var s=n.BlobBuilder||n.WebKitBlobBuilder||n.MSBlobBuilder||n.MozBlobBuilder,o=function(){try{var l=new Blob(["hi"]);return l.size==2}catch(h){return!1}}(),a=s&&s.prototype.append&&s.prototype.getBlob;function c(l,h){h=h||{};for(var u=new s,_=0;_<l.length;_++)u.append(l[_]);return h.type?u.getBlob(h.type):u.getBlob()}e.exports=function(){return o?n.Blob:a?c:void 0}()}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],31:[function(t,e,r){(function(n){var s=t("isarray");e.exports=o;function o(a){function c(l){if(!l)return!1;if(n.Buffer&&n.Buffer.isBuffer(l)||n.ArrayBuffer&&l instanceof ArrayBuffer||n.Blob&&l instanceof Blob||n.File&&l instanceof File)return!0;if(s(l)){for(var h=0;h<l.length;h++)if(c(l[h]))return!0}else if(l&&typeof l=="object"){l.toJSON&&(l=l.toJSON());for(var u in l)if(l.hasOwnProperty(u)&&c(l[u]))return!0}return!1}return c(a)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{isarray:32}],32:[function(t,e,r){e.exports=Array.isArray||function(n){return Object.prototype.toString.call(n)=="[object Array]"}},{}],33:[function(t,e,r){(function(n){(function(s){var o=typeof r=="object"&&r,a=typeof e=="object"&&e&&e.exports==o&&e,c=typeof n=="object"&&n;(c.global===c||c.window===c)&&(s=c);var l=String.fromCharCode;function h(U){for(var K=[],tt=0,rt=U.length,I,L;tt<rt;)I=U.charCodeAt(tt++),I>=55296&&I<=56319&&tt<rt?(L=U.charCodeAt(tt++),(L&64512)==56320?K.push(((I&1023)<<10)+(L&1023)+65536):(K.push(I),tt--)):K.push(I);return K}function u(U){for(var K=U.length,tt=-1,rt,I="";++tt<K;)rt=U[tt],rt>65535&&(rt-=65536,I+=l(rt>>>10&1023|55296),rt=56320|rt&1023),I+=l(rt);return I}function _(U,K){return l(U>>K&63|128)}function d(U){if(!(U&4294967168))return l(U);var K="";return U&4294965248?U&4294901760?U&4292870144||(K=l(U>>18&7|240),K+=_(U,12),K+=_(U,6)):(K=l(U>>12&15|224),K+=_(U,6)):K=l(U>>6&31|192),K+=l(U&63|128),K}function f(U){for(var K=h(U),tt=K.length,rt=-1,I,L="";++rt<tt;)I=K[rt],L+=d(I);return L}function T(){if(A>=v)throw Error("Invalid byte index");var U=m[A]&255;if(A++,(U&192)==128)return U&63;throw Error("Invalid continuation byte")}function x(){var U,K,tt,rt,I;if(A>v)throw Error("Invalid byte index");if(A==v)return!1;if(U=m[A]&255,A++,!(U&128))return U;if((U&224)==192){var K=T();if(I=(U&31)<<6|K,I>=128)return I;throw Error("Invalid continuation byte")}if((U&240)==224){if(K=T(),tt=T(),I=(U&15)<<12|K<<6|tt,I>=2048)return I;throw Error("Invalid continuation byte")}if((U&248)==240&&(K=T(),tt=T(),rt=T(),I=(U&15)<<18|K<<12|tt<<6|rt,I>=65536&&I<=1114111))return I;throw Error("Invalid UTF-8 detected")}var m,v,A;function D(U){m=h(U),v=m.length,A=0;for(var K=[],tt;(tt=x())!==!1;)K.push(tt);return u(K)}var N={version:"2.0.0",encode:f,decode:D};if(o&&!o.nodeType)if(a)a.exports=N;else{var z={},M=z.hasOwnProperty;for(var J in N)M.call(N,J)&&(o[J]=N[J])}else s.utf8=N})(this)}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],34:[function(t,e,r){(function(n){var s=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,c=/(?:^|:|,)(?:\s*\[)+/g,l=/^\s+/,h=/\s+$/;e.exports=function(_){if(typeof _!="string"||!_)return null;if(_=_.replace(l,"").replace(h,""),n.JSON&&JSON.parse)return JSON.parse(_);if(s.test(_.replace(o,"@").replace(a,"]").replace(c,"")))return new Function("return "+_)()}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],35:[function(t,e,r){r.encode=function(n){var s="";for(var o in n)n.hasOwnProperty(o)&&(s.length&&(s+="&"),s+=encodeURIComponent(o)+"="+encodeURIComponent(n[o]));return s},r.decode=function(n){for(var s={},o=n.split("&"),a=0,c=o.length;a<c;a++){var l=o[a].split("=");s[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}return s}},{}],36:[function(t,e,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(a){var c=a,l=a.indexOf("["),h=a.indexOf("]");l!=-1&&h!=-1&&(a=a.substring(0,l)+a.substring(l,h).replace(/:/g,";")+a.substring(h,a.length));for(var u=n.exec(a||""),_={},d=14;d--;)_[s[d]]=u[d]||"";return l!=-1&&h!=-1&&(_.source=c,_.host=_.host.substring(1,_.host.length-1).replace(/;/g,":"),_.authority=_.authority.replace("[","").replace("]","").replace(/;/g,":"),_.ipv6uri=!0),_}},{}],37:[function(t,e,r){var n=function(){return this||window}(),s=n.WebSocket||n.MozWebSocket;e.exports=s?o:null;function o(a,c,l){var h;return c?h=new s(a,c):h=new s(a),h}s&&(o.prototype=s.prototype)},{}],38:[function(t,e,r){(function(n){var s=t("isarray");e.exports=o;function o(a){function c(l){if(!l)return!1;if(n.Buffer&&n.Buffer.isBuffer(l)||n.ArrayBuffer&&l instanceof ArrayBuffer||n.Blob&&l instanceof Blob||n.File&&l instanceof File)return!0;if(s(l)){for(var h=0;h<l.length;h++)if(c(l[h]))return!0}else if(l&&typeof l=="object"){l.toJSON&&(l=l.toJSON());for(var u in l)if(Object.prototype.hasOwnProperty.call(l,u)&&c(l[u]))return!0}return!1}return c(a)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{isarray:39}],39:[function(t,e,r){e.exports=t(32)},{}],40:[function(t,e,r){var n=t("global");try{e.exports="XMLHttpRequest"in n&&"withCredentials"in new n.XMLHttpRequest}catch(s){e.exports=!1}},{global:41}],41:[function(t,e,r){e.exports=function(){return this||window}()},{}],42:[function(t,e,r){var n=[].indexOf;e.exports=function(s,o){if(n)return s.indexOf(o);for(var a=0;a<s.length;++a)if(s[a]===o)return a;return-1}},{}],43:[function(t,e,r){var n=Object.prototype.hasOwnProperty;r.keys=Object.keys||function(s){var o=[];for(var a in s)n.call(s,a)&&o.push(a);return o},r.values=function(s){var o=[];for(var a in s)n.call(s,a)&&o.push(s[a]);return o},r.merge=function(s,o){for(var a in o)n.call(o,a)&&(s[a]=o[a]);return s},r.length=function(s){return r.keys(s).length},r.isEmpty=function(s){return r.length(s)==0}},{}],44:[function(t,e,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(a){for(var c=n.exec(a||""),l={},h=14;h--;)l[s[h]]=c[h]||"";return l}},{}],45:[function(t,e,r){(function(n){var s=t("isarray"),o=t("./is-buffer");r.deconstructPacket=function(a){var c=[],l=a.data;function h(_){if(!_)return _;if(o(_)){var d={_placeholder:!0,num:c.length};return c.push(_),d}else if(s(_)){for(var f=new Array(_.length),T=0;T<_.length;T++)f[T]=h(_[T]);return f}else if(typeof _=="object"&&!(_ instanceof Date)){var f={};for(var x in _)f[x]=h(_[x]);return f}return _}var u=a;return u.data=h(l),u.attachments=c.length,{packet:u,buffers:c}},r.reconstructPacket=function(a,c){function l(h){if(h&&h._placeholder){var u=c[h.num];return u}else if(s(h)){for(var _=0;_<h.length;_++)h[_]=l(h[_]);return h}else if(h&&typeof h=="object"){for(var d in h)h[d]=l(h[d]);return h}return h}return a.data=l(a.data),a.attachments=void 0,a},r.removeBlobs=function(a,c){function l(_,d,f){if(!_)return _;if(n.Blob&&_ instanceof Blob||n.File&&_ instanceof File){h++;var T=new FileReader;T.onload=function(){f?f[d]=this.result:u=this.result,--h||c(u)},T.readAsArrayBuffer(_)}else if(s(_))for(var x=0;x<_.length;x++)l(_[x],x,_);else if(_&&typeof _=="object"&&!o(_))for(var m in _)l(_[m],m,_)}var h=0,u=a;l(u),h||c(u)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(t,e,r){var n=t("debug")("socket.io-parser"),s=t("json3");t("isarray");var o=t("component-emitter"),a=t("./binary"),c=t("./is-buffer");r.protocol=4,r.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],r.CONNECT=0,r.DISCONNECT=1,r.EVENT=2,r.ACK=3,r.ERROR=4,r.BINARY_EVENT=5,r.BINARY_ACK=6,r.Encoder=l,r.Decoder=_;function l(){}l.prototype.encode=function(x,m){if(n("encoding packet %j",x),r.BINARY_EVENT==x.type||r.BINARY_ACK==x.type)u(x,m);else{var v=h(x);m([v])}};function h(x){var m="",v=!1;return m+=x.type,(r.BINARY_EVENT==x.type||r.BINARY_ACK==x.type)&&(m+=x.attachments,m+="-"),x.nsp&&x.nsp!="/"&&(v=!0,m+=x.nsp),x.id!=null&&(v&&(m+=",",v=!1),m+=x.id),x.data!=null&&(v&&(m+=","),m+=s.stringify(x.data)),n("encoded %j as %s",x,m),m}function u(x,m){function v(A){var D=a.deconstructPacket(A),N=h(D.packet),z=D.buffers;z.unshift(N),m(z)}a.removeBlobs(x,v)}function _(){this.reconstructor=null}o(_.prototype),_.prototype.add=function(x){var m;if(typeof x=="string")m=d(x),r.BINARY_EVENT==m.type||r.BINARY_ACK==m.type?(this.reconstructor=new f(m),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",m)):this.emit("decoded",m);else if(c(x)||x.base64)if(this.reconstructor)m=this.reconstructor.takeBinaryData(x),m&&(this.reconstructor=null,this.emit("decoded",m));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+x)};function d(x){var m={},v=0;if(m.type=Number(x.charAt(0)),r.types[m.type]==null)return T();if(r.BINARY_EVENT==m.type||r.BINARY_ACK==m.type){for(var A="";x.charAt(++v)!="-"&&(A+=x.charAt(v),v!=x.length););if(A!=Number(A)||x.charAt(v)!="-")throw new Error("Illegal attachments");m.attachments=Number(A)}if(x.charAt(v+1)=="/")for(m.nsp="";++v;){var D=x.charAt(v);if(D==","||(m.nsp+=D,v==x.length))break}else m.nsp="/";var N=x.charAt(v+1);if(N!==""&&Number(N)==N){for(m.id="";++v;){var D=x.charAt(v);if(D==null||Number(D)!=D){--v;break}if(m.id+=x.charAt(v),v==x.length)break}m.id=Number(m.id)}if(x.charAt(++v))try{m.data=s.parse(x.substr(v))}catch(z){return T()}return n("decoded %s as %j",x,m),m}_.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};function f(x){this.reconPack=x,this.buffers=[]}f.prototype.takeBinaryData=function(x){if(this.buffers.push(x),this.buffers.length==this.reconPack.attachments){var m=a.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),m}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]};function T(x){return{type:r.ERROR,data:"parser error"}}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(t,e,r){(function(n){e.exports=s;function s(o){return n.Buffer&&n.Buffer.isBuffer(o)||n.ArrayBuffer&&o instanceof ArrayBuffer}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],48:[function(t,e,r){e.exports=t(32)},{}],49:[function(t,e,r){(function(n){var s={}.toString,o,a,c,l=typeof JSON=="object"&&JSON,h=typeof r=="object"&&r&&!r.nodeType&&r;h&&l?(h.stringify=l.stringify,h.parse=l.parse):h=n.JSON=l||{};var u=new Date(-0xc782b5b800cec);try{u=u.getUTCFullYear()==-109252&&u.getUTCMonth()===0&&u.getUTCDate()===1&&u.getUTCHours()==10&&u.getUTCMinutes()==37&&u.getUTCSeconds()==6&&u.getUTCMilliseconds()==708}catch(E){}function _(E){if(_[E]!==c)return _[E];var R;if(E=="bug-string-char-index")R="a"[0]!="a";else if(E=="json")R=_("json-stringify")&&_("json-parse");else{var F,k='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(E=="json-stringify"){var X=h.stringify,Z=typeof X=="function"&&u;if(Z){(F=function(){return 1}).toJSON=F;try{Z=X(0)==="0"&&X(new Number)==="0"&&X(new String)=='""'&&X(s)===c&&X(c)===c&&X()===c&&X(F)==="1"&&X([F])=="[1]"&&X([c])=="[null]"&&X(null)=="null"&&X([c,s,null])=="[null,null,null]"&&X({a:[F,!0,!1,null,`\0\b
\f\r	`]})==k&&X(null,F)==="1"&&X([1,2],null,1)==`[
 1,
 2
]`&&X(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&X(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&X(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&X(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch($){Z=!1}}R=Z}if(E=="json-parse"){var V=h.parse;if(typeof V=="function")try{if(V("0")===0&&!V(!1)){F=V(k);var Y=F.a.length==5&&F.a[0]===1;if(Y){try{Y=!V('"	"')}catch($){}if(Y)try{Y=V("01")!==1}catch($){}if(Y)try{Y=V("1.")!==1}catch($){}}}}catch($){Y=!1}R=Y}}return _[E]=!!R}if(!_("json")){var d="[object Function]",f="[object Date]",T="[object Number]",x="[object String]",m="[object Array]",v="[object Boolean]",A=_("bug-string-char-index");if(!u)var D=Math.floor,N=[0,31,59,90,120,151,181,212,243,273,304,334],z=function(E,R){return N[R]+365*(E-1970)+D((E-1969+(R=+(R>1)))/4)-D((E-1901+R)/100)+D((E-1601+R)/400)};(o={}.hasOwnProperty)||(o=function(E){var R={},F;return(R.__proto__=null,R.__proto__={toString:1},R).toString!=s?o=function(k){var X=this.__proto__,Z=k in(this.__proto__=null,this);return this.__proto__=X,Z}:(F=R.constructor,o=function(k){var X=(this.constructor||F).prototype;return k in this&&!(k in X&&this[k]===X[k])}),R=null,o.call(this,E)});var M={boolean:1,number:1,string:1,undefined:1},J=function(E,R){var F=typeof E[R];return F=="object"?!!E[R]:!M[F]};if(a=function(E,R){var F=0,k,X,Z;(k=function(){this.valueOf=0}).prototype.valueOf=0,X=new k;for(Z in X)o.call(X,Z)&&F++;return k=X=null,F?F==2?a=function(V,Y){var $={},et=s.call(V)==d,ct;for(ct in V)!(et&&ct=="prototype")&&!o.call($,ct)&&($[ct]=1)&&o.call(V,ct)&&Y(ct)}:a=function(V,Y){var $=s.call(V)==d,et,ct;for(et in V)!($&&et=="prototype")&&o.call(V,et)&&!(ct=et==="constructor")&&Y(et);(ct||o.call(V,et="constructor"))&&Y(et)}:(X=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],a=function(V,Y){var $=s.call(V)==d,et,ct,ht=!$&&typeof V.constructor!="function"&&J(V,"hasOwnProperty")?V.hasOwnProperty:o;for(et in V)!($&&et=="prototype")&&ht.call(V,et)&&Y(et);for(ct=X.length;et=X[--ct];ht.call(V,et)&&Y(et));}),a(E,R)},!_("json-stringify")){var U={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},K="000000",tt=function(E,R){return(K+(R||0)).slice(-E)},rt="\\u00",I=function(E){var R='"',F=0,k=E.length,X=k>10&&A,Z;for(X&&(Z=E.split(""));F<k;F++){var V=E.charCodeAt(F);switch(V){case 8:case 9:case 10:case 12:case 13:case 34:case 92:R+=U[V];break;default:if(V<32){R+=rt+tt(2,V.toString(16));break}R+=X?Z[F]:A?E.charAt(F):E[F]}}return R+'"'},L=function(E,R,F,k,X,Z,V){var Y,$,et,ct,ht,pt,mt,dt,xt,Tt,lt,at,At,St,wt,Pt;try{Y=R[E]}catch(It){}if(typeof Y=="object"&&Y)if($=s.call(Y),$==f&&!o.call(Y,"toJSON"))if(Y>-1/0&&Y<1/0){if(z){for(ht=D(Y/864e5),et=D(ht/365.2425)+1970-1;z(et+1,0)<=ht;et++);for(ct=D((ht-z(et,0))/30.42);z(et,ct+1)<=ht;ct++);ht=1+ht-z(et,ct),pt=(Y%864e5+864e5)%864e5,mt=D(pt/36e5)%24,dt=D(pt/6e4)%60,xt=D(pt/1e3)%60,Tt=pt%1e3}else et=Y.getUTCFullYear(),ct=Y.getUTCMonth(),ht=Y.getUTCDate(),mt=Y.getUTCHours(),dt=Y.getUTCMinutes(),xt=Y.getUTCSeconds(),Tt=Y.getUTCMilliseconds();Y=(et<=0||et>=1e4?(et<0?"-":"+")+tt(6,et<0?-et:et):tt(4,et))+"-"+tt(2,ct+1)+"-"+tt(2,ht)+"T"+tt(2,mt)+":"+tt(2,dt)+":"+tt(2,xt)+"."+tt(3,Tt)+"Z"}else Y=null;else typeof Y.toJSON=="function"&&($!=T&&$!=x&&$!=m||o.call(Y,"toJSON"))&&(Y=Y.toJSON(E));if(F&&(Y=F.call(R,E,Y)),Y===null)return"null";if($=s.call(Y),$==v)return""+Y;if($==T)return Y>-1/0&&Y<1/0?""+Y:"null";if($==x)return I(""+Y);if(typeof Y=="object"){for(St=V.length;St--;)if(V[St]===Y)throw TypeError();if(V.push(Y),lt=[],wt=Z,Z+=X,$==m){for(At=0,St=Y.length;At<St;At++)at=L(At,Y,F,k,X,Z,V),lt.push(at===c?"null":at);Pt=lt.length?X?`[
`+Z+lt.join(`,
`+Z)+`
`+wt+"]":"["+lt.join(",")+"]":"[]"}else a(k||Y,function(It){var zt=L(It,Y,F,k,X,Z,V);zt!==c&&lt.push(I(It)+":"+(X?" ":"")+zt)}),Pt=lt.length?X?`{
`+Z+lt.join(`,
`+Z)+`
`+wt+"}":"{"+lt.join(",")+"}":"{}";return V.pop(),Pt}};h.stringify=function(E,R,F){var k,X,Z,V;if(typeof R=="function"||typeof R=="object"&&R){if((V=s.call(R))==d)X=R;else if(V==m){Z={};for(var Y=0,$=R.length,et;Y<$;et=R[Y++],V=s.call(et),(V==x||V==T)&&(Z[et]=1));}}if(F)if((V=s.call(F))==T){if((F-=F%1)>0)for(k="",F>10&&(F=10);k.length<F;k+=" ");}else V==x&&(k=F.length<=10?F:F.slice(0,10));return L("",(et={},et[""]=E,et),X,Z,k,"",[])}}if(!_("json-parse")){var G=String.fromCharCode,w={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:`
`,102:"\f",114:"\r"},O,j,Q=function(){throw O=j=null,SyntaxError()},C=function(){for(var E=j,R=E.length,F,k,X,Z,V;O<R;)switch(V=E.charCodeAt(O),V){case 9:case 10:case 13:case 32:O++;break;case 123:case 125:case 91:case 93:case 58:case 44:return F=A?E.charAt(O):E[O],O++,F;case 34:for(F="@",O++;O<R;)if(V=E.charCodeAt(O),V<32)Q();else if(V==92)switch(V=E.charCodeAt(++O),V){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:F+=w[V],O++;break;case 117:for(k=++O,X=O+4;O<X;O++)V=E.charCodeAt(O),V>=48&&V<=57||V>=97&&V<=102||V>=65&&V<=70||Q();F+=G("0x"+E.slice(k,O));break;default:Q()}else{if(V==34)break;for(V=E.charCodeAt(O),k=O;V>=32&&V!=92&&V!=34;)V=E.charCodeAt(++O);F+=E.slice(k,O)}if(E.charCodeAt(O)==34)return O++,F;Q();default:if(k=O,V==45&&(Z=!0,V=E.charCodeAt(++O)),V>=48&&V<=57){for(V==48&&(V=E.charCodeAt(O+1),V>=48&&V<=57)&&Q(),Z=!1;O<R&&(V=E.charCodeAt(O),V>=48&&V<=57);O++);if(E.charCodeAt(O)==46){for(X=++O;X<R&&(V=E.charCodeAt(X),V>=48&&V<=57);X++);X==O&&Q(),O=X}if(V=E.charCodeAt(O),V==101||V==69){for(V=E.charCodeAt(++O),(V==43||V==45)&&O++,X=O;X<R&&(V=E.charCodeAt(X),V>=48&&V<=57);X++);X==O&&Q(),O=X}return+E.slice(k,O)}if(Z&&Q(),E.slice(O,O+4)=="true")return O+=4,!0;if(E.slice(O,O+5)=="false")return O+=5,!1;if(E.slice(O,O+4)=="null")return O+=4,null;Q()}return"$"},b=function(E){var R,F;if(E=="$"&&Q(),typeof E=="string"){if((A?E.charAt(0):E[0])=="@")return E.slice(1);if(E=="["){for(R=[];E=C(),E!="]";F||(F=!0))F&&(E==","?(E=C(),E=="]"&&Q()):Q()),E==","&&Q(),R.push(b(E));return R}else if(E=="{"){for(R={};E=C(),E!="}";F||(F=!0))F&&(E==","?(E=C(),E=="}"&&Q()):Q()),(E==","||typeof E!="string"||(A?E.charAt(0):E[0])!="@"||C()!=":")&&Q(),R[E.slice(1)]=b(C());return R}Q()}return E},W=function(E,R,F){var k=S(E,R,F);k===c?delete E[R]:E[R]=k},S=function(E,R,F){var k=E[R],X;if(typeof k=="object"&&k)if(s.call(k)==m)for(X=k.length;X--;)W(k,X,F);else a(k,function(Z){W(k,Z,F)});return F.call(E,R,k)};h.parse=function(E,R){var F,k;return O=0,j=""+E,F=b(C()),C()!="$"&&Q(),O=j=null,R&&s.call(R)==d?S((k={},k[""]=F,k),"",R):F}}}})(this)},{}],50:[function(t,e,r){e.exports=n;function n(s,o){var a=[];o=o||0;for(var c=o||0;c<s.length;c++)a[c-o]=s[c];return a}},{}]},{},[1])(1)});exports.gaf=exports.gaf||{};exports.gaf.COMPRESSION_NONE=4669766;exports.gaf.COMPRESSION_ZIP=4669763;exports.gaf.IDNONE=4294967295;exports.gaf.FIRST_FRAME_INDEX=0;exports.gaf.EFFECT_DROP_SHADOW=0;exports.gaf.EFFECT_BLUR=1;exports.gaf.EFFECT_GLOW=2;exports.gaf.EFFECT_COLOR_MATRIX=6;exports.gaf.ACTION_STOP=0;exports.gaf.ACTION_PLAY=1;exports.gaf.ACTION_GO_TO_AND_STOP=2;exports.gaf.ACTION_GO_TO_AND_PLAY=3;exports.gaf.ACTION_DISPATCH_EVENT=4;exports.gaf.PI_FRAME=0;exports.gaf.PI_EVENT_TYPE=0;exports.gaf.TYPE_TEXTURE=0;exports.gaf.TYPE_TEXT_FIELD=1;exports.gaf.TYPE_TIME_LINE=2;exports.gaf.UNIFORM_BLUR_TEXEL_OFFSET="u_step";exports.gaf.UNIFORM_GLOW_TEXEL_OFFSET="u_step";exports.gaf.UNIFORM_GLOW_COLOR="u_glowColor";exports.gaf.UNIFORM_ALPHA_TINT_MULT="colorTransformMult";exports.gaf.UNIFORM_ALPHA_TINT_OFFSET="colorTransformOffsets";exports.gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY="colorMatrix";exports.gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX="colorMatrix2";exports.gaf=exports.gaf||{};exports.gaf._tmp=exports.gaf._tmp||{};exports.gaf._initialized=!1;exports.gaf.CCGAFLoader=function(){this.load=function(t,e,r,n){exports.gaf._initialized||exports.gaf._setup();var s=new exports.gaf.Loader;s.LoadFile(t,function(o){n(null,o)})}};exports.gaf._setup=function(){exports.gaf._setupShaders(),exports.gaf._initialized=!0};exports.cc.loader.register(".gaf",new exports.gaf.CCGAFLoader);exports.gaf.CGAffineTransformCocosFormatFromFlashFormat=function(t){var e={};return e.a=t.a,e.b=-t.b,e.c=-t.c,e.d=t.d,e.tx=t.tx,e.ty=-t.ty,e};exports.gaf._AssetPreload=function(){this[0]=this.End,this[1]=this.Atlases,this[2]=this.AnimationMasks,this[3]=this.AnimationObjects,this[4]=this.AnimationFrames,this[5]=this.NamedParts,this[6]=this.Sequences,this[7]=this.TextFields,this[8]=this.Atlases,this[9]=this.Stage,this[10]=this.AnimationObjects,this[11]=this.AnimationMasks,this[12]=this.AnimationFrames,this[13]=this.TimeLine};exports.gaf._AssetPreload.prototype.End=function(t,e,r){r&&(r.getFps=function(){return t.getSceneFps()})};exports.gaf._AssetPreload.prototype.Tag=function(t,e,r){this[e.tagId].call(this,t,e.content,r)};exports.gaf._AssetPreload.prototype.Tags=function(t,e,r){var n=this||window;e.forEach(function(s){n.Tag(t,s,r)})};exports.gaf._AssetPreload.prototype.AtlasCreateFrames=function(t,e,r){t.forEach(function(n){var s=e._atlases[n.atlasId],o=exports.cc.rect(n.origin.x,n.origin.y,n.size.x,n.size.y),a=new exports.cc.SpriteFrame(s,o);a._gafAnchor={x:0-(0-n.pivot.x/n.size.x),y:0+(1-n.pivot.y/n.size.y)},r[n.elementAtlasId]=a})};exports.gaf._AssetPreload.prototype.Atlases=function(t,e,r){var n=t._atlasScales[e.scale]=t._atlasScales[e.scale]||[],s=exports.cc.Director._getInstance().getContentScaleFactor();e.atlases.forEach(function(o){var a=o.id,c=function(){exports.gaf._AssetPreload.AtlasCreateFrames(e.elements,t,n)},l="";o.sources.forEach(function(v){v.csf===s&&(l=v.source)}),exports.cc.assert(l,"GAF Error. Texture for current CSF not found. Reconvert animation with correct parameters."),t._textureLoadDelegate&&(l=t._textureLoadDelegate(l));for(var h=!1,u=t._getSearchPaths(l),_=0,d=u.length;_<d;++_){var f=u[_],T=exports.cc.textureCache.getTextureForKey(f);if(T&&T.isLoaded()){T.handleLoadedTexture(!0),h=!0,t._atlases[a]=T,c();break}}if(!h){var x=function(v){v.handleLoadedTexture(!0),t._onAtlasLoaded(a,v)},m=function(){exports.cc.log("GAF Error. Couldn't find `"+l+"` required by `"+t.getGAFFileName()+"`")};t._atlasesToLoad.hasOwnProperty(a)||(exports.gaf._AtlasLoader.loadArray(u,x,m),t._atlasesToLoad[a]={}),t._onLoadTasks.push(c)}})};exports.gaf._AssetPreload.prototype.AnimationObjects=function(t,e,r){e.forEach(function(n){n.type=n.type===void 0?exports.gaf.TYPE_TEXTURE:n.type,r._objects.push(n.objectId),t._objects[n.objectId]=n})};exports.gaf._AssetPreload.prototype.convertTint=function(t,e){return t?{mult:{r:t.redMultiplier*255,g:t.greenMultiplier*255,b:t.blueMultiplier*255,a:e*255},offset:{r:t.redOffset*255,g:t.greenOffset*255,b:t.blueOffset*255,a:t.alphaOffset*255}}:null};exports.gaf._AssetPreload.prototype.convertState=function(t){return{hasColorTransform:t.hasColorTransform,hasMask:t.hasMask,hasEffect:t.hasEffect,objectIdRef:t.objectIdRef,depth:t.depth,alpha:t.alpha*255,matrix:exports.gaf.CGAffineTransformCocosFormatFromFlashFormat(t.matrix),colorTransform:this.convertTint(t.colorTransform,t.alpha),effect:t.effect,maskObjectIdRef:t.maskObjectIdRef}};exports.gaf._AssetPreload.prototype.AnimationFrames=function(t,e,r){var n=this||window;exports.cc.assert(r,"Error. Time Line should not be null.");for(var s={},o=[],a=0,c=e.length;a<c;++a){var l=e[a];l.state&&l.state.forEach(function(_){_.alpha!==0?s[_.objectIdRef]=n.convertState(_):s[_.objectIdRef]=null});var h=[];for(var u in s)s.hasOwnProperty(u)&&s[u]&&h.push(s[u]);o[l.frame-1]={states:h,actions:l.actions||null}}r.getFrames=function(){return o}};exports.gaf._AssetPreload.prototype.NamedParts=function(t,e,r){var n={};e.forEach(function(s){n[s.name]=s.objectId}),r.getNamedParts=function(){return n}};exports.gaf._AssetPreload.prototype.Sequences=function(t,e,r){var n={};e.forEach(function(s){n[s.id]={start:s.start-1,end:s.end}}),r.getSequences=function(){return n}};exports.gaf._AssetPreload.prototype.TextFields=function(t,e,r){debugger};exports.gaf._AssetPreload.prototype.Stage=function(t,e,r){t._sceneFps=e.fps,t._sceneColor=e.color,t._sceneWidth=e.width,t._sceneHeight=e.height};exports.gaf._AssetPreload.prototype.AnimationMasks=function(t,e,r){e.forEach(function(n){n.type=n.type===void 0?exports.gaf.TYPE_TEXTURE:n.type,r._objects.push(n.objectId),t._masks[n.objectId]=n})};exports.gaf._AssetPreload.prototype.TimeLine=function(t,e,r){var n=new exports.gaf._TimeLineProto(t,e.animationFrameCount,e.boundingBox,e.pivotPoint,e.id,e.linkageName);t._pushTimeLine(n),this.Tags(t,e.tags,n)};exports.gaf._AssetPreload=new exports.gaf._AssetPreload;exports.gaf=exports.gaf||{};exports.gaf.Asset=exports.cc.Class.extend({_className:"GAFAsset",_header:null,_timeLines:null,_textFields:null,_protos:null,_objects:null,_masks:null,_rootTimeLine:null,_textureLoadDelegate:null,_sceneFps:60,_sceneWidth:0,_sceneHeight:0,_sceneColor:0,_gafData:null,_desiredAtlasScale:1,_usedAtlasScale:0,_atlases:null,_onLoadTasks:null,_atlasScales:null,_textureLoaded:!1,_atlasesToLoad:null,_gafName:null,initWithGAFFile:function(t,e){var r=this||window;this._textureLoadDelegate=e,this._gafName=t;var n=exports.cc.loader.getRes(t);if(!n)exports.cc.loader.load(t,function(s,o){s||r._init(o[0])});else return this._init(n);return!1},initWithGAFBundle:function(t,e,r){return exports.cc.assert(!1,"initWithGAFBundle is not yet implemented"),!1},setRootTimelineWithName:function(t){for(var e=0,r=this._timeLines.length;e<r;++e){var n=this._timeLines[e];if(n&&n.getLinkageName()===t){this._setRootTimeline(n);return}}},isAssetVersionPlayable:function(){return!0},desiredAtlasScale:function(){return this._desiredAtlasScale},setDesiredAtlasScale:function(t){this._desiredAtlasScale=t;for(var e in this._atlasScales)this._atlasScales.hasOwnProperty(e)&&(this._usedAtlasScale===0||Math.abs(this._usedAtlasScale-t)>Math.abs(e-t))&&(this._usedAtlasScale=e)},createObject:function(){return this._instantiateGaf(this._gafData)},createObjectAndRun:function(t){exports.cc.assert(arguments.length===1,"GAFAsset::createObjectAndRun should have one param");var e=this._instantiateGaf(this._gafData);return e.setLooped(t,!0),e.start(),e},setTextureLoadDelegate:function(t){debugger},getSceneFps:function(){return this._sceneFps},getSceneWidth:function(){debugger},getSceneHeight:function(){debugger},getSceneColor:function(){debugger},setSceneFps:function(t){this._sceneFps=t},setSceneWidth:function(t){debugger},setSceneHeight:function(t){debugger},setSceneColor:function(t){debugger},getHeader:function(){return this._header},getGAFFileName:function(){return this._gafName},ctor:function(){this._header={},this._timeLines=[],this._textFields=[],this._objects=[],this._masks=[],this._protos=[],this._atlases={},this._onLoadTasks=[],this._atlasScales={},this._atlasesToLoad={},arguments.length>0&&this.initWithGAFFile.apply(this,arguments)},_getProtos:function(){return this._protos},_setRootTimeline:function(t){this._rootTimeLine=t,this._header.pivot=t.getPivot(),this._header.frameSize=t.getRect()},_setHeader:function(t){for(var e in t)t.hasOwnProperty(e)&&(this._header[e]=t[e])},_getMajorVerison:function(){return this._header.versionMajor},_init:function(t){var e=this||window;this._gafData=t,this._setHeader(t.header),this._timeLinesToLink=[],this._getMajorVerison()<4&&this._pushTimeLine(new exports.gaf._TimeLineProto(this,this._header.framesCount,this._header.frameSize,this._header.pivot)),exports.gaf._AssetPreload.Tags(this,t.tags,this._rootTimeLine),this._objects.forEach(function(r){switch(r.type){case exports.gaf.TYPE_TEXTURE:e._protos[r.objectId]||(e._protos[r.objectId]=new exports.gaf._SpriteProto(e,e._atlasScales,r.elementAtlasIdRef));break;case exports.gaf.TYPE_TIME_LINE:e._protos[r.objectId]=e._timeLines[r.elementAtlasIdRef];break;case exports.gaf.TYPE_TEXT_FIELD:e._protos[r.objectId]=e._textFields[r.elementAtlasIdRef];break;default:exports.cc.log("Unknown object type: "+r.type);break}}),this._masks.forEach(function(r){if(!e._protos[r.objectId]){var n=null;switch(r.type){case exports.gaf.TYPE_TEXTURE:n=new exports.gaf._SpriteProto(e,e._atlasScales,r.elementAtlasIdRef);break;case exports.gaf.TYPE_TIME_LINE:n=e._timeLines[r.elementAtlasIdRef];break;case exports.gaf.TYPE_TEXT_FIELD:n=e._textFields[r.elementAtlasIdRef];break}e._protos[r.objectId]=new exports.gaf._MaskProto(e,n,r.elementAtlasIdRef)}}),this.setDesiredAtlasScale(this._desiredAtlasScale),Object.keys(this._atlasesToLoad).length===0&&(this._textureLoaded=!0,this.dispatchEvent("load"))},_pushTimeLine:function(t){this._timeLines[t.getId()]=t,t.getId()===0&&this._setRootTimeline(t)},_instantiateGaf:function(){var t=null;return t=this._rootTimeLine._gafConstruct(),t},_onAtlasLoaded:function(t,e){this._atlases[t]=e,delete this._atlasesToLoad[t],Object.keys(this._atlasesToLoad).length===0&&(this._onLoadTasks.forEach(function(r){r()}),this._onLoadTasks.length=0,this._textureLoaded=!0,this.dispatchEvent("load"))},isLoaded:function(){return this._textureLoaded},_getSearchPaths:function(t){var e=this.getGAFFileName().split("/");e[e.length-1]=t;var r=e.join("/");return[t,r]}});exports.gaf.Asset.create=function(t,e){return new exports.gaf.Asset(t,e)};exports.gaf.Asset.createWithBundle=function(t,e,r){var n=new exports.gaf.Asset;return n.initWithGAFBundle(t,e,r),n};exports.cc.EventHelper.prototype.apply(exports.gaf.Asset.prototype);exports.gaf=exports.gaf||{};exports.gaf._stateHasCtx=function(t){if(t.hasColorTransform&&(t.colorTransform.offset.r>0||t.colorTransform.offset.g>0||t.colorTransform.offset.b>0||t.colorTransform.offset.a>0))return!0;if(t.hasEffect){for(var e=0,r=t.effect.length;e<r;++e)if(t.effect[e].type===exports.gaf.EFFECT_COLOR_MATRIX)return!0}return!1};exports.gaf.Object=exports.cc.Node.extend({_asset:null,_className:"GAFObject",_id:exports.gaf.IDNONE,_gafproto:null,_parentTimeLine:null,_lastVisibleInFrame:0,_filterStack:null,_cascadeColorMult:null,_cascadeColorOffset:null,_needsCtx:!1,_usedAtlasScale:1,ctor:function(t){arguments.length==1&&(this._usedAtlasScale=t),this._super(),this._cascadeColorMult=exports.cc.color(255,255,255,255),this._cascadeColorOffset=exports.cc.color(0,0,0,0),this._filterStack=[]},setAnimationStartedNextLoopDelegate:function(t){},setAnimationFinishedPlayDelegate:function(t){},setLooped:function(t){},getBoundingBoxForCurrentFrame:function(){return null},setFps:function(t){},getObjectByName:function(t){return null},clearSequence:function(){},getIsAnimationRunning:function(){return!1},getSequences:function(){return[]},gotoAndStop:function(t){},getStartFrame:function(t){return exports.gaf.IDNONE},setFramePlayedDelegate:function(t){},getCurrentFrameIndex:function(){return exports.gaf.IDNONE},getTotalFrameCount:function(){return 0},start:function(){},stop:function(){},isVisibleInCurrentFrame:function(){return!(this._parentTimeLine&&this._parentTimeLine.getCurrentFrameIndex()+1!=this._lastVisibleInFrame)},isDone:function(){return!0},playSequence:function(t,e,r){return!1},isReversed:function(){return!1},setSequenceDelegate:function(t){},setFrame:function(t){return!1},setControlDelegate:function(t){},getEndFrame:function(t){return exports.gaf.IDNONE},pauseAnimation:function(){},gotoAndPlay:function(t){},isLooped:function(){return!1},resumeAnimation:function(){},setReversed:function(t){},hasSequences:function(){return!1},getFps:function(){return 60},setLocator:function(t){},setExternalTransform:function(t){exports.cc.affineTransformEqualToTransform(this._additionalTransform,t)||this.setAdditionalTransform(t)},getExternalTransform:function(){return this._additionalTransform},setAnimationRunning:function(){},_enableTick:function(t){},_resetState:function(){},_updateVisibility:function(t,e){var r=t.hasColorTransform?t.colorTransform.offset.a:0;this.setOpacity(t.alpha+r)},isVisible:function(){return this.getOpacity()>0},visit:function(t){this.isVisibleInCurrentFrame()&&this._super(t)},_getFilters:function(){return null},_processAnimation:function(){},_applyState:function(t,e){this._applyStateSuper(t,e)},_applyStateSuper:function(t,e){if(this._needsCtx=e._needsCtx,this._filterStack.length=0,this._parentTimeLine=e,this._usedAtlasScale!=1){var r=exports.cc.clone(t.matrix);r.tx*=this._usedAtlasScale,r.ty*=this._usedAtlasScale,this.setExternalTransform(r)}else this.setExternalTransform(t.matrix);t.hasEffect&&(this._filterStack=this._filterStack.concat(t.effect),this._needsCtx=!0),e._filterStack&&e._filterStack.length>0&&(this._filterStack=this._filterStack.concat(e._filterStack)),this._filterStack.length>0&&this._filterStack[0].type===exports.gaf.EFFECT_COLOR_MATRIX&&(this._needsCtx=!0),t.hasColorTransform?(this._cascadeColorMult.r=t.colorTransform.mult.r*e._cascadeColorMult.r/255,this._cascadeColorMult.g=t.colorTransform.mult.g*e._cascadeColorMult.g/255,this._cascadeColorMult.b=t.colorTransform.mult.b*e._cascadeColorMult.b/255,this._cascadeColorMult.a=t.colorTransform.mult.a*e._cascadeColorMult.a/255,this._cascadeColorOffset.r=t.colorTransform.offset.r+e._cascadeColorOffset.r,this._cascadeColorOffset.g=t.colorTransform.offset.g+e._cascadeColorOffset.g,this._cascadeColorOffset.b=t.colorTransform.offset.b+e._cascadeColorOffset.b,this._cascadeColorOffset.a=t.colorTransform.offset.a+e._cascadeColorOffset.a):(this._cascadeColorMult.r=e._cascadeColorMult.r,this._cascadeColorMult.g=e._cascadeColorMult.g,this._cascadeColorMult.b=e._cascadeColorMult.b,this._cascadeColorMult.a=t.alpha*(e._cascadeColorMult.a/255),this._cascadeColorOffset.r=e._cascadeColorOffset.r,this._cascadeColorOffset.g=e._cascadeColorOffset.g,this._cascadeColorOffset.b=e._cascadeColorOffset.b,this._cascadeColorOffset.a=e._cascadeColorOffset.a),(this._cascadeColorOffset.r>0||this._cascadeColorOffset.g>0||this._cascadeColorOffset.b>0||this._cascadeColorOffset.a>0)&&(this._needsCtx=!0)},_initRendererCmd:function(){this._renderCmd=exports.cc.renderer.getRenderCmd(this),this._renderCmd._visit=this._renderCmd.visit;var t=this||window;this._renderCmd.visit=function(e){t.isVisibleInCurrentFrame()&&this._visit(e)}},_getNode:function(){return this},setAnchorPoint:function(t,e){e===void 0?this._super(t.x,t.y-1):this._super(t,e-1)}});exports.gaf.Object._createNullObject=function(){var t=new exports.gaf.Object;return t.isVisible=function(){return!0},t};exports.gaf.TimeLine=exports.gaf.Object.extend({_className:"GAFTimeLine",_objects:null,_container:null,_animationStartedNextLoopDelegate:null,_animationFinishedPlayDelegate:null,_framePlayedDelegate:null,_sequenceDelegate:null,_fps:60,_frameTime:1/60,_currentSequenceStart:exports.gaf.FIRST_FRAME_INDEX,_currentSequenceEnd:exports.gaf.FIRST_FRAME_INDEX,_totalFrameCount:0,_isRunning:!1,_isLooped:!1,_isReversed:!1,_timeDelta:0,_animationsSelectorScheduled:!1,_currentFrame:exports.gaf.FIRST_FRAME_INDEX,setAnimationStartedNextLoopDelegate:function(t){this._animationStartedNextLoopDelegate=t},setAnimationFinishedPlayDelegate:function(t){this._animationFinishedPlayDelegate=t},setLooped:function(t,e){this._isLooped=t,e&&this._objects.forEach(function(r){r.setLooped(t,e)})},getBoundingBoxForCurrentFrame:function(){var t=null,e=!0;return this._objects.forEach(function(r){if(r.isVisibleInCurrentFrame()&&r.isVisible()){var n=r.getBoundingBoxForCurrentFrame();n||(n=r.getBoundingBox()),e?(e=!1,t=n):t=exports.cc.rectUnion(t,n)}}),exports.cc._rectApplyAffineTransformIn(t,this._container.getNodeToParentTransform())},setFps:function(t){exports.cc.assert(t!==0,"Error! Fps is set to zero."),this._fps=t,this._frameTime=1/t},getObjectByName:function(t){var e=t.split("."),r=null,n=-1,s=this||window,o={};try{e.forEach(function(a){var c=s._gafproto.getNamedParts();if(c.hasOwnProperty(a))n=c[a];else throw o.lastElement=a,o;r=s._objects[n],s=r})}catch(a){if(a!==o)throw a;return exports.cc.log("Sequence incorrect: `"+t+"` At: `"+o.lastElement+"`"),null}return r},clearSequence:function(){this._currentSequenceStart=exports.gaf.FIRST_FRAME_INDEX,this._currentSequenceEnd=this._gafproto.getTotalFrames()},getIsAnimationRunning:function(){return this._isRunning},gotoAndStop:function(t){var e=0;return typeof t=="string"?e=this.getStartFrame(t):e=t,this.setFrame(e)?(this.setAnimationRunning(!1,!1),!0):!1},gotoAndPlay:function(t){var e=0;return typeof t=="string"?e=this.getStartFrame(t):e=t,this.setFrame(e)?(this.setAnimationRunning(!0,!1),!0):!1},getStartFrame:function(t){var e=this._gafproto.getSequences()[t];return e?e.start:exports.gaf.IDNONE},getEndFrame:function(t){var e=this._gafproto.getSequences()[t];return e?e.end:exports.gaf.IDNONE},setFramePlayedDelegate:function(t){this._framePlayedDelegate=t},getCurrentFrameIndex:function(){return this._showingFrame},getTotalFrameCount:function(){return this._gafproto.getTotalFrames()},start:function(){this._enableTick(!0),this._isRunning||(this._currentFrame=exports.gaf.FIRST_FRAME_INDEX,this.setAnimationRunning(!0,!0))},stop:function(){this._enableTick(!1),this._isRunning&&(this._currentFrame=exports.gaf.FIRST_FRAME_INDEX,this.setAnimationRunning(!1,!0))},isDone:function(){return this._isLooped?!1:this._isReversed?this._currentFrame<exports.gaf.FIRST_FRAME_INDEX-1:this._currentFrame>this._totalFrameCount},getSequences:function(){return this._gafproto.getSequences()},playSequence:function(t,e){var r=this.getStartFrame(t),n=this.getEndFrame(t);return exports.gaf.IDNONE===r||exports.gaf.IDNONE===n?!1:(this._currentSequenceStart=r,this._currentSequenceEnd=n,this._currentFrame<this._currentSequenceStart||this._currentFrame>this._currentSequenceEnd?this._currentFrame=this._currentSequenceStart:this._currentFrame=this._currentSequenceStart,this.setLooped(e,!1),this.resumeAnimation(),!0)},isReversed:function(){return this._isReversed},setSequenceDelegate:function(t){this._sequenceDelegate=t},setFrame:function(t){return t>=exports.gaf.FIRST_FRAME_INDEX&&t<this._totalFrameCount?(this._showingFrame=t,this._currentFrame=t,this._processAnimation(),!0):!1},pauseAnimation:function(){this._isRunning&&this.setAnimationRunning(!1,!1)},isLooped:function(){return this._isLooped},resumeAnimation:function(){this._isRunning||this.setAnimationRunning(!0,!1)},setReversed:function(t){this._isReversed=t},hasSequences:function(){return this._gafproto.getSequences().length>0},getFps:function(){return this._fps},ctor:function(t,e){this._super(e),this._objects=[],exports.cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},setExternalTransform:function(t){exports.cc.affineTransformEqualToTransform(this._container._additionalTransform,t)||this._container.setAdditionalTransform(t)},_init:function(){this.setContentSize(this._gafproto.getBoundingBox()),this._currentSequenceEnd=this._gafproto.getTotalFrames(),this._totalFrameCount=this._currentSequenceEnd,this.setFps(this._gafproto.getFps()),this._container=new exports.cc.Node,this.addChild(this._container);var t=this||window,e=this._gafproto.getAsset();this._gafproto.getObjects().forEach(function(r){var n=e._getProtos()[r];exports.cc.assert(n,"Error. GAF proto for type: "+r.type+" and reference id: "+r+" not found."),t._objects[r]=n._gafConstruct()})},_enableTick:function(t){!this._animationsSelectorScheduled&&t?(this.schedule(this._processAnimations),this._animationsSelectorScheduled=!0):this._animationsSelectorScheduled&&!t&&(this.unschedule(this._processAnimations),this._animationsSelectorScheduled=!1)},_processAnimations:function(t){for(this._timeDelta+=t;this._timeDelta>=this._frameTime;)this._timeDelta-=this._frameTime,this._step()},_step:function(){if(this._showingFrame=this._currentFrame,!this.getIsAnimationRunning()){this._processAnimation();return}if(this._sequenceDelegate){var t;this._isReversed?t=this._getSequenceByFirstFrame(this._currentFrame+1):t=this._getSequenceByLastFrame(this._currentFrame),t&&this._sequenceDelegate(this,t)}this._isCurrentFrameLastInSequence()&&(this._isLooped?this._animationStartedNextLoopDelegate&&this._animationStartedNextLoopDelegate(this):(this.setAnimationRunning(!1,!1),this._animationFinishedPlayDelegate&&this._animationFinishedPlayDelegate(this))),this._processAnimation(),this._currentFrame=this._nextFrame()},_isCurrentFrameLastInSequence:function(){return this._isReversed?this._currentFrame==this._currentSequenceStart:this._currentFrame==this._currentSequenceEnd-1},_nextFrame:function(){return this._isCurrentFrameLastInSequence()?this._isLooped?this._isReversed?this._currentSequenceEnd-1:this._currentSequenceStart:this._currentFrame:this._currentFrame+(this._isReversed?-1:1)},_processAnimation:function(){this._realizeFrame(this._container,this._currentFrame),this._framePlayedDelegate&&this._framePlayedDelegate(this,this._currentFrame)},_realizeFrame:function(t,e){var r=this||window,n=r._objects,s=r._gafproto.getFrames();if(!(e>s.length)){var o=s[e];if(o)for(var a=o.states,c=0,l=a.length;c<l;++c){var h=a[c],u=n[h.objectIdRef];if(!u)return;if(h.alpha<0&&u._resetState(),u._updateVisibility(h,r),!!u.isVisible()){u._applyState(h,r);var _=t;h.hasMask&&(_=n[h.maskObjectIdRef]._getNode(),exports.cc.assert(_,"Error! Mask not found.")),u._lastVisibleInFrame=1+e,exports.gaf.TimeLine.rearrangeSubobject(_,u,h.depth),u._step&&u._step()}}}},setAnimationRunning:function(t,e){this._isRunning=t,e&&this._objects.forEach(function(r){r&&r.setAnimationRunning&&r.setAnimationRunning(t,e)})},_getSequenceByLastFrame:function(){var t=this._gafproto.getSequences();for(var e in t)if(t.hasOwnProperty(e)&&t[e].end===frame+1)return e;return""},_resetState:function(){this._super(),this._currentFrame=this._currentSequenceStart},_getSequenceByFirstFrame:function(){var t=this._gafproto.getSequences();for(var e in t)if(t.hasOwnProperty(e)&&t[e].start===frame)return e;return""}});exports.gaf.TimeLine.rearrangeSubobject=function(t,e,r){var n=e.getParent();n!==t?(e.removeFromParent(!1),t.addChild(e,r)):e.setLocalZOrder(r)};exports.gaf.TextField=exports.gaf.Object.extend({_className:"GAFTextField"});exports.gaf.Sprite=exports.gaf.Object.extend({_className:"GAFSprite",_hasCtx:!1,_hasFilter:!1,ctor:function(t,e){this._super(e),exports.cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},_init:function(){var t=this._gafproto.getFrame();exports.cc.assert(t instanceof exports.cc.SpriteFrame,"Error. Wrong object type."),this._sprite=new exports.cc.Sprite,this._sprite._renderCmd=this._gafCreateRenderCmd(this._sprite),this._sprite.initWithSpriteFrame(t),this._sprite.setAnchorPoint(this._gafproto.getAnchor()),this.addChild(this._sprite),this._sprite.setOpacityModifyRGB(!0),exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&this._sprite.setBlendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)},_applyState:function(t,e){this._applyStateSuper(t,e),this._needsCtx?(this._hasCtx||(this._enableCtx(),this._hasCtx=!0),this._applyCtxState(t)):(this._hasCtx&&(this._disableCtx(),this._hasCtx=!1),exports.cc.colorEqual(this._sprite._realColor,this._cascadeColorMult)||this._sprite.setColor(this._cascadeColorMult),this._sprite.getOpacity()!=this._cascadeColorMult.a&&this._sprite.setOpacity(this._cascadeColorMult.a))},_enableCtx:function(){this._sprite._renderCmd._enableCtx()},_disableCtx:function(){this._sprite._renderCmd._disableCtx()},_applyCtxState:function(t){this._sprite._renderCmd._applyCtxState(this)},getBoundingBoxForCurrentFrame:function(){var t=this._sprite.getBoundingBox();return exports.cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},_gafCreateRenderCmd:function(t){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new exports.gaf.Sprite.CanvasRenderCmd(t):new exports.gaf.Sprite.WebGLRenderCmd(t)}});exports.gaf.Mask=exports.gaf.Object.extend({_className:"GAFMask",_clippingNode:null,ctor:function(t){this._super(),exports.cc.assert(t,"Error! Missing mandatory parameter."),this._gafproto=t},_init:function(){var t=this._gafproto.getMaskNodeProto();exports.cc.assert(t,"Error. Mask node for id ref "+this._gafproto.getIdRef()+" not found."),this._maskNode=t._gafConstruct(),this._clippingNode=exports.cc.ClippingNode.create(this._maskNode),this._clippingNode.setAlphaThreshold(.5),this.addChild(this._clippingNode)},setExternalTransform:function(t){exports.cc.affineTransformEqualToTransform(this._maskNode._additionalTransform,t)||this._maskNode.setAdditionalTransform(t)},_getNode:function(){return this._clippingNode}});(function(){exports.gaf.Sprite.CanvasRenderCmd=function(e){exports.cc.Sprite.CanvasRenderCmd.call(this,e),this._hasTintMult=!1,this._hasTintOffset=!1,this._hasCtx=!1,this._tintMult=exports.cc.color(255,255,255,255),this._tintOffset=exports.cc.color(0,0,0,0),this._textureDirty=!1};var t=exports.gaf.Sprite.CanvasRenderCmd.prototype=Object.create(exports.cc.Sprite.CanvasRenderCmd.prototype);t.constructor=exports.gaf.Sprite.CanvasRenderCmd,t._disableCtx=function(){this._hasTintOffset=!1,this._hasCtx=!1,this._textureDirty=!0,this.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty),this._tintMult=exports.cc.color(255,255,255,255),this._tintOffset=exports.cc.color(0,0,0,0)},t._enableCtx=function(){},t._applyCtxState=function(e){var r=e._cascadeColorMult,n=e._cascadeColorOffset,s=r.a;this._node.getOpacity()!=s&&this._node.setOpacity(s);var o=!exports.cc.colorEqual(this._tintMult,r);o&&(this._node.setColor(r),this._tintMult=r,this._hasTintMult=r.r!==255||r.g!==255||r.b!==255);var a=this._tintOffset.r!=n.r||this._tintOffset.g!=n.g||this._tintOffset.b!=n.b||this._tintOffset.a!=n.a;a&&(this._tintOffset=n,this._hasTintOffset=n.r!==0||n.g!==0||n.b!==0||n.a!==0),this._textureDirty=o||a,this._textureDirty&&this.setDirtyFlag(exports.cc.Node._dirtyFlags.colorDirty),this._hasCtx=e._filterStack.length>0&&e._filterStack[0].type===exports.gaf.EFFECT_COLOR_MATRIX},t.rendering=function(e,r,n){var s=this._node,o=this._textureCoord,a=this._displayedOpacity/255;if(!(s._texture&&(o.width===0||o.height===0||!s._texture._textureLoaded)||a===0)){var c=e||exports.cc._renderContext,l=c.getContext(),h=s._offsetPosition.x,u=s._rect.height,_=s._rect.width,d=-s._offsetPosition.y-u,f;c.setTransform(this._worldTransform,r,n),c.setCompositeOperation(this._blendFuncStr),c.setGlobalAlpha(a),(s._flippedX||s._flippedY)&&c.save(),s._flippedX&&(h=-h-_,l.scale(-1,1)),s._flippedY&&(d=s._offsetPosition.y,l.scale(1,-1)),f=s._texture._htmlElementObj,this._colorized?l.drawImage(f,0,0,o.width,o.height,h*r,d*n,_*r,u*n):l.drawImage(f,o.renderX,o.renderY,o.width,o.height,h*r,d*n,_*r,u*n),(s._flippedX||s._flippedY)&&c.restore(),exports.cc.g_NumberOfDraws++}},exports.cc.sys._supportCanvasNewBlendModes&&(t._updateColor=function(){var e=this._displayedColor,r=this._node;if(this._hasTintMult|=e.r!==255||e.g!==255||e.b!==255,this._textureDirty)this._textureDirty=!1,this._colorized&&(this._colorized=!1,r.texture=this._originalTexture);else return;var n,s=r._texture,o=this._textureCoord;if(this._hasTintMult&&s&&o.validRect&&this._originalTexture){if(n=s.getHtmlElementObj(),!n)return;this._colorized=!0,(this._hasTintOffset||this._hasCtx)&&(e=this._tintMult),n=exports.cc.Sprite.CanvasRenderCmd._generateTintImageWithMultiply(this._originalTexture._htmlElementObj,e,o),s=new exports.cc.Texture2D,s.initWithElement(n),s.handleLoadedTexture(),r.texture=s}if(s=r._texture,this._hasTintOffset){var a=exports.cc.textureCache.getTextureColors(this._originalTexture.getHtmlElementObj());if(s&&o.validRect&&this._originalTexture){if(n=s.getHtmlElementObj(),!n)return;if(this._colorized)var c=exports.cc.rect(0,0,o.width,o.height);else c=o;n=this._gafGenerateTintImage(r.texture._htmlElementObj,c,a,this._tintOffset,o),s=new exports.cc.Texture2D,s.initWithElement(n),s.handleLoadedTexture(),r.texture=s,this._colorized=!0}}},t._gafGenerateTintImage=function(e,r,n,s,o,a){o||(o=exports.cc.rect(0,0,e.width,e.height));var c=Math.min(o.width,n[0].width),l=Math.min(o.height,n[0].height),h=a,u;return h?(u=h.getContext("2d"),u.clearRect(0,0,c,l)):(h=document.createElement("canvas"),h.width=c,h.height=l,u=h.getContext("2d")),u.save(),u.globalCompositeOperation="source-over",u.drawImage(n[2],o.x,o.y,c,l,0,0,c,l),u.globalCompositeOperation="source-in",u.fillStyle="rgba("+Math.round(s.r)+","+Math.round(s.g)+","+Math.round(s.b)+",1)",u.fillRect(0,0,c,l),u.globalCompositeOperation="lighter",u.drawImage(e,r.x,r.y,c,l,0,0,c,l),u.restore(),h})})();exports.gaf._TimeLineProto=function(t,e,r,n,s,o){s=typeof s!="undefined"?s:0,o=o||"",this._objects=[],this.getTotalFrames=function(){return e},this.getBoundingBox=function(){return r},this.getId=function(){return s},this.getLinkageName=function(){return o},this.getPivot=function(){return n},this.getRect=function(){return r},this.getNamedParts=function(){return{}},this.getSequences=function(){return{}},this.getFrames=function(){return[]},this.getFps=function(){return 60},this.getObjects=function(){return this._objects},this.getAsset=function(){return t},this._gafConstruct=function(){var a=this.getAsset()._usedAtlasScale,c=new exports.gaf.TimeLine(this,a);return c._init(),c}};exports.gaf._SpriteProto=function(t,e,r){this.getFrames=function(){return e},this.getIdRef=function(){return r},this.getAsset=function(){return t},this._gafConstruct=function(){var n=this.getAsset()._usedAtlasScale,s=new exports.gaf.Sprite(this,n);return s._init(),s}};exports.gaf._SpriteProto.prototype.getFrame=function(){var t=this.getAsset()._usedAtlasScale;exports.cc.assert(t,"Error. Atlas scale zero.");var e=this.getFrames()[t];return exports.cc.assert(e,"Error. No frames found for used scale `"+t+"`"),e[this.getIdRef()]};exports.gaf._SpriteProto.prototype.getAnchor=function(){return this.getFrame()._gafAnchor};exports.gaf._MaskProto=function(t,e,r){this.getIdRef=function(){return r},this.getMaskNodeProto=function(){return e},this._gafConstruct=function(){var n=new exports.gaf.Mask(this);return n._init(),n}};exports.gaf.ReadSingleTag=function(t){var e=t.Ushort(),r=exports.gaf.Tags[e],n={};return typeof r=="undefined"?(console.log("GAF. Non implemented tag detected."),exports.gaf.Tags.Default.parse(t,e)):n=r.parse(t,e),n};exports.gaf.ReadTags=function(t){var e=[];try{do{var r=exports.gaf.ReadSingleTag(t);e.push(r)}while(r.tagId!=0)}catch(n){if(n instanceof Error&&n.message=="GAF format error")console.log(`GAF format error:
`+n.stack);else throw console.log(n.stack),n}return e};exports.gaf.Tag=function(){this.Default=Object.create(exports.gaf.Tag.base),this[0]=Object.create(exports.gaf.Tag.End),this[1]=Object.create(exports.gaf.Tag.DefineAtlas),this[2]=Object.create(exports.gaf.Tag.DefineAnimationMasks),this[3]=Object.create(exports.gaf.Tag.DefineAnimationObjects),this[4]=Object.create(exports.gaf.Tag.DefineAnimationFrames),this[5]=Object.create(exports.gaf.Tag.DefineNamedParts),this[6]=Object.create(exports.gaf.Tag.DefineSequences),this[7]=Object.create(exports.gaf.Tag.DefineTextFields),this[8]=Object.create(exports.gaf.Tag.DefineAtlas2),this[9]=Object.create(exports.gaf.Tag.DefineStage),this[10]=Object.create(exports.gaf.Tag.DefineAnimationObjects2),this[11]=Object.create(exports.gaf.Tag.DefineAnimationMasks2),this[12]=Object.create(exports.gaf.Tag.DefineAnimationFrames2),this[13]=Object.create(exports.gaf.Tag.DefineTimeline)};exports.gaf.Tag.base=function(){};exports.gaf.Tag.base.parse=function(t,e){var r=t.Uint();t.startNestedBuffer(r);var n=this.doParse(t);return t.endNestedBuffer(),n.tagName=this.tagName,n.tagId=e,n};exports.gaf.Tag.base.doParse=function(t){return{}};exports.gaf.Tag.End=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.End.tagName="TagEnd";exports.gaf.Tag.DefineAtlas=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAtlas.tagName="TagDefineAtlas";exports.gaf.Tag.DefineAtlas.doParse=function(t){var e=t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint")));return{content:e()}};exports.gaf.Tag.DefineAnimationMasks=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationMasks.tagName="TagDefineAnimationMasks";exports.gaf.Tag.DefineAnimationMasks.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint")),r={content:e()};debugger;return r};exports.gaf.Tag.DefineAnimationObjects=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationObjects.tagName="TagDefineAnimationObjects";exports.gaf.Tag.DefineAnimationObjects.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint"));return{content:e()}};exports.gaf.Tag.DefineAnimationFrames=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationFrames.tagName="TagDefineAnimationFrames";exports.gaf.Tag.DefineAnimationFrames.doParse=function(t){var e=t.array("Uint",t.fields("frame","Uint","state",t.array("Uint",t.fields("hasColorTransform","Ubyte","hasMask","Ubyte","hasEffect","Ubyte","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",exports.gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,t.fields("maskObjectIdRef","Uint"))))));return{content:e()}};exports.gaf.Tag.DefineNamedParts=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineNamedParts.tagName="TagDefineNamedParts";exports.gaf.Tag.DefineNamedParts.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","name","String"));return{content:e()}};exports.gaf.Tag.DefineSequences=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineSequences.tagName="TagDefineSequences";exports.gaf.Tag.DefineSequences.doParse=function(t){var e=t.array("Uint",t.fields("id","String","start","Ushort","end","Ushort"));return{content:e()}};exports.gaf.Tag.DefineTextFields=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineTextFields.tagName="TagDefineTextFields";exports.gaf.Tag.DefineTextFields.doParse=function(t){var e=t.array("Uint",t.fields("id","Uint","pivot","Point","end","Ushort","width","Float","height","Float","text","String","embedFonts","Boolean","multiline","Boolean","wordWrap","Boolean","hasRestrict","Boolean","restrict",t.condition("hasRestrict",1,function(){return t.String}),"editable","Boolean","selectable","Boolean","displayAsPassword","Boolean","maxChars","Uint","align","Uint","blockIndent","Uint","bold","Boolean","bullet","Boolean","color","color","font","String","indent","Uint","italic","Boolean","kerning","Boolean","leading","Uint","leftMargin","Uint","letterSpacing","Float","rightMargin","Uint","size","Uint","tabStops",t.array("Uint",t.fields("value","Uint")),"target","string","underline","Boolean","url","String"));return{content:e()}};exports.gaf.Tag.DefineAtlas2=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAtlas2.tagName="TagDefineAtlas2";exports.gaf.Tag.DefineAtlas2.doParse=function(t){var e=t.fields("scale","Float","atlases",t.array("Ubyte",t.fields("id","Uint","sources",t.array("Ubyte",t.fields("source","String","csf","Float")))),"elements",t.array("Uint",t.fields("pivot","Point","origin","Point","scale","Float","size","Point","atlasId","Uint","elementAtlasId","Uint","hasScale9Grid","Boolean","scale9GridRect",t.condition("hasScale9Grid",1,function(){return t.Rect()}))));return{content:e()}};exports.gaf.Tag.DefineStage=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineStage.tagName="TagDefineStage";exports.gaf.Tag.DefineStage.doParse=function(t){var e=t.fields("fps","Ubyte","color","color","width","Ushort","height","Ushort");return{content:e()}};exports.gaf.Tag.DefineAnimationObjects2=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationObjects2.tagName="TagDefineAnimationObjects2";exports.gaf.Tag.DefineAnimationObjects2.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"));return{content:e()}};exports.gaf.Tag.DefineAnimationMasks2=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationMasks2.tagName="TagDefineAnimationMasks2";exports.gaf.Tag.DefineAnimationMasks2.doParse=function(t){var e=t.array("Uint",t.fields("objectId","Uint","elementAtlasIdRef","Uint","type","Ushort"));return{content:e()}};exports.gaf.Tag.DefineAnimationFrames2=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineAnimationFrames2.tagName="TagDefineAnimationFrames2";exports.gaf.Tag.DefineAnimationFrames2.doParse=function(t){var e=t.array("Uint",t.fields("frame","Uint","hasChangesInDisplayList","Boolean","hasActions","Boolean","state",t.condition("hasChangesInDisplayList",1,t.array("Uint",t.fields("hasColorTransform","Boolean","hasMask","Boolean","hasEffect","Boolean","objectIdRef","Uint","depth","Int","alpha","Float","matrix","Matrix","colorTransform",t.condition("hasColorTransform",1,t.fields("alphaOffset","Float","redMultiplier","Float","redOffset","Float","greenMultiplier","Float","greenOffset","Float","blueMultiplier","Float","blueOffset","Float")),"effect",t.condition("hasEffect",1,t.array("Ubyte",exports.gaf.Tag._readFilter(t))),"maskObjectIdRef",t.condition("hasMask",1,function(){return t.Uint()})))),"actions",t.condition("hasActions",1,t.array("Uint",t.fields("type","Uint","scope","String","params",exports.gaf.Tag._readActionArguments(t))))));return{content:e()}};exports.gaf.Tag.DefineTimeline=Object.create(exports.gaf.Tag.base);exports.gaf.Tag.DefineTimeline.tagName="TagDefineTimeline";exports.gaf.Tag.DefineTimeline.doParse=function(t){var e=t.fields("id","Uint","animationFrameCount","Uint","boundingBox","Rect","pivotPoint","Point","hasLinkage","Boolean","linkageName",t.condition("hasLinkage",1,function(){return t.String()})),r={content:e()};return r.content.tags=exports.gaf.ReadTags(t),r};exports.gaf.Tag._readActionArguments=function(t){return function(){var e=t.Uint(),r=[];for(t.startNestedBuffer(e);t.maxOffset()<t.tell();)r.push(t.String());return t.endNestedBuffer(),r}};exports.gaf.Tag._readFilter=function(t){return t.fields("type","Uint","dropShadow",t.condition("type",exports.gaf.EFFECT_DROP_SHADOW,t.fields("color","color","blurX","Float","blurY","Float","angle","Float","distance","Float","strength","Float","inner","Boolean","knockout","Boolean")),"blur",t.condition("type",exports.gaf.EFFECT_BLUR,t.fields("blurX","Float","blurY","Float")),"glow",t.condition("type",exports.gaf.EFFECT_GLOW,t.fields("color","color","blurX","Float","blurY","Float","strength","Float","inner","Boolean","knockout","Boolean")),"colorMatrix",t.condition("type",exports.gaf.EFFECT_COLOR_MATRIX,t.fields("rr","Float","gr","Float","br","Float","ar","Float","r","Float","rg","Float","gg","Float","bg","Float","ag","Float","g","Float","rb","Float","gb","Float","bb","Float","ab","Float","b","Float","ra","Float","ga","Float","ba","Float","aa","Float","a","Float")))};exports.gaf.Tags=new exports.gaf.Tag;exports.gaf=exports.gaf||{};exports.gaf.Loader=function(){var t=function(n,s){s.compression=n.Uint(),s.versionMajor=n.Ubyte(),s.versionMinor=n.Ubyte(),s.fileLength=n.Uint()},e=function(n,s){s.framesCount=n.Ushort(),s.frameSize=n.Rect(),s.pivot=n.Point()},r=function(n,s){var o=n.Uint();s.scaleValues=[];for(var a=0;a<o;++a)s.scaleValues.push(n.Float());var c=n.Uint();s.csfValues=[];for(var a=0;a<c;++a)s.csfValues.push(n.Float())};this.LoadFile=function(n,s){var o=new XMLHttpRequest;o.open("GET",n,!0);var a=this||window;o.responseType="arraybuffer",o.onload=function(c){var l=new exports.gaf.DataReader(o.response),h=a.LoadStream(l);s&&s(h)},o.send()},this.LoadStream=function(n){var s={};if(t(n,s),s.compression!=exports.gaf.COMPRESSION_NONE)if(s.compression==exports.gaf.COMPRESSION_ZIP){var o=n.dataRaw.slice(n.tell()),a=new window.Zlib.Inflate(new Uint8Array(o)),c=a.decompress();n=new exports.gaf.DataReader(c.buffer)}else throw new Error("GAF syntax error.");s.versionMajor<4?e(n,s):r(n,s);var l=exports.gaf.ReadTags(n);return{header:s,tags:l}}};exports.gaf.DataReader=function(t){this.dataRaw=t,this.buf=new DataView(t),this.offset=[0]};exports.gaf.DataReader.prototype.constructor=exports.gaf.DataReader;exports.gaf.DataReader.prototype.newOffset=function(t){if(this.offset[this.offset.length-1]+=t,this.getOffset()>this.maxOffset())throw new Error("GAF format error");return this.offset[this.offset.length-1]-t};exports.gaf.DataReader.prototype.maxOffset=function(){return this.offset.length==1?this.buf.byteLength:this.offset[this.offset.length-2]};exports.gaf.DataReader.prototype.getOffset=function(t){return this.offset[this.offset.length-1]};exports.gaf.DataReader.prototype.Ubyte=function(){return this.buf.getUint8(this.newOffset(1))};exports.gaf.DataReader.prototype.Boolean=function(){var t=this.buf.getUint8(this.newOffset(1));if(t>1)throw new Error("GAF format error");return t};exports.gaf.DataReader.prototype.Uint=function(){return this.buf.getUint32(this.newOffset(4),!0)};exports.gaf.DataReader.prototype.Int=function(){return this.buf.getInt32(this.newOffset(4),!0)};exports.gaf.DataReader.prototype.color=function(){return{b:this.Ubyte(),g:this.Ubyte(),r:this.Ubyte(),a:this.Ubyte()}};exports.gaf.DataReader.prototype.Ushort=function(){return this.buf.getUint16(this.newOffset(2),!0)};exports.gaf.DataReader.prototype.Float=function(){return this.buf.getFloat32(this.newOffset(4),!0)};exports.gaf.DataReader.prototype.String=function(){var t=this.Ushort(),e=this.newOffset(t),r=this.getOffset();try{var n=this.dataRaw.slice(e,r)}catch(o){if(o.message=="Object doesn't support property or method 'slice'"){n=[];for(var s=e;s<r;++s)n.push(this.buf.getUint8(s))}else throw o}return decodeURIComponent(escape(String.fromCharCode.apply(null,new Uint8Array(n))))};exports.gaf.DataReader.prototype.startNestedBuffer=function(t){this.offset.push(this.offset[this.offset.length-1]),this.offset[this.offset.length-2]+=t};exports.gaf.DataReader.prototype.endNestedBuffer=function(){if(this.offset.length==1)throw new Error("No nested buffer available");this.offset.pop()};exports.gaf.DataReader.prototype.Point=function(){return{x:this.Float(),y:this.Float()}};exports.gaf.DataReader.prototype.Rect=function(){return{x:this.Float(),y:this.Float(),width:this.Float(),height:this.Float()}};exports.gaf.DataReader.prototype.Matrix=function(){return{a:this.Float(),b:this.Float(),c:this.Float(),d:this.Float(),tx:this.Float(),ty:this.Float()}};exports.gaf.DataReader.prototype.seek=function(t){this.offset[this.offset.length-1]=t};exports.gaf.DataReader.prototype.tell=function(){return this.offset[this.offset.length-1]};exports.gaf.DataReader.prototype.fields=function(){var t=this||window,e=arguments;return function(){arguments.callee.result={};var r=0;if(e.length%2)throw new Error("Number of arguments is not even");for(;r<e.length;){var n=e[r++],s=e[r++];if(typeof s=="function")arguments.callee.result[n]=s();else if(s in t&&typeof t[s]=="function")arguments.callee.result[n]=t[s].call(t);else throw new Error("Object DataReader has no function `"+s+"`")}return arguments.callee.result}};exports.gaf.DataReader.prototype.condition=function(t,e,r){var n=arguments;return function(){if(n.length!=3)throw new Error("Condition function");var s=arguments.callee.caller;if(!("result"in s))throw new Error("Condition function caller has no key `result`");var o=s.result,a=n[0],c=n[1],l=n[2],h=null;return typeof c=="function"?h=function(){return c(o[a])}:h=function(){return c==o[a]},h()?l():null}};exports.gaf.DataReader.prototype.array=function(){var t=this||window,e=arguments;return function(){arguments.callee.result=[];for(var r=t[e[0]].call(t),n=0;n<r;++n){var s=e[1].call();arguments.callee.result.push(s)}return arguments.callee.result}};exports.gaf.SHADER_GAUSSIAN_BLUR_FRAG=`varying mediump vec2 v_texCoord;
uniform mediump vec2 u_step;
void main()
{ 
    mediump vec4 sum = vec4(0.0);                                      
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   
    gl_FragColor = sum;                                                
} 
`;exports.gaf.SHADER_GLOW_FRAG=`varying mediump vec2 v_texCoord;
uniform mediump vec2 u_step;
uniform mediump vec4 u_glowColor;
void main()
{ 
    mediump vec4 sum = vec4(0.0);                                      
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 4.0) * 0.05;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 3.0) * 0.09;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 2.0) * 0.12;   
    sum += texture2D(CC_Texture0, v_texCoord - u_step * 1.0) * 0.15;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 0.0) * 0.18;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 1.0) * 0.15;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 2.0) * 0.12;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 3.0) * 0.09;   
    sum += texture2D(CC_Texture0, v_texCoord + u_step * 4.0) * 0.05;   
    gl_FragColor = sum * u_glowColor;                                  
} 
`;exports.gaf.SHADER_COLOR_MATRIX_FRAG=`varying mediump vec2 v_texCoord;
varying mediump vec4 v_fragmentColor;
uniform mediump vec4 colorTransformMult;
uniform mediump vec4 colorTransformOffsets;
uniform mediump mat4 colorMatrix;
uniform mediump vec4 colorMatrix2;
void main()
{ 
    vec4 texColor = texture2D(CC_Texture0, v_texCoord);                          
    const float kMinimalAlphaAllowed = 1.0e-8;                                   
    if (texColor.a > kMinimalAlphaAllowed)                                       
    {                                                                            
        texColor = vec4(texColor.rgb / texColor.a, texColor.a);                  
        vec4 ctxColor = texColor * colorTransformMult + colorTransformOffsets;   
        vec4 adjustColor = colorMatrix * ctxColor + colorMatrix2;                
        adjustColor *= v_fragmentColor;                                          
        texColor = vec4(adjustColor.rgb * adjustColor.a, adjustColor.a);         
    }                                                                            
    gl_FragColor = texColor;                                                     
}
`;exports.gaf._glShaderInit=function(){exports.gaf._Uniforms={ColorTransformMult:-1,ColorTransformOffset:-1,ColorMatrixBody:-1,ColorMatrixAppendix:-1,BlurTexelOffset:-1,GlowTexelOffset:-1,GlowColor:-1},exports.gaf._shaderCreate=function(t,e){var r=new exports.cc.GLProgram,n=r.initWithVertexShaderByteArray(e,t);return exports.cc.assert(n,"Shader init error"),r.addAttribute(exports.cc.ATTRIBUTE_NAME_POSITION,exports.cc.VERTEX_ATTRIB_POSITION),r.addAttribute(exports.cc.ATTRIBUTE_NAME_COLOR,exports.cc.VERTEX_ATTRIB_COLOR),r.addAttribute(exports.cc.ATTRIBUTE_NAME_TEX_COORD,exports.cc.VERTEX_ATTRIB_TEX_COORDS),n=r.link(),exports.cc.assert(n,"Shader linking error"),r.updateUniforms(),r},exports.gaf._shaderCreateAlpha=function(){var t=exports.gaf._shaderCreate(exports.gaf.SHADER_COLOR_MATRIX_FRAG,exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return exports.gaf._Uniforms.ColorTransformMult=t.getUniformLocationForName(exports.gaf.UNIFORM_ALPHA_TINT_MULT),exports.gaf._Uniforms.ColorTransformOffset=t.getUniformLocationForName(exports.gaf.UNIFORM_ALPHA_TINT_OFFSET),exports.gaf._Uniforms.ColorMatrixBody=t.getUniformLocationForName(exports.gaf.UNIFORM_ALPHA_COLOR_MATRIX_BODY),exports.gaf._Uniforms.ColorMatrixAppendix=t.getUniformLocationForName(exports.gaf.UNIFORM_ALPHA_COLOR_MATRIX_APPENDIX),t},exports.gaf._shaderCreateBlur=function(){var t=exports.gaf._shaderCreate(exports.gaf.SHADER_GAUSSIAN_BLUR_FRAG,exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return exports.gaf._Uniforms.BlurTexelOffset=t._glContext.getUniformLocation(t._programObj,exports.gaf.UNIFORM_BLUR_TEXEL_OFFSET),t},exports.gaf._shaderCreateGlow=function(){var t=exports.gaf._shaderCreate(exports.gaf.SHADER_GLOW_FRAG,exports.cc.SHADER_POSITION_TEXTURE_COLOR_VERT);return exports.gaf._Uniforms.GlowTexelOffset=t._glContext.getUniformLocation(t._programObj,exports.gaf.UNIFORM_GLOW_TEXEL_OFFSET),exports.gaf._Uniforms.GlowColor=t._glContext.getUniformLocation(t._programObj,exports.gaf.UNIFORM_GLOW_COLOR),t},exports.gaf._Shaders={Alpha:exports.gaf._shaderCreateAlpha(),Blur:exports.gaf._shaderCreateBlur(),Glow:exports.gaf._shaderCreateGlow()}};exports.gaf._setupShaders=function(){exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?exports.gaf._glShaderInit():delete exports.gaf._glShaderInit};exports.gaf._AtlasLoader={};exports.gaf._AtlasLoader.execute=function(t,e,r){t()?e():r()};exports.gaf._AtlasLoader.checkAtlas=function(t){return function(){return t&&typeof t!="string"&&t.isLoaded()}};exports.gaf._AtlasLoader.load=function(t,e,r){exports.cc.textureCache.addImage(t,function(n){exports.gaf._AtlasLoader.execute(exports.gaf._AtlasLoader.checkAtlas(n),function(){e(n)},r)})};exports.gaf._AtlasLoader.loadFront=function(t,e,r){return function(){t.length>0?exports.gaf._AtlasLoader.load(t[0],e,exports.gaf._AtlasLoader.loadFront(t.slice(1),e,r)):r()}};exports.gaf._AtlasLoader.loadArray=function(t,e,r){exports.gaf._AtlasLoader.loadFront(t,e,r)()};var Box2D={};(function(t,e){!(Object.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(n,s,o){o.get instanceof Function&&n.__defineGetter__(s,o.get),o.set instanceof Function&&n.__defineSetter__(s,o.set)});function r(){}t.inherit=function(n,s){var o=n;r.prototype=s.prototype,n.prototype=new r,n.prototype.constructor=o},t.generateCallback=function(s,o){return function(){o.apply(s,arguments)}},t.NVector=function(s){s===e&&(s=0);for(var o=new Array(s||0),a=0;a<s;++a)o[a]=0;return o},t.is=function(s,o){return s===null?!1:!!(o instanceof Function&&s instanceof o||s.constructor.__implements!=e&&s.constructor.__implements[o])},t.parseUInt=function(n){return Math.abs(parseInt(n))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D=="undefined"&&(Box2D={});typeof Box2D.Collision=="undefined"&&(Box2D.Collision={});typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={});typeof Box2D.Common=="undefined"&&(Box2D.Common={});typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={});typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={});typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={});typeof Box2D.Dynamics.Controllers=="undefined"&&(Box2D.Dynamics.Controllers={});typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={});(function(){Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";function t(){t.b2AABB.apply(this,arguments)}Box2D.Collision.b2AABB=t;function e(){e.b2Bound.apply(this,arguments)}Box2D.Collision.b2Bound=e;function r(){r.b2BoundValues.apply(this,arguments),this.constructor===r&&this.b2BoundValues.apply(this,arguments)}Box2D.Collision.b2BoundValues=r;function n(){n.b2Collision.apply(this,arguments)}Box2D.Collision.b2Collision=n;function s(){s.b2ContactID.apply(this,arguments),this.constructor===s&&this.b2ContactID.apply(this,arguments)}Box2D.Collision.b2ContactID=s;function o(){o.b2ContactPoint.apply(this,arguments)}Box2D.Collision.b2ContactPoint=o;function a(){a.b2Distance.apply(this,arguments)}Box2D.Collision.b2Distance=a;function c(){c.b2DistanceInput.apply(this,arguments)}Box2D.Collision.b2DistanceInput=c;function l(){l.b2DistanceOutput.apply(this,arguments)}Box2D.Collision.b2DistanceOutput=l;function h(){h.b2DistanceProxy.apply(this,arguments)}Box2D.Collision.b2DistanceProxy=h;function u(){u.b2DynamicTree.apply(this,arguments),this.constructor===u&&this.b2DynamicTree.apply(this,arguments)}Box2D.Collision.b2DynamicTree=u;function _(){_.b2DynamicTreeBroadPhase.apply(this,arguments)}Box2D.Collision.b2DynamicTreeBroadPhase=_;function d(){d.b2DynamicTreeNode.apply(this,arguments)}Box2D.Collision.b2DynamicTreeNode=d;function f(){f.b2DynamicTreePair.apply(this,arguments)}Box2D.Collision.b2DynamicTreePair=f;function T(){T.b2Manifold.apply(this,arguments),this.constructor===T&&this.b2Manifold.apply(this,arguments)}Box2D.Collision.b2Manifold=T;function x(){x.b2ManifoldPoint.apply(this,arguments),this.constructor===x&&this.b2ManifoldPoint.apply(this,arguments)}Box2D.Collision.b2ManifoldPoint=x;function m(){m.b2Point.apply(this,arguments)}Box2D.Collision.b2Point=m;function v(){v.b2RayCastInput.apply(this,arguments),this.constructor===v&&this.b2RayCastInput.apply(this,arguments)}Box2D.Collision.b2RayCastInput=v;function A(){A.b2RayCastOutput.apply(this,arguments)}Box2D.Collision.b2RayCastOutput=A;function D(){D.b2Segment.apply(this,arguments)}Box2D.Collision.b2Segment=D;function N(){N.b2SeparationFunction.apply(this,arguments)}Box2D.Collision.b2SeparationFunction=N;function z(){z.b2Simplex.apply(this,arguments),this.constructor===z&&this.b2Simplex.apply(this,arguments)}Box2D.Collision.b2Simplex=z;function M(){M.b2SimplexCache.apply(this,arguments)}Box2D.Collision.b2SimplexCache=M;function J(){J.b2SimplexVertex.apply(this,arguments)}Box2D.Collision.b2SimplexVertex=J;function U(){U.b2TimeOfImpact.apply(this,arguments)}Box2D.Collision.b2TimeOfImpact=U;function K(){K.b2TOIInput.apply(this,arguments)}Box2D.Collision.b2TOIInput=K;function tt(){tt.b2WorldManifold.apply(this,arguments),this.constructor===tt&&this.b2WorldManifold.apply(this,arguments)}Box2D.Collision.b2WorldManifold=tt;function rt(){rt.ClipVertex.apply(this,arguments)}Box2D.Collision.ClipVertex=rt;function I(){I.Features.apply(this,arguments)}Box2D.Collision.Features=I;function L(){L.b2CircleShape.apply(this,arguments),this.constructor===L&&this.b2CircleShape.apply(this,arguments)}Box2D.Collision.Shapes.b2CircleShape=L;function G(){G.b2EdgeChainDef.apply(this,arguments),this.constructor===G&&this.b2EdgeChainDef.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeChainDef=G;function w(){w.b2EdgeShape.apply(this,arguments),this.constructor===w&&this.b2EdgeShape.apply(this,arguments)}Box2D.Collision.Shapes.b2EdgeShape=w;function O(){O.b2MassData.apply(this,arguments)}Box2D.Collision.Shapes.b2MassData=O;function j(){j.b2PolygonShape.apply(this,arguments),this.constructor===j&&this.b2PolygonShape.apply(this,arguments)}Box2D.Collision.Shapes.b2PolygonShape=j;function Q(){Q.b2Shape.apply(this,arguments),this.constructor===Q&&this.b2Shape.apply(this,arguments)}Box2D.Collision.Shapes.b2Shape=Q,Box2D.Common.b2internal="Box2D.Common.b2internal";function C(){C.b2Color.apply(this,arguments),this.constructor===C&&this.b2Color.apply(this,arguments)}Box2D.Common.b2Color=C;function b(){b.b2Settings.apply(this,arguments)}Box2D.Common.b2Settings=b;function W(){W.b2Mat22.apply(this,arguments),this.constructor===W&&this.b2Mat22.apply(this,arguments)}Box2D.Common.Math.b2Mat22=W;function S(){S.b2Mat33.apply(this,arguments),this.constructor===S&&this.b2Mat33.apply(this,arguments)}Box2D.Common.Math.b2Mat33=S;function E(){E.b2Math.apply(this,arguments)}Box2D.Common.Math.b2Math=E;function R(){R.b2Sweep.apply(this,arguments)}Box2D.Common.Math.b2Sweep=R;function F(){F.b2Transform.apply(this,arguments),this.constructor===F&&this.b2Transform.apply(this,arguments)}Box2D.Common.Math.b2Transform=F;function k(){k.b2Vec2.apply(this,arguments),this.constructor===k&&this.b2Vec2.apply(this,arguments)}Box2D.Common.Math.b2Vec2=k;function X(){X.b2Vec3.apply(this,arguments),this.constructor===X&&this.b2Vec3.apply(this,arguments)}Box2D.Common.Math.b2Vec3=X;function Z(){Z.b2Body.apply(this,arguments),this.constructor===Z&&this.b2Body.apply(this,arguments)}Box2D.Dynamics.b2Body=Z;function V(){V.b2BodyDef.apply(this,arguments),this.constructor===V&&this.b2BodyDef.apply(this,arguments)}Box2D.Dynamics.b2BodyDef=V;function Y(){Y.b2ContactFilter.apply(this,arguments)}Box2D.Dynamics.b2ContactFilter=Y;function $(){$.b2ContactImpulse.apply(this,arguments)}Box2D.Dynamics.b2ContactImpulse=$;function et(){et.b2ContactListener.apply(this,arguments)}Box2D.Dynamics.b2ContactListener=et;function ct(){ct.b2ContactManager.apply(this,arguments),this.constructor===ct&&this.b2ContactManager.apply(this,arguments)}Box2D.Dynamics.b2ContactManager=ct;function ht(){ht.b2DebugDraw.apply(this,arguments),this.constructor===ht&&this.b2DebugDraw.apply(this,arguments)}Box2D.Dynamics.b2DebugDraw=ht;function pt(){pt.b2DestructionListener.apply(this,arguments)}Box2D.Dynamics.b2DestructionListener=pt;function mt(){mt.b2FilterData.apply(this,arguments)}Box2D.Dynamics.b2FilterData=mt;function dt(){dt.b2Fixture.apply(this,arguments),this.constructor===dt&&this.b2Fixture.apply(this,arguments)}Box2D.Dynamics.b2Fixture=dt;function xt(){xt.b2FixtureDef.apply(this,arguments),this.constructor===xt&&this.b2FixtureDef.apply(this,arguments)}Box2D.Dynamics.b2FixtureDef=xt;function Tt(){Tt.b2Island.apply(this,arguments),this.constructor===Tt&&this.b2Island.apply(this,arguments)}Box2D.Dynamics.b2Island=Tt;function lt(){lt.b2TimeStep.apply(this,arguments)}Box2D.Dynamics.b2TimeStep=lt;function at(){at.b2World.apply(this,arguments),this.constructor===at&&this.b2World.apply(this,arguments)}Box2D.Dynamics.b2World=at;function At(){At.b2CircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2CircleContact=At;function St(){St.b2Contact.apply(this,arguments),this.constructor===St&&this.b2Contact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2Contact=St;function wt(){wt.b2ContactConstraint.apply(this,arguments),this.constructor===wt&&this.b2ContactConstraint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraint=wt;function Pt(){Pt.b2ContactConstraintPoint.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactConstraintPoint=Pt;function It(){It.b2ContactEdge.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactEdge=It;function zt(){zt.b2ContactFactory.apply(this,arguments),this.constructor===zt&&this.b2ContactFactory.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactFactory=zt;function Vt(){Vt.b2ContactRegister.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactRegister=Vt;function ot(){ot.b2ContactResult.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactResult=ot;function st(){st.b2ContactSolver.apply(this,arguments),this.constructor===st&&this.b2ContactSolver.apply(this,arguments)}Box2D.Dynamics.Contacts.b2ContactSolver=st;function ut(){ut.b2EdgeAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ut;function ft(){ft.b2NullContact.apply(this,arguments),this.constructor===ft&&this.b2NullContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2NullContact=ft;function yt(){yt.b2PolyAndCircleContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndCircleContact=yt;function gt(){gt.b2PolyAndEdgeContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=gt;function Et(){Et.b2PolygonContact.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PolygonContact=Et;function Rt(){Rt.b2PositionSolverManifold.apply(this,arguments),this.constructor===Rt&&this.b2PositionSolverManifold.apply(this,arguments)}Box2D.Dynamics.Contacts.b2PositionSolverManifold=Rt;function Wt(){Wt.b2BuoyancyController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2BuoyancyController=Wt;function Lt(){Lt.b2ConstantAccelController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantAccelController=Lt;function Yt(){Yt.b2ConstantForceController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ConstantForceController=Yt;function Mt(){Mt.b2Controller.apply(this,arguments)}Box2D.Dynamics.Controllers.b2Controller=Mt;function Dt(){Dt.b2ControllerEdge.apply(this,arguments)}Box2D.Dynamics.Controllers.b2ControllerEdge=Dt;function Ft(){Ft.b2GravityController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2GravityController=Ft;function Ht(){Ht.b2TensorDampingController.apply(this,arguments)}Box2D.Dynamics.Controllers.b2TensorDampingController=Ht;function Xt(){Xt.b2DistanceJoint.apply(this,arguments),this.constructor===Xt&&this.b2DistanceJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJoint=Xt;function jt(){jt.b2DistanceJointDef.apply(this,arguments),this.constructor===jt&&this.b2DistanceJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2DistanceJointDef=jt;function te(){te.b2FrictionJoint.apply(this,arguments),this.constructor===te&&this.b2FrictionJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJoint=te;function Jt(){Jt.b2FrictionJointDef.apply(this,arguments),this.constructor===Jt&&this.b2FrictionJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2FrictionJointDef=Jt;function qt(){qt.b2GearJoint.apply(this,arguments),this.constructor===qt&&this.b2GearJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJoint=qt;function ee(){ee.b2GearJointDef.apply(this,arguments),this.constructor===ee&&this.b2GearJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2GearJointDef=ee;function Bt(){Bt.b2Jacobian.apply(this,arguments)}Box2D.Dynamics.Joints.b2Jacobian=Bt;function kt(){kt.b2Joint.apply(this,arguments),this.constructor===kt&&this.b2Joint.apply(this,arguments)}Box2D.Dynamics.Joints.b2Joint=kt;function Kt(){Kt.b2JointDef.apply(this,arguments),this.constructor===Kt&&this.b2JointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointDef=Kt;function ce(){ce.b2JointEdge.apply(this,arguments)}Box2D.Dynamics.Joints.b2JointEdge=ce;function ue(){ue.b2LineJoint.apply(this,arguments),this.constructor===ue&&this.b2LineJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJoint=ue;function le(){le.b2LineJointDef.apply(this,arguments),this.constructor===le&&this.b2LineJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2LineJointDef=le;function Te(){Te.b2MouseJoint.apply(this,arguments),this.constructor===Te&&this.b2MouseJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJoint=Te;function Ce(){Ce.b2MouseJointDef.apply(this,arguments),this.constructor===Ce&&this.b2MouseJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2MouseJointDef=Ce;function Ot(){Ot.b2PrismaticJoint.apply(this,arguments),this.constructor===Ot&&this.b2PrismaticJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJoint=Ot;function ae(){ae.b2PrismaticJointDef.apply(this,arguments),this.constructor===ae&&this.b2PrismaticJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PrismaticJointDef=ae;function de(){de.b2PulleyJoint.apply(this,arguments),this.constructor===de&&this.b2PulleyJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJoint=de;function _e(){_e.b2PulleyJointDef.apply(this,arguments),this.constructor===_e&&this.b2PulleyJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2PulleyJointDef=_e;function Zt(){Zt.b2RevoluteJoint.apply(this,arguments),this.constructor===Zt&&this.b2RevoluteJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJoint=Zt;function me(){me.b2RevoluteJointDef.apply(this,arguments),this.constructor===me&&this.b2RevoluteJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2RevoluteJointDef=me;function re(){re.b2WeldJoint.apply(this,arguments),this.constructor===re&&this.b2WeldJoint.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJoint=re;function Le(){Le.b2WeldJointDef.apply(this,arguments),this.constructor===Le&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Dynamics.Joints.b2WeldJointDef=Le})();Box2D.postDefs=[];(function(){var t=Box2D.Collision.Shapes.b2CircleShape;Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData;var e=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2Shape;Box2D.Common.b2Color,Box2D.Common.b2internal;var n=Box2D.Common.b2Settings;Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33;var s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,c=Box2D.Common.Math.b2Vec2;Box2D.Common.Math.b2Vec3;var l=Box2D.Collision.b2AABB,h=Box2D.Collision.b2Bound,u=Box2D.Collision.b2BoundValues,_=Box2D.Collision.b2Collision,d=Box2D.Collision.b2ContactID,f=Box2D.Collision.b2ContactPoint,T=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,m=Box2D.Collision.b2DistanceOutput,v=Box2D.Collision.b2DistanceProxy,A=Box2D.Collision.b2DynamicTree,D=Box2D.Collision.b2DynamicTreeBroadPhase,N=Box2D.Collision.b2DynamicTreeNode,z=Box2D.Collision.b2DynamicTreePair,M=Box2D.Collision.b2Manifold,J=Box2D.Collision.b2ManifoldPoint,U=Box2D.Collision.b2Point,K=Box2D.Collision.b2RayCastInput,tt=Box2D.Collision.b2RayCastOutput,rt=Box2D.Collision.b2Segment,I=Box2D.Collision.b2SeparationFunction,L=Box2D.Collision.b2Simplex,G=Box2D.Collision.b2SimplexCache,w=Box2D.Collision.b2SimplexVertex,O=Box2D.Collision.b2TimeOfImpact,j=Box2D.Collision.b2TOIInput,Q=Box2D.Collision.b2WorldManifold,C=Box2D.Collision.ClipVertex,b=Box2D.Collision.Features,W=Box2D.Collision.IBroadPhase;l.b2AABB=function(){this.lowerBound=new c,this.upperBound=new c},l.prototype.IsValid=function(){var S=this.upperBound.x-this.lowerBound.x,E=this.upperBound.y-this.lowerBound.y,R=S>=0&&E>=0;return R=R&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),R},l.prototype.GetCenter=function(){return new c((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},l.prototype.GetExtents=function(){return new c((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},l.prototype.Contains=function(S){var E=!0;return E=E&&this.lowerBound.x<=S.lowerBound.x,E=E&&this.lowerBound.y<=S.lowerBound.y,E=E&&S.upperBound.x<=this.upperBound.x,E=E&&S.upperBound.y<=this.upperBound.y,E},l.prototype.RayCast=function(S,E){var R=-Number.MAX_VALUE,F=Number.MAX_VALUE,k=E.p1.x,X=E.p1.y,Z=E.p2.x-E.p1.x,V=E.p2.y-E.p1.y,Y=Math.abs(Z),$=Math.abs(V),et=S.normal,ct=0,ht=0,pt=0,mt=0,dt=0;if(Y<Number.MIN_VALUE){if(k<this.lowerBound.x||this.upperBound.x<k)return!1}else if(ct=1/Z,ht=(this.lowerBound.x-k)*ct,pt=(this.upperBound.x-k)*ct,dt=-1,ht>pt&&(mt=ht,ht=pt,pt=mt,dt=1),ht>R&&(et.x=dt,et.y=0,R=ht),F=Math.min(F,pt),R>F)return!1;if($<Number.MIN_VALUE){if(X<this.lowerBound.y||this.upperBound.y<X)return!1}else if(ct=1/V,ht=(this.lowerBound.y-X)*ct,pt=(this.upperBound.y-X)*ct,dt=-1,ht>pt&&(mt=ht,ht=pt,pt=mt,dt=1),ht>R&&(et.y=dt,et.x=0,R=ht),F=Math.min(F,pt),R>F)return!1;return S.fraction=R,!0},l.prototype.TestOverlap=function(S){var E=S.lowerBound.x-this.upperBound.x,R=S.lowerBound.y-this.upperBound.y,F=this.lowerBound.x-S.upperBound.x,k=this.lowerBound.y-S.upperBound.y;return!(E>0||R>0||F>0||k>0)},l.Combine=function(S,E){var R=new l;return R.Combine(S,E),R},l.prototype.Combine=function(S,E){this.lowerBound.x=Math.min(S.lowerBound.x,E.lowerBound.x),this.lowerBound.y=Math.min(S.lowerBound.y,E.lowerBound.y),this.upperBound.x=Math.max(S.upperBound.x,E.upperBound.x),this.upperBound.y=Math.max(S.upperBound.y,E.upperBound.y)},h.b2Bound=function(){},h.prototype.IsLower=function(){return(this.value&1)==0},h.prototype.IsUpper=function(){return(this.value&1)==1},h.prototype.Swap=function(S){var E=this.value,R=this.proxy,F=this.stabbingCount;this.value=S.value,this.proxy=S.proxy,this.stabbingCount=S.stabbingCount,S.value=E,S.proxy=R,S.stabbingCount=F},u.b2BoundValues=function(){},u.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},_.b2Collision=function(){},_.ClipSegmentToLine=function(S,E,R,F){F===void 0&&(F=0);var k,X=0;k=E[0];var Z=k.v;k=E[1];var V=k.v,Y=R.x*Z.x+R.y*Z.y-F,$=R.x*V.x+R.y*V.y-F;if(Y<=0&&S[X++].Set(E[0]),$<=0&&S[X++].Set(E[1]),Y*$<0){var et=Y/(Y-$);k=S[X];var ct=k.v;ct.x=Z.x+et*(V.x-Z.x),ct.y=Z.y+et*(V.y-Z.y),k=S[X];var ht;Y>0?(ht=E[0],k.id=ht.id):(ht=E[1],k.id=ht.id),++X}return X},_.EdgeSeparation=function(S,E,R,F,k){R===void 0&&(R=0),parseInt(S.m_vertexCount);var X=S.m_vertices,Z=S.m_normals,V=parseInt(F.m_vertexCount),Y=F.m_vertices,$,et;$=E.R,et=Z[R];var ct=$.col1.x*et.x+$.col2.x*et.y,ht=$.col1.y*et.x+$.col2.y*et.y;$=k.R;for(var pt=$.col1.x*ct+$.col1.y*ht,mt=$.col2.x*ct+$.col2.y*ht,dt=0,xt=Number.MAX_VALUE,Tt=0;Tt<V;++Tt){et=Y[Tt];var lt=et.x*pt+et.y*mt;lt<xt&&(xt=lt,dt=Tt)}et=X[R],$=E.R;var at=E.position.x+($.col1.x*et.x+$.col2.x*et.y),At=E.position.y+($.col1.y*et.x+$.col2.y*et.y);et=Y[dt],$=k.R;var St=k.position.x+($.col1.x*et.x+$.col2.x*et.y),wt=k.position.y+($.col1.y*et.x+$.col2.y*et.y);St-=at,wt-=At;var Pt=St*ct+wt*ht;return Pt},_.FindMaxSeparation=function(S,E,R,F,k){var X=parseInt(E.m_vertexCount),Z=E.m_normals,V,Y;Y=k.R,V=F.m_centroid;var $=k.position.x+(Y.col1.x*V.x+Y.col2.x*V.y),et=k.position.y+(Y.col1.y*V.x+Y.col2.y*V.y);Y=R.R,V=E.m_centroid,$-=R.position.x+(Y.col1.x*V.x+Y.col2.x*V.y),et-=R.position.y+(Y.col1.y*V.x+Y.col2.y*V.y);for(var ct=$*R.R.col1.x+et*R.R.col1.y,ht=$*R.R.col2.x+et*R.R.col2.y,pt=0,mt=-Number.MAX_VALUE,dt=0;dt<X;++dt){V=Z[dt];var xt=V.x*ct+V.y*ht;xt>mt&&(mt=xt,pt=dt)}var Tt=_.EdgeSeparation(E,R,pt,F,k),lt=parseInt(pt-1>=0?pt-1:X-1),at=_.EdgeSeparation(E,R,lt,F,k),At=parseInt(pt+1<X?pt+1:0),St=_.EdgeSeparation(E,R,At,F,k),wt=0,Pt=0,It=0;if(at>Tt&&at>St)It=-1,wt=lt,Pt=at;else if(St>Tt)It=1,wt=At,Pt=St;else return S[0]=pt,Tt;for(;It==-1?pt=wt-1>=0?wt-1:X-1:pt=wt+1<X?wt+1:0,Tt=_.EdgeSeparation(E,R,pt,F,k),Tt>Pt;)wt=pt,Pt=Tt;return S[0]=wt,Pt},_.FindIncidentEdge=function(S,E,R,F,k,X){F===void 0&&(F=0),parseInt(E.m_vertexCount);var Z=E.m_normals,V=parseInt(k.m_vertexCount),Y=k.m_vertices,$=k.m_normals,et,ct;et=R.R,ct=Z[F];var ht=et.col1.x*ct.x+et.col2.x*ct.y,pt=et.col1.y*ct.x+et.col2.y*ct.y;et=X.R;var mt=et.col1.x*ht+et.col1.y*pt;pt=et.col2.x*ht+et.col2.y*pt,ht=mt;for(var dt=0,xt=Number.MAX_VALUE,Tt=0;Tt<V;++Tt){ct=$[Tt];var lt=ht*ct.x+pt*ct.y;lt<xt&&(xt=lt,dt=Tt)}var at,At=parseInt(dt),St=parseInt(At+1<V?At+1:0);at=S[0],ct=Y[At],et=X.R,at.v.x=X.position.x+(et.col1.x*ct.x+et.col2.x*ct.y),at.v.y=X.position.y+(et.col1.y*ct.x+et.col2.y*ct.y),at.id.features.referenceEdge=F,at.id.features.incidentEdge=At,at.id.features.incidentVertex=0,at=S[1],ct=Y[St],et=X.R,at.v.x=X.position.x+(et.col1.x*ct.x+et.col2.x*ct.y),at.v.y=X.position.y+(et.col1.y*ct.x+et.col2.y*ct.y),at.id.features.referenceEdge=F,at.id.features.incidentEdge=St,at.id.features.incidentVertex=1},_.MakeClipPointVector=function(){var S=new Vector(2);return S[0]=new C,S[1]=new C,S},_.CollidePolygons=function(S,E,R,F,k){var X;S.m_pointCount=0;var Z=E.m_radius+F.m_radius,V=0;_.s_edgeAO[0]=V;var Y=_.FindMaxSeparation(_.s_edgeAO,E,R,F,k);if(V=_.s_edgeAO[0],!(Y>Z)){var $=0;_.s_edgeBO[0]=$;var et=_.FindMaxSeparation(_.s_edgeBO,F,k,E,R);if($=_.s_edgeBO[0],!(et>Z)){var ct,ht,pt,mt,dt=0,xt=0,Tt=.98,lt=.001,at;et>Tt*Y+lt?(ct=F,ht=E,pt=k,mt=R,dt=$,S.m_type=M.e_faceB,xt=1):(ct=E,ht=F,pt=R,mt=k,dt=V,S.m_type=M.e_faceA,xt=0);var At=_.s_incidentEdge;_.FindIncidentEdge(At,ct,pt,dt,ht,mt);var St=parseInt(ct.m_vertexCount),wt=ct.m_vertices,Pt=wt[dt],It;dt+1<St?It=wt[parseInt(dt+1)]:It=wt[0];var zt=_.s_localTangent;zt.Set(It.x-Pt.x,It.y-Pt.y),zt.Normalize();var Vt=_.s_localNormal;Vt.x=zt.y,Vt.y=-zt.x;var ot=_.s_planePoint;ot.Set(.5*(Pt.x+It.x),.5*(Pt.y+It.y));var st=_.s_tangent;at=pt.R,st.x=at.col1.x*zt.x+at.col2.x*zt.y,st.y=at.col1.y*zt.x+at.col2.y*zt.y;var ut=_.s_tangent2;ut.x=-st.x,ut.y=-st.y;var ft=_.s_normal;ft.x=st.y,ft.y=-st.x;var yt=_.s_v11,gt=_.s_v12;yt.x=pt.position.x+(at.col1.x*Pt.x+at.col2.x*Pt.y),yt.y=pt.position.y+(at.col1.y*Pt.x+at.col2.y*Pt.y),gt.x=pt.position.x+(at.col1.x*It.x+at.col2.x*It.y),gt.y=pt.position.y+(at.col1.y*It.x+at.col2.y*It.y);var Et=ft.x*yt.x+ft.y*yt.y,Rt=-st.x*yt.x-st.y*yt.y+Z,Wt=st.x*gt.x+st.y*gt.y+Z,Lt=_.s_clipPoints1,Yt=_.s_clipPoints2,Mt=0;if(Mt=_.ClipSegmentToLine(Lt,At,ut,Rt),!(Mt<2)&&(Mt=_.ClipSegmentToLine(Yt,Lt,st,Wt),!(Mt<2))){S.m_localPlaneNormal.SetV(Vt),S.m_localPoint.SetV(ot);for(var Dt=0,Ft=0;Ft<n.b2_maxManifoldPoints;++Ft){X=Yt[Ft];var Ht=ft.x*X.v.x+ft.y*X.v.y-Et;if(Ht<=Z){var Xt=S.m_points[Dt];at=mt.R;var jt=X.v.x-mt.position.x,te=X.v.y-mt.position.y;Xt.m_localPoint.x=jt*at.col1.x+te*at.col1.y,Xt.m_localPoint.y=jt*at.col2.x+te*at.col2.y,Xt.m_id.Set(X.id),Xt.m_id.features.flip=xt,++Dt}}S.m_pointCount=Dt}}}},_.CollideCircles=function(S,E,R,F,k){S.m_pointCount=0;var X,Z;X=R.R,Z=E.m_p;var V=R.position.x+(X.col1.x*Z.x+X.col2.x*Z.y),Y=R.position.y+(X.col1.y*Z.x+X.col2.y*Z.y);X=k.R,Z=F.m_p;var $=k.position.x+(X.col1.x*Z.x+X.col2.x*Z.y),et=k.position.y+(X.col1.y*Z.x+X.col2.y*Z.y),ct=$-V,ht=et-Y,pt=ct*ct+ht*ht,mt=E.m_radius+F.m_radius;pt>mt*mt||(S.m_type=M.e_circles,S.m_localPoint.SetV(E.m_p),S.m_localPlaneNormal.SetZero(),S.m_pointCount=1,S.m_points[0].m_localPoint.SetV(F.m_p),S.m_points[0].m_id.key=0)},_.CollidePolygonAndCircle=function(S,E,R,F,k){S.m_pointCount=0;var X=0,Z=0,V,Y;Y=k.R,V=F.m_p;var $=k.position.x+(Y.col1.x*V.x+Y.col2.x*V.y),et=k.position.y+(Y.col1.y*V.x+Y.col2.y*V.y);X=$-R.position.x,Z=et-R.position.y,Y=R.R;for(var ct=X*Y.col1.x+Z*Y.col1.y,ht=X*Y.col2.x+Z*Y.col2.y,pt=0,mt=-Number.MAX_VALUE,dt=E.m_radius+F.m_radius,xt=parseInt(E.m_vertexCount),Tt=E.m_vertices,lt=E.m_normals,at=0;at<xt;++at){V=Tt[at],X=ct-V.x,Z=ht-V.y,V=lt[at];var At=V.x*X+V.y*Z;if(At>dt)return;At>mt&&(mt=At,pt=at)}var St=parseInt(pt),wt=parseInt(St+1<xt?St+1:0),Pt=Tt[St],It=Tt[wt];if(mt<Number.MIN_VALUE){S.m_pointCount=1,S.m_type=M.e_faceA,S.m_localPlaneNormal.SetV(lt[pt]),S.m_localPoint.x=.5*(Pt.x+It.x),S.m_localPoint.y=.5*(Pt.y+It.y),S.m_points[0].m_localPoint.SetV(F.m_p),S.m_points[0].m_id.key=0;return}var zt=(ct-Pt.x)*(It.x-Pt.x)+(ht-Pt.y)*(It.y-Pt.y),Vt=(ct-It.x)*(Pt.x-It.x)+(ht-It.y)*(Pt.y-It.y);if(zt<=0){if((ct-Pt.x)*(ct-Pt.x)+(ht-Pt.y)*(ht-Pt.y)>dt*dt)return;S.m_pointCount=1,S.m_type=M.e_faceA,S.m_localPlaneNormal.x=ct-Pt.x,S.m_localPlaneNormal.y=ht-Pt.y,S.m_localPlaneNormal.Normalize(),S.m_localPoint.SetV(Pt),S.m_points[0].m_localPoint.SetV(F.m_p),S.m_points[0].m_id.key=0}else if(Vt<=0){if((ct-It.x)*(ct-It.x)+(ht-It.y)*(ht-It.y)>dt*dt)return;S.m_pointCount=1,S.m_type=M.e_faceA,S.m_localPlaneNormal.x=ct-It.x,S.m_localPlaneNormal.y=ht-It.y,S.m_localPlaneNormal.Normalize(),S.m_localPoint.SetV(It),S.m_points[0].m_localPoint.SetV(F.m_p),S.m_points[0].m_id.key=0}else{var ot=.5*(Pt.x+It.x),st=.5*(Pt.y+It.y);if(mt=(ct-ot)*lt[St].x+(ht-st)*lt[St].y,mt>dt)return;S.m_pointCount=1,S.m_type=M.e_faceA,S.m_localPlaneNormal.x=lt[St].x,S.m_localPlaneNormal.y=lt[St].y,S.m_localPlaneNormal.Normalize(),S.m_localPoint.Set(ot,st),S.m_points[0].m_localPoint.SetV(F.m_p),S.m_points[0].m_id.key=0}},_.TestOverlap=function(S,E){var R=E.lowerBound,F=S.upperBound,k=R.x-F.x,X=R.y-F.y;R=S.lowerBound,F=E.upperBound;var Z=R.x-F.x,V=R.y-F.y;return!(k>0||X>0||Z>0||V>0)},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=_.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=_.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=_.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new c,Box2D.Collision.b2Collision.s_localNormal=new c,Box2D.Collision.b2Collision.s_planePoint=new c,Box2D.Collision.b2Collision.s_normal=new c,Box2D.Collision.b2Collision.s_tangent=new c,Box2D.Collision.b2Collision.s_tangent2=new c,Box2D.Collision.b2Collision.s_v11=new c,Box2D.Collision.b2Collision.s_v12=new c,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new c,Box2D.Collision.b2Collision.b2_nullFeature=255}),d.b2ContactID=function(){this.features=new b},d.prototype.b2ContactID=function(){this.features._m_id=this||window},d.prototype.Set=function(S){this.key=S._key},d.prototype.Copy=function(){var S=new d;return S.key=this.key,S},Object.defineProperty(d.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(d.prototype,"key",{enumerable:!1,configurable:!0,set:function(S){S===void 0&&(S=0),this._key=S,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),f.b2ContactPoint=function(){this.position=new c,this.velocity=new c,this.normal=new c,this.id=new d},T.b2Distance=function(){},T.Distance=function(S,E,R){++T.b2_gjkCalls;var F=R.proxyA,k=R.proxyB,X=R.transformA,Z=R.transformB,V=T.s_simplex;V.ReadCache(E,F,X,k,Z);var Y=V.m_vertices,$=20,et=T.s_saveA,ct=T.s_saveB,ht=0,pt=V.GetClosestPoint();pt.LengthSquared();for(var mt=0,dt,xt=0;xt<$;){for(ht=V.m_count,mt=0;mt<ht;mt++)et[mt]=Y[mt].indexA,ct[mt]=Y[mt].indexB;switch(V.m_count){case 1:break;case 2:V.Solve2();break;case 3:V.Solve3();break;default:n.b2Assert(!1)}if(V.m_count==3)break;dt=V.GetClosestPoint(),dt.LengthSquared();var Tt=V.GetSearchDirection();if(Tt.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var lt=Y[V.m_count];lt.indexA=F.GetSupport(s.MulTMV(X.R,Tt.GetNegative())),lt.wA=s.MulX(X,F.GetVertex(lt.indexA)),lt.indexB=k.GetSupport(s.MulTMV(Z.R,Tt)),lt.wB=s.MulX(Z,k.GetVertex(lt.indexB)),lt.w=s.SubtractVV(lt.wB,lt.wA),++xt,++T.b2_gjkIters;var at=!1;for(mt=0;mt<ht;mt++)if(lt.indexA==et[mt]&&lt.indexB==ct[mt]){at=!0;break}if(at)break;++V.m_count}if(T.b2_gjkMaxIters=s.Max(T.b2_gjkMaxIters,xt),V.GetWitnessPoints(S.pointA,S.pointB),S.distance=s.SubtractVV(S.pointA,S.pointB).Length(),S.iterations=xt,V.WriteCache(E),R.useRadii){var At=F.m_radius,St=k.m_radius;if(S.distance>At+St&&S.distance>Number.MIN_VALUE){S.distance-=At+St;var wt=s.SubtractVV(S.pointB,S.pointA);wt.Normalize(),S.pointA.x+=At*wt.x,S.pointA.y+=At*wt.y,S.pointB.x-=St*wt.x,S.pointB.y-=St*wt.y}else dt=new c,dt.x=.5*(S.pointA.x+S.pointB.x),dt.y=.5*(S.pointA.y+S.pointB.y),S.pointA.x=S.pointB.x=dt.x,S.pointA.y=S.pointB.y=dt.y,S.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new L,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),x.b2DistanceInput=function(){},m.b2DistanceOutput=function(){this.pointA=new c,this.pointB=new c},v.b2DistanceProxy=function(){},v.prototype.Set=function(S){switch(S.GetType()){case r.e_circleShape:{var E=S instanceof t?S:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=E.m_p,this.m_count=1,this.m_radius=E.m_radius}break;case r.e_polygonShape:{var R=S instanceof e?S:null;this.m_vertices=R.m_vertices,this.m_count=R.m_vertexCount,this.m_radius=R.m_radius}break;default:n.b2Assert(!1)}},v.prototype.GetSupport=function(S){for(var E=0,R=this.m_vertices[0].x*S.x+this.m_vertices[0].y*S.y,F=1;F<this.m_count;++F){var k=this.m_vertices[F].x*S.x+this.m_vertices[F].y*S.y;k>R&&(E=F,R=k)}return E},v.prototype.GetSupportVertex=function(S){for(var E=0,R=this.m_vertices[0].x*S.x+this.m_vertices[0].y*S.y,F=1;F<this.m_count;++F){var k=this.m_vertices[F].x*S.x+this.m_vertices[F].y*S.y;k>R&&(E=F,R=k)}return this.m_vertices[E]},v.prototype.GetVertexCount=function(){return this.m_count},v.prototype.GetVertex=function(S){return S===void 0&&(S=0),n.b2Assert(0<=S&&S<this.m_count),this.m_vertices[S]},A.b2DynamicTree=function(){},A.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},A.prototype.CreateProxy=function(S,E){var R=this.AllocateNode(),F=n.b2_aabbExtension,k=n.b2_aabbExtension;return R.aabb.lowerBound.x=S.lowerBound.x-F,R.aabb.lowerBound.y=S.lowerBound.y-k,R.aabb.upperBound.x=S.upperBound.x+F,R.aabb.upperBound.y=S.upperBound.y+k,R.userData=E,this.InsertLeaf(R),R},A.prototype.DestroyProxy=function(S){this.RemoveLeaf(S),this.FreeNode(S)},A.prototype.MoveProxy=function(S,E,R){if(n.b2Assert(S.IsLeaf()),S.aabb.Contains(E))return!1;this.RemoveLeaf(S);var F=n.b2_aabbExtension+n.b2_aabbMultiplier*(R.x>0?R.x:-R.x),k=n.b2_aabbExtension+n.b2_aabbMultiplier*(R.y>0?R.y:-R.y);return S.aabb.lowerBound.x=E.lowerBound.x-F,S.aabb.lowerBound.y=E.lowerBound.y-k,S.aabb.upperBound.x=E.upperBound.x+F,S.aabb.upperBound.y=E.upperBound.y+k,this.InsertLeaf(S),!0},A.prototype.Rebalance=function(S){if(S===void 0&&(S=0),this.m_root!=null)for(var E=0;E<S;E++){for(var R=this.m_root,F=0;R.IsLeaf()==!1;)R=this.m_path>>F&1?R.child2:R.child1,F=F+1&31;++this.m_path,this.RemoveLeaf(R),this.InsertLeaf(R)}},A.prototype.GetFatAABB=function(S){return S.aabb},A.prototype.GetUserData=function(S){return S.userData},A.prototype.Query=function(S,E){if(this.m_root!=null){var R=new Vector,F=0;for(R[F++]=this.m_root;F>0;){var k=R[--F];if(k.aabb.TestOverlap(E))if(k.IsLeaf()){var X=S(k);if(!X)return}else R[F++]=k.child1,R[F++]=k.child2}}},A.prototype.RayCast=function(S,E){if(this.m_root!=null){var R=E.p1,F=E.p2,k=s.SubtractVV(R,F);k.Normalize();var X=s.CrossFV(1,k),Z=s.AbsV(X),V=E.maxFraction,Y=new l,$=0,et=0;$=R.x+V*(F.x-R.x),et=R.y+V*(F.y-R.y),Y.lowerBound.x=Math.min(R.x,$),Y.lowerBound.y=Math.min(R.y,et),Y.upperBound.x=Math.max(R.x,$),Y.upperBound.y=Math.max(R.y,et);var ct=new Vector,ht=0;for(ct[ht++]=this.m_root;ht>0;){var pt=ct[--ht];if(pt.aabb.TestOverlap(Y)!=!1){var mt=pt.aabb.GetCenter(),dt=pt.aabb.GetExtents(),xt=Math.abs(X.x*(R.x-mt.x)+X.y*(R.y-mt.y))-Z.x*dt.x-Z.y*dt.y;if(!(xt>0))if(pt.IsLeaf()){var Tt=new K;if(Tt.p1=E.p1,Tt.p2=E.p2,Tt.maxFraction=E.maxFraction,V=S(Tt,pt),V==0)return;V>0&&($=R.x+V*(F.x-R.x),et=R.y+V*(F.y-R.y),Y.lowerBound.x=Math.min(R.x,$),Y.lowerBound.y=Math.min(R.y,et),Y.upperBound.x=Math.max(R.x,$),Y.upperBound.y=Math.max(R.y,et))}else ct[ht++]=pt.child1,ct[ht++]=pt.child2}}}},A.prototype.AllocateNode=function(){if(this.m_freeList){var S=this.m_freeList;return this.m_freeList=S.parent,S.parent=null,S.child1=null,S.child2=null,S}return new N},A.prototype.FreeNode=function(S){S.parent=this.m_freeList,this.m_freeList=S},A.prototype.InsertLeaf=function(S){if(++this.m_insertionCount,this.m_root==null){this.m_root=S,this.m_root.parent=null;return}var E=S.aabb.GetCenter(),R=this.m_root;if(R.IsLeaf()==!1)do{var F=R.child1,k=R.child2,X=Math.abs((F.aabb.lowerBound.x+F.aabb.upperBound.x)/2-E.x)+Math.abs((F.aabb.lowerBound.y+F.aabb.upperBound.y)/2-E.y),Z=Math.abs((k.aabb.lowerBound.x+k.aabb.upperBound.x)/2-E.x)+Math.abs((k.aabb.lowerBound.y+k.aabb.upperBound.y)/2-E.y);X<Z?R=F:R=k}while(R.IsLeaf()==!1);var V=R.parent,Y=this.AllocateNode();if(Y.parent=V,Y.userData=null,Y.aabb.Combine(S.aabb,R.aabb),V){R.parent.child1==R?V.child1=Y:V.child2=Y,Y.child1=R,Y.child2=S,R.parent=Y,S.parent=Y;do{if(V.aabb.Contains(Y.aabb))break;V.aabb.Combine(V.child1.aabb,V.child2.aabb),Y=V,V=V.parent}while(V)}else Y.child1=R,Y.child2=S,R.parent=Y,S.parent=Y,this.m_root=Y},A.prototype.RemoveLeaf=function(S){if(S==this.m_root){this.m_root=null;return}var E=S.parent,R=E.parent,F;if(E.child1==S?F=E.child2:F=E.child1,R)for(R.child1==E?R.child1=F:R.child2=F,F.parent=R,this.FreeNode(E);R;){var k=R.aabb;if(R.aabb=l.Combine(R.child1.aabb,R.child2.aabb),k.Contains(R.aabb))break;R=R.parent}else this.m_root=F,F.parent=null,this.FreeNode(E)},D.b2DynamicTreeBroadPhase=function(){this.m_tree=new A,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},D.prototype.CreateProxy=function(S,E){var R=this.m_tree.CreateProxy(S,E);return++this.m_proxyCount,this.BufferMove(R),R},D.prototype.DestroyProxy=function(S){this.UnBufferMove(S),--this.m_proxyCount,this.m_tree.DestroyProxy(S)},D.prototype.MoveProxy=function(S,E,R){var F=this.m_tree.MoveProxy(S,E,R);F&&this.BufferMove(S)},D.prototype.TestOverlap=function(S,E){var R=this.m_tree.GetFatAABB(S),F=this.m_tree.GetFatAABB(E);return R.TestOverlap(F)},D.prototype.GetUserData=function(S){return this.m_tree.GetUserData(S)},D.prototype.GetFatAABB=function(S){return this.m_tree.GetFatAABB(S)},D.prototype.GetProxyCount=function(){return this.m_proxyCount},D.prototype.UpdatePairs=function(S){var E=this||window;E.m_pairCount=0;var R=0,F;for(R=0;R<E.m_moveBuffer.length;++R){let et=function(ct){if(ct==F)return!0;E.m_pairCount==E.m_pairBuffer.length&&(E.m_pairBuffer[E.m_pairCount]=new z);var ht=E.m_pairBuffer[E.m_pairCount];return ht.proxyA=ct<F?ct:F,ht.proxyB=ct>=F?ct:F,++E.m_pairCount,!0};var $=et;F=E.m_moveBuffer[R];var k=E.m_tree.GetFatAABB(F);E.m_tree.Query(et,k)}E.m_moveBuffer.length=0;for(var R=0;R<E.m_pairCount;){var X=E.m_pairBuffer[R],Z=E.m_tree.GetUserData(X.proxyA),V=E.m_tree.GetUserData(X.proxyB);for(S(Z,V),++R;R<E.m_pairCount;){var Y=E.m_pairBuffer[R];if(Y.proxyA!=X.proxyA||Y.proxyB!=X.proxyB)break;++R}}},D.prototype.Query=function(S,E){this.m_tree.Query(S,E)},D.prototype.RayCast=function(S,E){this.m_tree.RayCast(S,E)},D.prototype.Validate=function(){},D.prototype.Rebalance=function(S){S===void 0&&(S=0),this.m_tree.Rebalance(S)},D.prototype.BufferMove=function(S){this.m_moveBuffer[this.m_moveBuffer.length]=S},D.prototype.UnBufferMove=function(S){var E=parseInt(this.m_moveBuffer.indexOf(S));this.m_moveBuffer.splice(E,1)},D.prototype.ComparePairs=function(S,E){return 0},D.__implements={},D.__implements[W]=!0,N.b2DynamicTreeNode=function(){this.aabb=new l},N.prototype.IsLeaf=function(){return this.child1==null},z.b2DynamicTreePair=function(){},M.b2Manifold=function(){this.m_pointCount=0},M.prototype.b2Manifold=function(){this.m_points=new Vector(n.b2_maxManifoldPoints);for(var S=0;S<n.b2_maxManifoldPoints;S++)this.m_points[S]=new J;this.m_localPlaneNormal=new c,this.m_localPoint=new c},M.prototype.Reset=function(){for(var S=0;S<n.b2_maxManifoldPoints;S++)(this.m_points[S]instanceof J?this.m_points[S]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},M.prototype.Set=function(S){this.m_pointCount=S.m_pointCount;for(var E=0;E<n.b2_maxManifoldPoints;E++)(this.m_points[E]instanceof J?this.m_points[E]:null).Set(S.m_points[E]);this.m_localPlaneNormal.SetV(S.m_localPlaneNormal),this.m_localPoint.SetV(S.m_localPoint),this.m_type=S.m_type},M.prototype.Copy=function(){var S=new M;return S.Set(this),S},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),J.b2ManifoldPoint=function(){this.m_localPoint=new c,this.m_id=new d},J.prototype.b2ManifoldPoint=function(){this.Reset()},J.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},J.prototype.Set=function(S){this.m_localPoint.SetV(S.m_localPoint),this.m_normalImpulse=S.m_normalImpulse,this.m_tangentImpulse=S.m_tangentImpulse,this.m_id.Set(S.m_id)},U.b2Point=function(){this.p=new c},U.prototype.Support=function(S,E,R){return this.p},U.prototype.GetFirstVertex=function(S){return this.p},K.b2RayCastInput=function(){this.p1=new c,this.p2=new c},K.prototype.b2RayCastInput=function(S,E,R){S===void 0&&(S=null),E===void 0&&(E=null),R===void 0&&(R=1),S&&this.p1.SetV(S),E&&this.p2.SetV(E),this.maxFraction=R},tt.b2RayCastOutput=function(){this.normal=new c},rt.b2Segment=function(){this.p1=new c,this.p2=new c},rt.prototype.TestSegment=function(S,E,R,F){F===void 0&&(F=0);var k=R.p1,X=R.p2.x-k.x,Z=R.p2.y-k.y,V=this.p2.x-this.p1.x,Y=this.p2.y-this.p1.y,$=Y,et=-V,ct=100*Number.MIN_VALUE,ht=-(X*$+Z*et);if(ht>ct){var pt=k.x-this.p1.x,mt=k.y-this.p1.y,dt=pt*$+mt*et;if(0<=dt&&dt<=F*ht){var xt=-X*mt+Z*pt;if(-ct*ht<=xt&&xt<=ht*(1+ct)){dt/=ht;var Tt=Math.sqrt($*$+et*et);return $/=Tt,et/=Tt,S[0]=dt,E.Set($,et),!0}}}return!1},rt.prototype.Extend=function(S){this.ExtendForward(S),this.ExtendBackward(S)},rt.prototype.ExtendForward=function(S){var E=this.p2.x-this.p1.x,R=this.p2.y-this.p1.y,F=Math.min(E>0?(S.upperBound.x-this.p1.x)/E:E<0?(S.lowerBound.x-this.p1.x)/E:Number.POSITIVE_INFINITY,R>0?(S.upperBound.y-this.p1.y)/R:R<0?(S.lowerBound.y-this.p1.y)/R:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+E*F,this.p2.y=this.p1.y+R*F},rt.prototype.ExtendBackward=function(S){var E=-this.p2.x+this.p1.x,R=-this.p2.y+this.p1.y,F=Math.min(E>0?(S.upperBound.x-this.p2.x)/E:E<0?(S.lowerBound.x-this.p2.x)/E:Number.POSITIVE_INFINITY,R>0?(S.upperBound.y-this.p2.y)/R:R<0?(S.lowerBound.y-this.p2.y)/R:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+E*F,this.p1.y=this.p2.y+R*F},I.b2SeparationFunction=function(){this.m_localPoint=new c,this.m_axis=new c},I.prototype.Initialize=function(S,E,R,F,k){this.m_proxyA=E,this.m_proxyB=F;var X=parseInt(S.count);n.b2Assert(0<X&&X<3);var Z,V,Y,$,et,ct,ht=0,pt=0,mt=0,dt=0,xt=0,Tt=0,lt,at,At=0;if(X==1)this.m_type=I.e_points,Z=this.m_proxyA.GetVertex(S.indexA[0]),$=this.m_proxyB.GetVertex(S.indexB[0]),at=Z,lt=R.R,ht=R.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),pt=R.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),at=$,lt=k.R,mt=k.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),dt=k.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),this.m_axis.x=mt-ht,this.m_axis.y=dt-pt,this.m_axis.Normalize();else if(S.indexB[0]==S.indexB[1])this.m_type=I.e_faceA,V=this.m_proxyA.GetVertex(S.indexA[0]),Y=this.m_proxyA.GetVertex(S.indexA[1]),$=this.m_proxyB.GetVertex(S.indexB[0]),this.m_localPoint.x=.5*(V.x+Y.x),this.m_localPoint.y=.5*(V.y+Y.y),this.m_axis=s.CrossVF(s.SubtractVV(Y,V),1),this.m_axis.Normalize(),at=this.m_axis,lt=R.R,xt=lt.col1.x*at.x+lt.col2.x*at.y,Tt=lt.col1.y*at.x+lt.col2.y*at.y,at=this.m_localPoint,lt=R.R,ht=R.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),pt=R.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),at=$,lt=k.R,mt=k.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),dt=k.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),At=(mt-ht)*xt+(dt-pt)*Tt,At<0&&this.m_axis.NegativeSelf();else if(S.indexA[0]==S.indexA[0])this.m_type=I.e_faceB,et=this.m_proxyB.GetVertex(S.indexB[0]),ct=this.m_proxyB.GetVertex(S.indexB[1]),Z=this.m_proxyA.GetVertex(S.indexA[0]),this.m_localPoint.x=.5*(et.x+ct.x),this.m_localPoint.y=.5*(et.y+ct.y),this.m_axis=s.CrossVF(s.SubtractVV(ct,et),1),this.m_axis.Normalize(),at=this.m_axis,lt=k.R,xt=lt.col1.x*at.x+lt.col2.x*at.y,Tt=lt.col1.y*at.x+lt.col2.y*at.y,at=this.m_localPoint,lt=k.R,mt=k.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),dt=k.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),at=Z,lt=R.R,ht=R.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),pt=R.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),At=(ht-mt)*xt+(pt-dt)*Tt,At<0&&this.m_axis.NegativeSelf();else{V=this.m_proxyA.GetVertex(S.indexA[0]),Y=this.m_proxyA.GetVertex(S.indexA[1]),et=this.m_proxyB.GetVertex(S.indexB[0]),ct=this.m_proxyB.GetVertex(S.indexB[1]),s.MulX(R,Z);var St=s.MulMV(R.R,s.SubtractVV(Y,V));s.MulX(k,$);var wt=s.MulMV(k.R,s.SubtractVV(ct,et)),Pt=St.x*St.x+St.y*St.y,It=wt.x*wt.x+wt.y*wt.y,zt=s.SubtractVV(wt,St),Vt=St.x*zt.x+St.y*zt.y,ot=wt.x*zt.x+wt.y*zt.y,st=St.x*wt.x+St.y*wt.y,ut=Pt*It-st*st;At=0,ut!=0&&(At=s.Clamp((st*ot-Vt*It)/ut,0,1));var ft=(st*At+ot)/It;ft<0&&(ft=0,At=s.Clamp((st-Vt)/Pt,0,1)),Z=new c,Z.x=V.x+At*(Y.x-V.x),Z.y=V.y+At*(Y.y-V.y),$=new c,$.x=et.x+At*(ct.x-et.x),$.y=et.y+At*(ct.y-et.y),At==0||At==1?(this.m_type=I.e_faceB,this.m_axis=s.CrossVF(s.SubtractVV(ct,et),1),this.m_axis.Normalize(),this.m_localPoint=$,at=this.m_axis,lt=k.R,xt=lt.col1.x*at.x+lt.col2.x*at.y,Tt=lt.col1.y*at.x+lt.col2.y*at.y,at=this.m_localPoint,lt=k.R,mt=k.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),dt=k.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),at=Z,lt=R.R,ht=R.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),pt=R.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),At<0&&this.m_axis.NegativeSelf()):(this.m_type=I.e_faceA,this.m_axis=s.CrossVF(s.SubtractVV(Y,V),1),this.m_localPoint=Z,at=this.m_axis,lt=R.R,xt=lt.col1.x*at.x+lt.col2.x*at.y,Tt=lt.col1.y*at.x+lt.col2.y*at.y,at=this.m_localPoint,lt=R.R,ht=R.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),pt=R.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),at=$,lt=k.R,mt=k.position.x+(lt.col1.x*at.x+lt.col2.x*at.y),dt=k.position.y+(lt.col1.y*at.x+lt.col2.y*at.y),At<0&&this.m_axis.NegativeSelf())}},I.prototype.Evaluate=function(S,E){var R,F,k,X,Z,V,Y=0,$;switch(this.m_type){case I.e_points:return R=s.MulTMV(S.R,this.m_axis),F=s.MulTMV(E.R,this.m_axis.GetNegative()),k=this.m_proxyA.GetSupportVertex(R),X=this.m_proxyB.GetSupportVertex(F),Z=s.MulX(S,k),V=s.MulX(E,X),Y=(V.x-Z.x)*this.m_axis.x+(V.y-Z.y)*this.m_axis.y,Y;case I.e_faceA:return $=s.MulMV(S.R,this.m_axis),Z=s.MulX(S,this.m_localPoint),F=s.MulTMV(E.R,$.GetNegative()),X=this.m_proxyB.GetSupportVertex(F),V=s.MulX(E,X),Y=(V.x-Z.x)*$.x+(V.y-Z.y)*$.y,Y;case I.e_faceB:return $=s.MulMV(E.R,this.m_axis),V=s.MulX(E,this.m_localPoint),R=s.MulTMV(S.R,$.GetNegative()),k=this.m_proxyA.GetSupportVertex(R),Z=s.MulX(S,k),Y=(Z.x-V.x)*$.x+(Z.y-V.y)*$.y,Y;default:return n.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),L.b2Simplex=function(){this.m_v1=new w,this.m_v2=new w,this.m_v3=new w,this.m_vertices=new Vector(3)},L.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},L.prototype.ReadCache=function(S,E,R,F,k){n.b2Assert(0<=S.count&&S.count<=3);var X,Z;this.m_count=S.count;for(var V=this.m_vertices,Y=0;Y<this.m_count;Y++){var $=V[Y];$.indexA=S.indexA[Y],$.indexB=S.indexB[Y],X=E.GetVertex($.indexA),Z=F.GetVertex($.indexB),$.wA=s.MulX(R,X),$.wB=s.MulX(k,Z),$.w=s.SubtractVV($.wB,$.wA),$.a=0}if(this.m_count>1){var et=S.metric,ct=this.GetMetric();(ct<.5*et||2*et<ct||ct<Number.MIN_VALUE)&&(this.m_count=0)}this.m_count==0&&($=V[0],$.indexA=0,$.indexB=0,X=E.GetVertex(0),Z=F.GetVertex(0),$.wA=s.MulX(R,X),$.wB=s.MulX(k,Z),$.w=s.SubtractVV($.wB,$.wA),this.m_count=1)},L.prototype.WriteCache=function(S){S.metric=this.GetMetric(),S.count=Box2D.parseUInt(this.m_count);for(var E=this.m_vertices,R=0;R<this.m_count;R++)S.indexA[R]=Box2D.parseUInt(E[R].indexA),S.indexB[R]=Box2D.parseUInt(E[R].indexB)},L.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:{var S=s.SubtractVV(this.m_v2.w,this.m_v1.w),E=s.CrossVV(S,this.m_v1.w.GetNegative());return E>0?s.CrossFV(1,S):s.CrossVF(S,1)}default:return n.b2Assert(!1),new c}},L.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return n.b2Assert(!1),new c;case 1:return this.m_v1.w;case 2:return new c(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return n.b2Assert(!1),new c}},L.prototype.GetWitnessPoints=function(S,E){switch(this.m_count){case 0:n.b2Assert(!1);break;case 1:S.SetV(this.m_v1.wA),E.SetV(this.m_v1.wB);break;case 2:S.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,S.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,E.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,E.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:E.x=S.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,E.y=S.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:n.b2Assert(!1);break}},L.prototype.GetMetric=function(){switch(this.m_count){case 0:return n.b2Assert(!1),0;case 1:return 0;case 2:return s.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return s.CrossVV(s.SubtractVV(this.m_v2.w,this.m_v1.w),s.SubtractVV(this.m_v3.w,this.m_v1.w));default:return n.b2Assert(!1),0}},L.prototype.Solve2=function(){var S=this.m_v1.w,E=this.m_v2.w,R=s.SubtractVV(E,S),F=-(S.x*R.x+S.y*R.y);if(F<=0){this.m_v1.a=1,this.m_count=1;return}var k=E.x*R.x+E.y*R.y;if(k<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}var X=1/(k+F);this.m_v1.a=k*X,this.m_v2.a=F*X,this.m_count=2},L.prototype.Solve3=function(){var S=this.m_v1.w,E=this.m_v2.w,R=this.m_v3.w,F=s.SubtractVV(E,S),k=s.Dot(S,F),X=s.Dot(E,F),Z=X,V=-k,Y=s.SubtractVV(R,S),$=s.Dot(S,Y),et=s.Dot(R,Y),ct=et,ht=-$,pt=s.SubtractVV(R,E),mt=s.Dot(E,pt),dt=s.Dot(R,pt),xt=dt,Tt=-mt,lt=s.CrossVV(F,Y),at=lt*s.CrossVV(E,R),At=lt*s.CrossVV(R,S),St=lt*s.CrossVV(S,E);if(V<=0&&ht<=0){this.m_v1.a=1,this.m_count=1;return}if(Z>0&&V>0&&St<=0){var wt=1/(Z+V);this.m_v1.a=Z*wt,this.m_v2.a=V*wt,this.m_count=2;return}if(ct>0&&ht>0&&At<=0){var Pt=1/(ct+ht);this.m_v1.a=ct*Pt,this.m_v3.a=ht*Pt,this.m_count=2,this.m_v2.Set(this.m_v3);return}if(Z<=0&&Tt<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}if(ct<=0&&xt<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3);return}if(xt>0&&Tt>0&&at<=0){var It=1/(xt+Tt);this.m_v2.a=xt*It,this.m_v3.a=Tt*It,this.m_count=2,this.m_v1.Set(this.m_v3);return}var zt=1/(at+At+St);this.m_v1.a=at*zt,this.m_v2.a=At*zt,this.m_v3.a=St*zt,this.m_count=3},G.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},w.b2SimplexVertex=function(){},w.prototype.Set=function(S){this.wA.SetV(S.wA),this.wB.SetV(S.wB),this.w.SetV(S.w),this.a=S.a,this.indexA=S.indexA,this.indexB=S.indexB},O.b2TimeOfImpact=function(){},O.TimeOfImpact=function(S){++O.b2_toiCalls;var E=S.proxyA,R=S.proxyB,F=S.sweepA,k=S.sweepB;n.b2Assert(F.t0==k.t0),n.b2Assert(1-F.t0>Number.MIN_VALUE);var X=E.m_radius+R.m_radius,Z=S.tolerance,V=0,Y=1e3,$=0,et=0;for(O.s_cache.count=0,O.s_distanceInput.useRadii=!1;;){if(F.GetTransform(O.s_xfA,V),k.GetTransform(O.s_xfB,V),O.s_distanceInput.proxyA=E,O.s_distanceInput.proxyB=R,O.s_distanceInput.transformA=O.s_xfA,O.s_distanceInput.transformB=O.s_xfB,T.Distance(O.s_distanceOutput,O.s_cache,O.s_distanceInput),O.s_distanceOutput.distance<=0){V=1;break}O.s_fcn.Initialize(O.s_cache,E,O.s_xfA,R,O.s_xfB);var ct=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(ct<=0){V=1;break}if($==0&&(ct>X?et=s.Max(X-Z,.75*X):et=s.Max(ct-Z,.02*X)),ct-et<.5*Z){if($==0){V=1;break}break}var ht=V;{var pt=V,mt=1,dt=ct;F.GetTransform(O.s_xfA,mt),k.GetTransform(O.s_xfB,mt);var xt=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(xt>=et){V=1;break}for(var Tt=0;;){var lt=0;Tt&1?lt=pt+(et-dt)*(mt-pt)/(xt-dt):lt=.5*(pt+mt),F.GetTransform(O.s_xfA,lt),k.GetTransform(O.s_xfB,lt);var at=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(s.Abs(at-et)<.025*Z){ht=lt;break}if(at>et?(pt=lt,dt=at):(mt=lt,xt=at),++Tt,++O.b2_toiRootIters,Tt==50)break}O.b2_toiMaxRootIters=s.Max(O.b2_toiMaxRootIters,Tt)}if(ht<(1+100*Number.MIN_VALUE)*V||(V=ht,$++,++O.b2_toiIters,$==Y))break}return O.b2_toiMaxIters=s.Max(O.b2_toiMaxIters,$),V},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new G,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new x,Box2D.Collision.b2TimeOfImpact.s_xfA=new a,Box2D.Collision.b2TimeOfImpact.s_xfB=new a,Box2D.Collision.b2TimeOfImpact.s_fcn=new I,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new m}),j.b2TOIInput=function(){this.proxyA=new v,this.proxyB=new v,this.sweepA=new o,this.sweepB=new o},Q.b2WorldManifold=function(){this.m_normal=new c},Q.prototype.b2WorldManifold=function(){this.m_points=new Vector(n.b2_maxManifoldPoints);for(var S=0;S<n.b2_maxManifoldPoints;S++)this.m_points[S]=new c},Q.prototype.Initialize=function(S,E,R,F,k){if(R===void 0&&(R=0),k===void 0&&(k=0),S.m_pointCount!=0){var X=0,Z,V,Y=0,$=0,et=0,ct=0,ht=0,pt=0;switch(S.m_type){case M.e_circles:{V=E.R,Z=S.m_localPoint;var mt=E.position.x+V.col1.x*Z.x+V.col2.x*Z.y,dt=E.position.y+V.col1.y*Z.x+V.col2.y*Z.y;V=F.R,Z=S.m_points[0].m_localPoint;var xt=F.position.x+V.col1.x*Z.x+V.col2.x*Z.y,Tt=F.position.y+V.col1.y*Z.x+V.col2.y*Z.y,lt=xt-mt,at=Tt-dt,At=lt*lt+at*at;if(At>Number.MIN_VALUE*Number.MIN_VALUE){var St=Math.sqrt(At);this.m_normal.x=lt/St,this.m_normal.y=at/St}else this.m_normal.x=1,this.m_normal.y=0;var wt=mt+R*this.m_normal.x,Pt=dt+R*this.m_normal.y,It=xt-k*this.m_normal.x,zt=Tt-k*this.m_normal.y;this.m_points[0].x=.5*(wt+It),this.m_points[0].y=.5*(Pt+zt)}break;case M.e_faceA:for(V=E.R,Z=S.m_localPlaneNormal,Y=V.col1.x*Z.x+V.col2.x*Z.y,$=V.col1.y*Z.x+V.col2.y*Z.y,V=E.R,Z=S.m_localPoint,et=E.position.x+V.col1.x*Z.x+V.col2.x*Z.y,ct=E.position.y+V.col1.y*Z.x+V.col2.y*Z.y,this.m_normal.x=Y,this.m_normal.y=$,X=0;X<S.m_pointCount;X++)V=F.R,Z=S.m_points[X].m_localPoint,ht=F.position.x+V.col1.x*Z.x+V.col2.x*Z.y,pt=F.position.y+V.col1.y*Z.x+V.col2.y*Z.y,this.m_points[X].x=ht+.5*(R-(ht-et)*Y-(pt-ct)*$-k)*Y,this.m_points[X].y=pt+.5*(R-(ht-et)*Y-(pt-ct)*$-k)*$;break;case M.e_faceB:for(V=F.R,Z=S.m_localPlaneNormal,Y=V.col1.x*Z.x+V.col2.x*Z.y,$=V.col1.y*Z.x+V.col2.y*Z.y,V=F.R,Z=S.m_localPoint,et=F.position.x+V.col1.x*Z.x+V.col2.x*Z.y,ct=F.position.y+V.col1.y*Z.x+V.col2.y*Z.y,this.m_normal.x=-Y,this.m_normal.y=-$,X=0;X<S.m_pointCount;X++)V=E.R,Z=S.m_points[X].m_localPoint,ht=E.position.x+V.col1.x*Z.x+V.col2.x*Z.y,pt=E.position.y+V.col1.y*Z.x+V.col2.y*Z.y,this.m_points[X].x=ht+.5*(k-(ht-et)*Y-(pt-ct)*$-R)*Y,this.m_points[X].y=pt+.5*(k-(ht-et)*Y-(pt-ct)*$-R)*$;break}}},C.ClipVertex=function(){this.v=new c,this.id=new d},C.prototype.Set=function(S){this.v.SetV(S.v),this.id.Set(S.id)},b.Features=function(){},Object.defineProperty(b.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(b.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(S){S===void 0&&(S=0),this._referenceEdge=S,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(b.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(b.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(S){S===void 0&&(S=0),this._incidentEdge=S,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(b.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(b.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(S){S===void 0&&(S=0),this._incidentVertex=S,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(b.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(b.prototype,"flip",{enumerable:!1,configurable:!0,set:function(S){S===void 0&&(S=0),this._flip=S,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){Box2D.Common.b2Color,Box2D.Common.b2internal;var t=Box2D.Common.b2Settings,e=Box2D.Collision.Shapes.b2CircleShape,r=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,s=Box2D.Collision.Shapes.b2MassData,o=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,c=Box2D.Common.Math.b2Mat22;Box2D.Common.Math.b2Mat33;var l=Box2D.Common.Math.b2Math;Box2D.Common.Math.b2Sweep;var h=Box2D.Common.Math.b2Transform,u=Box2D.Common.Math.b2Vec2;Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint;var _=Box2D.Collision.b2Distance,d=Box2D.Collision.b2DistanceInput,f=Box2D.Collision.b2DistanceOutput,T=Box2D.Collision.b2DistanceProxy;Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex;var x=Box2D.Collision.b2SimplexCache;Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.inherit(e,Box2D.Collision.Shapes.b2Shape),e.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,e.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new u},e.prototype.Copy=function(){var m=new e;return m.Set(this),m},e.prototype.Set=function(m){if(this.__super.Set.call(this,m),Box2D.is(m,e)){var v=m instanceof e?m:null;this.m_p.SetV(v.m_p)}},e.prototype.TestPoint=function(m,v){var A=m.R,D=m.position.x+(A.col1.x*this.m_p.x+A.col2.x*this.m_p.y),N=m.position.y+(A.col1.y*this.m_p.x+A.col2.y*this.m_p.y);return D=v.x-D,N=v.y-N,D*D+N*N<=this.m_radius*this.m_radius},e.prototype.RayCast=function(m,v,A){var D=A.R,N=A.position.x+(D.col1.x*this.m_p.x+D.col2.x*this.m_p.y),z=A.position.y+(D.col1.y*this.m_p.x+D.col2.y*this.m_p.y),M=v.p1.x-N,J=v.p1.y-z,U=M*M+J*J-this.m_radius*this.m_radius,K=v.p2.x-v.p1.x,tt=v.p2.y-v.p1.y,rt=M*K+J*tt,I=K*K+tt*tt,L=rt*rt-I*U;if(L<0||I<Number.MIN_VALUE)return!1;var G=-(rt+Math.sqrt(L));return 0<=G&&G<=v.maxFraction*I?(G/=I,m.fraction=G,m.normal.x=M+G*K,m.normal.y=J+G*tt,m.normal.Normalize(),!0):!1},e.prototype.ComputeAABB=function(m,v){var A=v.R,D=v.position.x+(A.col1.x*this.m_p.x+A.col2.x*this.m_p.y),N=v.position.y+(A.col1.y*this.m_p.x+A.col2.y*this.m_p.y);m.lowerBound.Set(D-this.m_radius,N-this.m_radius),m.upperBound.Set(D+this.m_radius,N+this.m_radius)},e.prototype.ComputeMass=function(m,v){v===void 0&&(v=0),m.mass=v*t.b2_pi*this.m_radius*this.m_radius,m.center.SetV(this.m_p),m.I=m.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},e.prototype.ComputeSubmergedArea=function(m,v,A,D){v===void 0&&(v=0);var N=l.MulX(A,this.m_p),z=-(l.Dot(m,N)-v);if(z<-this.m_radius+Number.MIN_VALUE)return 0;if(z>this.m_radius)return D.SetV(N),Math.PI*this.m_radius*this.m_radius;var M=this.m_radius*this.m_radius,J=z*z,U=M*(Math.asin(z/this.m_radius)+Math.PI/2)+z*Math.sqrt(M-J),K=-2/3*Math.pow(M-J,1.5)/U;return D.x=N.x+m.x*K,D.y=N.y+m.y*K,U},e.prototype.GetLocalPosition=function(){return this.m_p},e.prototype.SetLocalPosition=function(m){this.m_p.SetV(m)},e.prototype.GetRadius=function(){return this.m_radius},e.prototype.SetRadius=function(m){m===void 0&&(m=0),this.m_radius=m},e.prototype.b2CircleShape=function(m){m===void 0&&(m=0),this.__super.b2Shape.call(this),this.m_type=a.e_circleShape,this.m_radius=m},r.b2EdgeChainDef=function(){},r.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(n,Box2D.Collision.Shapes.b2Shape),n.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,n.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new u,this.m_v1=new u,this.m_v2=new u,this.m_coreV1=new u,this.m_coreV2=new u,this.m_normal=new u,this.m_direction=new u,this.m_cornerDir1=new u,this.m_cornerDir2=new u},n.prototype.TestPoint=function(m,v){return!1},n.prototype.RayCast=function(m,v,A){var D,N=v.p2.x-v.p1.x,z=v.p2.y-v.p1.y;D=A.R;var M=A.position.x+(D.col1.x*this.m_v1.x+D.col2.x*this.m_v1.y),J=A.position.y+(D.col1.y*this.m_v1.x+D.col2.y*this.m_v1.y),U=A.position.y+(D.col1.y*this.m_v2.x+D.col2.y*this.m_v2.y)-J,K=-(A.position.x+(D.col1.x*this.m_v2.x+D.col2.x*this.m_v2.y)-M),tt=100*Number.MIN_VALUE,rt=-(N*U+z*K);if(rt>tt){var I=v.p1.x-M,L=v.p1.y-J,G=I*U+L*K;if(0<=G&&G<=v.maxFraction*rt){var w=-N*L+z*I;if(-tt*rt<=w&&w<=rt*(1+tt)){G/=rt,m.fraction=G;var O=Math.sqrt(U*U+K*K);return m.normal.x=U/O,m.normal.y=K/O,!0}}}return!1},n.prototype.ComputeAABB=function(m,v){var A=v.R,D=v.position.x+(A.col1.x*this.m_v1.x+A.col2.x*this.m_v1.y),N=v.position.y+(A.col1.y*this.m_v1.x+A.col2.y*this.m_v1.y),z=v.position.x+(A.col1.x*this.m_v2.x+A.col2.x*this.m_v2.y),M=v.position.y+(A.col1.y*this.m_v2.x+A.col2.y*this.m_v2.y);D<z?(m.lowerBound.x=D,m.upperBound.x=z):(m.lowerBound.x=z,m.upperBound.x=D),N<M?(m.lowerBound.y=N,m.upperBound.y=M):(m.lowerBound.y=M,m.upperBound.y=N)},n.prototype.ComputeMass=function(m,v){m.mass=0,m.center.SetV(this.m_v1),m.I=0},n.prototype.ComputeSubmergedArea=function(m,v,A,D){v===void 0&&(v=0);var N=new u(m.x*v,m.y*v),z=l.MulX(A,this.m_v1),M=l.MulX(A,this.m_v2),J=l.Dot(m,z)-v,U=l.Dot(m,M)-v;if(J>0){if(U>0)return 0;z.x=-U/(J-U)*z.x+J/(J-U)*M.x,z.y=-U/(J-U)*z.y+J/(J-U)*M.y}else U>0&&(M.x=-U/(J-U)*z.x+J/(J-U)*M.x,M.y=-U/(J-U)*z.y+J/(J-U)*M.y);return D.x=(N.x+z.x+M.x)/3,D.y=(N.y+z.y+M.y)/3,.5*((z.x-N.x)*(M.y-N.y)-(z.y-N.y)*(M.x-N.x))},n.prototype.GetLength=function(){return this.m_length},n.prototype.GetVertex1=function(){return this.m_v1},n.prototype.GetVertex2=function(){return this.m_v2},n.prototype.GetCoreVertex1=function(){return this.m_coreV1},n.prototype.GetCoreVertex2=function(){return this.m_coreV2},n.prototype.GetNormalVector=function(){return this.m_normal},n.prototype.GetDirectionVector=function(){return this.m_direction},n.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},n.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},n.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},n.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},n.prototype.GetFirstVertex=function(m){var v=m.R;return new u(m.position.x+(v.col1.x*this.m_coreV1.x+v.col2.x*this.m_coreV1.y),m.position.y+(v.col1.y*this.m_coreV1.x+v.col2.y*this.m_coreV1.y))},n.prototype.GetNextEdge=function(){return this.m_nextEdge},n.prototype.GetPrevEdge=function(){return this.m_prevEdge},n.prototype.Support=function(m,v,A){v===void 0&&(v=0),A===void 0&&(A=0);var D=m.R,N=m.position.x+(D.col1.x*this.m_coreV1.x+D.col2.x*this.m_coreV1.y),z=m.position.y+(D.col1.y*this.m_coreV1.x+D.col2.y*this.m_coreV1.y),M=m.position.x+(D.col1.x*this.m_coreV2.x+D.col2.x*this.m_coreV2.y),J=m.position.y+(D.col1.y*this.m_coreV2.x+D.col2.y*this.m_coreV2.y);return N*v+z*A>M*v+J*A?(this.s_supportVec.x=N,this.s_supportVec.y=z):(this.s_supportVec.x=M,this.s_supportVec.y=J),this.s_supportVec},n.prototype.b2EdgeShape=function(m,v){this.__super.b2Shape.call(this),this.m_type=a.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=m,this.m_v2=v,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-t.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-t.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-t.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-t.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},n.prototype.SetPrevEdge=function(m,v,A,D){this.m_prevEdge=m,this.m_coreV1=v,this.m_cornerDir1=A,this.m_cornerConvex1=D},n.prototype.SetNextEdge=function(m,v,A,D){this.m_nextEdge=m,this.m_coreV2=v,this.m_cornerDir2=A,this.m_cornerConvex2=D},s.b2MassData=function(){this.mass=0,this.center=new u(0,0),this.I=0},Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape),o.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,o.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},o.prototype.Copy=function(){var m=new o;return m.Set(this),m},o.prototype.Set=function(m){if(this.__super.Set.call(this,m),Box2D.is(m,o)){var v=m instanceof o?m:null;this.m_centroid.SetV(v.m_centroid),this.m_vertexCount=v.m_vertexCount,this.Reserve(this.m_vertexCount);for(var A=0;A<this.m_vertexCount;A++)this.m_vertices[A].SetV(v.m_vertices[A]),this.m_normals[A].SetV(v.m_normals[A])}},o.prototype.SetAsArray=function(m,v){v===void 0&&(v=0);var A=new Vector,D=0,N;for(D=0;D<m.length;++D)N=m[D],A.push(N);this.SetAsVector(A,v)},o.AsArray=function(m,v){v===void 0&&(v=0);var A=new o;return A.SetAsArray(m,v),A},o.prototype.SetAsVector=function(m,v){v===void 0&&(v=0),v==0&&(v=m.length),t.b2Assert(2<=v),this.m_vertexCount=v,this.Reserve(v);var A=0;for(A=0;A<this.m_vertexCount;A++)this.m_vertices[A].SetV(m[A]);for(A=0;A<this.m_vertexCount;++A){var D=parseInt(A),N=parseInt(A+1<this.m_vertexCount?A+1:0),z=l.SubtractVV(this.m_vertices[N],this.m_vertices[D]);t.b2Assert(z.LengthSquared()>Number.MIN_VALUE),this.m_normals[A].SetV(l.CrossVF(z,1)),this.m_normals[A].Normalize()}this.m_centroid=o.ComputeCentroid(this.m_vertices,this.m_vertexCount)},o.AsVector=function(m,v){v===void 0&&(v=0);var A=new o;return A.SetAsVector(m,v),A},o.prototype.SetAsBox=function(m,v){m===void 0&&(m=0),v===void 0&&(v=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-m,-v),this.m_vertices[1].Set(m,-v),this.m_vertices[2].Set(m,v),this.m_vertices[3].Set(-m,v),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},o.AsBox=function(m,v){m===void 0&&(m=0),v===void 0&&(v=0);var A=new o;return A.SetAsBox(m,v),A},o.prototype.SetAsOrientedBox=function(m,v,A,D){m===void 0&&(m=0),v===void 0&&(v=0),A===void 0&&(A=null),D===void 0&&(D=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-m,-v),this.m_vertices[1].Set(m,-v),this.m_vertices[2].Set(m,v),this.m_vertices[3].Set(-m,v),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=A;var N=new h;N.position=A,N.R.Set(D);for(var z=0;z<this.m_vertexCount;++z)this.m_vertices[z]=l.MulX(N,this.m_vertices[z]),this.m_normals[z]=l.MulMV(N.R,this.m_normals[z])},o.AsOrientedBox=function(m,v,A,D){m===void 0&&(m=0),v===void 0&&(v=0),A===void 0&&(A=null),D===void 0&&(D=0);var N=new o;return N.SetAsOrientedBox(m,v,A,D),N},o.prototype.SetAsEdge=function(m,v){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(m),this.m_vertices[1].SetV(v),this.m_centroid.x=.5*(m.x+v.x),this.m_centroid.y=.5*(m.y+v.y),this.m_normals[0]=l.CrossVF(l.SubtractVV(v,m),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},o.AsEdge=function(m,v){var A=new o;return A.SetAsEdge(m,v),A},o.prototype.TestPoint=function(m,v){for(var A,D=m.R,N=v.x-m.position.x,z=v.y-m.position.y,M=N*D.col1.x+z*D.col1.y,J=N*D.col2.x+z*D.col2.y,U=0;U<this.m_vertexCount;++U){A=this.m_vertices[U],N=M-A.x,z=J-A.y,A=this.m_normals[U];var K=A.x*N+A.y*z;if(K>0)return!1}return!0},o.prototype.RayCast=function(m,v,A){var D=0,N=v.maxFraction,z=0,M=0,J,U;z=v.p1.x-A.position.x,M=v.p1.y-A.position.y,J=A.R;var K=z*J.col1.x+M*J.col1.y,tt=z*J.col2.x+M*J.col2.y;z=v.p2.x-A.position.x,M=v.p2.y-A.position.y,J=A.R;for(var rt=z*J.col1.x+M*J.col1.y,I=z*J.col2.x+M*J.col2.y,L=rt-K,G=I-tt,w=parseInt(-1),O=0;O<this.m_vertexCount;++O){U=this.m_vertices[O],z=U.x-K,M=U.y-tt,U=this.m_normals[O];var j=U.x*z+U.y*M,Q=U.x*L+U.y*G;if(Q==0){if(j<0)return!1}else Q<0&&j<D*Q?(D=j/Q,w=O):Q>0&&j<N*Q&&(N=j/Q);if(N<D-Number.MIN_VALUE)return!1}return w>=0?(m.fraction=D,J=A.R,U=this.m_normals[w],m.normal.x=J.col1.x*U.x+J.col2.x*U.y,m.normal.y=J.col1.y*U.x+J.col2.y*U.y,!0):!1},o.prototype.ComputeAABB=function(m,v){for(var A=v.R,D=this.m_vertices[0],N=v.position.x+(A.col1.x*D.x+A.col2.x*D.y),z=v.position.y+(A.col1.y*D.x+A.col2.y*D.y),M=N,J=z,U=1;U<this.m_vertexCount;++U){D=this.m_vertices[U];var K=v.position.x+(A.col1.x*D.x+A.col2.x*D.y),tt=v.position.y+(A.col1.y*D.x+A.col2.y*D.y);N=N<K?N:K,z=z<tt?z:tt,M=M>K?M:K,J=J>tt?J:tt}m.lowerBound.x=N-this.m_radius,m.lowerBound.y=z-this.m_radius,m.upperBound.x=M+this.m_radius,m.upperBound.y=J+this.m_radius},o.prototype.ComputeMass=function(m,v){if(v===void 0&&(v=0),this.m_vertexCount==2){m.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),m.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),m.mass=0,m.I=0;return}for(var A=0,D=0,N=0,z=0,M=0,J=0,U=1/3,K=0;K<this.m_vertexCount;++K){var tt=this.m_vertices[K],rt=K+1<this.m_vertexCount?this.m_vertices[parseInt(K+1)]:this.m_vertices[0],I=tt.x-M,L=tt.y-J,G=rt.x-M,w=rt.y-J,O=I*w-L*G,j=.5*O;N+=j,A+=j*U*(M+tt.x+rt.x),D+=j*U*(J+tt.y+rt.y);var Q=M,C=J,b=I,W=L,S=G,E=w,R=U*(.25*(b*b+S*b+S*S)+(Q*b+Q*S))+.5*Q*Q,F=U*(.25*(W*W+E*W+E*E)+(C*W+C*E))+.5*C*C;z+=O*(R+F)}m.mass=v*N,A*=1/N,D*=1/N,m.center.Set(A,D),m.I=v*z},o.prototype.ComputeSubmergedArea=function(m,v,A,D){v===void 0&&(v=0);var N=l.MulTMV(A.R,m),z=v-l.Dot(m,A.position),M=new Vector_a2j_Number,J=0,U=parseInt(-1),K=parseInt(-1),tt=!1,rt=0;for(rt=0;rt<this.m_vertexCount;++rt){M[rt]=l.Dot(N,this.m_vertices[rt])-z;var I=M[rt]<-Number.MIN_VALUE;rt>0&&(I?tt||(U=rt-1,J++):tt&&(K=rt-1,J++)),tt=I}switch(J){case 0:if(tt){var L=new s;return this.ComputeMass(L,1),D.SetV(l.MulX(A,L.center)),L.mass}else return 0;case 1:U==-1?U=this.m_vertexCount-1:K=this.m_vertexCount-1;break}var G=parseInt((U+1)%this.m_vertexCount),w=parseInt((K+1)%this.m_vertexCount),O=(0-M[U])/(M[G]-M[U]),j=(0-M[K])/(M[w]-M[K]),Q=new u(this.m_vertices[U].x*(1-O)+this.m_vertices[G].x*O,this.m_vertices[U].y*(1-O)+this.m_vertices[G].y*O),C=new u(this.m_vertices[K].x*(1-j)+this.m_vertices[w].x*j,this.m_vertices[K].y*(1-j)+this.m_vertices[w].y*j),b=0,W=new u,S=this.m_vertices[G],E;for(rt=G;rt!=w;){rt=(rt+1)%this.m_vertexCount,rt==w?E=C:E=this.m_vertices[rt];var R=.5*((S.x-Q.x)*(E.y-Q.y)-(S.y-Q.y)*(E.x-Q.x));b+=R,W.x+=R*(Q.x+S.x+E.x)/3,W.y+=R*(Q.y+S.y+E.y)/3,S=E}return W.Multiply(1/b),D.SetV(l.MulX(A,W)),b},o.prototype.GetVertexCount=function(){return this.m_vertexCount},o.prototype.GetVertices=function(){return this.m_vertices},o.prototype.GetNormals=function(){return this.m_normals},o.prototype.GetSupport=function(m){for(var v=0,A=this.m_vertices[0].x*m.x+this.m_vertices[0].y*m.y,D=1;D<this.m_vertexCount;++D){var N=this.m_vertices[D].x*m.x+this.m_vertices[D].y*m.y;N>A&&(v=D,A=N)}return v},o.prototype.GetSupportVertex=function(m){for(var v=0,A=this.m_vertices[0].x*m.x+this.m_vertices[0].y*m.y,D=1;D<this.m_vertexCount;++D){var N=this.m_vertices[D].x*m.x+this.m_vertices[D].y*m.y;N>A&&(v=D,A=N)}return this.m_vertices[v]},o.prototype.Validate=function(){return!1},o.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=a.e_polygonShape,this.m_centroid=new u,this.m_vertices=new Vector,this.m_normals=new Vector},o.prototype.Reserve=function(m){m===void 0&&(m=0);for(var v=parseInt(this.m_vertices.length);v<m;v++)this.m_vertices[v]=new u,this.m_normals[v]=new u},o.ComputeCentroid=function(m,v){v===void 0&&(v=0);for(var A=new u,D=0,N=0,z=0,M=1/3,J=0;J<v;++J){var U=m[J],K=J+1<v?m[parseInt(J+1)]:m[0],tt=U.x-N,rt=U.y-z,I=K.x-N,L=K.y-z,G=tt*L-rt*I,w=.5*G;D+=w,A.x+=w*M*(N+U.x+K.x),A.y+=w*M*(z+U.y+K.y)}return A.x*=1/D,A.y*=1/D,A},o.ComputeOBB=function(m,v,A){A===void 0&&(A=0);var D=0,N=new Vector(A+1);for(D=0;D<A;++D)N[D]=v[D];N[A]=N[0];var z=Number.MAX_VALUE;for(D=1;D<=A;++D){var M=N[parseInt(D-1)],J=N[D].x-M.x,U=N[D].y-M.y,K=Math.sqrt(J*J+U*U);J/=K,U/=K;for(var tt=-U,rt=J,I=Number.MAX_VALUE,L=Number.MAX_VALUE,G=-Number.MAX_VALUE,w=-Number.MAX_VALUE,O=0;O<A;++O){var j=N[O].x-M.x,Q=N[O].y-M.y,C=J*j+U*Q,b=tt*j+rt*Q;C<I&&(I=C),b<L&&(L=b),C>G&&(G=C),b>w&&(w=b)}var W=(G-I)*(w-L);if(W<.95*z){z=W,m.R.col1.x=J,m.R.col1.y=U,m.R.col2.x=tt,m.R.col2.y=rt;var S=.5*(I+G),E=.5*(L+w),R=m.R;m.center.x=M.x+(R.col1.x*S+R.col2.x*E),m.center.y=M.y+(R.col1.y*S+R.col2.y*E),m.extents.x=.5*(G-I),m.extents.y=.5*(w-L)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new c}),a.b2Shape=function(){},a.prototype.Copy=function(){return null},a.prototype.Set=function(m){this.m_radius=m.m_radius},a.prototype.GetType=function(){return this.m_type},a.prototype.TestPoint=function(m,v){return!1},a.prototype.RayCast=function(m,v,A){return!1},a.prototype.ComputeAABB=function(m,v){},a.prototype.ComputeMass=function(m,v){},a.prototype.ComputeSubmergedArea=function(m,v,A,D){return 0},a.TestOverlap=function(m,v,A,D){var N=new d;N.proxyA=new T,N.proxyA.Set(m),N.proxyB=new T,N.proxyB.Set(A),N.transformA=v,N.transformB=D,N.useRadii=!0;var z=new x;z.count=0;var M=new f;return _.Distance(M,z,N),M.distance<10*Number.MIN_VALUE},a.prototype.b2Shape=function(){this.m_type=a.e_unknownShape,this.m_radius=t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var t=Box2D.Common.b2Color;Box2D.Common.b2internal;var e=Box2D.Common.b2Settings;Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33;var r=Box2D.Common.Math.b2Math;Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3,t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(n,s,o){n===void 0&&(n=0),s===void 0&&(s=0),o===void 0&&(o=0),this._r=Box2D.parseUInt(255*r.Clamp(n,0,1)),this._g=Box2D.parseUInt(255*r.Clamp(s,0,1)),this._b=Box2D.parseUInt(255*r.Clamp(o,0,1))},t.prototype.Set=function(n,s,o){n===void 0&&(n=0),s===void 0&&(s=0),o===void 0&&(o=0),this._r=Box2D.parseUInt(255*r.Clamp(n,0,1)),this._g=Box2D.parseUInt(255*r.Clamp(s,0,1)),this._b=Box2D.parseUInt(255*r.Clamp(o,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(n){n===void 0&&(n=0),this._r=Box2D.parseUInt(255*r.Clamp(n,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(n){n===void 0&&(n=0),this._g=Box2D.parseUInt(255*r.Clamp(n,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(n){n===void 0&&(n=0),this._b=Box2D.parseUInt(255*r.Clamp(n,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),e.b2Settings=function(){},e.b2MixFriction=function(n,s){return n===void 0&&(n=0),s===void 0&&(s=0),Math.sqrt(n*s)},e.b2MixRestitution=function(n,s){return n===void 0&&(n=0),s===void 0&&(s=0),n>s?n:s},e.b2Assert=function(n){if(!n)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*e.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})})();(function(){Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings;var t=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,a=Box2D.Common.Math.b2Vec3;t.b2Mat22=function(){this.col1=new o,this.col2=new o},t.prototype.b2Mat22=function(){this.SetIdentity()},t.FromAngle=function(c){c===void 0&&(c=0);var l=new t;return l.Set(c),l},t.FromVV=function(c,l){var h=new t;return h.SetVV(c,l),h},t.prototype.Set=function(c){c===void 0&&(c=0);var l=Math.cos(c),h=Math.sin(c);this.col1.x=l,this.col2.x=-h,this.col1.y=h,this.col2.y=l},t.prototype.SetVV=function(c,l){this.col1.SetV(c),this.col2.SetV(l)},t.prototype.Copy=function(){var c=new t;return c.SetM(this),c},t.prototype.SetM=function(c){this.col1.SetV(c.col1),this.col2.SetV(c.col2)},t.prototype.AddM=function(c){this.col1.x+=c.col1.x,this.col1.y+=c.col1.y,this.col2.x+=c.col2.x,this.col2.y+=c.col2.y},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},t.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},t.prototype.GetInverse=function(c){var l=this.col1.x,h=this.col2.x,u=this.col1.y,_=this.col2.y,d=l*_-h*u;return d!=0&&(d=1/d),c.col1.x=d*_,c.col2.x=-d*h,c.col1.y=-d*u,c.col2.y=d*l,c},t.prototype.Solve=function(c,l,h){l===void 0&&(l=0),h===void 0&&(h=0);var u=this.col1.x,_=this.col2.x,d=this.col1.y,f=this.col2.y,T=u*f-_*d;return T!=0&&(T=1/T),c.x=T*(f*l-_*h),c.y=T*(u*h-d*l),c},t.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},e.b2Mat33=function(){this.col1=new a,this.col2=new a,this.col3=new a},e.prototype.b2Mat33=function(c,l,h){c===void 0&&(c=null),l===void 0&&(l=null),h===void 0&&(h=null),!c&&!l&&!h?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(c),this.col2.SetV(l),this.col3.SetV(h))},e.prototype.SetVVV=function(c,l,h){this.col1.SetV(c),this.col2.SetV(l),this.col3.SetV(h)},e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)},e.prototype.SetM=function(c){this.col1.SetV(c.col1),this.col2.SetV(c.col2),this.col3.SetV(c.col3)},e.prototype.AddM=function(c){this.col1.x+=c.col1.x,this.col1.y+=c.col1.y,this.col1.z+=c.col1.z,this.col2.x+=c.col2.x,this.col2.y+=c.col2.y,this.col2.z+=c.col2.z,this.col3.x+=c.col3.x,this.col3.y+=c.col3.y,this.col3.z+=c.col3.z},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},e.prototype.Solve22=function(c,l,h){l===void 0&&(l=0),h===void 0&&(h=0);var u=this.col1.x,_=this.col2.x,d=this.col1.y,f=this.col2.y,T=u*f-_*d;return T!=0&&(T=1/T),c.x=T*(f*l-_*h),c.y=T*(u*h-d*l),c},e.prototype.Solve33=function(c,l,h,u){l===void 0&&(l=0),h===void 0&&(h=0),u===void 0&&(u=0);var _=this.col1.x,d=this.col1.y,f=this.col1.z,T=this.col2.x,x=this.col2.y,m=this.col2.z,v=this.col3.x,A=this.col3.y,D=this.col3.z,N=_*(x*D-m*A)+d*(m*v-T*D)+f*(T*A-x*v);return N!=0&&(N=1/N),c.x=N*(l*(x*D-m*A)+h*(m*v-T*D)+u*(T*A-x*v)),c.y=N*(_*(h*D-u*A)+d*(u*v-l*D)+f*(l*A-h*v)),c.z=N*(_*(x*u-m*h)+d*(m*l-T*u)+f*(T*h-x*l)),c},r.b2Math=function(){},r.IsValid=function(c){return c===void 0&&(c=0),isFinite(c)},r.Dot=function(c,l){return c.x*l.x+c.y*l.y},r.CrossVV=function(c,l){return c.x*l.y-c.y*l.x},r.CrossVF=function(c,l){l===void 0&&(l=0);var h=new o(l*c.y,-l*c.x);return h},r.CrossFV=function(c,l){c===void 0&&(c=0);var h=new o(-c*l.y,c*l.x);return h},r.MulMV=function(c,l){var h=new o(c.col1.x*l.x+c.col2.x*l.y,c.col1.y*l.x+c.col2.y*l.y);return h},r.MulTMV=function(c,l){var h=new o(r.Dot(l,c.col1),r.Dot(l,c.col2));return h},r.MulX=function(c,l){var h=r.MulMV(c.R,l);return h.x+=c.position.x,h.y+=c.position.y,h},r.MulXT=function(c,l){var h=r.SubtractVV(l,c.position),u=h.x*c.R.col1.x+h.y*c.R.col1.y;return h.y=h.x*c.R.col2.x+h.y*c.R.col2.y,h.x=u,h},r.AddVV=function(c,l){var h=new o(c.x+l.x,c.y+l.y);return h},r.SubtractVV=function(c,l){var h=new o(c.x-l.x,c.y-l.y);return h},r.Distance=function(c,l){var h=c.x-l.x,u=c.y-l.y;return Math.sqrt(h*h+u*u)},r.DistanceSquared=function(c,l){var h=c.x-l.x,u=c.y-l.y;return h*h+u*u},r.MulFV=function(c,l){c===void 0&&(c=0);var h=new o(c*l.x,c*l.y);return h},r.AddMM=function(c,l){var h=t.FromVV(r.AddVV(c.col1,l.col1),r.AddVV(c.col2,l.col2));return h},r.MulMM=function(c,l){var h=t.FromVV(r.MulMV(c,l.col1),r.MulMV(c,l.col2));return h},r.MulTMM=function(c,l){var h=new o(r.Dot(c.col1,l.col1),r.Dot(c.col2,l.col1)),u=new o(r.Dot(c.col1,l.col2),r.Dot(c.col2,l.col2)),_=t.FromVV(h,u);return _},r.Abs=function(c){return c===void 0&&(c=0),c>0?c:-c},r.AbsV=function(c){var l=new o(r.Abs(c.x),r.Abs(c.y));return l},r.AbsM=function(c){var l=t.FromVV(r.AbsV(c.col1),r.AbsV(c.col2));return l},r.Min=function(c,l){return c===void 0&&(c=0),l===void 0&&(l=0),c<l?c:l},r.MinV=function(c,l){var h=new o(r.Min(c.x,l.x),r.Min(c.y,l.y));return h},r.Max=function(c,l){return c===void 0&&(c=0),l===void 0&&(l=0),c>l?c:l},r.MaxV=function(c,l){var h=new o(r.Max(c.x,l.x),r.Max(c.y,l.y));return h},r.Clamp=function(c,l,h){return c===void 0&&(c=0),l===void 0&&(l=0),h===void 0&&(h=0),c<l?l:c>h?h:c},r.ClampV=function(c,l,h){return r.MaxV(l,r.MinV(c,h))},r.Swap=function(c,l){var h=c[0];c[0]=l[0],l[0]=h},r.Random=function(){return Math.random()*2-1},r.RandomRange=function(c,l){c===void 0&&(c=0),l===void 0&&(l=0);var h=Math.random();return h=(l-c)*h+c,h},r.NextPowerOfTwo=function(c){return c===void 0&&(c=0),c|=c>>1&2147483647,c|=c>>2&1073741823,c|=c>>4&268435455,c|=c>>8&16777215,c|=c>>16&65535,c+1},r.IsPowerOfTwo=function(c){c===void 0&&(c=0);var l=c>0&&(c&c-1)==0;return l},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new o(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=t.FromVV(new o(1,0),new o(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new s(r.b2Vec2_zero,r.b2Mat22_identity)}),n.b2Sweep=function(){this.localCenter=new o,this.c0=new o,this.c=new o},n.prototype.Set=function(c){this.localCenter.SetV(c.localCenter),this.c0.SetV(c.c0),this.c.SetV(c.c),this.a0=c.a0,this.a=c.a,this.t0=c.t0},n.prototype.Copy=function(){var c=new n;return c.localCenter.SetV(this.localCenter),c.c0.SetV(this.c0),c.c.SetV(this.c),c.a0=this.a0,c.a=this.a,c.t0=this.t0,c},n.prototype.GetTransform=function(c,l){l===void 0&&(l=0),c.position.x=(1-l)*this.c0.x+l*this.c.x,c.position.y=(1-l)*this.c0.y+l*this.c.y;var h=(1-l)*this.a0+l*this.a;c.R.Set(h);var u=c.R;c.position.x-=u.col1.x*this.localCenter.x+u.col2.x*this.localCenter.y,c.position.y-=u.col1.y*this.localCenter.x+u.col2.y*this.localCenter.y},n.prototype.Advance=function(c){if(c===void 0&&(c=0),this.t0<c&&1-this.t0>Number.MIN_VALUE){var l=(c-this.t0)/(1-this.t0);this.c0.x=(1-l)*this.c0.x+l*this.c.x,this.c0.y=(1-l)*this.c0.y+l*this.c.y,this.a0=(1-l)*this.a0+l*this.a,this.t0=c}},s.b2Transform=function(){this.position=new o,this.R=new t},s.prototype.b2Transform=function(c,l){c===void 0&&(c=null),l===void 0&&(l=null),c&&(this.position.SetV(c),this.R.SetM(l))},s.prototype.Initialize=function(c,l){this.position.SetV(c),this.R.SetM(l)},s.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},s.prototype.Set=function(c){this.position.SetV(c.position),this.R.SetM(c.R)},s.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},o.b2Vec2=function(){},o.prototype.b2Vec2=function(c,l){c===void 0&&(c=0),l===void 0&&(l=0),this.x=c,this.y=l},o.prototype.SetZero=function(){this.x=0,this.y=0},o.prototype.Set=function(c,l){c===void 0&&(c=0),l===void 0&&(l=0),this.x=c,this.y=l},o.prototype.SetV=function(c){this.x=c.x,this.y=c.y},o.prototype.GetNegative=function(){return new o(-this.x,-this.y)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},o.Make=function(c,l){return c===void 0&&(c=0),l===void 0&&(l=0),new o(c,l)},o.prototype.Copy=function(){return new o(this.x,this.y)},o.prototype.Add=function(c){this.x+=c.x,this.y+=c.y},o.prototype.Subtract=function(c){this.x-=c.x,this.y-=c.y},o.prototype.Multiply=function(c){c===void 0&&(c=0),this.x*=c,this.y*=c},o.prototype.MulM=function(c){var l=this.x;this.x=c.col1.x*l+c.col2.x*this.y,this.y=c.col1.y*l+c.col2.y*this.y},o.prototype.MulTM=function(c){var l=r.Dot(this,c.col1);this.y=r.Dot(this,c.col2),this.x=l},o.prototype.CrossVF=function(c){c===void 0&&(c=0);var l=this.x;this.x=c*this.y,this.y=-c*l},o.prototype.CrossFV=function(c){c===void 0&&(c=0);var l=this.x;this.x=-c*this.y,this.y=c*l},o.prototype.MinV=function(c){this.x=this.x<c.x?this.x:c.x,this.y=this.y<c.y?this.y:c.y},o.prototype.MaxV=function(c){this.x=this.x>c.x?this.x:c.x,this.y=this.y>c.y?this.y:c.y},o.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},o.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},o.prototype.Normalize=function(){var c=Math.sqrt(this.x*this.x+this.y*this.y);if(c<Number.MIN_VALUE)return 0;var l=1/c;return this.x*=l,this.y*=l,c},o.prototype.IsValid=function(){return r.IsValid(this.x)&&r.IsValid(this.y)},a.b2Vec3=function(){},a.prototype.b2Vec3=function(c,l,h){c===void 0&&(c=0),l===void 0&&(l=0),h===void 0&&(h=0),this.x=c,this.y=l,this.z=h},a.prototype.SetZero=function(){this.x=this.y=this.z=0},a.prototype.Set=function(c,l,h){c===void 0&&(c=0),l===void 0&&(l=0),h===void 0&&(h=0),this.x=c,this.y=l,this.z=h},a.prototype.SetV=function(c){this.x=c.x,this.y=c.y,this.z=c.z},a.prototype.GetNegative=function(){return new a(-this.x,-this.y,-this.z)},a.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},a.prototype.Copy=function(){return new a(this.x,this.y,this.z)},a.prototype.Add=function(c){this.x+=c.x,this.y+=c.y,this.z+=c.z},a.prototype.Subtract=function(c){this.x-=c.x,this.y-=c.y,this.z-=c.z},a.prototype.Multiply=function(c){c===void 0&&(c=0),this.x*=c,this.y*=c,this.z*=c}})();(function(){Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33;var t=Box2D.Common.Math.b2Math,e=Box2D.Common.Math.b2Sweep,r=Box2D.Common.Math.b2Transform,n=Box2D.Common.Math.b2Vec2;Box2D.Common.Math.b2Vec3;var s=Box2D.Common.b2Color;Box2D.Common.b2internal;var o=Box2D.Common.b2Settings,a=Box2D.Collision.b2AABB;Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID;var c=Box2D.Collision.b2ContactPoint;Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree;var l=Box2D.Collision.b2DynamicTreeBroadPhase;Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point;var h=Box2D.Collision.b2RayCastInput,u=Box2D.Collision.b2RayCastOutput;Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;var _=Box2D.Collision.Shapes.b2CircleShape;Box2D.Collision.Shapes.b2EdgeChainDef;var d=Box2D.Collision.Shapes.b2EdgeShape,f=Box2D.Collision.Shapes.b2MassData,T=Box2D.Collision.Shapes.b2PolygonShape,x=Box2D.Collision.Shapes.b2Shape,m=Box2D.Dynamics.b2Body,v=Box2D.Dynamics.b2BodyDef,A=Box2D.Dynamics.b2ContactFilter,D=Box2D.Dynamics.b2ContactImpulse,N=Box2D.Dynamics.b2ContactListener,z=Box2D.Dynamics.b2ContactManager,M=Box2D.Dynamics.b2DebugDraw,J=Box2D.Dynamics.b2DestructionListener,U=Box2D.Dynamics.b2FilterData,K=Box2D.Dynamics.b2Fixture,tt=Box2D.Dynamics.b2FixtureDef,rt=Box2D.Dynamics.b2Island,I=Box2D.Dynamics.b2TimeStep,L=Box2D.Dynamics.b2World;Box2D.Dynamics.Contacts.b2CircleContact;var G=Box2D.Dynamics.Contacts.b2Contact;Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge;var w=Box2D.Dynamics.Contacts.b2ContactFactory;Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult;var O=Box2D.Dynamics.Contacts.b2ContactSolver;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian;var j=Box2D.Dynamics.Joints.b2Joint;Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef;var Q=Box2D.Dynamics.Joints.b2PulleyJoint;Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef,m.b2Body=function(){this.m_xf=new r,this.m_sweep=new e,this.m_linearVelocity=new n,this.m_force=new n},m.prototype.connectEdges=function(C,b,W){W===void 0&&(W=0);var S=Math.atan2(b.GetDirectionVector().y,b.GetDirectionVector().x),E=Math.tan((S-W)*.5),R=t.MulFV(E,b.GetDirectionVector());R=t.SubtractVV(R,b.GetNormalVector()),R=t.MulFV(o.b2_toiSlop,R),R=t.AddVV(R,b.GetVertex1());var F=t.AddVV(C.GetDirectionVector(),b.GetDirectionVector());F.Normalize();var k=t.Dot(C.GetDirectionVector(),b.GetNormalVector())>0;return C.SetNextEdge(b,R,F,k),b.SetPrevEdge(C,R,F,k),S},m.prototype.CreateFixture=function(C){if(this.m_world.IsLocked()==!0)return null;var b=new K;if(b.Create(this,this.m_xf,C),this.m_flags&m.e_activeFlag){var W=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(W,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this||window,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=L.e_newFixture,b},m.prototype.CreateFixture2=function(C,b){b===void 0&&(b=0);var W=new tt;return W.shape=C,W.density=b,this.CreateFixture(W)},m.prototype.DestroyFixture=function(C){if(this.m_world.IsLocked()!=!0){for(var b=this.m_fixtureList,W=null;b!=null;){if(b==C){W?W.m_next=C.m_next:this.m_fixtureList=C.m_next;break}W=b,b=b.m_next}for(var S=this.m_contactList;S;){var E=S.contact;S=S.next;var R=E.GetFixtureA(),F=E.GetFixtureB();(C==R||C==F)&&this.m_world.m_contactManager.Destroy(E)}if(this.m_flags&m.e_activeFlag){var k=this.m_world.m_contactManager.m_broadPhase;C.DestroyProxy(k)}C.Destroy(),C.m_body=null,C.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},m.prototype.SetPositionAndAngle=function(C,b){b===void 0&&(b=0);var W;if(this.m_world.IsLocked()!=!0){this.m_xf.R.Set(b),this.m_xf.position.SetV(C);var S=this.m_xf.R,E=this.m_sweep.localCenter;this.m_sweep.c.x=S.col1.x*E.x+S.col2.x*E.y,this.m_sweep.c.y=S.col1.y*E.x+S.col2.y*E.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b;var R=this.m_world.m_contactManager.m_broadPhase;for(W=this.m_fixtureList;W;W=W.m_next)W.Synchronize(R,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},m.prototype.SetTransform=function(C){this.SetPositionAndAngle(C.position,C.GetAngle())},m.prototype.GetTransform=function(){return this.m_xf},m.prototype.GetPosition=function(){return this.m_xf.position},m.prototype.SetPosition=function(C){this.SetPositionAndAngle(C,this.GetAngle())},m.prototype.GetAngle=function(){return this.m_sweep.a},m.prototype.SetAngle=function(C){C===void 0&&(C=0),this.SetPositionAndAngle(this.GetPosition(),C)},m.prototype.GetWorldCenter=function(){return this.m_sweep.c},m.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},m.prototype.SetLinearVelocity=function(C){this.m_type!=m.b2_staticBody&&this.m_linearVelocity.SetV(C)},m.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},m.prototype.SetAngularVelocity=function(C){C===void 0&&(C=0),this.m_type!=m.b2_staticBody&&(this.m_angularVelocity=C)},m.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},m.prototype.GetDefinition=function(){var C=new v;return C.type=this.GetType(),C.allowSleep=(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag,C.angle=this.GetAngle(),C.angularDamping=this.m_angularDamping,C.angularVelocity=this.m_angularVelocity,C.fixedRotation=(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag,C.bullet=(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag,C.awake=(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag,C.linearDamping=this.m_linearDamping,C.linearVelocity.SetV(this.GetLinearVelocity()),C.position=this.GetPosition(),C.userData=this.GetUserData(),C},m.prototype.ApplyForce=function(C,b){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=C.x,this.m_force.y+=C.y,this.m_torque+=(b.x-this.m_sweep.c.x)*C.y-(b.y-this.m_sweep.c.y)*C.x)},m.prototype.ApplyTorque=function(C){C===void 0&&(C=0),this.m_type==m.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=C)},m.prototype.ApplyImpulse=function(C,b){this.m_type==m.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*C.x,this.m_linearVelocity.y+=this.m_invMass*C.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*C.y-(b.y-this.m_sweep.c.y)*C.x))},m.prototype.Split=function(C){for(var b=this.GetLinearVelocity().Copy(),W=this.GetAngularVelocity(),S=this.GetWorldCenter(),E=this||window,R=this.m_world.CreateBody(this.GetDefinition()),F,k=E.m_fixtureList;k;)if(C(k)){var X=k.m_next;F?F.m_next=X:E.m_fixtureList=X,E.m_fixtureCount--,k.m_next=R.m_fixtureList,R.m_fixtureList=k,R.m_fixtureCount++,k.m_body=R,k=X}else F=k,k=k.m_next;E.ResetMassData(),R.ResetMassData();var Z=E.GetWorldCenter(),V=R.GetWorldCenter(),Y=t.AddVV(b,t.CrossFV(W,t.SubtractVV(Z,S))),$=t.AddVV(b,t.CrossFV(W,t.SubtractVV(V,S)));return E.SetLinearVelocity(Y),R.SetLinearVelocity($),E.SetAngularVelocity(W),R.SetAngularVelocity(W),E.SynchronizeFixtures(),R.SynchronizeFixtures(),R},m.prototype.Merge=function(C){var b;for(b=C.m_fixtureList;b;){var W=b.m_next;C.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=E,b=W}S.m_fixtureCount=0;var S=this||window,E=C;S.GetWorldCenter(),E.GetWorldCenter(),S.GetLinearVelocity().Copy(),E.GetLinearVelocity().Copy(),S.GetAngularVelocity(),E.GetAngularVelocity(),S.ResetMassData(),this.SynchronizeFixtures()},m.prototype.GetMass=function(){return this.m_mass},m.prototype.GetInertia=function(){return this.m_I},m.prototype.GetMassData=function(C){C.mass=this.m_mass,C.I=this.m_I,C.center.SetV(this.m_sweep.localCenter)},m.prototype.SetMassData=function(C){if(o.b2Assert(this.m_world.IsLocked()==!1),this.m_world.IsLocked()!=!0&&this.m_type==m.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=C.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,C.I>0&&!(this.m_flags&m.e_fixedRotationFlag)&&(this.m_I=C.I-this.m_mass*(C.center.x*C.center.x+C.center.y*C.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(C.center),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x)}},m.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),!(this.m_type==m.b2_staticBody||this.m_type==m.b2_kinematicBody)){for(var C=n.Make(0,0),b=this.m_fixtureList;b;b=b.m_next)if(b.m_density!=0){var W=b.GetMassData();this.m_mass+=W.mass,C.x+=W.center.x*W.mass,C.y+=W.center.y*W.mass,this.m_I+=W.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,C.x*=this.m_invMass,C.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!(this.m_flags&m.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(C.x*C.x+C.y*C.y),this.m_I*=this.m_inertiaScale,o.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var S=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(C),this.m_sweep.c0.SetV(t.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-S.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-S.x)}},m.prototype.GetWorldPoint=function(C){var b=this.m_xf.R,W=new n(b.col1.x*C.x+b.col2.x*C.y,b.col1.y*C.x+b.col2.y*C.y);return W.x+=this.m_xf.position.x,W.y+=this.m_xf.position.y,W},m.prototype.GetWorldVector=function(C){return t.MulMV(this.m_xf.R,C)},m.prototype.GetLocalPoint=function(C){return t.MulXT(this.m_xf,C)},m.prototype.GetLocalVector=function(C){return t.MulTMV(this.m_xf.R,C)},m.prototype.GetLinearVelocityFromWorldPoint=function(C){return new n(this.m_linearVelocity.x-this.m_angularVelocity*(C.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(C.x-this.m_sweep.c.x))},m.prototype.GetLinearVelocityFromLocalPoint=function(C){var b=this.m_xf.R,W=new n(b.col1.x*C.x+b.col2.x*C.y,b.col1.y*C.x+b.col2.y*C.y);return W.x+=this.m_xf.position.x,W.y+=this.m_xf.position.y,new n(this.m_linearVelocity.x-this.m_angularVelocity*(W.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(W.x-this.m_sweep.c.x))},m.prototype.GetLinearDamping=function(){return this.m_linearDamping},m.prototype.SetLinearDamping=function(C){C===void 0&&(C=0),this.m_linearDamping=C},m.prototype.GetAngularDamping=function(){return this.m_angularDamping},m.prototype.SetAngularDamping=function(C){C===void 0&&(C=0),this.m_angularDamping=C},m.prototype.SetType=function(C){if(C===void 0&&(C=0),this.m_type!=C){this.m_type=C,this.ResetMassData(),this.m_type==m.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},m.prototype.GetType=function(){return this.m_type},m.prototype.SetBullet=function(C){C?this.m_flags|=m.e_bulletFlag:this.m_flags&=~m.e_bulletFlag},m.prototype.IsBullet=function(){return(this.m_flags&m.e_bulletFlag)==m.e_bulletFlag},m.prototype.SetSleepingAllowed=function(C){C?this.m_flags|=m.e_allowSleepFlag:(this.m_flags&=~m.e_allowSleepFlag,this.SetAwake(!0))},m.prototype.SetAwake=function(C){C?(this.m_flags|=m.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~m.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},m.prototype.IsAwake=function(){return(this.m_flags&m.e_awakeFlag)==m.e_awakeFlag},m.prototype.SetFixedRotation=function(C){C?this.m_flags|=m.e_fixedRotationFlag:this.m_flags&=~m.e_fixedRotationFlag,this.ResetMassData()},m.prototype.IsFixedRotation=function(){return(this.m_flags&m.e_fixedRotationFlag)==m.e_fixedRotationFlag},m.prototype.SetActive=function(C){if(C!=this.IsActive()){var b,W;if(C)for(this.m_flags|=m.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,W=this.m_fixtureList;W;W=W.m_next)W.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~m.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,W=this.m_fixtureList;W;W=W.m_next)W.DestroyProxy(b);for(var S=this.m_contactList;S;){var E=S;S=S.next,this.m_world.m_contactManager.Destroy(E.contact)}this.m_contactList=null}}},m.prototype.IsActive=function(){return(this.m_flags&m.e_activeFlag)==m.e_activeFlag},m.prototype.IsSleepingAllowed=function(){return(this.m_flags&m.e_allowSleepFlag)==m.e_allowSleepFlag},m.prototype.GetFixtureList=function(){return this.m_fixtureList},m.prototype.GetJointList=function(){return this.m_jointList},m.prototype.GetControllerList=function(){return this.m_controllerList},m.prototype.GetContactList=function(){return this.m_contactList},m.prototype.GetNext=function(){return this.m_next},m.prototype.GetUserData=function(){return this.m_userData},m.prototype.SetUserData=function(C){this.m_userData=C},m.prototype.GetWorld=function(){return this.m_world},m.prototype.b2Body=function(C,b){this.m_flags=0,C.bullet&&(this.m_flags|=m.e_bulletFlag),C.fixedRotation&&(this.m_flags|=m.e_fixedRotationFlag),C.allowSleep&&(this.m_flags|=m.e_allowSleepFlag),C.awake&&(this.m_flags|=m.e_awakeFlag),C.active&&(this.m_flags|=m.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(C.position),this.m_xf.R.Set(C.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=C.angle;var W=this.m_xf.R,S=this.m_sweep.localCenter;this.m_sweep.c.x=W.col1.x*S.x+W.col2.x*S.y,this.m_sweep.c.y=W.col1.y*S.x+W.col2.y*S.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(C.linearVelocity),this.m_angularVelocity=C.angularVelocity,this.m_linearDamping=C.linearDamping,this.m_angularDamping=C.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=C.type,this.m_type==m.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=C.inertiaScale,this.m_userData=C.userData,this.m_fixtureList=null,this.m_fixtureCount=0},m.prototype.SynchronizeFixtures=function(){var C=m.s_xf1;C.R.Set(this.m_sweep.a0);var b=C.R,W=this.m_sweep.localCenter;C.position.x=this.m_sweep.c0.x-(b.col1.x*W.x+b.col2.x*W.y),C.position.y=this.m_sweep.c0.y-(b.col1.y*W.x+b.col2.y*W.y);var S,E=this.m_world.m_contactManager.m_broadPhase;for(S=this.m_fixtureList;S;S=S.m_next)S.Synchronize(E,C,this.m_xf)},m.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var C=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(C.col1.x*b.x+C.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(C.col1.y*b.x+C.col2.y*b.y)},m.prototype.ShouldCollide=function(C){if(this.m_type!=m.b2_dynamicBody&&C.m_type!=m.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==C&&b.joint.m_collideConnected==!1)return!1;return!0},m.prototype.Advance=function(C){C===void 0&&(C=0),this.m_sweep.Advance(C),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new r,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),v.b2BodyDef=function(){this.position=new n,this.linearVelocity=new n},v.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=m.b2_staticBody,this.active=!0,this.inertiaScale=1},A.b2ContactFilter=function(){},A.prototype.ShouldCollide=function(C,b){var W=C.GetFilterData(),S=b.GetFilterData();if(W.groupIndex==S.groupIndex&&W.groupIndex!=0)return W.groupIndex>0;var E=(W.maskBits&S.categoryBits)!=0&&(W.categoryBits&S.maskBits)!=0;return E},A.prototype.RayCollide=function(C,b){return C?this.ShouldCollide(C instanceof K?C:null,b):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new A}),D.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(o.b2_maxManifoldPoints)},N.b2ContactListener=function(){},N.prototype.BeginContact=function(C){},N.prototype.EndContact=function(C){},N.prototype.PreSolve=function(C,b){},N.prototype.PostSolve=function(C,b){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new N}),z.b2ContactManager=function(){},z.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=A.b2_defaultFilter,this.m_contactListener=N.b2_defaultListener,this.m_contactFactory=new w(this.m_allocator),this.m_broadPhase=new l},z.prototype.AddPair=function(C,b){var W=C instanceof K?C:null,S=b instanceof K?b:null,E=W.GetBody(),R=S.GetBody();if(E!=R){for(var F=R.GetContactList();F;){if(F.other==E){var k=F.contact.GetFixtureA(),X=F.contact.GetFixtureB();if(k==W&&X==S||k==S&&X==W)return}F=F.next}if(R.ShouldCollide(E)!=!1&&this.m_contactFilter.ShouldCollide(W,S)!=!1){var Z=this.m_contactFactory.Create(W,S);W=Z.GetFixtureA(),S=Z.GetFixtureB(),E=W.m_body,R=S.m_body,Z.m_prev=null,Z.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=Z),this.m_world.m_contactList=Z,Z.m_nodeA.contact=Z,Z.m_nodeA.other=R,Z.m_nodeA.prev=null,Z.m_nodeA.next=E.m_contactList,E.m_contactList!=null&&(E.m_contactList.prev=Z.m_nodeA),E.m_contactList=Z.m_nodeA,Z.m_nodeB.contact=Z,Z.m_nodeB.other=E,Z.m_nodeB.prev=null,Z.m_nodeB.next=R.m_contactList,R.m_contactList!=null&&(R.m_contactList.prev=Z.m_nodeB),R.m_contactList=Z.m_nodeB,++this.m_world.m_contactCount}}},z.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},z.prototype.Destroy=function(C){var b=C.GetFixtureA(),W=C.GetFixtureB(),S=b.GetBody(),E=W.GetBody();C.IsTouching()&&this.m_contactListener.EndContact(C),C.m_prev&&(C.m_prev.m_next=C.m_next),C.m_next&&(C.m_next.m_prev=C.m_prev),C==this.m_world.m_contactList&&(this.m_world.m_contactList=C.m_next),C.m_nodeA.prev&&(C.m_nodeA.prev.next=C.m_nodeA.next),C.m_nodeA.next&&(C.m_nodeA.next.prev=C.m_nodeA.prev),C.m_nodeA==S.m_contactList&&(S.m_contactList=C.m_nodeA.next),C.m_nodeB.prev&&(C.m_nodeB.prev.next=C.m_nodeB.next),C.m_nodeB.next&&(C.m_nodeB.next.prev=C.m_nodeB.prev),C.m_nodeB==E.m_contactList&&(E.m_contactList=C.m_nodeB.next),this.m_contactFactory.Destroy(C),--this.m_contactCount},z.prototype.Collide=function(){for(var C=this.m_world.m_contactList;C;){var b=C.GetFixtureA(),W=C.GetFixtureB(),S=b.GetBody(),E=W.GetBody();if(S.IsAwake()==!1&&E.IsAwake()==!1){C=C.GetNext();continue}if(C.m_flags&G.e_filterFlag){if(E.ShouldCollide(S)==!1){var R=C;C=R.GetNext(),this.Destroy(R);continue}if(this.m_contactFilter.ShouldCollide(b,W)==!1){R=C,C=R.GetNext(),this.Destroy(R);continue}C.m_flags&=~G.e_filterFlag}var F=b.m_proxy,k=W.m_proxy,X=this.m_broadPhase.TestOverlap(F,k);if(X==!1){R=C,C=R.GetNext(),this.Destroy(R);continue}C.Update(this.m_contactListener),C=C.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new c}),M.b2DebugDraw=function(){},M.prototype.b2DebugDraw=function(){},M.prototype.SetFlags=function(C){},M.prototype.GetFlags=function(){},M.prototype.AppendFlags=function(C){},M.prototype.ClearFlags=function(C){},M.prototype.SetSprite=function(C){},M.prototype.GetSprite=function(){},M.prototype.SetDrawScale=function(C){},M.prototype.GetDrawScale=function(){},M.prototype.SetLineThickness=function(C){},M.prototype.GetLineThickness=function(){},M.prototype.SetAlpha=function(C){},M.prototype.GetAlpha=function(){},M.prototype.SetFillAlpha=function(C){},M.prototype.GetFillAlpha=function(){},M.prototype.SetXFormScale=function(C){},M.prototype.GetXFormScale=function(){},M.prototype.DrawPolygon=function(C,b,W){},M.prototype.DrawSolidPolygon=function(C,b,W){},M.prototype.DrawCircle=function(C,b,W){},M.prototype.DrawSolidCircle=function(C,b,W,S){},M.prototype.DrawSegment=function(C,b,W){},M.prototype.DrawTransform=function(C){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),J.b2DestructionListener=function(){},J.prototype.SayGoodbyeJoint=function(C){},J.prototype.SayGoodbyeFixture=function(C){},U.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},U.prototype.Copy=function(){var C=new U;return C.categoryBits=this.categoryBits,C.maskBits=this.maskBits,C.groupIndex=this.groupIndex,C},K.b2Fixture=function(){this.m_filter=new U},K.prototype.GetType=function(){return this.m_shape.GetType()},K.prototype.GetShape=function(){return this.m_shape},K.prototype.SetSensor=function(C){if(this.m_isSensor!=C&&(this.m_isSensor=C,this.m_body!=null))for(var b=this.m_body.GetContactList();b;){var W=b.contact,S=W.GetFixtureA(),E=W.GetFixtureB();(S==this||E==this)&&W.SetSensor(S.IsSensor()||E.IsSensor()),b=b.next}},K.prototype.IsSensor=function(){return this.m_isSensor},K.prototype.SetFilterData=function(C){if(this.m_filter=C.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var W=b.contact,S=W.GetFixtureA(),E=W.GetFixtureB();(S==this||E==this)&&W.FlagForFiltering(),b=b.next}},K.prototype.GetFilterData=function(){return this.m_filter.Copy()},K.prototype.GetBody=function(){return this.m_body},K.prototype.GetNext=function(){return this.m_next},K.prototype.GetUserData=function(){return this.m_userData},K.prototype.SetUserData=function(C){this.m_userData=C},K.prototype.TestPoint=function(C){return this.m_shape.TestPoint(this.m_body.GetTransform(),C)},K.prototype.RayCast=function(C,b){return this.m_shape.RayCast(C,b,this.m_body.GetTransform())},K.prototype.GetMassData=function(C){return C===void 0&&(C=null),C==null&&(C=new f),this.m_shape.ComputeMass(C,this.m_density),C},K.prototype.SetDensity=function(C){C===void 0&&(C=0),this.m_density=C},K.prototype.GetDensity=function(){return this.m_density},K.prototype.GetFriction=function(){return this.m_friction},K.prototype.SetFriction=function(C){C===void 0&&(C=0),this.m_friction=C},K.prototype.GetRestitution=function(){return this.m_restitution},K.prototype.SetRestitution=function(C){C===void 0&&(C=0),this.m_restitution=C},K.prototype.GetAABB=function(){return this.m_aabb},K.prototype.b2Fixture=function(){this.m_aabb=new a,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},K.prototype.Create=function(C,b,W){this.m_userData=W.userData,this.m_friction=W.friction,this.m_restitution=W.restitution,this.m_body=C,this.m_next=null,this.m_filter=W.filter.Copy(),this.m_isSensor=W.isSensor,this.m_shape=W.shape.Copy(),this.m_density=W.density},K.prototype.Destroy=function(){this.m_shape=null},K.prototype.CreateProxy=function(C,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=C.CreateProxy(this.m_aabb,this)},K.prototype.DestroyProxy=function(C){this.m_proxy!=null&&(C.DestroyProxy(this.m_proxy),this.m_proxy=null)},K.prototype.Synchronize=function(C,b,W){if(this.m_proxy){var S=new a,E=new a;this.m_shape.ComputeAABB(S,b),this.m_shape.ComputeAABB(E,W),this.m_aabb.Combine(S,E);var R=t.SubtractVV(W.position,b.position);C.MoveProxy(this.m_proxy,this.m_aabb,R)}},tt.b2FixtureDef=function(){this.filter=new U},tt.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},rt.b2Island=function(){},rt.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},rt.prototype.Initialize=function(C,b,W,S,E,R){C===void 0&&(C=0),b===void 0&&(b=0),W===void 0&&(W=0);var F=0;for(this.m_bodyCapacity=C,this.m_contactCapacity=b,this.m_jointCapacity=W,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=S,this.m_listener=E,this.m_contactSolver=R,F=this.m_bodies.length;F<C;F++)this.m_bodies[F]=null;for(F=this.m_contacts.length;F<b;F++)this.m_contacts[F]=null;for(F=this.m_joints.length;F<W;F++)this.m_joints[F]=null},rt.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},rt.prototype.Solve=function(C,b,W){var S=0,E=0,R,F;for(S=0;S<this.m_bodyCount;++S)R=this.m_bodies[S],R.GetType()==m.b2_dynamicBody&&(R.m_linearVelocity.x+=C.dt*(b.x+R.m_invMass*R.m_force.x),R.m_linearVelocity.y+=C.dt*(b.y+R.m_invMass*R.m_force.y),R.m_angularVelocity+=C.dt*R.m_invI*R.m_torque,R.m_linearVelocity.Multiply(t.Clamp(1-C.dt*R.m_linearDamping,0,1)),R.m_angularVelocity*=t.Clamp(1-C.dt*R.m_angularDamping,0,1));this.m_contactSolver.Initialize(C,this.m_contacts,this.m_contactCount,this.m_allocator);var k=this.m_contactSolver;for(k.InitVelocityConstraints(C),S=0;S<this.m_jointCount;++S)F=this.m_joints[S],F.InitVelocityConstraints(C);for(S=0;S<C.velocityIterations;++S){for(E=0;E<this.m_jointCount;++E)F=this.m_joints[E],F.SolveVelocityConstraints(C);k.SolveVelocityConstraints()}for(S=0;S<this.m_jointCount;++S)F=this.m_joints[S],F.FinalizeVelocityConstraints();for(k.FinalizeVelocityConstraints(),S=0;S<this.m_bodyCount;++S)if(R=this.m_bodies[S],R.GetType()!=m.b2_staticBody){var X=C.dt*R.m_linearVelocity.x,Z=C.dt*R.m_linearVelocity.y;X*X+Z*Z>o.b2_maxTranslationSquared&&(R.m_linearVelocity.Normalize(),R.m_linearVelocity.x*=o.b2_maxTranslation*C.inv_dt,R.m_linearVelocity.y*=o.b2_maxTranslation*C.inv_dt);var V=C.dt*R.m_angularVelocity;V*V>o.b2_maxRotationSquared&&(R.m_angularVelocity<0?R.m_angularVelocity=-o.b2_maxRotation*C.inv_dt:R.m_angularVelocity=o.b2_maxRotation*C.inv_dt),R.m_sweep.c0.SetV(R.m_sweep.c),R.m_sweep.a0=R.m_sweep.a,R.m_sweep.c.x+=C.dt*R.m_linearVelocity.x,R.m_sweep.c.y+=C.dt*R.m_linearVelocity.y,R.m_sweep.a+=C.dt*R.m_angularVelocity,R.SynchronizeTransform()}for(S=0;S<C.positionIterations;++S){var Y=k.SolvePositionConstraints(o.b2_contactBaumgarte),$=!0;for(E=0;E<this.m_jointCount;++E){F=this.m_joints[E];var et=F.SolvePositionConstraints(o.b2_contactBaumgarte);$=$&&et}if(Y&&$)break}if(this.Report(k.m_constraints),W){var ct=Number.MAX_VALUE,ht=o.b2_linearSleepTolerance*o.b2_linearSleepTolerance,pt=o.b2_angularSleepTolerance*o.b2_angularSleepTolerance;for(S=0;S<this.m_bodyCount;++S)R=this.m_bodies[S],R.GetType()!=m.b2_staticBody&&(R.m_flags&m.e_allowSleepFlag||(R.m_sleepTime=0,ct=0),!(R.m_flags&m.e_allowSleepFlag)||R.m_angularVelocity*R.m_angularVelocity>pt||t.Dot(R.m_linearVelocity,R.m_linearVelocity)>ht?(R.m_sleepTime=0,ct=0):(R.m_sleepTime+=C.dt,ct=t.Min(ct,R.m_sleepTime)));if(ct>=o.b2_timeToSleep)for(S=0;S<this.m_bodyCount;++S)R=this.m_bodies[S],R.SetAwake(!1)}},rt.prototype.SolveTOI=function(C){var b=0,W=0;this.m_contactSolver.Initialize(C,this.m_contacts,this.m_contactCount,this.m_allocator);var S=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(C);for(b=0;b<C.velocityIterations;++b)for(S.SolveVelocityConstraints(),W=0;W<this.m_jointCount;++W)this.m_joints[W].SolveVelocityConstraints(C);for(b=0;b<this.m_bodyCount;++b){var E=this.m_bodies[b];if(E.GetType()!=m.b2_staticBody){var R=C.dt*E.m_linearVelocity.x,F=C.dt*E.m_linearVelocity.y;R*R+F*F>o.b2_maxTranslationSquared&&(E.m_linearVelocity.Normalize(),E.m_linearVelocity.x*=o.b2_maxTranslation*C.inv_dt,E.m_linearVelocity.y*=o.b2_maxTranslation*C.inv_dt);var k=C.dt*E.m_angularVelocity;k*k>o.b2_maxRotationSquared&&(E.m_angularVelocity<0?E.m_angularVelocity=-o.b2_maxRotation*C.inv_dt:E.m_angularVelocity=o.b2_maxRotation*C.inv_dt),E.m_sweep.c0.SetV(E.m_sweep.c),E.m_sweep.a0=E.m_sweep.a,E.m_sweep.c.x+=C.dt*E.m_linearVelocity.x,E.m_sweep.c.y+=C.dt*E.m_linearVelocity.y,E.m_sweep.a+=C.dt*E.m_angularVelocity,E.SynchronizeTransform()}}var X=.75;for(b=0;b<C.positionIterations;++b){var Z=S.SolvePositionConstraints(X),V=!0;for(W=0;W<this.m_jointCount;++W){var Y=this.m_joints[W].SolvePositionConstraints(o.b2_contactBaumgarte);V=V&&Y}if(Z&&V)break}this.Report(S.m_constraints)},rt.prototype.Report=function(C){if(this.m_listener!=null)for(var b=0;b<this.m_contactCount;++b){for(var W=this.m_contacts[b],S=C[b],E=0;E<S.pointCount;++E)rt.s_impulse.normalImpulses[E]=S.points[E].normalImpulse,rt.s_impulse.tangentImpulses[E]=S.points[E].tangentImpulse;this.m_listener.PostSolve(W,rt.s_impulse)}},rt.prototype.AddBody=function(C){C.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=C},rt.prototype.AddContact=function(C){this.m_contacts[this.m_contactCount++]=C},rt.prototype.AddJoint=function(C){this.m_joints[this.m_jointCount++]=C},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new D}),I.b2TimeStep=function(){},I.prototype.Set=function(C){this.dt=C.dt,this.inv_dt=C.inv_dt,this.positionIterations=C.positionIterations,this.velocityIterations=C.velocityIterations,this.warmStarting=C.warmStarting},L.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new z,this.m_contactSolver=new O,this.m_island=new rt},L.prototype.b2World=function(C,b){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,L.m_warmStarting=!0,L.m_continuousPhysics=!0,this.m_allowSleep=b,C.y=C.y,this.m_gravity=C,this.m_inv_dt0=0,this.m_contactManager.m_world=this||window;var W=new v;this.m_groundBody=this.CreateBody(W)},L.prototype.SetDestructionListener=function(C){this.m_destructionListener=C},L.prototype.SetContactFilter=function(C){this.m_contactManager.m_contactFilter=C},L.prototype.SetContactListener=function(C){this.m_contactManager.m_contactListener=C},L.prototype.SetDebugDraw=function(C){this.m_debugDraw=C},L.prototype.SetBroadPhase=function(C){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=C;for(var W=this.m_bodyList;W;W=W.m_next)for(var S=W.m_fixtureList;S;S=S.m_next)S.m_proxy=C.CreateProxy(b.GetFatAABB(S.m_proxy),S)},L.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},L.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},L.prototype.CreateBody=function(C){if(this.IsLocked()==!0)return null;var b=new m(C,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},L.prototype.DestroyBody=function(C){if(this.IsLocked()!=!0){for(var b=C.m_jointList;b;){var W=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(W.joint),this.DestroyJoint(W.joint)}for(var S=C.m_controllerList;S;){var E=S;S=S.nextController,E.controller.RemoveBody(C)}for(var R=C.m_contactList;R;){var F=R;R=R.next,this.m_contactManager.Destroy(F.contact)}C.m_contactList=null;for(var k=C.m_fixtureList;k;){var X=k;k=k.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(X),X.DestroyProxy(this.m_contactManager.m_broadPhase),X.Destroy()}C.m_fixtureList=null,C.m_fixtureCount=0,C.m_prev&&(C.m_prev.m_next=C.m_next),C.m_next&&(C.m_next.m_prev=C.m_prev),C==this.m_bodyList&&(this.m_bodyList=C.m_next),--this.m_bodyCount}},L.prototype.CreateJoint=function(C){var b=j.Create(C,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var W=C.bodyA,S=C.bodyB;if(C.collideConnected==!1)for(var E=S.GetContactList();E;)E.other==W&&E.contact.FlagForFiltering(),E=E.next;return b},L.prototype.DestroyJoint=function(C){var b=C.m_collideConnected;C.m_prev&&(C.m_prev.m_next=C.m_next),C.m_next&&(C.m_next.m_prev=C.m_prev),C==this.m_jointList&&(this.m_jointList=C.m_next);var W=C.m_bodyA,S=C.m_bodyB;if(W.SetAwake(!0),S.SetAwake(!0),C.m_edgeA.prev&&(C.m_edgeA.prev.next=C.m_edgeA.next),C.m_edgeA.next&&(C.m_edgeA.next.prev=C.m_edgeA.prev),C.m_edgeA==W.m_jointList&&(W.m_jointList=C.m_edgeA.next),C.m_edgeA.prev=null,C.m_edgeA.next=null,C.m_edgeB.prev&&(C.m_edgeB.prev.next=C.m_edgeB.next),C.m_edgeB.next&&(C.m_edgeB.next.prev=C.m_edgeB.prev),C.m_edgeB==S.m_jointList&&(S.m_jointList=C.m_edgeB.next),C.m_edgeB.prev=null,C.m_edgeB.next=null,j.Destroy(C,null),--this.m_jointCount,b==!1)for(var E=S.GetContactList();E;)E.other==W&&E.contact.FlagForFiltering(),E=E.next},L.prototype.AddController=function(C){return C.m_next=this.m_controllerList,C.m_prev=null,this.m_controllerList=C,C.m_world=this||window,this.m_controllerCount++,C},L.prototype.RemoveController=function(C){C.m_prev&&(C.m_prev.m_next=C.m_next),C.m_next&&(C.m_next.m_prev=C.m_prev),this.m_controllerList==C&&(this.m_controllerList=C.m_next),this.m_controllerCount--},L.prototype.CreateController=function(C){if(C.m_world!=this)throw new Error("Controller can only be a member of one world");return C.m_next=this.m_controllerList,C.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=C),this.m_controllerList=C,++this.m_controllerCount,C.m_world=this||window,C},L.prototype.DestroyController=function(C){C.Clear(),C.m_next&&(C.m_next.m_prev=C.m_prev),C.m_prev&&(C.m_prev.m_next=C.m_next),C==this.m_controllerList&&(this.m_controllerList=C.m_next),--this.m_controllerCount},L.prototype.SetWarmStarting=function(C){L.m_warmStarting=C},L.prototype.SetContinuousPhysics=function(C){L.m_continuousPhysics=C},L.prototype.GetBodyCount=function(){return this.m_bodyCount},L.prototype.GetJointCount=function(){return this.m_jointCount},L.prototype.GetContactCount=function(){return this.m_contactCount},L.prototype.SetGravity=function(C){this.m_gravity=C},L.prototype.GetGravity=function(){return this.m_gravity},L.prototype.GetGroundBody=function(){return this.m_groundBody},L.prototype.Step=function(C,b,W){C===void 0&&(C=0),b===void 0&&(b=0),W===void 0&&(W=0),this.m_flags&L.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~L.e_newFixture),this.m_flags|=L.e_locked;var S=L.s_timestep2;S.dt=C,S.velocityIterations=b,S.positionIterations=W,C>0?S.inv_dt=1/C:S.inv_dt=0,S.dtRatio=this.m_inv_dt0*C,S.warmStarting=L.m_warmStarting,this.m_contactManager.Collide(),S.dt>0&&this.Solve(S),L.m_continuousPhysics&&S.dt>0&&this.SolveTOI(S),S.dt>0&&(this.m_inv_dt0=S.inv_dt),this.m_flags&=~L.e_locked},L.prototype.ClearForces=function(){for(var C=this.m_bodyList;C;C=C.m_next)C.m_force.SetZero(),C.m_torque=0},L.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var C=this.m_debugDraw.GetFlags(),b,W,S,E,R;new n,new n,new n;var F;new a,new a;var k=[new n,new n,new n,new n],X=new s(0,0,0);if(C&M.e_shapeBit)for(b=this.m_bodyList;b;b=b.m_next)for(F=b.m_xf,W=b.GetFixtureList();W;W=W.m_next)S=W.GetShape(),b.IsActive()==!1?(X.Set(.5,.5,.3),this.DrawShape(S,F,X)):b.GetType()==m.b2_staticBody?(X.Set(.5,.9,.5),this.DrawShape(S,F,X)):b.GetType()==m.b2_kinematicBody?(X.Set(.5,.5,.9),this.DrawShape(S,F,X)):b.IsAwake()==!1?(X.Set(.6,.6,.6),this.DrawShape(S,F,X)):(X.Set(.9,.7,.7),this.DrawShape(S,F,X));if(C&M.e_jointBit)for(E=this.m_jointList;E;E=E.m_next)this.DrawJoint(E);if(C&M.e_controllerBit)for(var Z=this.m_controllerList;Z;Z=Z.m_next)Z.Draw(this.m_debugDraw);if(C&M.e_pairBit){X.Set(.3,.9,.9);for(var V=this.m_contactManager.m_contactList;V;V=V.GetNext()){var Y=V.GetFixtureA(),$=V.GetFixtureB(),et=Y.GetAABB().GetCenter(),ct=$.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(et,ct,X)}}if(C&M.e_aabbBit){for(R=this.m_contactManager.m_broadPhase,k=[new n,new n,new n,new n],b=this.m_bodyList;b;b=b.GetNext())if(b.IsActive()!=!1)for(W=b.GetFixtureList();W;W=W.GetNext()){var ht=R.GetFatAABB(W.m_proxy);k[0].Set(ht.lowerBound.x,ht.lowerBound.y),k[1].Set(ht.upperBound.x,ht.lowerBound.y),k[2].Set(ht.upperBound.x,ht.upperBound.y),k[3].Set(ht.lowerBound.x,ht.upperBound.y),this.m_debugDraw.DrawPolygon(k,4,X)}}if(C&M.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)F=L.s_xf,F.R=b.m_xf.R,F.position=b.GetWorldCenter(),this.m_debugDraw.DrawTransform(F)}},L.prototype.QueryAABB=function(C,b){var W=this||window,S=W.m_contactManager.m_broadPhase;function E(R){return C(S.GetUserData(R))}S.Query(E,b)},L.prototype.QueryShape=function(C,b,W){var S=this||window;W===void 0&&(W=null),W==null&&(W=new r,W.SetIdentity());var E=S.m_contactManager.m_broadPhase;function R(k){var X=E.GetUserData(k)instanceof K?E.GetUserData(k):null;return x.TestOverlap(b,W,X.GetShape(),X.GetBody().GetTransform())?C(X):!0}var F=new a;b.ComputeAABB(F,W),E.Query(R,F)},L.prototype.QueryPoint=function(C,b){var W=this||window,S=W.m_contactManager.m_broadPhase;function E(F){var k=S.GetUserData(F)instanceof K?S.GetUserData(F):null;return k.TestPoint(b)?C(k):!0}var R=new a;R.lowerBound.Set(b.x-o.b2_linearSlop,b.y-o.b2_linearSlop),R.upperBound.Set(b.x+o.b2_linearSlop,b.y+o.b2_linearSlop),S.Query(E,R)},L.prototype.RayCast=function(C,b,W){var S=this||window,E=S.m_contactManager.m_broadPhase,R=new u;function F(X,Z){var V=E.GetUserData(Z),Y=V instanceof K?V:null,$=Y.RayCast(R,X);if($){var et=R.fraction,ct=new n((1-et)*b.x+et*W.x,(1-et)*b.y+et*W.y);return C(Y,ct,R.normal,et)}return X.maxFraction}var k=new h(b,W);E.RayCast(F,k)},L.prototype.RayCastOne=function(C,b){var W=this||window,S;function E(R,F,k,X){return X===void 0&&(X=0),S=R,X}return W.RayCast(E,C,b),S},L.prototype.RayCastAll=function(C,b){var W=this||window,S=new Vector;function E(R,F,k,X){return S[S.length]=R,1}return W.RayCast(E,C,b),S},L.prototype.GetBodyList=function(){return this.m_bodyList},L.prototype.GetJointList=function(){return this.m_jointList},L.prototype.GetContactList=function(){return this.m_contactList},L.prototype.IsLocked=function(){return(this.m_flags&L.e_locked)>0},L.prototype.Solve=function(C){for(var b,W=this.m_controllerList;W;W=W.m_next)W.Step(C);var S=this.m_island;for(S.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~m.e_islandFlag;for(var E=this.m_contactList;E;E=E.m_next)E.m_flags&=~G.e_islandFlag;for(var R=this.m_jointList;R;R=R.m_next)R.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var F=this.s_stack,k=this.m_bodyList;k;k=k.m_next)if(!(k.m_flags&m.e_islandFlag)&&!(k.IsAwake()==!1||k.IsActive()==!1)&&k.GetType()!=m.b2_staticBody){S.Clear();var X=0;for(F[X++]=k,k.m_flags|=m.e_islandFlag;X>0;)if(b=F[--X],S.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()!=m.b2_staticBody){for(var Z,V=b.m_contactList;V;V=V.next)V.contact.m_flags&G.e_islandFlag||V.contact.IsSensor()==!0||V.contact.IsEnabled()==!1||V.contact.IsTouching()==!1||(S.AddContact(V.contact),V.contact.m_flags|=G.e_islandFlag,Z=V.other,!(Z.m_flags&m.e_islandFlag)&&(F[X++]=Z,Z.m_flags|=m.e_islandFlag));for(var Y=b.m_jointList;Y;Y=Y.next)Y.joint.m_islandFlag!=!0&&(Z=Y.other,Z.IsActive()!=!1&&(S.AddJoint(Y.joint),Y.joint.m_islandFlag=!0,!(Z.m_flags&m.e_islandFlag)&&(F[X++]=Z,Z.m_flags|=m.e_islandFlag)))}S.Solve(C,this.m_gravity,this.m_allowSleep);for(var $=0;$<S.m_bodyCount;++$)b=S.m_bodies[$],b.GetType()==m.b2_staticBody&&(b.m_flags&=~m.e_islandFlag)}for($=0;$<F.length&&F[$];++$)F[$]=null;for(b=this.m_bodyList;b;b=b.m_next)b.IsAwake()==!1||b.IsActive()==!1||b.GetType()!=m.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},L.prototype.SolveTOI=function(C){var b,W,S,E,R,F,k,X=this.m_island;X.Initialize(this.m_bodyCount,o.b2_maxTOIContactsPerIsland,o.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var Z=L.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~m.e_islandFlag,b.m_sweep.t0=0;var V;for(V=this.m_contactList;V;V=V.m_next)V.m_flags&=~(G.e_toiFlag|G.e_islandFlag);for(k=this.m_jointList;k;k=k.m_next)k.m_islandFlag=!1;for(;;){var Y=null,$=1;for(V=this.m_contactList;V;V=V.m_next)if(!(V.IsSensor()==!0||V.IsEnabled()==!1||V.IsContinuous()==!1)){var et=1;if(V.m_flags&G.e_toiFlag)et=V.m_toi;else{if(W=V.m_fixtureA,S=V.m_fixtureB,E=W.m_body,R=S.m_body,(E.GetType()!=m.b2_dynamicBody||E.IsAwake()==!1)&&(R.GetType()!=m.b2_dynamicBody||R.IsAwake()==!1))continue;var ct=E.m_sweep.t0;E.m_sweep.t0<R.m_sweep.t0?(ct=R.m_sweep.t0,E.m_sweep.Advance(ct)):R.m_sweep.t0<E.m_sweep.t0&&(ct=E.m_sweep.t0,R.m_sweep.Advance(ct)),et=V.ComputeTOI(E.m_sweep,R.m_sweep),o.b2Assert(0<=et&&et<=1),et>0&&et<1&&(et=(1-et)*ct+et,et>1&&(et=1)),V.m_toi=et,V.m_flags|=G.e_toiFlag}Number.MIN_VALUE<et&&et<$&&(Y=V,$=et)}if(Y==null||1-100*Number.MIN_VALUE<$)break;if(W=Y.m_fixtureA,S=Y.m_fixtureB,E=W.m_body,R=S.m_body,L.s_backupA.Set(E.m_sweep),L.s_backupB.Set(R.m_sweep),E.Advance($),R.Advance($),Y.Update(this.m_contactManager.m_contactListener),Y.m_flags&=~G.e_toiFlag,Y.IsSensor()==!0||Y.IsEnabled()==!1){E.m_sweep.Set(L.s_backupA),R.m_sweep.Set(L.s_backupB),E.SynchronizeTransform(),R.SynchronizeTransform();continue}if(Y.IsTouching()!=!1){var ht=E;ht.GetType()!=m.b2_dynamicBody&&(ht=R),X.Clear();var pt=0,mt=0;for(Z[pt+mt++]=ht,ht.m_flags|=m.e_islandFlag;mt>0;)if(b=Z[pt++],--mt,X.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()==m.b2_dynamicBody){for(F=b.m_contactList;F&&X.m_contactCount!=X.m_contactCapacity;F=F.next)if(!(F.contact.m_flags&G.e_islandFlag)&&!(F.contact.IsSensor()==!0||F.contact.IsEnabled()==!1||F.contact.IsTouching()==!1)){X.AddContact(F.contact),F.contact.m_flags|=G.e_islandFlag;var dt=F.other;dt.m_flags&m.e_islandFlag||(dt.GetType()!=m.b2_staticBody&&(dt.Advance($),dt.SetAwake(!0)),Z[pt+mt]=dt,++mt,dt.m_flags|=m.e_islandFlag)}for(var xt=b.m_jointList;xt;xt=xt.next)X.m_jointCount!=X.m_jointCapacity&&xt.joint.m_islandFlag!=!0&&(dt=xt.other,dt.IsActive()!=!1&&(X.AddJoint(xt.joint),xt.joint.m_islandFlag=!0,!(dt.m_flags&m.e_islandFlag)&&(dt.GetType()!=m.b2_staticBody&&(dt.Advance($),dt.SetAwake(!0)),Z[pt+mt]=dt,++mt,dt.m_flags|=m.e_islandFlag)))}var Tt=L.s_timestep;Tt.warmStarting=!1,Tt.dt=(1-$)*C.dt,Tt.inv_dt=1/Tt.dt,Tt.dtRatio=0,Tt.velocityIterations=C.velocityIterations,Tt.positionIterations=C.positionIterations,X.SolveTOI(Tt);var lt=0;for(lt=0;lt<X.m_bodyCount;++lt)if(b=X.m_bodies[lt],b.m_flags&=~m.e_islandFlag,b.IsAwake()!=!1&&b.GetType()==m.b2_dynamicBody)for(b.SynchronizeFixtures(),F=b.m_contactList;F;F=F.next)F.contact.m_flags&=~G.e_toiFlag;for(lt=0;lt<X.m_contactCount;++lt)V=X.m_contacts[lt],V.m_flags&=~(G.e_toiFlag|G.e_islandFlag);for(lt=0;lt<X.m_jointCount;++lt)k=X.m_joints[lt],k.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},L.prototype.DrawJoint=function(C){var b=C.GetBodyA(),W=C.GetBodyB(),S=b.m_xf,E=W.m_xf,R=S.position,F=E.position,k=C.GetAnchorA(),X=C.GetAnchorB(),Z=L.s_jointColor;switch(C.m_type){case j.e_distanceJoint:this.m_debugDraw.DrawSegment(k,X,Z);break;case j.e_pulleyJoint:{var V=C instanceof Q?C:null,Y=V.GetGroundAnchorA(),$=V.GetGroundAnchorB();this.m_debugDraw.DrawSegment(Y,k,Z),this.m_debugDraw.DrawSegment($,X,Z),this.m_debugDraw.DrawSegment(Y,$,Z)}break;case j.e_mouseJoint:this.m_debugDraw.DrawSegment(k,X,Z);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(R,k,Z),this.m_debugDraw.DrawSegment(k,X,Z),W!=this.m_groundBody&&this.m_debugDraw.DrawSegment(F,X,Z)}},L.prototype.DrawShape=function(C,b,W){switch(C.m_type){case x.e_circleShape:{var S=C instanceof _?C:null,E=t.MulX(b,S.m_p),R=S.m_radius,F=b.R.col1;this.m_debugDraw.DrawSolidCircle(E,R,F,W)}break;case x.e_polygonShape:{var k=0,X=C instanceof T?C:null,Z=parseInt(X.GetVertexCount()),V=X.GetVertices(),Y=new Vector(Z);for(k=0;k<Z;++k)Y[k]=t.MulX(b,V[k]);this.m_debugDraw.DrawSolidPolygon(Y,Z,W)}break;case x.e_edgeShape:{var $=C instanceof d?C:null;this.m_debugDraw.DrawSegment(t.MulX(b,$.GetVertex1()),t.MulX(b,$.GetVertex2()),W)}break}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new I,Box2D.Dynamics.b2World.s_xf=new r,Box2D.Dynamics.b2World.s_backupA=new e,Box2D.Dynamics.b2World.s_backupB=new e,Box2D.Dynamics.b2World.s_timestep=new I,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new s(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})})();(function(){var t=Box2D.Collision.Shapes.b2CircleShape;Box2D.Collision.Shapes.b2EdgeChainDef;var e=Box2D.Collision.Shapes.b2EdgeShape;Box2D.Collision.Shapes.b2MassData;var r=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,s=Box2D.Dynamics.Contacts.b2CircleContact,o=Box2D.Dynamics.Contacts.b2Contact,a=Box2D.Dynamics.Contacts.b2ContactConstraint,c=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,h=Box2D.Dynamics.Contacts.b2ContactFactory,u=Box2D.Dynamics.Contacts.b2ContactRegister,_=Box2D.Dynamics.Contacts.b2ContactResult,d=Box2D.Dynamics.Contacts.b2ContactSolver,f=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,T=Box2D.Dynamics.Contacts.b2NullContact,x=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,m=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,v=Box2D.Dynamics.Contacts.b2PolygonContact,A=Box2D.Dynamics.Contacts.b2PositionSolverManifold,D=Box2D.Dynamics.b2Body;Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island;var N=Box2D.Dynamics.b2TimeStep;Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal;var z=Box2D.Common.b2Settings,M=Box2D.Common.Math.b2Mat22;Box2D.Common.Math.b2Mat33;var J=Box2D.Common.Math.b2Math;Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform;var U=Box2D.Common.Math.b2Vec2;Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues;var K=Box2D.Collision.b2Collision,tt=Box2D.Collision.b2ContactID;Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair;var rt=Box2D.Collision.b2Manifold;Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex;var I=Box2D.Collision.b2TimeOfImpact,L=Box2D.Collision.b2TOIInput,G=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.inherit(s,Box2D.Dynamics.Contacts.b2Contact),s.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,s.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},s.Create=function(w){return new s},s.Destroy=function(w,O){},s.prototype.Reset=function(w,O){this.__super.Reset.call(this,w,O)},s.prototype.Evaluate=function(){var w=this.m_fixtureA.GetBody(),O=this.m_fixtureB.GetBody();K.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,w.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,O.m_xf)},o.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new rt,this.m_oldManifold=new rt},o.prototype.GetManifold=function(){return this.m_manifold},o.prototype.GetWorldManifold=function(w){var O=this.m_fixtureA.GetBody(),j=this.m_fixtureB.GetBody(),Q=this.m_fixtureA.GetShape(),C=this.m_fixtureB.GetShape();w.Initialize(this.m_manifold,O.GetTransform(),Q.m_radius,j.GetTransform(),C.m_radius)},o.prototype.IsTouching=function(){return(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag},o.prototype.IsContinuous=function(){return(this.m_flags&o.e_continuousFlag)==o.e_continuousFlag},o.prototype.SetSensor=function(w){w?this.m_flags|=o.e_sensorFlag:this.m_flags&=~o.e_sensorFlag},o.prototype.IsSensor=function(){return(this.m_flags&o.e_sensorFlag)==o.e_sensorFlag},o.prototype.SetEnabled=function(w){w?this.m_flags|=o.e_enabledFlag:this.m_flags&=~o.e_enabledFlag},o.prototype.IsEnabled=function(){return(this.m_flags&o.e_enabledFlag)==o.e_enabledFlag},o.prototype.GetNext=function(){return this.m_next},o.prototype.GetFixtureA=function(){return this.m_fixtureA},o.prototype.GetFixtureB=function(){return this.m_fixtureB},o.prototype.FlagForFiltering=function(){this.m_flags|=o.e_filterFlag},o.prototype.b2Contact=function(){},o.prototype.Reset=function(w,O){if(w===void 0&&(w=null),O===void 0&&(O=null),this.m_flags=o.e_enabledFlag,!w||!O){this.m_fixtureA=null,this.m_fixtureB=null;return}(w.IsSensor()||O.IsSensor())&&(this.m_flags|=o.e_sensorFlag);var j=w.GetBody(),Q=O.GetBody();(j.GetType()!=D.b2_dynamicBody||j.IsBullet()||Q.GetType()!=D.b2_dynamicBody||Q.IsBullet())&&(this.m_flags|=o.e_continuousFlag),this.m_fixtureA=w,this.m_fixtureB=O,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},o.prototype.Update=function(w){var O=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=O,this.m_flags|=o.e_enabledFlag;var j=!1,Q=(this.m_flags&o.e_touchingFlag)==o.e_touchingFlag,C=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body,W=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&o.e_sensorFlag){if(W){var S=this.m_fixtureA.GetShape(),E=this.m_fixtureB.GetShape(),R=C.GetTransform(),F=b.GetTransform();j=n.TestOverlap(S,R,E,F)}this.m_manifold.m_pointCount=0}else{if(C.GetType()!=D.b2_dynamicBody||C.IsBullet()||b.GetType()!=D.b2_dynamicBody||b.IsBullet()?this.m_flags|=o.e_continuousFlag:this.m_flags&=~o.e_continuousFlag,W){this.Evaluate(),j=this.m_manifold.m_pointCount>0;for(var k=0;k<this.m_manifold.m_pointCount;++k){var X=this.m_manifold.m_points[k];X.m_normalImpulse=0,X.m_tangentImpulse=0;for(var Z=X.m_id,V=0;V<this.m_oldManifold.m_pointCount;++V){var Y=this.m_oldManifold.m_points[V];if(Y.m_id.key==Z.key){X.m_normalImpulse=Y.m_normalImpulse,X.m_tangentImpulse=Y.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;j!=Q&&(C.SetAwake(!0),b.SetAwake(!0))}j?this.m_flags|=o.e_touchingFlag:this.m_flags&=~o.e_touchingFlag,Q==!1&&j==!0&&w.BeginContact(this),Q==!0&&j==!1&&w.EndContact(this),this.m_flags&o.e_sensorFlag||w.PreSolve(this,this.m_oldManifold)},o.prototype.Evaluate=function(){},o.prototype.ComputeTOI=function(w,O){return o.s_input.proxyA.Set(this.m_fixtureA.GetShape()),o.s_input.proxyB.Set(this.m_fixtureB.GetShape()),o.s_input.sweepA=w,o.s_input.sweepB=O,o.s_input.tolerance=z.b2_linearSlop,I.TimeOfImpact(o.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new L}),a.b2ContactConstraint=function(){this.localPlaneNormal=new U,this.localPoint=new U,this.normal=new U,this.normalMass=new M,this.K=new M},a.prototype.b2ContactConstraint=function(){this.points=new Vector(z.b2_maxManifoldPoints);for(var w=0;w<z.b2_maxManifoldPoints;w++)this.points[w]=new c},c.b2ContactConstraintPoint=function(){this.localPoint=new U,this.rA=new U,this.rB=new U},l.b2ContactEdge=function(){},h.b2ContactFactory=function(){},h.prototype.b2ContactFactory=function(w){this.m_allocator=w,this.InitializeRegisters()},h.prototype.AddType=function(w,O,j,Q){j===void 0&&(j=0),Q===void 0&&(Q=0),this.m_registers[j][Q].createFcn=w,this.m_registers[j][Q].destroyFcn=O,this.m_registers[j][Q].primary=!0,j!=Q&&(this.m_registers[Q][j].createFcn=w,this.m_registers[Q][j].destroyFcn=O,this.m_registers[Q][j].primary=!1)},h.prototype.InitializeRegisters=function(){this.m_registers=new Vector(n.e_shapeTypeCount);for(var w=0;w<n.e_shapeTypeCount;w++){this.m_registers[w]=new Vector(n.e_shapeTypeCount);for(var O=0;O<n.e_shapeTypeCount;O++)this.m_registers[w][O]=new u}this.AddType(s.Create,s.Destroy,n.e_circleShape,n.e_circleShape),this.AddType(x.Create,x.Destroy,n.e_polygonShape,n.e_circleShape),this.AddType(v.Create,v.Destroy,n.e_polygonShape,n.e_polygonShape),this.AddType(f.Create,f.Destroy,n.e_edgeShape,n.e_circleShape),this.AddType(m.Create,m.Destroy,n.e_polygonShape,n.e_edgeShape)},h.prototype.Create=function(w,O){var j=parseInt(w.GetType()),Q=parseInt(O.GetType()),C=this.m_registers[j][Q],b;if(C.pool)return b=C.pool,C.pool=b.m_next,C.poolCount--,b.Reset(w,O),b;var W=C.createFcn;return W!=null?C.primary?(b=W(this.m_allocator),b.Reset(w,O),b):(b=W(this.m_allocator),b.Reset(O,w),b):null},h.prototype.Destroy=function(w){w.m_manifold.m_pointCount>0&&(w.m_fixtureA.m_body.SetAwake(!0),w.m_fixtureB.m_body.SetAwake(!0));var O=parseInt(w.m_fixtureA.GetType()),j=parseInt(w.m_fixtureB.GetType()),Q=this.m_registers[O][j];Q.poolCount++,w.m_next=Q.pool,Q.pool=w;var C=Q.destroyFcn;C(w,this.m_allocator)},u.b2ContactRegister=function(){},_.b2ContactResult=function(){this.position=new U,this.normal=new U,this.id=new tt},d.b2ContactSolver=function(){this.m_step=new N,this.m_constraints=new Vector},d.prototype.b2ContactSolver=function(){},d.prototype.Initialize=function(w,O,j,Q){j===void 0&&(j=0);var C;this.m_step.Set(w),this.m_allocator=Q;var b=0;for(this.m_constraintCount=j;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new a;for(b=0;b<j;++b){C=O[b];var W=C.m_fixtureA,S=C.m_fixtureB,E=W.m_shape,R=S.m_shape,F=E.m_radius,k=R.m_radius,X=W.m_body,Z=S.m_body,V=C.GetManifold(),Y=z.b2MixFriction(W.GetFriction(),S.GetFriction()),$=z.b2MixRestitution(W.GetRestitution(),S.GetRestitution()),et=X.m_linearVelocity.x,ct=X.m_linearVelocity.y,ht=Z.m_linearVelocity.x,pt=Z.m_linearVelocity.y,mt=X.m_angularVelocity,dt=Z.m_angularVelocity;z.b2Assert(V.m_pointCount>0),d.s_worldManifold.Initialize(V,X.m_xf,F,Z.m_xf,k);var xt=d.s_worldManifold.m_normal.x,Tt=d.s_worldManifold.m_normal.y,lt=this.m_constraints[b];lt.bodyA=X,lt.bodyB=Z,lt.manifold=V,lt.normal.x=xt,lt.normal.y=Tt,lt.pointCount=V.m_pointCount,lt.friction=Y,lt.restitution=$,lt.localPlaneNormal.x=V.m_localPlaneNormal.x,lt.localPlaneNormal.y=V.m_localPlaneNormal.y,lt.localPoint.x=V.m_localPoint.x,lt.localPoint.y=V.m_localPoint.y,lt.radius=F+k,lt.type=V.m_type;for(var at=0;at<lt.pointCount;++at){var At=V.m_points[at],St=lt.points[at];St.normalImpulse=At.m_normalImpulse,St.tangentImpulse=At.m_tangentImpulse,St.localPoint.SetV(At.m_localPoint);var wt=St.rA.x=d.s_worldManifold.m_points[at].x-X.m_sweep.c.x,Pt=St.rA.y=d.s_worldManifold.m_points[at].y-X.m_sweep.c.y,It=St.rB.x=d.s_worldManifold.m_points[at].x-Z.m_sweep.c.x,zt=St.rB.y=d.s_worldManifold.m_points[at].y-Z.m_sweep.c.y,Vt=wt*Tt-Pt*xt,ot=It*Tt-zt*xt;Vt*=Vt,ot*=ot;var st=X.m_invMass+Z.m_invMass+X.m_invI*Vt+Z.m_invI*ot;St.normalMass=1/st;var ut=X.m_mass*X.m_invMass+Z.m_mass*Z.m_invMass;ut+=X.m_mass*X.m_invI*Vt+Z.m_mass*Z.m_invI*ot,St.equalizedMass=1/ut;var ft=Tt,yt=-xt,gt=wt*yt-Pt*ft,Et=It*yt-zt*ft;gt*=gt,Et*=Et;var Rt=X.m_invMass+Z.m_invMass+X.m_invI*gt+Z.m_invI*Et;St.tangentMass=1/Rt,St.velocityBias=0;var Wt=ht+-dt*zt-et- -mt*Pt,Lt=pt+dt*It-ct-mt*wt,Yt=lt.normal.x*Wt+lt.normal.y*Lt;Yt<-z.b2_velocityThreshold&&(St.velocityBias+=-lt.restitution*Yt)}if(lt.pointCount==2){var Mt=lt.points[0],Dt=lt.points[1],Ft=X.m_invMass,Ht=X.m_invI,Xt=Z.m_invMass,jt=Z.m_invI,te=Mt.rA.x*Tt-Mt.rA.y*xt,Jt=Mt.rB.x*Tt-Mt.rB.y*xt,qt=Dt.rA.x*Tt-Dt.rA.y*xt,ee=Dt.rB.x*Tt-Dt.rB.y*xt,Bt=Ft+Xt+Ht*te*te+jt*Jt*Jt,kt=Ft+Xt+Ht*qt*qt+jt*ee*ee,Kt=Ft+Xt+Ht*te*qt+jt*Jt*ee,ce=100;Bt*Bt<ce*(Bt*kt-Kt*Kt)?(lt.K.col1.Set(Bt,Kt),lt.K.col2.Set(Kt,kt),lt.K.GetInverse(lt.normalMass)):lt.pointCount=1}}},d.prototype.InitVelocityConstraints=function(w){for(var O=0;O<this.m_constraintCount;++O){var j=this.m_constraints[O],Q=j.bodyA,C=j.bodyB,b=Q.m_invMass,W=Q.m_invI,S=C.m_invMass,E=C.m_invI,R=j.normal.x,F=j.normal.y,k=F,X=-R,Z=0,V=0;if(w.warmStarting)for(V=j.pointCount,Z=0;Z<V;++Z){var Y=j.points[Z];Y.normalImpulse*=w.dtRatio,Y.tangentImpulse*=w.dtRatio;var $=Y.normalImpulse*R+Y.tangentImpulse*k,et=Y.normalImpulse*F+Y.tangentImpulse*X;Q.m_angularVelocity-=W*(Y.rA.x*et-Y.rA.y*$),Q.m_linearVelocity.x-=b*$,Q.m_linearVelocity.y-=b*et,C.m_angularVelocity+=E*(Y.rB.x*et-Y.rB.y*$),C.m_linearVelocity.x+=S*$,C.m_linearVelocity.y+=S*et}else for(V=j.pointCount,Z=0;Z<V;++Z){var ct=j.points[Z];ct.normalImpulse=0,ct.tangentImpulse=0}}},d.prototype.SolveVelocityConstraints=function(){for(var w=0,O,j=0,Q=0,C=0,b=0,W=0,S=0,E=0,R=0,F=0,k=0,X=0,Z=0,V=0,Y=0,$=0,et,ct=0;ct<this.m_constraintCount;++ct){var ht=this.m_constraints[ct],pt=ht.bodyA,mt=ht.bodyB,dt=pt.m_angularVelocity,xt=mt.m_angularVelocity,Tt=pt.m_linearVelocity,lt=mt.m_linearVelocity,at=pt.m_invMass,At=pt.m_invI,St=mt.m_invMass,wt=mt.m_invI,Pt=ht.normal.x,It=ht.normal.y,zt=It,Vt=-Pt,ot=ht.friction;for(w=0;w<ht.pointCount;w++)O=ht.points[w],j=lt.x-xt*O.rB.y-Tt.x+dt*O.rA.y,Q=lt.y+xt*O.rB.x-Tt.y-dt*O.rA.x,b=j*zt+Q*Vt,W=O.tangentMass*-b,S=ot*O.normalImpulse,E=J.Clamp(O.tangentImpulse+W,-S,S),W=E-O.tangentImpulse,R=W*zt,F=W*Vt,Tt.x-=at*R,Tt.y-=at*F,dt-=At*(O.rA.x*F-O.rA.y*R),lt.x+=St*R,lt.y+=St*F,xt+=wt*(O.rB.x*F-O.rB.y*R),O.tangentImpulse=E;if(parseInt(ht.pointCount),ht.pointCount==1)O=ht.points[0],j=lt.x+-xt*O.rB.y-Tt.x- -dt*O.rA.y,Q=lt.y+xt*O.rB.x-Tt.y-dt*O.rA.x,C=j*Pt+Q*It,W=-O.normalMass*(C-O.velocityBias),E=O.normalImpulse+W,E=E>0?E:0,W=E-O.normalImpulse,R=W*Pt,F=W*It,Tt.x-=at*R,Tt.y-=at*F,dt-=At*(O.rA.x*F-O.rA.y*R),lt.x+=St*R,lt.y+=St*F,xt+=wt*(O.rB.x*F-O.rB.y*R),O.normalImpulse=E;else{var st=ht.points[0],ut=ht.points[1],ft=st.normalImpulse,yt=ut.normalImpulse,gt=lt.x-xt*st.rB.y-Tt.x+dt*st.rA.y,Et=lt.y+xt*st.rB.x-Tt.y-dt*st.rA.x,Rt=lt.x-xt*ut.rB.y-Tt.x+dt*ut.rA.y,Wt=lt.y+xt*ut.rB.x-Tt.y-dt*ut.rA.x,Lt=gt*Pt+Et*It,Yt=Rt*Pt+Wt*It,Mt=Lt-st.velocityBias,Dt=Yt-ut.velocityBias;for(et=ht.K,Mt-=et.col1.x*ft+et.col2.x*yt,Dt-=et.col1.y*ft+et.col2.y*yt;;){et=ht.normalMass;var Ft=-(et.col1.x*Mt+et.col2.x*Dt),Ht=-(et.col1.y*Mt+et.col2.y*Dt);if(Ft>=0&&Ht>=0){k=Ft-ft,X=Ht-yt,Z=k*Pt,V=k*It,Y=X*Pt,$=X*It,Tt.x-=at*(Z+Y),Tt.y-=at*(V+$),dt-=At*(st.rA.x*V-st.rA.y*Z+ut.rA.x*$-ut.rA.y*Y),lt.x+=St*(Z+Y),lt.y+=St*(V+$),xt+=wt*(st.rB.x*V-st.rB.y*Z+ut.rB.x*$-ut.rB.y*Y),st.normalImpulse=Ft,ut.normalImpulse=Ht;break}if(Ft=-st.normalMass*Mt,Ht=0,Lt=0,Yt=ht.K.col1.y*Ft+Dt,Ft>=0&&Yt>=0){k=Ft-ft,X=Ht-yt,Z=k*Pt,V=k*It,Y=X*Pt,$=X*It,Tt.x-=at*(Z+Y),Tt.y-=at*(V+$),dt-=At*(st.rA.x*V-st.rA.y*Z+ut.rA.x*$-ut.rA.y*Y),lt.x+=St*(Z+Y),lt.y+=St*(V+$),xt+=wt*(st.rB.x*V-st.rB.y*Z+ut.rB.x*$-ut.rB.y*Y),st.normalImpulse=Ft,ut.normalImpulse=Ht;break}if(Ft=0,Ht=-ut.normalMass*Dt,Lt=ht.K.col2.x*Ht+Mt,Yt=0,Ht>=0&&Lt>=0){k=Ft-ft,X=Ht-yt,Z=k*Pt,V=k*It,Y=X*Pt,$=X*It,Tt.x-=at*(Z+Y),Tt.y-=at*(V+$),dt-=At*(st.rA.x*V-st.rA.y*Z+ut.rA.x*$-ut.rA.y*Y),lt.x+=St*(Z+Y),lt.y+=St*(V+$),xt+=wt*(st.rB.x*V-st.rB.y*Z+ut.rB.x*$-ut.rB.y*Y),st.normalImpulse=Ft,ut.normalImpulse=Ht;break}if(Ft=0,Ht=0,Lt=Mt,Yt=Dt,Lt>=0&&Yt>=0){k=Ft-ft,X=Ht-yt,Z=k*Pt,V=k*It,Y=X*Pt,$=X*It,Tt.x-=at*(Z+Y),Tt.y-=at*(V+$),dt-=At*(st.rA.x*V-st.rA.y*Z+ut.rA.x*$-ut.rA.y*Y),lt.x+=St*(Z+Y),lt.y+=St*(V+$),xt+=wt*(st.rB.x*V-st.rB.y*Z+ut.rB.x*$-ut.rB.y*Y),st.normalImpulse=Ft,ut.normalImpulse=Ht;break}break}}pt.m_angularVelocity=dt,mt.m_angularVelocity=xt}},d.prototype.FinalizeVelocityConstraints=function(){for(var w=0;w<this.m_constraintCount;++w)for(var O=this.m_constraints[w],j=O.manifold,Q=0;Q<O.pointCount;++Q){var C=j.m_points[Q],b=O.points[Q];C.m_normalImpulse=b.normalImpulse,C.m_tangentImpulse=b.tangentImpulse}},d.prototype.SolvePositionConstraints=function(w){w===void 0&&(w=0);for(var O=0,j=0;j<this.m_constraintCount;j++){var Q=this.m_constraints[j],C=Q.bodyA,b=Q.bodyB,W=C.m_mass*C.m_invMass,S=C.m_mass*C.m_invI,E=b.m_mass*b.m_invMass,R=b.m_mass*b.m_invI;d.s_psm.Initialize(Q);for(var F=d.s_psm.m_normal,k=0;k<Q.pointCount;k++){var X=Q.points[k],Z=d.s_psm.m_points[k],V=d.s_psm.m_separations[k],Y=Z.x-C.m_sweep.c.x,$=Z.y-C.m_sweep.c.y,et=Z.x-b.m_sweep.c.x,ct=Z.y-b.m_sweep.c.y;O=O<V?O:V;var ht=J.Clamp(w*(V+z.b2_linearSlop),-z.b2_maxLinearCorrection,0),pt=-X.equalizedMass*ht,mt=pt*F.x,dt=pt*F.y;C.m_sweep.c.x-=W*mt,C.m_sweep.c.y-=W*dt,C.m_sweep.a-=S*(Y*dt-$*mt),C.SynchronizeTransform(),b.m_sweep.c.x+=E*mt,b.m_sweep.c.y+=E*dt,b.m_sweep.a+=R*(et*dt-ct*mt),b.SynchronizeTransform()}}return O>-1.5*z.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new G,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new A}),Box2D.inherit(f,Box2D.Dynamics.Contacts.b2Contact),f.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,f.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.Create=function(w){return new f},f.Destroy=function(w,O){},f.prototype.Reset=function(w,O){this.__super.Reset.call(this,w,O)},f.prototype.Evaluate=function(){var w=this.m_fixtureA.GetBody(),O=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,w.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,O.m_xf)},f.prototype.b2CollideEdgeAndCircle=function(w,O,j,Q,C){},Box2D.inherit(T,Box2D.Dynamics.Contacts.b2Contact),T.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,T.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},T.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},T.prototype.Evaluate=function(){},Box2D.inherit(x,Box2D.Dynamics.Contacts.b2Contact),x.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,x.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},x.Create=function(w){return new x},x.Destroy=function(w,O){},x.prototype.Reset=function(w,O){this.__super.Reset.call(this,w,O),z.b2Assert(w.GetType()==n.e_polygonShape),z.b2Assert(O.GetType()==n.e_circleShape)},x.prototype.Evaluate=function(){var w=this.m_fixtureA.m_body,O=this.m_fixtureB.m_body;K.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,w.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,O.m_xf)},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(w){return new m},m.Destroy=function(w,O){},m.prototype.Reset=function(w,O){this.__super.Reset.call(this,w,O),z.b2Assert(w.GetType()==n.e_polygonShape),z.b2Assert(O.GetType()==n.e_edgeShape)},m.prototype.Evaluate=function(){var w=this.m_fixtureA.GetBody(),O=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,w.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,O.m_xf)},m.prototype.b2CollidePolyAndEdge=function(w,O,j,Q,C){},Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact),v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,v.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(w){return new v},v.Destroy=function(w,O){},v.prototype.Reset=function(w,O){this.__super.Reset.call(this,w,O)},v.prototype.Evaluate=function(){var w=this.m_fixtureA.GetBody(),O=this.m_fixtureB.GetBody();K.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,w.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,O.m_xf)},A.b2PositionSolverManifold=function(){},A.prototype.b2PositionSolverManifold=function(){this.m_normal=new U,this.m_separations=new Vector_a2j_Number(z.b2_maxManifoldPoints),this.m_points=new Vector(z.b2_maxManifoldPoints);for(var w=0;w<z.b2_maxManifoldPoints;w++)this.m_points[w]=new U},A.prototype.Initialize=function(w){z.b2Assert(w.pointCount>0);var O=0,j=0,Q=0,C,b,W=0,S=0;switch(w.type){case rt.e_circles:{C=w.bodyA.m_xf.R,b=w.localPoint;var E=w.bodyA.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),R=w.bodyA.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y);C=w.bodyB.m_xf.R,b=w.points[0].localPoint;var F=w.bodyB.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),k=w.bodyB.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y),X=F-E,Z=k-R,V=X*X+Z*Z;if(V>Number.MIN_VALUE*Number.MIN_VALUE){var Y=Math.sqrt(V);this.m_normal.x=X/Y,this.m_normal.y=Z/Y}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(E+F),this.m_points[0].y=.5*(R+k),this.m_separations[0]=X*this.m_normal.x+Z*this.m_normal.y-w.radius}break;case rt.e_faceA:for(C=w.bodyA.m_xf.R,b=w.localPlaneNormal,this.m_normal.x=C.col1.x*b.x+C.col2.x*b.y,this.m_normal.y=C.col1.y*b.x+C.col2.y*b.y,C=w.bodyA.m_xf.R,b=w.localPoint,W=w.bodyA.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),S=w.bodyA.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y),C=w.bodyB.m_xf.R,O=0;O<w.pointCount;++O)b=w.points[O].localPoint,j=w.bodyB.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),Q=w.bodyB.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y),this.m_separations[O]=(j-W)*this.m_normal.x+(Q-S)*this.m_normal.y-w.radius,this.m_points[O].x=j,this.m_points[O].y=Q;break;case rt.e_faceB:{for(C=w.bodyB.m_xf.R,b=w.localPlaneNormal,this.m_normal.x=C.col1.x*b.x+C.col2.x*b.y,this.m_normal.y=C.col1.y*b.x+C.col2.y*b.y,C=w.bodyB.m_xf.R,b=w.localPoint,W=w.bodyB.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),S=w.bodyB.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y),C=w.bodyA.m_xf.R,O=0;O<w.pointCount;++O)b=w.points[O].localPoint,j=w.bodyA.m_xf.position.x+(C.col1.x*b.x+C.col2.x*b.y),Q=w.bodyA.m_xf.position.y+(C.col1.y*b.x+C.col2.y*b.y),this.m_separations[O]=(j-W)*this.m_normal.x+(Q-S)*this.m_normal.y-w.radius,this.m_points[O].Set(j,Q);this.m_normal.x*=-1,this.m_normal.y*=-1}break}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new U,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new U})})();(function(){Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World;var t=Box2D.Common.Math.b2Mat22;Box2D.Common.Math.b2Mat33;var e=Box2D.Common.Math.b2Math;Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform;var r=Box2D.Common.Math.b2Vec2;Box2D.Common.Math.b2Vec3;var n=Box2D.Common.b2Color;Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape;var s=Box2D.Dynamics.Controllers.b2BuoyancyController,o=Box2D.Dynamics.Controllers.b2ConstantAccelController,a=Box2D.Dynamics.Controllers.b2ConstantForceController,c=Box2D.Dynamics.Controllers.b2Controller,l=Box2D.Dynamics.Controllers.b2ControllerEdge,h=Box2D.Dynamics.Controllers.b2GravityController,u=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(s,Box2D.Dynamics.Controllers.b2Controller),s.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,s.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new r(0,-1),this.offset=0,this.density=0,this.velocity=new r(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},s.prototype.Step=function(_){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var d=this.m_bodyList;d;d=d.nextBody){var f=d.body;if(f.IsAwake()!=!1){for(var T=new r,x=new r,m=0,v=0,A=f.GetFixtureList();A;A=A.GetNext()){var D=new r,N=A.GetShape().ComputeSubmergedArea(this.normal,this.offset,f.GetTransform(),D);m+=N,T.x+=N*D.x,T.y+=N*D.y;var z=0;this.useDensity,z=1,v+=N*z,x.x+=N*D.x*z,x.y+=N*D.y*z}if(T.x/=m,T.y/=m,x.x/=v,x.y/=v,!(m<Number.MIN_VALUE)){var M=this.gravity.GetNegative();M.Multiply(this.density*m),f.ApplyForce(M,x);var J=f.GetLinearVelocityFromWorldPoint(T);J.Subtract(this.velocity),J.Multiply(-this.linearDrag*m),f.ApplyForce(J,T),f.ApplyTorque(-f.GetInertia()/f.GetMass()*m*f.GetAngularVelocity()*this.angularDrag)}}}}},s.prototype.Draw=function(_){var d=1e3,f=new r,T=new r;f.x=this.normal.x*this.offset+this.normal.y*d,f.y=this.normal.y*this.offset-this.normal.x*d,T.x=this.normal.x*this.offset-this.normal.y*d,T.y=this.normal.y*this.offset+this.normal.x*d;var x=new n(0,0,1);_.DrawSegment(f,T,x)},Box2D.inherit(o,Box2D.Dynamics.Controllers.b2Controller),o.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new r(0,0)},o.prototype.Step=function(_){for(var d=new r(this.A.x*_.dt,this.A.y*_.dt),f=this.m_bodyList;f;f=f.nextBody){var T=f.body;T.IsAwake()&&T.SetLinearVelocity(new r(T.GetLinearVelocity().x+d.x,T.GetLinearVelocity().y+d.y))}},Box2D.inherit(a,Box2D.Dynamics.Controllers.b2Controller),a.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,a.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new r(0,0)},a.prototype.Step=function(_){for(var d=this.m_bodyList;d;d=d.nextBody){var f=d.body;f.IsAwake()&&f.ApplyForce(this.F,f.GetWorldCenter())}},c.b2Controller=function(){},c.prototype.Step=function(_){},c.prototype.Draw=function(_){},c.prototype.AddBody=function(_){var d=new l;d.controller=this||window,d.body=_,d.nextBody=this.m_bodyList,d.prevBody=null,this.m_bodyList=d,d.nextBody&&(d.nextBody.prevBody=d),this.m_bodyCount++,d.nextController=_.m_controllerList,d.prevController=null,_.m_controllerList=d,d.nextController&&(d.nextController.prevController=d),_.m_controllerCount++},c.prototype.RemoveBody=function(_){for(var d=_.m_controllerList;d&&d.controller!=this;)d=d.nextController;d.prevBody&&(d.prevBody.nextBody=d.nextBody),d.nextBody&&(d.nextBody.prevBody=d.prevBody),d.nextController&&(d.nextController.prevController=d.prevController),d.prevController&&(d.prevController.nextController=d.nextController),this.m_bodyList==d&&(this.m_bodyList=d.nextBody),_.m_controllerList==d&&(_.m_controllerList=d.nextController),_.m_controllerCount--,this.m_bodyCount--},c.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},c.prototype.GetNext=function(){return this.m_next},c.prototype.GetWorld=function(){return this.m_world},c.prototype.GetBodyList=function(){return this.m_bodyList},l.b2ControllerEdge=function(){},Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller),h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,h.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},h.prototype.Step=function(_){var d=null,f=null,T=null,x=0,m=null,v=null,A=null,D=0,N=0,z=0,M=null;if(this.invSqr)for(d=this.m_bodyList;d;d=d.nextBody)for(f=d.body,T=f.GetWorldCenter(),x=f.GetMass(),m=this.m_bodyList;m!=d;m=m.nextBody)v=m.body,A=v.GetWorldCenter(),D=A.x-T.x,N=A.y-T.y,z=D*D+N*N,!(z<Number.MIN_VALUE)&&(M=new r(D,N),M.Multiply(this.G/z/Math.sqrt(z)*x*v.GetMass()),f.IsAwake()&&f.ApplyForce(M,T),M.Multiply(-1),v.IsAwake()&&v.ApplyForce(M,A));else for(d=this.m_bodyList;d;d=d.nextBody)for(f=d.body,T=f.GetWorldCenter(),x=f.GetMass(),m=this.m_bodyList;m!=d;m=m.nextBody)v=m.body,A=v.GetWorldCenter(),D=A.x-T.x,N=A.y-T.y,z=D*D+N*N,!(z<Number.MIN_VALUE)&&(M=new r(D,N),M.Multiply(this.G/z*x*v.GetMass()),f.IsAwake()&&f.ApplyForce(M,T),M.Multiply(-1),v.IsAwake()&&v.ApplyForce(M,A))},Box2D.inherit(u,Box2D.Dynamics.Controllers.b2Controller),u.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,u.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new t,this.maxTimestep=0},u.prototype.SetAxisAligned=function(_,d){_===void 0&&(_=0),d===void 0&&(d=0),this.T.col1.x=-_,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-d,_>0||d>0?this.maxTimestep=1/Math.max(_,d):this.maxTimestep=0},u.prototype.Step=function(_){var d=_.dt;if(!(d<=Number.MIN_VALUE)){d>this.maxTimestep&&this.maxTimestep>0&&(d=this.maxTimestep);for(var f=this.m_bodyList;f;f=f.nextBody){var T=f.body;if(T.IsAwake()){var x=T.GetWorldVector(e.MulMV(this.T,T.GetLocalVector(T.GetLinearVelocity())));T.SetLinearVelocity(new r(T.GetLinearVelocity().x+x.x*d,T.GetLinearVelocity().y+x.y*d))}}}}})();(function(){Box2D.Common.b2Color,Box2D.Common.b2internal;var t=Box2D.Common.b2Settings,e=Box2D.Common.Math.b2Mat22,r=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math;Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform;var s=Box2D.Common.Math.b2Vec2,o=Box2D.Common.Math.b2Vec3,a=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,l=Box2D.Dynamics.Joints.b2FrictionJoint,h=Box2D.Dynamics.Joints.b2FrictionJointDef,u=Box2D.Dynamics.Joints.b2GearJoint,_=Box2D.Dynamics.Joints.b2GearJointDef,d=Box2D.Dynamics.Joints.b2Jacobian,f=Box2D.Dynamics.Joints.b2Joint,T=Box2D.Dynamics.Joints.b2JointDef,x=Box2D.Dynamics.Joints.b2JointEdge,m=Box2D.Dynamics.Joints.b2LineJoint,v=Box2D.Dynamics.Joints.b2LineJointDef,A=Box2D.Dynamics.Joints.b2MouseJoint,D=Box2D.Dynamics.Joints.b2MouseJointDef,N=Box2D.Dynamics.Joints.b2PrismaticJoint,z=Box2D.Dynamics.Joints.b2PrismaticJointDef,M=Box2D.Dynamics.Joints.b2PulleyJoint,J=Box2D.Dynamics.Joints.b2PulleyJointDef,U=Box2D.Dynamics.Joints.b2RevoluteJoint,K=Box2D.Dynamics.Joints.b2RevoluteJointDef,tt=Box2D.Dynamics.Joints.b2WeldJoint,rt=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.inherit(a,Box2D.Dynamics.Joints.b2Joint),a.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,a.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_u=new s},a.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},a.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},a.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse*this.m_u.x,I*this.m_impulse*this.m_u.y)},a.prototype.GetReactionTorque=function(I){return 0},a.prototype.GetLength=function(){return this.m_length},a.prototype.SetLength=function(I){I===void 0&&(I=0),this.m_length=I},a.prototype.GetFrequency=function(){return this.m_frequencyHz},a.prototype.SetFrequency=function(I){I===void 0&&(I=0),this.m_frequencyHz=I},a.prototype.GetDampingRatio=function(){return this.m_dampingRatio},a.prototype.SetDampingRatio=function(I){I===void 0&&(I=0),this.m_dampingRatio=I},a.prototype.b2DistanceJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchor1.SetV(I.localAnchorA),this.m_localAnchor2.SetV(I.localAnchorB),this.m_length=I.length,this.m_frequencyHz=I.frequencyHz,this.m_dampingRatio=I.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},a.prototype.InitVelocityConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB;L=w.m_xf.R;var j=this.m_localAnchor1.x-w.m_sweep.localCenter.x,Q=this.m_localAnchor1.y-w.m_sweep.localCenter.y;G=L.col1.x*j+L.col2.x*Q,Q=L.col1.y*j+L.col2.y*Q,j=G,L=O.m_xf.R;var C=this.m_localAnchor2.x-O.m_sweep.localCenter.x,b=this.m_localAnchor2.y-O.m_sweep.localCenter.y;G=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=G,this.m_u.x=O.m_sweep.c.x+C-w.m_sweep.c.x-j,this.m_u.y=O.m_sweep.c.y+b-w.m_sweep.c.y-Q;var W=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);W>t.b2_linearSlop?this.m_u.Multiply(1/W):this.m_u.SetZero();var S=j*this.m_u.y-Q*this.m_u.x,E=C*this.m_u.y-b*this.m_u.x,R=w.m_invMass+w.m_invI*S*S+O.m_invMass+O.m_invI*E*E;if(this.m_mass=R!=0?1/R:0,this.m_frequencyHz>0){var F=W-this.m_length,k=2*Math.PI*this.m_frequencyHz,X=2*this.m_mass*this.m_dampingRatio*k,Z=this.m_mass*k*k;this.m_gamma=I.dt*(X+I.dt*Z),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=F*I.dt*Z*this.m_gamma,this.m_mass=R+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(I.warmStarting){this.m_impulse*=I.dtRatio;var V=this.m_impulse*this.m_u.x,Y=this.m_impulse*this.m_u.y;w.m_linearVelocity.x-=w.m_invMass*V,w.m_linearVelocity.y-=w.m_invMass*Y,w.m_angularVelocity-=w.m_invI*(j*Y-Q*V),O.m_linearVelocity.x+=O.m_invMass*V,O.m_linearVelocity.y+=O.m_invMass*Y,O.m_angularVelocity+=O.m_invI*(C*Y-b*V)}else this.m_impulse=0},a.prototype.SolveVelocityConstraints=function(I){var L,G=this.m_bodyA,w=this.m_bodyB;L=G.m_xf.R;var O=this.m_localAnchor1.x-G.m_sweep.localCenter.x,j=this.m_localAnchor1.y-G.m_sweep.localCenter.y,Q=L.col1.x*O+L.col2.x*j;j=L.col1.y*O+L.col2.y*j,O=Q,L=w.m_xf.R;var C=this.m_localAnchor2.x-w.m_sweep.localCenter.x,b=this.m_localAnchor2.y-w.m_sweep.localCenter.y;Q=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=Q;var W=G.m_linearVelocity.x+-G.m_angularVelocity*j,S=G.m_linearVelocity.y+G.m_angularVelocity*O,E=w.m_linearVelocity.x+-w.m_angularVelocity*b,R=w.m_linearVelocity.y+w.m_angularVelocity*C,F=this.m_u.x*(E-W)+this.m_u.y*(R-S),k=-this.m_mass*(F+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=k;var X=k*this.m_u.x,Z=k*this.m_u.y;G.m_linearVelocity.x-=G.m_invMass*X,G.m_linearVelocity.y-=G.m_invMass*Z,G.m_angularVelocity-=G.m_invI*(O*Z-j*X),w.m_linearVelocity.x+=w.m_invMass*X,w.m_linearVelocity.y+=w.m_invMass*Z,w.m_angularVelocity+=w.m_invI*(C*Z-b*X)},a.prototype.SolvePositionConstraints=function(I){var L;if(this.m_frequencyHz>0)return!0;var G=this.m_bodyA,w=this.m_bodyB;L=G.m_xf.R;var O=this.m_localAnchor1.x-G.m_sweep.localCenter.x,j=this.m_localAnchor1.y-G.m_sweep.localCenter.y,Q=L.col1.x*O+L.col2.x*j;j=L.col1.y*O+L.col2.y*j,O=Q,L=w.m_xf.R;var C=this.m_localAnchor2.x-w.m_sweep.localCenter.x,b=this.m_localAnchor2.y-w.m_sweep.localCenter.y;Q=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=Q;var W=w.m_sweep.c.x+C-G.m_sweep.c.x-O,S=w.m_sweep.c.y+b-G.m_sweep.c.y-j,E=Math.sqrt(W*W+S*S);W/=E,S/=E;var R=E-this.m_length;R=n.Clamp(R,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection);var F=-this.m_mass*R;this.m_u.Set(W,S);var k=F*this.m_u.x,X=F*this.m_u.y;return G.m_sweep.c.x-=G.m_invMass*k,G.m_sweep.c.y-=G.m_invMass*X,G.m_sweep.a-=G.m_invI*(O*X-j*k),w.m_sweep.c.x+=w.m_invMass*k,w.m_sweep.c.y+=w.m_invMass*X,w.m_sweep.a+=w.m_invI*(C*X-b*k),G.SynchronizeTransform(),w.SynchronizeTransform(),n.Abs(R)<t.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},c.prototype.Initialize=function(I,L,G,w){this.bodyA=I,this.bodyB=L,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(G)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(w));var O=w.x-G.x,j=w.y-G.y;this.length=Math.sqrt(O*O+j*j),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new s,this.m_localAnchorB=new s,this.m_linearMass=new e,this.m_linearImpulse=new s},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},l.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_linearImpulse.x,I*this.m_linearImpulse.y)},l.prototype.GetReactionTorque=function(I){return I===void 0&&(I=0),I*this.m_angularImpulse},l.prototype.SetMaxForce=function(I){I===void 0&&(I=0),this.m_maxForce=I},l.prototype.GetMaxForce=function(){return this.m_maxForce},l.prototype.SetMaxTorque=function(I){I===void 0&&(I=0),this.m_maxTorque=I},l.prototype.GetMaxTorque=function(){return this.m_maxTorque},l.prototype.b2FrictionJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchorA.SetV(I.localAnchorA),this.m_localAnchorB.SetV(I.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=I.maxForce,this.m_maxTorque=I.maxTorque},l.prototype.InitVelocityConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB;L=w.m_xf.R;var j=this.m_localAnchorA.x-w.m_sweep.localCenter.x,Q=this.m_localAnchorA.y-w.m_sweep.localCenter.y;G=L.col1.x*j+L.col2.x*Q,Q=L.col1.y*j+L.col2.y*Q,j=G,L=O.m_xf.R;var C=this.m_localAnchorB.x-O.m_sweep.localCenter.x,b=this.m_localAnchorB.y-O.m_sweep.localCenter.y;G=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=G;var W=w.m_invMass,S=O.m_invMass,E=w.m_invI,R=O.m_invI,F=new e;if(F.col1.x=W+S,F.col2.x=0,F.col1.y=0,F.col2.y=W+S,F.col1.x+=E*Q*Q,F.col2.x+=-E*j*Q,F.col1.y+=-E*j*Q,F.col2.y+=E*j*j,F.col1.x+=R*b*b,F.col2.x+=-R*C*b,F.col1.y+=-R*C*b,F.col2.y+=R*C*C,F.GetInverse(this.m_linearMass),this.m_angularMass=E+R,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),I.warmStarting){this.m_linearImpulse.x*=I.dtRatio,this.m_linearImpulse.y*=I.dtRatio,this.m_angularImpulse*=I.dtRatio;var k=this.m_linearImpulse;w.m_linearVelocity.x-=W*k.x,w.m_linearVelocity.y-=W*k.y,w.m_angularVelocity-=E*(j*k.y-Q*k.x+this.m_angularImpulse),O.m_linearVelocity.x+=S*k.x,O.m_linearVelocity.y+=S*k.y,O.m_angularVelocity+=R*(C*k.y-b*k.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},l.prototype.SolveVelocityConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB,j=w.m_linearVelocity,Q=w.m_angularVelocity,C=O.m_linearVelocity,b=O.m_angularVelocity,W=w.m_invMass,S=O.m_invMass,E=w.m_invI,R=O.m_invI;L=w.m_xf.R;var F=this.m_localAnchorA.x-w.m_sweep.localCenter.x,k=this.m_localAnchorA.y-w.m_sweep.localCenter.y;G=L.col1.x*F+L.col2.x*k,k=L.col1.y*F+L.col2.y*k,F=G,L=O.m_xf.R;var X=this.m_localAnchorB.x-O.m_sweep.localCenter.x,Z=this.m_localAnchorB.y-O.m_sweep.localCenter.y;G=L.col1.x*X+L.col2.x*Z,Z=L.col1.y*X+L.col2.y*Z,X=G;var V=0;{var Y=b-Q,$=-this.m_angularMass*Y,et=this.m_angularImpulse;V=I.dt*this.m_maxTorque,this.m_angularImpulse=n.Clamp(this.m_angularImpulse+$,-V,V),$=this.m_angularImpulse-et,Q-=E*$,b+=R*$}{var ct=C.x-b*Z-j.x+Q*k,ht=C.y+b*X-j.y-Q*F,pt=n.MulMV(this.m_linearMass,new s(-ct,-ht)),mt=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(pt),V=I.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>V*V&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(V)),pt=n.SubtractVV(this.m_linearImpulse,mt),j.x-=W*pt.x,j.y-=W*pt.y,Q-=E*(F*pt.y-k*pt.x),C.x+=S*pt.x,C.y+=S*pt.y,b+=R*(X*pt.y-Z*pt.x)}w.m_angularVelocity=Q,O.m_angularVelocity=b},l.prototype.SolvePositionConstraints=function(I){return!0},Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef),h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,h.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_frictionJoint,this.maxForce=0,this.maxTorque=0},h.prototype.Initialize=function(I,L,G){this.bodyA=I,this.bodyB=L,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(G)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(G))},Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint),u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,u.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new s,this.m_groundAnchor2=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_J=new d},u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},u.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse*this.m_J.linearB.x,I*this.m_impulse*this.m_J.linearB.y)},u.prototype.GetReactionTorque=function(I){I===void 0&&(I=0);var L=this.m_bodyB.m_xf.R,G=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,w=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,O=L.col1.x*G+L.col2.x*w;w=L.col1.y*G+L.col2.y*w,G=O;var j=this.m_impulse*this.m_J.linearB.x,Q=this.m_impulse*this.m_J.linearB.y;return I*(this.m_impulse*this.m_J.angularB-G*Q+w*j)},u.prototype.GetRatio=function(){return this.m_ratio},u.prototype.SetRatio=function(I){I===void 0&&(I=0),this.m_ratio=I},u.prototype.b2GearJoint=function(I){this.__super.b2Joint.call(this,I);var L=parseInt(I.joint1.m_type),G=parseInt(I.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var w=0,O=0;this.m_ground1=I.joint1.GetBodyA(),this.m_bodyA=I.joint1.GetBodyB(),L==f.e_revoluteJoint?(this.m_revolute1=I.joint1 instanceof U?I.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),w=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=I.joint1 instanceof N?I.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),w=this.m_prismatic1.GetJointTranslation()),this.m_ground2=I.joint2.GetBodyA(),this.m_bodyB=I.joint2.GetBodyB(),G==f.e_revoluteJoint?(this.m_revolute2=I.joint2 instanceof U?I.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),O=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=I.joint2 instanceof N?I.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),O=this.m_prismatic2.GetJointTranslation()),this.m_ratio=I.ratio,this.m_constant=w+this.m_ratio*O,this.m_impulse=0},u.prototype.InitVelocityConstraints=function(I){var L=this.m_ground1,G=this.m_ground2,w=this.m_bodyA,O=this.m_bodyB,j=0,Q=0,C=0,b=0,W,S,E=0,R=0,F=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,F+=w.m_invI):(W=L.m_xf.R,S=this.m_prismatic1.m_localXAxis1,j=W.col1.x*S.x+W.col2.x*S.y,Q=W.col1.y*S.x+W.col2.y*S.y,W=w.m_xf.R,C=this.m_localAnchor1.x-w.m_sweep.localCenter.x,b=this.m_localAnchor1.y-w.m_sweep.localCenter.y,R=W.col1.x*C+W.col2.x*b,b=W.col1.y*C+W.col2.y*b,C=R,E=C*Q-b*j,this.m_J.linearA.Set(-j,-Q),this.m_J.angularA=-E,F+=w.m_invMass+w.m_invI*E*E),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,F+=this.m_ratio*this.m_ratio*O.m_invI):(W=G.m_xf.R,S=this.m_prismatic2.m_localXAxis1,j=W.col1.x*S.x+W.col2.x*S.y,Q=W.col1.y*S.x+W.col2.y*S.y,W=O.m_xf.R,C=this.m_localAnchor2.x-O.m_sweep.localCenter.x,b=this.m_localAnchor2.y-O.m_sweep.localCenter.y,R=W.col1.x*C+W.col2.x*b,b=W.col1.y*C+W.col2.y*b,C=R,E=C*Q-b*j,this.m_J.linearB.Set(-this.m_ratio*j,-this.m_ratio*Q),this.m_J.angularB=-this.m_ratio*E,F+=this.m_ratio*this.m_ratio*(O.m_invMass+O.m_invI*E*E)),this.m_mass=F>0?1/F:0,I.warmStarting?(w.m_linearVelocity.x+=w.m_invMass*this.m_impulse*this.m_J.linearA.x,w.m_linearVelocity.y+=w.m_invMass*this.m_impulse*this.m_J.linearA.y,w.m_angularVelocity+=w.m_invI*this.m_impulse*this.m_J.angularA,O.m_linearVelocity.x+=O.m_invMass*this.m_impulse*this.m_J.linearB.x,O.m_linearVelocity.y+=O.m_invMass*this.m_impulse*this.m_J.linearB.y,O.m_angularVelocity+=O.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},u.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w=this.m_J.Compute(L.m_linearVelocity,L.m_angularVelocity,G.m_linearVelocity,G.m_angularVelocity),O=-this.m_mass*w;this.m_impulse+=O,L.m_linearVelocity.x+=L.m_invMass*O*this.m_J.linearA.x,L.m_linearVelocity.y+=L.m_invMass*O*this.m_J.linearA.y,L.m_angularVelocity+=L.m_invI*O*this.m_J.angularA,G.m_linearVelocity.x+=G.m_invMass*O*this.m_J.linearB.x,G.m_linearVelocity.y+=G.m_invMass*O*this.m_J.linearB.y,G.m_angularVelocity+=G.m_invI*O*this.m_J.angularB},u.prototype.SolvePositionConstraints=function(I){var L=0,G=this.m_bodyA,w=this.m_bodyB,O=0,j=0;this.m_revolute1?O=this.m_revolute1.GetJointAngle():O=this.m_prismatic1.GetJointTranslation(),this.m_revolute2?j=this.m_revolute2.GetJointAngle():j=this.m_prismatic2.GetJointTranslation();var Q=this.m_constant-(O+this.m_ratio*j),C=-this.m_mass*Q;return G.m_sweep.c.x+=G.m_invMass*C*this.m_J.linearA.x,G.m_sweep.c.y+=G.m_invMass*C*this.m_J.linearA.y,G.m_sweep.a+=G.m_invI*C*this.m_J.angularA,w.m_sweep.c.x+=w.m_invMass*C*this.m_J.linearB.x,w.m_sweep.c.y+=w.m_invMass*C*this.m_J.linearB.y,w.m_sweep.a+=w.m_invI*C*this.m_J.angularB,G.SynchronizeTransform(),w.SynchronizeTransform(),L<t.b2_linearSlop},Box2D.inherit(_,Box2D.Dynamics.Joints.b2JointDef),_.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,_.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},_.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},d.b2Jacobian=function(){this.linearA=new s,this.linearB=new s},d.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},d.prototype.Set=function(I,L,G,w){L===void 0&&(L=0),w===void 0&&(w=0),this.linearA.SetV(I),this.angularA=L,this.linearB.SetV(G),this.angularB=w},d.prototype.Compute=function(I,L,G,w){return L===void 0&&(L=0),w===void 0&&(w=0),this.linearA.x*I.x+this.linearA.y*I.y+this.angularA*L+(this.linearB.x*G.x+this.linearB.y*G.y)+this.angularB*w},f.b2Joint=function(){this.m_edgeA=new x,this.m_edgeB=new x,this.m_localCenterA=new s,this.m_localCenterB=new s},f.prototype.GetType=function(){return this.m_type},f.prototype.GetAnchorA=function(){return null},f.prototype.GetAnchorB=function(){return null},f.prototype.GetReactionForce=function(I){return null},f.prototype.GetReactionTorque=function(I){return 0},f.prototype.GetBodyA=function(){return this.m_bodyA},f.prototype.GetBodyB=function(){return this.m_bodyB},f.prototype.GetNext=function(){return this.m_next},f.prototype.GetUserData=function(){return this.m_userData},f.prototype.SetUserData=function(I){this.m_userData=I},f.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},f.Create=function(I,L){var G=null;switch(I.type){case f.e_distanceJoint:G=new a(I instanceof c?I:null);break;case f.e_mouseJoint:G=new A(I instanceof D?I:null);break;case f.e_prismaticJoint:G=new N(I instanceof z?I:null);break;case f.e_revoluteJoint:G=new U(I instanceof K?I:null);break;case f.e_pulleyJoint:G=new M(I instanceof J?I:null);break;case f.e_gearJoint:G=new u(I instanceof _?I:null);break;case f.e_lineJoint:G=new m(I instanceof v?I:null);break;case f.e_weldJoint:G=new tt(I instanceof rt?I:null);break;case f.e_frictionJoint:G=new l(I instanceof h?I:null);break}return G},f.Destroy=function(I,L){},f.prototype.b2Joint=function(I){t.b2Assert(I.bodyA!=I.bodyB),this.m_type=I.type,this.m_prev=null,this.m_next=null,this.m_bodyA=I.bodyA,this.m_bodyB=I.bodyB,this.m_collideConnected=I.collideConnected,this.m_islandFlag=!1,this.m_userData=I.userData},f.prototype.InitVelocityConstraints=function(I){},f.prototype.SolveVelocityConstraints=function(I){},f.prototype.FinalizeVelocityConstraints=function(){},f.prototype.SolvePositionConstraints=function(I){return!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),T.b2JointDef=function(){},T.prototype.b2JointDef=function(){this.type=f.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},x.b2JointEdge=function(){},Box2D.inherit(m,Box2D.Dynamics.Joints.b2Joint),m.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,m.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_localXAxis1=new s,this.m_localYAxis1=new s,this.m_axis=new s,this.m_perp=new s,this.m_K=new e,this.m_impulse=new s},m.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},m.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},m.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),I*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},m.prototype.GetReactionTorque=function(I){return I===void 0&&(I=0),I*this.m_impulse.y},m.prototype.GetJointTranslation=function(){var I=this.m_bodyA,L=this.m_bodyB,G=I.GetWorldPoint(this.m_localAnchor1),w=L.GetWorldPoint(this.m_localAnchor2),O=w.x-G.x,j=w.y-G.y,Q=I.GetWorldVector(this.m_localXAxis1),C=Q.x*O+Q.y*j;return C},m.prototype.GetJointSpeed=function(){var I=this.m_bodyA,L=this.m_bodyB,G;G=I.m_xf.R;var w=this.m_localAnchor1.x-I.m_sweep.localCenter.x,O=this.m_localAnchor1.y-I.m_sweep.localCenter.y,j=G.col1.x*w+G.col2.x*O;O=G.col1.y*w+G.col2.y*O,w=j,G=L.m_xf.R;var Q=this.m_localAnchor2.x-L.m_sweep.localCenter.x,C=this.m_localAnchor2.y-L.m_sweep.localCenter.y;j=G.col1.x*Q+G.col2.x*C,C=G.col1.y*Q+G.col2.y*C,Q=j;var b=I.m_sweep.c.x+w,W=I.m_sweep.c.y+O,S=L.m_sweep.c.x+Q,E=L.m_sweep.c.y+C,R=S-b,F=E-W,k=I.GetWorldVector(this.m_localXAxis1),X=I.m_linearVelocity,Z=L.m_linearVelocity,V=I.m_angularVelocity,Y=L.m_angularVelocity,$=R*(-V*k.y)+F*(V*k.x)+(k.x*(Z.x+-Y*C-X.x- -V*O)+k.y*(Z.y+Y*Q-X.y-V*w));return $},m.prototype.IsLimitEnabled=function(){return this.m_enableLimit},m.prototype.EnableLimit=function(I){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=I},m.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},m.prototype.GetUpperLimit=function(){return this.m_upperTranslation},m.prototype.SetLimits=function(I,L){I===void 0&&(I=0),L===void 0&&(L=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=I,this.m_upperTranslation=L},m.prototype.IsMotorEnabled=function(){return this.m_enableMotor},m.prototype.EnableMotor=function(I){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=I},m.prototype.SetMotorSpeed=function(I){I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=I},m.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},m.prototype.SetMaxMotorForce=function(I){I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=I},m.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},m.prototype.GetMotorForce=function(){return this.m_motorImpulse},m.prototype.b2LineJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchor1.SetV(I.localAnchorA),this.m_localAnchor2.SetV(I.localAnchorB),this.m_localXAxis1.SetV(I.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=I.lowerTranslation,this.m_upperTranslation=I.upperTranslation,this.m_maxMotorForce=I.maxMotorForce,this.m_motorSpeed=I.motorSpeed,this.m_enableLimit=I.enableLimit,this.m_enableMotor=I.enableMotor,this.m_limitState=f.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},m.prototype.InitVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w,O=0;this.m_localCenterA.SetV(L.GetLocalCenter()),this.m_localCenterB.SetV(G.GetLocalCenter());var j=L.GetTransform();G.GetTransform(),w=L.m_xf.R;var Q=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y;O=w.col1.x*Q+w.col2.x*C,C=w.col1.y*Q+w.col2.y*C,Q=O,w=G.m_xf.R;var b=this.m_localAnchor2.x-this.m_localCenterB.x,W=this.m_localAnchor2.y-this.m_localCenterB.y;O=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=O;var S=G.m_sweep.c.x+b-L.m_sweep.c.x-Q,E=G.m_sweep.c.y+W-L.m_sweep.c.y-C;this.m_invMassA=L.m_invMass,this.m_invMassB=G.m_invMass,this.m_invIA=L.m_invI,this.m_invIB=G.m_invI,this.m_axis.SetV(n.MulMV(j.R,this.m_localXAxis1)),this.m_a1=(S+Q)*this.m_axis.y-(E+C)*this.m_axis.x,this.m_a2=b*this.m_axis.y-W*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;{this.m_perp.SetV(n.MulMV(j.R,this.m_localYAxis1)),this.m_s1=(S+Q)*this.m_perp.y-(E+C)*this.m_perp.x,this.m_s2=b*this.m_perp.y-W*this.m_perp.x;var R=this.m_invMassA,F=this.m_invMassB,k=this.m_invIA,X=this.m_invIB;this.m_K.col1.x=R+F+k*this.m_s1*this.m_s1+X*this.m_s2*this.m_s2,this.m_K.col1.y=k*this.m_s1*this.m_a1+X*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=R+F+k*this.m_a1*this.m_a1+X*this.m_a2*this.m_a2}if(this.m_enableLimit){var Z=this.m_axis.x*S+this.m_axis.y*E;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=f.e_equalLimits:Z<=this.m_lowerTranslation?this.m_limitState!=f.e_atLowerLimit&&(this.m_limitState=f.e_atLowerLimit,this.m_impulse.y=0):Z>=this.m_upperTranslation?this.m_limitState!=f.e_atUpperLimit&&(this.m_limitState=f.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=f.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=f.e_inactiveLimit;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),I.warmStarting){this.m_impulse.x*=I.dtRatio,this.m_impulse.y*=I.dtRatio,this.m_motorImpulse*=I.dtRatio;var V=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,Y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,$=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,et=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;L.m_linearVelocity.x-=this.m_invMassA*V,L.m_linearVelocity.y-=this.m_invMassA*Y,L.m_angularVelocity-=this.m_invIA*$,G.m_linearVelocity.x+=this.m_invMassB*V,G.m_linearVelocity.y+=this.m_invMassB*Y,G.m_angularVelocity+=this.m_invIB*et}else this.m_impulse.SetZero(),this.m_motorImpulse=0},m.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w=L.m_linearVelocity,O=L.m_angularVelocity,j=G.m_linearVelocity,Q=G.m_angularVelocity,C=0,b=0,W=0,S=0;if(this.m_enableMotor&&this.m_limitState!=f.e_equalLimits){var E=this.m_axis.x*(j.x-w.x)+this.m_axis.y*(j.y-w.y)+this.m_a2*Q-this.m_a1*O,R=this.m_motorMass*(this.m_motorSpeed-E),F=this.m_motorImpulse,k=I.dt*this.m_maxMotorForce;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+R,-k,k),R=this.m_motorImpulse-F,C=R*this.m_axis.x,b=R*this.m_axis.y,W=R*this.m_a1,S=R*this.m_a2,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}var X=this.m_perp.x*(j.x-w.x)+this.m_perp.y*(j.y-w.y)+this.m_s2*Q-this.m_s1*O;if(this.m_enableLimit&&this.m_limitState!=f.e_inactiveLimit){var Z=this.m_axis.x*(j.x-w.x)+this.m_axis.y*(j.y-w.y)+this.m_a2*Q-this.m_a1*O,V=this.m_impulse.Copy(),Y=this.m_K.Solve(new s,-X,-Z);this.m_impulse.Add(Y),this.m_limitState==f.e_atLowerLimit?this.m_impulse.y=n.Max(this.m_impulse.y,0):this.m_limitState==f.e_atUpperLimit&&(this.m_impulse.y=n.Min(this.m_impulse.y,0));var $=-X-(this.m_impulse.y-V.y)*this.m_K.col2.x,et=0;this.m_K.col1.x!=0?et=$/this.m_K.col1.x+V.x:et=V.x,this.m_impulse.x=et,Y.x=this.m_impulse.x-V.x,Y.y=this.m_impulse.y-V.y,C=Y.x*this.m_perp.x+Y.y*this.m_axis.x,b=Y.x*this.m_perp.y+Y.y*this.m_axis.y,W=Y.x*this.m_s1+Y.y*this.m_a1,S=Y.x*this.m_s2+Y.y*this.m_a2,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}else{var ct=0;this.m_K.col1.x!=0?ct=-X/this.m_K.col1.x:ct=0,this.m_impulse.x+=ct,C=ct*this.m_perp.x,b=ct*this.m_perp.y,W=ct*this.m_s1,S=ct*this.m_s2,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}L.m_linearVelocity.SetV(w),L.m_angularVelocity=O,G.m_linearVelocity.SetV(j),G.m_angularVelocity=Q},m.prototype.SolvePositionConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w=L.m_sweep.c,O=L.m_sweep.a,j=G.m_sweep.c,Q=G.m_sweep.a,C,b=0,W=0,S=0,E=0,R=0,F=0,k=0,X=!1,Z=0,V=e.FromAngle(O),Y=e.FromAngle(Q);C=V;var $=this.m_localAnchor1.x-this.m_localCenterA.x,et=this.m_localAnchor1.y-this.m_localCenterA.y;b=C.col1.x*$+C.col2.x*et,et=C.col1.y*$+C.col2.y*et,$=b,C=Y;var ct=this.m_localAnchor2.x-this.m_localCenterB.x,ht=this.m_localAnchor2.y-this.m_localCenterB.y;b=C.col1.x*ct+C.col2.x*ht,ht=C.col1.y*ct+C.col2.y*ht,ct=b;var pt=j.x+ct-w.x-$,mt=j.y+ht-w.y-et;if(this.m_enableLimit){this.m_axis=n.MulMV(V,this.m_localXAxis1),this.m_a1=(pt+$)*this.m_axis.y-(mt+et)*this.m_axis.x,this.m_a2=ct*this.m_axis.y-ht*this.m_axis.x;var dt=this.m_axis.x*pt+this.m_axis.y*mt;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(Z=n.Clamp(dt,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),F=n.Abs(dt),X=!0):dt<=this.m_lowerTranslation?(Z=n.Clamp(dt-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),F=this.m_lowerTranslation-dt,X=!0):dt>=this.m_upperTranslation&&(Z=n.Clamp(dt-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),F=dt-this.m_upperTranslation,X=!0)}this.m_perp=n.MulMV(V,this.m_localYAxis1),this.m_s1=(pt+$)*this.m_perp.y-(mt+et)*this.m_perp.x,this.m_s2=ct*this.m_perp.y-ht*this.m_perp.x;var xt=new s,Tt=this.m_perp.x*pt+this.m_perp.y*mt;if(F=n.Max(F,n.Abs(Tt)),k=0,X)W=this.m_invMassA,S=this.m_invMassB,E=this.m_invIA,R=this.m_invIB,this.m_K.col1.x=W+S+E*this.m_s1*this.m_s1+R*this.m_s2*this.m_s2,this.m_K.col1.y=E*this.m_s1*this.m_a1+R*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=W+S+E*this.m_a1*this.m_a1+R*this.m_a2*this.m_a2,this.m_K.Solve(xt,-Tt,-Z);else{W=this.m_invMassA,S=this.m_invMassB,E=this.m_invIA,R=this.m_invIB;var lt=W+S+E*this.m_s1*this.m_s1+R*this.m_s2*this.m_s2,at=0;lt!=0?at=-Tt/lt:at=0,xt.x=at,xt.y=0}var At=xt.x*this.m_perp.x+xt.y*this.m_axis.x,St=xt.x*this.m_perp.y+xt.y*this.m_axis.y,wt=xt.x*this.m_s1+xt.y*this.m_a1,Pt=xt.x*this.m_s2+xt.y*this.m_a2;return w.x-=this.m_invMassA*At,w.y-=this.m_invMassA*St,O-=this.m_invIA*wt,j.x+=this.m_invMassB*At,j.y+=this.m_invMassB*St,Q+=this.m_invIB*Pt,L.m_sweep.a=O,G.m_sweep.a=Q,L.SynchronizeTransform(),G.SynchronizeTransform(),F<=t.b2_linearSlop&&k<=t.b2_angularSlop},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s,this.localAxisA=new s},v.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},v.prototype.Initialize=function(I,L,G,w){this.bodyA=I,this.bodyB=L,this.localAnchorA=this.bodyA.GetLocalPoint(G),this.localAnchorB=this.bodyB.GetLocalPoint(G),this.localAxisA=this.bodyA.GetLocalVector(w)},Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint),A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,A.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.m_localAnchor=new s,this.m_target=new s,this.m_impulse=new s,this.m_mass=new e,this.m_C=new s},A.prototype.GetAnchorA=function(){return this.m_target},A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},A.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse.x,I*this.m_impulse.y)},A.prototype.GetReactionTorque=function(I){return 0},A.prototype.GetTarget=function(){return this.m_target},A.prototype.SetTarget=function(I){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0),this.m_target=I},A.prototype.GetMaxForce=function(){return this.m_maxForce},A.prototype.SetMaxForce=function(I){I===void 0&&(I=0),this.m_maxForce=I},A.prototype.GetFrequency=function(){return this.m_frequencyHz},A.prototype.SetFrequency=function(I){I===void 0&&(I=0),this.m_frequencyHz=I},A.prototype.GetDampingRatio=function(){return this.m_dampingRatio},A.prototype.SetDampingRatio=function(I){I===void 0&&(I=0),this.m_dampingRatio=I},A.prototype.b2MouseJoint=function(I){this.__super.b2Joint.call(this,I),this.m_target.SetV(I.target);var L=this.m_target.x-this.m_bodyB.m_xf.position.x,G=this.m_target.y-this.m_bodyB.m_xf.position.y,w=this.m_bodyB.m_xf.R;this.m_localAnchor.x=L*w.col1.x+G*w.col1.y,this.m_localAnchor.y=L*w.col2.x+G*w.col2.y,this.m_maxForce=I.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=I.frequencyHz,this.m_dampingRatio=I.dampingRatio,this.m_beta=0,this.m_gamma=0},A.prototype.InitVelocityConstraints=function(I){var L=this.m_bodyB,G=L.GetMass(),w=2*Math.PI*this.m_frequencyHz,O=2*G*this.m_dampingRatio*w,j=G*w*w;this.m_gamma=I.dt*(O+I.dt*j),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=I.dt*j*this.m_gamma;var Q;Q=L.m_xf.R;var C=this.m_localAnchor.x-L.m_sweep.localCenter.x,b=this.m_localAnchor.y-L.m_sweep.localCenter.y,W=Q.col1.x*C+Q.col2.x*b;b=Q.col1.y*C+Q.col2.y*b,C=W;var S=L.m_invMass,E=L.m_invI;this.K1.col1.x=S,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=S,this.K2.col1.x=E*b*b,this.K2.col2.x=-E*C*b,this.K2.col1.y=-E*C*b,this.K2.col2.y=E*C*C,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=L.m_sweep.c.x+C-this.m_target.x,this.m_C.y=L.m_sweep.c.y+b-this.m_target.y,L.m_angularVelocity*=.98,this.m_impulse.x*=I.dtRatio,this.m_impulse.y*=I.dtRatio,L.m_linearVelocity.x+=S*this.m_impulse.x,L.m_linearVelocity.y+=S*this.m_impulse.y,L.m_angularVelocity+=E*(C*this.m_impulse.y-b*this.m_impulse.x)},A.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyB,G,w=0,O=0;G=L.m_xf.R;var j=this.m_localAnchor.x-L.m_sweep.localCenter.x,Q=this.m_localAnchor.y-L.m_sweep.localCenter.y;w=G.col1.x*j+G.col2.x*Q,Q=G.col1.y*j+G.col2.y*Q,j=w;var C=L.m_linearVelocity.x+-L.m_angularVelocity*Q,b=L.m_linearVelocity.y+L.m_angularVelocity*j;G=this.m_mass,w=C+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,O=b+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var W=-(G.col1.x*w+G.col2.x*O),S=-(G.col1.y*w+G.col2.y*O),E=this.m_impulse.x,R=this.m_impulse.y;this.m_impulse.x+=W,this.m_impulse.y+=S;var F=I.dt*this.m_maxForce;this.m_impulse.LengthSquared()>F*F&&this.m_impulse.Multiply(F/this.m_impulse.Length()),W=this.m_impulse.x-E,S=this.m_impulse.y-R,L.m_linearVelocity.x+=L.m_invMass*W,L.m_linearVelocity.y+=L.m_invMass*S,L.m_angularVelocity+=L.m_invI*(j*S-Q*W)},A.prototype.SolvePositionConstraints=function(I){return!0},Box2D.inherit(D,Box2D.Dynamics.Joints.b2JointDef),D.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,D.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new s},D.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(N,Box2D.Dynamics.Joints.b2Joint),N.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,N.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_localXAxis1=new s,this.m_localYAxis1=new s,this.m_axis=new s,this.m_perp=new s,this.m_K=new r,this.m_impulse=new o},N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},N.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),I*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},N.prototype.GetReactionTorque=function(I){return I===void 0&&(I=0),I*this.m_impulse.y},N.prototype.GetJointTranslation=function(){var I=this.m_bodyA,L=this.m_bodyB,G=I.GetWorldPoint(this.m_localAnchor1),w=L.GetWorldPoint(this.m_localAnchor2),O=w.x-G.x,j=w.y-G.y,Q=I.GetWorldVector(this.m_localXAxis1),C=Q.x*O+Q.y*j;return C},N.prototype.GetJointSpeed=function(){var I=this.m_bodyA,L=this.m_bodyB,G;G=I.m_xf.R;var w=this.m_localAnchor1.x-I.m_sweep.localCenter.x,O=this.m_localAnchor1.y-I.m_sweep.localCenter.y,j=G.col1.x*w+G.col2.x*O;O=G.col1.y*w+G.col2.y*O,w=j,G=L.m_xf.R;var Q=this.m_localAnchor2.x-L.m_sweep.localCenter.x,C=this.m_localAnchor2.y-L.m_sweep.localCenter.y;j=G.col1.x*Q+G.col2.x*C,C=G.col1.y*Q+G.col2.y*C,Q=j;var b=I.m_sweep.c.x+w,W=I.m_sweep.c.y+O,S=L.m_sweep.c.x+Q,E=L.m_sweep.c.y+C,R=S-b,F=E-W,k=I.GetWorldVector(this.m_localXAxis1),X=I.m_linearVelocity,Z=L.m_linearVelocity,V=I.m_angularVelocity,Y=L.m_angularVelocity,$=R*(-V*k.y)+F*(V*k.x)+(k.x*(Z.x+-Y*C-X.x- -V*O)+k.y*(Z.y+Y*Q-X.y-V*w));return $},N.prototype.IsLimitEnabled=function(){return this.m_enableLimit},N.prototype.EnableLimit=function(I){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=I},N.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},N.prototype.GetUpperLimit=function(){return this.m_upperTranslation},N.prototype.SetLimits=function(I,L){I===void 0&&(I=0),L===void 0&&(L=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=I,this.m_upperTranslation=L},N.prototype.IsMotorEnabled=function(){return this.m_enableMotor},N.prototype.EnableMotor=function(I){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=I},N.prototype.SetMotorSpeed=function(I){I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=I},N.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},N.prototype.SetMaxMotorForce=function(I){I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=I},N.prototype.GetMotorForce=function(){return this.m_motorImpulse},N.prototype.b2PrismaticJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchor1.SetV(I.localAnchorA),this.m_localAnchor2.SetV(I.localAnchorB),this.m_localXAxis1.SetV(I.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=I.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=I.lowerTranslation,this.m_upperTranslation=I.upperTranslation,this.m_maxMotorForce=I.maxMotorForce,this.m_motorSpeed=I.motorSpeed,this.m_enableLimit=I.enableLimit,this.m_enableMotor=I.enableMotor,this.m_limitState=f.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},N.prototype.InitVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w,O=0;this.m_localCenterA.SetV(L.GetLocalCenter()),this.m_localCenterB.SetV(G.GetLocalCenter());var j=L.GetTransform();G.GetTransform(),w=L.m_xf.R;var Q=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y;O=w.col1.x*Q+w.col2.x*C,C=w.col1.y*Q+w.col2.y*C,Q=O,w=G.m_xf.R;var b=this.m_localAnchor2.x-this.m_localCenterB.x,W=this.m_localAnchor2.y-this.m_localCenterB.y;O=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=O;var S=G.m_sweep.c.x+b-L.m_sweep.c.x-Q,E=G.m_sweep.c.y+W-L.m_sweep.c.y-C;this.m_invMassA=L.m_invMass,this.m_invMassB=G.m_invMass,this.m_invIA=L.m_invI,this.m_invIB=G.m_invI,this.m_axis.SetV(n.MulMV(j.R,this.m_localXAxis1)),this.m_a1=(S+Q)*this.m_axis.y-(E+C)*this.m_axis.x,this.m_a2=b*this.m_axis.y-W*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp.SetV(n.MulMV(j.R,this.m_localYAxis1)),this.m_s1=(S+Q)*this.m_perp.y-(E+C)*this.m_perp.x,this.m_s2=b*this.m_perp.y-W*this.m_perp.x;var R=this.m_invMassA,F=this.m_invMassB,k=this.m_invIA,X=this.m_invIB;this.m_K.col1.x=R+F+k*this.m_s1*this.m_s1+X*this.m_s2*this.m_s2,this.m_K.col1.y=k*this.m_s1+X*this.m_s2,this.m_K.col1.z=k*this.m_s1*this.m_a1+X*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=k+X,this.m_K.col2.z=k*this.m_a1+X*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=R+F+k*this.m_a1*this.m_a1+X*this.m_a2*this.m_a2}if(this.m_enableLimit){var Z=this.m_axis.x*S+this.m_axis.y*E;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?this.m_limitState=f.e_equalLimits:Z<=this.m_lowerTranslation?this.m_limitState!=f.e_atLowerLimit&&(this.m_limitState=f.e_atLowerLimit,this.m_impulse.z=0):Z>=this.m_upperTranslation?this.m_limitState!=f.e_atUpperLimit&&(this.m_limitState=f.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=f.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=f.e_inactiveLimit;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),I.warmStarting){this.m_impulse.x*=I.dtRatio,this.m_impulse.y*=I.dtRatio,this.m_motorImpulse*=I.dtRatio;var V=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,Y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,$=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,et=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;L.m_linearVelocity.x-=this.m_invMassA*V,L.m_linearVelocity.y-=this.m_invMassA*Y,L.m_angularVelocity-=this.m_invIA*$,G.m_linearVelocity.x+=this.m_invMassB*V,G.m_linearVelocity.y+=this.m_invMassB*Y,G.m_angularVelocity+=this.m_invIB*et}else this.m_impulse.SetZero(),this.m_motorImpulse=0},N.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w=L.m_linearVelocity,O=L.m_angularVelocity,j=G.m_linearVelocity,Q=G.m_angularVelocity,C=0,b=0,W=0,S=0;if(this.m_enableMotor&&this.m_limitState!=f.e_equalLimits){var E=this.m_axis.x*(j.x-w.x)+this.m_axis.y*(j.y-w.y)+this.m_a2*Q-this.m_a1*O,R=this.m_motorMass*(this.m_motorSpeed-E),F=this.m_motorImpulse,k=I.dt*this.m_maxMotorForce;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+R,-k,k),R=this.m_motorImpulse-F,C=R*this.m_axis.x,b=R*this.m_axis.y,W=R*this.m_a1,S=R*this.m_a2,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}var X=this.m_perp.x*(j.x-w.x)+this.m_perp.y*(j.y-w.y)+this.m_s2*Q-this.m_s1*O,Z=Q-O;if(this.m_enableLimit&&this.m_limitState!=f.e_inactiveLimit){var V=this.m_axis.x*(j.x-w.x)+this.m_axis.y*(j.y-w.y)+this.m_a2*Q-this.m_a1*O,Y=this.m_impulse.Copy(),$=this.m_K.Solve33(new o,-X,-Z,-V);this.m_impulse.Add($),this.m_limitState==f.e_atLowerLimit?this.m_impulse.z=n.Max(this.m_impulse.z,0):this.m_limitState==f.e_atUpperLimit&&(this.m_impulse.z=n.Min(this.m_impulse.z,0));var et=-X-(this.m_impulse.z-Y.z)*this.m_K.col3.x,ct=-Z-(this.m_impulse.z-Y.z)*this.m_K.col3.y,ht=this.m_K.Solve22(new s,et,ct);ht.x+=Y.x,ht.y+=Y.y,this.m_impulse.x=ht.x,this.m_impulse.y=ht.y,$.x=this.m_impulse.x-Y.x,$.y=this.m_impulse.y-Y.y,$.z=this.m_impulse.z-Y.z,C=$.x*this.m_perp.x+$.z*this.m_axis.x,b=$.x*this.m_perp.y+$.z*this.m_axis.y,W=$.x*this.m_s1+$.y+$.z*this.m_a1,S=$.x*this.m_s2+$.y+$.z*this.m_a2,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}else{var pt=this.m_K.Solve22(new s,-X,-Z);this.m_impulse.x+=pt.x,this.m_impulse.y+=pt.y,C=pt.x*this.m_perp.x,b=pt.x*this.m_perp.y,W=pt.x*this.m_s1+pt.y,S=pt.x*this.m_s2+pt.y,w.x-=this.m_invMassA*C,w.y-=this.m_invMassA*b,O-=this.m_invIA*W,j.x+=this.m_invMassB*C,j.y+=this.m_invMassB*b,Q+=this.m_invIB*S}L.m_linearVelocity.SetV(w),L.m_angularVelocity=O,G.m_linearVelocity.SetV(j),G.m_angularVelocity=Q},N.prototype.SolvePositionConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w=L.m_sweep.c,O=L.m_sweep.a,j=G.m_sweep.c,Q=G.m_sweep.a,C,b=0,W=0,S=0,E=0,R=0,F=0,k=0,X=!1,Z=0,V=e.FromAngle(O),Y=e.FromAngle(Q);C=V;var $=this.m_localAnchor1.x-this.m_localCenterA.x,et=this.m_localAnchor1.y-this.m_localCenterA.y;b=C.col1.x*$+C.col2.x*et,et=C.col1.y*$+C.col2.y*et,$=b,C=Y;var ct=this.m_localAnchor2.x-this.m_localCenterB.x,ht=this.m_localAnchor2.y-this.m_localCenterB.y;b=C.col1.x*ct+C.col2.x*ht,ht=C.col1.y*ct+C.col2.y*ht,ct=b;var pt=j.x+ct-w.x-$,mt=j.y+ht-w.y-et;if(this.m_enableLimit){this.m_axis=n.MulMV(V,this.m_localXAxis1),this.m_a1=(pt+$)*this.m_axis.y-(mt+et)*this.m_axis.x,this.m_a2=ct*this.m_axis.y-ht*this.m_axis.x;var dt=this.m_axis.x*pt+this.m_axis.y*mt;n.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*t.b2_linearSlop?(Z=n.Clamp(dt,-t.b2_maxLinearCorrection,t.b2_maxLinearCorrection),F=n.Abs(dt),X=!0):dt<=this.m_lowerTranslation?(Z=n.Clamp(dt-this.m_lowerTranslation+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),F=this.m_lowerTranslation-dt,X=!0):dt>=this.m_upperTranslation&&(Z=n.Clamp(dt-this.m_upperTranslation+t.b2_linearSlop,0,t.b2_maxLinearCorrection),F=dt-this.m_upperTranslation,X=!0)}this.m_perp=n.MulMV(V,this.m_localYAxis1),this.m_s1=(pt+$)*this.m_perp.y-(mt+et)*this.m_perp.x,this.m_s2=ct*this.m_perp.y-ht*this.m_perp.x;var xt=new o,Tt=this.m_perp.x*pt+this.m_perp.y*mt,lt=Q-O-this.m_refAngle;if(F=n.Max(F,n.Abs(Tt)),k=n.Abs(lt),X)W=this.m_invMassA,S=this.m_invMassB,E=this.m_invIA,R=this.m_invIB,this.m_K.col1.x=W+S+E*this.m_s1*this.m_s1+R*this.m_s2*this.m_s2,this.m_K.col1.y=E*this.m_s1+R*this.m_s2,this.m_K.col1.z=E*this.m_s1*this.m_a1+R*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=E+R,this.m_K.col2.z=E*this.m_a1+R*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=W+S+E*this.m_a1*this.m_a1+R*this.m_a2*this.m_a2,this.m_K.Solve33(xt,-Tt,-lt,-Z);else{W=this.m_invMassA,S=this.m_invMassB,E=this.m_invIA,R=this.m_invIB;var at=W+S+E*this.m_s1*this.m_s1+R*this.m_s2*this.m_s2,At=E*this.m_s1+R*this.m_s2,St=E+R;this.m_K.col1.Set(at,At,0),this.m_K.col2.Set(At,St,0);var wt=this.m_K.Solve22(new s,-Tt,-lt);xt.x=wt.x,xt.y=wt.y,xt.z=0}var Pt=xt.x*this.m_perp.x+xt.z*this.m_axis.x,It=xt.x*this.m_perp.y+xt.z*this.m_axis.y,zt=xt.x*this.m_s1+xt.y+xt.z*this.m_a1,Vt=xt.x*this.m_s2+xt.y+xt.z*this.m_a2;return w.x-=this.m_invMassA*Pt,w.y-=this.m_invMassA*It,O-=this.m_invIA*zt,j.x+=this.m_invMassB*Pt,j.y+=this.m_invMassB*It,Q+=this.m_invIB*Vt,L.m_sweep.a=O,G.m_sweep.a=Q,L.SynchronizeTransform(),G.SynchronizeTransform(),F<=t.b2_linearSlop&&k<=t.b2_angularSlop},Box2D.inherit(z,Box2D.Dynamics.Joints.b2JointDef),z.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,z.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s,this.localAxisA=new s},z.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},z.prototype.Initialize=function(I,L,G,w){this.bodyA=I,this.bodyB=L,this.localAnchorA=this.bodyA.GetLocalPoint(G),this.localAnchorB=this.bodyB.GetLocalPoint(G),this.localAxisA=this.bodyA.GetLocalVector(w),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(M,Box2D.Dynamics.Joints.b2Joint),M.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,M.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new s,this.m_groundAnchor2=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_u1=new s,this.m_u2=new s},M.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},M.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},M.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse*this.m_u2.x,I*this.m_impulse*this.m_u2.y)},M.prototype.GetReactionTorque=function(I){return 0},M.prototype.GetGroundAnchorA=function(){var I=this.m_ground.m_xf.position.Copy();return I.Add(this.m_groundAnchor1),I},M.prototype.GetGroundAnchorB=function(){var I=this.m_ground.m_xf.position.Copy();return I.Add(this.m_groundAnchor2),I},M.prototype.GetLength1=function(){var I=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),L=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,G=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,w=I.x-L,O=I.y-G;return Math.sqrt(w*w+O*O)},M.prototype.GetLength2=function(){var I=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),L=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,G=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,w=I.x-L,O=I.y-G;return Math.sqrt(w*w+O*O)},M.prototype.GetRatio=function(){return this.m_ratio},M.prototype.b2PulleyJoint=function(I){this.__super.b2Joint.call(this,I),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=I.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=I.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=I.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=I.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(I.localAnchorA),this.m_localAnchor2.SetV(I.localAnchorB),this.m_ratio=I.ratio,this.m_constant=I.lengthA+this.m_ratio*I.lengthB,this.m_maxLength1=n.Min(I.maxLengthA,this.m_constant-this.m_ratio*M.b2_minPulleyLength),this.m_maxLength2=n.Min(I.maxLengthB,(this.m_constant-M.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},M.prototype.InitVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w;w=L.m_xf.R;var O=this.m_localAnchor1.x-L.m_sweep.localCenter.x,j=this.m_localAnchor1.y-L.m_sweep.localCenter.y,Q=w.col1.x*O+w.col2.x*j;j=w.col1.y*O+w.col2.y*j,O=Q,w=G.m_xf.R;var C=this.m_localAnchor2.x-G.m_sweep.localCenter.x,b=this.m_localAnchor2.y-G.m_sweep.localCenter.y;Q=w.col1.x*C+w.col2.x*b,b=w.col1.y*C+w.col2.y*b,C=Q;var W=L.m_sweep.c.x+O,S=L.m_sweep.c.y+j,E=G.m_sweep.c.x+C,R=G.m_sweep.c.y+b,F=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,X=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,Z=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(W-F,S-k),this.m_u2.Set(E-X,R-Z);var V=this.m_u1.Length(),Y=this.m_u2.Length();V>t.b2_linearSlop?this.m_u1.Multiply(1/V):this.m_u1.SetZero(),Y>t.b2_linearSlop?this.m_u2.Multiply(1/Y):this.m_u2.SetZero();var $=this.m_constant-V-this.m_ratio*Y;$>0?(this.m_state=f.e_inactiveLimit,this.m_impulse=0):this.m_state=f.e_atUpperLimit,V<this.m_maxLength1?(this.m_limitState1=f.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=f.e_atUpperLimit,Y<this.m_maxLength2?(this.m_limitState2=f.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=f.e_atUpperLimit;var et=O*this.m_u1.y-j*this.m_u1.x,ct=C*this.m_u2.y-b*this.m_u2.x;if(this.m_limitMass1=L.m_invMass+L.m_invI*et*et,this.m_limitMass2=G.m_invMass+G.m_invI*ct*ct,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,I.warmStarting){this.m_impulse*=I.dtRatio,this.m_limitImpulse1*=I.dtRatio,this.m_limitImpulse2*=I.dtRatio;var ht=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,pt=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,mt=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,dt=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;L.m_linearVelocity.x+=L.m_invMass*ht,L.m_linearVelocity.y+=L.m_invMass*pt,L.m_angularVelocity+=L.m_invI*(O*pt-j*ht),G.m_linearVelocity.x+=G.m_invMass*mt,G.m_linearVelocity.y+=G.m_invMass*dt,G.m_angularVelocity+=G.m_invI*(C*dt-b*mt)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},M.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w;w=L.m_xf.R;var O=this.m_localAnchor1.x-L.m_sweep.localCenter.x,j=this.m_localAnchor1.y-L.m_sweep.localCenter.y,Q=w.col1.x*O+w.col2.x*j;j=w.col1.y*O+w.col2.y*j,O=Q,w=G.m_xf.R;var C=this.m_localAnchor2.x-G.m_sweep.localCenter.x,b=this.m_localAnchor2.y-G.m_sweep.localCenter.y;Q=w.col1.x*C+w.col2.x*b,b=w.col1.y*C+w.col2.y*b,C=Q;var W=0,S=0,E=0,R=0,F=0,k=0,X=0,Z=0,V=0,Y=0,$=0;this.m_state==f.e_atUpperLimit&&(W=L.m_linearVelocity.x+-L.m_angularVelocity*j,S=L.m_linearVelocity.y+L.m_angularVelocity*O,E=G.m_linearVelocity.x+-G.m_angularVelocity*b,R=G.m_linearVelocity.y+G.m_angularVelocity*C,V=-(this.m_u1.x*W+this.m_u1.y*S)-this.m_ratio*(this.m_u2.x*E+this.m_u2.y*R),Y=this.m_pulleyMass*-V,$=this.m_impulse,this.m_impulse=n.Max(0,this.m_impulse+Y),Y=this.m_impulse-$,F=-Y*this.m_u1.x,k=-Y*this.m_u1.y,X=-this.m_ratio*Y*this.m_u2.x,Z=-this.m_ratio*Y*this.m_u2.y,L.m_linearVelocity.x+=L.m_invMass*F,L.m_linearVelocity.y+=L.m_invMass*k,L.m_angularVelocity+=L.m_invI*(O*k-j*F),G.m_linearVelocity.x+=G.m_invMass*X,G.m_linearVelocity.y+=G.m_invMass*Z,G.m_angularVelocity+=G.m_invI*(C*Z-b*X)),this.m_limitState1==f.e_atUpperLimit&&(W=L.m_linearVelocity.x+-L.m_angularVelocity*j,S=L.m_linearVelocity.y+L.m_angularVelocity*O,V=-(this.m_u1.x*W+this.m_u1.y*S),Y=-this.m_limitMass1*V,$=this.m_limitImpulse1,this.m_limitImpulse1=n.Max(0,this.m_limitImpulse1+Y),Y=this.m_limitImpulse1-$,F=-Y*this.m_u1.x,k=-Y*this.m_u1.y,L.m_linearVelocity.x+=L.m_invMass*F,L.m_linearVelocity.y+=L.m_invMass*k,L.m_angularVelocity+=L.m_invI*(O*k-j*F)),this.m_limitState2==f.e_atUpperLimit&&(E=G.m_linearVelocity.x+-G.m_angularVelocity*b,R=G.m_linearVelocity.y+G.m_angularVelocity*C,V=-(this.m_u2.x*E+this.m_u2.y*R),Y=-this.m_limitMass2*V,$=this.m_limitImpulse2,this.m_limitImpulse2=n.Max(0,this.m_limitImpulse2+Y),Y=this.m_limitImpulse2-$,X=-Y*this.m_u2.x,Z=-Y*this.m_u2.y,G.m_linearVelocity.x+=G.m_invMass*X,G.m_linearVelocity.y+=G.m_invMass*Z,G.m_angularVelocity+=G.m_invI*(C*Z-b*X))},M.prototype.SolvePositionConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w,O=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,j=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,Q=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,C=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,b=0,W=0,S=0,E=0,R=0,F=0,k=0,X=0,Z=0,V=0,Y=0,$=0,et=0,ct=0;return this.m_state==f.e_atUpperLimit&&(w=L.m_xf.R,b=this.m_localAnchor1.x-L.m_sweep.localCenter.x,W=this.m_localAnchor1.y-L.m_sweep.localCenter.y,et=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=et,w=G.m_xf.R,S=this.m_localAnchor2.x-G.m_sweep.localCenter.x,E=this.m_localAnchor2.y-G.m_sweep.localCenter.y,et=w.col1.x*S+w.col2.x*E,E=w.col1.y*S+w.col2.y*E,S=et,R=L.m_sweep.c.x+b,F=L.m_sweep.c.y+W,k=G.m_sweep.c.x+S,X=G.m_sweep.c.y+E,this.m_u1.Set(R-O,F-j),this.m_u2.Set(k-Q,X-C),Z=this.m_u1.Length(),V=this.m_u2.Length(),Z>t.b2_linearSlop?this.m_u1.Multiply(1/Z):this.m_u1.SetZero(),V>t.b2_linearSlop?this.m_u2.Multiply(1/V):this.m_u2.SetZero(),Y=this.m_constant-Z-this.m_ratio*V,ct=n.Max(ct,-Y),Y=n.Clamp(Y+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),$=-this.m_pulleyMass*Y,R=-$*this.m_u1.x,F=-$*this.m_u1.y,k=-this.m_ratio*$*this.m_u2.x,X=-this.m_ratio*$*this.m_u2.y,L.m_sweep.c.x+=L.m_invMass*R,L.m_sweep.c.y+=L.m_invMass*F,L.m_sweep.a+=L.m_invI*(b*F-W*R),G.m_sweep.c.x+=G.m_invMass*k,G.m_sweep.c.y+=G.m_invMass*X,G.m_sweep.a+=G.m_invI*(S*X-E*k),L.SynchronizeTransform(),G.SynchronizeTransform()),this.m_limitState1==f.e_atUpperLimit&&(w=L.m_xf.R,b=this.m_localAnchor1.x-L.m_sweep.localCenter.x,W=this.m_localAnchor1.y-L.m_sweep.localCenter.y,et=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=et,R=L.m_sweep.c.x+b,F=L.m_sweep.c.y+W,this.m_u1.Set(R-O,F-j),Z=this.m_u1.Length(),Z>t.b2_linearSlop?(this.m_u1.x*=1/Z,this.m_u1.y*=1/Z):this.m_u1.SetZero(),Y=this.m_maxLength1-Z,ct=n.Max(ct,-Y),Y=n.Clamp(Y+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),$=-this.m_limitMass1*Y,R=-$*this.m_u1.x,F=-$*this.m_u1.y,L.m_sweep.c.x+=L.m_invMass*R,L.m_sweep.c.y+=L.m_invMass*F,L.m_sweep.a+=L.m_invI*(b*F-W*R),L.SynchronizeTransform()),this.m_limitState2==f.e_atUpperLimit&&(w=G.m_xf.R,S=this.m_localAnchor2.x-G.m_sweep.localCenter.x,E=this.m_localAnchor2.y-G.m_sweep.localCenter.y,et=w.col1.x*S+w.col2.x*E,E=w.col1.y*S+w.col2.y*E,S=et,k=G.m_sweep.c.x+S,X=G.m_sweep.c.y+E,this.m_u2.Set(k-Q,X-C),V=this.m_u2.Length(),V>t.b2_linearSlop?(this.m_u2.x*=1/V,this.m_u2.y*=1/V):this.m_u2.SetZero(),Y=this.m_maxLength2-V,ct=n.Max(ct,-Y),Y=n.Clamp(Y+t.b2_linearSlop,-t.b2_maxLinearCorrection,0),$=-this.m_limitMass2*Y,k=-$*this.m_u2.x,X=-$*this.m_u2.y,G.m_sweep.c.x+=G.m_invMass*k,G.m_sweep.c.y+=G.m_invMass*X,G.m_sweep.a+=G.m_invI*(S*X-E*k),G.SynchronizeTransform()),ct<t.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(J,Box2D.Dynamics.Joints.b2JointDef),J.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,J.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new s,this.groundAnchorB=new s,this.localAnchorA=new s,this.localAnchorB=new s},J.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},J.prototype.Initialize=function(I,L,G,w,O,j,Q){Q===void 0&&(Q=0),this.bodyA=I,this.bodyB=L,this.groundAnchorA.SetV(G),this.groundAnchorB.SetV(w),this.localAnchorA=this.bodyA.GetLocalPoint(O),this.localAnchorB=this.bodyB.GetLocalPoint(j);var C=O.x-G.x,b=O.y-G.y;this.lengthA=Math.sqrt(C*C+b*b);var W=j.x-w.x,S=j.y-w.y;this.lengthB=Math.sqrt(W*W+S*S),this.ratio=Q;var E=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=E-this.ratio*M.b2_minPulleyLength,this.maxLengthB=(E-M.b2_minPulleyLength)/this.ratio},Box2D.inherit(U,Box2D.Dynamics.Joints.b2Joint),U.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,U.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new e,this.K1=new e,this.K2=new e,this.K3=new e,this.impulse3=new o,this.impulse2=new s,this.reduced=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_impulse=new o,this.m_mass=new r},U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},U.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse.x,I*this.m_impulse.y)},U.prototype.GetReactionTorque=function(I){return I===void 0&&(I=0),I*this.m_impulse.z},U.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},U.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},U.prototype.IsLimitEnabled=function(){return this.m_enableLimit},U.prototype.EnableLimit=function(I){this.m_enableLimit=I},U.prototype.GetLowerLimit=function(){return this.m_lowerAngle},U.prototype.GetUpperLimit=function(){return this.m_upperAngle},U.prototype.SetLimits=function(I,L){I===void 0&&(I=0),L===void 0&&(L=0),this.m_lowerAngle=I,this.m_upperAngle=L},U.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},U.prototype.EnableMotor=function(I){this.m_enableMotor=I},U.prototype.SetMotorSpeed=function(I){I===void 0&&(I=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=I},U.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},U.prototype.SetMaxMotorTorque=function(I){I===void 0&&(I=0),this.m_maxMotorTorque=I},U.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},U.prototype.b2RevoluteJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchor1.SetV(I.localAnchorA),this.m_localAnchor2.SetV(I.localAnchorB),this.m_referenceAngle=I.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=I.lowerAngle,this.m_upperAngle=I.upperAngle,this.m_maxMotorTorque=I.maxMotorTorque,this.m_motorSpeed=I.motorSpeed,this.m_enableLimit=I.enableLimit,this.m_enableMotor=I.enableMotor,this.m_limitState=f.e_inactiveLimit},U.prototype.InitVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w,O=0;this.m_enableMotor||this.m_enableLimit,w=L.m_xf.R;var j=this.m_localAnchor1.x-L.m_sweep.localCenter.x,Q=this.m_localAnchor1.y-L.m_sweep.localCenter.y;O=w.col1.x*j+w.col2.x*Q,Q=w.col1.y*j+w.col2.y*Q,j=O,w=G.m_xf.R;var C=this.m_localAnchor2.x-G.m_sweep.localCenter.x,b=this.m_localAnchor2.y-G.m_sweep.localCenter.y;O=w.col1.x*C+w.col2.x*b,b=w.col1.y*C+w.col2.y*b,C=O;var W=L.m_invMass,S=G.m_invMass,E=L.m_invI,R=G.m_invI;if(this.m_mass.col1.x=W+S+Q*Q*E+b*b*R,this.m_mass.col2.x=-Q*j*E-b*C*R,this.m_mass.col3.x=-Q*E-b*R,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=W+S+j*j*E+C*C*R,this.m_mass.col3.y=j*E+C*R,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=E+R,this.m_motorMass=1/(E+R),this.m_enableMotor==!1&&(this.m_motorImpulse=0),this.m_enableLimit){var F=G.m_sweep.a-L.m_sweep.a-this.m_referenceAngle;n.Abs(this.m_upperAngle-this.m_lowerAngle)<2*t.b2_angularSlop?this.m_limitState=f.e_equalLimits:F<=this.m_lowerAngle?(this.m_limitState!=f.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=f.e_atLowerLimit):F>=this.m_upperAngle?(this.m_limitState!=f.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=f.e_atUpperLimit):(this.m_limitState=f.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=f.e_inactiveLimit;if(I.warmStarting){this.m_impulse.x*=I.dtRatio,this.m_impulse.y*=I.dtRatio,this.m_motorImpulse*=I.dtRatio;var k=this.m_impulse.x,X=this.m_impulse.y;L.m_linearVelocity.x-=W*k,L.m_linearVelocity.y-=W*X,L.m_angularVelocity-=E*(j*X-Q*k+this.m_motorImpulse+this.m_impulse.z),G.m_linearVelocity.x+=S*k,G.m_linearVelocity.y+=S*X,G.m_angularVelocity+=R*(C*X-b*k+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},U.prototype.SolveVelocityConstraints=function(I){var L=this.m_bodyA,G=this.m_bodyB,w,O=0,j=0,Q=0,C=0,b=0,W=0,S=L.m_linearVelocity,E=L.m_angularVelocity,R=G.m_linearVelocity,F=G.m_angularVelocity,k=L.m_invMass,X=G.m_invMass,Z=L.m_invI,V=G.m_invI;if(this.m_enableMotor&&this.m_limitState!=f.e_equalLimits){var Y=F-E-this.m_motorSpeed,$=this.m_motorMass*-Y,et=this.m_motorImpulse,ct=I.dt*this.m_maxMotorTorque;this.m_motorImpulse=n.Clamp(this.m_motorImpulse+$,-ct,ct),$=this.m_motorImpulse-et,E-=Z*$,F+=V*$}if(this.m_enableLimit&&this.m_limitState!=f.e_inactiveLimit){w=L.m_xf.R,Q=this.m_localAnchor1.x-L.m_sweep.localCenter.x,C=this.m_localAnchor1.y-L.m_sweep.localCenter.y,O=w.col1.x*Q+w.col2.x*C,C=w.col1.y*Q+w.col2.y*C,Q=O,w=G.m_xf.R,b=this.m_localAnchor2.x-G.m_sweep.localCenter.x,W=this.m_localAnchor2.y-G.m_sweep.localCenter.y,O=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=O;var ht=R.x+-F*W-S.x- -E*C,pt=R.y+F*b-S.y-E*Q,mt=F-E;this.m_mass.Solve33(this.impulse3,-ht,-pt,-mt),this.m_limitState==f.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==f.e_atLowerLimit?(j=this.m_impulse.z+this.impulse3.z,j<0&&(this.m_mass.Solve22(this.reduced,-ht,-pt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==f.e_atUpperLimit&&(j=this.m_impulse.z+this.impulse3.z,j>0&&(this.m_mass.Solve22(this.reduced,-ht,-pt),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),S.x-=k*this.impulse3.x,S.y-=k*this.impulse3.y,E-=Z*(Q*this.impulse3.y-C*this.impulse3.x+this.impulse3.z),R.x+=X*this.impulse3.x,R.y+=X*this.impulse3.y,F+=V*(b*this.impulse3.y-W*this.impulse3.x+this.impulse3.z)}else{w=L.m_xf.R,Q=this.m_localAnchor1.x-L.m_sweep.localCenter.x,C=this.m_localAnchor1.y-L.m_sweep.localCenter.y,O=w.col1.x*Q+w.col2.x*C,C=w.col1.y*Q+w.col2.y*C,Q=O,w=G.m_xf.R,b=this.m_localAnchor2.x-G.m_sweep.localCenter.x,W=this.m_localAnchor2.y-G.m_sweep.localCenter.y,O=w.col1.x*b+w.col2.x*W,W=w.col1.y*b+w.col2.y*W,b=O;var dt=R.x+-F*W-S.x- -E*C,xt=R.y+F*b-S.y-E*Q;this.m_mass.Solve22(this.impulse2,-dt,-xt),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,S.x-=k*this.impulse2.x,S.y-=k*this.impulse2.y,E-=Z*(Q*this.impulse2.y-C*this.impulse2.x),R.x+=X*this.impulse2.x,R.y+=X*this.impulse2.y,F+=V*(b*this.impulse2.y-W*this.impulse2.x)}L.m_linearVelocity.SetV(S),L.m_angularVelocity=E,G.m_linearVelocity.SetV(R),G.m_angularVelocity=F},U.prototype.SolvePositionConstraints=function(I){var L=0,G,w=this.m_bodyA,O=this.m_bodyB,j=0,Q=0,C=0,b=0,W=0;if(this.m_enableLimit&&this.m_limitState!=f.e_inactiveLimit){var S=O.m_sweep.a-w.m_sweep.a-this.m_referenceAngle,E=0;this.m_limitState==f.e_equalLimits?(L=n.Clamp(S-this.m_lowerAngle,-t.b2_maxAngularCorrection,t.b2_maxAngularCorrection),E=-this.m_motorMass*L,j=n.Abs(L)):this.m_limitState==f.e_atLowerLimit?(L=S-this.m_lowerAngle,j=-L,L=n.Clamp(L+t.b2_angularSlop,-t.b2_maxAngularCorrection,0),E=-this.m_motorMass*L):this.m_limitState==f.e_atUpperLimit&&(L=S-this.m_upperAngle,j=L,L=n.Clamp(L-t.b2_angularSlop,0,t.b2_maxAngularCorrection),E=-this.m_motorMass*L),w.m_sweep.a-=w.m_invI*E,O.m_sweep.a+=O.m_invI*E,w.SynchronizeTransform(),O.SynchronizeTransform()}{G=w.m_xf.R;var R=this.m_localAnchor1.x-w.m_sweep.localCenter.x,F=this.m_localAnchor1.y-w.m_sweep.localCenter.y;C=G.col1.x*R+G.col2.x*F,F=G.col1.y*R+G.col2.y*F,R=C,G=O.m_xf.R;var k=this.m_localAnchor2.x-O.m_sweep.localCenter.x,X=this.m_localAnchor2.y-O.m_sweep.localCenter.y;C=G.col1.x*k+G.col2.x*X,X=G.col1.y*k+G.col2.y*X,k=C;var Z=O.m_sweep.c.x+k-w.m_sweep.c.x-R,V=O.m_sweep.c.y+X-w.m_sweep.c.y-F,Y=Z*Z+V*V,$=Math.sqrt(Y);Q=$;var et=w.m_invMass,ct=O.m_invMass,ht=w.m_invI,pt=O.m_invI,mt=10*t.b2_linearSlop;if(Y>mt*mt){var dt=et+ct,xt=1/dt;b=xt*-Z,W=xt*-V;var Tt=.5;w.m_sweep.c.x-=Tt*et*b,w.m_sweep.c.y-=Tt*et*W,O.m_sweep.c.x+=Tt*ct*b,O.m_sweep.c.y+=Tt*ct*W,Z=O.m_sweep.c.x+k-w.m_sweep.c.x-R,V=O.m_sweep.c.y+X-w.m_sweep.c.y-F}this.K1.col1.x=et+ct,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=et+ct,this.K2.col1.x=ht*F*F,this.K2.col2.x=-ht*R*F,this.K2.col1.y=-ht*R*F,this.K2.col2.y=ht*R*R,this.K3.col1.x=pt*X*X,this.K3.col2.x=-pt*k*X,this.K3.col1.y=-pt*k*X,this.K3.col2.y=pt*k*k,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(U.tImpulse,-Z,-V),b=U.tImpulse.x,W=U.tImpulse.y,w.m_sweep.c.x-=w.m_invMass*b,w.m_sweep.c.y-=w.m_invMass*W,w.m_sweep.a-=w.m_invI*(R*W-F*b),O.m_sweep.c.x+=O.m_invMass*b,O.m_sweep.c.y+=O.m_invMass*W,O.m_sweep.a+=O.m_invI*(k*W-X*b),w.SynchronizeTransform(),O.SynchronizeTransform()}return Q<=t.b2_linearSlop&&j<=t.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new s}),Box2D.inherit(K,Box2D.Dynamics.Joints.b2JointDef),K.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,K.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},K.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},K.prototype.Initialize=function(I,L,G){this.bodyA=I,this.bodyB=L,this.localAnchorA=this.bodyA.GetLocalPoint(G),this.localAnchorB=this.bodyB.GetLocalPoint(G),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(tt,Box2D.Dynamics.Joints.b2Joint),tt.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,tt.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new s,this.m_localAnchorB=new s,this.m_impulse=new o,this.m_mass=new r},tt.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},tt.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},tt.prototype.GetReactionForce=function(I){return I===void 0&&(I=0),new s(I*this.m_impulse.x,I*this.m_impulse.y)},tt.prototype.GetReactionTorque=function(I){return I===void 0&&(I=0),I*this.m_impulse.z},tt.prototype.b2WeldJoint=function(I){this.__super.b2Joint.call(this,I),this.m_localAnchorA.SetV(I.localAnchorA),this.m_localAnchorB.SetV(I.localAnchorB),this.m_referenceAngle=I.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new r},tt.prototype.InitVelocityConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB;L=w.m_xf.R;var j=this.m_localAnchorA.x-w.m_sweep.localCenter.x,Q=this.m_localAnchorA.y-w.m_sweep.localCenter.y;G=L.col1.x*j+L.col2.x*Q,Q=L.col1.y*j+L.col2.y*Q,j=G,L=O.m_xf.R;var C=this.m_localAnchorB.x-O.m_sweep.localCenter.x,b=this.m_localAnchorB.y-O.m_sweep.localCenter.y;G=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=G;var W=w.m_invMass,S=O.m_invMass,E=w.m_invI,R=O.m_invI;this.m_mass.col1.x=W+S+Q*Q*E+b*b*R,this.m_mass.col2.x=-Q*j*E-b*C*R,this.m_mass.col3.x=-Q*E-b*R,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=W+S+j*j*E+C*C*R,this.m_mass.col3.y=j*E+C*R,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=E+R,I.warmStarting?(this.m_impulse.x*=I.dtRatio,this.m_impulse.y*=I.dtRatio,this.m_impulse.z*=I.dtRatio,w.m_linearVelocity.x-=W*this.m_impulse.x,w.m_linearVelocity.y-=W*this.m_impulse.y,w.m_angularVelocity-=E*(j*this.m_impulse.y-Q*this.m_impulse.x+this.m_impulse.z),O.m_linearVelocity.x+=S*this.m_impulse.x,O.m_linearVelocity.y+=S*this.m_impulse.y,O.m_angularVelocity+=R*(C*this.m_impulse.y-b*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},tt.prototype.SolveVelocityConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB,j=w.m_linearVelocity,Q=w.m_angularVelocity,C=O.m_linearVelocity,b=O.m_angularVelocity,W=w.m_invMass,S=O.m_invMass,E=w.m_invI,R=O.m_invI;L=w.m_xf.R;var F=this.m_localAnchorA.x-w.m_sweep.localCenter.x,k=this.m_localAnchorA.y-w.m_sweep.localCenter.y;G=L.col1.x*F+L.col2.x*k,k=L.col1.y*F+L.col2.y*k,F=G,L=O.m_xf.R;var X=this.m_localAnchorB.x-O.m_sweep.localCenter.x,Z=this.m_localAnchorB.y-O.m_sweep.localCenter.y;G=L.col1.x*X+L.col2.x*Z,Z=L.col1.y*X+L.col2.y*Z,X=G;var V=C.x-b*Z-j.x+Q*k,Y=C.y+b*X-j.y-Q*F,$=b-Q,et=new o;this.m_mass.Solve33(et,-V,-Y,-$),this.m_impulse.Add(et),j.x-=W*et.x,j.y-=W*et.y,Q-=E*(F*et.y-k*et.x+et.z),C.x+=S*et.x,C.y+=S*et.y,b+=R*(X*et.y-Z*et.x+et.z),w.m_angularVelocity=Q,O.m_angularVelocity=b},tt.prototype.SolvePositionConstraints=function(I){var L,G=0,w=this.m_bodyA,O=this.m_bodyB;L=w.m_xf.R;var j=this.m_localAnchorA.x-w.m_sweep.localCenter.x,Q=this.m_localAnchorA.y-w.m_sweep.localCenter.y;G=L.col1.x*j+L.col2.x*Q,Q=L.col1.y*j+L.col2.y*Q,j=G,L=O.m_xf.R;var C=this.m_localAnchorB.x-O.m_sweep.localCenter.x,b=this.m_localAnchorB.y-O.m_sweep.localCenter.y;G=L.col1.x*C+L.col2.x*b,b=L.col1.y*C+L.col2.y*b,C=G;var W=w.m_invMass,S=O.m_invMass,E=w.m_invI,R=O.m_invI,F=O.m_sweep.c.x+C-w.m_sweep.c.x-j,k=O.m_sweep.c.y+b-w.m_sweep.c.y-Q,X=O.m_sweep.a-w.m_sweep.a-this.m_referenceAngle,Z=10*t.b2_linearSlop,V=Math.sqrt(F*F+k*k),Y=n.Abs(X);V>Z&&(E*=1,R*=1),this.m_mass.col1.x=W+S+Q*Q*E+b*b*R,this.m_mass.col2.x=-Q*j*E-b*C*R,this.m_mass.col3.x=-Q*E-b*R,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=W+S+j*j*E+C*C*R,this.m_mass.col3.y=j*E+C*R,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=E+R;var $=new o;return this.m_mass.Solve33($,-F,-k,-X),w.m_sweep.c.x-=W*$.x,w.m_sweep.c.y-=W*$.y,w.m_sweep.a-=E*(j*$.y-Q*$.x+$.z),O.m_sweep.c.x+=S*$.x,O.m_sweep.c.y+=S*$.y,O.m_sweep.a+=R*(C*$.y-b*$.x+$.z),w.SynchronizeTransform(),O.SynchronizeTransform(),V<=t.b2_linearSlop&&Y<=t.b2_angularSlop},Box2D.inherit(rt,Box2D.Dynamics.Joints.b2JointDef),rt.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,rt.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},rt.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=f.e_weldJoint,this.referenceAngle=0},rt.prototype.Initialize=function(I,L,G){this.bodyA=I,this.bodyB=L,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(G)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(G)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var t=Box2D.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var e=this||window;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},t.prototype._color=function(e,r){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+r+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(e){e===void 0&&(e=0),this.m_drawFlags=e},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(e){e===void 0&&(e=0),this.m_drawFlags|=e},t.prototype.ClearFlags=function(e){e===void 0&&(e=0),this.m_drawFlags&=~e},t.prototype.SetSprite=function(e){this.m_ctx=e},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(e){e===void 0&&(e=0),this.m_drawScale=e},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(e){e===void 0&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(e){e===void 0&&(e=0),this.m_alpha=e},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(e){e===void 0&&(e=0),this.m_fillAlpha=e},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(e){e===void 0&&(e=0),this.m_xformScale=e},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(e,r,n){if(r){var s=this.m_ctx,o=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(n.color,this.m_alpha),s.moveTo(e[0].x*o,e[0].y*o);for(var a=1;a<r;a++)s.lineTo(e[a].x*o,e[a].y*o);s.lineTo(e[0].x*o,e[0].y*o),s.closePath(),s.stroke()}},t.prototype.DrawSolidPolygon=function(e,r,n){if(r){var s=this.m_ctx,o=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(n.color,this.m_alpha),s.fillStyle=this._color(n.color,this.m_fillAlpha),s.moveTo(e[0].x*o,e[0].y*o);for(var a=1;a<r;a++)s.lineTo(e[a].x*o,e[a].y*o);s.lineTo(e[0].x*o,e[0].y*o),s.closePath(),s.fill(),s.stroke()}},t.prototype.DrawCircle=function(e,r,n){if(r){var s=this.m_ctx,o=this.m_drawScale;s.beginPath(),s.strokeStyle=this._color(n.color,this.m_alpha),s.arc(e.x*o,e.y*o,r*o,0,Math.PI*2,!0),s.closePath(),s.stroke()}},t.prototype.DrawSolidCircle=function(e,r,n,s){if(r){var o=this.m_ctx,a=this.m_drawScale,c=e.x*a,l=e.y*a;o.moveTo(0,0),o.beginPath(),o.strokeStyle=this._color(s.color,this.m_alpha),o.fillStyle=this._color(s.color,this.m_fillAlpha),o.arc(c,l,r*a,0,Math.PI*2,!0),o.moveTo(c,l),o.lineTo((e.x+n.x*r)*a,(e.y+n.y*r)*a),o.closePath(),o.fill(),o.stroke()}},t.prototype.DrawSegment=function(e,r,n){var s=this.m_ctx,o=this.m_drawScale;s.strokeStyle=this._color(n.color,this.m_alpha),s.beginPath(),s.moveTo(e.x*o,e.y*o),s.lineTo(r.x*o,r.y*o),s.closePath(),s.stroke()},t.prototype.DrawTransform=function(e){var r=this.m_ctx,n=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(16711680,this.m_alpha),r.moveTo(e.position.x*n,e.position.y*n),r.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),r.strokeStyle=this._color(65280,this.m_alpha),r.moveTo(e.position.x*n,e.position.y*n),r.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),r.closePath(),r.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;typeof require!="undefined"&&typeof module$1!="undefined"&&(module$1.exports=Box2D);(function(){Object.create=Object.create||function(g){function y(){}return y.prototype=g,new y};var t;typeof exports$1=="undefined"?(t={},typeof window=="object"&&(window.cp=t)):t=exports$1;var e=function(g,y){if(!g)throw new Error("Assertion failed: "+y)},r=function(g,y){!g&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+y),console.trace&&console.trace())},n=function(g,y){return g<y?g:y},s=function(g,y){return g>y?g:y},o,a;typeof window=="object"&&window.navigator.userAgent.indexOf("Firefox")>-1?(o=Math.min,a=Math.max):(o=n,a=s);var c=function(g,y){return g<y?g+" "+y:y+" "+g},l=function(g,y){for(var P=0;P<g.length;P++)if(g[P]===y){g[P]=g[g.length-1],g.length--;return}},h=function(g,y,P){var B=U(y,P),H=m(D(B,U(g,P))/j(B));return J(P,tt(B,H))},u=function(g,y,P,B,H,it){var nt=P-H,_t=B-it,vt=m(N(nt,_t,g-H,y-it)/Q(nt,_t));return new v(H+nt*vt,it+_t*vt)};t.momentForCircle=function(g,y,P,B){return g*(.5*(y*y+P*P)+j(B))},t.areaForCircle=function(g,y){return Math.PI*Math.abs(g*g-y*y)},t.momentForSegment=function(g,y,P){var B=tt(J(y,P),.5);return g*(R(P,y)/12+j(B))},t.areaForSegment=function(g,y,P){return P*(Math.PI*P+2*E(g,y))},t.momentForPoly=function(g,y,P){for(var B=0,H=0,it=y.length,nt=0;nt<it;nt+=2){var _t=y[nt]+P.x,vt=y[nt+1]+P.y,Ct=y[(nt+2)%it]+P.x,bt=y[(nt+3)%it]+P.y,Nt=I(Ct,bt,_t,vt),Gt=N(_t,vt,_t,vt)+N(_t,vt,Ct,bt)+N(Ct,bt,Ct,bt);B+=Nt*Gt,H+=Nt}return g*B/(6*H)},t.areaForPoly=function(g){for(var y=0,P=0,B=g.length;P<B;P+=2)y+=rt(new v(g[P],g[P+1]),new v(g[(P+2)%B],g[(P+3)%B]));return-y/2},t.centroidForPoly=function(g){for(var y=0,P=new v(0,0),B=0,H=g.length;B<H;B+=2){var it=new v(g[B],g[B+1]),nt=new v(g[(B+2)%H],g[(B+3)%H]),_t=rt(it,nt);y+=_t,P=J(P,tt(J(it,nt),_t))}return tt(P,1/(3*y))},t.recenterPoly=function(g){for(var y=t.centroidForPoly(g),P=0;P<g.length;P+=2)g[P]-=y.x,g[P+1]-=y.y},t.momentForBox=function(g,y,P){return g*(y*y+P*P)/12},t.momentForBox2=function(g,y){var P=y.r-y.l,B=y.t-y.b,H=tt([y.l+y.r,y.b+y.t],.5);return t.momentForBox(g,P,B)+g*j(H)};var _=t.loopIndexes=function(g){var y=0,P=0,B,H,it,nt;B=it=g[0],H=nt=g[1];for(var _t=g.length>>1,vt=1;vt<_t;vt++){var Ct=g[vt*2],bt=g[vt*2+1];Ct<B||Ct==B&&bt<H?(B=Ct,H=bt,y=vt):(Ct>it||Ct==it&&bt>nt)&&(it=Ct,nt=bt,P=vt)}return[y,P]},d=function(g,y,P){var B=g[y*2];g[y*2]=g[P*2],g[P*2]=B,B=g[y*2+1],g[y*2+1]=g[P*2+1],g[P*2+1]=B},f=function(g,y,P,B,H,it){if(P===0)return 0;for(var nt=0,_t=y,vt=U(H,B),Ct=it*z(vt),bt=y,Nt=y+P-1;bt<=Nt;){var Gt=new v(g[bt*2],g[bt*2+1]),Qt=rt(vt,U(Gt,B));Qt>Ct?(Qt>nt&&(nt=Qt,_t=bt),bt++):(d(g,bt,Nt),Nt--)}return _t!=y&&d(g,y,_t),bt-y},T=function(g,y,P,B,H,it,nt,_t){if(B<0)return 0;if(B==0)return y[_t*2]=it.x,y[_t*2+1]=it.y,1;var vt=f(y,P,B,H,it,g),Ct=new v(y[P*2],y[P*2+1]),bt=T(g,y,P+1,vt-1,H,Ct,it,_t),Nt=_t+bt++;y[Nt*2]=it.x,y[Nt*2+1]=it.y;var Gt=f(y,P+vt,B-vt,it,nt,g),Qt=new v(y[(P+vt)*2],y[(P+vt)*2+1]);return bt+T(g,y,P+vt+1,Gt-1,it,Qt,nt,_t+bt)};t.convexHull=function(g,y,P){if(y)for(var B=0;B<g.length;B++)y[B]=g[B];else y=g;var H=_(g),it=H[0],nt=H[1];if(it==nt)return y.length=2,y;d(y,0,it),d(y,1,nt==0?it:nt);var _t=new v(y[0],y[1]),vt=new v(y[2],y[3]),Ct=g.length>>1,bt=T(P,y,2,Ct-2,_t,vt,_t,1)+1;return y.length=bt*2,r(dt(y),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),y};var x=function(g,y,P){return o(a(g,y),P)},m=function(g){return a(0,o(g,1))},v=t.Vect=function(g,y){this.x=g,this.y=y};t.v=function(g,y){return new v(g,y)};var A=t.vzero=new v(0,0),D=t.v.dot=function(g,y){return g.x*y.x+g.y*y.y},N=function(g,y,P,B){return g*P+y*B},z=t.v.len=function(g){return Math.sqrt(D(g,g))},M=t.v.len2=function(g,y){return Math.sqrt(g*g+y*y)};t.v.eql=function(g,y){return g.x===y.x&&g.y===y.y};var J=t.v.add=function(g,y){return new v(g.x+y.x,g.y+y.y)};v.prototype.add=function(g){return this.x+=g.x,this.y+=g.y,this};var U=t.v.sub=function(g,y){return new v(g.x-y.x,g.y-y.y)};v.prototype.sub=function(g){return this.x-=g.x,this.y-=g.y,this};var K=t.v.neg=function(g){return new v(-g.x,-g.y)};v.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var tt=t.v.mult=function(g,y){return new v(g.x*y,g.y*y)};v.prototype.mult=function(g){return this.x*=g,this.y*=g,this};var rt=t.v.cross=function(g,y){return g.x*y.y-g.y*y.x},I=function(g,y,P,B){return g*B-y*P},L=t.v.perp=function(g){return new v(-g.y,g.x)};t.v.pvrperp=function(g){return new v(g.y,-g.x)};var G=t.v.project=function(g,y){return tt(y,D(g,y)/j(y))};v.prototype.project=function(g){return this.mult(D(this,g)/j(g)),this};var w=t.v.rotate=function(g,y){return new v(g.x*y.x-g.y*y.y,g.x*y.y+g.y*y.x)};v.prototype.rotate=function(g){return this.x=this.x*g.x-this.y*g.y,this.y=this.x*g.y+this.y*g.x,this};var O=t.v.unrotate=function(g,y){return new v(g.x*y.x+g.y*y.y,g.y*y.x-g.x*y.y)},j=t.v.lengthsq=function(g){return D(g,g)},Q=t.v.lengthsq2=function(g,y){return g*g+y*y},C=t.v.lerp=function(g,y,P){return J(tt(g,1-P),tt(y,P))},b=t.v.normalize=function(g){return tt(g,1/z(g))},W=t.v.normalize_safe=function(g){return g.x===0&&g.y===0?A:b(g)},S=t.v.clamp=function(g,y){return D(g,g)>y*y?tt(b(g),y):g};t.v.lerpconst=function(g,y,P){return J(g,S(U(y,g),P))};var E=t.v.dist=function(g,y){return z(U(g,y))},R=t.v.distsq=function(g,y){return j(U(g,y))};t.v.near=function(g,y,P){return R(g,y)<P*P};var F=t.v.slerp=function(g,y,P){var B=Math.acos(D(g,y));if(B){var H=1/Math.sin(B);return J(tt(g,Math.sin((1-P)*B)*H),tt(y,Math.sin(P*B)*H))}else return g};t.v.slerpconst=function(g,y,P){var B=Math.acos(D(g,y));return F(g,y,o(P,B)/B)},t.v.forangle=function(g){return new v(Math.cos(g),Math.sin(g))},t.v.toangle=function(g){return Math.atan2(g.y,g.x)},t.v.str=function(g){return"("+g.x.toFixed(3)+", "+g.y.toFixed(3)+")"};var k=t.BB=function(g,y,P,B){this.l=g,this.b=y,this.r=P,this.t=B};t.bb=function(g,y,P,B){return new k(g,y,P,B)};var X=function(g,y){return new k(g.x-y,g.y-y,g.x+y,g.y+y)},Z=function(g,y,P,B,H){return g.l<=B&&y<=g.r&&g.b<=H&&P<=g.t},V=0;t.NO_GROUP=0;var Y=t.ALL_LAYERS=-1;t.ALL_CATEGORIES=-1,t.resetShapeIdCounter=function(){V=0};var $=t.Shape=function(g){this.body=g,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=V++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=A,this.collision_type=0,this.group=0,this.layers=Y,this.space=null,this.collisionCode=this.collisionCode};$.prototype.setElasticity=function(g){this.e=g},$.prototype.setFriction=function(g){this.body.activate(),this.u=g},$.prototype.setLayers=function(g){this.body.activate(),this.layers=g},$.prototype.setSensor=function(g){this.body.activate(),this.sensor=g},$.prototype.setCollisionType=function(g){this.body.activate(),this.collision_type=g},$.prototype.getBody=function(){return this.body},$.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},$.prototype.setBody=function(g){e(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=g},$.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},$.prototype.update=function(g,y){e(!isNaN(y.x),"Rotation is NaN"),e(!isNaN(g.x),"Position is NaN"),this.cacheData(g,y)},$.prototype.pointQuery=function(g){var y=this.nearestPointQuery(g);if(y.d<0)return y},$.prototype.getBB=function(){return new k(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var et=function(g,y,P){this.shape=g,this.p=y,this.d=P},ct=function(g,y,P){this.shape=g,this.t=y,this.n=P};ct.prototype.hitPoint=function(g,y){return C(g,y,this.t)},ct.prototype.hitDist=function(g,y){return E(g,y)*this.t};var ht=t.CircleShape=function(g,y,P){this.c=this.tc=P,this.r=y,this.type="circle",$.call(this,g)};ht.prototype=Object.create($.prototype),ht.prototype.cacheData=function(g,y){var P=this.tc=w(this.c,y).add(g),B=this.r;this.bb_l=P.x-B,this.bb_b=P.y-B,this.bb_r=P.x+B,this.bb_t=P.y+B},ht.prototype.nearestPointQuery=function(g){var y=g.x-this.tc.x,P=g.y-this.tc.y,B=M(y,P),H=this.r,it=new v(this.tc.x+y*H/B,this.tc.y+P*H/B);return new et(this,it,B-H)};var pt=function(g,y,P,B,H,it){B=U(B,y),H=U(H,y);var nt=D(B,B)-2*D(B,H)+D(H,H),_t=-2*D(B,B)+2*D(B,H),vt=D(B,B)-P*P,Ct=_t*_t-4*nt*vt;if(Ct>=0){var bt=(-_t-Math.sqrt(Ct))/(2*nt);if(0<=bt&&bt<=1)return new ct(g,bt,b(C(B,H,bt)))}};ht.prototype.segmentQuery=function(g,y){return pt(this,this.tc,this.r,g,y)};var mt=t.SegmentShape=function(g,y,P,B){this.a=y,this.b=P,this.n=L(b(U(P,y))),this.ta=this.tb=this.tn=null,this.r=B,this.a_tangent=A,this.b_tangent=A,this.type="segment",$.call(this,g)};mt.prototype=Object.create($.prototype),mt.prototype.cacheData=function(g,y){this.ta=J(g,w(this.a,y)),this.tb=J(g,w(this.b,y)),this.tn=w(this.n,y);var P,B,H,it;this.ta.x<this.tb.x?(P=this.ta.x,B=this.tb.x):(P=this.tb.x,B=this.ta.x),this.ta.y<this.tb.y?(H=this.ta.y,it=this.tb.y):(H=this.tb.y,it=this.ta.y);var nt=this.r;this.bb_l=P-nt,this.bb_b=H-nt,this.bb_r=B+nt,this.bb_t=it+nt},mt.prototype.nearestPointQuery=function(g){var y=h(g,this.ta,this.tb),P=g.x-y.x,B=g.y-y.y,H=M(P,B),it=this.r,nt=H?J(y,tt(new v(P,B),it/H)):y;return new et(this,nt,H-it)},mt.prototype.segmentQuery=function(g,y){var P=this.tn,B=D(U(this.ta,g),P),H=this.r,it=B>0?K(P):P,nt=U(tt(it,H),g),_t=J(this.ta,nt),vt=J(this.tb,nt),Ct=U(y,g);if(rt(Ct,_t)*rt(Ct,vt)<=0){var bt=B+(B>0?-H:H),Nt=-bt,Gt=D(Ct,P)-bt;if(Nt*Gt<0)return new ct(this,Nt/(Nt-Gt),it)}else if(H!==0){var Qt=pt(this,this.ta,this.r,g,y),ie=pt(this,this.tb,this.r,g,y);return Qt?ie&&ie.t<Qt.t?ie:Qt:ie}},mt.prototype.setNeighbors=function(g,y){this.a_tangent=U(g,this.a),this.b_tangent=U(y,this.b)},mt.prototype.setEndpoints=function(g,y){this.a=g,this.b=y,this.n=L(b(U(y,g)))};var dt=function(g){for(var y=g.length,P=0;P<y;P+=2){var B=g[P],H=g[P+1],it=g[(P+2)%y],nt=g[(P+3)%y],_t=g[(P+4)%y],vt=g[(P+5)%y];if(I(it-B,nt-H,_t-it,vt-nt)>0)return!1}return!0},xt=t.PolyShape=function(g,y,P){this.setVerts(y,P),this.type="poly",$.call(this,g)};xt.prototype=Object.create($.prototype);var Tt=function(g,y){this.n=g,this.d=y};Tt.prototype.compare=function(g){return D(this.n,g)-this.d},xt.prototype.setVerts=function(g,y){e(g.length>=4,"Polygons require some verts"),e(typeof g[0]=="number","Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),e(dt(g),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var P=g.length,B=P>>1;this.verts=new Array(P),this.tVerts=new Array(P),this.planes=new Array(B),this.tPlanes=new Array(B);for(var H=0;H<P;H+=2){var it=g[H]+y.x,nt=g[H+1]+y.y,_t=g[(H+2)%P]+y.x,vt=g[(H+3)%P]+y.y,Ct=b(L(new v(_t-it,vt-nt)));this.verts[H]=it,this.verts[H+1]=nt,this.planes[H>>1]=new Tt(Ct,N(Ct.x,Ct.y,it,nt)),this.tPlanes[H>>1]=new Tt(new v(0,0),0)}},t.BoxShape=function(g,y,P){var B=y/2,H=P/2;return lt(g,new k(-B,-H,B,H))};var lt=t.BoxShape2=function(g,y){var P=[y.l,y.b,y.l,y.t,y.r,y.t,y.r,y.b];return new xt(g,P,A)};xt.prototype.transformVerts=function(g,y){for(var P=this.verts,B=this.tVerts,H=1/0,it=-1/0,nt=1/0,_t=-1/0,vt=0;vt<P.length;vt+=2){var Ct=P[vt],bt=P[vt+1],Nt=g.x+Ct*y.x-bt*y.y,Gt=g.y+Ct*y.y+bt*y.x;B[vt]=Nt,B[vt+1]=Gt,H=o(H,Nt),it=a(it,Nt),nt=o(nt,Gt),_t=a(_t,Gt)}this.bb_l=H,this.bb_b=nt,this.bb_r=it,this.bb_t=_t},xt.prototype.transformAxes=function(g,y){for(var P=this.planes,B=this.tPlanes,H=0;H<P.length;H++){var it=w(P[H].n,y);B[H].n=it,B[H].d=D(g,it)+P[H].d}},xt.prototype.cacheData=function(g,y){this.transformAxes(g,y),this.transformVerts(g,y)},xt.prototype.nearestPointQuery=function(g){for(var y=this.tPlanes,P=this.tVerts,B=P[P.length-2],H=P[P.length-1],it=1/0,nt=A,_t=!1,vt=0;vt<y.length;vt++){y[vt].compare(g)>0&&(_t=!0);var Ct=P[vt*2],bt=P[vt*2+1],Nt=u(g.x,g.y,B,H,Ct,bt),Gt=E(g,Nt);Gt<it&&(it=Gt,nt=Nt),B=Ct,H=bt}return new et(this,nt,_t?it:-it)},xt.prototype.segmentQuery=function(g,y){for(var P=this.tPlanes,B=this.tVerts,H=P.length,it=H*2,nt=0;nt<H;nt++){var _t=P[nt].n,vt=D(g,_t);if(!(P[nt].d>vt)){var Ct=D(y,_t),bt=(P[nt].d-vt)/(Ct-vt);if(!(bt<0||1<bt)){var Nt=C(g,y,bt),Gt=-rt(_t,Nt),Qt=-I(_t.x,_t.y,B[nt*2],B[nt*2+1]),ie=-I(_t.x,_t.y,B[(nt*2+2)%it],B[(nt*2+3)%it]);if(Qt<=Gt&&Gt<=ie)return new ct(this,bt,_t)}}}},xt.prototype.valueOnAxis=function(g,y){for(var P=this.tVerts,B=N(g.x,g.y,P[0],P[1]),H=2;H<P.length;H+=2)B=o(B,N(g.x,g.y,P[H],P[H+1]));return B-y},xt.prototype.containsVert=function(g,y){for(var P=this.tPlanes,B=0;B<P.length;B++){var H=P[B].n,it=N(H.x,H.y,g,y)-P[B].d;if(it>0)return!1}return!0},xt.prototype.containsVertPartial=function(g,y,P){for(var B=this.tPlanes,H=0;H<B.length;H++){var it=B[H].n;if(!(D(it,P)<0)){var nt=N(it.x,it.y,g,y)-B[H].d;if(nt>0)return!1}}return!0},xt.prototype.getNumVerts=function(){return this.verts.length/2},xt.prototype.getCount=xt.prototype.getNumVerts,xt.prototype.getVert=function(g){return new v(this.verts[g*2],this.verts[g*2+1])};var at=t.Body=function(g,y){this.p=new v(0,0),this.vx=this.vy=0,this.f=new v(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(g),this.setMoment(y),this.rot=new v(0,0),this.setAngle(0)},At=function(){var g=new at(1/0,1/0);return g.nodeIdleTime=1/0,g};if(t.StaticBody=At,typeof DEBUG!="undefined"&&DEBUG){var St=function(g,y){e(g.x==g.x&&g.y==g.y,y)},wt=function(g,y){e(Math.abs(g.x)!==1/0&&Math.abs(g.y)!==1/0,y)},Pt=function(g,y){St(g,y),wt(g,y)};at.prototype.sanityCheck=function(){e(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),e(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),Pt(this.p,"Body's position is invalid."),Pt(this.f,"Body's force is invalid."),e(this.vx===this.vx&&Math.abs(this.vx)!==1/0,"Body's velocity is invalid."),e(this.vy===this.vy&&Math.abs(this.vy)!==1/0,"Body's velocity is invalid."),e(this.a===this.a&&Math.abs(this.a)!==1/0,"Body's angle is invalid."),e(this.w===this.w&&Math.abs(this.w)!==1/0,"Body's angular velocity is invalid."),e(this.t===this.t&&Math.abs(this.t)!==1/0,"Body's torque is invalid."),Pt(this.rot,"Body's rotation vector is invalid."),e(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),e(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else at.prototype.sanityCheck=function(){};at.prototype.getPos=function(){return this.p},at.prototype.getVel=function(){return new v(this.vx,this.vy)},at.prototype.getAngVel=function(){return this.w},at.prototype.getPosition=at.prototype.getPos,at.prototype.getVelocity=at.prototype.getVel,at.prototype.getAngularVelocity=at.prototype.getAngVel,at.prototype.getCenterOfGravity=function(){return this.p},at.prototype.isSleeping=function(){return this.nodeRoot!==null},at.prototype.isStatic=function(){return this.nodeIdleTime===1/0},at.prototype.isRogue=function(){return this.space===null},at.prototype.setMass=function(g){e(g>0,"Mass must be positive and non-zero."),this.activate(),this.m=g,this.m_inv=1/g},at.prototype.setMoment=function(g){e(g>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=g,this.i_inv=1/g},at.prototype.addShape=function(g){this.shapeList.push(g)},at.prototype.removeShape=function(g){l(this.shapeList,g)};var It=function(g,y,P){return g===P?g.next(y):(g.a===y?g.next_a=It(g.next_a,y,P):g.next_b=It(g.next_b,y,P),g)};at.prototype.removeConstraint=function(g){this.constraintList=It(this.constraintList,this,g)},at.prototype.setPos=function(g){this.activate(),this.sanityCheck(),g===A&&(g=t.v(0,0)),this.p=g},at.prototype.setVel=function(g){this.activate(),this.vx=g.x,this.vy=g.y},at.prototype.setAngVel=function(g){this.activate(),this.w=g},at.prototype.setAngleInternal=function(g){e(!isNaN(g),"Internal Error: Attempting to set body's angle to NaN"),this.a=g,this.rot.x=Math.cos(g),this.rot.y=Math.sin(g)},at.prototype.setAngle=function(g){this.activate(),this.sanityCheck(),this.setAngleInternal(g)},at.prototype.velocity_func=function(g,y,P){var B=this.vx*y+(g.x+this.f.x*this.m_inv)*P,H=this.vy*y+(g.y+this.f.y*this.m_inv)*P,it=this.v_limit,nt=B*B+H*H,_t=nt>it*it?it/Math.sqrt(nt):1;this.vx=B*_t,this.vy=H*_t;var vt=this.w_limit;this.w=x(this.w*y+this.t*this.i_inv*P,-vt,vt),this.sanityCheck()},at.prototype.position_func=function(g){this.p.x+=(this.vx+this.v_biasx)*g,this.p.y+=(this.vy+this.v_biasy)*g,this.setAngleInternal(this.a+(this.w+this.w_bias)*g),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},at.prototype.resetForces=function(){this.activate(),this.f=new v(0,0),this.t=0},at.prototype.applyForce=function(g,y){this.activate(),this.f=J(this.f,g),this.t+=rt(y,g)},at.prototype.applyImpulse=function(g,y){this.activate(),Ee(this,g.x,g.y,y)},at.prototype.getVelAtPoint=function(g){return J(new v(this.vx,this.vy),tt(L(g),this.w))},at.prototype.getVelAtWorldPoint=function(g){return this.getVelAtPoint(U(g,this.p))},at.prototype.getVelAtLocalPoint=function(g){return this.getVelAtPoint(w(g,this.rot))},at.prototype.eachShape=function(g){for(var y=0,P=this.shapeList.length;y<P;y++)g(this.shapeList[y])},at.prototype.eachConstraint=function(g){for(var y=this.constraintList;y;){var P=y.next(this);g(y),y=P}},at.prototype.eachArbiter=function(g){for(var y=this.arbiterList;y;){var P=y.next(this);y.swappedColl=this===y.body_b,g(y),y=P}},at.prototype.local2World=function(g){return J(this.p,w(g,this.rot))},at.prototype.world2Local=function(g){return O(U(g,this.p),this.rot)},at.prototype.localToWorld=at.prototype.local2World,at.prototype.worldToLocal=at.prototype.world2Local,at.prototype.kineticEnergy=function(){var g=this.vx*this.vx+this.vy*this.vy,y=this.w*this.w;return(g?g*this.m:0)+(y?y*this.i:0)};var zt=t.SpatialIndex=function(g){if(this.staticIndex=g,g){if(g.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");g.dynamicIndex=this||window}};zt.prototype.collideStatic=function(g,y){if(g.count>0){var P=g.query;this.each(function(B){P(B,new k(B.bb_l,B.bb_b,B.bb_r,B.bb_t),y)})}};var Vt=t.BBTree=function(g){zt.call(this,g),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};Vt.prototype=Object.create(zt.prototype);var ot=function(g,y,P){this.obj=null,this.bb_l=o(y.bb_l,P.bb_l),this.bb_b=o(y.bb_b,P.bb_b),this.bb_r=a(y.bb_r,P.bb_r),this.bb_t=a(y.bb_t,P.bb_t),this.parent=null,this.setA(y),this.setB(P)};Vt.prototype.makeNode=function(g,y){var P=this.pooledNodes;return P?(this.pooledNodes=P.parent,P.constructor(this,g,y),P):new ot(this,g,y)};var st=function(g,y){this.obj=y,g.getBB(y,this),this.parent=null,this.stamp=1,this.pairs=null};Vt.prototype.getBB=function(g,y){var P=this.velocityFunc;if(P){var B=.1,H=(g.bb_r-g.bb_l)*B,it=(g.bb_t-g.bb_b)*B,nt=tt(P(g),.1);y.bb_l=g.bb_l+o(-H,nt.x),y.bb_b=g.bb_b+o(-it,nt.y),y.bb_r=g.bb_r+a(H,nt.x),y.bb_t=g.bb_t+a(it,nt.y)}else y.bb_l=g.bb_l,y.bb_b=g.bb_b,y.bb_r=g.bb_r,y.bb_t=g.bb_t},Vt.prototype.getStamp=function(){var g=this.dynamicIndex;return g&&g.stamp?g.stamp:this.stamp},Vt.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var ut=function(g,y,P,B){this.prevA=null,this.leafA=g,this.nextA=y,this.prevB=null,this.leafB=P,this.nextB=B};Vt.prototype.makePair=function(g,y,P,B){var H=this.pooledPairs;return H?(this.pooledPairs=H.prevA,H.prevA=null,H.leafA=g,H.nextA=y,H.prevB=null,H.leafB=P,H.nextB=B,H):new ut(g,y,P,B)},ut.prototype.recycle=function(g){this.prevA=g.pooledPairs,g.pooledPairs=this||window};var ft=function(g,y,P){P&&(P.leafA===y?P.prevA=g:P.prevB=g),g?g.leafA===y?g.nextA=P:g.nextB=P:y.pairs=P};st.prototype.clearPairs=function(g){var y=this.pairs,P;for(this.pairs=null;y;)y.leafA===this?(P=y.nextA,ft(y.prevB,y.leafB,y.nextB)):(P=y.nextB,ft(y.prevA,y.leafA,y.nextA)),y.recycle(g),y=P};var yt=function(g,y,P){var B=g.pairs,H=y.pairs,it=P.makePair(g,B,y,H);g.pairs=y.pairs=it,B&&(B.leafA===g?B.prevA=it:B.prevB=it),H&&(H.leafA===y?H.prevA=it:H.prevB=it)};ot.prototype.recycle=function(g){this.parent=g.pooledNodes,g.pooledNodes=this||window},st.prototype.recycle=function(g){},ot.prototype.setA=function(g){this.A=g,g.parent=this||window},ot.prototype.setB=function(g){this.B=g,g.parent=this||window},st.prototype.isLeaf=!0,ot.prototype.isLeaf=!1,ot.prototype.otherChild=function(g){return this.A==g?this.B:this.A},ot.prototype.replaceChild=function(g,y,P){r(g==this.A||g==this.B,"Node is not a child of parent."),this.A==g?(this.A.recycle(P),this.setA(y)):(this.B.recycle(P),this.setB(y));for(var B=this;B;B=B.parent){var H=B.A,it=B.B;B.bb_l=o(H.bb_l,it.bb_l),B.bb_b=o(H.bb_b,it.bb_b),B.bb_r=a(H.bb_r,it.bb_r),B.bb_t=a(H.bb_t,it.bb_t)}},ot.prototype.bbArea=st.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var gt=function(g,y){return(a(g.bb_r,y.bb_r)-o(g.bb_l,y.bb_l))*(a(g.bb_t,y.bb_t)-o(g.bb_b,y.bb_b))},Et=function(g,y){return Math.abs(g.bb_l+g.bb_r-y.bb_l-y.bb_r)+Math.abs(g.bb_b+g.bb_t-y.bb_b-y.bb_t)},Rt=function(g,y,P){if(g==null)return y;if(g.isLeaf)return P.makeNode(y,g);var B=g.B.bbArea()+gt(g.A,y),H=g.A.bbArea()+gt(g.B,y);return B===H&&(B=Et(g.A,y),H=Et(g.B,y)),H<B?g.setB(Rt(g.B,y,P)):g.setA(Rt(g.A,y,P)),g.bb_l=o(g.bb_l,y.bb_l),g.bb_b=o(g.bb_b,y.bb_b),g.bb_r=a(g.bb_r,y.bb_r),g.bb_t=a(g.bb_t,y.bb_t),g};ot.prototype.intersectsBB=st.prototype.intersectsBB=function(g){return this.bb_l<=g.r&&g.l<=this.bb_r&&this.bb_b<=g.t&&g.b<=this.bb_t};var Wt=function(g,y,P){g.intersectsBB(y)&&(g.isLeaf?P(g.obj):(Wt(g.A,y,P),Wt(g.B,y,P)))},Lt=function(g,y,P){var B=1/(P.x-y.x),H=g.bb_l==y.x?-1/0:(g.bb_l-y.x)*B,it=g.bb_r==y.x?1/0:(g.bb_r-y.x)*B,nt=o(H,it),_t=a(H,it),vt=1/(P.y-y.y),Ct=g.bb_b==y.y?-1/0:(g.bb_b-y.y)*vt,bt=g.bb_t==y.y?1/0:(g.bb_t-y.y)*vt,Nt=o(Ct,bt),Gt=a(Ct,bt);if(Nt<=_t&&nt<=Gt){var Qt=a(nt,Nt),ie=o(_t,Gt);if(0<=ie&&Qt<=1)return a(Qt,0)}return 1/0},Yt=function(g,y,P,B,H){if(g.isLeaf)return H(g.obj);var it=Lt(g.A,y,P),nt=Lt(g.B,y,P);return it<nt?(it<B&&(B=o(B,Yt(g.A,y,P,B,H))),nt<B&&(B=o(B,Yt(g.B,y,P,B,H)))):(nt<B&&(B=o(B,Yt(g.B,y,P,B,H))),it<B&&(B=o(B,Yt(g.A,y,P,B,H)))),B};Vt.prototype.subtreeRecycle=function(g){g.isLeaf&&(this.subtreeRecycle(g.A),this.subtreeRecycle(g.B),g.recycle(this))};var Mt=function(g,y,P){if(y==g)return null;var B=y.parent;if(B==g){var H=g.otherChild(y);return H.parent=g.parent,g.recycle(P),H}else return B.parent.replaceChild(B,B.otherChild(y),P),g},Dt=function(g,y){return g.bb_l<=y.bb_r&&y.bb_l<=g.bb_r&&g.bb_b<=y.bb_t&&y.bb_b<=g.bb_t};st.prototype.markLeafQuery=function(g,y,P,B){Dt(g,this)&&(y?yt(g,this,P):(this.stamp<g.stamp&&yt(this,g,P),B&&B(g.obj,this.obj)))},ot.prototype.markLeafQuery=function(g,y,P,B){Dt(g,this)&&(this.A.markLeafQuery(g,y,P,B),this.B.markLeafQuery(g,y,P,B))},st.prototype.markSubtree=function(g,y,P){if(this.stamp==g.getStamp()){y&&y.markLeafQuery(this,!1,g,P);for(var B=this||window;B.parent;B=B.parent)B==B.parent.A?B.parent.B.markLeafQuery(this,!0,g,P):B.parent.A.markLeafQuery(this,!1,g,P)}else for(var H=this.pairs;H;)this===H.leafB?(P&&P(H.leafA.obj,this.obj),H=H.nextB):H=H.nextA},ot.prototype.markSubtree=function(g,y,P){this.A.markSubtree(g,y,P),this.B.markSubtree(g,y,P)},st.prototype.containsObj=function(g){return this.bb_l<=g.bb_l&&this.bb_r>=g.bb_r&&this.bb_b<=g.bb_b&&this.bb_t>=g.bb_t},st.prototype.update=function(g){var y=g.root,P=this.obj;return this.containsObj(P)?!1:(g.getBB(this.obj,this),y=Mt(y,this,g),g.root=Rt(y,this,g),this.clearPairs(g),this.stamp=g.getStamp(),!0)},st.prototype.addPairs=function(g){var y=g.dynamicIndex;if(y){var P=y.root;P&&P.markLeafQuery(this,!0,y,null)}else{var B=g.staticIndex.root;this.markSubtree(g,B,null)}},Vt.prototype.insert=function(g,y){var P=new st(this,g);this.leaves[y]=P,this.root=Rt(this.root,P,this),this.count++,P.stamp=this.getStamp(),P.addPairs(this),this.incrementStamp()},Vt.prototype.remove=function(g,y){var P=this.leaves[y];delete this.leaves[y],this.root=Mt(this.root,P,this),this.count--,P.clearPairs(this),P.recycle(this)},Vt.prototype.contains=function(g,y){return this.leaves[y]!=null};var Ft=function(g,y){};Vt.prototype.reindexQuery=function(g){if(this.root){var y,P=this.leaves;for(y in P)P[y].update(this);var B=this.staticIndex,H=B&&B.root;this.root.markSubtree(this,H,g),B&&!H&&this.collideStatic(this,B,g),this.incrementStamp()}},Vt.prototype.reindex=function(){this.reindexQuery(Ft)},Vt.prototype.reindexObject=function(g,y){var P=this.leaves[y];P&&(P.update(this)&&P.addPairs(this),this.incrementStamp())},Vt.prototype.pointQuery=function(g,y){this.query(new k(g.x,g.y,g.x,g.y),y)},Vt.prototype.segmentQuery=function(g,y,P,B){this.root&&Yt(this.root,g,y,P,B)},Vt.prototype.query=function(g,y){this.root&&Wt(this.root,g,y)},Vt.prototype.count=function(){return this.count},Vt.prototype.each=function(g){var y;for(y in this.leaves)g(this.leaves[y].obj)};var Ht=function(g,y,P,B,H){return(a(g.bb_r,B)-o(g.bb_l,y))*(a(g.bb_t,H)-o(g.bb_b,P))},Xt=function(g,y,P,B){if(B==1)return y[P];if(B==2)return g.makeNode(y[P],y[P+1]);for(var H=y[P],it=H.bb_l,nt=H.bb_b,_t=H.bb_r,vt=H.bb_t,Ct=P+B,bt=P+1;bt<Ct;bt++)H=y[bt],it=o(it,H.bb_l),nt=o(nt,H.bb_b),_t=a(_t,H.bb_r),vt=a(vt,H.bb_t);var Nt=_t-it>vt-nt,Gt=new Array(B*2);if(Nt)for(var bt=P;bt<Ct;bt++)Gt[2*bt+0]=y[bt].bb_l,Gt[2*bt+1]=y[bt].bb_r;else for(var bt=P;bt<Ct;bt++)Gt[2*bt+0]=y[bt].bb_b,Gt[2*bt+1]=y[bt].bb_t;Gt.sort(function(je,Ke){return je-Ke});var Qt=(Gt[B-1]+Gt[B])*.5,ie=it,he=nt,ve=_t,be=vt,oe=it,Pe=nt,we=_t,Ze=vt;Nt?ve=oe=Qt:be=Pe=Qt;for(var Ie=Ct,Ge=P;Ge<Ie;){var H=y[Ge];Ht(H,oe,Pe,we,Ze)<Ht(H,ie,he,ve,be)?(Ie--,y[Ge]=y[Ie],y[Ie]=H):Ge++}if(Ie==B){for(var H=null,bt=P;bt<Ct;bt++)H=Rt(H,y[bt],g);return H}return NodeNew(g,Xt(g,y,P,Ie-P),Xt(g,y,Ie,Ct-Ie))};Vt.prototype.optimize=function(){var g=new Array(this.count),y=0;for(var P in this.leaves)g[y++]=this.nodes[P];tree.subtreeRecycle(root),this.root=Xt(tree,g,g.length)};var jt=function(g,y){!g.isLeaf&&y<=10&&(jt(g.A,y+1),jt(g.B,y+1));for(var P="",B=0;B<y;B++)P+=" ";console.log(P+g.bb_b+" "+g.bb_t)};Vt.prototype.log=function(){this.root&&jt(this.root,0)};var te=t.CollisionHandler=function(){this.a=this.b=0};te.prototype.begin=function(g,y){return!0},te.prototype.preSolve=function(g,y){return!0},te.prototype.postSolve=function(g,y){},te.prototype.separate=function(g,y){};var Jt=function(g,y){this.e=0,this.u=0,this.surface_vr=A,this.a=g,this.body_a=g.body,this.b=y,this.body_b=y.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Jt.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Jt.prototype.totalImpulse=function(){for(var g=this.contacts,y=new v(0,0),P=0,B=g.length;P<B;P++){var H=g[P];y.add(tt(H.n,H.jnAcc))}return this.swappedColl?y:y.neg()},Jt.prototype.totalImpulseWithFriction=function(){for(var g=this.contacts,y=new v(0,0),P=0,B=g.length;P<B;P++){var H=g[P];y.add(new v(H.jnAcc,H.jtAcc).rotate(H.n))}return this.swappedColl?y:y.neg()},Jt.prototype.totalKE=function(){for(var g=(1-this.e)/(1+this.e),y=0,P=this.contacts,B=0,H=P.length;B<H;B++){var it=P[B],nt=it.jnAcc,_t=it.jtAcc;y+=g*nt*nt/it.nMass+_t*_t/it.tMass}return y},Jt.prototype.ignore=function(){this.state="ignore"},Jt.prototype.getA=function(){return this.swappedColl?this.b:this.a},Jt.prototype.getB=function(){return this.swappedColl?this.a:this.b},Jt.prototype.isFirstContact=function(){return this.state==="first coll"};var qt=function(g,y,P){this.point=g,this.normal=y,this.dist=P};Jt.prototype.getContactPointSet=function(){var g=new Array(this.contacts.length),y;for(y=0;y<g.length;y++)g[y]=new qt(this.contacts[y].p,this.contacts[y].n,this.contacts[y].dist);return g},Jt.prototype.getNormal=function(g){var y=this.contacts[g].n;return this.swappedColl?K(y):y},Jt.prototype.getPoint=function(g){return this.contacts[g].p},Jt.prototype.getDepth=function(g){return this.contacts[g].dist};var ee=function(g,y,P,B){P?P.body_a===y?P.thread_a_next=B:P.thread_b_next=B:y.arbiterList=B,B&&(B.body_a===y?B.thread_a_prev=P:B.thread_b_prev=P)};Jt.prototype.unthread=function(){ee(this,this.body_a,this.thread_a_prev,this.thread_a_next),ee(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Jt.prototype.update=function(g,y,P,B){if(this.contacts)for(var H=0;H<this.contacts.length;H++)for(var it=this.contacts[H],nt=0;nt<g.length;nt++){var _t=g[nt];_t.hash===it.hash&&(_t.jnAcc=it.jnAcc,_t.jtAcc=it.jtAcc)}this.contacts=g,this.handler=y,this.swappedColl=P.collision_type!==y.a,this.e=P.e*B.e,this.u=P.u*B.u,this.surface_vr=U(P.surface_v,B.surface_v),this.a=P,this.body_a=P.body,this.b=B,this.body_b=B.body,this.state=="cached"&&(this.state="first coll")},Jt.prototype.preStep=function(g,y,P){for(var B=this.body_a,H=this.body_b,it=0;it<this.contacts.length;it++){var nt=this.contacts[it];nt.r1=U(nt.p,B.p),nt.r2=U(nt.p,H.p),nt.nMass=1/Oe(B,H,nt.r1,nt.r2,nt.n),nt.tMass=1/Oe(B,H,nt.r1,nt.r2,L(nt.n)),nt.bias=-P*o(0,nt.dist+y)/g,nt.jBias=0,nt.bounce=pe(B,H,nt.r1,nt.r2,nt.n)*this.e}},Jt.prototype.applyCachedImpulse=function(g){if(!this.isFirstContact())for(var y=this.body_a,P=this.body_b,B=0;B<this.contacts.length;B++){var H=this.contacts[B],it=H.n.x,nt=H.n.y,_t=it*H.jnAcc-nt*H.jtAcc,vt=it*H.jtAcc+nt*H.jnAcc;ge(y,P,H.r1,H.r2,_t*g,vt*g)}},Jt.prototype.applyImpulse=function(){for(var g=this.body_a,y=this.body_b,P=this.surface_vr,B=this.u,H=0;H<this.contacts.length;H++){var it=this.contacts[H],nt=it.nMass,_t=it.n,vt=it.r1,Ct=it.r2,bt=y.vx-Ct.y*y.w-(g.vx-vt.y*g.w),Nt=y.vy+Ct.x*y.w-(g.vy+vt.x*g.w),Gt=_t.x*(y.v_biasx-Ct.y*y.w_bias-g.v_biasx+vt.y*g.w_bias)+_t.y*(Ct.x*y.w_bias+y.v_biasy-vt.x*g.w_bias-g.v_biasy),Qt=N(bt,Nt,_t.x,_t.y),ie=N(bt+P.x,Nt+P.y,-_t.y,_t.x),he=(it.bias-Gt)*nt,ve=it.jBias;it.jBias=a(ve+he,0);var be=-(it.bounce+Qt)*nt,oe=it.jnAcc;it.jnAcc=a(oe+be,0);var Pe=B*it.jnAcc,we=-ie*it.tMass,Ze=it.jtAcc;it.jtAcc=x(Ze+we,-Pe,Pe);var Ie=_t.x*(it.jBias-ve),Ge=_t.y*(it.jBias-ve);ze(g,-Ie,-Ge,vt),ze(y,Ie,Ge,Ct);var je=it.jnAcc-oe,Ke=it.jtAcc-Ze;ge(g,y,vt,Ct,_t.x*je-_t.y*Ke,_t.x*Ke+_t.y*je)}},Jt.prototype.callSeparate=function(g){var y=g.lookupHandler(this.a.collision_type,this.b.collision_type);y.separate(this,g)},Jt.prototype.next=function(g){return this.body_a==g?this.thread_a_next:this.thread_b_next};var Bt=function(g,y,P,B){this.p=g,this.n=y,this.dist=P,this.r1=this.r2=A,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=B},kt=[],Kt=function(g,y,P,B){var H=P+B,it=U(y,g),nt=j(it);if(!(nt>=H*H)){var _t=Math.sqrt(nt);return new Bt(J(g,tt(it,.5+(P-.5*H)/(_t||1/0))),_t?tt(it,1/_t):new v(1,0),_t-H,0)}},ce=function(g,y){var P=Kt(g.tc,y.tc,g.r,y.r);return P?[P]:kt},ue=function(g,y){var P=y.ta,B=y.tb,H=g.tc,it=U(B,P),nt=m(D(it,U(H,P))/j(it)),_t=J(P,tt(it,nt)),vt=Kt(H,_t,g.r,y.r);if(vt){var Ct=vt.n;return nt===0&&D(Ct,y.a_tangent)<0||nt===1&&D(Ct,y.b_tangent)<0?kt:[vt]}else return kt},le=0,Te=function(g,y){var P=0,B=g.valueOnAxis(y[0].n,y[0].d);if(B>0)return-1;for(var H=1;H<y.length;H++){var it=g.valueOnAxis(y[H].n,y[H].d);if(it>0)return-1;it>B&&(B=it,P=H)}return le=B,P},Ce=function(g,y,P,B){for(var H=[],it=g.tVerts,nt=0;nt<it.length;nt+=2){var _t=it[nt],vt=it[nt+1];y.containsVertPartial(_t,vt,K(P))&&H.push(new Bt(new v(_t,vt),P,B,c(g.hashid,nt)))}for(var Ct=y.tVerts,nt=0;nt<Ct.length;nt+=2){var _t=Ct[nt],vt=Ct[nt+1];g.containsVertPartial(_t,vt,P)&&H.push(new Bt(new v(_t,vt),P,B,c(y.hashid,nt)))}return H},Ot=function(g,y,P,B){for(var H=[],it=g.tVerts,nt=0;nt<it.length;nt+=2){var _t=it[nt],vt=it[nt+1];y.containsVert(_t,vt)&&H.push(new Bt(new v(_t,vt),P,B,c(g.hashid,nt>>1)))}for(var Ct=y.tVerts,nt=0;nt<Ct.length;nt+=2){var _t=Ct[nt],vt=Ct[nt+1];g.containsVert(_t,vt)&&H.push(new Bt(new v(_t,vt),P,B,c(y.hashid,nt>>1)))}return H.length?H:Ce(g,y,P,B)},ae=function(g,y){var P=Te(y,g.tPlanes);if(P==-1)return kt;var B=le,H=Te(g,y.tPlanes);if(H==-1)return kt;var it=le;return B>it?Ot(g,y,g.tPlanes[P].n,B):Ot(g,y,K(y.tPlanes[H].n),it)},de=function(g,y,P){var B=D(y,g.ta)-g.r,H=D(y,g.tb)-g.r;return o(B,H)-P},_e=function(g,y,P,B,H){for(var it=rt(y.tn,y.ta),nt=rt(y.tn,y.tb),_t=tt(y.tn,H),vt=P.tVerts,Ct=0;Ct<vt.length;Ct+=2){var bt=vt[Ct],Nt=vt[Ct+1];if(N(bt,Nt,_t.x,_t.y)<D(y.tn,y.ta)*H+y.r){var Gt=I(y.tn.x,y.tn.y,bt,Nt);it>=Gt&&Gt>=nt&&g.push(new Bt(new v(bt,Nt),_t,B,c(P.hashid,Ct)))}}},Zt=function(g,y){var P=[],B=y.tPlanes,H=B.length,it=D(g.tn,g.ta),nt=y.valueOnAxis(g.tn,it)-g.r,_t=y.valueOnAxis(K(g.tn),-it)-g.r;if(_t>0||nt>0)return kt;var vt=0,Ct=de(g,B[0].n,B[0].d);if(Ct>0)return kt;for(var bt=0;bt<H;bt++){var Nt=de(g,B[bt].n,B[bt].d);if(Nt>0)return kt;Nt>Ct&&(Ct=Nt,vt=bt)}var Gt=K(B[vt].n),Qt=J(g.ta,tt(Gt,g.r)),ie=J(g.tb,tt(Gt,g.r));if(y.containsVert(Qt.x,Qt.y)&&P.push(new Bt(Qt,Gt,Ct,c(g.hashid,0))),y.containsVert(ie.x,ie.y)&&P.push(new Bt(ie,Gt,Ct,c(g.hashid,1))),(nt>=Ct||_t>=Ct)&&(nt>_t?_e(P,g,y,nt,1):_e(P,g,y,_t,-1)),P.length===0){var he=vt*2,ve=y.tVerts,be=new v(ve[he],ve[he+1]),oe;if(oe=Kt(g.ta,be,g.r,0))return[oe];if(oe=Kt(g.tb,be,g.r,0))return[oe];var Pe=H*2,we=new v(ve[(he+2)%Pe],ve[(he+3)%Pe]);if(oe=Kt(g.ta,we,g.r,0))return[oe];if(oe=Kt(g.tb,we,g.r,0))return[oe]}return P},me=function(g,y){for(var P=y.tPlanes,B=0,H=D(P[0].n,g.tc)-P[0].d-g.r,it=0;it<P.length;it++){var nt=D(P[it].n,g.tc)-P[it].d-g.r;if(nt>0)return kt;nt>H&&(H=nt,B=it)}var _t=P[B].n,vt=y.tVerts,Ct=vt.length,bt=B<<1,Nt=vt[bt],Gt=vt[bt+1],Qt=vt[(bt+2)%Ct],ie=vt[(bt+3)%Ct],he=I(_t.x,_t.y,Nt,Gt),ve=I(_t.x,_t.y,Qt,ie),be=rt(_t,g.tc);if(be<ve){var oe=Kt(g.tc,new v(Qt,ie),g.r,0);return oe?[oe]:kt}else{if(be<he)return[new Bt(U(g.tc,tt(_t,g.r+H/2)),K(_t),H,0)];var oe=Kt(g.tc,new v(Nt,Gt),g.r,0);return oe?[oe]:kt}};ht.prototype.collisionCode=0,mt.prototype.collisionCode=1,xt.prototype.collisionCode=2,ht.prototype.collisionTable=[ce,ue,me],mt.prototype.collisionTable=[null,function(g,y){return kt},Zt],xt.prototype.collisionTable=[null,null,ae];var re=t.collideShapes=function(g,y){return e(g.collisionCode<=y.collisionCode,"Collided shapes must be sorted by type"),g.collisionTable[y.collisionCode](g,y)},Le=new te,Ut=t.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new Vt(null),this.activeShapes=new Vt(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=Le,this.postStepCallbacks=[],this.iterations=10,this.gravity=A,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(1-.1,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new at(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};Ut.prototype.getCurrentTimeStep=function(){return this.curr_dt},Ut.prototype.setIterations=function(g){this.iterations=g},Ut.prototype.isLocked=function(){return this.locked};var ye=function(g){e(!g.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};Ut.prototype.addCollisionHandler=function(g,y,P,B,H,it){ye(this),this.removeCollisionHandler(g,y);var nt=new te;nt.a=g,nt.b=y,P&&(nt.begin=P),B&&(nt.preSolve=B),H&&(nt.postSolve=H),it&&(nt.separate=it),this.collisionHandlers[c(g,y)]=nt},Ut.prototype.removeCollisionHandler=function(g,y){ye(this),delete this.collisionHandlers[c(g,y)]},Ut.prototype.setDefaultCollisionHandler=function(g,y,P,B){ye(this);var H=new te;g&&(H.begin=g),y&&(H.preSolve=y),P&&(H.postSolve=P),B&&(H.separate=B),this.defaultHandler=H},Ut.prototype.lookupHandler=function(g,y){return this.collisionHandlers[c(g,y)]||this.defaultHandler},Ut.prototype.addShape=function(g){var y=g.body;return y.isStatic()?this.addStaticShape(g):(e(!g.space,"This shape is already added to a space and cannot be added to another."),ye(this),y.activate(),y.addShape(g),g.update(y.p,y.rot),this.activeShapes.insert(g,g.hashid),g.space=this||window,g)},Ut.prototype.addStaticShape=function(g){e(!g.space,"This shape is already added to a space and cannot be added to another."),ye(this);var y=g.body;return y.addShape(g),g.update(y.p,y.rot),this.staticShapes.insert(g,g.hashid),g.space=this||window,g},Ut.prototype.addBody=function(g){return e(!g.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),e(!g.space,"This body is already added to a space and cannot be added to another."),ye(this),this.bodies.push(g),g.space=this||window,g},Ut.prototype.addConstraint=function(g){e(!g.space,"This shape is already added to a space and cannot be added to another."),ye(this);var y=g.a,P=g.b;return y.activate(),P.activate(),this.constraints.push(g),g.next_a=y.constraintList,y.constraintList=g,g.next_b=P.constraintList,P.constraintList=g,g.space=this||window,g},Ut.prototype.filterArbiters=function(g,y){for(var P in this.cachedArbiters){var B=this.cachedArbiters[P];(g===B.body_a&&(y===B.a||y===null)||g===B.body_b&&(y===B.b||y===null))&&(y&&B.state!=="cached"&&B.callSeparate(this),B.unthread(),l(this.arbiters,B),delete this.cachedArbiters[P])}},Ut.prototype.removeShape=function(g){var y=g.body;y.isStatic()?this.removeStaticShape(g):(e(this.containsShape(g),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),ye(this),y.activate(),y.removeShape(g),this.filterArbiters(y,g),this.activeShapes.remove(g,g.hashid),g.space=null)},Ut.prototype.removeStaticShape=function(g){e(this.containsShape(g),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),ye(this);var y=g.body;y.isStatic()&&y.activateStatic(g),y.removeShape(g),this.filterArbiters(y,g),this.staticShapes.remove(g,g.hashid),g.space=null},Ut.prototype.removeBody=function(g){e(this.containsBody(g),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),ye(this),g.activate(),l(this.bodies,g),g.space=null},Ut.prototype.removeConstraint=function(g){e(this.containsConstraint(g),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),ye(this),g.a.activate(),g.b.activate(),l(this.constraints,g),g.a.removeConstraint(g),g.b.removeConstraint(g),g.space=null},Ut.prototype.containsShape=function(g){return g.space===this},Ut.prototype.containsBody=function(g){return g.space==this},Ut.prototype.containsConstraint=function(g){return g.space==this},Ut.prototype.uncacheArbiter=function(g){delete this.cachedArbiters[c(g.a.hashid,g.b.hashid)],l(this.arbiters,g)},Ut.prototype.eachBody=function(g){this.lock();{for(var y=this.bodies,P=0;P<y.length;P++)g(y[P]);for(var B=this.sleepingComponents,P=0;P<B.length;P++)for(var H=B[P],it=H;it;){var nt=it.nodeNext;g(it),it=nt}}this.unlock(!0)},Ut.prototype.eachShape=function(g){this.lock(),this.activeShapes.each(g),this.staticShapes.each(g),this.unlock(!0)},Ut.prototype.eachConstraint=function(g){this.lock();for(var y=this.constraints,P=0;P<y.length;P++)g(y[P]);this.unlock(!0)},Ut.prototype.reindexStatic=function(){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(g){var y=g.body;g.update(y.p,y.rot)}),this.staticShapes.reindex()},Ut.prototype.reindexShape=function(g){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var y=g.body;g.update(y.p,y.rot),this.activeShapes.reindexObject(g,g.hashid),this.staticShapes.reindexObject(g,g.hashid)},Ut.prototype.reindexShapesForBody=function(g){for(var y=g.shapeList;y;y=y.next)this.reindexShape(y)},Ut.prototype.useSpatialHash=function(g,y){throw new Error("Spatial Hash not implemented.")},Ut.prototype.activateBody=function(g){if(e(!g.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)this.rousedBodies.indexOf(g)===-1&&this.rousedBodies.push(g);else{this.bodies.push(g);for(var y=0;y<g.shapeList.length;y++){var P=g.shapeList[y];this.staticShapes.remove(P,P.hashid),this.activeShapes.insert(P,P.hashid)}for(var B=g.arbiterList;B;B=B.next(g)){var H=B.body_a;if(g===H||H.isStatic()){var it=B.a,nt=B.b;this.cachedArbiters[c(it.hashid,nt.hashid)]=B,B.stamp=this.stamp,B.handler=this.lookupHandler(it.collision_type,nt.collision_type),this.arbiters.push(B)}}for(var _t=g.constraintList;_t;_t=_t.nodeNext){var H=_t.a;(g===H||H.isStatic())&&this.constraints.push(_t)}}},Ut.prototype.deactivateBody=function(g){e(!g.isRogue(),"Internal error: Attempting to deactivate a rogue body."),l(this.bodies,g);for(var y=0;y<g.shapeList.length;y++){var P=g.shapeList[y];this.activeShapes.remove(P,P.hashid),this.staticShapes.insert(P,P.hashid)}for(var B=g.arbiterList;B;B=B.next(g)){var H=B.body_a;(g===H||H.isStatic())&&this.uncacheArbiter(B)}for(var it=g.constraintList;it;it=it.nodeNext){var H=it.a;(g===H||H.isStatic())&&l(this.constraints,it)}};var fe=function(g){return g?g.nodeRoot:null},ne=function(g){if(!(!g||!g.isSleeping(g))){e(!g.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var y=g.space,P=g;P;){var B=P.nodeNext;P.nodeIdleTime=0,P.nodeRoot=null,P.nodeNext=null,y.activateBody(P),P=B}l(y.sleepingComponents,g)}};at.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,ne(fe(this)))},at.prototype.activateStatic=function(g){e(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var y=this.arbiterList;y;y=y.next(this))(!g||g==y.a||g==y.b)&&(y.body_a==this?y.body_b:y.body_a).activate()},at.prototype.pushArbiter=function(g){r((g.body_a===this?g.thread_a_next:g.thread_b_next)===null,"Internal Error: Dangling contact graph pointers detected. (A)"),r((g.body_a===this?g.thread_a_prev:g.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (B)");var y=this.arbiterList;r(y===null||(y.body_a===this?y.thread_a_prev:y.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (C)"),g.body_a===this?g.thread_a_next=y:g.thread_b_next=y,y&&(y.body_a===this?y.thread_a_prev=g:y.thread_b_prev=g),this.arbiterList=g};var Re=function(g,y){y.nodeRoot=g,y!==g&&(y.nodeNext=g.nodeNext,g.nodeNext=y)},se=function(g,y){if(!y.isRogue()){var P=fe(y);if(P==null){Re(g,y);for(var B=y.arbiterList;B;B=B.next(y))se(g,y==B.body_a?B.body_b:B.body_a);for(var H=y.constraintList;H;H=H.next(y))se(g,y==H.a?H.b:H.a)}else r(P===g,"Internal Error: Inconsistency detected in the contact graph.")}},Ve=function(g,y){for(var P=g;P;P=P.nodeNext)if(P.nodeIdleTime<y)return!0;return!1};Ut.prototype.processComponents=function(g){for(var y=this.sleepTimeThreshold!==1/0,P=this.bodies,B=0;B<P.length;B++){var H=P[B];r(H.nodeNext===null,"Internal Error: Dangling next pointer detected in contact graph."),r(H.nodeRoot===null,"Internal Error: Dangling root pointer detected in contact graph.")}if(y)for(var it=this.idleSpeedThreshold,nt=it?it*it:j(this.gravity)*g*g,B=0;B<P.length;B++){var H=P[B],_t=nt?H.m*nt:0;H.nodeIdleTime=H.kineticEnergy()>_t?0:H.nodeIdleTime+g}for(var vt=this.arbiters,B=0,Ct=vt.length;B<Ct;B++){var bt=vt[B],Nt=bt.body_a,Gt=bt.body_b;y&&((Gt.isRogue()&&!Gt.isStatic()||Nt.isSleeping())&&Nt.activate(),(Nt.isRogue()&&!Nt.isStatic()||Gt.isSleeping())&&Gt.activate()),Nt.pushArbiter(bt),Gt.pushArbiter(bt)}if(y){for(var Qt=this.constraints,B=0;B<Qt.length;B++){var ie=Qt[B],Nt=ie.a,Gt=ie.b;Gt.isRogue()&&!Gt.isStatic()&&Nt.activate(),Nt.isRogue()&&!Nt.isStatic()&&Gt.activate()}for(var B=0;B<P.length;){var H=P[B];if(fe(H)===null&&(se(H,H),!Ve(H,this.sleepTimeThreshold))){this.sleepingComponents.push(H);for(var he=H;he;he=he.nodeNext)this.deactivateBody(he);continue}B++,H.nodeRoot=null,H.nodeNext=null}}},at.prototype.sleep=function(){this.sleepWithGroup(null)},at.prototype.sleepWithGroup=function(g){e(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var y=this.space;if(e(y,"Cannot put a rogue body to sleep."),e(!y.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),e(g===null||g.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping()){e(fe(this)===fe(g),"The body is already sleeping and it's group cannot be reassigned.");return}for(var P=0;P<this.shapeList.length;P++)this.shapeList[P].update(this.p,this.rot);if(y.deactivateBody(this),g){var B=fe(g);this.nodeRoot=B,this.nodeNext=B.nodeNext,this.nodeIdleTime=0,B.nodeNext=this||window}else this.nodeRoot=this||window,this.nodeNext=null,this.nodeIdleTime=0,y.sleepingComponents.push(this);l(y.bodies,this)},Ut.prototype.activateShapesTouchingShape=function(g){this.sleepTimeThreshold!==1/0&&this.shapeQuery(g,function(y,P){y.body.activate()})},Ut.prototype.pointQuery=function(g,y,P,B){var H=function(nt){!(nt.group&&P===nt.group)&&y&nt.layers&&nt.pointQuery(g)&&B(nt)},it=new k(g.x,g.y,g.x,g.y);this.lock(),this.activeShapes.query(it,H),this.staticShapes.query(it,H),this.unlock(!0)},Ut.prototype.pointQueryFirst=function(g,y,P){var B=null;return this.pointQuery(g,y,P,function(H){H.sensor||(B=H)}),B},Ut.prototype.nearestPointQuery=function(g,y,P,B,H){var it=function(_t){if(!(_t.group&&B===_t.group)&&P&_t.layers){var vt=_t.nearestPointQuery(g);vt.d<y&&H(_t,vt.d,vt.p)}},nt=X(g,y);this.lock(),this.activeShapes.query(nt,it),this.staticShapes.query(nt,it),this.unlock(!0)},Ut.prototype.nearestPointQueryNearest=function(g,y,P,B){var H,it=function(_t){if(!(_t.group&&B===_t.group)&&P&_t.layers&&!_t.sensor){var vt=_t.nearestPointQuery(g);vt.d<y&&(!H||vt.d<H.d)&&(H=vt)}},nt=X(g,y);return this.activeShapes.query(nt,it),this.staticShapes.query(nt,it),H},t.SHAPE_FILTER_ALL={group:t.NO_GROUP,categories:t.ALL_CATEGORIES,mask:t.ALL_CATEGORIES},Ut.prototype.pointQueryNearest=function(g,y,P){var B=this.nearestPointQueryNearest(g,y,P.mask,P.group);return typeof B!="undefined"&&(B.distance=B.d,B.point=B.p),B},Ut.prototype.segmentQuery=function(g,y,P,B,H){var it=function(nt){var _t;return!(nt.group&&B===nt.group)&&P&nt.layers&&(_t=nt.segmentQuery(g,y))&&H(nt,_t.t,_t.n),1};this.lock(),this.staticShapes.segmentQuery(g,y,1,it),this.activeShapes.segmentQuery(g,y,1,it),this.unlock(!0)},Ut.prototype.segmentQueryFirst=function(g,y,P,B){var H=null,it=function(nt){var _t;return!(nt.group&&B===nt.group)&&P&nt.layers&&!nt.sensor&&(_t=nt.segmentQuery(g,y))&&(H===null||_t.t<H.t)&&(H=_t),H?H.t:1};return this.staticShapes.segmentQuery(g,y,1,it),this.activeShapes.segmentQuery(g,y,H?H.t:1,it),H&&H!=="null"&&H!=="undefined"&&(H.normal=H.n,H.alpha=H.t,H.p=H.point=t.v.lerp(g,y,H.t)),H},Ut.prototype.bbQuery=function(g,y,P,B){var H=function(it){!(it.group&&P===it.group)&&y&it.layers&&Z(g,it.bb_l,it.bb_b,it.bb_r,it.bb_t)&&B(it)};this.lock(),this.activeShapes.query(g,H),this.staticShapes.query(g,H),this.unlock(!0)},Ut.prototype.shapeQuery=function(g,y){var P=g.body;P&&g.update(P.p,P.rot);var B=new k(g.bb_l,g.bb_b,g.bb_r,g.bb_t),H=!1,it=function(nt){var _t=g;if(!(_t.group&&_t.group===nt.group||!(_t.layers&nt.layers)||_t===nt)){var vt;if(_t.collisionCode<=nt.collisionCode)vt=re(_t,nt);else{vt=re(nt,_t);for(var Ct=0;Ct<vt.length;Ct++)vt[Ct].n=K(vt[Ct].n)}if(vt.length&&(H=!(_t.sensor||nt.sensor),y)){for(var bt=new Array(vt.length),Ct=0;Ct<vt.length;Ct++)bt[Ct]=new qt(vt[Ct].p,vt[Ct].n,vt[Ct].dist);y(nt,bt)}}};return this.lock(),this.activeShapes.query(B,it),this.staticShapes.query(B,it),this.unlock(!0),H},Ut.prototype.addPostStepCallback=function(g){r(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(g)},Ut.prototype.runPostStepCallbacks=function(){for(var g=0;g<this.postStepCallbacks.length;g++)this.postStepCallbacks[g]();this.postStepCallbacks=[]},Ut.prototype.lock=function(){this.locked++},Ut.prototype.unlock=function(g){if(this.locked--,e(this.locked>=0,"Internal Error: Space lock underflow."),this.locked===0&&g){for(var y=this.rousedBodies,P=0;P<y.length;P++)this.activateBody(y[P]);y.length=0,this.runPostStepCallbacks()}},Ut.prototype.makeCollideShapes=function(){var g=this||window;return function(y,P){var B=g;if(!(!(y.bb_l<=P.bb_r&&P.bb_l<=y.bb_r&&y.bb_b<=P.bb_t&&P.bb_b<=y.bb_t)||y.body===P.body||y.group&&y.group===P.group||!(y.layers&P.layers))){var H=B.lookupHandler(y.collision_type,P.collision_type),it=y.sensor||P.sensor;if(!(it&&H===Le)){if(y.collisionCode>P.collisionCode){var nt=y;y=P,P=nt}var _t=re(y,P);if(_t.length!==0){var vt=c(y.hashid,P.hashid),Ct=B.cachedArbiters[vt];Ct||(Ct=B.cachedArbiters[vt]=new Jt(y,P)),Ct.update(_t,H,y,P),Ct.state=="first coll"&&!H.begin(Ct,B)&&Ct.ignore(),Ct.state!=="ignore"&&H.preSolve(Ct,B)&&!it?B.arbiters.push(Ct):(Ct.contacts=null,Ct.state!=="ignore"&&(Ct.state="normal")),Ct.stamp=B.stamp}}}}},Ut.prototype.arbiterSetFilter=function(g){var y=this.stamp-g.stamp,P=g.body_a,B=g.body_b;return(P.isStatic()||P.isSleeping())&&(B.isStatic()||B.isSleeping())?!0:(y>=1&&g.state!="cached"&&(g.callSeparate(this),g.state="cached"),y>=this.collisionPersistence?(g.contacts=null,!1):!0)};var Se=function(g){var y=g.body;g.update(y.p,y.rot)};Ut.prototype.step=function(g){if(g!==0){e(A.x===0&&A.y===0,"vzero is invalid"),this.stamp++;var y=this.curr_dt;this.curr_dt=g;var P,B,H,it=this.bodies,nt=this.constraints,_t=this.arbiters;for(P=0;P<_t.length;P++){var vt=_t[P];vt.state="normal",!vt.body_a.isSleeping()&&!vt.body_b.isSleeping()&&vt.unthread()}_t.length=0,this.lock();{for(P=0;P<it.length;P++)it[P].position_func(g);this.activeShapes.each(Se),this.activeShapes.reindexQuery(this.collideShapes)}this.unlock(!1),this.processComponents(g),this.lock();{for(H in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[H])||delete this.cachedArbiters[H];var Ct=this.collisionSlop,bt=1-Math.pow(this.collisionBias,g);for(P=0;P<_t.length;P++)_t[P].preStep(g,Ct,bt);for(P=0;P<nt.length;P++){var Nt=nt[P];Nt.preSolve(this),Nt.preStep(g)}var Gt=Math.pow(this.damping,g),Qt=this.gravity;for(P=0;P<it.length;P++)it[P].velocity_func(Qt,Gt,g);var ie=y===0?0:g/y;for(P=0;P<_t.length;P++)_t[P].applyCachedImpulse(ie);for(P=0;P<nt.length;P++)nt[P].applyCachedImpulse(ie);for(P=0;P<this.iterations;P++){for(B=0;B<_t.length;B++)_t[B].applyImpulse();for(B=0;B<nt.length;B++)nt[B].applyImpulse()}for(P=0;P<nt.length;P++)nt[P].postSolve(this);for(P=0;P<_t.length;P++)_t[P].handler.postSolve(_t[P],this)}this.unlock(!0)}};var xe=function(g,y,P,B){var H=g.vx+-P.y*g.w,it=g.vy+P.x*g.w,nt=y.vx+-B.y*y.w,_t=y.vy+B.x*y.w;return new v(nt-H,_t-it)},pe=function(g,y,P,B,H){var it=g.vx+-P.y*g.w,nt=g.vy+P.x*g.w,_t=y.vx+-B.y*y.w,vt=y.vy+B.x*y.w;return N(_t-it,vt-nt,H.x,H.y)},Ee=function(g,y,P,B){g.vx+=y*g.m_inv,g.vy+=P*g.m_inv,g.w+=g.i_inv*(B.x*P-B.y*y)},ge=function(g,y,P,B,H,it){Ee(g,-H,-it,P),Ee(y,H,it,B)},ze=function(g,y,P,B){g.v_biasx+=y*g.m_inv,g.v_biasy+=P*g.m_inv,g.w_bias+=g.i_inv*I(B.x,B.y,y,P)},Ae=function(g,y,P){var B=rt(y,P);return g.m_inv+g.i_inv*B*B},Oe=function(g,y,P,B,H){var it=Ae(g,P,H)+Ae(y,B,H);return r(it!==0,"Unsolvable collision or constraint."),it},Be=function(g,y,P,B,H,it){var nt,_t,vt,Ct,bt=g.m_inv+y.m_inv;nt=bt,_t=0,vt=0,Ct=bt;var Nt=g.i_inv,Gt=P.x*P.x*Nt,Qt=P.y*P.y*Nt,ie=-P.x*P.y*Nt;nt+=Qt,_t+=ie,vt+=ie,Ct+=Gt;var he=y.i_inv,ve=B.x*B.x*he,be=B.y*B.y*he,oe=-B.x*B.y*he;nt+=be,_t+=oe,vt+=oe,Ct+=ve;var Pe=nt*Ct-_t*vt;r(Pe!==0,"Unsolvable constraint.");var we=1/Pe;H.x=Ct*we,H.y=-_t*we,it.x=-vt*we,it.y=nt*we},We=function(g,y,P){return new v(D(g,y),D(g,P))},De=function(g,y){return 1-Math.pow(g,y)},$t=t.Constraint=function(g,y){this.a=g,this.b=y,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(1-.1,60),this.maxBias=1/0};$t.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},$t.prototype.preStep=function(g){},$t.prototype.applyCachedImpulse=function(g){},$t.prototype.applyImpulse=function(){},$t.prototype.getImpulse=function(){return 0},$t.prototype.preSolve=function(g){},$t.prototype.postSolve=function(g){},$t.prototype.next=function(g){return this.a===g?this.next_a:this.next_b};var Fe=t.PinJoint=function(g,y,P,B){$t.call(this,g,y),this.anchr1=P,this.anchr2=B;var H=g?J(g.p,w(P,g.rot)):P,it=y?J(y.p,w(B,y.rot)):B;this.dist=z(U(it,H)),r(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Fe.prototype=Object.create($t.prototype),Fe.prototype.preStep=function(g){var y=this.a,P=this.b;this.r1=w(this.anchr1,y.rot),this.r2=w(this.anchr2,P.rot);var B=U(J(P.p,this.r2),J(y.p,this.r1)),H=z(B);this.n=tt(B,1/(H||1/0)),this.nMass=1/Oe(y,P,this.r1,this.r2,this.n);var it=this.maxBias;this.bias=x(-De(this.errorBias,g)*(H-this.dist)/g,-it,it),this.jnMax=this.maxForce*g},Fe.prototype.applyCachedImpulse=function(g){var y=tt(this.n,this.jnAcc*g);ge(this.a,this.b,this.r1,this.r2,y.x,y.y)},Fe.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=this.n,B=pe(g,y,this.r1,this.r2,P),H=(this.bias-B)*this.nMass,it=this.jnAcc;this.jnAcc=x(it+H,-this.jnMax,this.jnMax),H=this.jnAcc-it,ge(g,y,this.r1,this.r2,P.x*H,P.y*H)},Fe.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ne=t.SlideJoint=function(g,y,P,B,H,it){$t.call(this,g,y),this.anchr1=P,this.anchr2=B,this.min=H,this.max=it,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Ne.prototype=Object.create($t.prototype),Ne.prototype.preStep=function(g){var y=this.a,P=this.b;this.r1=w(this.anchr1,y.rot),this.r2=w(this.anchr2,P.rot);var B=U(J(P.p,this.r2),J(y.p,this.r1)),H=z(B),it=0;H>this.max?(it=H-this.max,this.n=W(B)):H<this.min?(it=this.min-H,this.n=K(W(B))):(this.n=A,this.jnAcc=0),this.nMass=1/Oe(y,P,this.r1,this.r2,this.n);var nt=this.maxBias;this.bias=x(-De(this.errorBias,g)*it/g,-nt,nt),this.jnMax=this.maxForce*g},Ne.prototype.applyCachedImpulse=function(g){var y=this.jnAcc*g;ge(this.a,this.b,this.r1,this.r2,this.n.x*y,this.n.y*y)},Ne.prototype.applyImpulse=function(){if(!(this.n.x===0&&this.n.y===0)){var g=this.a,y=this.b,P=this.n,B=this.r1,H=this.r2,it=xe(g,y,B,H),nt=D(it,P),_t=(this.bias-nt)*this.nMass,vt=this.jnAcc;this.jnAcc=x(vt+_t,-this.jnMax,0),_t=this.jnAcc-vt,ge(g,y,this.r1,this.r2,P.x*_t,P.y*_t)}},Ne.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Ue=t.PivotJoint=function(g,y,P,B){if($t.call(this,g,y),typeof B=="undefined"){var H=P;P=g?g.world2Local(H):H,B=y?y.world2Local(H):H}this.anchr1=P,this.anchr2=B,this.r1=this.r2=A,this.k1=new v(0,0),this.k2=new v(0,0),this.jAcc=A,this.jMaxLen=0,this.bias=A};Ue.prototype=Object.create($t.prototype),Ue.prototype.preStep=function(g){var y=this.a,P=this.b;this.r1=w(this.anchr1,y.rot),this.r2=w(this.anchr2,P.rot),Be(y,P,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*g;var B=U(J(P.p,this.r2),J(y.p,this.r1));this.bias=S(tt(B,-De(this.errorBias,g)/g),this.maxBias)},Ue.prototype.applyCachedImpulse=function(g){ge(this.a,this.b,this.r1,this.r2,this.jAcc.x*g,this.jAcc.y*g)},Ue.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=this.r1,B=this.r2,H=xe(g,y,P,B),it=We(U(this.bias,H),this.k1,this.k2),nt=this.jAcc;this.jAcc=S(J(this.jAcc,it),this.jMaxLen),ge(g,y,this.r1,this.r2,this.jAcc.x-nt.x,this.jAcc.y-nt.y)},Ue.prototype.getImpulse=function(){return z(this.jAcc)};var Me=t.GrooveJoint=function(g,y,P,B,H){$t.call(this,g,y),this.grv_a=P,this.grv_b=B,this.grv_n=L(b(U(B,P))),this.anchr2=H,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new v(0,0),this.k2=new v(0,0),this.jAcc=A,this.jMaxLen=0,this.bias=null};Me.prototype=Object.create($t.prototype),Me.prototype.preStep=function(g){var y=this.a,P=this.b,B=y.local2World(this.grv_a),H=y.local2World(this.grv_b),it=w(this.grv_n,y.rot),nt=D(B,it);this.grv_tn=it,this.r2=w(this.anchr2,P.rot);var _t=rt(J(P.p,this.r2),it);_t<=rt(B,it)?(this.clamp=1,this.r1=U(B,y.p)):_t>=rt(H,it)?(this.clamp=-1,this.r1=U(H,y.p)):(this.clamp=0,this.r1=U(J(tt(L(it),-_t),tt(it,nt)),y.p)),Be(y,P,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*g;var vt=U(J(P.p,this.r2),J(y.p,this.r1));this.bias=S(tt(vt,-De(this.errorBias,g)/g),this.maxBias)},Me.prototype.applyCachedImpulse=function(g){ge(this.a,this.b,this.r1,this.r2,this.jAcc.x*g,this.jAcc.y*g)},Me.prototype.grooveConstrain=function(g){var y=this.grv_tn,P=this.clamp*rt(g,y)>0?g:G(g,y);return S(P,this.jMaxLen)},Me.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=this.r1,B=this.r2,H=xe(g,y,P,B),it=We(U(this.bias,H),this.k1,this.k2),nt=this.jAcc;this.jAcc=this.grooveConstrain(J(nt,it)),ge(g,y,this.r1,this.r2,this.jAcc.x-nt.x,this.jAcc.y-nt.y)},Me.prototype.getImpulse=function(){return z(this.jAcc)},Me.prototype.setGrooveA=function(g){this.grv_a=g,this.grv_n=L(b(U(this.grv_b,g))),this.activateBodies()},Me.prototype.setGrooveB=function(g){this.grv_b=g,this.grv_n=L(b(U(g,this.grv_a))),this.activateBodies()};var qe=function(g,y){return(g.restLength-y)*g.stiffness},Ye=t.DampedSpring=function(g,y,P,B,H,it,nt){$t.call(this,g,y),this.anchr1=P,this.anchr2=B,this.restLength=H,this.stiffness=it,this.damping=nt,this.springForceFunc=qe,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Ye.prototype=Object.create($t.prototype),Ye.prototype.preStep=function(g){var y=this.a,P=this.b;this.r1=w(this.anchr1,y.rot),this.r2=w(this.anchr2,P.rot);var B=U(J(P.p,this.r2),J(y.p,this.r1)),H=z(B);this.n=tt(B,1/(H||1/0));var it=Oe(y,P,this.r1,this.r2,this.n);r(it!==0,"Unsolvable this."),this.nMass=1/it,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*g*it);var nt=this.springForceFunc(this,H);ge(y,P,this.r1,this.r2,this.n.x*nt*g,this.n.y*nt*g)},Ye.prototype.applyCachedImpulse=function(g){},Ye.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=this.n,B=this.r1,H=this.r2,it=pe(g,y,B,H,P),nt=(this.target_vrn-it)*this.v_coef;this.target_vrn=it+nt,nt*=this.nMass,ge(g,y,this.r1,this.r2,this.n.x*nt,this.n.y*nt)},Ye.prototype.getImpulse=function(){return 0};var $e=function(g,y){return(y-g.restAngle)*g.stiffness},Qe=t.DampedRotarySpring=function(g,y,P,B,H){$t.call(this,g,y),this.restAngle=P,this.stiffness=B,this.damping=H,this.springTorqueFunc=$e,this.target_wrn=0,this.w_coef=0,this.iSum=0};Qe.prototype=Object.create($t.prototype),Qe.prototype.preStep=function(g){var y=this.a,P=this.b,B=y.i_inv+P.i_inv;r(B!==0,"Unsolvable spring."),this.iSum=1/B,this.w_coef=1-Math.exp(-this.damping*g*B),this.target_wrn=0;var H=this.springTorqueFunc(this,y.a-P.a)*g;y.w-=H*y.i_inv,P.w+=H*P.i_inv},Qe.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=g.w-y.w,B=(this.target_wrn-P)*this.w_coef;this.target_wrn=P+B;var H=B*this.iSum;g.w+=H*g.i_inv,y.w-=H*y.i_inv};var Xe=t.RotaryLimitJoint=function(g,y,P,B){$t.call(this,g,y),this.min=P,this.max=B,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Xe.prototype=Object.create($t.prototype),Xe.prototype.preStep=function(g){var y=this.a,P=this.b,B=P.a-y.a,H=0;B>this.max?H=this.max-B:B<this.min&&(H=this.min-B),this.iSum=1/(1/y.i+1/P.i);var it=this.maxBias;this.bias=x(-De(this.errorBias,g)*H/g,-it,it),this.jMax=this.maxForce*g,this.bias||(this.jAcc=0)},Xe.prototype.applyCachedImpulse=function(g){var y=this.a,P=this.b,B=this.jAcc*g;y.w-=B*y.i_inv,P.w+=B*P.i_inv},Xe.prototype.applyImpulse=function(){if(this.bias){var g=this.a,y=this.b,P=y.w-g.w,B=-(this.bias+P)*this.iSum,H=this.jAcc;this.bias<0?this.jAcc=x(H+B,0,this.jMax):this.jAcc=x(H+B,-this.jMax,0),B=this.jAcc-H,g.w-=B*g.i_inv,y.w+=B*y.i_inv}},Xe.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var He=t.RatchetJoint=function(g,y,P,B){$t.call(this,g,y),this.angle=0,this.phase=P,this.ratchet=B,this.angle=(y?y.a:0)-(g?g.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};He.prototype=Object.create($t.prototype),He.prototype.preStep=function(g){var y=this.a,P=this.b,B=this.angle,H=this.phase,it=this.ratchet,nt=P.a-y.a,_t=B-nt,vt=0;_t*it>0?vt=_t:this.angle=Math.floor((nt-H)/it)*it+H,this.iSum=1/(y.i_inv+P.i_inv);var Ct=this.maxBias;this.bias=x(-De(this.errorBias,g)*vt/g,-Ct,Ct),this.jMax=this.maxForce*g,this.bias||(this.jAcc=0)},He.prototype.applyCachedImpulse=function(g){var y=this.a,P=this.b,B=this.jAcc*g;y.w-=B*y.i_inv,P.w+=B*P.i_inv},He.prototype.applyImpulse=function(){if(this.bias){var g=this.a,y=this.b,P=y.w-g.w,B=this.ratchet,H=-(this.bias+P)*this.iSum,it=this.jAcc;this.jAcc=x((it+H)*B,0,this.jMax*Math.abs(B))/B,H=this.jAcc-it,g.w-=H*g.i_inv,y.w+=H*y.i_inv}},He.prototype.getImpulse=function(g){return Math.abs(g.jAcc)};var ke=t.GearJoint=function(g,y,P,B){$t.call(this,g,y),this.phase=P,this.ratio=B,this.ratio_inv=1/B,this.jAcc=0,this.iSum=this.bias=this.jMax=0};ke.prototype=Object.create($t.prototype),ke.prototype.preStep=function(g){var y=this.a,P=this.b;this.iSum=1/(y.i_inv*this.ratio_inv+this.ratio*P.i_inv);var B=this.maxBias;this.bias=x(-De(this.errorBias,g)*(P.a*this.ratio-y.a-this.phase)/g,-B,B),this.jMax=this.maxForce*g},ke.prototype.applyCachedImpulse=function(g){var y=this.a,P=this.b,B=this.jAcc*g;y.w-=B*y.i_inv*this.ratio_inv,P.w+=B*P.i_inv},ke.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=y.w*this.ratio-g.w,B=(this.bias-P)*this.iSum,H=this.jAcc;this.jAcc=x(H+B,-this.jMax,this.jMax),B=this.jAcc-H,g.w-=B*g.i_inv*this.ratio_inv,y.w+=B*y.i_inv},ke.prototype.getImpulse=function(){return Math.abs(this.jAcc)},ke.prototype.setRatio=function(g){this.ratio=g,this.ratio_inv=1/g,this.activateBodies()};var Je=t.SimpleMotor=function(g,y,P){$t.call(this,g,y),this.rate=P,this.jAcc=0,this.iSum=this.jMax=0};Je.prototype=Object.create($t.prototype),Je.prototype.preStep=function(g){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*g},Je.prototype.applyCachedImpulse=function(g){var y=this.a,P=this.b,B=this.jAcc*g;y.w-=B*y.i_inv,P.w+=B*P.i_inv},Je.prototype.applyImpulse=function(){var g=this.a,y=this.b,P=y.w-g.w+this.rate,B=-P*this.iSum,H=this.jAcc;this.jAcc=x(H+B,-this.jMax,this.jMax),B=this.jAcc-H,g.w-=B*g.i_inv,y.w+=B*y.i_inv},Je.prototype.getImpulse=function(){return Math.abs(this.jAcc)}})();var sp=sp||{};sp.VERTEX_INDEX={X1:0,Y1:1,X2:2,Y2:3,X3:4,Y3:5,X4:6,Y4:7};sp.ATTACHMENT_TYPE={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3};sp.Skeleton=exports.cc.Node.extend({_skeleton:null,_rootBone:null,_timeScale:1,_debugSlots:!1,_debugBones:!1,_premultipliedAlpha:!1,_ownsSkeletonData:null,_atlas:null,_blendFunc:null,ctor:function(t,e,r){exports.cc.Node.prototype.ctor.call(this),arguments.length===0?this.init():this.initWithArgs(t,e,r)},_createRenderCmd:function(){return exports.cc._renderType===exports.cc.game.RENDER_TYPE_CANVAS?new sp.Skeleton.CanvasRenderCmd(this):new sp.Skeleton.WebGLRenderCmd(this)},init:function(){exports.cc.Node.prototype.init.call(this),this._premultipliedAlpha=exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL&&exports.cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA,this._blendFunc={src:exports.cc.BLEND_SRC,dst:exports.cc.BLEND_DST},this.scheduleUpdate()},setDebugSolots:function(t){this._debugSlots=t},setDebugBones:function(t){this._debugBones=t},setDebugSlotsEnabled:function(t){this._debugSlots=t},getDebugSlotsEnabled:function(){return this._debugSlots},setDebugBonesEnabled:function(t){this._debugBones=t},getDebugBonesEnabled:function(){return this._debugBones},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},initWithArgs:function(t,e,r){var n=t,s=e,o,a,c;if(exports.cc.isString(n)){if(exports.cc.isString(s)){var l=exports.cc.loader.getRes(s);sp._atlasLoader.setAtlasFile(s),a=new spine.Atlas(l,sp._atlasLoader)}else a=e;r=r||1/exports.cc.director.getContentScaleFactor();var h=new spine.AtlasAttachmentLoader(a),u=new spine.SkeletonJson(h);u.scale=r;var _=exports.cc.loader.getRes(n);o=u.readSkeletonData(_),a.dispose(u),c=!0}else o=t,c=e;this.setSkeletonData(o,c),this.init()},getBoundingBox:function(){for(var t=exports.cc.FLT_MAX,e=exports.cc.FLT_MAX,r=exports.cc.FLT_MIN,n=exports.cc.FLT_MIN,s=this.getScaleX(),o=this.getScaleY(),a=[],c=this._skeleton.slots,l=sp.VERTEX_INDEX,h=0,u=c.length;h<u;++h){var _=c[h];if(!(!_.attachment||_.attachment.type!=sp.ATTACHMENT_TYPE.REGION)){var d=_.attachment;this._computeRegionAttachmentWorldVertices(d,_.bone.skeleton.x,_.bone.skeleton.y,_.bone,a),t=Math.min(t,a[l.X1]*s,a[l.X4]*s,a[l.X2]*s,a[l.X3]*s),e=Math.min(e,a[l.Y1]*o,a[l.Y4]*o,a[l.Y2]*o,a[l.Y3]*o),r=Math.max(r,a[l.X1]*s,a[l.X4]*s,a[l.X2]*s,a[l.X3]*s),n=Math.max(n,a[l.Y1]*o,a[l.Y4]*o,a[l.Y2]*o,a[l.Y3]*o)}}var f=this.getPosition();return exports.cc.rect(f.x+t,f.y+e,r-t,n-e)},_computeRegionAttachmentWorldVertices:function(t,e,r,n,s){var o=t.offset,a=sp.VERTEX_INDEX;e+=n.worldX,r+=n.worldY,s[a.X1]=o[a.X1]*n.m00+o[a.Y1]*n.m01+e,s[a.Y1]=o[a.X1]*n.m10+o[a.Y1]*n.m11+r,s[a.X2]=o[a.X2]*n.m00+o[a.Y2]*n.m01+e,s[a.Y2]=o[a.X2]*n.m10+o[a.Y2]*n.m11+r,s[a.X3]=o[a.X3]*n.m00+o[a.Y3]*n.m01+e,s[a.Y3]=o[a.X3]*n.m10+o[a.Y3]*n.m11+r,s[a.X4]=o[a.X4]*n.m00+o[a.Y4]*n.m01+e,s[a.Y4]=o[a.X4]*n.m10+o[a.Y4]*n.m11+r},updateWorldTransform:function(){this._skeleton.updateWorldTransform()},setToSetupPose:function(){this._skeleton.setToSetupPose()},setBonesToSetupPose:function(){this._skeleton.setBonesToSetupPose()},setSlotsToSetupPose:function(){this._skeleton.setSlotsToSetupPose()},findBone:function(t){return this._skeleton.findBone(t)},findSlot:function(t){return this._skeleton.findSlot(t)},setSkin:function(t){return this._skeleton.setSkinByName(t)},getAttachment:function(t,e){return this._skeleton.getAttachmentBySlotName(t,e)},setAttachment:function(t,e){this._skeleton.setAttachment(t,e)},setPremultipliedAlpha:function(t){this._premultipliedAlpha=t},isPremultipliedAlpha:function(){return this._premultipliedAlpha},setSkeletonData:function(t,e){t.width!=null&&t.height!=null&&this.setContentSize(t.width/exports.cc.director.getContentScaleFactor(),t.height/exports.cc.director.getContentScaleFactor()),this._skeleton=new spine.Skeleton(t),this._skeleton.updateWorldTransform(),this._rootBone=this._skeleton.getRootBone(),this._ownsSkeletonData=e,this._renderCmd._createChildFormSkeletonData()},getTextureAtlas:function(t){return t.rendererObject.page.rendererObject},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){var r=this._blendFunc;e===void 0?(r.src=t.src,r.dst=t.dst):(r.src=t,r.dst=e)},update:function(t){this._skeleton.update(t)}});sp.Skeleton.create=function(t,e,r){return new sp.Skeleton(t,e,r)};var spine={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:typeof Float32Array=="undefined"?Array:Float32Array,Uint16Array:typeof Uint16Array=="undefined"?Array:Uint16Array};spine.BoneData=function(t,e){this.length=this.x=this.y=this.rotation=0,this.scaleX=this.scaleY=1,this.name=t,this.parent=e};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1};spine.BlendMode={normal:0,additive:1,multiply:2,screen:3};spine.SlotData=function(t,e){this.r=this.g=this.b=this.a=1,this.blendMode=spine.BlendMode.normal,this.name=t,this.boneData=e};spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:spine.BlendMode.normal};spine.IkConstraintData=function(t){this.bendDirection=this.mix=1,this.name=t,this.bones=[]};spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};spine.Bone=function(t,e,r){this.x=this.y=this.rotation=this.rotationIK=0,this.scaleX=this.scaleY=1,this.flipX=this.flipY=!1,this.m00=this.m01=this.worldX=0,this.m10=this.m11=this.worldY=0,this.worldRotation=0,this.worldScaleX=this.worldScaleY=1,this.worldFlipX=this.worldFlipY=!1,this.data=t,this.skeleton=e,this.parent=r,this.setToSetupPose()};spine.Bone.yDown=!1;spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var t=this.parent;if(t)this.worldX=this.x*t.m00+this.y*t.m01+t.worldX,this.worldY=this.x*t.m10+this.y*t.m11+t.worldY,this.data.inheritScale?(this.worldScaleX=t.worldScaleX*this.scaleX,this.worldScaleY=t.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?t.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=t.worldFlipX!=this.flipX,this.worldFlipY=t.worldFlipY!=this.flipY;else{var e=this.skeleton.flipX,r=this.skeleton.flipY;this.worldX=e?-this.x:this.x,this.worldY=r!=spine.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=e!=this.flipX,this.worldFlipY=r!=this.flipY}var n=this.worldRotation*spine.degRad,s=Math.cos(n),o=Math.sin(n);this.worldFlipX?(this.m00=-s*this.worldScaleX,this.m01=o*this.worldScaleY):(this.m00=s*this.worldScaleX,this.m01=-o*this.worldScaleY),this.worldFlipY!=spine.Bone.yDown?(this.m10=-o*this.worldScaleX,this.m11=-s*this.worldScaleY):(this.m10=o*this.worldScaleX,this.m11=s*this.worldScaleY)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.rotationIK=this.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.flipX=t.flipX,this.flipY=t.flipY},worldToLocal:function(t){var e=t[0]-this.worldX,r=t[1]-this.worldY,n=this.m00,s=this.m10,o=this.m01,a=this.m11;this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)&&(n=-n,a=-a);var c=1/(n*a-o*s);t[0]=e*n*c-r*o*c,t[1]=r*a*c-e*s*c},localToWorld:function(t){var e=t[0],r=t[1];t[0]=e*this.m00+r*this.m01+this.worldX,t[1]=e*this.m10+r*this.m11+this.worldY}};spine.Slot=function(t,e){this.r=this.g=this.b=this.a=1,this._attachmentTime=0,this.data=t,this.bone=e,this.setToSetupPose()};spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(t){this.attachment=t,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(t){this._attachmentTime=this.bone.skeleton.time-t},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.bone.skeleton.data.slots,r=0,n=e.length;r<n;r++)if(e[r]==t){this.setAttachment(t.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(r,t.attachmentName):null);break}}};spine.IkConstraint=function(t,e){this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.bones=[];for(var r=0,n=t.bones.length;r<n;r++)this.bones.push(e.findBone(t.bones[r].name));this.target=e.findBone(t.target.name)};spine.IkConstraint.prototype={apply:function(){var t=this.target,e=this.bones;switch(e.length){case 1:spine.IkConstraint.apply1(e[0],t.worldX,t.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.mix);break}}};spine.IkConstraint.apply1=function(t,e,r,n){var s=!t.data.inheritRotation||!t.parent?0:t.parent.worldRotation,o=t.rotation,a=Math.atan2(r-t.worldY,e-t.worldX)*spine.radDeg;t.worldFlipX!=(t.worldFlipY!=spine.Bone.yDown)&&(a=-a),a-=s,t.rotationIK=o+(a-o)*n};spine.IkConstraint.apply2=function(t,e,r,n,s,o){var a=e.rotation,c=t.rotation;if(!o){e.rotationIK=a,t.rotationIK=c;return}var l,h,u=spine.temp,_=t.parent;_?(u[0]=r,u[1]=n,_.worldToLocal(u),r=(u[0]-t.x)*_.worldScaleX,n=(u[1]-t.y)*_.worldScaleY):(r-=t.x,n-=t.y),e.parent==t?(l=e.x,h=e.y):(u[0]=e.x,u[1]=e.y,e.parent.localToWorld(u),t.worldToLocal(u),l=u[0],h=u[1]);var d=l*t.worldScaleX,f=h*t.worldScaleY,T=Math.atan2(f,d),x=Math.sqrt(d*d+f*f),m=e.data.length*e.worldScaleX,v=2*x*m;if(v<1e-4){e.rotationIK=a+(Math.atan2(n,r)*spine.radDeg-c-a)*o;return}var A=(r*r+n*n-x*x-m*m)/v;A<-1?A=-1:A>1&&(A=1);var D=Math.acos(A)*s,N=x+m*A,z=m*Math.sin(D),M=Math.atan2(n*N-r*z,r*N+n*z),J=(M-T)*spine.radDeg-c;J>180?J-=360:J<-180&&(J+=360),t.rotationIK=c+J*o,J=(D+T)*spine.radDeg-a,J>180?J-=360:J<-180&&(J+=360),e.rotationIK=a+(J+t.worldRotation-e.parent.worldRotation)*o};spine.Skin=function(t){this.name=t,this.attachments={}};spine.Skin.prototype={addAttachment:function(t,e,r){this.attachments[t+":"+e]=r},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var r in e.attachments){var n=r.indexOf(":"),s=parseInt(r.substring(0,n)),o=r.substring(n+1),a=t.slots[s];if(a.attachment&&a.attachment.name==o){var c=this.getAttachment(s,o);c&&a.setAttachment(c)}}}};spine.Animation=function(t,e,r){this.name=t,this.timelines=e,this.duration=r};spine.Animation.prototype={apply:function(t,e,r,n,s){n&&this.duration!=0&&(r%=this.duration,e%=this.duration);for(var o=this.timelines,a=0,c=o.length;a<c;a++)o[a].apply(t,e,r,s,1)},mix:function(t,e,r,n,s,o){n&&this.duration!=0&&(r%=this.duration,e%=this.duration);for(var a=this.timelines,c=0,l=a.length;c<l;c++)a[c].apply(t,e,r,s,o)}};spine.Animation.binarySearch=function(t,e,r){var n=0,s=Math.floor(t.length/r)-2;if(!s)return r;for(var o=s>>>1;;){if(t[(o+1)*r]<=e?n=o+1:s=o,n==s)return(n+1)*r;o=n+s>>>1}};spine.Animation.binarySearch1=function(t,e){var r=0,n=t.length-2;if(!n)return 1;for(var s=n>>>1;;){if(t[s+1]<=e?r=s+1:n=s,r==n)return r+1;s=r+n>>>1}};spine.Animation.linearSearch=function(t,e,r){for(var n=0,s=t.length-r;n<=s;n+=r)if(t[n]>e)return n;return-1};spine.Curves=function(t){this.curves=[]};spine.Curves.prototype={setLinear:function(t){this.curves[t*19]=0},setStepped:function(t){this.curves[t*19]=1},setCurve:function(t,e,r,n,s){var o=.1,a=o*o,c=a*o,l=3*o,h=3*a,u=6*a,_=6*c,d=-e*2+n,f=-r*2+s,T=(e-n)*3+1,x=(r-s)*3+1,m=e*l+d*h+T*c,v=r*l+f*h+x*c,A=d*u+T*_,D=f*u+x*_,N=T*_,z=x*_,M=t*19,J=this.curves;J[M++]=2;for(var U=m,K=v,tt=M+19-1;M<tt;M+=2)J[M]=U,J[M+1]=K,m+=A,v+=D,A+=N,D+=z,U+=m,K+=v},getCurvePercent:function(t,e){e=e<0?0:e>1?1:e;var r=this.curves,n=t*19,s=r[n];if(s===0)return e;if(s==1)return 0;n++;for(var o=0,a=n,c=n+19-1;n<c;n+=2)if(o=r[n],o>=e){var l,h;return n==a?(l=0,h=0):(l=r[n-2],h=r[n-1]),h+(r[n+1]-h)*(e-l)/(o-l)}var u=r[n-1];return u+(1-u)*(e-o)/(1-o)}};spine.RotateTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*2};spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,r){t*=2,this.frames[t]=e,this.frames[t+1]=r},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-2]){for(var _=a.data.rotation+o[o.length-1]-a.rotation;_>180;)_-=360;for(;_<-180;)_+=360;a.rotation+=_*s;return}var c=spine.Animation.binarySearch(o,r,2),l=o[c-1],h=o[c],u=1-(r-h)/(o[c-2]-h);u=this.curves.getCurvePercent(c/2-1,u);for(var _=o[c+1]-l;_>180;)_-=360;for(;_<-180;)_+=360;for(_=a.data.rotation+(l+_*u)-a.rotation;_>180;)_-=360;for(;_<-180;)_+=360;a.rotation+=_*s}}};spine.TranslateTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*3};spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-3]){a.x+=(a.data.x+o[o.length-2]-a.x)*s,a.y+=(a.data.y+o[o.length-1]-a.y)*s;return}var c=spine.Animation.binarySearch(o,r,3),l=o[c-2],h=o[c-1],u=o[c],_=1-(r-u)/(o[c+-3]-u);_=this.curves.getCurvePercent(c/3-1,_),a.x+=(a.data.x+l+(o[c+1]-l)*_-a.x)*s,a.y+=(a.data.y+h+(o[c+2]-h)*_-a.y)*s}}};spine.ScaleTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*3};spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a=t.bones[this.boneIndex];if(r>=o[o.length-3]){a.scaleX+=(a.data.scaleX*o[o.length-2]-a.scaleX)*s,a.scaleY+=(a.data.scaleY*o[o.length-1]-a.scaleY)*s;return}var c=spine.Animation.binarySearch(o,r,3),l=o[c-2],h=o[c-1],u=o[c],_=1-(r-u)/(o[c+-3]-u);_=this.curves.getCurvePercent(c/3-1,_),a.scaleX+=(a.data.scaleX*(l+(o[c+1]-l)*_)-a.scaleX)*s,a.scaleY+=(a.data.scaleY*(h+(o[c+2]-h)*_)-a.scaleY)*s}}};spine.ColorTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*5};spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,r,n,s,o){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=o},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a,c,l,h;if(r>=o[o.length-5]){var u=o.length-1;a=o[u-3],c=o[u-2],l=o[u-1],h=o[u]}else{var _=spine.Animation.binarySearch(o,r,5),d=o[_-4],f=o[_-3],T=o[_-2],x=o[_-1],m=o[_],v=1-(r-m)/(o[_-5]-m);v=this.curves.getCurvePercent(_/5-1,v),a=d+(o[_+1]-d)*v,c=f+(o[_+2]-f)*v,l=T+(o[_+3]-T)*v,h=x+(o[_+4]-x)*v}var A=t.slots[this.slotIndex];s<1?(A.r+=(a-A.r)*s,A.g+=(c-A.g)*s,A.b+=(l-A.b)*s,A.a+=(h-A.a)*s):(A.r=a,A.g=c,A.b=l,A.a=h)}}};spine.AttachmentTimeline=function(t){this.slotIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t};spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,r){this.frames[t]=e,this.attachmentNames[t]=r},apply:function(t,e,r,n,s){var o=this.frames;if(r<o[0]){e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);return}else e>r&&(e=-1);var a=r>=o[o.length-1]?o.length-1:spine.Animation.binarySearch1(o,r)-1;if(!(o[a]<e)){var c=this.attachmentNames[a];t.slots[this.slotIndex].setAttachment(c?t.getAttachmentBySlotIndex(this.slotIndex,c):null)}}};spine.EventTimeline=function(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t};spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,r){this.frames[t]=e,this.events[t]=r},apply:function(t,e,r,n,s){if(n){var o=this.frames,a=o.length;if(e>r)this.apply(t,e,Number.MAX_VALUE,n,s),e=-1;else if(e>=o[a-1])return;if(!(r<o[0])){var c;if(e<o[0])c=0;else{c=spine.Animation.binarySearch1(o,e);for(var l=o[c];c>0&&o[c-1]==l;)c--}for(var h=this.events;c<a&&r>=o[c];c++)n.push(h[c])}}}};spine.DrawOrderTimeline=function(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t};spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(t,e,r){this.frames[t]=e,this.drawOrders[t]=r},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a;r>=o[o.length-1]?a=o.length-1:a=spine.Animation.binarySearch1(o,r)-1;var c=t.drawOrder,l=t.slots,h=this.drawOrders[a];if(h)for(var u=0,_=h.length;u<_;u++)c[u]=t.slots[h[u]];else for(var u=0,_=l.length;u<_;u++)c[u]=l[u]}}};spine.FfdTimeline=function(t){this.slotIndex=this.attachment=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t,this.frameVertices=[],this.frameVertices.length=t};spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,r){this.frames[t]=e,this.frameVertices[t]=r},apply:function(t,e,r,n,s){var o=t.slots[this.slotIndex];if(o.attachment==this.attachment){var a=this.frames;if(!(r<a[0])){var c=this.frameVertices,l=c[0].length,h=o.attachmentVertices;if(h.length!=l&&(s=1),h.length=l,r>=a[a.length-1]){var u=c[a.length-1];if(s<1)for(var _=0;_<l;_++)h[_]+=(u[_]-h[_])*s;else for(var _=0;_<l;_++)h[_]=u[_];return}var d=spine.Animation.binarySearch1(a,r),f=a[d],T=1-(r-f)/(a[d-1]-f);T=this.curves.getCurvePercent(d-1,T<0?0:T>1?1:T);var x=c[d-1],m=c[d];if(s<1)for(var _=0;_<l;_++){var v=x[_];h[_]+=(v+(m[_]-v)*T-h[_])*s}else for(var _=0;_<l;_++){var v=x[_];h[_]=v+(m[_]-v)*T}}}}};spine.IkConstraintTimeline=function(t){this.ikConstraintIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*3};spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,r,n){t*=3,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=n},apply:function(t,e,r,n,s){var o=this.frames;if(!(r<o[0])){var a=t.ikConstraints[this.ikConstraintIndex];if(r>=o[o.length-3]){a.mix+=(o[o.length-2]-a.mix)*s,a.bendDirection=o[o.length-1];return}var c=spine.Animation.binarySearch(o,r,3),l=o[c+-2],h=o[c],u=1-(r-h)/(o[c+-3]-h);u=this.curves.getCurvePercent(c/3-1,u);var _=l+(o[c+1]-l)*u;a.mix+=(_-a.mix)*s,a.bendDirection=o[c+-1]}}};spine.FlipXTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*2};spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,r){t*=2,this.frames[t]=e,this.frames[t+1]=r?1:0},apply:function(t,e,r,n,s){var o=this.frames;if(r<o[0]){e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);return}else e>r&&(e=-1);var a=(r>=o[o.length-2]?o.length:spine.Animation.binarySearch(o,r,2))-2;o[a]<e||(t.bones[this.boneIndex].flipX=o[a+1]!=0)}};spine.FlipYTimeline=function(t){this.boneIndex=0,this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t*2};spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,r){t*=2,this.frames[t]=e,this.frames[t+1]=r?1:0},apply:function(t,e,r,n,s){var o=this.frames;if(r<o[0]){e>r&&this.apply(t,e,Number.MAX_VALUE,null,0);return}else e>r&&(e=-1);var a=(r>=o[o.length-2]?o.length:spine.Animation.binarySearch(o,r,2))-2;o[a]<e||(t.bones[this.boneIndex].flipY=o[a+1]!=0)}};spine.SkeletonData=function(){this.width=this.height=0,this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]};spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(t){for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null},findBoneIndex:function(t){for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1},findSlot:function(t){for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].name==t)return slot[r];return null},findSlotIndex:function(t){for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].name==t)return r;return-1},findSkin:function(t){for(var e=this.skins,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null},findEvent:function(t){for(var e=this.events,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null},findAnimation:function(t){for(var e=this.animations,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null},findIkConstraint:function(t){for(var e=this.ikConstraints,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null}};spine.Skeleton=function(t){this.x=this.y=0,this.r=this.g=this.b=this.a=1,this.time=0,this.flipX=this.flipY=!1,this.data=t,this.bones=[];for(var e=0,r=t.bones.length;e<r;e++){var n=t.bones[e],s=n.parent?this.bones[t.bones.indexOf(n.parent)]:null;this.bones.push(new spine.Bone(n,this,s))}this.slots=[],this.drawOrder=[];for(var e=0,r=t.slots.length;e<r;e++){var o=t.slots[e],a=this.bones[t.bones.indexOf(o.boneData)],c=new spine.Slot(o,a);this.slots.push(c),this.drawOrder.push(c)}this.ikConstraints=[];for(var e=0,r=t.ikConstraints.length;e<r;e++)this.ikConstraints.push(new spine.IkConstraint(t.ikConstraints[e],this));this.boneCache=[],this.updateCache()};spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var t=this.ikConstraints,e=t.length,r=e+1,n=this.boneCache;n.length>r&&(n.length=r);for(var s=0,o=n.length;s<o;s++)n[s].length=0;for(;n.length<r;)n[n.length]=[];var a=n[0],c=this.bones;t:for(var s=0,o=c.length;s<o;s++){var l=c[s],h=l;do{for(var u=0;u<e;u++)for(var _=t[u],d=_.bones[0],f=_.bones[_.bones.length-1];;){if(h==f){n[u].push(l),n[u+1].push(l);continue t}if(f==d)break;f=f.parent}h=h.parent}while(h);a[a.length]=l}},updateWorldTransform:function(){for(var t=this.bones,n=0,e=t.length;n<e;n++){var r=t[n];r.rotationIK=r.rotation}for(var n=0,s=this.boneCache.length-1;;){for(var o=this.boneCache[n],a=0,c=o.length;a<c;a++)o[a].updateWorldTransform();if(n==s)break;this.ikConstraints[n].apply(),n++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,r=t.length;e<r;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,e=0,r=n.length;e<r;e++){var s=n[e];s.bendDirection=s.data.bendDirection,s.mix=s.data.mix}},setSlotsToSetupPose:function(){for(var t=this.slots,e=this.drawOrder,r=0,n=t.length;r<n;r++)e[r]=t[r],t[r].setToSetupPose(r)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return e[r];return null},findBoneIndex:function(t){for(var e=this.bones,r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1},findSlot:function(t){for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return e[r];return null},findSlotIndex:function(t){for(var e=this.slots,r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return r;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)},setSkin:function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=this.slots,r=0,n=e.length;r<n;r++){var s=e[r],o=s.data.attachmentName;if(o){var a=t.getAttachment(r,o);a&&s.setAttachment(a)}}this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var r=this.skin.getAttachment(t,e);if(r)return r}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var r=this.slots,n=0,s=r.length;n<s;n++){var o=r[n];if(o.data.name==t){var a=null;if(e&&(a=this.getAttachmentBySlotIndex(n,e),!a))throw new Error("Attachment not found: "+e+", for slot: "+t);o.setAttachment(a);return}}throw new Error("Slot not found: "+t)},findIkConstraint:function(t){for(var e=this.ikConstraints,r=0,n=e.length;r<n;r++)if(e[r].data.name==t)return e[r];return null},update:function(t){this.time+=t}};spine.EventData=function(t){this.intValue=this.floatValue=0,this.name=t};spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null};spine.Event=function(t){this.intValue=this.floatValue=0,this.data=t};spine.Event.prototype={intValue:0,floatValue:0,stringValue:null};spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};spine.RegionAttachment=function(t){this.type=spine.AttachmentType.region,this.x=this.y=this.rotation=0,this.scaleX=this.scaleY=1,this.width=this.height=0,this.r=this.g=this.b=this.a=1,this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0,this.name=t,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8};spine.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,r,n,s){var o=this.uvs;s?(o[2]=t,o[3]=n,o[4]=t,o[5]=e,o[6]=r,o[7]=e,o[0]=r,o[1]=n):(o[0]=t,o[1]=n,o[2]=t,o[3]=e,o[4]=r,o[5]=e,o[6]=r,o[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,s=r+this.regionWidth*t,o=n+this.regionHeight*e,a=this.rotation*spine.degRad,c=Math.cos(a),l=Math.sin(a),h=r*c+this.x,u=r*l,_=n*c+this.y,d=n*l,f=s*c+this.x,T=s*l,x=o*c+this.y,m=o*l,v=this.offset;v[0]=h-d,v[1]=_+u,v[2]=h-m,v[3]=x+u,v[4]=f-m,v[5]=x+T,v[6]=f-d,v[7]=_+T},computeVertices:function(t,e,r,n){t+=r.worldX,e+=r.worldY;var s=r.m00,o=r.m01,a=r.m10,c=r.m11,l=this.offset;n[0]=l[0]*s+l[1]*o+t,n[1]=l[0]*a+l[1]*c+e,n[2]=l[2]*s+l[3]*o+t,n[3]=l[2]*a+l[3]*c+e,n[4]=l[4]*s+l[5]*o+t,n[5]=l[4]*a+l[5]*c+e,n[6]=l[6]*s+l[7]*o+t,n[7]=l[6]*a+l[7]*c+e}};spine.MeshAttachment=function(t){this.type=spine.AttachmentType.mesh,this.hullLength=0,this.r=this.g=this.b=this.a=1,this.regionU=this.regionV=this.regionV2=0,this.regionRotate=!1,this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0,this.width=this.height=0,this.name=t};spine.MeshAttachment.prototype={vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var t=this.regionU2-this.regionU,e=this.regionV2-this.regionV,r=this.regionUVs.length;if((!this.uvs||this.uvs.length!=r)&&(this.uvs=new spine.Float32Array(r)),this.regionRotate)for(var n=0;n<r;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n+1]*t,this.uvs[n+1]=this.regionV+e-this.regionUVs[n]*e;else for(var n=0;n<r;n+=2)this.uvs[n]=this.regionU+this.regionUVs[n]*t,this.uvs[n+1]=this.regionV+this.regionUVs[n+1]*e},computeWorldVertices:function(t,e,r,n){var s=r.bone;t+=s.worldX,e+=s.worldY;var o=s.m00,a=s.m01,c=s.m10,l=s.m11,h=this.vertices,u=h.length;r.attachmentVertices.length==u&&(h=r.attachmentVertices);for(var _=0;_<u;_+=2){var d=h[_],f=h[_+1];n[_]=d*o+f*a+t,n[_+1]=d*c+f*l+e}}};spine.SkinnedMeshAttachment=function(t){this.type=spine.AttachmentType.skinnedmesh,this.hullLength=0,this.r=this.g=this.b=this.a=1,this.regionU=this.regionV=this.regionU2=this.regionV2=0,this.regionRotate=!1,this.regionOffsetX=this.regionOffsetY=this.regionWidth=this.regionHeight=this.regionOriginalWidth=this.regionOriginalHeight=0,this.width=this.height=0,this.name=t};spine.SkinnedMeshAttachment.prototype={bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(t,e,r,n,s){var o=this.regionU2-this.regionU,a=this.regionV2-this.regionV,c=this.regionUVs.length;if((!this.uvs||this.uvs.length!=c)&&(this.uvs=new spine.Float32Array(c)),this.regionRotate)for(var l=0;l<c;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l+1]*o,this.uvs[l+1]=this.regionV+a-this.regionUVs[l]*a;else for(var l=0;l<c;l+=2)this.uvs[l]=this.regionU+this.regionUVs[l]*o,this.uvs[l+1]=this.regionV+this.regionUVs[l+1]*a},computeWorldVertices:function(t,e,r,n){var s=r.bone.skeleton.bones,o=this.weights,a=this.bones,c=0,l=0,h=0,u=0,_=a.length,d,f,T,x,m,v,A;if(r.attachmentVertices.length)for(var D=r.attachmentVertices;l<_;c+=2){for(f=0,T=0,d=a[l++]+l;l<d;l++,h+=3,u+=2)x=s[a[l]],m=o[h]+D[u],v=o[h+1]+D[u+1],A=o[h+2],f+=(m*x.m00+v*x.m01+x.worldX)*A,T+=(m*x.m10+v*x.m11+x.worldY)*A;n[c]=f+t,n[c+1]=T+e}else for(;l<_;c+=2){for(f=0,T=0,d=a[l++]+l;l<d;l++,h+=3)x=s[a[l]],m=o[h],v=o[h+1],A=o[h+2],f+=(m*x.m00+v*x.m01+x.worldX)*A,T+=(m*x.m10+v*x.m11+x.worldY)*A;n[c]=f+t,n[c+1]=T+e}}};spine.BoundingBoxAttachment=function(t){this.type=spine.AttachmentType.boundingbox,this.name=t,this.vertices=[]};spine.BoundingBoxAttachment.prototype={computeWorldVertices:function(t,e,r,n){t+=r.worldX,e+=r.worldY;for(var s=r.m00,o=r.m01,a=r.m10,c=r.m11,l=this.vertices,h=0,u=l.length;h<u;h+=2){var _=l[h],d=l[h+1];n[h]=_*s+d*o+t,n[h+1]=_*a+d*c+e}}};spine.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={},this.defaultMix=0};spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,r){var n=this.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);var s=this.skeletonData.findAnimation(e);if(!s)throw new Error("Animation not found: "+e);this.setMix(n,s,r)},setMix:function(t,e,r){this.animationToMixTime[t.name+":"+e.name]=r},getMix:function(t,e){var r=t.name+":"+e.name;return this.animationToMixTime.hasOwnProperty(r)?this.animationToMixTime[r]:this.defaultMix}};spine.TrackEntry=function(){this.delay=this.time=this.endTime=0,this.lastTime=-1,this.timeScale=1,this.mixTime=this.mixDuration=1,this.mix=1};spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};spine.AnimationState=function(t){this.timeScale=1,this.data=t,this.tracks=[],this.events=[]};spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var r=this.tracks[e];if(r){if(r.time+=t*r.timeScale,r.previous){var n=t*r.previous.timeScale;r.previous.time+=n,r.mixTime+=n}var s=r.next;s?(s.time=r.lastTime-s.delay,s.time>=0&&this.setCurrent(e,s)):!r.loop&&r.lastTime>=r.endTime&&this.clearTrack(e)}}},apply:function(t){for(var e=0;e<this.tracks.length;e++){var r=this.tracks[e];if(r){this.events.length=0;var n=r.time,s=r.lastTime,o=r.endTime,a=r.loop;!a&&n>o&&(n=o);var c=r.previous;if(!c)r.mix==1?r.animation.apply(t,r.lastTime,n,a,this.events):r.animation.mix(t,r.lastTime,n,a,this.events,r.mix);else{var l=c.time;!c.loop&&l>c.endTime&&(l=c.endTime),c.animation.apply(t,l,l,c.loop,null);var h=r.mixTime/r.mixDuration*r.mix;h>=1&&(h=1,r.previous=null),r.animation.mix(t,r.lastTime,n,a,this.events,h)}for(var u=0,_=this.events.length;u<_;u++){var d=this.events[u];r.onEvent&&r.onEvent(e,d),this.onEvent&&this.onEvent(e,d)}if(a?s%o>n%o:s<o&&n>=o){var f=Math.floor(n/o);r.onComplete&&r.onComplete(e,f),this.onComplete&&this.onComplete(e,f)}r.lastTime=r.time}}},clearTracks:function(){for(var t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0},clearTrack:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(e.onEnd&&e.onEnd(t),this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},_expandToIndex:function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(t,e){var r=this._expandToIndex(t);if(r){var n=r.previous;r.previous=null,r.onEnd&&r.onEnd(t),this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(r.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&r.mixTime/r.mixDuration<.5?e.previous=n:e.previous=r)}this.tracks[t]=e,e.onStart&&e.onStart(t),this.onStart&&this.onStart(t)},setAnimationByName:function(t,e,r){var n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.setAnimation(t,n,r)},setAnimation:function(t,e,r){var n=new spine.TrackEntry;return n.animation=e,n.loop=r,n.endTime=e.duration,this.setCurrent(t,n),n},addAnimationByName:function(t,e,r,n){var s=this.data.skeletonData.findAnimation(e);if(!s)throw new Error("Animation not found: "+e);return this.addAnimation(t,s,r,n)},addAnimation:function(t,e,r,n){var s=new spine.TrackEntry;s.animation=e,s.loop=r,s.endTime=e.duration;var o=this._expandToIndex(t);if(o){for(;o.next;)o=o.next;o.next=s}else this.tracks[t]=s;return n<=0&&(o?n+=o.endTime-this.data.getMix(o.animation,e):n=0),s.delay=n,s},getCurrent:function(t){return t>=this.tracks.length?null:this.tracks[t]}};spine.SkeletonJson=function(t){this.scale=1,this.attachmentLoader=t};spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(t,e){var r=new spine.SkeletonData;r.name=e;var n=t.skeleton;n&&(r.hash=n.hash,r.version=n.spine,r.width=n.width||0,r.height=n.height||0);for(var s=t.bones,o=0,a=s.length;o<a;o++){var c=s[o],l=null;if(c.parent&&(l=r.findBone(c.parent),!l))throw new Error("Parent bone not found: "+c.parent);var h=new spine.BoneData(c.name,l);h.length=(c.length||0)*this.scale,h.x=(c.x||0)*this.scale,h.y=(c.y||0)*this.scale,h.rotation=c.rotation||0,h.scaleX=c.hasOwnProperty("scaleX")?c.scaleX:1,h.scaleY=c.hasOwnProperty("scaleY")?c.scaleY:1,h.inheritScale=c.hasOwnProperty("inheritScale")?c.inheritScale:!0,h.inheritRotation=c.hasOwnProperty("inheritRotation")?c.inheritRotation:!0,r.bones.push(h)}var u=t.ik;if(u)for(var o=0,a=u.length;o<a;o++){for(var _=u[o],d=new spine.IkConstraintData(_.name),s=_.bones,f=0,T=s.length;f<T;f++){var x=r.findBone(s[f]);if(!x)throw new Error("IK bone not found: "+s[f]);d.bones.push(x)}if(d.target=r.findBone(_.target),!d.target)throw new Error("Target bone not found: "+_.target);d.bendDirection=!_.hasOwnProperty("bendPositive")||_.bendPositive?1:-1,d.mix=_.hasOwnProperty("mix")?_.mix:1,r.ikConstraints.push(d)}for(var m=t.slots,o=0,a=m.length;o<a;o++){var v=m[o],h=r.findBone(v.bone);if(!h)throw new Error("Slot bone not found: "+v.bone);var A=new spine.SlotData(v.name,h),D=v.color;D&&(A.r=this.toColor(D,0),A.g=this.toColor(D,1),A.b=this.toColor(D,2),A.a=this.toColor(D,3)),A.attachmentName=v.attachment,A.blendMode=spine.AttachmentType[v.blend||"normal"],r.slots.push(A)}var N=t.skins;for(var z in N)if(N.hasOwnProperty(z)){var M=N[z],J=new spine.Skin(z);for(var U in M)if(M.hasOwnProperty(U)){var K=r.findSlotIndex(U),tt=M[U];for(var rt in tt)if(tt.hasOwnProperty(rt)){var I=this.readAttachment(J,rt,tt[rt]);I&&J.addAttachment(K,rt,I)}}r.skins.push(J),J.name=="default"&&(r.defaultSkin=J)}var L=t.events;for(var G in L)if(L.hasOwnProperty(G)){var w=L[G],O=new spine.EventData(G);O.intValue=w.int||0,O.floatValue=w.float||0,O.stringValue=w.string||null,r.events.push(O)}var j=t.animations;for(var Q in j)j.hasOwnProperty(Q)&&this.readAnimation(Q,j[Q],r);return r},readAttachment:function(t,e,r){e=r.name||e;var n=spine.AttachmentType[r.type||"region"],s=r.path||e,o=this.scale;if(n==spine.AttachmentType.region){var a=this.attachmentLoader.newRegionAttachment(t,e,s);if(!a)return null;a.path=s,a.x=(r.x||0)*o,a.y=(r.y||0)*o,a.scaleX=r.hasOwnProperty("scaleX")?r.scaleX:1,a.scaleY=r.hasOwnProperty("scaleY")?r.scaleY:1,a.rotation=r.rotation||0,a.width=(r.width||0)*o,a.height=(r.height||0)*o;var c=r.color;return c&&(a.r=this.toColor(c,0),a.g=this.toColor(c,1),a.b=this.toColor(c,2),a.a=this.toColor(c,3)),a.updateOffset(),a}else if(n==spine.AttachmentType.mesh){var l=this.attachmentLoader.newMeshAttachment(t,e,s);return l?(l.path=s,l.vertices=this.getFloatArray(r,"vertices",o),l.triangles=this.getIntArray(r,"triangles"),l.regionUVs=this.getFloatArray(r,"uvs",1),l.updateUVs(),c=r.color,c&&(l.r=this.toColor(c,0),l.g=this.toColor(c,1),l.b=this.toColor(c,2),l.a=this.toColor(c,3)),l.hullLength=(r.hull||0)*2,r.edges&&(l.edges=this.getIntArray(r,"edges")),l.width=(r.width||0)*o,l.height=(r.height||0)*o,l):null}else if(n==spine.AttachmentType.skinnedmesh){var l=this.attachmentLoader.newSkinnedMeshAttachment(t,e,s);if(!l)return null;l.path=s;for(var h=this.getFloatArray(r,"uvs",1),u=this.getFloatArray(r,"vertices",1),_=[],d=[],f=0,T=u.length;f<T;){var x=u[f++]|0;d[d.length]=x;for(var m=f+x*4;f<m;)d[d.length]=u[f],_[_.length]=u[f+1]*o,_[_.length]=u[f+2]*o,_[_.length]=u[f+3],f+=4}return l.bones=d,l.weights=_,l.triangles=this.getIntArray(r,"triangles"),l.regionUVs=h,l.updateUVs(),c=r.color,c&&(l.r=this.toColor(c,0),l.g=this.toColor(c,1),l.b=this.toColor(c,2),l.a=this.toColor(c,3)),l.hullLength=(r.hull||0)*2,r.edges&&(l.edges=this.getIntArray(r,"edges")),l.width=(r.width||0)*o,l.height=(r.height||0)*o,l}else if(n==spine.AttachmentType.boundingbox){for(var v=this.attachmentLoader.newBoundingBoxAttachment(t,e),u=r.vertices,f=0,T=u.length;f<T;f++)v.vertices.push(u[f]*o);return v}throw new Error("Unknown attachment type: "+n)},readAnimation:function(t,e,r){var n=[],s=0,o=e.slots;for(var a in o)if(o.hasOwnProperty(a)){var c=o[a],l=r.findSlotIndex(a);for(var h in c)if(c.hasOwnProperty(h)){var u=c[h];if(h=="color"){var _=new spine.ColorTimeline(u.length);_.slotIndex=l;for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f],m=x.color,v=this.toColor(m,0),A=this.toColor(m,1),D=this.toColor(m,2),N=this.toColor(m,3);_.setFrame(d,x.time,v,A,D,N),this.readCurve(_,d,x),d++}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()*5-5])}else if(h=="attachment"){var _=new spine.AttachmentTimeline(u.length);_.slotIndex=l;for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f];_.setFrame(d++,x.time,x.name)}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()-1])}else throw new Error("Invalid timeline type for a slot: "+h+" ("+a+")")}}var z=e.bones;for(var M in z)if(z.hasOwnProperty(M)){var J=r.findBoneIndex(M);if(J==-1)throw new Error("Bone not found: "+M);var U=z[M];for(var h in U)if(U.hasOwnProperty(h)){var u=U[h];if(h=="rotate"){var _=new spine.RotateTimeline(u.length);_.boneIndex=J;for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f];_.setFrame(d,x.time,x.angle),this.readCurve(_,d,x),d++}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()*2-2])}else if(h=="translate"||h=="scale"){var _,K=1;h=="scale"?_=new spine.ScaleTimeline(u.length):(_=new spine.TranslateTimeline(u.length),K=this.scale),_.boneIndex=J;for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f],tt=(x.x||0)*K,rt=(x.y||0)*K;_.setFrame(d,x.time,tt,rt),this.readCurve(_,d,x),d++}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()*3-3])}else if(h=="flipX"||h=="flipY"){var tt=h=="flipX",_=tt?new spine.FlipXTimeline(u.length):new spine.FlipYTimeline(u.length);_.boneIndex=J;for(var I=tt?"x":"y",d=0,f=0,T=u.length;f<T;f++){var x=u[f];_.setFrame(d,x.time,x[I]||!1),d++}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()*2-2])}else throw new Error("Invalid timeline type for a bone: "+h+" ("+M+")")}}var L=e.ik;for(var G in L)if(L.hasOwnProperty(G)){var w=r.findIkConstraint(G),u=L[G],_=new spine.IkConstraintTimeline(u.length);_.ikConstraintIndex=r.ikConstraints.indexOf(w);for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f],O=x.hasOwnProperty("mix")?x.mix:1,j=!x.hasOwnProperty("bendPositive")||x.bendPositive?1:-1;_.setFrame(d,x.time,O,j),this.readCurve(_,d,x),d++}n.push(_),s=Math.max(s,_.frames[_.frameCount*3-3])}var Q=e.ffd;for(var C in Q){var b=r.findSkin(C),c=Q[C];for(a in c){var l=r.findSlotIndex(a),W=c[a];for(var S in W){var u=W[S],_=new spine.FfdTimeline(u.length),E=b.getAttachment(l,S);if(!E)throw new Error("FFD attachment not found: "+S);_.slotIndex=l,_.attachment=E;var R=E.type==spine.AttachmentType.mesh,F;R?F=E.vertices.length:F=E.weights.length/3*2;for(var d=0,f=0,T=u.length;f<T;f++){var x=u[f],k;if(!x.vertices)R?k=E.vertices:(k=[],k.length=F);else{var X=x.vertices,k=[];k.length=F;var Z=x.offset||0,V=X.length;if(this.scale==1)for(var Y=0;Y<V;Y++)k[Y+Z]=X[Y];else for(var Y=0;Y<V;Y++)k[Y+Z]=X[Y]*this.scale;if(R)for(var $=E.vertices,Y=0,V=k.length;Y<V;Y++)k[Y]+=$[Y]}_.setFrame(d,x.time,k),this.readCurve(_,d,x),d++}n[n.length]=_,s=Math.max(s,_.frames[_.frameCount-1])}}}var et=e.drawOrder;if(et||(et=e.draworder),et){for(var _=new spine.DrawOrderTimeline(et.length),ct=r.slots.length,d=0,f=0,T=et.length;f<T;f++){var ht=et[f],pt=null;if(ht.offsets){pt=[],pt.length=ct;for(var Y=ct-1;Y>=0;Y--)pt[Y]=-1;var mt=ht.offsets,dt=[];dt.length=ct-mt.length;for(var xt=0,Tt=0,Y=0,V=mt.length;Y<V;Y++){var lt=mt[Y],l=r.findSlotIndex(lt.slot);if(l==-1)throw new Error("Slot not found: "+lt.slot);for(;xt!=l;)dt[Tt++]=xt++;pt[xt+lt.offset]=xt++}for(;xt<ct;)dt[Tt++]=xt++;for(var Y=ct-1;Y>=0;Y--)pt[Y]==-1&&(pt[Y]=dt[--Tt])}_.setFrame(d++,ht.time,pt)}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()-1])}var at=e.events;if(at){for(var _=new spine.EventTimeline(at.length),d=0,f=0,T=at.length;f<T;f++){var At=at[f],St=r.findEvent(At.name);if(!St)throw new Error("Event not found: "+At.name);var wt=new spine.Event(St);wt.intValue=At.hasOwnProperty("int")?At.int:St.intValue,wt.floatValue=At.hasOwnProperty("float")?At.float:St.floatValue,wt.stringValue=At.hasOwnProperty("string")?At.string:St.stringValue,_.setFrame(d++,At.time,wt)}n.push(_),s=Math.max(s,_.frames[_.getFrameCount()-1])}r.animations.push(new spine.Animation(t,n,s))},readCurve:function(t,e,r){var n=r.curve;n?n=="stepped"?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]):t.curves.setLinear(e)},toColor:function(t,e){if(t.length!=8)throw new Error("Color hexadecimal length must be 8, received: "+t);return parseInt(t.substring(e*2,e*2+2),16)/255},getFloatArray:function(t,e,r){var n=t[e],s=new spine.Float32Array(n.length),o=0,a=n.length;if(r==1)for(;o<a;o++)s[o]=n[o];else for(;o<a;o++)s[o]=n[o]*r;return s},getIntArray:function(t,e){for(var r=t[e],n=new spine.Uint16Array(r.length),s=0,o=r.length;s<o;s++)n[s]=r[s]|0;return n}};spine.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var r=new spine.AtlasReader(t),n=[];n.length=4;for(var s=null;;){var o=r.readLine();if(o===null)break;if(o=r.trim(o),!o.length)s=null;else if(s){var c=new spine.AtlasRegion;c.name=o,c.page=s,c.rotate=r.readValue()=="true",r.readTuple(n);var l=parseInt(n[0]),h=parseInt(n[1]);r.readTuple(n);var u=parseInt(n[0]),_=parseInt(n[1]);c.u=l/s.width,c.v=h/s.height,c.rotate?(c.u2=(l+_)/s.width,c.v2=(h+u)/s.height):(c.u2=(l+u)/s.width,c.v2=(h+_)/s.height),c.x=l,c.y=h,c.width=Math.abs(u),c.height=Math.abs(_),r.readTuple(n)==4&&(c.splits=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],r.readTuple(n)==4&&(c.pads=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],r.readTuple(n))),c.originalWidth=parseInt(n[0]),c.originalHeight=parseInt(n[1]),r.readTuple(n),c.offsetX=parseInt(n[0]),c.offsetY=parseInt(n[1]),c.index=parseInt(r.readValue()),this.regions.push(c)}else{s=new spine.AtlasPage,s.name=o,r.readTuple(n)==2&&(s.width=parseInt(n[0]),s.height=parseInt(n[1]),r.readTuple(n)),s.format=spine.Atlas.Format[n[0]],r.readTuple(n),s.minFilter=spine.Atlas.TextureFilter[n[0]],s.magFilter=spine.Atlas.TextureFilter[n[1]];var a=r.readValue();s.uWrap=spine.Atlas.TextureWrap.clampToEdge,s.vWrap=spine.Atlas.TextureWrap.clampToEdge,a=="x"?s.uWrap=spine.Atlas.TextureWrap.repeat:a=="y"?s.vWrap=spine.Atlas.TextureWrap.repeat:a=="xy"&&(s.uWrap=s.vWrap=spine.Atlas.TextureWrap.repeat),e.load(s,o,this),this.pages.push(s)}}};spine.Atlas.prototype={findRegion:function(t){for(var e=this.regions,r=0,n=e.length;r<n;r++)if(e[r].name==t)return e[r];return null},dispose:function(){for(var t=this.pages,e=0,r=t.length;e<r;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,r=0,n=e.length;r<n;r++){var s=e[r];s.page==t&&(s.u=s.x/t.width,s.v=s.y/t.height,s.rotate?(s.u2=(s.x+s.height)/t.width,s.v2=(s.y+s.width)/t.height):(s.u2=(s.x+s.width)/t.width,s.v2=(s.y+s.height)/t.height))}}};spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};spine.AtlasPage=function(){this.width=this.height=0};spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};spine.AtlasRegion=function(){this.x=this.y=this.width=this.height=this.u=this.v=this.u2=this.v2=this.offsetX=this.offsetY=this.originalWidth=this.originalHeight=0,this.index=0};spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};spine.AtlasReader=function(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)};spine.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(e==-1)throw new Error("Invalid line: "+t);return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),r=e.indexOf(":");if(r==-1)throw new Error("Invalid line: "+e);for(var n=0,s=r+1;n<3;n++){var o=e.indexOf(",",s);if(o==-1)break;t[n]=this.trim(e.substr(s,o-s)),s=o+1}return t[n]=this.trim(e.substring(s)),n+1}};spine.AtlasAttachmentLoader=function(t){this.atlas=t};spine.AtlasAttachmentLoader.prototype={newRegionAttachment:function(t,e,r){var n=this.atlas.findRegion(r);if(!n)throw new Error("Region not found in atlas: "+r+" (region attachment: "+e+")");var s=new spine.RegionAttachment(e);return s.rendererObject=n,s.setUVs(n.u,n.v,n.u2,n.v2,n.rotate),s.regionOffsetX=n.offsetX,s.regionOffsetY=n.offsetY,s.regionWidth=n.width,s.regionHeight=n.height,s.regionOriginalWidth=n.originalWidth,s.regionOriginalHeight=n.originalHeight,s},newMeshAttachment:function(t,e,r){var n=this.atlas.findRegion(r);if(!n)throw new Error("Region not found in atlas: "+r+" (mesh attachment: "+e+")");var s=new spine.MeshAttachment(e);return s.rendererObject=n,s.regionU=n.u,s.regionV=n.v,s.regionU2=n.u2,s.regionV2=n.v2,s.regionRotate=n.rotate,s.regionOffsetX=n.offsetX,s.regionOffsetY=n.offsetY,s.regionWidth=n.width,s.regionHeight=n.height,s.regionOriginalWidth=n.originalWidth,s.regionOriginalHeight=n.originalHeight,s},newSkinnedMeshAttachment:function(t,e,r){var n=this.atlas.findRegion(r);if(!n)throw new Error("Region not found in atlas: "+r+" (skinned mesh attachment: "+e+")");var s=new spine.SkinnedMeshAttachment(e);return s.rendererObject=n,s.regionU=n.u,s.regionV=n.v,s.regionU2=n.u2,s.regionV2=n.v2,s.regionRotate=n.rotate,s.regionOffsetX=n.offsetX,s.regionOffsetY=n.offsetY,s.regionWidth=n.width,s.regionHeight=n.height,s.regionOriginalWidth=n.originalWidth,s.regionOriginalHeight=n.originalHeight,s},newBoundingBoxAttachment:function(t,e){return new spine.BoundingBoxAttachment(e)}};spine.SkeletonBounds=function(){this.minX=this.minY=this.maxX=this.maxY=0,this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]};spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(t,e){var r=t.slots,n=r.length,s=t.x,o=t.y,a=this.boundingBoxes,c=this.polygonPool,l=this.polygons;a.length=0;for(var h=0,u=l.length;h<u;h++)c.push(l[h]);l.length=0;for(var h=0;h<n;h++){var _=r[h],d=_.attachment;if(d.type==spine.AttachmentType.boundingbox){a.push(d);var f=c.length,T;f>0?(T=c[f-1],c.splice(f-1,1)):T=[],l.push(T),T.length=d.vertices.length,d.computeWorldVertices(s,o,_.bone,T)}}e&&this.aabbCompute()},aabbCompute:function(){for(var t=this.polygons,e=Number.MAX_VALUE,r=Number.MAX_VALUE,n=Number.MIN_VALUE,s=Number.MIN_VALUE,o=0,a=t.length;o<a;o++)for(var c=t[o],l=0,h=c.length;l<h;l+=2){var u=c[l],_=c[l+1];e=Math.min(e,u),r=Math.min(r,_),n=Math.max(n,u),s=Math.max(s,_)}this.minX=e,this.minY=r,this.maxX=n,this.maxY=s},aabbContainsPoint:function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},aabbIntersectsSegment:function(t,e,r,n){var s=this.minX,o=this.minY,a=this.maxX,c=this.maxY;if(t<=s&&r<=s||e<=o&&n<=o||t>=a&&r>=a||e>=c&&n>=c)return!1;var l=(n-e)/(r-t),h=l*(s-t)+e;if(h>o&&h<c||(h=l*(a-t)+e,h>o&&h<c))return!0;var u=(o-e)/l+t;return u>s&&u<a||(u=(c-e)/l+t,u>s&&u<a)},aabbIntersectsSkeleton:function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},containsPoint:function(t,e){for(var r=this.polygons,n=0,s=r.length;n<s;n++)if(this.polygonContainsPoint(r[n],t,e))return this.boundingBoxes[n];return null},intersectsSegment:function(t,e,r,n){for(var s=this.polygons,o=0,a=s.length;o<a;o++)if(s[o].intersectsSegment(t,e,r,n))return this.boundingBoxes[o];return null},polygonContainsPoint:function(t,e,r){for(var n=t.length,s=n-2,o=!1,a=0;a<n;a+=2){var c=t[a+1],l=t[s+1];if(c<r&&l>=r||l<r&&c>=r){var h=t[a];h+(r-c)/(l-c)*(t[s]-h)<e&&(o=!o)}s=a}return o},polygonIntersectsSegment:function(t,e,r,n,s){for(var o=t.length,a=e-n,c=r-s,l=e*s-r*n,h=t[o-2],u=t[o-1],_=0;_<o;_+=2){var d=t[_],f=t[_+1],T=h*f-u*d,x=h-d,m=u-f,v=a*m-c*x,A=(l*x-a*T)/v;if((A>=h&&A<=d||A>=d&&A<=h)&&(A>=e&&A<=n||A>=n&&A<=e)){var D=(l*m-c*T)/v;if((D>=u&&D<=f||D>=f&&D<=u)&&(D>=r&&D<=s||D>=s&&D<=r))return!0}h=d,u=f}return!1},getPolygon:function(t){var e=this.boundingBoxes.indexOf(t);return e==-1?null:this.polygons[e]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};sp._atlasPage_createTexture_webGL=function(t,e){var r=exports.cc.textureCache.addImage(e);t.rendererObject=new exports.cc.TextureAtlas(r,128),t.width=r.getPixelsWide(),t.height=r.getPixelsHigh()};sp._atlasPage_createTexture_canvas=function(t,e){t._texture=exports.cc.textureCache.addImage(e)};sp._atlasPage_disposeTexture=function(t){t.rendererObject.release()};sp._atlasLoader={spAtlasFile:null,setAtlasFile:function(t){this.spAtlasFile=t},load:function(t,e,r){var n=exports.cc.path.join(exports.cc.path.dirname(this.spAtlasFile),e);exports.cc._renderType===exports.cc.game.RENDER_TYPE_WEBGL?sp._atlasPage_createTexture_webGL(t,n):sp._atlasPage_createTexture_canvas(t,n)},unload:function(t){}};sp.ANIMATION_EVENT_TYPE={START:0,END:1,COMPLETE:2,EVENT:3};sp.TrackEntryListeners=function(t,e,r,n){this.startListener=t||null,this.endListener=e||null,this.completeListener=r||null,this.eventListener=n||null};sp.TrackEntryListeners.getListeners=function(t){return t.rendererObject||(t.rendererObject=new sp.TrackEntryListeners,t.listener=sp.trackEntryCallback),t.rendererObject};sp.trackEntryCallback=function(t,e,r,n,s){t.rendererObject.onTrackEntryEvent(e,r,n,s)};sp.SkeletonAnimation=sp.Skeleton.extend({_state:null,_target:null,_callback:null,_ownsAnimationStateData:!1,_startListener:null,_endListener:null,_completeListener:null,_eventListener:null,init:function(){sp.Skeleton.prototype.init.call(this),this._ownsAnimationStateData=!0,this.setAnimationStateData(new spine.AnimationStateData(this._skeleton.data))},setAnimationStateData:function(t){var e=new spine.AnimationState(t);e.rendererObject=this||window,e.onStart=this._onAnimationStateStart.bind(this),e.onComplete=this._onAnimationStateComplete.bind(this),e.onEnd=this._onAnimationStateEnd.bind(this),e.onEvent=this._onAnimationStateEvent.bind(this),this._state=e},setMix:function(t,e,r){this._state.data.setMixByName(t,e,r)},setAnimationListener:function(t,e){this._target=t,this._callback=e},setAnimation:function(t,e,r){var n=this._skeleton.data.findAnimation(e);return n?this._state.setAnimation(t,n,r):(exports.cc.log("Spine: Animation not found: "+e),null)},addAnimation:function(t,e,r,n){n=n==null?0:n;var s=this._skeleton.data.findAnimation(e);return s?this._state.addAnimation(t,s,r,n):(exports.cc.log("Spine: Animation not found:"+e),null)},getCurrent:function(t){return this._state.getCurrent(t)},clearTracks:function(){this._state.clearTracks()},clearTrack:function(t){this._state.clearTrack(t)},update:function(t){this._super(t),t*=this._timeScale,this._state.update(t),this._state.apply(this._skeleton),this._skeleton.updateWorldTransform(),this._renderCmd._updateChild()},setStartListener:function(t){this._startListener=t},setEndListener:function(t){this._endListener=t},setCompleteListener:function(t){this._completeListener=t},setEventListener:function(t){this._eventListener=t},setTrackStartListener:function(t,e){sp.TrackEntryListeners.getListeners(t).startListener=e},setTrackEndListener:function(t,e){sp.TrackEntryListeners.getListeners(t).endListener=e},setTrackCompleteListener:function(t,e){sp.TrackEntryListeners.getListeners(t).completeListener=e},setTrackEventListener:function(t,e){sp.TrackEntryListeners.getListeners(t).eventListener=e},onTrackEntryEvent:function(t,e,r,n){var s=this._state.getCurrent(t);if(s.rendererObject){var o=s.rendererObject;switch(e){case sp.ANIMATION_EVENT_TYPE.START:o.startListener&&o.startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:o.endListener&&o.endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:o.completeListener&&o.completeListener(t,n);break;case sp.ANIMATION_EVENT_TYPE.EVENT:o.eventListener&&o.eventListener(t,r);break}}},onAnimationStateEvent:function(t,e,r,n){switch(e){case sp.ANIMATION_EVENT_TYPE.START:this._startListener&&this._startListener(t);break;case sp.ANIMATION_EVENT_TYPE.END:this._endListener&&this._endListener(t);break;case sp.ANIMATION_EVENT_TYPE.COMPLETE:this._completeListener&&this._completeListener(t,n);break;case sp.ANIMATION_EVENT_TYPE.EVENT:this._eventListener&&this._eventListener(t,r);break}},getState:function(){return this._state},_onAnimationStateStart:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.START,null,0)},_onAnimationStateEnd:function(t){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.END,null,0)},_onAnimationStateComplete:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.COMPLETE,null,e)},_onAnimationStateEvent:function(t,e){this._animationStateCallback(t,sp.ANIMATION_EVENT_TYPE.EVENT,e,0)},_animationStateCallback:function(t,e,r,n){this.onAnimationStateEvent(t,e,r,n),this._target&&this._callback&&this._callback.call(this._target,this,t,e,r,n)}});sp.SkeletonAnimation.create=function(t,e,r){return new sp.SkeletonAnimation(t,e,r)};(function(){sp.Skeleton.CanvasRenderCmd=function(r){exports.cc.Node.CanvasRenderCmd.call(this,r),this._needDraw=!0};var t=sp.Skeleton.CanvasRenderCmd.prototype=Object.create(exports.cc.Node.CanvasRenderCmd.prototype);t.constructor=sp.Skeleton.CanvasRenderCmd,t.rendering=function(r,n,s){var o=this._node,a,c,l,h;r=r||exports.cc._renderContext;var u=o._skeleton,_=u.drawOrder;for(a=0,c=_.length;a<c;a++)l=_[a],h=l._slotNode,h._visible&&h._renderCmd&&l.currentSprite&&(h._renderCmd.transform(this,!0),l.currentSprite._renderCmd.rendering(r,n,s),h._renderCmd._dirtyFlag=l.currentSprite._renderCmd._dirtyFlag=0);if(!(!o._debugSlots&&!o._debugBones)){r.setTransform(this._worldTransform,n,s),r.setGlobalAlpha(1);var d,f=exports.cc._drawingUtil;if(o._debugSlots){f.setDrawColor(0,0,255,255),f.setLineWidth(1);var T=[];for(a=0,c=u.slots.length;a<c;a++)l=u.drawOrder[a],!(!l.attachment||l.attachment.type!=sp.ATTACHMENT_TYPE.REGION)&&(d=l.attachment,this._updateRegionAttachmentSlot(d,l,T),f.drawPoly(T,4,!0))}if(o._debugBones){var x;for(f.setLineWidth(2),f.setDrawColor(255,0,0,255),a=0,c=u.bones.length;a<c;a++){x=u.bones[a];var m=x.data.length*x.m00+x.worldX,v=x.data.length*x.m10+x.worldY;f.drawLine({x:x.worldX,y:x.worldY},{x:m,y:v})}for(f.setPointSize(4),f.setDrawColor(0,0,255,255),a=0,c=u.bones.length;a<c;a++)x=u.bones[a],f.drawPoint({x:x.worldX,y:x.worldY}),a===0&&f.setDrawColor(0,255,0,255)}}},t._updateRegionAttachmentSlot=function(r,n,s){if(s){var o={},a=sp.VERTEX_INDEX,c=n.bone;r.computeVertices(c.skeleton.x,c.skeleton.y,c,o),s.length=0,s.push(exports.cc.p(o[a.X1],o[a.Y1])),s.push(exports.cc.p(o[a.X4],o[a.Y4])),s.push(exports.cc.p(o[a.X3],o[a.Y3])),s.push(exports.cc.p(o[a.X2],o[a.Y2]))}},t._createChildFormSkeletonData=function(){for(var r=this._node,n=r._skeleton,s,o,a=0,c=n.slots.length;a<c;a++){var l=n.slots[a],h=l.attachment,u=new exports.cc.Node;l._slotNode=u,h instanceof spine.RegionAttachment&&(s=h.rendererObject.name,o=this._createSprite(l,h),l.currentSprite=o,l.currentSpriteName=s,u.addChild(o))}};var e=function(r,n,s,o){var a=new exports.cc.Rect(s.x,s.y,s.width,s.height);r.initWithTexture(n,a,s.rotate,!1),r._rect.width=o.width,r._rect.height=o.height,r.setContentSize(o.width,o.height),r.setRotation(-o.rotation),r.setScale(s.width/s.originalWidth*o.scaleX,s.height/s.originalHeight*o.scaleY)};t._createSprite=function(r,n){var s=n.rendererObject,o=s.page._texture,a=new exports.cc.Sprite;return o.isLoaded()?e(a,o,s,n):o.addEventListener("load",function(){e(a,o,s,n)},this),r.sprites=r.sprites||{},r.sprites[s.name]=a,a},t._updateChild=function(){var r=this._node._skeleton,n=r.slots,s,o,a,c,l,h;for(s=0,o=n.length;s<o;s++){if(c=n[s],l=c.attachment,h=c._slotNode,!l){h.setVisible(!1);continue}var u=l.type;if(u===spine.AttachmentType.region){if(l.rendererObject&&(!c.currentSpriteName||c.currentSpriteName!==l.name)){var _=l.rendererObject.name;if(c.currentSprite!==void 0&&c.currentSprite.setVisible(!1),c.sprites=c.sprites||{},c.sprites[_]!==void 0)c.sprites[_].setVisible(!0);else{var d=this._createSprite(c,l);h.addChild(d)}c.currentSprite=c.sprites[_],c.currentSpriteName=_}var f=c.bone;h.setPosition(f.worldX+l.x*f.m00+l.y*f.m01,f.worldY+l.x*f.m10+l.y*f.m11),h.setScale(f.worldScaleX,f.worldScaleY),a=c.currentSprite,a._flippedX=f.worldFlipX,a._flippedY=f.worldFlipY,a._flippedY||a._flippedX?(h.setRotation(f.worldRotation),a.setRotation(l.rotation)):(h.setRotation(-f.worldRotation),a.setRotation(-l.rotation)),a._renderCmd._displayedOpacity=0|this._node.getOpacity()*r.a*c.a;var T=0|r.r*c.r*255,x=0|r.g*c.g*255,m=0|r.b*c.b*255;a.setColor(exports.cc.color(T,x,m)),a._renderCmd._updateColor()}else if(u!==spine.AttachmentType.skinnedmesh){h.setVisible(!1);continue}h.setVisible(!0)}}})();(function(){sp.Skeleton.WebGLRenderCmd=function(e){exports.cc.Node.WebGLRenderCmd.call(this,e),this._needDraw=!0,this._matrix=new exports.cc.math.Matrix4,this._matrix.identity(),this._tmpQuad=new exports.cc.V3F_C4B_T2F_Quad,this.setShaderProgram(exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR))};var t=sp.Skeleton.WebGLRenderCmd.prototype=Object.create(exports.cc.Node.WebGLRenderCmd.prototype);t.constructor=sp.Skeleton.WebGLRenderCmd,t.rendering=function(e){var r=this._node,n=this._tmpQuad,s=r.getColor(),o=r._skeleton,a,c,l,h,u,_,d=r._blendFunc,f=r._premultipliedAlpha,T=this._worldTransform;for(this._matrix.mat[0]=T.a,this._matrix.mat[4]=T.c,this._matrix.mat[12]=T.tx,this._matrix.mat[1]=T.b,this._matrix.mat[5]=T.d,this._matrix.mat[13]=T.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),o.r=s.r/255,o.g=s.g/255,o.b=s.b/255,o.a=r.getOpacity()/255,f&&(o.r*=o.a,o.g*=o.a,o.b*=o.a),u=0,_=o.drawOrder.length;u<_;u++)if(h=o.drawOrder[u],!!h.attachment){switch(l=h.attachment,h.attachment.type){case sp.ATTACHMENT_TYPE.REGION:this._updateRegionAttachmentQuad(l,h,n,f);break;case sp.ATTACHMENT_TYPE.MESH:this._updateMeshAttachmentQuad(l,h,n,f);break;case sp.ATTACHMENT_TYPE.SKINNED_MESH:break;default:continue}var x=r.getTextureAtlas(l);if(h.data.blendMode!=a)switch(c&&(c.drawQuads(),c.removeAllQuads()),a=h.data.blendMode,a){case spine.BlendMode.additive:exports.cc.glBlendFunc(f?exports.cc.ONE:exports.cc.SRC_ALPHA,exports.cc.ONE);break;case spine.BlendMode.multiply:exports.cc.glBlendFunc(exports.cc.DST_COLOR,exports.cc.ONE_MINUS_SRC_ALPHA);break;case spine.BlendMode.screen:exports.cc.glBlendFunc(exports.cc.ONE,exports.cc.ONE_MINUS_SRC_COLOR);break;default:exports.cc.glBlendFunc(d.src,d.dst)}else x!=c&&c&&(c.drawQuads(),c.removeAllQuads());c=x;var m=c.getTotalQuads();if(c.getCapacity()==m&&(c.drawQuads(),c.removeAllQuads(),!c.resizeCapacity(c.getCapacity()*2)))return;c.updateQuad(n,m)}if(c&&(c.drawQuads(),c.removeAllQuads()),r._debugBones||r._debugSlots){exports.cc.kmGLMatrixMode(exports.cc.KM_GL_MODELVIEW),exports.cc.current_stack.stack.push(exports.cc.current_stack.top),exports.cc.current_stack.top=this._matrix;var v=exports.cc._drawingUtil;if(r._debugSlots){for(v.setDrawColor(0,0,255,255),v.setLineWidth(1),u=0,_=o.slots.length;u<_;u++)if(h=o.drawOrder[u],!(!h.attachment||h.attachment.type!=sp.ATTACHMENT_TYPE.REGION)){l=h.attachment,this._updateRegionAttachmentQuad(l,h,n);var A=[];A.push(exports.cc.p(n.bl.vertices.x,n.bl.vertices.y)),A.push(exports.cc.p(n.br.vertices.x,n.br.vertices.y)),A.push(exports.cc.p(n.tr.vertices.x,n.tr.vertices.y)),A.push(exports.cc.p(n.tl.vertices.x,n.tl.vertices.y)),v.drawPoly(A,4,!0)}}if(r._debugBones){var D;for(v.setLineWidth(2),v.setDrawColor(255,0,0,255),u=0,_=o.bones.length;u<_;u++){D=o.bones[u];var N=D.data.length*D.m00+D.worldX,z=D.data.length*D.m10+D.worldY;v.drawLine(exports.cc.p(D.worldX,D.worldY),exports.cc.p(N,z))}for(v.setPointSize(4),v.setDrawColor(0,0,255,255),u=0,_=o.bones.length;u<_;u++)D=o.bones[u],v.drawPoint(exports.cc.p(D.worldX,D.worldY)),u==0&&v.setDrawColor(0,255,0,255)}exports.cc.kmGLPopMatrix()}},t._createChildFormSkeletonData=function(){},t._updateChild=function(){},t._updateRegionAttachmentQuad=function(e,r,n,s){var o={};e.computeVertices(r.bone.skeleton.x,r.bone.skeleton.y,r.bone,o);var a=r.bone.skeleton.r*r.r*255,c=r.bone.skeleton.g*r.g*255,l=r.bone.skeleton.b*r.b*255,h=r.bone.skeleton.a*r.a;s&&(a*=h,c*=h,l*=h);var u=h*255;n.bl.colors.r=n.tl.colors.r=n.tr.colors.r=n.br.colors.r=a,n.bl.colors.g=n.tl.colors.g=n.tr.colors.g=n.br.colors.g=c,n.bl.colors.b=n.tl.colors.b=n.tr.colors.b=n.br.colors.b=l,n.bl.colors.a=n.tl.colors.a=n.tr.colors.a=n.br.colors.a=u;var _=sp.VERTEX_INDEX;n.bl.vertices.x=o[_.X1],n.bl.vertices.y=o[_.Y1],n.tl.vertices.x=o[_.X2],n.tl.vertices.y=o[_.Y2],n.tr.vertices.x=o[_.X3],n.tr.vertices.y=o[_.Y3],n.br.vertices.x=o[_.X4],n.br.vertices.y=o[_.Y4],n.bl.texCoords.u=e.uvs[_.X1],n.bl.texCoords.v=e.uvs[_.Y1],n.tl.texCoords.u=e.uvs[_.X2],n.tl.texCoords.v=e.uvs[_.Y2],n.tr.texCoords.u=e.uvs[_.X3],n.tr.texCoords.v=e.uvs[_.Y3],n.br.texCoords.u=e.uvs[_.X4],n.br.texCoords.v=e.uvs[_.Y4]},t._updateMeshAttachmentQuad=function(e,r,n,s){var o={};e.computeWorldVertices(r.bone.x,r.bone.y,r,o);var a=r.bone.skeleton.r*r.r*255,c=r.bone.skeleton.g*r.g*255,l=r.bone.skeleton.b*r.b*255,h=r.bone.skeleton.a*r.a;s&&(a*=h,c*=h,l*=h);var u=h*255;n.bl.colors.r=n.tl.colors.r=n.tr.colors.r=n.br.colors.r=a,n.bl.colors.g=n.tl.colors.g=n.tr.colors.g=n.br.colors.g=c,n.bl.colors.b=n.tl.colors.b=n.tr.colors.b=n.br.colors.b=l,n.bl.colors.a=n.tl.colors.a=n.tr.colors.a=n.br.colors.a=u;var _=sp.VERTEX_INDEX;n.bl.vertices.x=o[_.X1],n.bl.vertices.y=o[_.Y1],n.tl.vertices.x=o[_.X2],n.tl.vertices.y=o[_.Y2],n.tr.vertices.x=o[_.X3],n.tr.vertices.y=o[_.Y3],n.br.vertices.x=o[_.X4],n.br.vertices.y=o[_.Y4],n.bl.texCoords.u=e.uvs[_.X1],n.bl.texCoords.v=e.uvs[_.Y1],n.tl.texCoords.u=e.uvs[_.X2],n.tl.texCoords.v=e.uvs[_.Y2],n.tr.texCoords.u=e.uvs[_.X3],n.tr.texCoords.v=e.uvs[_.Y3],n.br.texCoords.u=e.uvs[_.X4],n.br.texCoords.v=e.uvs[_.Y4]}})();(function(){exports.gaf.Sprite.WebGLRenderCmd=function(e){exports.cc.Sprite.WebGLRenderCmd.call(this,e),this._defualtShader=exports.cc.shaderCache.programForKey(exports.cc.SHADER_POSITION_TEXTURECOLOR),this._customShader=exports.gaf._Shaders.Alpha,this._tintMult=null,this._tintOffset=null,this._ctxMatrixBody=null,this._ctxMatrixAppendix=null};var t=exports.gaf.Sprite.WebGLRenderCmd.prototype=Object.create(exports.cc.Sprite.WebGLRenderCmd.prototype);t.constructor=exports.gaf.Sprite.WebGLRenderCmd,t._identityVec=[1,1,1,1],t._zeroVec=[0,0,0,0],t._identityMat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t._disableCtx=function(){this.setShaderProgram(this._defualtShader)},t._enableCtx=function(){this.setShaderProgram(this._customShader)},t._applyCtxState=function(e){var r=e._cascadeColorMult;this._tintMult=[r.r/255,r.g/255,r.b/255,r.a/255];var n=e._cascadeColorOffset;this._tintOffset=[n.r/255,n.g/255,n.b/255,n.a/255];var s=e._filterStack;if(s&&s.length>0&&s[0].type===exports.gaf.EFFECT_COLOR_MATRIX){var o=s[0].colorMatrix;this._ctxMatrixBody=[o.rr,o.rg,o.rb,o.ra,o.gr,o.gg,o.gb,o.ga,o.br,o.bg,o.bb,o.ba,o.ar,o.ag,o.ab,o.aa],this._ctxMatrixAppendix=[o.r/255,o.g/255,o.b/255,o.a/255]}else this._ctxMatrixBody=null,this._ctxMatrixAppendix=null},t._setUniforms=function(){this._shaderProgram===this._customShader&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith4fv(exports.gaf._Uniforms.ColorTransformMult,this._tintMult,1),this._shaderProgram.setUniformLocationWith4fv(exports.gaf._Uniforms.ColorTransformOffset,this._tintOffset,1),this._ctxMatrixBody&&this._ctxMatrixAppendix?(this._shaderProgram.setUniformLocationWithMatrix4fv(exports.gaf._Uniforms.ColorMatrixBody,this._ctxMatrixBody,1),this._shaderProgram.setUniformLocationWith4fv(exports.gaf._Uniforms.ColorMatrixAppendix,this._ctxMatrixAppendix,1)):(this._shaderProgram.setUniformLocationWithMatrix4fv(exports.gaf._Uniforms.ColorMatrixBody,this._identityMat,1),this._shaderProgram.setUniformLocationWith4fv(exports.gaf._Uniforms.ColorMatrixAppendix,this._zeroVec,1)))},t.rendering=function(e){this._setUniforms(),exports.cc.Sprite.WebGLRenderCmd.prototype.rendering.call(this,e)}})();const __CJS__cc__export_default__=(module$1.exports==null?{}:module$1.exports).default||module$1.exports,__CJS__cc__export_managers__=(module$1.exports==null?{}:module$1.exports).managers,__CJS__cc__export_protocol__=(module$1.exports==null?{}:module$1.exports).protocol,__CJS__cc__export_connect__=(module$1.exports==null?{}:module$1.exports).connect,__CJS__cc__export_Manager__=(module$1.exports==null?{}:module$1.exports).Manager,__CJS__cc__export_Socket__=(module$1.exports==null?{}:module$1.exports).Socket,__CJS__cc__export_polling__=(module$1.exports==null?{}:module$1.exports).polling,__CJS__cc__export_websocket__=(module$1.exports==null?{}:module$1.exports).websocket,__CJS__cc__export_log__=(module$1.exports==null?{}:module$1.exports).log,__CJS__cc__export_formatArgs__=(module$1.exports==null?{}:module$1.exports).formatArgs,__CJS__cc__export_save__=(module$1.exports==null?{}:module$1.exports).save,__CJS__cc__export_load__=(module$1.exports==null?{}:module$1.exports).load,__CJS__cc__export_useColors__=(module$1.exports==null?{}:module$1.exports).useColors,__CJS__cc__export_colors__=(module$1.exports==null?{}:module$1.exports).colors,__CJS__cc__export_coerce__=(module$1.exports==null?{}:module$1.exports).coerce,__CJS__cc__export_disable__=(module$1.exports==null?{}:module$1.exports).disable,__CJS__cc__export_enable__=(module$1.exports==null?{}:module$1.exports).enable,__CJS__cc__export_enabled__=(module$1.exports==null?{}:module$1.exports).enabled,__CJS__cc__export_humanize__=(module$1.exports==null?{}:module$1.exports).humanize,__CJS__cc__export_names__=(module$1.exports==null?{}:module$1.exports).names,__CJS__cc__export_skips__=(module$1.exports==null?{}:module$1.exports).skips,__CJS__cc__export_formatters__=(module$1.exports==null?{}:module$1.exports).formatters,__CJS__cc__export_packets__=(module$1.exports==null?{}:module$1.exports).packets,__CJS__cc__export_encodePacket__=(module$1.exports==null?{}:module$1.exports).encodePacket,__CJS__cc__export_encodeBase64Packet__=(module$1.exports==null?{}:module$1.exports).encodeBase64Packet,__CJS__cc__export_decodePacket__=(module$1.exports==null?{}:module$1.exports).decodePacket,__CJS__cc__export_decodeBase64Packet__=(module$1.exports==null?{}:module$1.exports).decodeBase64Packet,__CJS__cc__export_encodePayload__=(module$1.exports==null?{}:module$1.exports).encodePayload,__CJS__cc__export_decodePayload__=(module$1.exports==null?{}:module$1.exports).decodePayload,__CJS__cc__export_encodePayloadAsArrayBuffer__=(module$1.exports==null?{}:module$1.exports).encodePayloadAsArrayBuffer,__CJS__cc__export_encodePayloadAsBlob__=(module$1.exports==null?{}:module$1.exports).encodePayloadAsBlob,__CJS__cc__export_decodePayloadAsBinary__=(module$1.exports==null?{}:module$1.exports).decodePayloadAsBinary,__CJS__cc__export_encode__=(module$1.exports==null?{}:module$1.exports).encode,__CJS__cc__export_decode__=(module$1.exports==null?{}:module$1.exports).decode,__CJS__cc__export_keys__=(module$1.exports==null?{}:module$1.exports).keys,__CJS__cc__export_values__=(module$1.exports==null?{}:module$1.exports).values,__CJS__cc__export_merge__=(module$1.exports==null?{}:module$1.exports).merge,__CJS__cc__export_length__=(module$1.exports==null?{}:module$1.exports).length,__CJS__cc__export_isEmpty__=(module$1.exports==null?{}:module$1.exports).isEmpty,__CJS__cc__export_deconstructPacket__=(module$1.exports==null?{}:module$1.exports).deconstructPacket,__CJS__cc__export_reconstructPacket__=(module$1.exports==null?{}:module$1.exports).reconstructPacket,__CJS__cc__export_removeBlobs__=(module$1.exports==null?{}:module$1.exports).removeBlobs,__CJS__cc__export_types__=(module$1.exports==null?{}:module$1.exports).types,__CJS__cc__export_CONNECT__=(module$1.exports==null?{}:module$1.exports).CONNECT,__CJS__cc__export_DISCONNECT__=(module$1.exports==null?{}:module$1.exports).DISCONNECT,__CJS__cc__export_EVENT__=(module$1.exports==null?{}:module$1.exports).EVENT,__CJS__cc__export_ACK__=(module$1.exports==null?{}:module$1.exports).ACK,__CJS__cc__export_ERROR__=(module$1.exports==null?{}:module$1.exports).ERROR,__CJS__cc__export_BINARY_EVENT__=(module$1.exports==null?{}:module$1.exports).BINARY_EVENT,__CJS__cc__export_BINARY_ACK__=(module$1.exports==null?{}:module$1.exports).BINARY_ACK,__CJS__cc__export_Encoder__=(module$1.exports==null?{}:module$1.exports).Encoder,__CJS__cc__export_Decoder__=(module$1.exports==null?{}:module$1.exports).Decoder;exports.ACK=__CJS__cc__export_ACK__;exports.BINARY_ACK=__CJS__cc__export_BINARY_ACK__;exports.BINARY_EVENT=__CJS__cc__export_BINARY_EVENT__;exports.CONNECT=__CJS__cc__export_CONNECT__;exports.DISCONNECT=__CJS__cc__export_DISCONNECT__;exports.Decoder=__CJS__cc__export_Decoder__;exports.ERROR=__CJS__cc__export_ERROR__;exports.EVENT=__CJS__cc__export_EVENT__;exports.Encoder=__CJS__cc__export_Encoder__;exports.Manager=__CJS__cc__export_Manager__;exports.Socket=__CJS__cc__export_Socket__;exports.ccs=ccs;exports.ccui=ccui;exports.coerce=__CJS__cc__export_coerce__;exports.colors=__CJS__cc__export_colors__;exports.connect=__CJS__cc__export_connect__;exports.decode=__CJS__cc__export_decode__;exports.decodeBase64Packet=__CJS__cc__export_decodeBase64Packet__;exports.decodePacket=__CJS__cc__export_decodePacket__;exports.decodePayload=__CJS__cc__export_decodePayload__;exports.decodePayloadAsBinary=__CJS__cc__export_decodePayloadAsBinary__;exports.deconstructPacket=__CJS__cc__export_deconstructPacket__;exports.default=__CJS__cc__export_default__;exports.disable=__CJS__cc__export_disable__;exports.enable=__CJS__cc__export_enable__;exports.enabled=__CJS__cc__export_enabled__;exports.encode=__CJS__cc__export_encode__;exports.encodeBase64Packet=__CJS__cc__export_encodeBase64Packet__;exports.encodePacket=__CJS__cc__export_encodePacket__;exports.encodePayload=__CJS__cc__export_encodePayload__;exports.encodePayloadAsArrayBuffer=__CJS__cc__export_encodePayloadAsArrayBuffer__;exports.encodePayloadAsBlob=__CJS__cc__export_encodePayloadAsBlob__;exports.formatArgs=__CJS__cc__export_formatArgs__;exports.formatters=__CJS__cc__export_formatters__;exports.humanize=__CJS__cc__export_humanize__;exports.isEmpty=__CJS__cc__export_isEmpty__;exports.keys=__CJS__cc__export_keys__;exports.length=__CJS__cc__export_length__;exports.load=__CJS__cc__export_load__;exports.log=__CJS__cc__export_log__;exports.managers=__CJS__cc__export_managers__;exports.merge=__CJS__cc__export_merge__;exports.names=__CJS__cc__export_names__;exports.packets=__CJS__cc__export_packets__;exports.polling=__CJS__cc__export_polling__;exports.protocol=__CJS__cc__export_protocol__;exports.reconstructPacket=__CJS__cc__export_reconstructPacket__;exports.removeBlobs=__CJS__cc__export_removeBlobs__;exports.res=res;exports.save=__CJS__cc__export_save__;exports.skips=__CJS__cc__export_skips__;exports.sp=sp;exports.types=__CJS__cc__export_types__;exports.useColors=__CJS__cc__export_useColors__;exports.values=__CJS__cc__export_values__;exports.websocket=__CJS__cc__export_websocket__;
